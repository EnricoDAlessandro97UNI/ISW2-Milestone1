{"sha":"c3210f8f8d807ac5d2a037d9e0c083f8d863edc9","node_id":"MDY6Q29tbWl0NjM2ODc5MDYyOmMzMjEwZjhmOGQ4MDdhYzVkMmEwMzdkOWUwYzA4M2Y4ZDg2M2VkYzk=","commit":{"author":{"name":"Francesco Chicchiriccò","email":"ilgrosso@apache.org","date":"2013-02-08T17:01:18Z"},"committer":{"name":"Francesco Chicchiriccò","email":"ilgrosso@apache.org","date":"2013-02-08T17:01:18Z"},"message":"[SYNCOPE-311] Merge from 1_0_X\n\ngit-svn-id: https://svn.apache.org/repos/asf/syncope/trunk@1444147 13f79535-47bb-0310-9956-ffa450edef68","tree":{"sha":"a0d3800740259fabfb65befe9bb8749957a05fcc","url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/git/trees/a0d3800740259fabfb65befe9bb8749957a05fcc"},"url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/git/commits/c3210f8f8d807ac5d2a037d9e0c083f8d863edc9","comment_count":0,"verification":{"verified":false,"reason":"unsigned","signature":null,"payload":null}},"url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/c3210f8f8d807ac5d2a037d9e0c083f8d863edc9","html_url":"https://github.com/EnricoDAlessandro97UNI/syncope/commit/c3210f8f8d807ac5d2a037d9e0c083f8d863edc9","comments_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/c3210f8f8d807ac5d2a037d9e0c083f8d863edc9/comments","author":{"login":"ilgrosso","id":1064664,"node_id":"MDQ6VXNlcjEwNjQ2NjQ=","avatar_url":"https://avatars.githubusercontent.com/u/1064664?v=4","gravatar_id":"","url":"https://api.github.com/users/ilgrosso","html_url":"https://github.com/ilgrosso","followers_url":"https://api.github.com/users/ilgrosso/followers","following_url":"https://api.github.com/users/ilgrosso/following{/other_user}","gists_url":"https://api.github.com/users/ilgrosso/gists{/gist_id}","starred_url":"https://api.github.com/users/ilgrosso/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ilgrosso/subscriptions","organizations_url":"https://api.github.com/users/ilgrosso/orgs","repos_url":"https://api.github.com/users/ilgrosso/repos","events_url":"https://api.github.com/users/ilgrosso/events{/privacy}","received_events_url":"https://api.github.com/users/ilgrosso/received_events","type":"User","site_admin":false},"committer":{"login":"ilgrosso","id":1064664,"node_id":"MDQ6VXNlcjEwNjQ2NjQ=","avatar_url":"https://avatars.githubusercontent.com/u/1064664?v=4","gravatar_id":"","url":"https://api.github.com/users/ilgrosso","html_url":"https://github.com/ilgrosso","followers_url":"https://api.github.com/users/ilgrosso/followers","following_url":"https://api.github.com/users/ilgrosso/following{/other_user}","gists_url":"https://api.github.com/users/ilgrosso/gists{/gist_id}","starred_url":"https://api.github.com/users/ilgrosso/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ilgrosso/subscriptions","organizations_url":"https://api.github.com/users/ilgrosso/orgs","repos_url":"https://api.github.com/users/ilgrosso/repos","events_url":"https://api.github.com/users/ilgrosso/events{/privacy}","received_events_url":"https://api.github.com/users/ilgrosso/received_events","type":"User","site_admin":false},"parents":[{"sha":"c0419c29e2ff420a6e21e640cf1790ec12dfc5d9","url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/c0419c29e2ff420a6e21e640cf1790ec12dfc5d9","html_url":"https://github.com/EnricoDAlessandro97UNI/syncope/commit/c0419c29e2ff420a6e21e640cf1790ec12dfc5d9"}],"stats":{"total":434,"additions":274,"deletions":160},"files":[{"sha":"ec504e46e6a4191378f6caf7a3bd3a27794294af","filename":"common/src/main/java/org/apache/syncope/common/to/WorkflowFormTO.java","status":"modified","additions":11,"deletions":3,"changes":14,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/c3210f8f8d807ac5d2a037d9e0c083f8d863edc9/common%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcommon%2Fto%2FWorkflowFormTO.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/c3210f8f8d807ac5d2a037d9e0c083f8d863edc9/common%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcommon%2Fto%2FWorkflowFormTO.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/common%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcommon%2Fto%2FWorkflowFormTO.java?ref=c3210f8f8d807ac5d2a037d9e0c083f8d863edc9","patch":"@@ -25,21 +25,21 @@\n import java.util.HashMap;\r\n import java.util.List;\r\n import java.util.Map;\r\n-\r\n import javax.xml.bind.annotation.XmlElement;\r\n import javax.xml.bind.annotation.XmlElementWrapper;\r\n import javax.xml.bind.annotation.XmlRootElement;\r\n import javax.xml.bind.annotation.XmlType;\r\n-\r\n-import org.codehaus.jackson.annotate.JsonIgnore;\r\n import org.apache.syncope.common.AbstractBaseBean;\r\n+import org.codehaus.jackson.annotate.JsonIgnore;\r\n \r\n @XmlRootElement(name = \"workflowForm\")\r\n @XmlType\r\n public class WorkflowFormTO extends AbstractBaseBean {\r\n \r\n     private static final long serialVersionUID = -7044543391316529128L;\r\n \r\n+    private long userId;\r\n+\r\n     private String taskId;\r\n \r\n     private String key;\r\n@@ -58,6 +58,14 @@ public WorkflowFormTO() {\n         properties = new ArrayList<WorkflowFormPropertyTO>();\r\n     }\r\n \r\n+    public long getUserId() {\r\n+        return userId;\r\n+    }\r\n+\r\n+    public void setUserId(long userId) {\r\n+        this.userId = userId;\r\n+    }\r\n+\r\n     public String getTaskId() {\r\n         return taskId;\r\n     }\r"},{"sha":"98d8d1ba61b4a2af630a32bc91aa47ee7897dc68","filename":"console/src/main/java/org/apache/syncope/console/pages/ApprovalModalPage.java","status":"modified","additions":117,"deletions":62,"changes":179,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/c3210f8f8d807ac5d2a037d9e0c083f8d863edc9/console%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fconsole%2Fpages%2FApprovalModalPage.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/c3210f8f8d807ac5d2a037d9e0c083f8d863edc9/console%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fconsole%2Fpages%2FApprovalModalPage.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/console%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fconsole%2Fpages%2FApprovalModalPage.java?ref=c3210f8f8d807ac5d2a037d9e0c083f8d863edc9","patch":"@@ -31,12 +31,15 @@\n import org.apache.syncope.common.to.WorkflowFormTO;\n import org.apache.syncope.common.validation.SyncopeClientCompositeErrorException;\n import org.apache.syncope.console.commons.MapChoiceRenderer;\n+import org.apache.syncope.console.markup.html.list.AltListView;\n import org.apache.syncope.console.rest.ApprovalRestClient;\n+import org.apache.syncope.console.rest.UserRestClient;\n import org.apache.syncope.console.wicket.markup.html.form.AjaxDropDownChoicePanel;\n import org.apache.syncope.console.wicket.markup.html.form.AjaxNumberFieldPanel;\n import org.apache.syncope.console.wicket.markup.html.form.AjaxTextFieldPanel;\n import org.apache.syncope.console.wicket.markup.html.form.DateTimeFieldPanel;\n import org.apache.syncope.console.wicket.markup.html.form.FieldPanel;\n+import org.apache.wicket.Page;\n import org.apache.wicket.PageReference;\n import org.apache.wicket.ajax.AjaxRequestTarget;\n import org.apache.wicket.ajax.markup.html.form.AjaxButton;\n@@ -57,13 +60,23 @@ public class ApprovalModalPage extends BaseModalPage {\n \n     private static final long serialVersionUID = -8847854414429745216L;\n \n+    private final static int USER_WIN_HEIGHT = 550;\n+\n+    private final static int USER_WIN_WIDTH = 800;\n+\n     @SpringBean\n     private ApprovalRestClient restClient;\n \n+    @SpringBean\n+    private UserRestClient userRestClient;\n+\n+    private final ModalWindow editUserWin;\n+\n     public ApprovalModalPage(final PageReference callerPageRef, final ModalWindow window, final WorkflowFormTO formTO) {\n         super();\n-                \n+\n         IModel<List<WorkflowFormPropertyTO>> formProps = new LoadableDetachableModel<List<WorkflowFormPropertyTO>>() {\n+\n             private static final long serialVersionUID = 3169142472626817508L;\n \n             @Override\n@@ -72,79 +85,112 @@ protected List<WorkflowFormPropertyTO> load() {\n             }\n         };\n \n-        final ListView<WorkflowFormPropertyTO> propView = new ListView<WorkflowFormPropertyTO>(\"propView\", formProps) {\n-            private static final long serialVersionUID = 9101744072914090143L;\n+        final ListView<WorkflowFormPropertyTO> propView =\n+                new AltListView<WorkflowFormPropertyTO>(\"propView\", formProps) {\n \n-            @Override\n-            protected void populateItem(final ListItem<WorkflowFormPropertyTO> item) {\n-                final WorkflowFormPropertyTO prop = item.getModelObject();\n-\n-                Label label = new Label(\"key\", prop.getName() == null\n-                        ? prop.getId()\n-                        : prop.getName());\n-                item.add(label);\n-\n-                FieldPanel field;\n-                switch (prop.getType()) {\n-                    case Boolean:\n-                        field = new AjaxDropDownChoicePanel(\"value\", label.getDefaultModelObjectAsString(),\n-                                new Model(Boolean.valueOf(prop.getValue()))).setChoices(Arrays.asList(\n-                                new String[]{\"Yes\", \"No\"}));\n-                        break;\n-\n-                    case Date:\n-                        SimpleDateFormat df = StringUtils.isNotBlank(prop.getDatePattern())\n-                                ? new SimpleDateFormat(prop.getDatePattern())\n-                                : new SimpleDateFormat();\n-                        Date parsedDate = null;\n-                        if (StringUtils.isNotBlank(prop.getValue())) {\n-                            try {\n-                                parsedDate = df.parse(prop.getValue());\n-                            } catch (ParseException e) {\n-                                LOG.error(\"Unparsable date: {}\", prop.getValue(), e);\n-                            }\n+                    private static final long serialVersionUID = 9101744072914090143L;\n+\n+                    @Override\n+                    protected void populateItem(final ListItem<WorkflowFormPropertyTO> item) {\n+                        final WorkflowFormPropertyTO prop = item.getModelObject();\n+\n+                        Label label = new Label(\"key\", prop.getName() == null\n+                                ? prop.getId()\n+                                : prop.getName());\n+                        item.add(label);\n+\n+                        FieldPanel field;\n+                        switch (prop.getType()) {\n+                            case Boolean:\n+                                field = new AjaxDropDownChoicePanel(\"value\", label.getDefaultModelObjectAsString(),\n+                                        new Model(Boolean.valueOf(prop.getValue()))).setChoices(Arrays.asList(\n+                                        new String[]{\"Yes\", \"No\"}));\n+                                break;\n+\n+                            case Date:\n+                                SimpleDateFormat df = StringUtils.isNotBlank(prop.getDatePattern())\n+                                        ? new SimpleDateFormat(prop.getDatePattern())\n+                                        : new SimpleDateFormat();\n+                                Date parsedDate = null;\n+                                if (StringUtils.isNotBlank(prop.getValue())) {\n+                                    try {\n+                                        parsedDate = df.parse(prop.getValue());\n+                                    } catch (ParseException e) {\n+                                        LOG.error(\"Unparsable date: {}\", prop.getValue(), e);\n+                                    }\n+                                }\n+\n+                                field = new DateTimeFieldPanel(\"value\", label.getDefaultModelObjectAsString(),\n+                                        new Model(parsedDate), df.toLocalizedPattern());\n+                                break;\n+\n+                            case Enum:\n+                                MapChoiceRenderer<String, String> enumCR =\n+                                        new MapChoiceRenderer<String, String>(prop.getEnumValues());\n+\n+                                field = new AjaxDropDownChoicePanel(\"value\", label.getDefaultModelObjectAsString(),\n+                                        new Model(prop.getValue())).setChoiceRenderer(enumCR).setChoices(new Model() {\n+\n+                                    private static final long serialVersionUID = -858521070366432018L;\n+\n+                                    @Override\n+                                    public Serializable getObject() {\n+                                        return new ArrayList(prop.getEnumValues().keySet());\n+                                    }\n+                                });\n+                                break;\n+\n+                            case Long:\n+                                field = new AjaxNumberFieldPanel(\"value\", label.getDefaultModelObjectAsString(),\n+                                        new Model(Long.valueOf(prop.getValue())), Long.class);\n+                                break;\n+\n+                            case String:\n+                            default:\n+                                field = new AjaxTextFieldPanel(\"value\", PARENT_PATH, new Model(prop.getValue()));\n+                                break;\n+                        }\n+\n+                        field.setReadOnly(!prop.isWritable());\n+                        if (prop.isRequired()) {\n+                            field.addRequiredLabel();\n                         }\n \n-                        field = new DateTimeFieldPanel(\"value\", label.getDefaultModelObjectAsString(), new Model(\n-                                parsedDate), df.toLocalizedPattern());\n-                        break;\n+                        item.add(field);\n+                    }\n+                };\n \n-                    case Enum:\n-                        MapChoiceRenderer<String, String> enumCR =\n-                                new MapChoiceRenderer<String, String>(prop.getEnumValues());\n+        final AjaxButton userDetails = new IndicatingAjaxButton(\"userDetails\", new Model(getString(\"userDetails\"))) {\n \n-                        field = new AjaxDropDownChoicePanel(\"value\", label.getDefaultModelObjectAsString(),\n-                                new Model(prop.getValue())).setChoiceRenderer(enumCR).setChoices(new Model() {\n-                            private static final long serialVersionUID = -858521070366432018L;\n+            private static final long serialVersionUID = -4804368561204623354L;\n+\n+            @Override\n+            protected void onSubmit(final AjaxRequestTarget target, final Form<?> form) {\n+                editUserWin.setPageCreator(new ModalWindow.PageCreator() {\n+\n+                    private static final long serialVersionUID = -7834632442532690940L;\n+\n+                    @Override\n+                    public Page createPage() {\n+                        return new ViewUserModalPage(ApprovalModalPage.this.getPageReference(), editUserWin,\n+                                userRestClient.read(formTO.getUserId())) {\n \n                             @Override\n-                            public Serializable getObject() {\n-                                return new ArrayList(prop.getEnumValues().keySet());\n+                            protected void closeAction(final AjaxRequestTarget target, final Form form) {\n+                                setResponsePage(ApprovalModalPage.this);\n                             }\n-                        });\n-                        break;\n-\n-                    case Long:\n-                        field = new AjaxNumberFieldPanel(\"value\", label.getDefaultModelObjectAsString(),\n-                                new Model(Long.valueOf(prop.getValue())), Long.class);\n-                        break;\n-\n-                    case String:\n-                    default:\n-                        field = new AjaxTextFieldPanel(\"value\", PARENT_PATH, new Model(prop.getValue()));\n-                        break;\n-                }\n-\n-                field.setReadOnly(!prop.isWritable());\n-                if (prop.isRequired()) {\n-                    field.addRequiredLabel();\n-                }\n+                        };\n+                    }\n+                });\n \n-                item.add(field);\n+                editUserWin.show(target);\n             }\n         };\n+        MetaDataRoleAuthorizationStrategy.authorize(userDetails, ENABLE,\n+                xmlRolesReader.getAllAllowedRoles(\"Users\", \"read\"));\n \n         final AjaxButton submit = new IndicatingAjaxButton(\"apply\", new Model(getString(\"submit\"))) {\n+\n             private static final long serialVersionUID = -958724007591692537L;\n \n             @Override\n@@ -197,6 +243,7 @@ protected void onError(final AjaxRequestTarget target, final Form<?> form) {\n         };\n \n         final AjaxButton cancel = new IndicatingAjaxButton(\"cancel\", new ResourceModel(\"cancel\")) {\n+\n             private static final long serialVersionUID = -958724007591692537L;\n \n             @Override\n@@ -208,17 +255,25 @@ protected void onSubmit(final AjaxRequestTarget target, final Form form) {\n             protected void onError(final AjaxRequestTarget target, final Form form) {\n             }\n         };\n-        \n+\n         cancel.setDefaultFormProcessing(false);\n \n         Form form = new Form(\"form\");\n         form.add(propView);\n+        form.add(userDetails);\n         form.add(submit);\n         form.add(cancel);\n \n         MetaDataRoleAuthorizationStrategy.authorize(form, ENABLE, xmlRolesReader.getAllAllowedRoles(\"Approval\",\n                 \"submit\"));\n \n+        editUserWin = new ModalWindow(\"editUserWin\");\n+        editUserWin.setCssClassName(ModalWindow.CSS_CLASS_GRAY);\n+        editUserWin.setInitialHeight(USER_WIN_HEIGHT);\n+        editUserWin.setInitialWidth(USER_WIN_WIDTH);\n+        editUserWin.setCookieName(\"edit-user-modal\");\n+        add(editUserWin);\n+\n         add(form);\n     }\n }"},{"sha":"ffb7faaac09ab5ee3eabfbdcbd3aded00381df0d","filename":"console/src/main/java/org/apache/syncope/console/pages/EditUserModalPage.java","status":"modified","additions":3,"deletions":2,"changes":5,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/c3210f8f8d807ac5d2a037d9e0c083f8d863edc9/console%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fconsole%2Fpages%2FEditUserModalPage.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/c3210f8f8d807ac5d2a037d9e0c083f8d863edc9/console%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fconsole%2Fpages%2FEditUserModalPage.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/console%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fconsole%2Fpages%2FEditUserModalPage.java?ref=c3210f8f8d807ac5d2a037d9e0c083f8d863edc9","patch":"@@ -46,6 +46,8 @@ public class EditUserModalPage extends UserModalPage {\n     @SpringBean\n     private UserRestClient userRestClient;\n \n+    protected Form form;\n+\n     private UserTO initialUserTO = null;\n \n     private StatusPanel statusPanel;\n@@ -55,7 +57,7 @@ public EditUserModalPage(final PageReference callerPageRef, final ModalWindow wi\n \n         this.initialUserTO = AttributableOperations.clone(userTO);\n \n-        Form form = setupEditPanel();\n+        form = setupEditPanel();\n \n         // add resource assignment details in case of update\n         if (userTO.getId() != 0) {\n@@ -91,7 +93,6 @@ protected void submitAction(final AjaxRequestTarget target, final Form form) {\n                 userTO = userRestClient.update(userMod);\n             }\n         }\n-\n     }\n \n     @Override"},{"sha":"379a6792e326d1154dd0028268853258a72fb58c","filename":"console/src/main/java/org/apache/syncope/console/pages/Todo.java","status":"modified","additions":2,"deletions":2,"changes":4,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/c3210f8f8d807ac5d2a037d9e0c083f8d863edc9/console%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fconsole%2Fpages%2FTodo.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/c3210f8f8d807ac5d2a037d9e0c083f8d863edc9/console%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fconsole%2Fpages%2FTodo.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/console%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fconsole%2Fpages%2FTodo.java?ref=c3210f8f8d807ac5d2a037d9e0c083f8d863edc9","patch":"@@ -173,8 +173,8 @@ public Page createPage() {\n \n                         editApprovalWin.show(target);\n                     }\n-                }, ActionLink.ActionType.EDIT, \"Approval\", \"read\", SyncopeSession.get().getUserId().equals(\n-                        formTO.getOwner()));\n+                }, ActionLink.ActionType.EDIT, \"Approval\", \"read\",\n+                        SyncopeSession.get().getUserId().equals(formTO.getOwner()));\n \n                 cellItem.add(panel);\n             }"},{"sha":"ebab02cf7756835cbe1a80ebac65eb8131894ce9","filename":"console/src/main/java/org/apache/syncope/console/pages/ViewUserModalPage.java","status":"added","additions":49,"deletions":0,"changes":49,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/c3210f8f8d807ac5d2a037d9e0c083f8d863edc9/console%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fconsole%2Fpages%2FViewUserModalPage.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/c3210f8f8d807ac5d2a037d9e0c083f8d863edc9/console%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fconsole%2Fpages%2FViewUserModalPage.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/console%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fconsole%2Fpages%2FViewUserModalPage.java?ref=c3210f8f8d807ac5d2a037d9e0c083f8d863edc9","patch":"@@ -0,0 +1,49 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *   http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+package org.apache.syncope.console.pages;\n+\n+import org.apache.syncope.common.to.UserTO;\n+import org.apache.wicket.PageReference;\n+import org.apache.wicket.ajax.AjaxRequestTarget;\n+import org.apache.wicket.ajax.markup.html.form.AjaxButton;\n+import org.apache.wicket.extensions.ajax.markup.html.modal.ModalWindow;\n+import org.apache.wicket.markup.html.form.Form;\n+\n+public class ViewUserModalPage extends EditUserModalPage {\n+\n+    private static final long serialVersionUID = -8715255026876951611L;\n+\n+    public ViewUserModalPage(final PageReference callerPageRef, final ModalWindow window, final UserTO userTO) {\n+        super(callerPageRef, window, userTO);\n+        form.setEnabled(false);\n+        form.get(\"cancel\").setVisible(false);\n+    }\n+\n+    @Override\n+    protected AjaxButton getOnSubmit() {\n+        AjaxButton submit = super.getOnSubmit();\n+        submit.setVisible(false);\n+        return submit;\n+    }\n+\n+    @Override\n+    protected void submitAction(final AjaxRequestTarget target, final Form form) {\n+        // No submit allowed, read-only form\n+    }\n+}"},{"sha":"f5b5cf10b0a0788224baf224c455c551064ec723","filename":"console/src/main/resources/org/apache/syncope/console/pages/ApprovalModalPage.html","status":"modified","additions":20,"deletions":31,"changes":51,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/c3210f8f8d807ac5d2a037d9e0c083f8d863edc9/console%2Fsrc%2Fmain%2Fresources%2Forg%2Fapache%2Fsyncope%2Fconsole%2Fpages%2FApprovalModalPage.html","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/c3210f8f8d807ac5d2a037d9e0c083f8d863edc9/console%2Fsrc%2Fmain%2Fresources%2Forg%2Fapache%2Fsyncope%2Fconsole%2Fpages%2FApprovalModalPage.html","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/console%2Fsrc%2Fmain%2Fresources%2Forg%2Fapache%2Fsyncope%2Fconsole%2Fpages%2FApprovalModalPage.html?ref=c3210f8f8d807ac5d2a037d9e0c083f8d863edc9","patch":"@@ -20,42 +20,31 @@\n   <p class=\"ui-widget ui-corner-all ui-widget-header\"><wicket:message key=\"title\"/></p>\n <div style=\"margin:10px\">\n   <form wicket:id=\"form\">\n-    <div id=\"tabs\">\n-      <ul>\n-        <li class=\"tabs-selected\">\n-          <a href=\"#tabs-1\"><span><wicket:message key=\"tab1\"/></span></a>\n-        </li>\n-      </ul>\n-      <div id=\"tabs-1\">\n-        <div id=\"formtable\">\n-          <div class=\"tablerow\" wicket:id=\"propView\">\n-            <div class=\"tablecolumn_label medium_dynamicsize\">\n-              <span wicket:id=\"key\">[key]</span>\n-            </div>\n-            <div class=\"tablecolumn_field medium_dynamicsize\">\n-              <span wicket:id=\"value\">[value]</span>\n-\n-            </div>\n-          </div>\n-\n-          <!-- inside the container in order to re-process javascript -->\n-          <script type=\"text/javascript\">\n-            $(function() {\n-              $('#formtable div.tablerow:even').addClass(\"alt\");\n-            });\n-          </script>\n+    <div id=\"formtable\">\n+      <div class=\"tablerow\" wicket:id=\"propView\">\n+        <div class=\"tablecolumn_label medium_dynamicsize\">\n+          <span wicket:id=\"key\">[key]</span>\n         </div>\n+        <div class=\"tablecolumn_field medium_dynamicsize\">\n+          <span wicket:id=\"value\">[value]</span>\n \n-        <div style=\"margin: 20px 10px 0\">\n-          <input type=\"submit\"\n-                 class=\"ui-button ui-widget ui-state-default ui-corner-all ui-button-text-only\"\n-                 wicket:id=\"apply\"/>\n-          <input type=\"button\"\n-                 accept=\"\"class=\"ui-button ui-widget ui-state-default ui-corner-all ui-button-text-only\"\n-                 wicket:id=\"cancel\"/>\n         </div>\n       </div>\n     </div>\n+\n+    <div style=\"margin: 20px 0\">\n+      <input type=\"button\"\n+             class=\"ui-button ui-widget ui-state-default ui-corner-all ui-button-text-only\"\n+             wicket:id=\"userDetails\"/>\n+      <input type=\"submit\"\n+             class=\"ui-button ui-widget ui-state-default ui-corner-all ui-button-text-only\"\n+             wicket:id=\"apply\"/>\n+      <input type=\"button\"\n+             accept=\"\"class=\"ui-button ui-widget ui-state-default ui-corner-all ui-button-text-only\"\n+             wicket:id=\"cancel\"/>\n+    </div>\n+\n   </form>\n+  <div wicket:id=\"editUserWin\">[Show modal window for editing user under approval]</div>\n </div>\n </wicket:extend>"},{"sha":"547f13f896b7e5b9537724b2a7c6054f9401e4c4","filename":"console/src/main/resources/org/apache/syncope/console/pages/ApprovalModalPage.properties","status":"modified","additions":2,"deletions":2,"changes":4,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/c3210f8f8d807ac5d2a037d9e0c083f8d863edc9/console%2Fsrc%2Fmain%2Fresources%2Forg%2Fapache%2Fsyncope%2Fconsole%2Fpages%2FApprovalModalPage.properties","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/c3210f8f8d807ac5d2a037d9e0c083f8d863edc9/console%2Fsrc%2Fmain%2Fresources%2Forg%2Fapache%2Fsyncope%2Fconsole%2Fpages%2FApprovalModalPage.properties","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/console%2Fsrc%2Fmain%2Fresources%2Forg%2Fapache%2Fsyncope%2Fconsole%2Fpages%2FApprovalModalPage.properties?ref=c3210f8f8d807ac5d2a037d9e0c083f8d863edc9","patch":"@@ -14,5 +14,5 @@\n # KIND, either express or implied.  See the License for the\n # specific language governing permissions and limitations\n # under the License.\n-tab1=Approval form\n-title=Workflow\n+title=Approval form\n+userDetails=User details"},{"sha":"a2a7134c7aaac0a85f572de63977be164dd2585d","filename":"console/src/main/resources/org/apache/syncope/console/pages/ApprovalModalPage_it.properties","status":"modified","additions":2,"deletions":2,"changes":4,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/c3210f8f8d807ac5d2a037d9e0c083f8d863edc9/console%2Fsrc%2Fmain%2Fresources%2Forg%2Fapache%2Fsyncope%2Fconsole%2Fpages%2FApprovalModalPage_it.properties","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/c3210f8f8d807ac5d2a037d9e0c083f8d863edc9/console%2Fsrc%2Fmain%2Fresources%2Forg%2Fapache%2Fsyncope%2Fconsole%2Fpages%2FApprovalModalPage_it.properties","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/console%2Fsrc%2Fmain%2Fresources%2Forg%2Fapache%2Fsyncope%2Fconsole%2Fpages%2FApprovalModalPage_it.properties?ref=c3210f8f8d807ac5d2a037d9e0c083f8d863edc9","patch":"@@ -14,5 +14,5 @@\n # KIND, either express or implied.  See the License for the\n # specific language governing permissions and limitations\n # under the License.\n-tab1=Form di approvazione\n-title=Workflow\n+title=Form di approvazione\n+userDetails=Dettagli utente"},{"sha":"3cb9fdb04acee9b4da4d8e6892377447d50fe6f5","filename":"console/src/main/resources/org/apache/syncope/console/pages/Todo.html","status":"modified","additions":41,"deletions":43,"changes":84,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/c3210f8f8d807ac5d2a037d9e0c083f8d863edc9/console%2Fsrc%2Fmain%2Fresources%2Forg%2Fapache%2Fsyncope%2Fconsole%2Fpages%2FTodo.html","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/c3210f8f8d807ac5d2a037d9e0c083f8d863edc9/console%2Fsrc%2Fmain%2Fresources%2Forg%2Fapache%2Fsyncope%2Fconsole%2Fpages%2FTodo.html","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/console%2Fsrc%2Fmain%2Fresources%2Forg%2Fapache%2Fsyncope%2Fconsole%2Fpages%2FTodo.html?ref=c3210f8f8d807ac5d2a037d9e0c083f8d863edc9","patch":"@@ -17,49 +17,47 @@\n under the License.\n -->\n <wicket:extend>\n+  <div id=\"tabs\">\n+    <ul>\n+      <li class=\"tabs-selected\"><a href=\"#tabs-1\"><span><wicket:message key=\"approvals\"/></span></a></li>\n+      <li><a href=\"#tabs-2\"><span><wicket:message key=\"userRequests\"/></span></a></li>\n+    </ul>\n+    <div id=\"tabs-1\">\n+\n+      <div id=\"users-contain\" class=\"ui-widget\" style=\"width:inherit;\">\n+        <span wicket:id=\"approvalContainer\">\n+          <table class=\"ui-widget ui-widget-content table-hover\"\n+                 wicket:id=\"approvalTable\"/>\n+        </span>\n+        <span style=\"float:right\">\n+          <form wicket:id=\"approvalPaginatorForm\" style=\"display:inline\">\n+            <label><wicket:message key=\"displayRows\"/></label>\n+            <select class=\"text ui-widget-content ui-corner-all\"\n+                    wicket:id=\"rowsChooser\"/>\n+          </form>\n+        </span>\n+      </div>\n+\n+      <div wicket:id=\"editApprovalWin\">[Show modal window for editing approval]</div>\n+    </div>\n \n-\n-    <div id=\"tabs\">\n-        <ul>\n-            <li class=\"tabs-selected\"><a href=\"#tabs-1\"><span><wicket:message key=\"approvals\"/></span></a></li>\n-            <li><a href=\"#tabs-2\"><span><wicket:message key=\"userRequests\"/></span></a></li>\n-        </ul>\n-        <div id=\"tabs-1\">\n-\n-            <div id=\"users-contain\" class=\"ui-widget\" style=\"width:inherit;\">\n-                <span wicket:id=\"approvalContainer\">\n-                    <table class=\"ui-widget ui-widget-content table-hover\"\n-                           wicket:id=\"approvalTable\"/>\n-                </span>\n-                <span style=\"float:right\">\n-                    <form wicket:id=\"approvalPaginatorForm\" style=\"display:inline\">\n-                        <label><wicket:message key=\"displayRows\"/></label>\n-                        <select class=\"text ui-widget-content ui-corner-all\"\n-                                wicket:id=\"rowsChooser\"/>\n-                    </form>\n-                </span>\n-            </div>\n-\n-            <div wicket:id=\"editApprovalWin\">[Show modal window for editing approval]</div>\n-        </div>\n-\n-        <div id=\"tabs-2\">\n-\n-            <div id=\"users-contain\" class=\"ui-widget\">\n-                <span wicket:id=\"userRequestContainer\">\n-                    <table class=\"ui-widget ui-widget-content table-hover\"\n-                           wicket:id=\"userRequestTable\"/>\n-                </span>\n-                <span style=\"float:right\">\n-                    <form wicket:id=\"userRequestPaginatorForm\" style=\"display:inline\">\n-                        <label><wicket:message key=\"displayRows\"/></label>\n-                        <select class=\"text ui-widget-content ui-corner-all\"\n-                                wicket:id=\"rowsChooser\"/>\n-                    </form>\n-                </span>\n-            </div>\n-\n-            <div wicket:id=\"editUserRequestWin\">[Show modal window for editing user request]</div>\n-        </div>\n+    <div id=\"tabs-2\">\n+\n+      <div id=\"users-contain\" class=\"ui-widget\">\n+        <span wicket:id=\"userRequestContainer\">\n+          <table class=\"ui-widget ui-widget-content table-hover\"\n+                 wicket:id=\"userRequestTable\"/>\n+        </span>\n+        <span style=\"float:right\">\n+          <form wicket:id=\"userRequestPaginatorForm\" style=\"display:inline\">\n+            <label><wicket:message key=\"displayRows\"/></label>\n+            <select class=\"text ui-widget-content ui-corner-all\"\n+                    wicket:id=\"rowsChooser\"/>\n+          </form>\n+        </span>\n+      </div>\n+\n+      <div wicket:id=\"editUserRequestWin\">[Show modal window for editing user request]</div>\n     </div>\n+  </div>\n </wicket:extend>"},{"sha":"e15e8078be459ab62db080142dccfd109e518ce0","filename":"console/src/main/webapp/css/style.css","status":"modified","additions":4,"deletions":0,"changes":4,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/c3210f8f8d807ac5d2a037d9e0c083f8d863edc9/console%2Fsrc%2Fmain%2Fwebapp%2Fcss%2Fstyle.css","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/c3210f8f8d807ac5d2a037d9e0c083f8d863edc9/console%2Fsrc%2Fmain%2Fwebapp%2Fcss%2Fstyle.css","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/console%2Fsrc%2Fmain%2Fwebapp%2Fcss%2Fstyle.css?ref=c3210f8f8d807ac5d2a037d9e0c083f8d863edc9","patch":"@@ -448,4 +448,8 @@ td.action{\n .help a:hover {\n   color: blue;\n   text-decoration: none;\n+}\n+\n+.tree-junction-expanded {\n+  display: none;\n }\n\\ No newline at end of file"},{"sha":"57260b59e99e1a0f072341cbdcf7f50a11689608","filename":"core/src/main/java/org/apache/syncope/core/persistence/dao/impl/UserDAOImpl.java","status":"modified","additions":8,"deletions":1,"changes":9,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/c3210f8f8d807ac5d2a037d9e0c083f8d863edc9/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fpersistence%2Fdao%2Fimpl%2FUserDAOImpl.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/c3210f8f8d807ac5d2a037d9e0c083f8d863edc9/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fpersistence%2Fdao%2Fimpl%2FUserDAOImpl.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fpersistence%2Fdao%2Fimpl%2FUserDAOImpl.java?ref=c3210f8f8d807ac5d2a037d9e0c083f8d863edc9","patch":"@@ -89,7 +89,14 @@ public SyncopeUser findByWorkflowId(final String workflowId) {\n                 + \" e \" + \"WHERE e.workflowId = :workflowId\", SyncopeUser.class);\n         query.setParameter(\"workflowId\", workflowId);\n \n-        return query.getSingleResult();\n+        SyncopeUser result = null;\n+        try {\n+            result = query.getSingleResult();\n+        } catch (NoResultException e) {\n+            LOG.error(\"No user found with workflow id {}\", workflowId, e);\n+        }\n+\n+        return result;\n     }\n \n     @Override"},{"sha":"f8bef4a8e2a9d96f72ea5229382234dc4da4c29b","filename":"core/src/main/java/org/apache/syncope/core/workflow/user/activiti/ActivitiUserWorkflowAdapter.java","status":"modified","additions":13,"deletions":11,"changes":24,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/c3210f8f8d807ac5d2a037d9e0c083f8d863edc9/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fworkflow%2Fuser%2Factiviti%2FActivitiUserWorkflowAdapter.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/c3210f8f8d807ac5d2a037d9e0c083f8d863edc9/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fworkflow%2Fuser%2Factiviti%2FActivitiUserWorkflowAdapter.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fworkflow%2Fuser%2Factiviti%2FActivitiUserWorkflowAdapter.java?ref=c3210f8f8d807ac5d2a037d9e0c083f8d863edc9","patch":"@@ -234,8 +234,7 @@ public WorkflowResult<Map.Entry<Long, Boolean>> create(final UserTO userTO, fina\n             propagateEnable = enabled;\n         }\n \n-        // save resources to be propagated and password for later -\n-        // after form submission - propagation\n+        // save resources to be propagated and password for later - after form submission - propagation\n         PropagationByResource propByRes = new PropagationByResource();\n         propByRes.set(ResourceOperation.CREATE, user.getResourceNames());\n \n@@ -505,14 +504,20 @@ private WorkflowFormPropertyType fromActivitiFormType(final FormType activitiFor\n     @SuppressWarnings(\"unchecked\")\n     private WorkflowFormTO getFormTO(final Task task, final TaskFormData formData) {\n         WorkflowFormTO formTO = new WorkflowFormTO();\n+\n+        SyncopeUser user = userDAO.findByWorkflowId(task.getProcessInstanceId());\n+        if (user == null) {\n+            throw new NotFoundException(\"User with workflow id \" + task.getProcessInstanceId());\n+        }\n+        formTO.setUserId(user.getId());\n+\n         formTO.setTaskId(task.getId());\n         formTO.setKey(formData.getFormKey());\n \n         BeanUtils.copyProperties(task, formTO);\n \n-        WorkflowFormPropertyTO propertyTO;\n         for (FormProperty fProp : formData.getFormProperties()) {\n-            propertyTO = new WorkflowFormPropertyTO();\n+            WorkflowFormPropertyTO propertyTO = new WorkflowFormPropertyTO();\n             BeanUtils.copyProperties(fProp, propertyTO, PROPERTY_IGNORE_PROPS);\n             propertyTO.setType(fromActivitiFormType(fProp.getType()));\n \n@@ -533,17 +538,14 @@ private WorkflowFormTO getFormTO(final Task task, final TaskFormData formData) {\n     public List<WorkflowFormTO> getForms() {\n         List<WorkflowFormTO> forms = new ArrayList<WorkflowFormTO>();\n \n-        TaskFormData formData;\n         for (Task task : taskService.createTaskQuery().taskVariableValueEquals(TASK_IS_FORM, Boolean.TRUE).list()) {\n             try {\n-                formData = formService.getTaskFormData(task.getId());\n+                TaskFormData formData = formService.getTaskFormData(task.getId());\n+                if (formData != null && !formData.getFormProperties().isEmpty()) {\n+                    forms.add(getFormTO(task, formData));\n+                }\n             } catch (ActivitiException e) {\n                 LOG.debug(\"No form found for task {}\", task.getId(), e);\n-                formData = null;\n-            }\n-\n-            if (formData != null && !formData.getFormProperties().isEmpty()) {\n-                forms.add(getFormTO(task, formData));\n             }\n         }\n "},{"sha":"08de3f151e9e403281c28169b2b3d4475f3a34bf","filename":"core/src/main/java/org/apache/syncope/core/workflow/user/activiti/task/Update.java","status":"modified","additions":0,"deletions":1,"changes":1,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/c3210f8f8d807ac5d2a037d9e0c083f8d863edc9/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fworkflow%2Fuser%2Factiviti%2Ftask%2FUpdate.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/c3210f8f8d807ac5d2a037d9e0c083f8d863edc9/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fworkflow%2Fuser%2Factiviti%2Ftask%2FUpdate.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fworkflow%2Fuser%2Factiviti%2Ftask%2FUpdate.java?ref=c3210f8f8d807ac5d2a037d9e0c083f8d863edc9","patch":"@@ -28,7 +28,6 @@ public class Update extends AbstractActivitiDelegate {\n \n     @Override\n     protected void doExecute(final DelegateExecution execution) throws Exception {\n-\n         SyncopeUser user = (SyncopeUser) execution.getVariable(ActivitiUserWorkflowAdapter.SYNCOPE_USER);\n         UserMod userMod = (UserMod) execution.getVariable(ActivitiUserWorkflowAdapter.USER_MOD);\n "},{"sha":"ccbb2d2e8a5fa6e4961de72c1bb5aaa0d4b1f7f0","filename":"core/src/test/java/org/apache/syncope/core/rest/UserTestITCase.java","status":"modified","additions":2,"deletions":0,"changes":2,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/c3210f8f8d807ac5d2a037d9e0c083f8d863edc9/core%2Fsrc%2Ftest%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Frest%2FUserTestITCase.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/c3210f8f8d807ac5d2a037d9e0c083f8d863edc9/core%2Fsrc%2Ftest%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Frest%2FUserTestITCase.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fsrc%2Ftest%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Frest%2FUserTestITCase.java?ref=c3210f8f8d807ac5d2a037d9e0c083f8d863edc9","patch":"@@ -558,6 +558,8 @@ public void createWithReject() {\n         WorkflowFormTO form = userService.getFormForUser(userTO.getId());\n \n         assertNotNull(form);\n+        assertNotNull(form.getUserId());\n+        assertEquals(userTO.getId(), form.getUserId());\n         assertNotNull(form.getTaskId());\n         assertNull(form.getOwner());\n "}]}