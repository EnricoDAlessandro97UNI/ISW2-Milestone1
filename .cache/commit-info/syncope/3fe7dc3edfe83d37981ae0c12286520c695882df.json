{"sha":"3fe7dc3edfe83d37981ae0c12286520c695882df","node_id":"MDY6Q29tbWl0NjM2ODc5MDYyOjNmZTdkYzNlZGZlODNkMzc5ODFhZTBjMTIyODY1MjBjNjk1ODgyZGY=","commit":{"author":{"name":"Francesco Chicchiriccò","email":"ilgrosso@apache.org","date":"2017-01-25T15:47:11Z"},"committer":{"name":"Francesco Chicchiriccò","email":"ilgrosso@apache.org","date":"2017-01-25T15:47:19Z"},"message":"Fixing LOG4J usage after version upgrade","tree":{"sha":"5d16651ae6bfecc56864481a1bf8950decc99602","url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/git/trees/5d16651ae6bfecc56864481a1bf8950decc99602"},"url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/git/commits/3fe7dc3edfe83d37981ae0c12286520c695882df","comment_count":0,"verification":{"verified":false,"reason":"unsigned","signature":null,"payload":null}},"url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/3fe7dc3edfe83d37981ae0c12286520c695882df","html_url":"https://github.com/EnricoDAlessandro97UNI/syncope/commit/3fe7dc3edfe83d37981ae0c12286520c695882df","comments_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/3fe7dc3edfe83d37981ae0c12286520c695882df/comments","author":{"login":"ilgrosso","id":1064664,"node_id":"MDQ6VXNlcjEwNjQ2NjQ=","avatar_url":"https://avatars.githubusercontent.com/u/1064664?v=4","gravatar_id":"","url":"https://api.github.com/users/ilgrosso","html_url":"https://github.com/ilgrosso","followers_url":"https://api.github.com/users/ilgrosso/followers","following_url":"https://api.github.com/users/ilgrosso/following{/other_user}","gists_url":"https://api.github.com/users/ilgrosso/gists{/gist_id}","starred_url":"https://api.github.com/users/ilgrosso/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ilgrosso/subscriptions","organizations_url":"https://api.github.com/users/ilgrosso/orgs","repos_url":"https://api.github.com/users/ilgrosso/repos","events_url":"https://api.github.com/users/ilgrosso/events{/privacy}","received_events_url":"https://api.github.com/users/ilgrosso/received_events","type":"User","site_admin":false},"committer":{"login":"ilgrosso","id":1064664,"node_id":"MDQ6VXNlcjEwNjQ2NjQ=","avatar_url":"https://avatars.githubusercontent.com/u/1064664?v=4","gravatar_id":"","url":"https://api.github.com/users/ilgrosso","html_url":"https://github.com/ilgrosso","followers_url":"https://api.github.com/users/ilgrosso/followers","following_url":"https://api.github.com/users/ilgrosso/following{/other_user}","gists_url":"https://api.github.com/users/ilgrosso/gists{/gist_id}","starred_url":"https://api.github.com/users/ilgrosso/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ilgrosso/subscriptions","organizations_url":"https://api.github.com/users/ilgrosso/orgs","repos_url":"https://api.github.com/users/ilgrosso/repos","events_url":"https://api.github.com/users/ilgrosso/events{/privacy}","received_events_url":"https://api.github.com/users/ilgrosso/received_events","type":"User","site_admin":false},"parents":[{"sha":"c864bfb8d9d609eb0bcff1789ece6d2db2ebe29c","url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/c864bfb8d9d609eb0bcff1789ece6d2db2ebe29c","html_url":"https://github.com/EnricoDAlessandro97UNI/syncope/commit/c864bfb8d9d609eb0bcff1789ece6d2db2ebe29c"}],"stats":{"total":36,"additions":22,"deletions":14},"files":[{"sha":"9ab3b7bd2a73d6ae808bd157f806cdcd4a2cbfed","filename":"core/logic/src/main/java/org/apache/syncope/core/logic/init/LoggerLoader.java","status":"modified","additions":22,"deletions":14,"changes":36,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/3fe7dc3edfe83d37981ae0c12286520c695882df/core%2Flogic%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Flogic%2Finit%2FLoggerLoader.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/3fe7dc3edfe83d37981ae0c12286520c695882df/core%2Flogic%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Flogic%2Finit%2FLoggerLoader.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Flogic%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Flogic%2Finit%2FLoggerLoader.java?ref=3fe7dc3edfe83d37981ae0c12286520c695882df","patch":"@@ -27,6 +27,7 @@\n import org.apache.logging.log4j.LogManager;\n import org.apache.logging.log4j.core.Appender;\n import org.apache.logging.log4j.core.LoggerContext;\n+import org.apache.logging.log4j.core.appender.db.ColumnMapping;\n import org.apache.logging.log4j.core.appender.db.jdbc.ColumnConfig;\n import org.apache.logging.log4j.core.appender.db.jdbc.ConnectionSource;\n import org.apache.logging.log4j.core.appender.db.jdbc.JdbcAppender;\n@@ -67,24 +68,31 @@ public void load() {\n         }\n \n         // Audit table and DataSource for each configured domain\n-        ColumnConfig[] columns = {\n-            ColumnConfig.createColumnConfig(ctx.getConfiguration(), \"EVENT_DATE\", null, null, \"true\", null, null),\n-            ColumnConfig.createColumnConfig(ctx.getConfiguration(), \"LOGGER_LEVEL\", \"%level\", null, null, null, null),\n-            ColumnConfig.createColumnConfig(ctx.getConfiguration(), \"LOGGER\", \"%logger\", null, null, null, null),\n-            ColumnConfig.createColumnConfig(ctx.getConfiguration(), \"MESSAGE\", \"%message\", null, null, null, null),\n-            ColumnConfig.createColumnConfig(ctx.getConfiguration(), \"THROWABLE\", \"%ex{full}\", null, null, null, null)\n+        ColumnConfig[] columnConfigs = {\n+            ColumnConfig.newBuilder().\n+            setConfiguration(ctx.getConfiguration()).setName(\"EVENT_DATE\").setEventTimestamp(true).build(),\n+            ColumnConfig.newBuilder().\n+            setConfiguration(ctx.getConfiguration()).setName(\"LOGGER_LEVEL\").setPattern(\"%level\").build(),\n+            ColumnConfig.newBuilder().\n+            setConfiguration(ctx.getConfiguration()).setName(\"LOGGER\").setPattern(\"%logger\").build(),\n+            ColumnConfig.newBuilder().\n+            setConfiguration(ctx.getConfiguration()).setName(\"MESSAGE\").setPattern(\"%message\").build(),\n+            ColumnConfig.newBuilder().\n+            setConfiguration(ctx.getConfiguration()).setName(\"THROWABLE\").setPattern(\"%ex{full}\").build()\n         };\n+        ColumnMapping[] columnMappings = new ColumnMapping[0];\n         for (Map.Entry<String, DataSource> entry : domainsHolder.getDomains().entrySet()) {\n             Appender appender = ctx.getConfiguration().getAppender(\"audit_for_\" + entry.getKey());\n             if (appender == null) {\n-                appender = JdbcAppender.createAppender(\n-                        \"audit_for_\" + entry.getKey(),\n-                        \"false\",\n-                        null,\n-                        new DataSourceConnectionSource(entry.getValue()),\n-                        \"0\",\n-                        \"SYNCOPEAUDIT\",\n-                        columns);\n+                appender = JdbcAppender.newBuilder().\n+                        withName(\"audit_for_\" + entry.getKey()).\n+                        withIgnoreExceptions(false).\n+                        setConnectionSource(new DataSourceConnectionSource(entry.getValue())).\n+                        setBufferSize(0).\n+                        setTableName(\"SYNCOPEAUDIT\").\n+                        setColumnConfigs(columnConfigs).\n+                        setColumnMappings(columnMappings).\n+                        build();\n                 appender.start();\n                 ctx.getConfiguration().addAppender(appender);\n             }"}]}