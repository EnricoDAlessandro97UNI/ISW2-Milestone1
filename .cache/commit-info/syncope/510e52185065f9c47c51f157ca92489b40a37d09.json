{"sha":"510e52185065f9c47c51f157ca92489b40a37d09","node_id":"MDY6Q29tbWl0NjM2ODc5MDYyOjUxMGU1MjE4NTA2NWY5YzQ3YzUxZjE1N2NhOTI0ODliNDBhMzdkMDk=","commit":{"author":{"name":"Francesco Chicchiriccò","email":"ilgrosso@apache.org","date":"2019-05-15T09:39:23Z"},"committer":{"name":"Francesco Chicchiriccò","email":"ilgrosso@apache.org","date":"2019-05-15T09:39:23Z"},"message":"[SYNCOPE-1459] Ensure to unregister services at shutdown","tree":{"sha":"7490a1cbdaebf1fda25a11cf4ea9a409a12d1896","url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/git/trees/7490a1cbdaebf1fda25a11cf4ea9a409a12d1896"},"url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/git/commits/510e52185065f9c47c51f157ca92489b40a37d09","comment_count":0,"verification":{"verified":false,"reason":"unsigned","signature":null,"payload":null}},"url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/510e52185065f9c47c51f157ca92489b40a37d09","html_url":"https://github.com/EnricoDAlessandro97UNI/syncope/commit/510e52185065f9c47c51f157ca92489b40a37d09","comments_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/510e52185065f9c47c51f157ca92489b40a37d09/comments","author":{"login":"ilgrosso","id":1064664,"node_id":"MDQ6VXNlcjEwNjQ2NjQ=","avatar_url":"https://avatars.githubusercontent.com/u/1064664?v=4","gravatar_id":"","url":"https://api.github.com/users/ilgrosso","html_url":"https://github.com/ilgrosso","followers_url":"https://api.github.com/users/ilgrosso/followers","following_url":"https://api.github.com/users/ilgrosso/following{/other_user}","gists_url":"https://api.github.com/users/ilgrosso/gists{/gist_id}","starred_url":"https://api.github.com/users/ilgrosso/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ilgrosso/subscriptions","organizations_url":"https://api.github.com/users/ilgrosso/orgs","repos_url":"https://api.github.com/users/ilgrosso/repos","events_url":"https://api.github.com/users/ilgrosso/events{/privacy}","received_events_url":"https://api.github.com/users/ilgrosso/received_events","type":"User","site_admin":false},"committer":{"login":"ilgrosso","id":1064664,"node_id":"MDQ6VXNlcjEwNjQ2NjQ=","avatar_url":"https://avatars.githubusercontent.com/u/1064664?v=4","gravatar_id":"","url":"https://api.github.com/users/ilgrosso","html_url":"https://github.com/ilgrosso","followers_url":"https://api.github.com/users/ilgrosso/followers","following_url":"https://api.github.com/users/ilgrosso/following{/other_user}","gists_url":"https://api.github.com/users/ilgrosso/gists{/gist_id}","starred_url":"https://api.github.com/users/ilgrosso/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ilgrosso/subscriptions","organizations_url":"https://api.github.com/users/ilgrosso/orgs","repos_url":"https://api.github.com/users/ilgrosso/repos","events_url":"https://api.github.com/users/ilgrosso/events{/privacy}","received_events_url":"https://api.github.com/users/ilgrosso/received_events","type":"User","site_admin":false},"parents":[{"sha":"07303b494ea41e2f85c7758c60fad5f8327eb200","url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/07303b494ea41e2f85c7758c60fad5f8327eb200","html_url":"https://github.com/EnricoDAlessandro97UNI/syncope/commit/07303b494ea41e2f85c7758c60fad5f8327eb200"}],"stats":{"total":279,"additions":249,"deletions":30},"files":[{"sha":"417422671b55c18f65a69ea824b2bb8ce7244e85","filename":"client/idrepo/console/src/main/java/org/apache/syncope/client/console/SyncopeWebApplication.java","status":"modified","additions":15,"deletions":4,"changes":19,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/510e52185065f9c47c51f157ca92489b40a37d09/client%2Fidrepo%2Fconsole%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fclient%2Fconsole%2FSyncopeWebApplication.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/510e52185065f9c47c51f157ca92489b40a37d09/client%2Fidrepo%2Fconsole%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fclient%2Fconsole%2FSyncopeWebApplication.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/client%2Fidrepo%2Fconsole%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fclient%2Fconsole%2FSyncopeWebApplication.java?ref=510e52185065f9c47c51f157ca92489b40a37d09","patch":"@@ -158,6 +158,13 @@ protected void populatePageClasses(final Properties props) {\n         }\n     }\n \n+    private NetworkService getNetworkService() {\n+        NetworkService ns = new NetworkService();\n+        ns.setType(NetworkService.Type.CONSOLE);\n+        ns.setAddress(address);\n+        return ns;\n+    }\n+\n     @Override\n     protected void init() {\n         super.init();\n@@ -289,10 +296,14 @@ public IResource getResource() {\n             getDebugSettings().setComponentPathAttributeName(\"syncope-path\");\n         }\n \n-        NetworkService ns = new NetworkService();\n-        ns.setType(NetworkService.Type.CONSOLE);\n-        ns.setAddress(address);\n-        serviceOps.register(ns);\n+        serviceOps.register(getNetworkService());\n+    }\n+\n+    @Override\n+    protected void onDestroy() {\n+        serviceOps.unregister(getNetworkService());\n+\n+        super.onDestroy();\n     }\n \n     @Override"},{"sha":"29b3931c5c222f0c6f2fe8d1ec2d73ea04859c9b","filename":"client/idrepo/enduser/src/main/java/org/apache/syncope/client/enduser/SyncopeWebApplication.java","status":"modified","additions":15,"deletions":6,"changes":21,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/510e52185065f9c47c51f157ca92489b40a37d09/client%2Fidrepo%2Fenduser%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fclient%2Fenduser%2FSyncopeWebApplication.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/510e52185065f9c47c51f157ca92489b40a37d09/client%2Fidrepo%2Fenduser%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fclient%2Fenduser%2FSyncopeWebApplication.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/client%2Fidrepo%2Fenduser%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fclient%2Fenduser%2FSyncopeWebApplication.java?ref=510e52185065f9c47c51f157ca92489b40a37d09","patch":"@@ -123,10 +123,15 @@ public static SyncopeWebApplication get() {\n \n     private Integer maxUploadFileSizeMB;\n \n-    private List<String> domains;\n-\n     private Map<String, CustomAttributesInfo> customFormAttributes;\n \n+    private NetworkService getNetworkService() {\n+        NetworkService ns = new NetworkService();\n+        ns.setType(NetworkService.Type.ENDUSER);\n+        ns.setAddress(address);\n+        return ns;\n+    }\n+\n     @Override\n     protected void init() {\n         super.init();\n@@ -299,10 +304,14 @@ public IResource getResource() {\n             getDebugSettings().setComponentPathAttributeName(\"syncope-path\");\n         }\n \n-        NetworkService ns = new NetworkService();\n-        ns.setType(NetworkService.Type.ENDUSER);\n-        ns.setAddress(address);\n-        serviceOps.register(ns);\n+        serviceOps.register(getNetworkService());\n+    }\n+\n+    @Override\n+    protected void onDestroy() {\n+        serviceOps.unregister(getNetworkService());\n+\n+        super.onDestroy();\n     }\n \n     @Override"},{"sha":"256607e0fa8a7f4e5b45066990de5cb535a3edc4","filename":"core/starter/src/main/java/org/apache/syncope/core/starter/SyncopeCoreShutdown.java","status":"added","additions":36,"deletions":0,"changes":36,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/510e52185065f9c47c51f157ca92489b40a37d09/core%2Fstarter%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fstarter%2FSyncopeCoreShutdown.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/510e52185065f9c47c51f157ca92489b40a37d09/core%2Fstarter%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fstarter%2FSyncopeCoreShutdown.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fstarter%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fstarter%2FSyncopeCoreShutdown.java?ref=510e52185065f9c47c51f157ca92489b40a37d09","patch":"@@ -0,0 +1,36 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *   http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+package org.apache.syncope.core.starter;\n+\n+import org.springframework.context.ApplicationListener;\n+import org.springframework.context.event.ContextClosedEvent;\n+import org.springframework.stereotype.Component;\n+\n+/**\n+ * Take care of cleanup actions needed by Syncope Core.\n+ */\n+@Component\n+public class SyncopeCoreShutdown extends SyncopeCoreStartStop\n+        implements ApplicationListener<ContextClosedEvent> {\n+\n+    @Override\n+    public void onApplicationEvent(final ContextClosedEvent event) {\n+        serviceOps.unregister(getNetworkService());\n+    }\n+}"},{"sha":"7f52923812cb93541dcb745a18f2dac6cb71da7b","filename":"core/starter/src/main/java/org/apache/syncope/core/starter/SyncopeCoreStartStop.java","status":"added","additions":40,"deletions":0,"changes":40,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/510e52185065f9c47c51f157ca92489b40a37d09/core%2Fstarter%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fstarter%2FSyncopeCoreStartStop.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/510e52185065f9c47c51f157ca92489b40a37d09/core%2Fstarter%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fstarter%2FSyncopeCoreStartStop.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fstarter%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fstarter%2FSyncopeCoreStartStop.java?ref=510e52185065f9c47c51f157ca92489b40a37d09","patch":"@@ -0,0 +1,40 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *   http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+package org.apache.syncope.core.starter;\n+\n+import org.apache.syncope.common.keymaster.client.api.ServiceOps;\n+import org.apache.syncope.common.keymaster.client.api.model.NetworkService;\n+import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.beans.factory.annotation.Value;\n+\n+abstract class SyncopeCoreStartStop {\n+\n+    @Autowired\n+    protected ServiceOps serviceOps;\n+\n+    @Value(\"${service.discovery.address}\")\n+    private String address;\n+\n+    protected NetworkService getNetworkService() {\n+        NetworkService ns = new NetworkService();\n+        ns.setType(NetworkService.Type.CORE);\n+        ns.setAddress(address);\n+        return ns;\n+    }\n+}"},{"sha":"a1d130aa6e12615b49b78a08bf41e38396e827ae","filename":"core/starter/src/main/java/org/apache/syncope/core/starter/SyncopeCoreStartup.java","status":"renamed","additions":4,"deletions":15,"changes":19,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/510e52185065f9c47c51f157ca92489b40a37d09/core%2Fstarter%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fstarter%2FSyncopeCoreStartup.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/510e52185065f9c47c51f157ca92489b40a37d09/core%2Fstarter%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fstarter%2FSyncopeCoreStartup.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fstarter%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fstarter%2FSyncopeCoreStartup.java?ref=510e52185065f9c47c51f157ca92489b40a37d09","patch":"@@ -19,15 +19,12 @@\n package org.apache.syncope.core.starter;\n \n import java.util.Comparator;\n-import org.apache.syncope.common.keymaster.client.api.model.NetworkService;\n-import org.apache.syncope.common.keymaster.client.api.ServiceOps;\n import org.apache.syncope.core.persistence.api.DomainHolder;\n import org.apache.syncope.core.persistence.api.SyncopeCoreLoader;\n import org.slf4j.Logger;\n import org.slf4j.LoggerFactory;\n import org.springframework.aop.support.AopUtils;\n import org.springframework.beans.factory.annotation.Autowired;\n-import org.springframework.beans.factory.annotation.Value;\n import org.springframework.context.ApplicationListener;\n import org.springframework.context.event.ContextRefreshedEvent;\n import org.springframework.core.Ordered;\n@@ -37,19 +34,14 @@\n  * Take care of all initializations needed by Syncope Core to run up and safe.\n  */\n @Component\n-public class SyncopeCoreInitializer implements ApplicationListener<ContextRefreshedEvent>, Ordered {\n+public class SyncopeCoreStartup extends SyncopeCoreStartStop\n+        implements ApplicationListener<ContextRefreshedEvent>, Ordered {\n \n-    private static final Logger LOG = LoggerFactory.getLogger(SyncopeCoreInitializer.class);\n+    private static final Logger LOG = LoggerFactory.getLogger(SyncopeCoreStartup.class);\n \n     @Autowired\n     private DomainHolder domainHolder;\n \n-    @Autowired\n-    private ServiceOps serviceOps;\n-\n-    @Value(\"${service.discovery.address}\")\n-    private String address;\n-\n     @Override\n     public int getOrder() {\n         return 0;\n@@ -75,9 +67,6 @@ public void onApplicationEvent(final ContextRefreshedEvent event) {\n                     LOG.debug(\"[{}] Initialization completed\", loaderName);\n                 });\n \n-        NetworkService ns = new NetworkService();\n-        ns.setType(NetworkService.Type.CORE);\n-        ns.setAddress(address);\n-        serviceOps.register(ns);\n+        serviceOps.register(getNetworkService());\n     }\n }","previous_filename":"core/starter/src/main/java/org/apache/syncope/core/starter/SyncopeCoreInitializer.java"},{"sha":"56fad285b4a21019bb85fc6bb3a7a7d2484ac85c","filename":"ext/self-keymaster/client/src/main/java/org/apache/syncope/common/keymaster/client/self/SelfKeymasterServiceOps.java","status":"modified","additions":2,"deletions":2,"changes":4,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/510e52185065f9c47c51f157ca92489b40a37d09/ext%2Fself-keymaster%2Fclient%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcommon%2Fkeymaster%2Fclient%2Fself%2FSelfKeymasterServiceOps.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/510e52185065f9c47c51f157ca92489b40a37d09/ext%2Fself-keymaster%2Fclient%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcommon%2Fkeymaster%2Fclient%2Fself%2FSelfKeymasterServiceOps.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/ext%2Fself-keymaster%2Fclient%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcommon%2Fkeymaster%2Fclient%2Fself%2FSelfKeymasterServiceOps.java?ref=510e52185065f9c47c51f157ca92489b40a37d09","patch":"@@ -85,7 +85,7 @@ private void handleRetry(\n             final BackOffExecution backOffExecution) {\n \n         try {\n-            if (retries > 0) {\n+            if (action == Action.register && retries > 0) {\n                 long nextBackoff = backOffExecution.nextBackOff();\n \n                 LOG.debug(\"Still {} retries available for {}; waiting for {} ms\", retries, service, nextBackoff);\n@@ -97,7 +97,7 @@ private void handleRetry(\n \n                 retry(completionStage(action, service), service, action, retries - 1, backOffExecution);\n             } else {\n-                LOG.debug(\"No more retries for {}\", service);\n+                LOG.debug(\"No more retries {} for {}\", action, service);\n             }\n         } catch (Throwable t) {\n             LOG.error(\"Could not continue {} for {}, aborting\", action, service, t);"},{"sha":"b9df9a8896957f6e9209e15c5abc9ed3b1295bb2","filename":"sra/pom.xml","status":"modified","additions":12,"deletions":1,"changes":13,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/510e52185065f9c47c51f157ca92489b40a37d09/sra%2Fpom.xml","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/510e52185065f9c47c51f157ca92489b40a37d09/sra%2Fpom.xml","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/sra%2Fpom.xml?ref=510e52185065f9c47c51f157ca92489b40a37d09","patch":"@@ -76,6 +76,17 @@ under the License.\n       <artifactId>micrometer-registry-prometheus</artifactId>\n     </dependency>\n \n+    <dependency>\n+      <groupId>org.apache.syncope.ext.self-keymaster</groupId>\n+      <artifactId>syncope-ext-self-keymaster-client</artifactId>\n+      <version>${project.version}</version>\n+    </dependency>\n+    <dependency>\n+      <groupId>org.apache.syncope.common.keymaster</groupId>\n+      <artifactId>syncope-common-keymaster-client-zookeeper</artifactId>\n+      <version>${project.version}</version>\n+    </dependency>\n+\n     <dependency>\n       <groupId>org.apache.syncope.client.am</groupId>\n       <artifactId>syncope-client-am-lib</artifactId>\n@@ -130,7 +141,7 @@ under the License.\n         <groupId>org.springframework.boot</groupId>\n         <artifactId>spring-boot-maven-plugin</artifactId>\n         <configuration>\n-          <mainClass>org.apache.syncope.sra.SyncopeRemoteAccessApplication</mainClass>\n+          <mainClass>org.apache.syncope.sra.SyncopeSRAApplication</mainClass>\n         </configuration>\n         <executions>\n           <execution>"},{"sha":"09c620decdbf12a6d11396fc638df25dc080696c","filename":"sra/src/main/java/org/apache/syncope/sra/SyncopeSRAApplication.java","status":"renamed","additions":2,"deletions":2,"changes":4,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/510e52185065f9c47c51f157ca92489b40a37d09/sra%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fsra%2FSyncopeSRAApplication.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/510e52185065f9c47c51f157ca92489b40a37d09/sra%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fsra%2FSyncopeSRAApplication.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/sra%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fsra%2FSyncopeSRAApplication.java?ref=510e52185065f9c47c51f157ca92489b40a37d09","patch":"@@ -25,10 +25,10 @@\n import org.springframework.context.annotation.Bean;\n \n @SpringBootApplication\n-public class SyncopeRemoteAccessApplication {\n+public class SyncopeSRAApplication {\n \n     public static void main(final String[] args) {\n-        SpringApplication.run(SyncopeRemoteAccessApplication.class, args);\n+        SpringApplication.run(SyncopeSRAApplication.class, args);\n     }\n \n     @Bean","previous_filename":"sra/src/main/java/org/apache/syncope/sra/SyncopeRemoteAccessApplication.java"},{"sha":"d33583638b4bcf114e6413275537033e63ef0a11","filename":"sra/src/main/java/org/apache/syncope/sra/SyncopeSRAShutdown.java","status":"added","additions":31,"deletions":0,"changes":31,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/510e52185065f9c47c51f157ca92489b40a37d09/sra%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fsra%2FSyncopeSRAShutdown.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/510e52185065f9c47c51f157ca92489b40a37d09/sra%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fsra%2FSyncopeSRAShutdown.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/sra%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fsra%2FSyncopeSRAShutdown.java?ref=510e52185065f9c47c51f157ca92489b40a37d09","patch":"@@ -0,0 +1,31 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *   http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+package org.apache.syncope.sra;\n+\n+import org.springframework.context.ApplicationListener;\n+import org.springframework.context.event.ContextClosedEvent;\n+\n+public class SyncopeSRAShutdown extends SyncopeSRAStartStop\n+        implements ApplicationListener<ContextClosedEvent> {\n+\n+    @Override\n+    public void onApplicationEvent(final ContextClosedEvent event) {\n+        serviceOps.unregister(getNetworkService());\n+    }\n+}"},{"sha":"926a6083abc96e90f4afbe7f400aaf020ac30dd6","filename":"sra/src/main/java/org/apache/syncope/sra/SyncopeSRAStartStop.java","status":"added","additions":40,"deletions":0,"changes":40,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/510e52185065f9c47c51f157ca92489b40a37d09/sra%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fsra%2FSyncopeSRAStartStop.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/510e52185065f9c47c51f157ca92489b40a37d09/sra%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fsra%2FSyncopeSRAStartStop.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/sra%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fsra%2FSyncopeSRAStartStop.java?ref=510e52185065f9c47c51f157ca92489b40a37d09","patch":"@@ -0,0 +1,40 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *   http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+package org.apache.syncope.sra;\n+\n+import org.apache.syncope.common.keymaster.client.api.ServiceOps;\n+import org.apache.syncope.common.keymaster.client.api.model.NetworkService;\n+import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.beans.factory.annotation.Value;\n+\n+abstract class SyncopeSRAStartStop {\n+\n+    @Autowired\n+    protected ServiceOps serviceOps;\n+\n+    @Value(\"${service.discovery.address}\")\n+    private String address;\n+\n+    protected NetworkService getNetworkService() {\n+        NetworkService ns = new NetworkService();\n+        ns.setType(NetworkService.Type.SRA);\n+        ns.setAddress(address);\n+        return ns;\n+    }\n+}"},{"sha":"08ea447dd298603eda96d45d807e4af47cba5f9f","filename":"sra/src/main/java/org/apache/syncope/sra/SyncopeSRAStartup.java","status":"added","additions":31,"deletions":0,"changes":31,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/510e52185065f9c47c51f157ca92489b40a37d09/sra%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fsra%2FSyncopeSRAStartup.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/510e52185065f9c47c51f157ca92489b40a37d09/sra%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fsra%2FSyncopeSRAStartup.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/sra%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fsra%2FSyncopeSRAStartup.java?ref=510e52185065f9c47c51f157ca92489b40a37d09","patch":"@@ -0,0 +1,31 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *   http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+package org.apache.syncope.sra;\n+\n+import org.springframework.context.ApplicationListener;\n+import org.springframework.context.event.ContextRefreshedEvent;\n+\n+public class SyncopeSRAStartup extends SyncopeSRAStartStop\n+        implements ApplicationListener<ContextRefreshedEvent> {\n+\n+    @Override\n+    public void onApplicationEvent(final ContextRefreshedEvent event) {\n+        serviceOps.register(getNetworkService());\n+    }\n+}"},{"sha":"98bc964e357458f50363af81dc5398de4d0995cd","filename":"sra/src/main/resources/application.properties","status":"modified","additions":2,"deletions":0,"changes":2,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/510e52185065f9c47c51f157ca92489b40a37d09/sra%2Fsrc%2Fmain%2Fresources%2Fapplication.properties","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/510e52185065f9c47c51f157ca92489b40a37d09/sra%2Fsrc%2Fmain%2Fresources%2Fapplication.properties","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/sra%2Fsrc%2Fmain%2Fresources%2Fapplication.properties?ref=510e52185065f9c47c51f157ca92489b40a37d09","patch":"@@ -28,3 +28,5 @@ management.endpoint.metrics.enabled=true\n management.endpoints.web.exposure.include=*\n management.endpoint.prometheus.enabled=true\n management.metrics.export.prometheus.enabled=true\n+\n+service.discovery.address=http://localhost:8080/"},{"sha":"033fe3b8cdc122c28c9d2c96c62b4aaeab664fc4","filename":"sra/src/main/resources/keymaster.properties","status":"added","additions":19,"deletions":0,"changes":19,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/510e52185065f9c47c51f157ca92489b40a37d09/sra%2Fsrc%2Fmain%2Fresources%2Fkeymaster.properties","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/510e52185065f9c47c51f157ca92489b40a37d09/sra%2Fsrc%2Fmain%2Fresources%2Fkeymaster.properties","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/sra%2Fsrc%2Fmain%2Fresources%2Fkeymaster.properties?ref=510e52185065f9c47c51f157ca92489b40a37d09","patch":"@@ -0,0 +1,19 @@\n+# Licensed to the Apache Software Foundation (ASF) under one\n+# or more contributor license agreements.  See the NOTICE file\n+# distributed with this work for additional information\n+# regarding copyright ownership.  The ASF licenses this file\n+# to you under the Apache License, Version 2.0 (the\n+# \"License\"); you may not use this file except in compliance\n+# with the License.  You may obtain a copy of the License at\n+#\n+#   http://www.apache.org/licenses/LICENSE-2.0\n+#\n+# Unless required by applicable law or agreed to in writing,\n+# software distributed under the License is distributed on an\n+# \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+# KIND, either express or implied.  See the License for the\n+# specific language governing permissions and limitations\n+# under the License.\n+keymaster.address=http://localhost:9080/syncope/rest/keymaster\n+keymaster.username=${anonymousUser}\n+keymaster.password=${anonymousKey}"}]}