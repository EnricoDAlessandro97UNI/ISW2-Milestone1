{"sha":"60d33e9c1b655d9d59da3f3bf4bdcfb4dba6d7cc","node_id":"C_kwDOJfYA1toAKDYwZDMzZTljMWI2NTVkOWQ1OWRhM2YzYmY0YmRjZmI0ZGJhNmQ3Y2M","commit":{"author":{"name":"Samuel Garofalo","email":"72073457+SamuelGaro@users.noreply.github.com","date":"2023-02-24T06:57:40Z"},"committer":{"name":"Francesco Chicchiricc√≤","email":"ilgrosso@apache.org","date":"2023-02-24T07:28:36Z"},"message":"[SYNCOPE-1734] create ES event also for attribute mapped like uidOnCreate","tree":{"sha":"de6a8081033fb5402984555864a9da9421a8ad4e","url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/git/trees/de6a8081033fb5402984555864a9da9421a8ad4e"},"url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/git/commits/60d33e9c1b655d9d59da3f3bf4bdcfb4dba6d7cc","comment_count":0,"verification":{"verified":false,"reason":"unsigned","signature":null,"payload":null}},"url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/60d33e9c1b655d9d59da3f3bf4bdcfb4dba6d7cc","html_url":"https://github.com/EnricoDAlessandro97UNI/syncope/commit/60d33e9c1b655d9d59da3f3bf4bdcfb4dba6d7cc","comments_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/60d33e9c1b655d9d59da3f3bf4bdcfb4dba6d7cc/comments","author":{"login":"SamuelGaro","id":72073457,"node_id":"MDQ6VXNlcjcyMDczNDU3","avatar_url":"https://avatars.githubusercontent.com/u/72073457?v=4","gravatar_id":"","url":"https://api.github.com/users/SamuelGaro","html_url":"https://github.com/SamuelGaro","followers_url":"https://api.github.com/users/SamuelGaro/followers","following_url":"https://api.github.com/users/SamuelGaro/following{/other_user}","gists_url":"https://api.github.com/users/SamuelGaro/gists{/gist_id}","starred_url":"https://api.github.com/users/SamuelGaro/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/SamuelGaro/subscriptions","organizations_url":"https://api.github.com/users/SamuelGaro/orgs","repos_url":"https://api.github.com/users/SamuelGaro/repos","events_url":"https://api.github.com/users/SamuelGaro/events{/privacy}","received_events_url":"https://api.github.com/users/SamuelGaro/received_events","type":"User","site_admin":false},"committer":{"login":"ilgrosso","id":1064664,"node_id":"MDQ6VXNlcjEwNjQ2NjQ=","avatar_url":"https://avatars.githubusercontent.com/u/1064664?v=4","gravatar_id":"","url":"https://api.github.com/users/ilgrosso","html_url":"https://github.com/ilgrosso","followers_url":"https://api.github.com/users/ilgrosso/followers","following_url":"https://api.github.com/users/ilgrosso/following{/other_user}","gists_url":"https://api.github.com/users/ilgrosso/gists{/gist_id}","starred_url":"https://api.github.com/users/ilgrosso/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ilgrosso/subscriptions","organizations_url":"https://api.github.com/users/ilgrosso/orgs","repos_url":"https://api.github.com/users/ilgrosso/repos","events_url":"https://api.github.com/users/ilgrosso/events{/privacy}","received_events_url":"https://api.github.com/users/ilgrosso/received_events","type":"User","site_admin":false},"parents":[{"sha":"57dcda6b4d9293404dac413eb8eff8c6c736139a","url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/57dcda6b4d9293404dac413eb8eff8c6c736139a","html_url":"https://github.com/EnricoDAlessandro97UNI/syncope/commit/57dcda6b4d9293404dac413eb8eff8c6c736139a"}],"stats":{"total":35,"additions":27,"deletions":8},"files":[{"sha":"e45a4df6fbe1f1ac977f1cd32109fa80a4efe8e1","filename":"core/provisioning-java/src/main/java/org/apache/syncope/core/provisioning/java/ProvisioningContext.java","status":"modified","additions":3,"deletions":1,"changes":4,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/60d33e9c1b655d9d59da3f3bf4bdcfb4dba6d7cc/core%2Fprovisioning-java%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fprovisioning%2Fjava%2FProvisioningContext.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/60d33e9c1b655d9d59da3f3bf4bdcfb4dba6d7cc/core%2Fprovisioning-java%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fprovisioning%2Fjava%2FProvisioningContext.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fprovisioning-java%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fprovisioning%2Fjava%2FProvisioningContext.java?ref=60d33e9c1b655d9d59da3f3bf4bdcfb4dba6d7cc","patch":"@@ -567,7 +567,8 @@ public PropagationTaskExecutor propagationTaskExecutor(\n             final AuditManager auditManager,\n             final TaskDataBinder taskDataBinder,\n             final OutboundMatcher outboundMatcher,\n-            final PlainAttrValidationManager validator) {\n+            final PlainAttrValidationManager validator,\n+            final ApplicationEventPublisher publisher) {\n \n         return new PriorityPropagationTaskExecutor(\n                 connectorManager,\n@@ -585,6 +586,7 @@ public PropagationTaskExecutor propagationTaskExecutor(\n                 taskUtilsFactory,\n                 outboundMatcher,\n                 validator,\n+                publisher,\n                 propagationTaskExecutorAsyncExecutor);\n     }\n "},{"sha":"4ced18a1b6363809fd0564b359380358b72633d7","filename":"core/provisioning-java/src/main/java/org/apache/syncope/core/provisioning/java/propagation/AbstractPropagationTaskExecutor.java","status":"modified","additions":20,"deletions":6,"changes":26,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/60d33e9c1b655d9d59da3f3bf4bdcfb4dba6d7cc/core%2Fprovisioning-java%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fprovisioning%2Fjava%2Fpropagation%2FAbstractPropagationTaskExecutor.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/60d33e9c1b655d9d59da3f3bf4bdcfb4dba6d7cc/core%2Fprovisioning-java%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fprovisioning%2Fjava%2Fpropagation%2FAbstractPropagationTaskExecutor.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fprovisioning-java%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fprovisioning%2Fjava%2Fpropagation%2FAbstractPropagationTaskExecutor.java?ref=60d33e9c1b655d9d59da3f3bf4bdcfb4dba6d7cc","patch":"@@ -60,6 +60,7 @@\n import org.apache.syncope.core.provisioning.api.ConnectorManager;\n import org.apache.syncope.core.provisioning.api.TimeoutException;\n import org.apache.syncope.core.provisioning.api.data.TaskDataBinder;\n+import org.apache.syncope.core.provisioning.api.event.AnyLifecycleEvent;\n import org.apache.syncope.core.provisioning.api.notification.NotificationManager;\n import org.apache.syncope.core.provisioning.api.propagation.PropagationActions;\n import org.apache.syncope.core.provisioning.api.propagation.PropagationManager;\n@@ -81,9 +82,11 @@\n import org.identityconnectors.framework.common.objects.ConnectorObjectBuilder;\n import org.identityconnectors.framework.common.objects.Name;\n import org.identityconnectors.framework.common.objects.ObjectClass;\n+import org.identityconnectors.framework.common.objects.SyncDeltaType;\n import org.identityconnectors.framework.common.objects.Uid;\n import org.slf4j.Logger;\n import org.slf4j.LoggerFactory;\n+import org.springframework.context.ApplicationEventPublisher;\n import org.springframework.retry.RetryException;\n import org.springframework.retry.backoff.ExponentialBackOffPolicy;\n import org.springframework.retry.backoff.ExponentialRandomBackOffPolicy;\n@@ -129,6 +132,8 @@ public abstract class AbstractPropagationTaskExecutor implements PropagationTask\n \n     protected final PlainAttrValidationManager validator;\n \n+    protected final ApplicationEventPublisher publisher;\n+\n     protected final Map<String, PropagationActions> perContextActions = new ConcurrentHashMap<>();\n \n     public AbstractPropagationTaskExecutor(\n@@ -146,7 +151,8 @@ public AbstractPropagationTaskExecutor(\n             final AnyUtilsFactory anyUtilsFactory,\n             final TaskUtilsFactory taskUtilsFactory,\n             final OutboundMatcher outboundMatcher,\n-            final PlainAttrValidationManager validator) {\n+            final PlainAttrValidationManager validator,\n+            final ApplicationEventPublisher publisher) {\n \n         this.connectorManager = connectorManager;\n         this.connObjectUtils = connObjectUtils;\n@@ -163,6 +169,7 @@ public AbstractPropagationTaskExecutor(\n         this.taskUtilsFactory = taskUtilsFactory;\n         this.outboundMatcher = outboundMatcher;\n         this.validator = validator;\n+        this.publisher = publisher;\n     }\n \n     @Override\n@@ -199,11 +206,18 @@ protected Uid doCreate(\n \n         taskInfo.getResource().getProvisionByAnyType(taskInfo.getAnyType()).\n                 filter(provision -> provision.getUidOnCreate() != null).\n-                ifPresent(provision -> anyUtilsFactory.getInstance(taskInfo.getAnyTypeKind()).addAttr(\n-                validator,\n-                taskInfo.getEntityKey(),\n-                plainSchemaDAO.find(provision.getUidOnCreate()),\n-                result.getUidValue()));\n+                ifPresent(provision -> {\n+                    anyUtilsFactory.getInstance(taskInfo.getAnyTypeKind()).addAttr(\n+                            validator,\n+                            taskInfo.getEntityKey(),\n+                            plainSchemaDAO.find(provision.getUidOnCreate()),\n+                            result.getUidValue());\n+                    publisher.publishEvent(new AnyLifecycleEvent<>(\n+                            this,\n+                            SyncDeltaType.UPDATE,\n+                            userDAO.find(taskInfo.getEntityKey()),\n+                            AuthContextUtils.getDomain()));\n+                });\n \n         return result;\n     }"},{"sha":"cd8c6aae381e9c78bc4350870e3693d074df0ad3","filename":"core/provisioning-java/src/main/java/org/apache/syncope/core/provisioning/java/propagation/PriorityPropagationTaskExecutor.java","status":"modified","additions":4,"deletions":1,"changes":5,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/60d33e9c1b655d9d59da3f3bf4bdcfb4dba6d7cc/core%2Fprovisioning-java%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fprovisioning%2Fjava%2Fpropagation%2FPriorityPropagationTaskExecutor.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/60d33e9c1b655d9d59da3f3bf4bdcfb4dba6d7cc/core%2Fprovisioning-java%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fprovisioning%2Fjava%2Fpropagation%2FPriorityPropagationTaskExecutor.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fprovisioning-java%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fprovisioning%2Fjava%2Fpropagation%2FPriorityPropagationTaskExecutor.java?ref=60d33e9c1b655d9d59da3f3bf4bdcfb4dba6d7cc","patch":"@@ -52,6 +52,7 @@\n import org.apache.syncope.core.provisioning.java.utils.ConnObjectUtils;\n import org.apache.syncope.core.spring.ApplicationContextProvider;\n import org.springframework.beans.factory.support.AbstractBeanDefinition;\n+import org.springframework.context.ApplicationEventPublisher;\n import org.springframework.scheduling.concurrent.ThreadPoolTaskExecutor;\n \n /**\n@@ -103,6 +104,7 @@ public PriorityPropagationTaskExecutor(\n             final TaskUtilsFactory taskUtilsFactory,\n             final OutboundMatcher outboundMatcher,\n             final PlainAttrValidationManager validator,\n+            final ApplicationEventPublisher publisher,\n             final ThreadPoolTaskExecutor taskExecutor) {\n \n         super(connectorManager,\n@@ -119,7 +121,8 @@ public PriorityPropagationTaskExecutor(\n                 anyUtilsFactory,\n                 taskUtilsFactory,\n                 outboundMatcher,\n-                validator);\n+                validator,\n+                publisher);\n         this.taskExecutor = taskExecutor;\n     }\n "}]}