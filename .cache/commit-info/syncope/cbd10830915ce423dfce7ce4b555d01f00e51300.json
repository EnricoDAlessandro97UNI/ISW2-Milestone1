{"sha":"cbd10830915ce423dfce7ce4b555d01f00e51300","node_id":"MDY6Q29tbWl0NjM2ODc5MDYyOmNiZDEwODMwOTE1Y2U0MjNkZmNlN2NlNGI1NTVkMDFmMDBlNTEzMDA=","commit":{"author":{"name":"Marco Di Sabatino Di Diodoro","email":"marco.disabatino@tirasa.net","date":"2017-05-17T11:19:54Z"},"committer":{"name":"Marco Di Sabatino Di Diodoro","email":"marco.disabatino@tirasa.net","date":"2017-05-17T11:22:01Z"},"message":"[SYNCOPE-1083] Normalizing ConnInstance location","tree":{"sha":"3d79563b17b48c230e5e837cfc27eca064360342","url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/git/trees/3d79563b17b48c230e5e837cfc27eca064360342"},"url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/git/commits/cbd10830915ce423dfce7ce4b555d01f00e51300","comment_count":0,"verification":{"verified":false,"reason":"unsigned","signature":null,"payload":null}},"url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/cbd10830915ce423dfce7ce4b555d01f00e51300","html_url":"https://github.com/EnricoDAlessandro97UNI/syncope/commit/cbd10830915ce423dfce7ce4b555d01f00e51300","comments_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/cbd10830915ce423dfce7ce4b555d01f00e51300/comments","author":{"login":"mdisabatino","id":1792527,"node_id":"MDQ6VXNlcjE3OTI1Mjc=","avatar_url":"https://avatars.githubusercontent.com/u/1792527?v=4","gravatar_id":"","url":"https://api.github.com/users/mdisabatino","html_url":"https://github.com/mdisabatino","followers_url":"https://api.github.com/users/mdisabatino/followers","following_url":"https://api.github.com/users/mdisabatino/following{/other_user}","gists_url":"https://api.github.com/users/mdisabatino/gists{/gist_id}","starred_url":"https://api.github.com/users/mdisabatino/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mdisabatino/subscriptions","organizations_url":"https://api.github.com/users/mdisabatino/orgs","repos_url":"https://api.github.com/users/mdisabatino/repos","events_url":"https://api.github.com/users/mdisabatino/events{/privacy}","received_events_url":"https://api.github.com/users/mdisabatino/received_events","type":"User","site_admin":false},"committer":{"login":"mdisabatino","id":1792527,"node_id":"MDQ6VXNlcjE3OTI1Mjc=","avatar_url":"https://avatars.githubusercontent.com/u/1792527?v=4","gravatar_id":"","url":"https://api.github.com/users/mdisabatino","html_url":"https://github.com/mdisabatino","followers_url":"https://api.github.com/users/mdisabatino/followers","following_url":"https://api.github.com/users/mdisabatino/following{/other_user}","gists_url":"https://api.github.com/users/mdisabatino/gists{/gist_id}","starred_url":"https://api.github.com/users/mdisabatino/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mdisabatino/subscriptions","organizations_url":"https://api.github.com/users/mdisabatino/orgs","repos_url":"https://api.github.com/users/mdisabatino/repos","events_url":"https://api.github.com/users/mdisabatino/events{/privacy}","received_events_url":"https://api.github.com/users/mdisabatino/received_events","type":"User","site_admin":false},"parents":[{"sha":"74bf00b470d44824d0dd2e539afb4015552b36ec","url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/74bf00b470d44824d0dd2e539afb4015552b36ec","html_url":"https://github.com/EnricoDAlessandro97UNI/syncope/commit/74bf00b470d44824d0dd2e539afb4015552b36ec"}],"stats":{"total":20,"additions":13,"deletions":7},"files":[{"sha":"1913e688179d696db474b1280a25058927ad4859","filename":"core/provisioning-api/src/main/java/org/apache/syncope/core/provisioning/api/ConnIdBundleManager.java","status":"modified","additions":2,"deletions":1,"changes":3,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/cbd10830915ce423dfce7ce4b555d01f00e51300/core%2Fprovisioning-api%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fprovisioning%2Fapi%2FConnIdBundleManager.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/cbd10830915ce423dfce7ce4b555d01f00e51300/core%2Fprovisioning-api%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fprovisioning%2Fapi%2FConnIdBundleManager.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fprovisioning-api%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fprovisioning%2Fapi%2FConnIdBundleManager.java?ref=cbd10830915ce423dfce7ce4b555d01f00e51300","patch":"@@ -21,6 +21,7 @@\n import java.net.URI;\n import java.util.List;\n import java.util.Map;\n+import org.apache.commons.lang3.tuple.Pair;\n import org.apache.syncope.core.persistence.api.entity.ConnInstance;\n import org.identityconnectors.framework.api.ConfigurationProperties;\n import org.identityconnectors.framework.api.ConnectorInfo;\n@@ -35,7 +36,7 @@ public interface ConnIdBundleManager {\n \n     Map<URI, ConnectorInfoManager> getConnManagers();\n \n-    ConnectorInfo getConnectorInfo(ConnInstance connInstance);\n+    Pair<URI, ConnectorInfo> getConnectorInfo(ConnInstance connInstance);\n \n     Map<URI, ConnectorInfoManager> getConnInfoManagers();\n "},{"sha":"69e1049a44f814d95e80f1d9fe5d738154e43a9a","filename":"core/provisioning-java/src/main/java/org/apache/syncope/core/provisioning/java/ConnIdBundleManagerImpl.java","status":"modified","additions":3,"deletions":2,"changes":5,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/cbd10830915ce423dfce7ce4b555d01f00e51300/core%2Fprovisioning-java%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fprovisioning%2Fjava%2FConnIdBundleManagerImpl.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/cbd10830915ce423dfce7ce4b555d01f00e51300/core%2Fprovisioning-java%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fprovisioning%2Fjava%2FConnIdBundleManagerImpl.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fprovisioning-java%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fprovisioning%2Fjava%2FConnIdBundleManagerImpl.java?ref=cbd10830915ce423dfce7ce4b555d01f00e51300","patch":"@@ -32,6 +32,7 @@\n import javax.net.ssl.TrustManager;\n import javax.net.ssl.X509TrustManager;\n import org.apache.commons.lang3.StringUtils;\n+import org.apache.commons.lang3.tuple.Pair;\n import org.apache.syncope.core.persistence.api.dao.NotFoundException;\n import org.apache.syncope.core.persistence.api.entity.ConnInstance;\n import org.apache.syncope.core.provisioning.api.ConnIdBundleManager;\n@@ -224,7 +225,7 @@ public Map<URI, ConnectorInfoManager> getConnManagers() {\n     }\n \n     @Override\n-    public ConnectorInfo getConnectorInfo(final ConnInstance connInstance) {\n+    public Pair<URI, ConnectorInfo> getConnectorInfo(final ConnInstance connInstance) {\n         // check ConnIdLocation\n         URI uriLocation = null;\n         try {\n@@ -252,7 +253,7 @@ public ConnectorInfo getConnectorInfo(final ConnInstance connInstance) {\n             throw new NotFoundException(\"ConnectorInfo for location \" + connInstance.getLocation() + \" and key \" + key);\n         }\n \n-        return info;\n+        return Pair.of(uriLocation, info);\n     }\n \n     @Override"},{"sha":"a8024f28f725694edd01a6e1e9ec34884fe2df2b","filename":"core/provisioning-java/src/main/java/org/apache/syncope/core/provisioning/java/ConnectorFacadeProxy.java","status":"modified","additions":1,"deletions":1,"changes":2,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/cbd10830915ce423dfce7ce4b555d01f00e51300/core%2Fprovisioning-java%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fprovisioning%2Fjava%2FConnectorFacadeProxy.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/cbd10830915ce423dfce7ce4b555d01f00e51300/core%2Fprovisioning-java%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fprovisioning%2Fjava%2FConnectorFacadeProxy.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fprovisioning-java%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fprovisioning%2Fjava%2FConnectorFacadeProxy.java?ref=cbd10830915ce423dfce7ce4b555d01f00e51300","patch":"@@ -101,7 +101,7 @@ public ConnectorFacadeProxy(final ConnInstance connInstance) {\n \n         ConnIdBundleManager connIdBundleManager = ApplicationContextProvider.getBeanFactory().getBean(\n                 ConnIdBundleManager.class);\n-        ConnectorInfo info = connIdBundleManager.getConnectorInfo(connInstance);\n+        ConnectorInfo info = connIdBundleManager.getConnectorInfo(connInstance).getRight();\n \n         // create default configuration\n         APIConfiguration apiConfig = info.createDefaultAPIConfiguration();"},{"sha":"63cb0840a8c484c4ab217e8cab2b5973f53c4ab0","filename":"core/provisioning-java/src/main/java/org/apache/syncope/core/provisioning/java/data/ConnInstanceDataBinderImpl.java","status":"modified","additions":7,"deletions":3,"changes":10,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/cbd10830915ce423dfce7ce4b555d01f00e51300/core%2Fprovisioning-java%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fprovisioning%2Fjava%2Fdata%2FConnInstanceDataBinderImpl.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/cbd10830915ce423dfce7ce4b555d01f00e51300/core%2Fprovisioning-java%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fprovisioning%2Fjava%2Fdata%2FConnInstanceDataBinderImpl.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fprovisioning-java%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fprovisioning%2Fjava%2Fdata%2FConnInstanceDataBinderImpl.java?ref=cbd10830915ce423dfce7ce4b555d01f00e51300","patch":"@@ -18,11 +18,13 @@\n  */\n package org.apache.syncope.core.provisioning.java.data;\n \n+import java.net.URI;\n import org.apache.syncope.core.provisioning.api.data.ConnInstanceDataBinder;\n import java.util.Arrays;\n import java.util.Collection;\n import org.apache.commons.collections4.IterableUtils;\n import org.apache.commons.collections4.Predicate;\n+import org.apache.commons.lang3.tuple.Pair;\n import org.apache.syncope.common.lib.SyncopeClientException;\n import org.apache.syncope.common.lib.to.ConnInstanceTO;\n import org.apache.syncope.common.lib.to.ConnPoolConfTO;\n@@ -38,13 +40,14 @@\n import org.identityconnectors.framework.api.ConfigurationProperty;\n import org.identityconnectors.framework.impl.api.ConfigurationPropertyImpl;\n import org.apache.syncope.core.spring.BeanUtils;\n+import org.identityconnectors.framework.api.ConnectorInfo;\n import org.springframework.beans.factory.annotation.Autowired;\n import org.springframework.stereotype.Component;\n \n @Component\n public class ConnInstanceDataBinderImpl implements ConnInstanceDataBinder {\n \n-    private static final String[] IGNORE_PROPERTIES = { \"poolConf\" };\n+    private static final String[] IGNORE_PROPERTIES = { \"poolConf\", \"location\" };\n \n     @Autowired\n     private ConnIdBundleManager connIdBundleManager;\n@@ -181,11 +184,12 @@ public ConnConfPropSchema build(final ConfigurationProperty property) {\n     public ConnInstanceTO getConnInstanceTO(final ConnInstance connInstance) {\n         ConnInstanceTO connInstanceTO = new ConnInstanceTO();\n \n+        Pair<URI, ConnectorInfo> info = connIdBundleManager.getConnectorInfo(connInstance);\n         BeanUtils.copyProperties(connInstance, connInstanceTO, IGNORE_PROPERTIES);\n-\n+        connInstanceTO.setLocation(info.getLeft().toASCIIString());\n         // refresh stored properties in the given connInstance with direct information from underlying connector\n         ConfigurationProperties properties =\n-                connIdBundleManager.getConfigurationProperties(connIdBundleManager.getConnectorInfo(connInstance));\n+                connIdBundleManager.getConfigurationProperties(info.getRight());\n         for (final String propName : properties.getPropertyNames()) {\n             ConnConfPropSchema schema = build(properties.getProperty(propName));\n "}]}