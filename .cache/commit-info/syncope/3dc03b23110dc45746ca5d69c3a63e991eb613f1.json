{"sha":"3dc03b23110dc45746ca5d69c3a63e991eb613f1","node_id":"MDY6Q29tbWl0NjM2ODc5MDYyOjNkYzAzYjIzMTEwZGM0NTc0NmNhNWQ2OWMzYTYzZTk5MWViNjEzZjE=","commit":{"author":{"name":"Francesco Chicchiriccò","email":"ilgrosso@apache.org","date":"2015-01-15T14:26:31Z"},"committer":{"name":"Francesco Chicchiriccò","email":"ilgrosso@apache.org","date":"2015-01-15T14:26:31Z"},"message":"Merge branch 'master' into 2_0_X","tree":{"sha":"4438382b23d6f50976081d28309dc67d9a3e6c1c","url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/git/trees/4438382b23d6f50976081d28309dc67d9a3e6c1c"},"url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/git/commits/3dc03b23110dc45746ca5d69c3a63e991eb613f1","comment_count":0,"verification":{"verified":false,"reason":"unsigned","signature":null,"payload":null}},"url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/3dc03b23110dc45746ca5d69c3a63e991eb613f1","html_url":"https://github.com/EnricoDAlessandro97UNI/syncope/commit/3dc03b23110dc45746ca5d69c3a63e991eb613f1","comments_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/3dc03b23110dc45746ca5d69c3a63e991eb613f1/comments","author":{"login":"ilgrosso","id":1064664,"node_id":"MDQ6VXNlcjEwNjQ2NjQ=","avatar_url":"https://avatars.githubusercontent.com/u/1064664?v=4","gravatar_id":"","url":"https://api.github.com/users/ilgrosso","html_url":"https://github.com/ilgrosso","followers_url":"https://api.github.com/users/ilgrosso/followers","following_url":"https://api.github.com/users/ilgrosso/following{/other_user}","gists_url":"https://api.github.com/users/ilgrosso/gists{/gist_id}","starred_url":"https://api.github.com/users/ilgrosso/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ilgrosso/subscriptions","organizations_url":"https://api.github.com/users/ilgrosso/orgs","repos_url":"https://api.github.com/users/ilgrosso/repos","events_url":"https://api.github.com/users/ilgrosso/events{/privacy}","received_events_url":"https://api.github.com/users/ilgrosso/received_events","type":"User","site_admin":false},"committer":{"login":"ilgrosso","id":1064664,"node_id":"MDQ6VXNlcjEwNjQ2NjQ=","avatar_url":"https://avatars.githubusercontent.com/u/1064664?v=4","gravatar_id":"","url":"https://api.github.com/users/ilgrosso","html_url":"https://github.com/ilgrosso","followers_url":"https://api.github.com/users/ilgrosso/followers","following_url":"https://api.github.com/users/ilgrosso/following{/other_user}","gists_url":"https://api.github.com/users/ilgrosso/gists{/gist_id}","starred_url":"https://api.github.com/users/ilgrosso/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ilgrosso/subscriptions","organizations_url":"https://api.github.com/users/ilgrosso/orgs","repos_url":"https://api.github.com/users/ilgrosso/repos","events_url":"https://api.github.com/users/ilgrosso/events{/privacy}","received_events_url":"https://api.github.com/users/ilgrosso/received_events","type":"User","site_admin":false},"parents":[{"sha":"b015c443b57c01349b61bc490594626451e5b364","url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/b015c443b57c01349b61bc490594626451e5b364","html_url":"https://github.com/EnricoDAlessandro97UNI/syncope/commit/b015c443b57c01349b61bc490594626451e5b364"},{"sha":"7570a5fc8c41bef10145c660f8b569176ebb3775","url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/7570a5fc8c41bef10145c660f8b569176ebb3775","html_url":"https://github.com/EnricoDAlessandro97UNI/syncope/commit/7570a5fc8c41bef10145c660f8b569176ebb3775"}],"stats":{"total":180,"additions":177,"deletions":3},"files":[{"sha":"f5ddf9a0912c1e2187c3b397e983e887ec6c1f4e","filename":"core/pom.xml","status":"modified","additions":4,"deletions":0,"changes":4,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/3dc03b23110dc45746ca5d69c3a63e991eb613f1/core%2Fpom.xml","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/3dc03b23110dc45746ca5d69c3a63e991eb613f1/core%2Fpom.xml","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fpom.xml?ref=3dc03b23110dc45746ca5d69c3a63e991eb613f1","patch":"@@ -126,6 +126,10 @@ under the License.\n       <groupId>org.apache.camel</groupId>\n       <artifactId>camel-spring</artifactId>\n     </dependency>\n+    <dependency>\n+      <groupId>org.apache.camel</groupId>\n+      <artifactId>camel-script</artifactId>\n+    </dependency>    \n     <dependency>\n       <groupId>javax.xml.bind</groupId>\n       <artifactId>jaxb-api</artifactId>"},{"sha":"13cc27bdd380254b5bd599bf9f4ebaaab00c3670","filename":"core/src/test/java/org/apache/syncope/core/rest/AbstractTest.java","status":"modified","additions":4,"deletions":0,"changes":4,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/3dc03b23110dc45746ca5d69c3a63e991eb613f1/core%2Fsrc%2Ftest%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Frest%2FAbstractTest.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/3dc03b23110dc45746ca5d69c3a63e991eb613f1/core%2Fsrc%2Ftest%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Frest%2FAbstractTest.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fsrc%2Ftest%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Frest%2FAbstractTest.java?ref=3dc03b23110dc45746ca5d69c3a63e991eb613f1","patch":"@@ -47,6 +47,7 @@\n import org.apache.syncope.common.services.ReportService;\n import org.apache.syncope.common.services.ResourceService;\n import org.apache.syncope.common.services.RoleService;\n+import org.apache.syncope.common.services.RouteService;\n import org.apache.syncope.common.services.SchemaService;\n import org.apache.syncope.common.services.SecurityQuestionService;\n import org.apache.syncope.common.services.TaskService;\n@@ -173,6 +174,8 @@ public abstract class AbstractTest {\n     protected static PolicyService policyService;\n \n     protected static SecurityQuestionService securityQuestionService;\n+    \n+    protected static RouteService routeService;\n \n     @Autowired\n     protected DataSource testDataSource;\n@@ -223,6 +226,7 @@ public static void restSetup() {\n         notificationService = adminClient.getService(NotificationService.class);\n         schemaService = adminClient.getService(SchemaService.class);\n         securityQuestionService = adminClient.getService(SecurityQuestionService.class);\n+        routeService = adminClient.getService(RouteService.class);\n     }\n \n     protected static String getUUIDString() {"},{"sha":"57e010cdde54db77c52020f94923daffefcc5b5b","filename":"core/src/test/java/org/apache/syncope/core/rest/CamelTestITCase.java","status":"added","additions":161,"deletions":0,"changes":161,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/3dc03b23110dc45746ca5d69c3a63e991eb613f1/core%2Fsrc%2Ftest%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Frest%2FCamelTestITCase.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/3dc03b23110dc45746ca5d69c3a63e991eb613f1/core%2Fsrc%2Ftest%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Frest%2FCamelTestITCase.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fsrc%2Ftest%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Frest%2FCamelTestITCase.java?ref=3dc03b23110dc45746ca5d69c3a63e991eb613f1","patch":"@@ -0,0 +1,161 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *   http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+package org.apache.syncope.core.rest;\n+\n+import static org.apache.syncope.core.rest.AbstractTest.adminClient;\n+import static org.junit.Assert.assertEquals;\n+\n+import java.util.List;\n+import org.apache.syncope.common.to.RouteTO;\n+import org.apache.syncope.common.to.SchemaTO;\n+import org.apache.syncope.common.to.UserTO;\n+import org.apache.syncope.common.types.AttributableType;\n+import org.apache.syncope.common.types.AttributeSchemaType;\n+import org.apache.syncope.common.types.SchemaType;\n+import org.apache.syncope.common.types.SubjectType;\n+import org.apache.syncope.core.provisioning.camel.CamelDetector;\n+import org.junit.Assert;\n+import org.junit.FixMethodOrder;\n+import org.junit.Test;\n+import org.junit.runners.MethodSorters;\n+\n+@FixMethodOrder(MethodSorters.JVM)\n+public class CamelTestITCase extends AbstractTest{\n+    \n+    @Test\n+    public void isCamelEnabled(){\n+        assertEquals(CamelDetector.isCamelEnabledForUsers(),\n+                adminClient.isCamelEnabledFor(SubjectType.USER));\n+        \n+        assertEquals(CamelDetector.isCamelEnabledForRoles(),\n+                adminClient.isCamelEnabledFor(SubjectType.ROLE));\n+    }\n+    \n+    @Test\n+    public void userRoutes() {\n+        List<RouteTO> userRoutes = routeService.getRoutes(SubjectType.USER);\n+        Assert.assertNotNull(userRoutes);\n+        Assert.assertEquals(15, userRoutes.size());\n+        for(int i=0; i<userRoutes.size(); i++){\n+            Assert.assertNotNull(userRoutes.get(i).getRouteContent());\n+        }\n+    }\n+    \n+    @Test\n+    public void roleRoutes() {\n+        List<RouteTO> roleRoutes = routeService.getRoutes(SubjectType.ROLE);\n+        Assert.assertNotNull(roleRoutes);\n+        Assert.assertEquals(7, roleRoutes.size());\n+        for(int i=0; i<roleRoutes.size(); i++){\n+            Assert.assertNotNull(roleRoutes.get(i).getRouteContent());\n+        }\n+    }\n+   \n+    \n+    public RouteTO updateRoute(Long id, String content){\n+        RouteTO route = routeService.getRoute(SubjectType.USER, id);\n+        route.setRouteContent(content);\n+        routeService.importRoute(SubjectType.USER, route.getId(), route);\n+        //getting new route definition\n+        return routeService.getRoute(SubjectType.USER, id);        \n+    }\n+    \n+    @Test\n+    public void updateRoute(){\n+        RouteTO oldRoute = routeService.getRoute(SubjectType.USER, new Long(0));\n+        String routeContent =   \"<route id=\\\"createUser\\\">\\n\" +\n+                                \"  <from uri=\\\"direct:createUser\\\"/>\\n\" +\n+                                \"  <setProperty propertyName=\\\"actual\\\">\\n\" +\n+                                \"    <simple>${body}</simple>\\n\" +\n+                                \"  </setProperty>\\n\" +\n+                                \"  <doTry>\\n\" +\n+                                \"    <bean ref=\\\"uwfAdapter\\\" method=\\\"create(${body},${property.disablePwdPolicyCheck},\\n\" +\n+                                \"                             ${property.enabled},${property.storePassword})\\\"/>\\n\" +\n+                                \"    <process ref=\\\"defaultUserCreatePropagation\\\" />\\n\" +\n+                                \"    <to uri=\\\"direct:createPort\\\"/>\\n\" +\n+                                \"    <to uri=\\\"log:myLog\\\"/>\\n\" +\n+                                \"    <doCatch>        \\n\" +\n+                                \"      <exception>java.lang.RuntimeException</exception>\\n\" +\n+                                \"      <handled>\\n\" +\n+                                \"        <constant>false</constant>\\n\" +\n+                                \"      </handled>\\n\" +\n+                                \"      <to uri=\\\"direct:createPort\\\"/>\\n\" +\n+                                \"    </doCatch>\\n\" +\n+                                \"  </doTry>\\n\" +\n+                                \"</route>\";\n+        RouteTO route =  updateRoute(new Long(0), routeContent);\n+        assertEquals(routeContent, route.getRouteContent());\n+        \n+        updateRoute(oldRoute.getId(), oldRoute.getRouteContent());\n+    }\n+    \n+    @Test\n+    public void checkRouteUpdate(){\n+        //Getting original route content\n+        RouteTO oldRoute = routeService.getRoute(SubjectType.USER, new Long(0));\n+        //updating route content including new attribute management\n+        String routeContent =   \"<route id=\\\"createUser\\\">\\n\" +\n+                                \"  <from uri=\\\"direct:createUser\\\"/>\\n\" +\n+                                \"  <setProperty propertyName=\\\"actual\\\">\\n\" +\n+                                \"    <simple>${body}</simple>\\n\" +\n+                                \"  </setProperty>\\n\" +                                \n+                                \"  <setBody>\\n\"+\n+                                \"   <groovy>\\n\"+\n+                                \"       request.body.getAttrs().get(3).getValues().set(0,\\\"true\\\")\\n\"+\n+                                \"       return request.body\\n\"+\n+                                \"   </groovy>\\n\"+\n+                                \"  </setBody>\\n\"+\n+                                \"  <doTry>\\n\" +\n+                                \"      <bean ref=\\\"uwfAdapter\\\" method=\\\"create(${body},${property.disablePwdPolicyCheck},\\n\" +\n+                                \"                            ${property.enabled},${property.storePassword})\\\"/>\\n\" +\n+                                \"      <process ref=\\\"defaultUserCreatePropagation\\\" />\\n\" +\n+                                \"      <to uri=\\\"direct:createPort\\\"/>\\n\" +\n+                                \"      <doCatch>        \\n\" +\n+                                \"      <exception>java.lang.RuntimeException</exception>\\n\" +\n+                                \"          <handled>\\n\" +\n+                                \"           <constant>false</constant>\\n\" +\n+                                \"          </handled>\\n\" +\n+                                \"      <to uri=\\\"direct:createPort\\\"/>\\n\" +\n+                                \"      </doCatch>\\n\" +\n+                                \"   </doTry>\\n\" +                                \n+                                \"</route>\";\n+        updateRoute(new Long(0), routeContent);\n+        //creating new schema attribute for user\n+        SchemaTO schemaTO = new SchemaTO();\n+        schemaTO.setName(\"camelAttribute\");\n+        schemaTO.setType(AttributeSchemaType.String);       \n+        createSchema(AttributableType.USER, SchemaType.NORMAL, schemaTO);\n+        \n+        UserTO userTO = new UserTO();\n+        String userId = getUUIDString() + \"camelUser@syncope.apache.org\";\n+        userTO.setUsername(userId);\n+        userTO.setPassword(\"password\");\n+        userTO.getAttrs().add(attributeTO(\"userId\", userId));\n+        userTO.getAttrs().add(attributeTO(\"fullname\", userId));\n+        userTO.getAttrs().add(attributeTO(\"surname\", userId));\n+        userTO.getAttrs().add(attributeTO(\"camelAttribute\", \"false\"));\n+\n+        userTO = createUser(userTO);        \n+        Assert.assertNotNull(userTO);\n+        assertEquals(\"true\",userTO.getAttrs().get(3).getValues().get(0));\n+        \n+        updateRoute(oldRoute.getId(), oldRoute.getRouteContent());\n+    }\n+    \n+}"},{"sha":"c1a7e933d293c6c5219bb7348d3b5a08d828cfa6","filename":"pom.xml","status":"modified","additions":8,"deletions":3,"changes":11,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/3dc03b23110dc45746ca5d69c3a63e991eb613f1/pom.xml","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/3dc03b23110dc45746ca5d69c3a63e991eb613f1/pom.xml","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/pom.xml?ref=3dc03b23110dc45746ca5d69c3a63e991eb613f1","patch":"@@ -340,7 +340,7 @@ under the License.\n     <camel.version>2.14.1</camel.version>\t\n     <spring.version>4.0.9.RELEASE</spring.version>\n     <spring-security.version>3.2.5.RELEASE</spring-security.version>\n-    <jackson.version>2.4.4</jackson.version>\n+    <jackson.version>2.4.5</jackson.version>\n     <velocity.version>1.7</velocity.version>\n     <velocitytools.version>2.0</velocitytools.version>\n     <quartz.version>2.2.1</quartz.version>\n@@ -726,8 +726,13 @@ under the License.\n       </dependency>\n       <dependency>\n         <groupId>org.apache.camel</groupId>\n-       <artifactId>camel-spring</artifactId>\n-       <version>${camel.version}</version>\n+        <artifactId>camel-spring</artifactId>\n+        <version>${camel.version}</version>\n+      </dependency>\n+      <dependency>\n+        <groupId>org.apache.camel</groupId>\n+        <artifactId>camel-script</artifactId>\n+        <version>${camel.version}</version>\n       </dependency>\n       <!-- /Camel -->\n "}]}