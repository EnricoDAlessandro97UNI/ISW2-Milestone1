{"sha":"c1087c525b65258fdea224a85acb8fda5eb32384","node_id":"C_kwDOJfYA1toAKGMxMDg3YzUyNWI2NTI1OGZkZWEyMjRhODVhY2I4ZmRhNWViMzIzODQ","commit":{"author":{"name":"Andrea Patricelli","email":"andreapatricelli@apache.org","date":"2022-01-31T17:19:54Z"},"committer":{"name":"GitHub","email":"noreply@github.com","date":"2022-01-31T17:19:54Z"},"message":"[SYNCOPE-1641] added resources to match to purge propagation tasks API (#305)","tree":{"sha":"f6fda701fa810ba6f5237d5316542cbfbef9c1ca","url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/git/trees/f6fda701fa810ba6f5237d5316542cbfbef9c1ca"},"url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/git/commits/c1087c525b65258fdea224a85acb8fda5eb32384","comment_count":0,"verification":{"verified":true,"reason":"valid","signature":"-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJh+Bo6CRBK7hj4Ov3rIwAAJAYIADvXwgv9lDr4z9/wzxL8rFJL\npcZm5w7+QFbYm0oDTL7IBIXv3rz97arnLyV++BttxVycdrBw3rXY3N4xtH5wmg/T\nRsv5Ccobo8EfFqq5+TCn8iydwp3DahCBfywPv4pdKk0xQ4XXbA+7NXk6yN13WS9g\n8PpPCnGDwVOjrxq8m2hG1mQe9AoCwPs7vyfq9HnaqTJZ303VV91ubkT59OoKjP8A\n7eEK3sxF7VfhHf3L9oJxx4Atdm6YFluS9JP1JxOqq6I1uV9/BuAEpsTZ+Zg0XG2E\nHGTQvX07fUdVsujJ0sk68C6EhadXfFfkrqNOMKFji2ckdhtbdNKYLAsA9q75VEM=\n=XHe6\n-----END PGP SIGNATURE-----\n","payload":"tree f6fda701fa810ba6f5237d5316542cbfbef9c1ca\nparent a9572776f9a009ff436e09f629f8ebc2678cfae4\nauthor Andrea Patricelli <andreapatricelli@apache.org> 1643649594 +0100\ncommitter GitHub <noreply@github.com> 1643649594 +0100\n\n[SYNCOPE-1641] added resources to match to purge propagation tasks API (#305)\n\n"}},"url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/c1087c525b65258fdea224a85acb8fda5eb32384","html_url":"https://github.com/EnricoDAlessandro97UNI/syncope/commit/c1087c525b65258fdea224a85acb8fda5eb32384","comments_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/c1087c525b65258fdea224a85acb8fda5eb32384/comments","author":{"login":"andrea-patricelli","id":3763111,"node_id":"MDQ6VXNlcjM3NjMxMTE=","avatar_url":"https://avatars.githubusercontent.com/u/3763111?v=4","gravatar_id":"","url":"https://api.github.com/users/andrea-patricelli","html_url":"https://github.com/andrea-patricelli","followers_url":"https://api.github.com/users/andrea-patricelli/followers","following_url":"https://api.github.com/users/andrea-patricelli/following{/other_user}","gists_url":"https://api.github.com/users/andrea-patricelli/gists{/gist_id}","starred_url":"https://api.github.com/users/andrea-patricelli/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/andrea-patricelli/subscriptions","organizations_url":"https://api.github.com/users/andrea-patricelli/orgs","repos_url":"https://api.github.com/users/andrea-patricelli/repos","events_url":"https://api.github.com/users/andrea-patricelli/events{/privacy}","received_events_url":"https://api.github.com/users/andrea-patricelli/received_events","type":"User","site_admin":false},"committer":{"login":"web-flow","id":19864447,"node_id":"MDQ6VXNlcjE5ODY0NDQ3","avatar_url":"https://avatars.githubusercontent.com/u/19864447?v=4","gravatar_id":"","url":"https://api.github.com/users/web-flow","html_url":"https://github.com/web-flow","followers_url":"https://api.github.com/users/web-flow/followers","following_url":"https://api.github.com/users/web-flow/following{/other_user}","gists_url":"https://api.github.com/users/web-flow/gists{/gist_id}","starred_url":"https://api.github.com/users/web-flow/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/web-flow/subscriptions","organizations_url":"https://api.github.com/users/web-flow/orgs","repos_url":"https://api.github.com/users/web-flow/repos","events_url":"https://api.github.com/users/web-flow/events{/privacy}","received_events_url":"https://api.github.com/users/web-flow/received_events","type":"User","site_admin":false},"parents":[{"sha":"a9572776f9a009ff436e09f629f8ebc2678cfae4","url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/a9572776f9a009ff436e09f629f8ebc2678cfae4","html_url":"https://github.com/EnricoDAlessandro97UNI/syncope/commit/a9572776f9a009ff436e09f629f8ebc2678cfae4"}],"stats":{"total":76,"additions":64,"deletions":12},"files":[{"sha":"dcaa2c7a5683cf250cd7edb53d2feb96d828c9a2","filename":"common/idrepo/rest-api/src/main/java/org/apache/syncope/common/rest/api/service/TaskService.java","status":"modified","additions":4,"deletions":1,"changes":5,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/c1087c525b65258fdea224a85acb8fda5eb32384/common%2Fidrepo%2Frest-api%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcommon%2Frest%2Fapi%2Fservice%2FTaskService.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/c1087c525b65258fdea224a85acb8fda5eb32384/common%2Fidrepo%2Frest-api%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcommon%2Frest%2Fapi%2Fservice%2FTaskService.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/common%2Fidrepo%2Frest-api%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcommon%2Frest%2Fapi%2Fservice%2FTaskService.java?ref=c1087c525b65258fdea224a85acb8fda5eb32384","patch":"@@ -148,6 +148,7 @@ <T extends TaskTO> T read(\n      *\n      * @param since match all executions started afterwards\n      * @param statuses execution status(es) to match\n+     * @param resources external resource(s) to match\n      * @return deleted propagation tasks\n      */\n     @ApiResponses({\n@@ -157,5 +158,7 @@ <T extends TaskTO> T read(\n     @Path(\"PROPAGATION/purge\")\n     @Produces({ MediaType.APPLICATION_JSON, RESTHeaders.APPLICATION_YAML, MediaType.APPLICATION_XML })\n     Response purgePropagations(\n-            @QueryParam(\"since\") Date since, @QueryParam(\"statuses\") List<ExecStatus> statuses);\n+            @QueryParam(\"since\") Date since, \n+            @QueryParam(\"statuses\") List<ExecStatus> statuses, \n+            @QueryParam(\"resources\") List<String> resources);\n }"},{"sha":"904491fdacb34cd95345a0451f95fd7090033c53","filename":"core/idrepo/logic/src/main/java/org/apache/syncope/core/logic/TaskLogic.java","status":"modified","additions":9,"deletions":2,"changes":11,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/c1087c525b65258fdea224a85acb8fda5eb32384/core%2Fidrepo%2Flogic%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Flogic%2FTaskLogic.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/c1087c525b65258fdea224a85acb8fda5eb32384/core%2Fidrepo%2Flogic%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Flogic%2FTaskLogic.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fidrepo%2Flogic%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Flogic%2FTaskLogic.java?ref=c1087c525b65258fdea224a85acb8fda5eb32384","patch":"@@ -23,6 +23,8 @@\n import java.util.Date;\n import java.util.List;\n import java.util.Map;\n+import java.util.Objects;\n+import java.util.Optional;\n import java.util.stream.Collectors;\n import javax.ws.rs.core.Response;\n import org.apache.commons.lang3.ArrayUtils;\n@@ -472,8 +474,13 @@ public void actionJob(final String key, final JobAction action) {\n     }\n \n     @PreAuthorize(\"hasRole('\" + IdRepoEntitlement.TASK_DELETE + \"')\")\n-    public List<PropagationTaskTO> purgePropagations(final Date since, final List<ExecStatus> statuses) {\n-        return taskDAO.purgePropagations(since, statuses);\n+    public List<PropagationTaskTO> purgePropagations(\n+            final Date since,\n+            final List<ExecStatus> statuses,\n+            final List<String> resources) {\n+        return taskDAO.purgePropagations(since, statuses, Optional.ofNullable(resources).\n+                map(r -> r.stream().map(resourceDAO::find).filter(Objects::nonNull).collect(Collectors.toList()))\n+                .orElse(null));\n     }\n \n     @Override"},{"sha":"3177cdd97f2dd9f3cd7a799c2a761cc5107cd483","filename":"core/idrepo/rest-cxf/src/main/java/org/apache/syncope/core/rest/cxf/service/TaskServiceImpl.java","status":"modified","additions":4,"deletions":3,"changes":7,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/c1087c525b65258fdea224a85acb8fda5eb32384/core%2Fidrepo%2Frest-cxf%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Frest%2Fcxf%2Fservice%2FTaskServiceImpl.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/c1087c525b65258fdea224a85acb8fda5eb32384/core%2Fidrepo%2Frest-cxf%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Frest%2Fcxf%2Fservice%2FTaskServiceImpl.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fidrepo%2Frest-cxf%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Frest%2Fcxf%2Fservice%2FTaskServiceImpl.java?ref=c1087c525b65258fdea224a85acb8fda5eb32384","patch":"@@ -98,11 +98,12 @@ public void update(final TaskType type, final SchedTaskTO taskTO) {\n     }\n \n     @Override\n-    public Response purgePropagations(final Date since, final List<ExecStatus> statuses) {\n-        if (since == null && CollectionUtils.isEmpty(statuses)) {\n+    public Response purgePropagations(final Date since, final List<ExecStatus> statuses, final List<String> resources) {\n+        if (since == null && CollectionUtils.isEmpty(statuses) && CollectionUtils.isEmpty(resources)) {\n             return Response.status(Response.Status.PRECONDITION_FAILED).build();\n         }\n \n-        return Response.ok(logic.purgePropagations(since, statuses)).build();\n+        return Response.ok(logic.purgePropagations(since, statuses, resources)).build();\n     }\n+\n }"},{"sha":"8cd5f732cb913619263e8aa7d2dde0003963fe6c","filename":"core/persistence-api/src/main/java/org/apache/syncope/core/persistence/api/dao/TaskDAO.java","status":"modified","additions":4,"deletions":1,"changes":5,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/c1087c525b65258fdea224a85acb8fda5eb32384/core%2Fpersistence-api%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fpersistence%2Fapi%2Fdao%2FTaskDAO.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/c1087c525b65258fdea224a85acb8fda5eb32384/core%2Fpersistence-api%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fpersistence%2Fapi%2Fdao%2FTaskDAO.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fpersistence-api%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fpersistence%2Fapi%2Fdao%2FTaskDAO.java?ref=c1087c525b65258fdea224a85acb8fda5eb32384","patch":"@@ -76,5 +76,8 @@ int count(\n \n     void deleteAll(ExternalResource resource, TaskType type);\n \n-    List<PropagationTaskTO> purgePropagations(Date since, List<ExecStatus> statuses);\n+    List<PropagationTaskTO> purgePropagations(\n+            Date since, \n+            List<ExecStatus> statuses,\n+            List<ExternalResource> externalResources);\n }"},{"sha":"dbc0d9ce1e5b0398e85d98b9ae2e462f280b7e8a","filename":"core/persistence-jpa-json/src/test/resources/domains/MasterContent.xml","status":"modified","additions":5,"deletions":0,"changes":5,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/c1087c525b65258fdea224a85acb8fda5eb32384/core%2Fpersistence-jpa-json%2Fsrc%2Ftest%2Fresources%2Fdomains%2FMasterContent.xml","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/c1087c525b65258fdea224a85acb8fda5eb32384/core%2Fpersistence-jpa-json%2Fsrc%2Ftest%2Fresources%2Fdomains%2FMasterContent.xml","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fpersistence-jpa-json%2Fsrc%2Ftest%2Fresources%2Fdomains%2FMasterContent.xml?ref=c1087c525b65258fdea224a85acb8fda5eb32384","patch":"@@ -1038,6 +1038,11 @@ under the License.\n   <Task DTYPE=\"PropagationTask\" id=\"316285cc-ae52-4ea2-a33b-7355e189ac3f\" operation=\"DELETE\"\n         objectClassName=\"__ACCOUNT__\" resource_id=\"ws-target-resource-2\" anyTypeKind=\"USER\" entityKey=\"1417acbe-cbf6-4277-9372-e75e04f97000\"\n         attributes='[{\"name\":\"__PASSWORD__\",\"value\":[{\"readOnly\":false,\"disposed\":false,\"encryptedBytes\":\"m9nh2US0Sa6m+cXccCq0Xw==\",\"base64SHA1Hash\":\"GFJ69qfjxEOdrmt+9q+0Cw2uz60=\"}]},{\"name\":\"__NAME__\",\"value\":[\"userId\"],\"nameValue\":\"userId\"},{\"name\":\"type\",\"value\":[\"type\"]}]'/>\n+  <!--SYNCOPE-1641 to be purged-->\n+  <Task DTYPE=\"PropagationTask\" id=\"025c956d-ea88-4bd7-9e44-2f35e0aa7055\" operation=\"UPDATE\"\n+        objectClassName=\"__ACCOUNT__\" resource_id=\"ws-target-resource-1\" anyTypeKind=\"USER\" entityKey=\"1417acbe-cbf6-4277-9372-e75e04f97000\"\n+        attributes='[{\"name\":\"__PASSWORD__\",\"value\":[{\"readOnly\":false,\"disposed\":false,\"encryptedBytes\":\"m9nh2US0Sa6m+cXccCq0Xw==\",\"base64SHA1Hash\":\"GFJ69qfjxEOdrmt+9q+0Cw2uz60=\"}]},{\"name\":\"__NAME__\",\"value\":[\"userId\"],\"nameValue\":\"userId\"},{\"name\":\"fullname\",\"value\":[\"fullname\"]},{\"name\":\"type\",\"value\":[\"type\"]}]'/>\n+  <TaskExec id=\"c3290f8b-caf9-4a85-84fb-fb619b65cd49\" task_id=\"025c956d-ea88-4bd7-9e44-2f35e0aa7055\" startDate=\"2015-12-17 09:40:00.506\" endDate=\"2015-12-17 09:42:00.506\" status=\"SUCCESS\"/>\n   <Task DTYPE=\"PullTask\" remediation=\"0\" id=\"c41b9b71-9bfa-4f90-89f2-84787def4c5c\" name=\"CSV (update matching; assign unmatching)\" resource_id=\"resource-csv\"\n         destinationRealm_id=\"e4c28e7a-9dbf-4ee7-9441-93812a0d4a28\" performCreate=\"1\" performUpdate=\"1\" performDelete=\"1\" syncStatus=\"1\"\n         pullMode=\"INCREMENTAL\" unmatchingRule=\"ASSIGN\" matchingRule=\"UPDATE\" active=\"1\""},{"sha":"d7d573c1e888828b9fc4d88acc246846d0c2fc7c","filename":"core/persistence-jpa/src/main/java/org/apache/syncope/core/persistence/jpa/dao/JPATaskDAO.java","status":"modified","additions":12,"deletions":1,"changes":13,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/c1087c525b65258fdea224a85acb8fda5eb32384/core%2Fpersistence-jpa%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fpersistence%2Fjpa%2Fdao%2FJPATaskDAO.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/c1087c525b65258fdea224a85acb8fda5eb32384/core%2Fpersistence-jpa%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fpersistence%2Fjpa%2Fdao%2FJPATaskDAO.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fpersistence-jpa%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fpersistence%2Fjpa%2Fdao%2FJPATaskDAO.java?ref=c1087c525b65258fdea224a85acb8fda5eb32384","patch":"@@ -487,7 +487,10 @@ public void deleteAll(final ExternalResource resource, final TaskType type) {\n     }\n \n     @Override\n-    public List<PropagationTaskTO> purgePropagations(final Date since, final List<ExecStatus> statuses) {\n+    public List<PropagationTaskTO> purgePropagations(\n+            final Date since, \n+            final List<ExecStatus> statuses, \n+            final List<ExternalResource> externalResources) {\n         StringBuilder queryString = new StringBuilder(\"SELECT t.task_id \"\n                 + \"FROM TaskExec t INNER JOIN Task z ON t.task_id=z.id AND z.dtype='PropagationTask' \"\n                 + \"WHERE t.enddate=(SELECT MAX(e.enddate) FROM TaskExec e WHERE e.task_id=t.task_id) \");\n@@ -505,6 +508,14 @@ public List<PropagationTaskTO> purgePropagations(final Date since, final List<Ex\n                     }).collect(Collectors.joining(\" OR \"))).\n                     append(\")\");\n         }\n+        if (!CollectionUtils.isEmpty(externalResources)) {\n+            queryString.append(\"AND (\").\n+                    append(externalResources.stream().map(externalResource -> {\n+                        queryParameters.add(externalResource.getKey());\n+                        return \"z.resource_id = ?\" + queryParameters.size();\n+                    }).collect(Collectors.joining(\" OR \"))).\n+                    append(\")\");\n+        }\n \n         Query query = entityManager().createNativeQuery(queryString.toString());\n         for (int i = 1; i <= queryParameters.size(); i++) {"},{"sha":"04d247004d043ead9129ade0c4b8ee62c5d0af00","filename":"core/persistence-jpa/src/test/java/org/apache/syncope/core/persistence/jpa/inner/TaskTest.java","status":"modified","additions":2,"deletions":2,"changes":4,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/c1087c525b65258fdea224a85acb8fda5eb32384/core%2Fpersistence-jpa%2Fsrc%2Ftest%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fpersistence%2Fjpa%2Finner%2FTaskTest.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/c1087c525b65258fdea224a85acb8fda5eb32384/core%2Fpersistence-jpa%2Fsrc%2Ftest%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fpersistence%2Fjpa%2Finner%2FTaskTest.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fpersistence-jpa%2Fsrc%2Ftest%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fpersistence%2Fjpa%2Finner%2FTaskTest.java?ref=c1087c525b65258fdea224a85acb8fda5eb32384","patch":"@@ -88,12 +88,12 @@ public void findPaginated() {\n         assertNotNull(tasks);\n         assertTrue(tasks.isEmpty());\n \n-        assertEquals(5, taskDAO.count(TaskType.PROPAGATION, null, null, null, null));\n+        assertEquals(6, taskDAO.count(TaskType.PROPAGATION, null, null, null, null));\n     }\n \n     @Test\n     public void findAll() {\n-        assertEquals(5, taskDAO.findAll(TaskType.PROPAGATION).size());\n+        assertEquals(6, taskDAO.findAll(TaskType.PROPAGATION).size());\n         assertEquals(1, taskDAO.findAll(TaskType.NOTIFICATION).size());\n         assertEquals(3, taskDAO.findAll(TaskType.SCHEDULED).size());\n         assertEquals(10, taskDAO.findAll(TaskType.PULL).size());"},{"sha":"b6572431b292a0dac02b2b9702b182c116f68786","filename":"core/persistence-jpa/src/test/resources/domains/MasterContent.xml","status":"modified","additions":5,"deletions":0,"changes":5,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/c1087c525b65258fdea224a85acb8fda5eb32384/core%2Fpersistence-jpa%2Fsrc%2Ftest%2Fresources%2Fdomains%2FMasterContent.xml","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/c1087c525b65258fdea224a85acb8fda5eb32384/core%2Fpersistence-jpa%2Fsrc%2Ftest%2Fresources%2Fdomains%2FMasterContent.xml","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fpersistence-jpa%2Fsrc%2Ftest%2Fresources%2Fdomains%2FMasterContent.xml?ref=c1087c525b65258fdea224a85acb8fda5eb32384","patch":"@@ -1125,6 +1125,11 @@ under the License.\n   <Task DTYPE=\"PropagationTask\" id=\"316285cc-ae52-4ea2-a33b-7355e189ac3f\" operation=\"DELETE\"\n         objectClassName=\"__ACCOUNT__\" resource_id=\"ws-target-resource-2\" anyTypeKind=\"USER\" entityKey=\"1417acbe-cbf6-4277-9372-e75e04f97000\"\n         attributes='[{\"name\":\"__PASSWORD__\",\"value\":[{\"readOnly\":false,\"disposed\":false,\"encryptedBytes\":\"m9nh2US0Sa6m+cXccCq0Xw==\",\"base64SHA1Hash\":\"GFJ69qfjxEOdrmt+9q+0Cw2uz60=\"}]},{\"name\":\"__NAME__\",\"value\":[\"userId\"],\"nameValue\":\"userId\"},{\"name\":\"type\",\"value\":[\"type\"]}]'/>\n+  <!--SYNCOPE-1641 to be purged-->\n+  <Task DTYPE=\"PropagationTask\" id=\"025c956d-ea88-4bd7-9e44-2f35e0aa7055\" operation=\"UPDATE\"\n+        objectClassName=\"__ACCOUNT__\" resource_id=\"ws-target-resource-1\" anyTypeKind=\"USER\" entityKey=\"1417acbe-cbf6-4277-9372-e75e04f97000\"\n+        attributes='[{\"name\":\"__PASSWORD__\",\"value\":[{\"readOnly\":false,\"disposed\":false,\"encryptedBytes\":\"m9nh2US0Sa6m+cXccCq0Xw==\",\"base64SHA1Hash\":\"GFJ69qfjxEOdrmt+9q+0Cw2uz60=\"}]},{\"name\":\"__NAME__\",\"value\":[\"userId\"],\"nameValue\":\"userId\"},{\"name\":\"fullname\",\"value\":[\"fullname\"]},{\"name\":\"type\",\"value\":[\"type\"]}]'/>\n+  <TaskExec id=\"c3290f8b-caf9-4a85-84fb-fb619b65cd49\" task_id=\"025c956d-ea88-4bd7-9e44-2f35e0aa7055\" startDate=\"2015-12-17 09:40:00.506\" endDate=\"2015-12-17 09:42:00.506\" status=\"SUCCESS\"/>\n   <Task DTYPE=\"PullTask\" remediation=\"0\" id=\"c41b9b71-9bfa-4f90-89f2-84787def4c5c\" name=\"CSV (update matching; assign unmatching)\" resource_id=\"resource-csv\"\n         destinationRealm_id=\"e4c28e7a-9dbf-4ee7-9441-93812a0d4a28\" performCreate=\"1\" performUpdate=\"1\" performDelete=\"1\" syncStatus=\"1\"\n         pullMode=\"INCREMENTAL\" unmatchingRule=\"ASSIGN\" matchingRule=\"UPDATE\" active=\"1\""},{"sha":"1f26de8a236a5a04e5fa9f10ccc6e83dfa1e9cbf","filename":"fit/core-reference/src/test/java/org/apache/syncope/fit/core/PropagationTaskITCase.java","status":"modified","additions":19,"deletions":2,"changes":21,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/c1087c525b65258fdea224a85acb8fda5eb32384/fit%2Fcore-reference%2Fsrc%2Ftest%2Fjava%2Forg%2Fapache%2Fsyncope%2Ffit%2Fcore%2FPropagationTaskITCase.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/c1087c525b65258fdea224a85acb8fda5eb32384/fit%2Fcore-reference%2Fsrc%2Ftest%2Fjava%2Forg%2Fapache%2Fsyncope%2Ffit%2Fcore%2FPropagationTaskITCase.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/fit%2Fcore-reference%2Fsrc%2Ftest%2Fjava%2Forg%2Fapache%2Fsyncope%2Ffit%2Fcore%2FPropagationTaskITCase.java?ref=c1087c525b65258fdea224a85acb8fda5eb32384","patch":"@@ -275,7 +275,7 @@ public void privileges() {\n     @Test\n     public void purgePropagations() {\n         try {\n-            taskService.purgePropagations(null, null);\n+            taskService.purgePropagations(null, null, null);\n             fail();\n         } catch (WebServiceException e) {\n             assertNotNull(e);\n@@ -284,12 +284,29 @@ public void purgePropagations() {\n         Calendar oneWeekAgo = Calendar.getInstance();\n         oneWeekAgo.add(Calendar.WEEK_OF_YEAR, -1);\n         Response response = taskService.purgePropagations(\n-                oneWeekAgo.getTime(), Collections.singletonList(ExecStatus.SUCCESS));\n+                oneWeekAgo.getTime(), List.of(ExecStatus.SUCCESS),\n+                List.of(RESOURCE_NAME_WS1));\n         assertEquals(Response.Status.OK.getStatusCode(), response.getStatus());\n \n         List<PropagationTaskTO> deleted = response.readEntity(new GenericType<List<PropagationTaskTO>>() {\n         });\n         assertNotNull(deleted);\n+        // only ws-target-resource-1 PROPAGATION tasks should have been deleted\n+        assertEquals(1, deleted.size());\n+        assertTrue(deleted.stream().allMatch(d -> RESOURCE_NAME_WS1.equals(d.getResource())));\n+        // check that other propagation tasks haven't been affected\n+        assertFalse(taskService.search(new TaskQuery.Builder(TaskType.PROPAGATION)\n+                .anyTypeKind(AnyTypeKind.USER)\n+                .page(0).size(10)\n+                .build()).getResult().isEmpty());\n+        // delete all remaining SUCCESS tasks\n+        response = taskService.purgePropagations(\n+                oneWeekAgo.getTime(), List.of(ExecStatus.SUCCESS), List.of());\n+        assertEquals(Response.Status.OK.getStatusCode(), response.getStatus());\n+\n+        deleted = response.readEntity(new GenericType<List<PropagationTaskTO>>() {\n+        });\n+        assertNotNull(deleted);\n     }\n \n     @Test"}]}