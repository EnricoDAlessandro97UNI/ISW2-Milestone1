{"sha":"0da02810041a4bbd5c0892a02924cf726a9e016e","node_id":"MDY6Q29tbWl0NjM2ODc5MDYyOjBkYTAyODEwMDQxYTRiYmQ1YzA4OTJhMDI5MjRjZjcyNmE5ZTAxNmU=","commit":{"author":{"name":"giacomolm","email":"giacomolm@hotmail.it","date":"2014-12-18T09:42:56Z"},"committer":{"name":"giacomolm","email":"giacomolm@hotmail.it","date":"2014-12-18T09:42:56Z"},"message":"Password managed now included in the provisionig manager","tree":{"sha":"7d6e29e96f4248d8362b0845a7f1ee4abe200d09","url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/git/trees/7d6e29e96f4248d8362b0845a7f1ee4abe200d09"},"url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/git/commits/0da02810041a4bbd5c0892a02924cf726a9e016e","comment_count":0,"verification":{"verified":false,"reason":"unsigned","signature":null,"payload":null}},"url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/0da02810041a4bbd5c0892a02924cf726a9e016e","html_url":"https://github.com/EnricoDAlessandro97UNI/syncope/commit/0da02810041a4bbd5c0892a02924cf726a9e016e","comments_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/0da02810041a4bbd5c0892a02924cf726a9e016e/comments","author":{"login":"giacomolm","id":4027829,"node_id":"MDQ6VXNlcjQwMjc4Mjk=","avatar_url":"https://avatars.githubusercontent.com/u/4027829?v=4","gravatar_id":"","url":"https://api.github.com/users/giacomolm","html_url":"https://github.com/giacomolm","followers_url":"https://api.github.com/users/giacomolm/followers","following_url":"https://api.github.com/users/giacomolm/following{/other_user}","gists_url":"https://api.github.com/users/giacomolm/gists{/gist_id}","starred_url":"https://api.github.com/users/giacomolm/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/giacomolm/subscriptions","organizations_url":"https://api.github.com/users/giacomolm/orgs","repos_url":"https://api.github.com/users/giacomolm/repos","events_url":"https://api.github.com/users/giacomolm/events{/privacy}","received_events_url":"https://api.github.com/users/giacomolm/received_events","type":"User","site_admin":false},"committer":{"login":"giacomolm","id":4027829,"node_id":"MDQ6VXNlcjQwMjc4Mjk=","avatar_url":"https://avatars.githubusercontent.com/u/4027829?v=4","gravatar_id":"","url":"https://api.github.com/users/giacomolm","html_url":"https://github.com/giacomolm","followers_url":"https://api.github.com/users/giacomolm/followers","following_url":"https://api.github.com/users/giacomolm/following{/other_user}","gists_url":"https://api.github.com/users/giacomolm/gists{/gist_id}","starred_url":"https://api.github.com/users/giacomolm/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/giacomolm/subscriptions","organizations_url":"https://api.github.com/users/giacomolm/orgs","repos_url":"https://api.github.com/users/giacomolm/repos","events_url":"https://api.github.com/users/giacomolm/events{/privacy}","received_events_url":"https://api.github.com/users/giacomolm/received_events","type":"User","site_admin":false},"parents":[{"sha":"5b3b124a0c4254e39f0caf5b0daabb5b7d571a56","url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/5b3b124a0c4254e39f0caf5b0daabb5b7d571a56","html_url":"https://github.com/EnricoDAlessandro97UNI/syncope/commit/5b3b124a0c4254e39f0caf5b0daabb5b7d571a56"}],"stats":{"total":246,"additions":159,"deletions":87},"files":[{"sha":"54f677c87ff673c65aadbfd2ea925cec26eabc9e","filename":"core/src/main/java/org/apache/syncope/core/provisioning/DefaultUserProvisioningManager.java","status":"modified","additions":20,"deletions":0,"changes":20,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/0da02810041a4bbd5c0892a02924cf726a9e016e/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fprovisioning%2FDefaultUserProvisioningManager.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/0da02810041a4bbd5c0892a02924cf726a9e016e/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fprovisioning%2FDefaultUserProvisioningManager.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fprovisioning%2FDefaultUserProvisioningManager.java?ref=0da02810041a4bbd5c0892a02924cf726a9e016e","patch":"@@ -344,4 +344,24 @@ public void innerSuspend(SyncopeUser user, boolean suspend) {\n             }            \n     }\n \n+    @Override\n+    public void requestPasswordReset(Long id) {\n+        uwfAdapter.requestPasswordReset(id);\n+    }\n+\n+    @Override\n+    public void confirmPasswordReset(SyncopeUser user, String token, String password) {\n+            \n+        uwfAdapter.confirmPasswordReset(user.getId(), token, password);\n+\n+        List<PropagationTask> tasks = propagationManager.getUserUpdateTaskIds(user, null, null);\n+        PropagationReporter propReporter =\n+                ApplicationContextProvider.getApplicationContext().getBean(PropagationReporter.class);\n+        try {\n+            taskExecutor.execute(tasks, propReporter);\n+        } catch (PropagationException e) {\n+            LOG.error(\"Error propagation primary resource\", e);\n+            propReporter.onPrimaryResourceFailure(tasks);\n+        }    \n+    }\n }"},{"sha":"adc1cb0625620716c35c2c63eb7c20f6f8880255","filename":"core/src/main/java/org/apache/syncope/core/provisioning/ProvisioningManager.java","status":"renamed","additions":0,"deletions":0,"changes":0,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/0da02810041a4bbd5c0892a02924cf726a9e016e/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fprovisioning%2FProvisioningManager.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/0da02810041a4bbd5c0892a02924cf726a9e016e/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fprovisioning%2FProvisioningManager.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fprovisioning%2FProvisioningManager.java?ref=0da02810041a4bbd5c0892a02924cf726a9e016e","previous_filename":"core/src/main/java/org/apache/syncope/core/provisioning/provisioning/ProvisioningManager.java"},{"sha":"32a4d18c4dafbd4263666f4c627a1de81c5e4a2f","filename":"core/src/main/java/org/apache/syncope/core/provisioning/UserProvisioningManager.java","status":"modified","additions":4,"deletions":0,"changes":4,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/0da02810041a4bbd5c0892a02924cf726a9e016e/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fprovisioning%2FUserProvisioningManager.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/0da02810041a4bbd5c0892a02924cf726a9e016e/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fprovisioning%2FUserProvisioningManager.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fprovisioning%2FUserProvisioningManager.java?ref=0da02810041a4bbd5c0892a02924cf726a9e016e","patch":"@@ -47,4 +47,8 @@ public interface UserProvisioningManager extends ProvisioningManager<UserTO, Use\n     \n     public void innerSuspend(SyncopeUser user, boolean suspend);\n     \n+    public void requestPasswordReset(final Long id);\n+    \n+    public void confirmPasswordReset(SyncopeUser user,final String token,final String password);\n+    \n }"},{"sha":"92b3cfb3dd190b1deca307c3a08426e555c0f8af","filename":"core/src/main/java/org/apache/syncope/core/provisioning/camel/CamelUserProvisioningManager.java","status":"modified","additions":33,"deletions":15,"changes":48,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/0da02810041a4bbd5c0892a02924cf726a9e016e/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fprovisioning%2Fcamel%2FCamelUserProvisioningManager.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/0da02810041a4bbd5c0892a02924cf726a9e016e/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fprovisioning%2Fcamel%2FCamelUserProvisioningManager.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fprovisioning%2Fcamel%2FCamelUserProvisioningManager.java?ref=0da02810041a4bbd5c0892a02924cf726a9e016e","patch":"@@ -18,11 +18,9 @@\n  */\n package org.apache.syncope.core.provisioning.camel;\n \n-import java.io.ByteArrayInputStream;\n import java.io.IOException;\n import java.io.InputStream;\n import java.io.Reader;\n-import java.net.URLDecoder;\n import java.util.AbstractMap;\n import java.util.ArrayList;\n import java.util.Collection;\n@@ -33,11 +31,6 @@\n import java.util.List;\n import java.util.Map;\n import java.util.Set;\n-import javax.xml.bind.JAXBContext;\n-import javax.xml.bind.JAXBElement;\n-import javax.xml.bind.Unmarshaller;\n-import javax.xml.parsers.DocumentBuilder;\n-import javax.xml.parsers.DocumentBuilderFactory;\n import org.apache.camel.CamelContext;\n import org.apache.camel.Endpoint;\n import org.apache.camel.Exchange;\n@@ -46,10 +39,7 @@\n import org.apache.camel.impl.DefaultCamelContext;\n import org.apache.camel.impl.DefaultExchange;\n import org.apache.camel.impl.DefaultMessage;\n-import org.apache.camel.model.Constants;\n-import org.apache.camel.model.RouteDefinition;\n import org.apache.camel.model.RoutesDefinition;\n-import org.apache.camel.spring.SpringCamelContext;\n import org.apache.syncope.common.mod.StatusMod;\n import org.apache.syncope.common.mod.UserMod;\n import org.apache.syncope.common.to.PropagationStatus;\n@@ -60,15 +50,11 @@\n import org.apache.syncope.core.propagation.PropagationByResource;\n import org.apache.syncope.core.provisioning.UserProvisioningManager;\n import org.apache.syncope.core.sync.SyncResult;\n-import org.apache.syncope.core.util.ApplicationContextProvider;\n import org.apache.syncope.core.workflow.WorkflowResult;\n import org.slf4j.Logger;\n import org.slf4j.LoggerFactory;\n import org.springframework.beans.factory.annotation.Autowired;\n-import org.w3c.dom.Document;\n-import org.w3c.dom.Element;\n-import org.w3c.dom.Node;\n-import org.w3c.dom.NodeList;\n+\n \n public class CamelUserProvisioningManager implements UserProvisioningManager {\n \n@@ -453,4 +439,36 @@ public void innerSuspend(SyncopeUser user, boolean suspend) {\n \n     }\n \n+    @Override\n+    public void requestPasswordReset(Long id) {\n+        String uri = \"direct:requestPwdResetPort\";\n+        PollingConsumer pollingConsumer = getConsumer(uri);\n+\n+        sendMessage(\"direct:requestPwdReset\", id);\n+        Exchange o = pollingConsumer.receive();\n+\n+        if (o.getProperty(Exchange.EXCEPTION_CAUGHT) != null) {\n+            throw (RuntimeException) o.getProperty(Exchange.EXCEPTION_CAUGHT);\n+        }\n+    }\n+\n+    @Override\n+    public void confirmPasswordReset(SyncopeUser user, final String token, final String password) {\n+        String uri = \"direct:confirmPwdResetPort\";\n+        PollingConsumer pollingConsumer = getConsumer(uri);\n+        \n+        Map<String, Object> props = new HashMap<String, Object>();\n+        props.put(\"user\", user);\n+        props.put(\"userId\", user.getId());\n+        props.put(\"token\", token);\n+        props.put(\"password\", password);\n+\n+        sendMessage(\"direct:confirmPwdReset\", user, props);\n+        Exchange o = pollingConsumer.receive();\n+\n+        if (o.getProperty(Exchange.EXCEPTION_CAUGHT) != null) {\n+            throw (RuntimeException) o.getProperty(Exchange.EXCEPTION_CAUGHT);\n+        }\n+    }\n+\n }"},{"sha":"244768933dd3b273bf683cfe89d95a289e6a3c1e","filename":"core/src/main/java/org/apache/syncope/core/provisioning/camel/processors/DefaultUserConfirmPwdResetPropagation.java","status":"added","additions":60,"deletions":0,"changes":60,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/0da02810041a4bbd5c0892a02924cf726a9e016e/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fprovisioning%2Fcamel%2Fprocessors%2FDefaultUserConfirmPwdResetPropagation.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/0da02810041a4bbd5c0892a02924cf726a9e016e/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fprovisioning%2Fcamel%2Fprocessors%2FDefaultUserConfirmPwdResetPropagation.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fprovisioning%2Fcamel%2Fprocessors%2FDefaultUserConfirmPwdResetPropagation.java?ref=0da02810041a4bbd5c0892a02924cf726a9e016e","patch":"@@ -0,0 +1,60 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *   http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+package org.apache.syncope.core.provisioning.camel.processors;\n+\n+import java.util.List;\n+import org.apache.camel.Exchange;\n+import org.apache.camel.Processor;\n+import org.apache.syncope.common.to.UserTO;\n+import org.apache.syncope.core.persistence.beans.PropagationTask;\n+import org.apache.syncope.core.persistence.beans.user.SyncopeUser;\n+import org.apache.syncope.core.propagation.PropagationException;\n+import org.apache.syncope.core.propagation.PropagationReporter;\n+import org.apache.syncope.core.propagation.PropagationTaskExecutor;\n+import org.apache.syncope.core.propagation.impl.PropagationManager;\n+import org.apache.syncope.core.util.ApplicationContextProvider;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+import org.springframework.beans.factory.annotation.Autowired;\n+\n+\n+public class DefaultUserConfirmPwdResetPropagation implements Processor{\n+\n+    private static final Logger LOG = LoggerFactory.getLogger(DefaultUserConfirmPwdResetPropagation.class);\n+    \n+    @Autowired\n+    protected PropagationManager propagationManager;\n+    @Autowired\n+    protected PropagationTaskExecutor taskExecutor;\n+    \n+    @Override\n+    public void process(Exchange exchange){\n+        SyncopeUser user = exchange.getProperty(\"user\", SyncopeUser.class);\n+\n+        List<PropagationTask> tasks = propagationManager.getUserUpdateTaskIds(user, null, null);\n+        PropagationReporter propReporter =\n+                ApplicationContextProvider.getApplicationContext().getBean(PropagationReporter.class);\n+        try {\n+            taskExecutor.execute(tasks, propReporter);\n+        } catch (PropagationException e) {\n+            LOG.error(\"Error propagation primary resource\", e);\n+            propReporter.onPrimaryResourceFailure(tasks);\n+        }                \n+    }\n+}"},{"sha":"606d46bdd483157de18a9b61be04fc2126a51a46","filename":"core/src/main/java/org/apache/syncope/core/rest/controller/UserController.java","status":"modified","additions":2,"deletions":71,"changes":73,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/0da02810041a4bbd5c0892a02924cf726a9e016e/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Frest%2Fcontroller%2FUserController.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/0da02810041a4bbd5c0892a02924cf726a9e016e/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Frest%2Fcontroller%2FUserController.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Frest%2Fcontroller%2FUserController.java?ref=0da02810041a4bbd5c0892a02924cf726a9e016e","patch":"@@ -26,7 +26,6 @@\n import java.util.Collection;\n import java.util.Collections;\n import java.util.HashSet;\n-import java.util.Iterator;\n import java.util.List;\n import java.util.Map;\n import java.util.Set;\n@@ -43,11 +42,8 @@\n import org.apache.syncope.common.types.ClientExceptionType;\n import org.apache.syncope.common.SyncopeClientException;\n import org.apache.syncope.common.mod.AttributeMod;\n-import org.apache.syncope.common.mod.MembershipMod;\n import org.apache.syncope.common.types.SubjectType;\n import org.apache.syncope.common.to.PropagationStatus;\n-import org.apache.syncope.core.persistence.beans.CamelRoute;\n-import org.apache.syncope.core.persistence.beans.PropagationTask;\n import org.apache.syncope.core.provisioning.UserProvisioningManager;\n import org.apache.syncope.core.persistence.beans.role.SyncopeRole;\n import org.apache.syncope.core.persistence.beans.user.SyncopeUser;\n@@ -57,18 +53,11 @@\n import org.apache.syncope.core.persistence.dao.RoleDAO;\n import org.apache.syncope.core.persistence.dao.UserDAO;\n import org.apache.syncope.core.persistence.dao.search.OrderByClause;\n-import org.apache.syncope.core.propagation.PropagationByResource;\n-import org.apache.syncope.core.propagation.PropagationException;\n-import org.apache.syncope.core.propagation.PropagationReporter;\n import org.apache.syncope.core.propagation.PropagationTaskExecutor;\n import org.apache.syncope.core.propagation.impl.PropagationManager;\n-import org.apache.syncope.core.provisioning.camel.CamelUserProvisioningManager;\n import org.apache.syncope.core.rest.data.AttributableTransformer;\n import org.apache.syncope.core.rest.data.UserDataBinder;\n-import org.apache.syncope.core.util.ApplicationContextProvider;\n import org.apache.syncope.core.util.EntitlementUtil;\n-import org.apache.syncope.core.workflow.WorkflowResult;\n-import org.apache.syncope.core.workflow.user.UserWorkflowAdapter;\n import org.springframework.beans.factory.annotation.Autowired;\n import org.springframework.security.access.prepost.PreAuthorize;\n import org.springframework.stereotype.Component;\n@@ -108,9 +97,6 @@ public class UserController extends AbstractSubjectController<UserTO, UserMod> {\n     @Autowired\n     protected AttributableTransformer attrTransformer;\n     \n-    @Autowired\n-    protected UserWorkflowAdapter uwfAdapter;\n-    \n     @Resource(name = \"defaultUserProvisioningManager\")\n     protected UserProvisioningManager provisioningManager;\n \n@@ -269,50 +255,6 @@ public UserTO update(final UserMod userMod) {\n             }\n         }\n         \n-        //Actual operations: workflow, propagation, notification\n-        /*WorkflowResult<Map.Entry<UserMod, Boolean>> updated = uwfAdapter.update(actual);\n-\n-        List<PropagationTask> tasks = propagationManager.getUserUpdateTaskIds(updated);\n-        if (tasks.isEmpty()) {\n-            // SYNCOPE-459: take care of user virtual attributes ...\n-            final PropagationByResource propByResVirAttr = binder.fillVirtual(\n-                    updated.getResult().getKey().getId(),\n-                    actual.getVirAttrsToRemove(),\n-                    actual.getVirAttrsToUpdate());\n-            // SYNCOPE-501: update only virtual attributes (if any of them changed), password propagation is\n-            // not required, take care also of membership virtual attributes\n-            boolean addOrUpdateMemberships = false;\n-            for (MembershipMod membershipMod : actual.getMembershipsToAdd()) {\n-                if (!binder.fillMembershipVirtual(\n-                        updated.getResult().getKey().getId(),\n-                        membershipMod.getRole(),\n-                        null,\n-                        membershipMod.getVirAttrsToRemove(),\n-                        membershipMod.getVirAttrsToUpdate(),\n-                        false).isEmpty()) {\n-\n-                    addOrUpdateMemberships = true;\n-                }\n-            }\n-            tasks.addAll(!propByResVirAttr.isEmpty() || addOrUpdateMemberships || removeMemberships\n-                    ? propagationManager.getUserUpdateTaskIds(updated, false, null)\n-                    : Collections.<PropagationTask>emptyList());\n-        }\n-\n-        PropagationReporter propagationReporter = ApplicationContextProvider.getApplicationContext().\n-                getBean(PropagationReporter.class);\n-\n-        if (!tasks.isEmpty()) {\n-            try {\n-                taskExecutor.execute(tasks, propagationReporter);\n-            } catch (PropagationException e) {\n-                LOG.error(\"Error propagation primary resource\", e);\n-                propagationReporter.onPrimaryResourceFailure(tasks);\n-            }\n-        }\n-\n-        final UserTO updatedTO = binder.getUserTO(updated.getResult().getKey().getId());\n-        updatedTO.getPropagationStatusTOs().addAll(propagationReporter.getStatuses());*/\n         Map.Entry<Long, List<PropagationStatus>> updated = provisioningManager.update(actual,removeMemberships);\n \n         final UserTO updatedTO = binder.getUserTO(updated.getKey());\n@@ -372,7 +314,7 @@ public void requestPasswordReset(final String username, final String securityAns\n             throw SyncopeClientException.build(ClientExceptionType.InvalidSecurityAnswer);\n         }\n \n-        uwfAdapter.requestPasswordReset(user.getId());\n+        provisioningManager.requestPasswordReset(user.getId());\n     }\n \n     @PreAuthorize(\"isAnonymous() or hasRole(T(org.apache.syncope.common.SyncopeConstants).ANONYMOUS_ENTITLEMENT)\")\n@@ -382,18 +324,7 @@ public void confirmPasswordReset(final String token, final String password) {\n         if (user == null) {\n             throw new NotFoundException(\"User with token \" + token);\n         }\n-\n-        uwfAdapter.confirmPasswordReset(user.getId(), token, password);\n-\n-        List<PropagationTask> tasks = propagationManager.getUserUpdateTaskIds(user, null, null);\n-        PropagationReporter propReporter =\n-                ApplicationContextProvider.getApplicationContext().getBean(PropagationReporter.class);\n-        try {\n-            taskExecutor.execute(tasks, propReporter);\n-        } catch (PropagationException e) {\n-            LOG.error(\"Error propagation primary resource\", e);\n-            propReporter.onPrimaryResourceFailure(tasks);\n-        }\n+        provisioningManager.confirmPasswordReset(user, token, password);\n     }\n \n     @PreAuthorize(\"isAuthenticated() \""},{"sha":"e1ad071cd5fbac947448b338483b5c05a110ba6c","filename":"core/src/main/resources/camelRoute.xml","status":"modified","additions":39,"deletions":1,"changes":40,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/0da02810041a4bbd5c0892a02924cf726a9e016e/core%2Fsrc%2Fmain%2Fresources%2FcamelRoute.xml","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/0da02810041a4bbd5c0892a02924cf726a9e016e/core%2Fsrc%2Fmain%2Fresources%2FcamelRoute.xml","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fsrc%2Fmain%2Fresources%2FcamelRoute.xml?ref=0da02810041a4bbd5c0892a02924cf726a9e016e","patch":"@@ -413,6 +413,43 @@ under the License.\n             </doTry>  \n         </route>\n         \n+        <!--\n+            REQUEST PASSWORD RESET ROUTE\n+        -->\n+        \n+        <route id=\"requestPwdReset\">\n+            <from uri=\"direct:requestPwdReset\"/>\n+            <doTry>\n+                <bean ref=\"uwfAdapter\" method=\"requestPasswordReset(${body})\"/>\n+                <to uri=\"direct:requestPwdResetPort\"/>\n+                <doCatch>        \n+                   <exception>java.lang.RuntimeException</exception>\n+                   <handled>\n+                       <constant>false</constant>\n+                   </handled>\n+                   <to uri=\"direct:requestPwdResetPort\"/>\n+                </doCatch>\n+            </doTry>  \n+        </route>\n+        <!--\n+            CONFIRM PASSWORD RESET\n+        -->\n+        <route id=\"confirmPwdReset\">\n+            <from uri=\"direct:confirmPwdReset\"/>\n+            <doTry>\n+              <bean ref=\"uwfAdapter\" method=\"confirmPasswordReset(${property.userId},${property.token},${property.password})\"/>\n+              <process ref=\"defaultUserConfirmPwdResetPropagation\" />\n+              <to uri=\"direct:confirmPwdResetPort\"/>\n+              <doCatch>        \n+                  <exception>java.lang.RuntimeException</exception>\n+                  <handled>\n+                      <constant>false</constant>\n+                  </handled>\n+                  <to uri=\"direct:confirmPwdResetPort\"/>\n+              </doCatch>\n+            </doTry>\n+        </route>\n+        \n     </routeContext>\n     <bean id=\"defaultUserCreatePropagation\" class=\"org.apache.syncope.core.provisioning.camel.processors.DefaultUserCreatePropagation\"/>\n     <bean id=\"defaultUserUpdatePropagation\" class=\"org.apache.syncope.core.provisioning.camel.processors.DefaultUserUpdatePropagation\"/>    \n@@ -422,9 +459,10 @@ under the License.\n     <bean id=\"defaultUserDeprovisionPropagation\" class=\"org.apache.syncope.core.provisioning.camel.processors.DefaultUserDeprovisionPropagation\"/>    \n     <bean id=\"defaultUserWFSuspendPropagation\" class=\"org.apache.syncope.core.provisioning.camel.processors.DefaultUserWFSuspendPropagation\"/>\n     <bean id=\"defaultUserStatusPropagation\" class=\"org.apache.syncope.core.provisioning.camel.processors.DefaultUserStatusPropagation\"/>\n+    <bean id=\"defaultUserConfirmPwdResetPropagation\" class=\"org.apache.syncope.core.provisioning.camel.processors.DefaultUserConfirmPwdResetPropagation\"/>\n     <bean id=\"defaultRoleCreatePropagation\" class=\"org.apache.syncope.core.provisioning.camel.processors.DefaultRoleCreatePropagation\"/>\n     <bean id=\"defaultRoleCreateSyncPropagation\" class=\"org.apache.syncope.core.provisioning.camel.processors.DefaultRoleCreateSyncPropagation\"/>\n     <bean id=\"defaultRoleUpdatePropagation\" class=\"org.apache.syncope.core.provisioning.camel.processors.DefaultRoleUpdatePropagation\"/>\n     <bean id=\"defaultRoleDeletePropagation\" class=\"org.apache.syncope.core.provisioning.camel.processors.DefaultRoleDeletePropagation\"/>    \n-    <bean id=\"defaultRoleDeprovisionPropagation\" class=\"org.apache.syncope.core.provisioning.camel.processors.DefaultRoleDeprovisionPropagation\"/>    \n+    <bean id=\"defaultRoleDeprovisionPropagation\" class=\"org.apache.syncope.core.provisioning.camel.processors.DefaultRoleDeprovisionPropagation\"/>            \n </beans>"},{"sha":"39506898f728e19620fcff75d9fe7106cc7170a6","filename":"core/src/main/resources/coreContext.xml","status":"modified","additions":1,"deletions":0,"changes":1,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/0da02810041a4bbd5c0892a02924cf726a9e016e/core%2Fsrc%2Fmain%2Fresources%2FcoreContext.xml","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/0da02810041a4bbd5c0892a02924cf726a9e016e/core%2Fsrc%2Fmain%2Fresources%2FcoreContext.xml","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fsrc%2Fmain%2Fresources%2FcoreContext.xml?ref=0da02810041a4bbd5c0892a02924cf726a9e016e","patch":"@@ -162,6 +162,7 @@ under the License.\n     <bean id=\"defaultUserDeprovisionPropagation\" class=\"org.apache.syncope.core.provisioning.camel.processors.DefaultUserDeprovisionPropagation\"/>    \n     <bean id=\"defaultUserWFSuspendPropagation\" class=\"org.apache.syncope.core.provisioning.camel.processors.DefaultUserWFSuspendPropagation\"/>\n     <bean id=\"defaultUserStatusPropagation\" class=\"org.apache.syncope.core.provisioning.camel.processors.DefaultUserStatusPropagation\"/>\n+    <bean id=\"defaultUserConfirmPwdResetPropagation\" class=\"org.apache.syncope.core.provisioning.camel.processors.DefaultUserConfirmPwdResetPropagation\"/>\n     <bean id=\"defaultRoleCreatePropagation\" class=\"org.apache.syncope.core.provisioning.camel.processors.DefaultRoleCreatePropagation\"/>\n     <bean id=\"defaultRoleCreateSyncPropagation\" class=\"org.apache.syncope.core.provisioning.camel.processors.DefaultRoleCreateSyncPropagation\"/>\n     <bean id=\"defaultRoleUpdatePropagation\" class=\"org.apache.syncope.core.provisioning.camel.processors.DefaultRoleUpdatePropagation\"/>"}]}