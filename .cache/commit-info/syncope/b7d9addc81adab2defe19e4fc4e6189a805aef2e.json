{"sha":"b7d9addc81adab2defe19e4fc4e6189a805aef2e","node_id":"MDY6Q29tbWl0NjM2ODc5MDYyOmI3ZDlhZGRjODFhZGFiMmRlZmUxOWU0ZmM0ZTYxODlhODA1YWVmMmU=","commit":{"author":{"name":"Francesco Chicchiriccò","email":"ilgrosso@apache.org","date":"2015-01-21T05:56:10Z"},"committer":{"name":"Francesco Chicchiriccò","email":"ilgrosso@apache.org","date":"2015-01-21T05:56:10Z"},"message":"Merge branch 'master' into 2_0_X","tree":{"sha":"c32a32ea77e3860407a0e6e6f0e30ee9e8896c29","url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/git/trees/c32a32ea77e3860407a0e6e6f0e30ee9e8896c29"},"url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/git/commits/b7d9addc81adab2defe19e4fc4e6189a805aef2e","comment_count":0,"verification":{"verified":false,"reason":"unsigned","signature":null,"payload":null}},"url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/b7d9addc81adab2defe19e4fc4e6189a805aef2e","html_url":"https://github.com/EnricoDAlessandro97UNI/syncope/commit/b7d9addc81adab2defe19e4fc4e6189a805aef2e","comments_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/b7d9addc81adab2defe19e4fc4e6189a805aef2e/comments","author":{"login":"ilgrosso","id":1064664,"node_id":"MDQ6VXNlcjEwNjQ2NjQ=","avatar_url":"https://avatars.githubusercontent.com/u/1064664?v=4","gravatar_id":"","url":"https://api.github.com/users/ilgrosso","html_url":"https://github.com/ilgrosso","followers_url":"https://api.github.com/users/ilgrosso/followers","following_url":"https://api.github.com/users/ilgrosso/following{/other_user}","gists_url":"https://api.github.com/users/ilgrosso/gists{/gist_id}","starred_url":"https://api.github.com/users/ilgrosso/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ilgrosso/subscriptions","organizations_url":"https://api.github.com/users/ilgrosso/orgs","repos_url":"https://api.github.com/users/ilgrosso/repos","events_url":"https://api.github.com/users/ilgrosso/events{/privacy}","received_events_url":"https://api.github.com/users/ilgrosso/received_events","type":"User","site_admin":false},"committer":{"login":"ilgrosso","id":1064664,"node_id":"MDQ6VXNlcjEwNjQ2NjQ=","avatar_url":"https://avatars.githubusercontent.com/u/1064664?v=4","gravatar_id":"","url":"https://api.github.com/users/ilgrosso","html_url":"https://github.com/ilgrosso","followers_url":"https://api.github.com/users/ilgrosso/followers","following_url":"https://api.github.com/users/ilgrosso/following{/other_user}","gists_url":"https://api.github.com/users/ilgrosso/gists{/gist_id}","starred_url":"https://api.github.com/users/ilgrosso/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ilgrosso/subscriptions","organizations_url":"https://api.github.com/users/ilgrosso/orgs","repos_url":"https://api.github.com/users/ilgrosso/repos","events_url":"https://api.github.com/users/ilgrosso/events{/privacy}","received_events_url":"https://api.github.com/users/ilgrosso/received_events","type":"User","site_admin":false},"parents":[{"sha":"961dfd372313151ef6a85bb96d2e4dbe01ab9f02","url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/961dfd372313151ef6a85bb96d2e4dbe01ab9f02","html_url":"https://github.com/EnricoDAlessandro97UNI/syncope/commit/961dfd372313151ef6a85bb96d2e4dbe01ab9f02"},{"sha":"336d8d6f29b96e25ea2994868d945c89c3ac3e91","url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/336d8d6f29b96e25ea2994868d945c89c3ac3e91","html_url":"https://github.com/EnricoDAlessandro97UNI/syncope/commit/336d8d6f29b96e25ea2994868d945c89c3ac3e91"}],"stats":{"total":79,"additions":42,"deletions":37},"files":[{"sha":"1f981acc92cdbccb049ca6f8eba3d2617f7fc1e6","filename":"core/src/test/java/org/apache/syncope/core/rest/ConfigurationTestITCase.java","status":"modified","additions":42,"deletions":37,"changes":79,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/b7d9addc81adab2defe19e4fc4e6189a805aef2e/core%2Fsrc%2Ftest%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Frest%2FConfigurationTestITCase.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/b7d9addc81adab2defe19e4fc4e6189a805aef2e/core%2Fsrc%2Ftest%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Frest%2FConfigurationTestITCase.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fsrc%2Ftest%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Frest%2FConfigurationTestITCase.java?ref=b7d9addc81adab2defe19e4fc4e6189a805aef2e","patch":"@@ -151,22 +151,22 @@ public void issueSYNCOPE418() {\n             assertTrue(e.getElements().iterator().next().contains(EntityViolationType.InvalidName.name()));\n         }\n     }\n-    \n+\n     @Test\n-    public void issueSYNCOPE629() throws IOException{\n+    public void issueSYNCOPE629() throws IOException {\n         SchemaTO membershipKey = new SchemaTO();\n-        membershipKey.setName(\"membershipKey\"+getUUIDString());\n+        membershipKey.setName(\"membershipKey\" + getUUIDString());\n         membershipKey.setType(AttributeSchemaType.String);\n         createSchema(AttributableType.MEMBERSHIP, SchemaType.NORMAL, membershipKey);\n-        \n+\n         SchemaTO roleKey = new SchemaTO();\n-        roleKey.setName(\"roleKey\"+getUUIDString());\n+        roleKey.setName(\"roleKey\" + getUUIDString());\n         roleKey.setType(AttributeSchemaType.String);\n-        createSchema(AttributableType.ROLE, SchemaType.NORMAL, roleKey);        \n-                \n+        createSchema(AttributableType.ROLE, SchemaType.NORMAL, roleKey);\n+\n         RoleTO roleTO = new RoleTO();\n         roleTO.setName(\"aRole\" + getUUIDString());\n-        roleTO.setParent(8L);        \n+        roleTO.setParent(8L);\n         // verify inheritance password and account policies\n         roleTO.setInheritAccountPolicy(false);\n         // not inherited so setter execution shouldn't be ignored\n@@ -176,39 +176,44 @@ public void issueSYNCOPE629() throws IOException{\n         roleTO.setPasswordPolicy(2L);\n         roleTO.getRAttrTemplates().add(\"icon\");\n         roleTO.getAttrs().add(attributeTO(\"icon\", \"anIcon\"));\n-        roleTO.getResources().add(RESOURCE_NAME_LDAP);       \n+        roleTO.getResources().add(RESOURCE_NAME_LDAP);\n         roleTO.getMAttrTemplates().add(membershipKey.getName());\n         roleTO.getRAttrTemplates().add(roleKey.getName());\n         RoleTO testRole = createRole(roleTO);\n-                       \n-        Response response = configurationService.export();\n-        assertNotNull(response);\n-        assertEquals(Response.Status.OK.getStatusCode(), response.getStatusInfo().getStatusCode());\n-        assertTrue(response.getMediaType().toString().startsWith(MediaType.TEXT_XML));\n-        String contentDisposition = response.getHeaderString(HttpHeaders.CONTENT_DISPOSITION);\n-        assertNotNull(contentDisposition);\n \n-        Object entity = response.getEntity();\n-        assertTrue(entity instanceof InputStream);\n-        String configExport = IOUtils.toString((InputStream) entity, SyncopeConstants.DEFAULT_ENCODING);\n-        assertFalse(configExport.isEmpty());\n-        assertTrue(configExport.length() > 1000);\n-        \n-        String[] result = StringUtils.substringsBetween(configExport, \"<RATTRTEMPLATE\", \"/>\");\n-        boolean rattrExists = false;\n-        for(String entry : result){\n-            if(entry.contains(roleKey.getName())) rattrExists = true;\n-        }\n-        assertTrue(rattrExists);\n-        \n-        result = StringUtils.substringsBetween(configExport, \"<MATTRTEMPLATE\", \"/>\");\n-        boolean mattrExists = false;\n-        for(String entry : result){\n-            if(entry.contains(membershipKey.getName())) mattrExists = true;\n+        try {\n+            Response response = configurationService.export();\n+            assertNotNull(response);\n+            assertEquals(Response.Status.OK.getStatusCode(), response.getStatusInfo().getStatusCode());\n+            assertTrue(response.getMediaType().toString().startsWith(MediaType.TEXT_XML));\n+            String contentDisposition = response.getHeaderString(HttpHeaders.CONTENT_DISPOSITION);\n+            assertNotNull(contentDisposition);\n+\n+            Object entity = response.getEntity();\n+            assertTrue(entity instanceof InputStream);\n+            String configExport = IOUtils.toString((InputStream) entity, SyncopeConstants.DEFAULT_ENCODING);\n+            assertFalse(configExport.isEmpty());\n+            assertTrue(configExport.length() > 1000);\n+\n+            String[] result = StringUtils.substringsBetween(configExport, \"<RATTRTEMPLATE\", \"/>\");\n+            boolean rattrExists = false;\n+            for (String entry : result) {\n+                if (entry.contains(roleKey.getName())) {\n+                    rattrExists = true;\n+                }\n+            }\n+            assertTrue(rattrExists);\n+\n+            result = StringUtils.substringsBetween(configExport, \"<MATTRTEMPLATE\", \"/>\");\n+            boolean mattrExists = false;\n+            for (String entry : result) {\n+                if (entry.contains(membershipKey.getName())) {\n+                    mattrExists = true;\n+                }\n+            }\n+            assertTrue(mattrExists);\n+        } finally {\n+            deleteRole(testRole.getId());\n         }\n-        assertTrue(mattrExists);\n-        \n-        deleteRole(testRole.getId());\n-\n     }\n }"}]}