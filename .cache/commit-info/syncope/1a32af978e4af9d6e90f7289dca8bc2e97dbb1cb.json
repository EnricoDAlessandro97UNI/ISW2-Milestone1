{"sha":"1a32af978e4af9d6e90f7289dca8bc2e97dbb1cb","node_id":"MDY6Q29tbWl0NjM2ODc5MDYyOjFhMzJhZjk3OGU0YWY5ZDZlOTBmNzI4OWRjYThiYzJlOTdkYmIxY2I=","commit":{"author":{"name":"Francesco Chicchiriccò","email":"ilgrosso@apache.org","date":"2013-03-28T11:08:12Z"},"committer":{"name":"Francesco Chicchiriccò","email":"ilgrosso@apache.org","date":"2013-03-28T11:08:12Z"},"message":"[SYNCOPE-137] Verified with all alternative JEE containers: modifications needed for WebLogic\n\ngit-svn-id: https://svn.apache.org/repos/asf/syncope/trunk@1462036 13f79535-47bb-0310-9956-ffa450edef68","tree":{"sha":"4ed9bfd98b913b1421dd44ad0b36ebdee0ba960a","url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/git/trees/4ed9bfd98b913b1421dd44ad0b36ebdee0ba960a"},"url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/git/commits/1a32af978e4af9d6e90f7289dca8bc2e97dbb1cb","comment_count":0,"verification":{"verified":false,"reason":"unsigned","signature":null,"payload":null}},"url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/1a32af978e4af9d6e90f7289dca8bc2e97dbb1cb","html_url":"https://github.com/EnricoDAlessandro97UNI/syncope/commit/1a32af978e4af9d6e90f7289dca8bc2e97dbb1cb","comments_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/1a32af978e4af9d6e90f7289dca8bc2e97dbb1cb/comments","author":{"login":"ilgrosso","id":1064664,"node_id":"MDQ6VXNlcjEwNjQ2NjQ=","avatar_url":"https://avatars.githubusercontent.com/u/1064664?v=4","gravatar_id":"","url":"https://api.github.com/users/ilgrosso","html_url":"https://github.com/ilgrosso","followers_url":"https://api.github.com/users/ilgrosso/followers","following_url":"https://api.github.com/users/ilgrosso/following{/other_user}","gists_url":"https://api.github.com/users/ilgrosso/gists{/gist_id}","starred_url":"https://api.github.com/users/ilgrosso/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ilgrosso/subscriptions","organizations_url":"https://api.github.com/users/ilgrosso/orgs","repos_url":"https://api.github.com/users/ilgrosso/repos","events_url":"https://api.github.com/users/ilgrosso/events{/privacy}","received_events_url":"https://api.github.com/users/ilgrosso/received_events","type":"User","site_admin":false},"committer":{"login":"ilgrosso","id":1064664,"node_id":"MDQ6VXNlcjEwNjQ2NjQ=","avatar_url":"https://avatars.githubusercontent.com/u/1064664?v=4","gravatar_id":"","url":"https://api.github.com/users/ilgrosso","html_url":"https://github.com/ilgrosso","followers_url":"https://api.github.com/users/ilgrosso/followers","following_url":"https://api.github.com/users/ilgrosso/following{/other_user}","gists_url":"https://api.github.com/users/ilgrosso/gists{/gist_id}","starred_url":"https://api.github.com/users/ilgrosso/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ilgrosso/subscriptions","organizations_url":"https://api.github.com/users/ilgrosso/orgs","repos_url":"https://api.github.com/users/ilgrosso/repos","events_url":"https://api.github.com/users/ilgrosso/events{/privacy}","received_events_url":"https://api.github.com/users/ilgrosso/received_events","type":"User","site_admin":false},"parents":[{"sha":"11deb24831dc17eb8fdba33caa16120f0092560e","url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/11deb24831dc17eb8fdba33caa16120f0092560e","html_url":"https://github.com/EnricoDAlessandro97UNI/syncope/commit/11deb24831dc17eb8fdba33caa16120f0092560e"}],"stats":{"total":98,"additions":82,"deletions":16},"files":[{"sha":"0493c34a23c0e8086227168acc0172fd2ece7d9a","filename":"core/pom.xml","status":"modified","additions":34,"deletions":16,"changes":50,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/1a32af978e4af9d6e90f7289dca8bc2e97dbb1cb/core%2Fpom.xml","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/1a32af978e4af9d6e90f7289dca8bc2e97dbb1cb/core%2Fpom.xml","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fpom.xml?ref=1a32af978e4af9d6e90f7289dca8bc2e97dbb1cb","patch":"@@ -504,14 +504,6 @@ under the License.\n             </configfiles>\n           </configuration>\n           <deployables>\n-            <deployable>\n-              <location>${cargo.run.dir}</location>\n-              <pingURL>http://localhost:${cargo.servlet.port}/syncope/rest/schema/user/list.xml</pingURL>\n-              <pingTimeout>60000</pingTimeout>\n-              <properties>\n-                <context>syncope</context>\n-              </properties>\n-            </deployable>\n             <deployable>\n               <groupId>org.connid.bundles.soap</groupId>\n               <artifactId>wssample</artifactId>\n@@ -528,6 +520,14 @@ under the License.\n                 <context>syncope-build-tools</context>\n               </properties>\n             </deployable>\n+            <deployable>\n+              <location>${cargo.run.dir}</location>\n+              <pingURL>http://localhost:${cargo.servlet.port}/syncope/rest/schema/user/list.xml</pingURL>\n+              <pingTimeout>60000</pingTimeout>\n+              <properties>\n+                <context>syncope</context>\n+              </properties>\n+            </deployable>\n           </deployables>\n         </configuration>\n         <executions>\n@@ -650,6 +650,7 @@ under the License.\n           <exclude>mysql/**</exclude>\n           <exclude>sqlserver/**</exclude>\n           <exclude>jboss/**</exclude>\n+          <exclude>weblogic/**</exclude>\n         </excludes>\n       </testResource>\n     </testResources>\n@@ -1304,11 +1305,18 @@ under the License.\n                 <phase>pre-integration-test</phase>\n                 <configuration>\n                   <target>\n+                    <!-- Needed because WebLogic has problems in running ApacheDS from the WAR archive -->\n                     <unzip src=\"${settings.localRepository}/org/apache/syncope/syncope-build-tools/${project.version}/syncope-build-tools-${project.version}.war\" \n                            dest=\"${project.build.directory}/syncope-build-tools-test\"/>\n+                    <!-- Needed because WebLogic is installed (H2 dependency cannot be injected via cargo) -->\n                     <copy file=\"${settings.localRepository}/com/h2database/h2/${h2.version}/h2-${h2.version}.jar\" \n                           todir=\"${project.build.directory}/syncope-build-tools-test/WEB-INF/lib\"\n                           overwrite=\"true\"/>\n+                    <!-- Needed because WebLogic deploys first core then build-tools: this JSP will just ask core to\n+                    reload all connectors -->\n+                    <copy file=\"${project.build.directory}/test-classes/conninstance-reload.jsp\" \n+                          todir=\"${project.build.directory}/syncope-build-tools-test\"\n+                          overwrite=\"true\"/>\n                   </target>\n                 </configuration>\n                 <goals>\n@@ -1337,14 +1345,6 @@ under the License.\n                 </properties>\n               </configuration>\n               <deployables>\n-                <deployable>\n-                  <location>${cargo.run.dir}</location>\n-                  <pingURL>http://localhost:${cargo.servlet.port}/syncope/rest/schema/user/list.xml</pingURL>\n-                  <pingTimeout>1200000</pingTimeout>\n-                  <properties>\n-                    <context>syncope</context>\n-                  </properties>\n-                </deployable>\n                 <deployable>\n                   <groupId>org.connid.bundles.soap</groupId>\n                   <artifactId>wssample</artifactId>\n@@ -1355,10 +1355,22 @@ under the License.\n                 </deployable>\n                 <deployable>\n                   <location>${project.build.directory}/syncope-build-tools-test</location>\n+                  <!-- build-tools are correctly deployed only when call to this JSP returns 200, e.g.\n+                  when connectors are reloaded by the core -->\n+                  <pingURL>http://localhost:${cargo.servlet.port}/syncope-build-tools/conninstance-reload.jsp</pingURL>\n+                  <pingTimeout>1200000</pingTimeout>\n                   <properties>\n                     <context>syncope-build-tools</context>\n                   </properties>\n                 </deployable>\n+                <deployable>\n+                  <location>${cargo.run.dir}</location>\n+                  <pingURL>http://localhost:${cargo.servlet.port}/syncope/rest/schema/user/list.xml</pingURL>\n+                  <pingTimeout>1200000</pingTimeout>\n+                  <properties>\n+                    <context>syncope</context>\n+                  </properties>\n+                </deployable>\n               </deployables>\n             </configuration>\n           </plugin>\n@@ -1380,6 +1392,12 @@ under the License.\n             </includes>            \n           </resource>\n         </resources>\n+        <testResources>\n+          <testResource>\n+            <directory>src/test/resources/weblogic</directory>\n+            <filtering>true</filtering>            \n+          </testResource>\n+        </testResources>\n       </build>\n     </profile>\n "},{"sha":"e3a003f99adc22289a0fafa11b87092be0f28b60","filename":"core/src/test/resources/weblogic/conninstance-reload.jsp","status":"added","additions":48,"deletions":0,"changes":48,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/1a32af978e4af9d6e90f7289dca8bc2e97dbb1cb/core%2Fsrc%2Ftest%2Fresources%2Fweblogic%2Fconninstance-reload.jsp","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/1a32af978e4af9d6e90f7289dca8bc2e97dbb1cb/core%2Fsrc%2Ftest%2Fresources%2Fweblogic%2Fconninstance-reload.jsp","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fsrc%2Ftest%2Fresources%2Fweblogic%2Fconninstance-reload.jsp?ref=1a32af978e4af9d6e90f7289dca8bc2e97dbb1cb","patch":"@@ -0,0 +1,48 @@\n+<%--\n+Licensed to the Apache Software Foundation (ASF) under one\n+or more contributor license agreements.  See the NOTICE file\n+distributed with this work for additional information\n+regarding copyright ownership.  The ASF licenses this file\n+to you under the Apache License, Version 2.0 (the\n+\"License\"); you may not use this file except in compliance\n+with the License.  You may obtain a copy of the License at\n+\n+  http://www.apache.org/licenses/LICENSE-2.0\n+\n+Unless required by applicable law or agreed to in writing,\n+software distributed under the License is distributed on an\n+\"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+KIND, either express or implied.  See the License for the\n+specific language governing permissions and limitations\n+under the License.\n+--%>\n+<%@page import=\"java.io.InputStreamReader\"%>\n+<%@page import=\"java.io.BufferedReader\"%>\n+<%@page import=\"java.io.InputStream\"%>\n+<%@page import=\"java.io.DataOutputStream\"%>\n+<%@page contentType=\"text/html; charset=UTF-8\" pageEncoding=\"UTF-8\"%>\n+<%@page import=\"java.net.HttpURLConnection\"%>\n+<%@page import=\"java.net.URLConnection\"%>\n+<%@page import=\"java.net.URL\"%>\n+<%\n+    String encodedAuth = new sun.misc.BASE64Encoder().encode(\"admin:password\".getBytes());\n+\n+    URL url = new URL(\"http://localhost:9080/syncope/rest/connector/reload.json\");\n+\n+    HttpURLConnection conn = (HttpURLConnection) url.openConnection();\n+    conn.setRequestMethod(\"POST\");\n+    conn.setRequestProperty(\"Content-Type\", \"application/x-www-form-urlencoded\");\n+    conn.setRequestProperty(\"Authorization\", \"Basic \" + encodedAuth);\n+    conn.setUseCaches(false);\n+    conn.setDoOutput(true);\n+\n+    InputStream is = conn.getInputStream();\n+    BufferedReader rd = new BufferedReader(new InputStreamReader(is));\n+    String line;\n+    StringBuilder res = new StringBuilder();\n+    while ((line = rd.readLine()) != null) {\n+        res.append(line);\n+        res.append('\\n');\n+    }\n+    rd.close();\n+%>"}]}