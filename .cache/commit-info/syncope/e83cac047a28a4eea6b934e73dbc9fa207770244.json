{"sha":"e83cac047a28a4eea6b934e73dbc9fa207770244","node_id":"MDY6Q29tbWl0NjM2ODc5MDYyOmU4M2NhYzA0N2EyOGE0ZWVhNmI5MzRlNzNkYmM5ZmEyMDc3NzAyNDQ=","commit":{"author":{"name":"Francesco Chicchiriccò","email":"ilgrosso@apache.org","date":"2016-09-08T10:25:50Z"},"committer":{"name":"Francesco Chicchiriccò","email":"ilgrosso@apache.org","date":"2016-09-08T10:25:50Z"},"message":"[SYNCOPE-753] Migration chapter in the reference guide","tree":{"sha":"266f5d5971446f590e019b970532029860ed6788","url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/git/trees/266f5d5971446f590e019b970532029860ed6788"},"url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/git/commits/e83cac047a28a4eea6b934e73dbc9fa207770244","comment_count":0,"verification":{"verified":false,"reason":"unsigned","signature":null,"payload":null}},"url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/e83cac047a28a4eea6b934e73dbc9fa207770244","html_url":"https://github.com/EnricoDAlessandro97UNI/syncope/commit/e83cac047a28a4eea6b934e73dbc9fa207770244","comments_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/e83cac047a28a4eea6b934e73dbc9fa207770244/comments","author":{"login":"ilgrosso","id":1064664,"node_id":"MDQ6VXNlcjEwNjQ2NjQ=","avatar_url":"https://avatars.githubusercontent.com/u/1064664?v=4","gravatar_id":"","url":"https://api.github.com/users/ilgrosso","html_url":"https://github.com/ilgrosso","followers_url":"https://api.github.com/users/ilgrosso/followers","following_url":"https://api.github.com/users/ilgrosso/following{/other_user}","gists_url":"https://api.github.com/users/ilgrosso/gists{/gist_id}","starred_url":"https://api.github.com/users/ilgrosso/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ilgrosso/subscriptions","organizations_url":"https://api.github.com/users/ilgrosso/orgs","repos_url":"https://api.github.com/users/ilgrosso/repos","events_url":"https://api.github.com/users/ilgrosso/events{/privacy}","received_events_url":"https://api.github.com/users/ilgrosso/received_events","type":"User","site_admin":false},"committer":{"login":"ilgrosso","id":1064664,"node_id":"MDQ6VXNlcjEwNjQ2NjQ=","avatar_url":"https://avatars.githubusercontent.com/u/1064664?v=4","gravatar_id":"","url":"https://api.github.com/users/ilgrosso","html_url":"https://github.com/ilgrosso","followers_url":"https://api.github.com/users/ilgrosso/followers","following_url":"https://api.github.com/users/ilgrosso/following{/other_user}","gists_url":"https://api.github.com/users/ilgrosso/gists{/gist_id}","starred_url":"https://api.github.com/users/ilgrosso/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ilgrosso/subscriptions","organizations_url":"https://api.github.com/users/ilgrosso/orgs","repos_url":"https://api.github.com/users/ilgrosso/repos","events_url":"https://api.github.com/users/ilgrosso/events{/privacy}","received_events_url":"https://api.github.com/users/ilgrosso/received_events","type":"User","site_admin":false},"parents":[{"sha":"a9c4d58380f1d4ef0f98fd00c388f31c51a34135","url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/a9c4d58380f1d4ef0f98fd00c388f31c51a34135","html_url":"https://github.com/EnricoDAlessandro97UNI/syncope/commit/a9c4d58380f1d4ef0f98fd00c388f31c51a34135"}],"stats":{"total":269,"additions":269,"deletions":0},"files":[{"sha":"8b8432cfd2f6b4b1cf3d8526ca2a5dc75ab8fe95","filename":"src/main/asciidoc/reference-guide/concepts/tasks.adoc","status":"modified","additions":8,"deletions":0,"changes":8,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/e83cac047a28a4eea6b934e73dbc9fa207770244/src%2Fmain%2Fasciidoc%2Freference-guide%2Fconcepts%2Ftasks.adoc","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/e83cac047a28a4eea6b934e73dbc9fa207770244/src%2Fmain%2Fasciidoc%2Freference-guide%2Fconcepts%2Ftasks.adoc","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/src%2Fmain%2Fasciidoc%2Freference-guide%2Fconcepts%2Ftasks.adoc?ref=e83cac047a28a4eea6b934e73dbc9fa207770244","patch":"@@ -97,6 +97,14 @@ the execution details - depending on the trace level set on the related\n <<external-resource-details,external resource>>.\n ====\n \n+[[dryrun]]\n+[TIP]\n+.DryRun\n+====\n+It is possible to simulate the execution of a pull (or push) task without performing any actual modification by\n+selecting the _DryRun_ option. The execution results will be still available for examination.\n+====\n+\n [[tasks-push]]\n ==== Push\n "},{"sha":"5d85c61dd04dc28d0922beb3d0e1ff7d78ef66a4","filename":"src/main/asciidoc/reference-guide/workingwithapachesyncope/migration.adoc","status":"added","additions":259,"deletions":0,"changes":259,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/e83cac047a28a4eea6b934e73dbc9fa207770244/src%2Fmain%2Fasciidoc%2Freference-guide%2Fworkingwithapachesyncope%2Fmigration.adoc","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/e83cac047a28a4eea6b934e73dbc9fa207770244/src%2Fmain%2Fasciidoc%2Freference-guide%2Fworkingwithapachesyncope%2Fmigration.adoc","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/src%2Fmain%2Fasciidoc%2Freference-guide%2Fworkingwithapachesyncope%2Fmigration.adoc?ref=e83cac047a28a4eea6b934e73dbc9fa207770244","patch":"@@ -0,0 +1,259 @@\n+//\n+// Licensed to the Apache Software Foundation (ASF) under one\n+// or more contributor license agreements.  See the NOTICE file\n+// distributed with this work for additional information\n+// regarding copyright ownership.  The ASF licenses this file\n+// to you under the Apache License, Version 2.0 (the\n+// \"License\"); you may not use this file except in compliance\n+// with the License.  You may obtain a copy of the License at\n+//\n+//   http://www.apache.org/licenses/LICENSE-2.0\n+//\n+// Unless required by applicable law or agreed to in writing,\n+// software distributed under the License is distributed on an\n+// \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+// KIND, either express or implied.  See the License for the\n+// specific language governing permissions and limitations\n+// under the License.\n+//\n+=== Migration from Apache Syncope 1.2\n+\n+Apache Syncope 2.0 brings\n+https://cwiki.apache.org/confluence/display/SYNCOPE/Jazz[several enhancements and new features^], compared to 1.2.\n+\n+For this reason, it is not possible to _update_ an existing 1.2 deployment but it is rather necessary to _migrate_ the\n+whole configuration, users and roles to a brand new 2.0 deployment.\n+\n+==== Preparation\n+\n+With reference to the\n+ifeval::[\"{backend}\" == \"html5\"]\n+http://syncope.apache.org/docs/getting-started.html[Apache Syncope Getting Started Guide,]\n+endif::[]\n+ifeval::[\"{backend}\" == \"pdf\"]\n+http://syncope.apache.org/docs/getting-started.pdf[Apache Syncope Getting Started Guide,]\n+endif::[]\n+perform the following steps:\n+\n+. Install the CLI application\n+. Create a new Maven project for Apache Syncope 2.0 then add the following dependency to `core/pom.xml`\n+\n+[source,xml,subs=\"verbatim,attributes\"]\n+----\n+<dependency>\n+  <groupId>org.apache.syncope.core</groupId>\n+  <artifactId>syncope-core-migration</artifactId>\n+  <version>{docVersion}</version>\n+</dependency>\n+----\n+\n+==== Migrate configuration\n+\n+[discrete]\n+===== Export configuration from 1.2\n+\n+First, export the configuration from the 1.2 deployment via\n+\n+....\n+curl -X GET -u username:password -o content.xml protocol://host:port/syncope/rest/configurations/stream\n+....\n+\n+where `username`, `password`, `protocol`, `host` and `port` reflect the Java EE container installation for the 1.2\n+deployment. +\n+The configuration of the 1.2 deployment is now in the `content.xml` file.\n+\n+[discrete]\n+===== Obtain configuration file for 2.0\n+\n+Now process the exported configuration of the 1.2 deployment to obtain a basic 2.0 configuration, by invoking the CLI as\n+follows:\n+\n+.On GNU / Linux - Mac OS X\n+....\n+./syncopeadm.sh migrate --conf /path/to/context.xml /dest/path/to/MasterContent.xml\n+....\n+\n+.On Windows\n+....\n+syncopeadm.bat migrate --conf \\path\\to\\context.xml \\dest\\path\\to\\MasterContent.xml\n+....\n+\n+The result of such invocation is the generated `MasterContent.xml` file and possibly an output message like as follows:\n+\n+....\n+You are running: migrate --conf /path/to/context.xml /dest/path/to/MasterContent.xml\n+\n+Virtual items, require manual intervention:\n+<?xml version='1.0' encoding='UTF-8'?><dataset>\n+  <VirSchema key=\"virtualdata\"/>\n+  <VirSchema key=\"virtualPropagation\"/>\n+  <VirSchema key=\"rvirtualdata\"/>\n+  <VirSchema key=\"mvirtualdata\"/>\n+  <VirSchema READONLY=\"1\" key=\"virtualReadOnly\"/>\n+  <MappingItem extAttrName=\"name\" mapping_id=\"1\" intAttrName=\"virtualdata\"\n+               mandatoryCondition=\"type == 'F'\" password=\"0\" purpose=\"BOTH\"/>\n+  <MappingItem password=\"0\" mapping_id=\"11\" extAttrName=\"givenname\"\n+               intAttrName=\"virtualReadOnly\" mandatoryCondition=\"false\" purpose=\"BOTH\"/>\n+  <MappingItem password=\"0\" mapping_id=\"11\" extAttrName=\"givenname\"\n+               intAttrName=\"virtualPropagation\" mandatoryCondition=\"false\" purpose=\"BOTH\"/>\n+  <MappingItem extAttrName=\"businessCategory\" mapping_id=\"1\"\n+               intAttrName=\"rvirtualdata\" mandatoryCondition=\"false\" password=\"0\" purpose=\"BOTH\"/>\n+  <MappingItem mapping_id=\"17\" password=\"0\" extAttrName=\"USERNAME\"\n+               intAttrName=\"virtualdata\" mandatoryCondition=\"false\" purpose=\"BOTH\"/>\n+  <MappingItem mapping_id=\"17\" password=\"0\" extAttrName=\"SURNAME\"\n+               intAttrName=\"virtualPropagation\" mandatoryCondition=\"false\" purpose=\"BOTH\"/>\n+</dataset>\n+\n+\n+ - Migration completed; file successfully created under /dest/path/to/MasterContent.xml\n+....\n+\n+<<virtual,Virtual schemas>> and associated <<mapping,mapping>> cannot be automatically migrated: take note of the\n+message above for further operations.\n+\n+[discrete]\n+===== Finalize configuration for 2.0\n+\n+After putting the generated `MasterContent.xml` file under the `core/src/test/resources/domains` folder in the new 2.0\n+Maven project, build and start in embedded mode, while always watching the log files under:\n+\n+* `core/target/log/`\n+* `console/target/log/`\n+* `enduser/target/log/`\n+\n+If errors are found, make appropriate corrections into `core/src/test/resources/domains/MasterContent.xml` - this might\n+involve migrating custom classes originally developed for 1.2 into their respective\n+<<customization-core,2.0 counterparts>>.\n+\n+When no exceptions are reported in the logs, log in the admin console and check if all configuration items\n+(schema definitions, external resources, notifications, ...) were correctly migrated. If anything is missing, take care\n+of re-adding manually.\n+\n+If using delegated administration under 1.2, reconstruct <<roles,roles>> and <<entitlements,entitlements>> under the\n+new security model.\n+\n+Now, define the virtual schema and mapping items according to the output message obtained above when invoking the\n+CLI.\n+\n+[WARNING]\n+If making modifications via the admin console, do not forget to <<deal-with-internal-storage-export-import,export>>\n+the updated configuration before shutting down the embedded mode, then use the downloaded file to update\n+`core/src/test/resources/domains/MasterContent.xml`.\n+\n+Finally, verify that all operations (create, updated, delete, propagate, sync / push) about users and roles used in the\n+1.2 deployment are working fine (create, updated, delete, propagate, pull / push) with users and groups in the 2.0\n+Maven project.\n+\n+When everything works as expected, <<deal-with-internal-storage-export-import,export>>\n+the updated configuration before shutting down the embedded mode and use the downloaded file to update both\n+`core/src/main/resources/domains/MasterContent.xml` and `core/src/test/resources/domains/MasterContent.xml`.\n+\n+==== Migrate users and roles\n+\n+After deploying the 2.0 Maven project into one of supported <<javaee-container,Java EE containers>>, with internal\n+storage set to one of supported <<dbms,DBMSes>>, ensure that the 1.2 deployment's internal storage DBMS is reachable.\n+\n+The steps below are to be performed on the 2.0 deployment.\n+\n+[discrete]\n+===== Define migration <<anytypeclass>>\n+\n+Create the following <<plain,plain schemas>>:\n+\n+. `migrationCipherAlgorithm` - string, read-only\n+. `migrationResources` - string, multi-value, read-only\n+. `migrationMemberships` - string, multi-value, read-only\n+\n+Then, define the `migration` AnyTypeClass and assign the three plain schemas above.\n+\n+[discrete]\n+===== Create migration <<connector-instance-details,Connector>>\n+\n+Create an instance of the https://connid.atlassian.net/wiki/display/BASE/Scripted+SQL[Scripted SQL^] bundle:\n+\n+. set connection details to the 1.2 deployment's internal storage DBMS\n+. download the Groovy\n+ifeval::[\"{snapshotOrRelease}\" == \"release\"]\n+https://github.com/apache/syncope/tree/syncope-{docVersion}/core/migration/src/main/resources/scripted[scripts^]\n+endif::[]\n+ifeval::[\"{snapshotOrRelease}\" == \"snapshot\"]\n+https://github.com/apache/syncope/tree/master/core/migration/src/main/resources/scripted[scripts^]\n+endif::[]\n+and configure accordingly\n+. assign the `SEARCH` and `SYNC` capabilities\n+\n+[discrete]\n+===== Create migration <<external-resource-details,External Resource>> and <<mapping>>\n+\n+Create an External Resource for the Connector created above, and set the <<provision,provisioning>> rules for:\n+\n+* `USER` as `\\\\__ACCOUNT__`, with at the least the following mapping:\n+|===\n+| Internal Attribute | External Attribute | Other\n+\n+| `username`\n+| `username`\n+| flagged as remote key, mandatory, purpose: `PULL`\n+\n+| `password`\n+|\n+| flagged as password, mandatory, purpose: `PULL`\n+\n+| `migrationCipherAlgorithm`\n+| `cipherAlgorithm`\n+| mandatory, purpose: `PULL`\n+\n+| `migrationResources`\n+| `\\\\__RESOURCES__`\n+| purpose: `PULL`\n+\n+|===\n+* `GROUP` as `\\\\__GROUP__`,  with at the least the following mapping:\n+|===\n+| Internal Attribute | External Attribute | Other\n+\n+| `name`\n+| `name`\n+| flagged as remote key, mandatory, purpose: `PULL`\n+\n+| `migrationResources`\n+| `\\\\__RESOURCES__`\n+| purpose: `PULL`\n+\n+| `migrationMemberships`\n+| `\\\\__MEMBERSHIPS__`\n+| mandatory, purpose: `PULL`\n+\n+|===\n+\n+[WARNING]\n+More attributes should be added to the mapping information in order to pull values from the 1.2 deployments.\n+\n+[discrete]\n+===== Setup migration <<tasks-pull,Pull Task>>\n+\n+Setup a pull task for the External Resource created above, set it for `FULL_RECONCILIATION` <<pull-mode,mode>> and\n+configure the \n+ifeval::[\"{snapshotOrRelease}\" == \"release\"]\n+https://github.com/apache/syncope/blob/syncope-{docVersion}/core/migration/src/main/java/org/apache/syncope/core/migration/MigrationPullActions.java[MigrationPullActions^]\n+endif::[]\n+ifeval::[\"{snapshotOrRelease}\" == \"snapshot\"]\n+https://github.com/apache/syncope/blob/master/core/migration/src/main/java/org/apache/syncope/core/migration/MigrationPullActions.java[MigrationPullActions^]\n+endif::[]\n+class among <<pullactions>>.\n+\n+[discrete]\n+===== Migrate\n+\n+Before actual migration, use the admin console features to explore the External Resource and check that all expected\n+information is reported.\n+\n+Another check to perform is to run the pull task set up above with the <<dryrun,DryRun>> option and watch the execution\n+results.\n+\n+Finally, execute the pull task and check the execution results.\n+\n+[TIP]\n+If the number of users and roles to import from the 1.2 deployment is high, it is suggested to change the pull mode to\n+`FILTERED_RECONCILIATION` for a relevant subset of entities to migrate, check the results and eventually switch back\n+to `FULL_RECONCILIATION`."},{"sha":"1ed9621d7767c5e9ed5b031c3c54418f187942f3","filename":"src/main/asciidoc/reference-guide/workingwithapachesyncope/workingwithapachesyncope.adoc","status":"modified","additions":2,"deletions":0,"changes":2,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/e83cac047a28a4eea6b934e73dbc9fa207770244/src%2Fmain%2Fasciidoc%2Freference-guide%2Fworkingwithapachesyncope%2Fworkingwithapachesyncope.adoc","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/e83cac047a28a4eea6b934e73dbc9fa207770244/src%2Fmain%2Fasciidoc%2Freference-guide%2Fworkingwithapachesyncope%2Fworkingwithapachesyncope.adoc","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/src%2Fmain%2Fasciidoc%2Freference-guide%2Fworkingwithapachesyncope%2Fworkingwithapachesyncope.adoc?ref=e83cac047a28a4eea6b934e73dbc9fa207770244","patch":"@@ -39,3 +39,5 @@ include::restfulservices.adoc[]\n include::customization.adoc[]\n \n include::systemadministration/systemadministration.adoc[]\n+\n+include::migration.adoc[]"}]}