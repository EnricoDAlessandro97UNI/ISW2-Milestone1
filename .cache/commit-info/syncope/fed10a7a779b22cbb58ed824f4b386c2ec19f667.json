{"sha":"fed10a7a779b22cbb58ed824f4b386c2ec19f667","node_id":"MDY6Q29tbWl0NjM2ODc5MDYyOmZlZDEwYTdhNzc5YjIyY2JiNThlZDgyNGY0YjM4NmMyZWMxOWY2Njc=","commit":{"author":{"name":"giacomolm","email":"giacomolm@hotmail.it","date":"2015-06-22T10:28:38Z"},"committer":{"name":"giacomolm","email":"giacomolm@hotmail.it","date":"2015-06-22T11:15:38Z"},"message":"[SYNCOPE-660]This closes #7","tree":{"sha":"a89fade71c9cf3ba1b77f86a7af67766fe84a6d3","url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/git/trees/a89fade71c9cf3ba1b77f86a7af67766fe84a6d3"},"url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/git/commits/fed10a7a779b22cbb58ed824f4b386c2ec19f667","comment_count":0,"verification":{"verified":false,"reason":"unsigned","signature":null,"payload":null}},"url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/fed10a7a779b22cbb58ed824f4b386c2ec19f667","html_url":"https://github.com/EnricoDAlessandro97UNI/syncope/commit/fed10a7a779b22cbb58ed824f4b386c2ec19f667","comments_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/fed10a7a779b22cbb58ed824f4b386c2ec19f667/comments","author":{"login":"giacomolm","id":4027829,"node_id":"MDQ6VXNlcjQwMjc4Mjk=","avatar_url":"https://avatars.githubusercontent.com/u/4027829?v=4","gravatar_id":"","url":"https://api.github.com/users/giacomolm","html_url":"https://github.com/giacomolm","followers_url":"https://api.github.com/users/giacomolm/followers","following_url":"https://api.github.com/users/giacomolm/following{/other_user}","gists_url":"https://api.github.com/users/giacomolm/gists{/gist_id}","starred_url":"https://api.github.com/users/giacomolm/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/giacomolm/subscriptions","organizations_url":"https://api.github.com/users/giacomolm/orgs","repos_url":"https://api.github.com/users/giacomolm/repos","events_url":"https://api.github.com/users/giacomolm/events{/privacy}","received_events_url":"https://api.github.com/users/giacomolm/received_events","type":"User","site_admin":false},"committer":{"login":"giacomolm","id":4027829,"node_id":"MDQ6VXNlcjQwMjc4Mjk=","avatar_url":"https://avatars.githubusercontent.com/u/4027829?v=4","gravatar_id":"","url":"https://api.github.com/users/giacomolm","html_url":"https://github.com/giacomolm","followers_url":"https://api.github.com/users/giacomolm/followers","following_url":"https://api.github.com/users/giacomolm/following{/other_user}","gists_url":"https://api.github.com/users/giacomolm/gists{/gist_id}","starred_url":"https://api.github.com/users/giacomolm/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/giacomolm/subscriptions","organizations_url":"https://api.github.com/users/giacomolm/orgs","repos_url":"https://api.github.com/users/giacomolm/repos","events_url":"https://api.github.com/users/giacomolm/events{/privacy}","received_events_url":"https://api.github.com/users/giacomolm/received_events","type":"User","site_admin":false},"parents":[{"sha":"69c0950ac4f7b5b97596920311e9d0d247f95df6","url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/69c0950ac4f7b5b97596920311e9d0d247f95df6","html_url":"https://github.com/EnricoDAlessandro97UNI/syncope/commit/69c0950ac4f7b5b97596920311e9d0d247f95df6"}],"stats":{"total":28,"additions":26,"deletions":2},"files":[{"sha":"52615ae341d2861b1826089f04e9ec1b481ca4f6","filename":"core/src/main/java/org/apache/syncope/core/quartz/AbstractTaskJob.java","status":"modified","additions":15,"deletions":1,"changes":16,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/fed10a7a779b22cbb58ed824f4b386c2ec19f667/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fquartz%2FAbstractTaskJob.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/fed10a7a779b22cbb58ed824f4b386c2ec19f667/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fquartz%2FAbstractTaskJob.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fquartz%2FAbstractTaskJob.java?ref=fed10a7a779b22cbb58ed824f4b386c2ec19f667","patch":"@@ -29,6 +29,7 @@\n import org.apache.syncope.core.notification.NotificationManager;\n import org.apache.syncope.core.persistence.beans.Task;\n import org.apache.syncope.core.persistence.beans.TaskExec;\n+import org.apache.syncope.core.persistence.dao.ConfDAO;\n import org.apache.syncope.core.persistence.dao.TaskDAO;\n import org.apache.syncope.core.persistence.dao.TaskExecDAO;\n import org.apache.syncope.core.util.ExceptionUtil;\n@@ -80,6 +81,12 @@ public enum Status {\n     @Autowired\n     private TaskExecDAO taskExecDAO;\n \n+    /**\n+     * Configuration DAO.\n+     */\n+    @Autowired\n+    private ConfDAO confDAO;\n+\n     /**\n      * Notification manager.\n      */\n@@ -194,9 +201,16 @@ public void interrupt() throws UnableToInterruptJobException {\n             LOG.info(\"Interrupting job time {} \", (new SimpleDateFormat(SyncopeConstants.DEFAULT_DATE_PATTERN, Locale.\n                     getDefault())).format(new Date()));\n             thread.interrupt();\n+            if (thread.isAlive()) {                \n+                long maxRetry = confDAO.find(\"tasks.interruptMaxRetries\", \"0\").getValues().get(0).getLongValue();\n+                for (int i = 0; i <= maxRetry && thread.isAlive(); i++) {\n+                    thread.interrupt();\n+                }\n+                //if the thread is still alive, it should be available in the next stop\n+                if(thread.isAlive()) this.runningThread.set(thread);\n+            }\n         } else {\n             LOG.warn(\"Unable to retrieve the right thread related to the current job execution\");\n         }\n     }\n-;\n }"},{"sha":"90a17cdf844e9f64f1bad107d86ace8eb6f10b83","filename":"core/src/main/resources/content.xml","status":"modified","additions":5,"deletions":0,"changes":5,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/fed10a7a779b22cbb58ed824f4b386c2ec19f667/core%2Fsrc%2Fmain%2Fresources%2Fcontent.xml","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/fed10a7a779b22cbb58ed824f4b386c2ec19f667/core%2Fsrc%2Fmain%2Fresources%2Fcontent.xml","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fsrc%2Fmain%2Fresources%2Fcontent.xml?ref=fed10a7a779b22cbb58ed824f4b386c2ec19f667","patch":"@@ -77,6 +77,11 @@ under the License.\n            mandatoryCondition=\"true\" multivalue=\"0\" uniqueConstraint=\"0\" readonly=\"0\"/>\n   <CAttr id=\"11\" owner_id=\"1\" schema_name=\"log.lastlogindate\"/>\n   <CAttrValue id=\"11\" attribute_id=\"11\" booleanValue=\"1\"/>\n+ \n+  <CSchema name=\"tasks.interruptMaxRetries\" type=\"Long\"\n+               mandatoryCondition=\"true\" multivalue=\"0\" uniqueConstraint=\"0\" readonly=\"0\"/>\n+  <CAttr id=\"12\" owner_id=\"1\" schema_name=\"tasks.interruptMaxRetries\"/>\n+  <CAttrValue id=\"12\" attribute_id=\"12\" longValue=\"20\"/>\n \n   <!-- For usage with admin console -->\n   <CSchema name=\"admin.user.layout\" type=\"String\""},{"sha":"d1ec455b206a0cc1a0a8ee1bc68d8a17d826c5e8","filename":"core/src/test/resources/content.xml","status":"modified","additions":6,"deletions":1,"changes":7,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/fed10a7a779b22cbb58ed824f4b386c2ec19f667/core%2Fsrc%2Ftest%2Fresources%2Fcontent.xml","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/fed10a7a779b22cbb58ed824f4b386c2ec19f667/core%2Fsrc%2Ftest%2Fresources%2Fcontent.xml","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fsrc%2Ftest%2Fresources%2Fcontent.xml?ref=fed10a7a779b22cbb58ed824f4b386c2ec19f667","patch":"@@ -71,12 +71,17 @@ under the License.\n   <CAttr id=\"9\" owner_id=\"1\" schema_name=\"authentication.statuses\"/>\n   <CAttrValue id=\"9\" attribute_id=\"9\" stringValue=\"created\"/>\n   <CAttrValue id=\"10\" attribute_id=\"9\" stringValue=\"active\"/>\n-\n+  \n   <!-- Save user login date upon successful authentication -->\n   <CSchema name=\"log.lastlogindate\" type=\"Boolean\"\n            mandatoryCondition=\"true\" multivalue=\"0\" uniqueConstraint=\"0\" readonly=\"0\"/>\n   <CAttr id=\"11\" owner_id=\"1\" schema_name=\"log.lastlogindate\"/>\n   <CAttrValue id=\"11\" attribute_id=\"11\" booleanValue=\"1\"/>\n+  \n+  <CSchema name=\"tasks.interruptMaxRetries\" type=\"Long\"\n+               mandatoryCondition=\"true\" multivalue=\"0\" uniqueConstraint=\"0\" readonly=\"0\"/>\n+  <CAttr id=\"12\" owner_id=\"1\" schema_name=\"tasks.interruptMaxRetries\"/>\n+  <CAttrValue id=\"12\" attribute_id=\"12\" longValue=\"20\"/>\n \n   <!-- For usage with admin console -->\n   <CSchema name=\"admin.user.layout\" type=\"String\""}]}