{"sha":"ac6a7feba2865f7bfa37435d167ca766f99ed5bf","node_id":"MDY6Q29tbWl0NjM2ODc5MDYyOmFjNmE3ZmViYTI4NjVmN2JmYTM3NDM1ZDE2N2NhNzY2Zjk5ZWQ1YmY=","commit":{"author":{"name":"skylark17","email":"matteo.alessandroni@tirasa.net","date":"2017-08-07T12:29:57Z"},"committer":{"name":"skylark17","email":"matteo.alessandroni@tirasa.net","date":"2017-08-07T12:31:00Z"},"message":"[SYNCOPE-1096] 'download' and 'remove' buttons are now properly hidden or shown while editing a binary attribute","tree":{"sha":"386ea661df2f1661c37f31fdb5841ec80f2e56c8","url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/git/trees/386ea661df2f1661c37f31fdb5841ec80f2e56c8"},"url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/git/commits/ac6a7feba2865f7bfa37435d167ca766f99ed5bf","comment_count":0,"verification":{"verified":false,"reason":"unsigned","signature":null,"payload":null}},"url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/ac6a7feba2865f7bfa37435d167ca766f99ed5bf","html_url":"https://github.com/EnricoDAlessandro97UNI/syncope/commit/ac6a7feba2865f7bfa37435d167ca766f99ed5bf","comments_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/ac6a7feba2865f7bfa37435d167ca766f99ed5bf/comments","author":{"login":"mat-ale","id":25547301,"node_id":"MDQ6VXNlcjI1NTQ3MzAx","avatar_url":"https://avatars.githubusercontent.com/u/25547301?v=4","gravatar_id":"","url":"https://api.github.com/users/mat-ale","html_url":"https://github.com/mat-ale","followers_url":"https://api.github.com/users/mat-ale/followers","following_url":"https://api.github.com/users/mat-ale/following{/other_user}","gists_url":"https://api.github.com/users/mat-ale/gists{/gist_id}","starred_url":"https://api.github.com/users/mat-ale/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mat-ale/subscriptions","organizations_url":"https://api.github.com/users/mat-ale/orgs","repos_url":"https://api.github.com/users/mat-ale/repos","events_url":"https://api.github.com/users/mat-ale/events{/privacy}","received_events_url":"https://api.github.com/users/mat-ale/received_events","type":"User","site_admin":false},"committer":{"login":"mat-ale","id":25547301,"node_id":"MDQ6VXNlcjI1NTQ3MzAx","avatar_url":"https://avatars.githubusercontent.com/u/25547301?v=4","gravatar_id":"","url":"https://api.github.com/users/mat-ale","html_url":"https://github.com/mat-ale","followers_url":"https://api.github.com/users/mat-ale/followers","following_url":"https://api.github.com/users/mat-ale/following{/other_user}","gists_url":"https://api.github.com/users/mat-ale/gists{/gist_id}","starred_url":"https://api.github.com/users/mat-ale/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mat-ale/subscriptions","organizations_url":"https://api.github.com/users/mat-ale/orgs","repos_url":"https://api.github.com/users/mat-ale/repos","events_url":"https://api.github.com/users/mat-ale/events{/privacy}","received_events_url":"https://api.github.com/users/mat-ale/received_events","type":"User","site_admin":false},"parents":[{"sha":"a9067216005f2daeec0d44e891a2c9f129febf5e","url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/a9067216005f2daeec0d44e891a2c9f129febf5e","html_url":"https://github.com/EnricoDAlessandro97UNI/syncope/commit/a9067216005f2daeec0d44e891a2c9f129febf5e"}],"stats":{"total":29,"additions":21,"deletions":8},"files":[{"sha":"eae8a2dd71b7878a1722b119920201e96debff28","filename":"client/console/src/main/java/org/apache/syncope/client/console/wicket/markup/html/form/BinaryFieldPanel.java","status":"modified","additions":21,"deletions":8,"changes":29,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/ac6a7feba2865f7bfa37435d167ca766f99ed5bf/client%2Fconsole%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fclient%2Fconsole%2Fwicket%2Fmarkup%2Fhtml%2Fform%2FBinaryFieldPanel.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/ac6a7feba2865f7bfa37435d167ca766f99ed5bf/client%2Fconsole%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fclient%2Fconsole%2Fwicket%2Fmarkup%2Fhtml%2Fform%2FBinaryFieldPanel.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/client%2Fconsole%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fclient%2Fconsole%2Fwicket%2Fmarkup%2Fhtml%2Fform%2FBinaryFieldPanel.java?ref=ac6a7feba2865f7bfa37435d167ca766f99ed5bf","patch":"@@ -80,6 +80,10 @@ public class BinaryFieldPanel extends FieldPanel<String> {\n \n     private final AbstractBinaryPreviewer previewer;\n \n+    private final Label previewLabel;\n+\n+    private final IndicatingAjaxLink<Void> resetLink;\n+\n     public BinaryFieldPanel(final String id, final String name, final IModel<String> model, final String mimeType) {\n         super(id, name, model);\n         this.mimeType = mimeType;\n@@ -125,7 +129,8 @@ public String build() {\n         field = new TextField<>(\"textField\", model);\n         add(field.setLabel(new Model<>(name)).setOutputMarkupId(true));\n \n-        uploadForm.add(new Label(\"preview\", StringUtils.isBlank(mimeType) ? StringUtils.EMPTY : \"(\" + mimeType + \")\"));\n+        previewLabel = new Label(\"preview\", StringUtils.isBlank(mimeType) ? StringUtils.EMPTY : \"(\" + mimeType + \")\");\n+        uploadForm.add(previewLabel);\n \n         fileDownload = new AjaxDownload(name, true) {\n \n@@ -187,15 +192,16 @@ protected void onSubmit(final AjaxRequestTarget target) {\n                         uploadForm.addOrReplace(fileUpload);\n                     }\n \n+                    setVisiblePhotoButtons(StringUtils.isNotBlank(uploaded));\n                     downloadLink.setEnabled(StringUtils.isNotBlank(uploaded));\n \n-                    target.add(container);\n+                    target.add(uploadForm);\n                 }\n             }\n         });\n         uploadForm.add(fileUpload);\n \n-        IndicatingAjaxLink<Void> resetLink = new IndicatingAjaxLink<Void>(\"resetLink\") {\n+        resetLink = new IndicatingAjaxLink<Void>(\"resetLink\") {\n \n             private static final long serialVersionUID = -7978723352517770644L;\n \n@@ -205,7 +211,7 @@ public void onClick(final AjaxRequestTarget target) {\n                 target.add(field);\n                 downloadLink.setEnabled(false);\n                 container.addOrReplace(emptyFragment);\n-                uploadForm.addOrReplace(container);\n+                setVisiblePhotoButtons(false);\n                 target.add(uploadForm);\n             }\n \n@@ -230,6 +236,12 @@ private void changePreviewer(final Component panelPreview) {\n         uploadForm.addOrReplace(container);\n     }\n \n+    private void setVisiblePhotoButtons(final boolean visible) {\n+        previewLabel.setVisible(visible);\n+        resetLink.setVisible(visible);\n+        downloadLink.setVisible(visible);\n+    }\n+\n     @Override\n     public BinaryFieldPanel clone() {\n         return (BinaryFieldPanel) super.clone();\n@@ -238,22 +250,23 @@ public BinaryFieldPanel clone() {\n     @Override\n     public FieldPanel<String> setNewModel(final IModel<String> model) {\n         field.setModel(model);\n+        String modelObj = model.getObject();\n \n-        if (StringUtils.isNotBlank(model.getObject())) {\n+        if (StringUtils.isNotBlank(modelObj)) {\n             final Component panelPreview;\n             if (previewer == null) {\n                 panelPreview = PREVIEW_UTILS.getDefaultPreviewer(mimeType);\n             } else {\n-                panelPreview = previewer.preview(model.getObject());\n+                panelPreview = previewer.preview(modelObj);\n             }\n \n             if (panelPreview != null) {\n                 changePreviewer(panelPreview);\n             }\n         }\n \n-        downloadLink.setEnabled(StringUtils.isNotBlank(model.getObject()));\n-        uploadForm.addOrReplace(downloadLink);\n+        downloadLink.setEnabled(StringUtils.isNotBlank(modelObj));\n+        setVisiblePhotoButtons(StringUtils.isNotBlank(modelObj));\n         return this;\n     }\n }"}]}