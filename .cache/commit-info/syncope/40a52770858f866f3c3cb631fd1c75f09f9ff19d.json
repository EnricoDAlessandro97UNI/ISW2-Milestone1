{"sha":"40a52770858f866f3c3cb631fd1c75f09f9ff19d","node_id":"MDY6Q29tbWl0NjM2ODc5MDYyOjQwYTUyNzcwODU4Zjg2NmYzYzNjYjYzMWZkMWM3NWYwOWY5ZmYxOWQ=","commit":{"author":{"name":"Unknown","email":"unknown@apache.org","date":"2010-07-01T06:45:07Z"},"committer":{"name":"Unknown","email":"unknown@apache.org","date":"2010-07-01T06:45:07Z"},"message":"Added missing relationship test between Schema and SchemaMapping\n\ngit-svn-id: https://svn.apache.org/repos/asf/incubator/syncope/trunk@1246305 13f79535-47bb-0310-9956-ffa450edef68","tree":{"sha":"e37e381b15cacba797d1e0bfe8bf0237f00f75cb","url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/git/trees/e37e381b15cacba797d1e0bfe8bf0237f00f75cb"},"url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/git/commits/40a52770858f866f3c3cb631fd1c75f09f9ff19d","comment_count":0,"verification":{"verified":false,"reason":"unsigned","signature":null,"payload":null}},"url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/40a52770858f866f3c3cb631fd1c75f09f9ff19d","html_url":"https://github.com/EnricoDAlessandro97UNI/syncope/commit/40a52770858f866f3c3cb631fd1c75f09f9ff19d","comments_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/40a52770858f866f3c3cb631fd1c75f09f9ff19d/comments","author":null,"committer":null,"parents":[{"sha":"9aa86f53ac6ace1dd0b83ce34d8cad4a37ea8918","url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/9aa86f53ac6ace1dd0b83ce34d8cad4a37ea8918","html_url":"https://github.com/EnricoDAlessandro97UNI/syncope/commit/9aa86f53ac6ace1dd0b83ce34d8cad4a37ea8918"}],"stats":{"total":50,"additions":38,"deletions":12},"files":[{"sha":"ab59f5d9341d47ebc94698b19ac3f3964302a007","filename":"core/src/main/java/org/syncope/core/persistence/beans/role/RoleSchema.java","status":"modified","additions":8,"deletions":5,"changes":13,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/40a52770858f866f3c3cb631fd1c75f09f9ff19d/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fcore%2Fpersistence%2Fbeans%2Frole%2FRoleSchema.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/40a52770858f866f3c3cb631fd1c75f09f9ff19d/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fcore%2Fpersistence%2Fbeans%2Frole%2FRoleSchema.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fcore%2Fpersistence%2Fbeans%2Frole%2FRoleSchema.java?ref=40a52770858f866f3c3cb631fd1c75f09f9ff19d","patch":"@@ -16,6 +16,7 @@\n \n import java.util.HashSet;\n import java.util.Set;\n+import javax.persistence.CascadeType;\n import javax.persistence.Entity;\n import javax.persistence.FetchType;\n import javax.persistence.ManyToMany;\n@@ -30,14 +31,12 @@ public class RoleSchema extends AbstractSchema {\n \n     @OneToMany(fetch = FetchType.EAGER, mappedBy = \"schema\")\n     Set<RoleAttribute> attributes;\n-\n     @ManyToMany(mappedBy = \"schemas\")\n     Set<RoleDerivedSchema> derivedSchemas;\n-\n     /**\n      * All the mappings of the attribute schema.\n      */\n-    @OneToMany(cascade = javax.persistence.CascadeType.ALL,\n+    @OneToMany(cascade = CascadeType.ALL,\n     fetch = FetchType.EAGER, mappedBy = \"roleSchema\")\n     Set<SchemaMapping> mappings;\n \n@@ -104,13 +103,17 @@ public void setMappings(Set<SchemaMapping> mappings) {\n \n     @Override\n     public boolean addMapping(SchemaMapping mapping) {\n-        if (this.mappings == null) this.mappings = new HashSet<SchemaMapping>();\n+        if (this.mappings == null) {\n+            this.mappings = new HashSet<SchemaMapping>();\n+        }\n         return this.mappings.add(mapping);\n     }\n \n     @Override\n     public boolean removeMapping(SchemaMapping mapping) {\n-        if (this.mappings == null) this.mappings = new HashSet<SchemaMapping>();\n+        if (this.mappings == null) {\n+            this.mappings = new HashSet<SchemaMapping>();\n+        }\n         return this.mappings.remove(mapping);\n     }\n }"},{"sha":"0a8495c9d0dccc4f847467239c610b0d060cbf9b","filename":"core/src/main/java/org/syncope/core/persistence/beans/user/UserSchema.java","status":"modified","additions":8,"deletions":5,"changes":13,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/40a52770858f866f3c3cb631fd1c75f09f9ff19d/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fcore%2Fpersistence%2Fbeans%2Fuser%2FUserSchema.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/40a52770858f866f3c3cb631fd1c75f09f9ff19d/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fcore%2Fpersistence%2Fbeans%2Fuser%2FUserSchema.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fcore%2Fpersistence%2Fbeans%2Fuser%2FUserSchema.java?ref=40a52770858f866f3c3cb631fd1c75f09f9ff19d","patch":"@@ -16,6 +16,7 @@\n \n import java.util.HashSet;\n import java.util.Set;\n+import javax.persistence.CascadeType;\n import javax.persistence.Entity;\n import javax.persistence.FetchType;\n import javax.persistence.ManyToMany;\n@@ -30,14 +31,12 @@ public class UserSchema extends AbstractSchema {\n \n     @OneToMany(fetch = FetchType.EAGER, mappedBy = \"schema\")\n     Set<UserAttribute> attributes;\n-\n     @ManyToMany(mappedBy = \"schemas\")\n     Set<UserDerivedSchema> derivedSchemas;\n-\n     /**\n      * All the mappings of the attribute schema.\n      */\n-    @OneToMany(cascade = javax.persistence.CascadeType.ALL,\n+    @OneToMany(cascade = CascadeType.ALL,\n     fetch = FetchType.EAGER, mappedBy = \"userSchema\")\n     Set<SchemaMapping> mappings;\n \n@@ -104,13 +103,17 @@ public void setMappings(Set<SchemaMapping> mappings) {\n \n     @Override\n     public boolean addMapping(SchemaMapping mapping) {\n-        if (this.mappings == null) this.mappings = new HashSet<SchemaMapping>();\n+        if (this.mappings == null) {\n+            this.mappings = new HashSet<SchemaMapping>();\n+        }\n         return this.mappings.add(mapping);\n     }\n \n     @Override\n     public boolean removeMapping(SchemaMapping mapping) {\n-        if (this.mappings == null) this.mappings = new HashSet<SchemaMapping>();\n+        if (this.mappings == null) {\n+            this.mappings = new HashSet<SchemaMapping>();\n+        }\n         return this.mappings.remove(mapping);\n     }\n }"},{"sha":"468a85d927f061b278e93a3f908dbf9332347d96","filename":"core/src/main/java/org/syncope/core/persistence/dao/impl/SchemaDAOImpl.java","status":"modified","additions":9,"deletions":0,"changes":9,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/40a52770858f866f3c3cb631fd1c75f09f9ff19d/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fcore%2Fpersistence%2Fdao%2Fimpl%2FSchemaDAOImpl.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/40a52770858f866f3c3cb631fd1c75f09f9ff19d/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fcore%2Fpersistence%2Fdao%2Fimpl%2FSchemaDAOImpl.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fcore%2Fpersistence%2Fdao%2Fimpl%2FSchemaDAOImpl.java?ref=40a52770858f866f3c3cb631fd1c75f09f9ff19d","patch":"@@ -24,6 +24,8 @@\n import org.syncope.core.persistence.beans.AbstractDerivedSchema;\n import org.syncope.core.persistence.beans.AbstractSchema;\n import org.syncope.core.persistence.beans.SchemaMapping;\n+import org.syncope.core.persistence.beans.role.RoleSchema;\n+import org.syncope.core.persistence.beans.user.UserSchema;\n import org.syncope.core.persistence.dao.AttributeDAO;\n import org.syncope.core.persistence.dao.SchemaDAO;\n import org.syncope.core.persistence.dao.SchemaMappingDAO;\n@@ -76,6 +78,13 @@ public <T extends AbstractSchema> void delete(\n         }\n \n         for (SchemaMapping schemaMapping : schema.getMappings()) {\n+            if (schema instanceof UserSchema) {\n+                schemaMapping.setUserSchema(null);\n+            }\n+            if (schema instanceof RoleSchema) {\n+                schemaMapping.setRoleSchema(null);\n+            }\n+\n             schemaMappingDAO.delete(schemaMapping.getId());\n         }\n         schema.setMappings(Collections.EMPTY_SET);"},{"sha":"d1377e69466fb3767e49f8ebf2e3a3697133ffb0","filename":"core/src/test/java/org/syncope/core/test/persistence/relationships/SchemaTest.java","status":"modified","additions":12,"deletions":1,"changes":13,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/40a52770858f866f3c3cb631fd1c75f09f9ff19d/core%2Fsrc%2Ftest%2Fjava%2Forg%2Fsyncope%2Fcore%2Ftest%2Fpersistence%2Frelationships%2FSchemaTest.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/40a52770858f866f3c3cb631fd1c75f09f9ff19d/core%2Fsrc%2Ftest%2Fjava%2Forg%2Fsyncope%2Fcore%2Ftest%2Fpersistence%2Frelationships%2FSchemaTest.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fsrc%2Ftest%2Fjava%2Forg%2Fsyncope%2Fcore%2Ftest%2Fpersistence%2Frelationships%2FSchemaTest.java?ref=40a52770858f866f3c3cb631fd1c75f09f9ff19d","patch":"@@ -44,7 +44,7 @@ public class SchemaTest extends AbstractTest {\n     private SchemaMappingDAO schemaMappingDAO;\n \n     @Test\n-    public final void test() {\n+    public final void test1() {\n         // 1\n         schemaDAO.delete(\"username\", UserSchema.class);\n \n@@ -65,4 +65,15 @@ public final void test() {\n         assertEquals(1, derivedSchemaDAO.find(\"cn\",\n                 UserDerivedSchema.class).getSchemas().size());\n     }\n+\n+    @Test\n+    public final void test2() {\n+        schemaDAO.delete(\"email\", UserSchema.class);\n+\n+        schemaDAO.getEntityManager().flush();\n+\n+        assertNull(schemaDAO.find(\"email\", UserSchema.class));\n+        assertNull(schemaMappingDAO.find(100L));\n+        assertNull(schemaMappingDAO.find(101L));\n+    }\n }"},{"sha":"a591ce10ef8834dfb0e66d74b1d588165b1d9c1a","filename":"core/src/test/resources/org/syncope/core/persistence/content.xml","status":"modified","additions":1,"deletions":1,"changes":2,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/40a52770858f866f3c3cb631fd1c75f09f9ff19d/core%2Fsrc%2Ftest%2Fresources%2Forg%2Fsyncope%2Fcore%2Fpersistence%2Fcontent.xml","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/40a52770858f866f3c3cb631fd1c75f09f9ff19d/core%2Fsrc%2Ftest%2Fresources%2Forg%2Fsyncope%2Fcore%2Fpersistence%2Fcontent.xml","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fsrc%2Ftest%2Fresources%2Forg%2Fsyncope%2Fcore%2Fpersistence%2Fcontent.xml?ref=40a52770858f866f3c3cb631fd1c75f09f9ff19d","patch":"@@ -101,7 +101,7 @@\n                    userSchema_name=\"email\" nullable=\"false\"\n                    accountid=\"true\" password=\"false\"/>\n \n-    <Entitlement name=\"base\" description=\"NULL\"/>\n+    <Entitlement name=\"base\"/>\n     <Entitlement name=\"advanced\" description=\"Advanced entitlement\"/>\n \n     <SyncopeRole_Entitlement entitlements_name=\"base\""}]}