{"sha":"af601327fde094928d9e3d0f99e65030822d237c","node_id":"MDY6Q29tbWl0NjM2ODc5MDYyOmFmNjAxMzI3ZmRlMDk0OTI4ZDllM2QwZjk5ZTY1MDMwODIyZDIzN2M=","commit":{"author":{"name":"Francesco Chicchiriccò","email":"ilgrosso@apache.org","date":"2013-03-01T11:00:32Z"},"committer":{"name":"Francesco Chicchiriccò","email":"ilgrosso@apache.org","date":"2013-03-01T11:00:32Z"},"message":"[SYNCOPE-327] Fixing messages related to Groovy and FOP by upgrading their respective versions + enabling known ThreadLocal cleanup via ServletRequestListener\n\ngit-svn-id: https://svn.apache.org/repos/asf/syncope/trunk@1451564 13f79535-47bb-0310-9956-ffa450edef68","tree":{"sha":"80de6150570ffb1593b49a04c43dd82ba5727a8c","url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/git/trees/80de6150570ffb1593b49a04c43dd82ba5727a8c"},"url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/git/commits/af601327fde094928d9e3d0f99e65030822d237c","comment_count":0,"verification":{"verified":false,"reason":"unsigned","signature":null,"payload":null}},"url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/af601327fde094928d9e3d0f99e65030822d237c","html_url":"https://github.com/EnricoDAlessandro97UNI/syncope/commit/af601327fde094928d9e3d0f99e65030822d237c","comments_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/af601327fde094928d9e3d0f99e65030822d237c/comments","author":{"login":"ilgrosso","id":1064664,"node_id":"MDQ6VXNlcjEwNjQ2NjQ=","avatar_url":"https://avatars.githubusercontent.com/u/1064664?v=4","gravatar_id":"","url":"https://api.github.com/users/ilgrosso","html_url":"https://github.com/ilgrosso","followers_url":"https://api.github.com/users/ilgrosso/followers","following_url":"https://api.github.com/users/ilgrosso/following{/other_user}","gists_url":"https://api.github.com/users/ilgrosso/gists{/gist_id}","starred_url":"https://api.github.com/users/ilgrosso/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ilgrosso/subscriptions","organizations_url":"https://api.github.com/users/ilgrosso/orgs","repos_url":"https://api.github.com/users/ilgrosso/repos","events_url":"https://api.github.com/users/ilgrosso/events{/privacy}","received_events_url":"https://api.github.com/users/ilgrosso/received_events","type":"User","site_admin":false},"committer":{"login":"ilgrosso","id":1064664,"node_id":"MDQ6VXNlcjEwNjQ2NjQ=","avatar_url":"https://avatars.githubusercontent.com/u/1064664?v=4","gravatar_id":"","url":"https://api.github.com/users/ilgrosso","html_url":"https://github.com/ilgrosso","followers_url":"https://api.github.com/users/ilgrosso/followers","following_url":"https://api.github.com/users/ilgrosso/following{/other_user}","gists_url":"https://api.github.com/users/ilgrosso/gists{/gist_id}","starred_url":"https://api.github.com/users/ilgrosso/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ilgrosso/subscriptions","organizations_url":"https://api.github.com/users/ilgrosso/orgs","repos_url":"https://api.github.com/users/ilgrosso/repos","events_url":"https://api.github.com/users/ilgrosso/events{/privacy}","received_events_url":"https://api.github.com/users/ilgrosso/received_events","type":"User","site_admin":false},"parents":[{"sha":"0b7fef8e539073a334e66f0b8ba8bb0e22f6301c","url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/0b7fef8e539073a334e66f0b8ba8bb0e22f6301c","html_url":"https://github.com/EnricoDAlessandro97UNI/syncope/commit/0b7fef8e539073a334e66f0b8ba8bb0e22f6301c"}],"stats":{"total":257,"additions":130,"deletions":127},"files":[{"sha":"fd58ad3b61d707b840e0d3daf48e588a098f9adf","filename":"archetype/src/main/resources/archetype-resources/console/pom.xml","status":"modified","additions":0,"deletions":20,"changes":20,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/af601327fde094928d9e3d0f99e65030822d237c/archetype%2Fsrc%2Fmain%2Fresources%2Farchetype-resources%2Fconsole%2Fpom.xml","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/af601327fde094928d9e3d0f99e65030822d237c/archetype%2Fsrc%2Fmain%2Fresources%2Farchetype-resources%2Fconsole%2Fpom.xml","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/archetype%2Fsrc%2Fmain%2Fresources%2Farchetype-resources%2Fconsole%2Fpom.xml?ref=af601327fde094928d9e3d0f99e65030822d237c","patch":"@@ -138,26 +138,6 @@ under the License.\n \r\n     <plugins>\r\n       \r\n-      <plugin>\r\n-        <groupId>org.codehaus.gmaven</groupId>\r\n-        <artifactId>gmaven-plugin</artifactId>\r\n-        <inherited>true</inherited>\r\n-        <executions>\r\n-          <execution>\r\n-            <phase>generate-resources</phase>\r\n-            <goals>\r\n-              <goal>execute</goal>\r\n-            </goals>\r\n-            <configuration>\r\n-              <source>\r\n-                project.properties['urlencoded.csvdir.path'] = java.net.URLEncoder.encode(project.properties['test.csvdir.path'])\r\n-                project.properties['licenseUrl'] = project.parent.licenses[0].url\r\n-              </source>\r\n-            </configuration>\r\n-          </execution>\r\n-        </executions>\r\n-      </plugin>\r\n-      \r\n       <plugin>\r\n         <groupId>org.apache.maven.plugins</groupId>\r\n         <artifactId>maven-dependency-plugin</artifactId>\r"},{"sha":"50f3aec0e86789e40149453b0c71088bdc290efe","filename":"archetype/src/main/resources/archetype-resources/core/pom.xml","status":"modified","additions":0,"deletions":19,"changes":19,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/af601327fde094928d9e3d0f99e65030822d237c/archetype%2Fsrc%2Fmain%2Fresources%2Farchetype-resources%2Fcore%2Fpom.xml","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/af601327fde094928d9e3d0f99e65030822d237c/archetype%2Fsrc%2Fmain%2Fresources%2Farchetype-resources%2Fcore%2Fpom.xml","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/archetype%2Fsrc%2Fmain%2Fresources%2Farchetype-resources%2Fcore%2Fpom.xml?ref=af601327fde094928d9e3d0f99e65030822d237c","patch":"@@ -133,25 +133,6 @@ under the License.\n \r\n     <plugins>\r\n \r\n-      <plugin> \r\n-        <groupId>org.codehaus.gmaven</groupId> \r\n-        <artifactId>gmaven-plugin</artifactId> \r\n-        <inherited>true</inherited> \r\n-        <executions> \r\n-          <execution> \r\n-            <phase>generate-resources</phase> \r\n-            <goals> \r\n-              <goal>execute</goal> \r\n-            </goals> \r\n-            <configuration> \r\n-              <source> \r\n-                project.properties['urlencoded.csvdir.path'] = java.net.URLEncoder.encode(project.properties['test.csvdir.path']) \r\n-              </source> \r\n-            </configuration> \r\n-          </execution> \r\n-        </executions> \r\n-      </plugin>\r\n-      \r\n       <plugin>\r\n         <groupId>org.apache.maven.plugins</groupId>\r\n         <artifactId>maven-dependency-plugin</artifactId>\r"},{"sha":"f704ba5789f7a70230ab46ea648fbe9bc9fa1e4c","filename":"console/pom.xml","status":"modified","additions":0,"deletions":20,"changes":20,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/af601327fde094928d9e3d0f99e65030822d237c/console%2Fpom.xml","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/af601327fde094928d9e3d0f99e65030822d237c/console%2Fpom.xml","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/console%2Fpom.xml?ref=af601327fde094928d9e3d0f99e65030822d237c","patch":"@@ -183,26 +183,6 @@ under the License.\n \n     <plugins>\n \n-      <plugin>\n-        <groupId>org.codehaus.gmaven</groupId>\n-        <artifactId>gmaven-plugin</artifactId>\n-        <inherited>true</inherited>\n-        <executions>\n-          <execution>\n-            <phase>generate-resources</phase>\n-            <goals>\n-              <goal>execute</goal>\n-            </goals>\n-            <configuration>\n-              <source>\n-                project.properties['urlencoded.csvdir.path'] = java.net.URLEncoder.encode(project.properties['test.csvdir.path'])\n-                project.properties['licenseUrl'] = project.parent.licenses[0].url\n-              </source>\n-            </configuration>\n-          </execution>\n-        </executions>\n-      </plugin>\n-\n       <plugin>\n         <groupId>org.apache.maven.plugins</groupId>\n         <artifactId>maven-dependency-plugin</artifactId>"},{"sha":"7a3194323c4a7844d5a3065de9576abc5381c7e7","filename":"core/pom.xml","status":"modified","additions":8,"deletions":19,"changes":27,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/af601327fde094928d9e3d0f99e65030822d237c/core%2Fpom.xml","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/af601327fde094928d9e3d0f99e65030822d237c/core%2Fpom.xml","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fpom.xml?ref=af601327fde094928d9e3d0f99e65030822d237c","patch":"@@ -226,6 +226,14 @@ under the License.\n       <groupId>org.apache.xmlgraphics</groupId>\n       <artifactId>fop</artifactId>\n     </dependency>\n+    <dependency>\n+      <groupId>org.apache.avalon.framework</groupId>\n+      <artifactId>avalon-framework-api</artifactId>\n+    </dependency>\n+    <dependency>\n+      <groupId>org.apache.avalon.framework</groupId>\n+      <artifactId>avalon-framework-impl</artifactId>\n+    </dependency>\n \n     <dependency>\n       <groupId>org.apache.geronimo.specs</groupId> \n@@ -380,25 +388,6 @@ under the License.\n         </executions>\n       </plugin>\n \n-      <plugin>\n-        <groupId>org.codehaus.gmaven</groupId>\n-        <artifactId>gmaven-plugin</artifactId>\n-        <inherited>true</inherited>\n-        <executions>\n-          <execution>\n-            <phase>generate-resources</phase>\n-            <goals>\n-              <goal>execute</goal>\n-            </goals>\n-            <configuration>\n-              <source>\n-                project.properties['urlencoded.csvdir.path'] = java.net.URLEncoder.encode(project.properties['test.csvdir.path'])\n-              </source>\n-            </configuration>\n-          </execution>\n-        </executions>\n-      </plugin>\n-\n       <plugin>\n         <groupId>org.apache.maven.plugins</groupId>\n         <artifactId>maven-dependency-plugin</artifactId>"},{"sha":"6e3eb8b668b23c3be553ca8614827db6c5e222bf","filename":"core/src/main/java/org/apache/syncope/core/init/ThreadLocalCleanupListener.java","status":"added","additions":44,"deletions":0,"changes":44,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/af601327fde094928d9e3d0f99e65030822d237c/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Finit%2FThreadLocalCleanupListener.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/af601327fde094928d9e3d0f99e65030822d237c/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Finit%2FThreadLocalCleanupListener.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Finit%2FThreadLocalCleanupListener.java?ref=af601327fde094928d9e3d0f99e65030822d237c","patch":"@@ -0,0 +1,44 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *   http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+package org.apache.syncope.core.init;\n+\n+import javax.servlet.ServletRequestEvent;\n+import javax.servlet.ServletRequestListener;\n+import org.apache.syncope.core.util.DataFormat;\n+import org.identityconnectors.common.l10n.CurrentLocale;\n+import org.identityconnectors.framework.impl.api.local.ThreadClassLoaderManager;\n+\n+/**\n+ * Remove any known thread-local variable when the servlet request is destroyed.\n+ */\n+public class ThreadLocalCleanupListener implements ServletRequestListener {\n+\n+    @Override\n+    public void requestInitialized(final ServletRequestEvent sre) {\n+        // nothing to do while setting up this request (and thread)\n+    }\n+\n+    @Override\n+    public void requestDestroyed(final ServletRequestEvent sre) {\n+        DataFormat.clear();\n+\n+        ThreadClassLoaderManager.clearInstance();\n+        CurrentLocale.clear();\n+    }\n+}"},{"sha":"4cb9df86ab25f8e1641a08b7b7760e6930c5274e","filename":"core/src/main/java/org/apache/syncope/core/util/DataFormat.java","status":"modified","additions":25,"deletions":40,"changes":65,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/af601327fde094928d9e3d0f99e65030822d237c/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Futil%2FDataFormat.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/af601327fde094928d9e3d0f99e65030822d237c/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Futil%2FDataFormat.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Futil%2FDataFormat.java?ref=af601327fde094928d9e3d0f99e65030822d237c","patch":"@@ -57,73 +57,58 @@ public static String format(final Date date, final boolean lenient) {\n     }\n \n     public static String format(final Date date, final boolean lenient, final String conversionPattern) {\n-        try {\n-            SimpleDateFormat sdf = DATE_FORMAT.get();\n-            if (conversionPattern != null) {\n-                sdf.applyPattern(conversionPattern);\n-            }\n-            sdf.setLenient(lenient);\n-            return sdf.format(date);\n-        } finally {\n-            DATE_FORMAT.remove();\n+        SimpleDateFormat sdf = DATE_FORMAT.get();\n+        if (conversionPattern != null) {\n+            sdf.applyPattern(conversionPattern);\n         }\n+        sdf.setLenient(lenient);\n+        return sdf.format(date);\n     }\n \n     public static String format(final long number) {\n         return format(number, null);\n     }\n \n     public static String format(final long number, final String conversionPattern) {\n-        try {\n-            DecimalFormat df = DECIMAL_FORMAT.get();\n-            if (conversionPattern != null) {\n-                df.applyPattern(conversionPattern);\n-            }\n-            return df.format(number);\n-        } finally {\n-            DECIMAL_FORMAT.remove();\n+        DecimalFormat df = DECIMAL_FORMAT.get();\n+        if (conversionPattern != null) {\n+            df.applyPattern(conversionPattern);\n         }\n+        return df.format(number);\n     }\n \n     public static String format(final double number) {\n         return format(number, null);\n     }\n \n     public static String format(final double number, final String conversionPattern) {\n-        try {\n-            DecimalFormat df = DECIMAL_FORMAT.get();\n-            if (conversionPattern != null) {\n-                df.applyPattern(conversionPattern);\n-            }\n-            return df.format(number);\n-        } finally {\n-            DECIMAL_FORMAT.remove();\n+        DecimalFormat df = DECIMAL_FORMAT.get();\n+        if (conversionPattern != null) {\n+            df.applyPattern(conversionPattern);\n         }\n+        return df.format(number);\n     }\n \n     public static Date parseDate(final String source) throws ParseException {\n         return DateUtils.parseDate(source, SyncopeConstants.DATE_PATTERNS);\n     }\n \n     public static Date parseDate(final String source, final String conversionPattern) throws ParseException {\n-        try {\n-            SimpleDateFormat sdf = DATE_FORMAT.get();\n-            sdf.applyPattern(conversionPattern);\n-            sdf.setLenient(false);\n-            return sdf.parse(source);\n-        } finally {\n-            DATE_FORMAT.remove();\n-        }\n+        SimpleDateFormat sdf = DATE_FORMAT.get();\n+        sdf.applyPattern(conversionPattern);\n+        sdf.setLenient(false);\n+        return sdf.parse(source);\n     }\n \n     public static Number parseNumber(final String source, final String conversionPattern) throws ParseException {\n-        try {\n-            DecimalFormat df = DECIMAL_FORMAT.get();\n-            df.applyPattern(conversionPattern);\n-            return df.parse(source);\n-        } finally {\n-            DECIMAL_FORMAT.remove();\n-        }\n+        DecimalFormat df = DECIMAL_FORMAT.get();\n+        df.applyPattern(conversionPattern);\n+        return df.parse(source);\n+    }\n+\n+    public static void clear() {\n+        DATE_FORMAT.remove();\n+        DECIMAL_FORMAT.remove();\n     }\n \n     private DataFormat() {"},{"sha":"71ce5466895768d2e240cb3c89d7817355310638","filename":"core/src/main/webapp/WEB-INF/web.xml","status":"modified","additions":3,"deletions":0,"changes":3,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/af601327fde094928d9e3d0f99e65030822d237c/core%2Fsrc%2Fmain%2Fwebapp%2FWEB-INF%2Fweb.xml","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/af601327fde094928d9e3d0f99e65030822d237c/core%2Fsrc%2Fmain%2Fwebapp%2FWEB-INF%2Fweb.xml","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fsrc%2Fmain%2Fwebapp%2FWEB-INF%2Fweb.xml?ref=af601327fde094928d9e3d0f99e65030822d237c","patch":"@@ -34,6 +34,9 @@ under the License.\n   <listener>\n     <listener-class>org.springframework.web.context.ContextLoaderListener</listener-class>\n   </listener>\n+  <listener>\n+    <listener-class>org.apache.syncope.core.init.ThreadLocalCleanupListener</listener-class>\n+  </listener>\n   \n   <servlet>\n     <servlet-name>CXFServlet</servlet-name>"},{"sha":"2953e76ea09fc93fb9aaafe98ee06c14bce12851","filename":"pom.xml","status":"modified","additions":50,"deletions":9,"changes":59,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/af601327fde094928d9e3d0f99e65030822d237c/pom.xml","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/af601327fde094928d9e3d0f99e65030822d237c/pom.xml","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/pom.xml?ref=af601327fde094928d9e3d0f99e65030822d237c","patch":"@@ -306,7 +306,7 @@ under the License.\n \n     <wicket.version>6.6.0</wicket.version>\n \n-    <groovy.version>1.6.9</groovy.version>\n+    <groovy.version>2.1.1</groovy.version>\n \n     <h2.version>1.3.170</h2.version>\n \n@@ -655,10 +655,30 @@ under the License.\n         <version>${cocoon.version}</version>\n       </dependency>\n             \n-      <dependency>    \n+      <dependency>\n         <groupId>org.apache.xmlgraphics</groupId>\n         <artifactId>fop</artifactId>\n-        <version>1.0</version>\n+        <version>1.1</version>\n+        <exclusions>\n+          <exclusion>\n+            <groupId>org.apache.avalon.framework</groupId>\n+            <artifactId>avalon-framework-api</artifactId>\n+          </exclusion>\n+          <exclusion>\n+            <groupId>org.apache.avalon.framework</groupId>\n+            <artifactId>avalon-framework-impl</artifactId>\n+          </exclusion>\n+        </exclusions>\n+      </dependency>\n+      <dependency>\n+        <groupId>org.apache.avalon.framework</groupId>\n+        <artifactId>avalon-framework-api</artifactId>\n+        <version>4.3.1</version>\n+      </dependency>\n+      <dependency>\n+        <groupId>org.apache.avalon.framework</groupId>\n+        <artifactId>avalon-framework-impl</artifactId>\n+        <version>4.3.1</version>\n       </dependency>\n         \n       <!-- Wicket -->\n@@ -824,7 +844,7 @@ under the License.\n   </repositories>\n \n   <build>\n-    <defaultGoal>package</defaultGoal>\n+    <defaultGoal>clean verify</defaultGoal>\n \n     <pluginManagement>\n       <plugins>\n@@ -840,11 +860,6 @@ under the License.\n             <!--<compilerArgument>-Xlint:unchecked</compilerArgument>-->\n           </configuration>\n         </plugin>\n-        <plugin>\n-          <groupId>org.codehaus.gmaven</groupId>\n-          <artifactId>gmaven-plugin</artifactId>\n-          <version>1.5</version>\n-        </plugin>\n         <plugin>\n           <groupId>org.codehaus.mojo</groupId>\n           <artifactId>exec-maven-plugin</artifactId>\n@@ -1088,6 +1103,32 @@ under the License.\n           </execution>\n         </executions>\n       </plugin>\n+      <plugin>\n+        <groupId>org.codehaus.gmaven</groupId>\n+        <artifactId>gmaven-plugin</artifactId>\n+        <version>1.5</version>\n+        <dependencies>\n+          <dependency>\n+            <groupId>org.codehaus.groovy</groupId>\n+            <artifactId>groovy-all</artifactId>\n+            <version>1.5.8</version>\n+          </dependency>\n+        </dependencies>\n+        <executions>\n+          <execution>\n+            <phase>generate-resources</phase>\n+            <goals>\n+              <goal>execute</goal>\n+            </goals>\n+            <configuration>\n+              <source>\n+                project.properties['urlencoded.csvdir.path'] = java.net.URLEncoder.encode(project.properties['test.csvdir.path'])\n+                project.properties['licenseUrl'] = project.parent.licenses[0].url\n+              </source>\n+            </configuration>\n+          </execution>\n+        </executions>\n+      </plugin>\n       <plugin>\n         <groupId>org.apache.rat</groupId>\n         <artifactId>apache-rat-plugin</artifactId>"}]}