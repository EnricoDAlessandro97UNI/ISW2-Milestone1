{"sha":"9e8f642915f5622fa7e2b55611b427e2c178ee55","node_id":"MDY6Q29tbWl0NjM2ODc5MDYyOjllOGY2NDI5MTVmNTYyMmZhN2UyYjU1NjExYjQyN2UyYzE3OGVlNTU=","commit":{"author":{"name":"Francesco Chicchiriccò","email":"ilgrosso@apache.org","date":"2014-06-17T14:20:20Z"},"committer":{"name":"Francesco Chicchiriccò","email":"ilgrosso@apache.org","date":"2014-06-17T14:20:20Z"},"message":"[SYNCOPE-505] Using known constants\n\ngit-svn-id: https://svn.apache.org/repos/asf/syncope/trunk@1603184 13f79535-47bb-0310-9956-ffa450edef68","tree":{"sha":"cc6f655e9fad588bac7c72c11392b46f1a68064c","url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/git/trees/cc6f655e9fad588bac7c72c11392b46f1a68064c"},"url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/git/commits/9e8f642915f5622fa7e2b55611b427e2c178ee55","comment_count":0,"verification":{"verified":false,"reason":"unsigned","signature":null,"payload":null}},"url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/9e8f642915f5622fa7e2b55611b427e2c178ee55","html_url":"https://github.com/EnricoDAlessandro97UNI/syncope/commit/9e8f642915f5622fa7e2b55611b427e2c178ee55","comments_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/9e8f642915f5622fa7e2b55611b427e2c178ee55/comments","author":{"login":"ilgrosso","id":1064664,"node_id":"MDQ6VXNlcjEwNjQ2NjQ=","avatar_url":"https://avatars.githubusercontent.com/u/1064664?v=4","gravatar_id":"","url":"https://api.github.com/users/ilgrosso","html_url":"https://github.com/ilgrosso","followers_url":"https://api.github.com/users/ilgrosso/followers","following_url":"https://api.github.com/users/ilgrosso/following{/other_user}","gists_url":"https://api.github.com/users/ilgrosso/gists{/gist_id}","starred_url":"https://api.github.com/users/ilgrosso/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ilgrosso/subscriptions","organizations_url":"https://api.github.com/users/ilgrosso/orgs","repos_url":"https://api.github.com/users/ilgrosso/repos","events_url":"https://api.github.com/users/ilgrosso/events{/privacy}","received_events_url":"https://api.github.com/users/ilgrosso/received_events","type":"User","site_admin":false},"committer":{"login":"ilgrosso","id":1064664,"node_id":"MDQ6VXNlcjEwNjQ2NjQ=","avatar_url":"https://avatars.githubusercontent.com/u/1064664?v=4","gravatar_id":"","url":"https://api.github.com/users/ilgrosso","html_url":"https://github.com/ilgrosso","followers_url":"https://api.github.com/users/ilgrosso/followers","following_url":"https://api.github.com/users/ilgrosso/following{/other_user}","gists_url":"https://api.github.com/users/ilgrosso/gists{/gist_id}","starred_url":"https://api.github.com/users/ilgrosso/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ilgrosso/subscriptions","organizations_url":"https://api.github.com/users/ilgrosso/orgs","repos_url":"https://api.github.com/users/ilgrosso/repos","events_url":"https://api.github.com/users/ilgrosso/events{/privacy}","received_events_url":"https://api.github.com/users/ilgrosso/received_events","type":"User","site_admin":false},"parents":[{"sha":"0fa005277cc575b594e4d208d03898b81b27796a","url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/0fa005277cc575b594e4d208d03898b81b27796a","html_url":"https://github.com/EnricoDAlessandro97UNI/syncope/commit/0fa005277cc575b594e4d208d03898b81b27796a"}],"stats":{"total":27,"additions":13,"deletions":14},"files":[{"sha":"aa4616e0c8a2a69da3eef8c9873fa9ff0156d2b1","filename":"core/src/main/java/org/apache/syncope/core/propagation/impl/DBPasswordPropagationActions.java","status":"modified","additions":13,"deletions":14,"changes":27,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/9e8f642915f5622fa7e2b55611b427e2c178ee55/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fpropagation%2Fimpl%2FDBPasswordPropagationActions.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/9e8f642915f5622fa7e2b55611b427e2c178ee55/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fpropagation%2Fimpl%2FDBPasswordPropagationActions.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fpropagation%2Fimpl%2FDBPasswordPropagationActions.java?ref=9e8f642915f5622fa7e2b55611b427e2c178ee55","patch":"@@ -18,21 +18,21 @@\n  */\n package org.apache.syncope.core.propagation.impl;\n \n-import java.util.ArrayList;\n import java.util.HashSet;\n-import java.util.List;\n import java.util.Set;\n \n import org.apache.syncope.common.types.AttributableType;\n import org.apache.syncope.core.persistence.beans.PropagationTask;\n import org.apache.syncope.core.persistence.beans.user.SyncopeUser;\n import org.apache.syncope.core.persistence.dao.UserDAO;\n import org.apache.syncope.core.propagation.DefaultPropagationActions;\n+import org.apache.syncope.core.propagation.PropagationTaskExecutor;\n import org.identityconnectors.common.security.GuardedString;\n import org.identityconnectors.framework.common.objects.Attribute;\n import org.identityconnectors.framework.common.objects.AttributeBuilder;\n import org.identityconnectors.framework.common.objects.AttributeUtil;\n import org.identityconnectors.framework.common.objects.ConnectorObject;\n+import org.identityconnectors.framework.common.objects.OperationalAttributes;\n import org.slf4j.Logger;\n import org.slf4j.LoggerFactory;\n import org.springframework.beans.factory.annotation.Autowired;\n@@ -44,34 +44,33 @@\n  */\n public class DBPasswordPropagationActions extends DefaultPropagationActions {\n \n-    protected static final Logger LOG = LoggerFactory.getLogger(DBPasswordPropagationActions.class);\n+    private static final Logger LOG = LoggerFactory.getLogger(DBPasswordPropagationActions.class);\n \n     @Autowired\n-    protected UserDAO userDAO;\n+    private UserDAO userDAO;\n \n-    @Transactional(readOnly = true)\n+    @Transactional\n     @Override\n     public void before(final PropagationTask task, final ConnectorObject beforeObj) {\n         super.before(task, beforeObj);\n \n         if (AttributableType.USER == task.getSubjectType()) {\n             SyncopeUser user = userDAO.find(task.getSubjectId());\n-            \n             if (user != null && user.getPassword() != null) {\n-                Attribute missing = AttributeUtil.find(\"__MANDATORY_MISSING__\", task.getAttributes());\n+                Attribute missing = AttributeUtil.find(\n+                        AttributeUtil.createSpecialName(PropagationTaskExecutor.MANDATORY_MISSING_ATTR_NAME),\n+                        task.getAttributes());\n                 if (missing != null && missing.getValue() != null && missing.getValue().size() == 1\n-                    && missing.getValue().get(0).equals(\"__PASSWORD__\")) {\n-                    List<Object> values = new ArrayList<Object>(1);\n-                    values.add(new GuardedString(user.getPassword().toCharArray()));\n-                    \n-                    Attribute passwordAttribute = AttributeBuilder.build(\"__PASSWORD__\", values);\n-                    \n+                        && missing.getValue().get(0).equals(OperationalAttributes.PASSWORD_NAME)) {\n+\n+                    Attribute passwordAttribute = AttributeBuilder.buildPassword(\n+                            new GuardedString(user.getPassword().toCharArray()));\n+\n                     Set<Attribute> attributes = new HashSet<Attribute>(task.getAttributes());\n                     attributes.add(passwordAttribute);\n                     attributes.remove(missing);\n                     task.setAttributes(attributes);\n                 }\n-                \n             }\n         }\n     }"}]}