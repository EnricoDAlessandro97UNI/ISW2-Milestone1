{"sha":"86039f5592842446c62d9e8dd2c2fb9f0c8af097","node_id":"MDY6Q29tbWl0NjM2ODc5MDYyOjg2MDM5ZjU1OTI4NDI0NDZjNjJkOWU4ZGQyYzJmYjlmMGM4YWYwOTc=","commit":{"author":{"name":"skylark17","email":"matteo.alessandroni@tirasa.net","date":"2018-03-21T13:29:46Z"},"committer":{"name":"skylark17","email":"matteo.alessandroni@tirasa.net","date":"2018-03-21T13:36:12Z"},"message":"Some fixes and code improvements for Azure PropagationActions","tree":{"sha":"ca7624bb12c091a6fc05304c3250a3b74410bb6e","url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/git/trees/ca7624bb12c091a6fc05304c3250a3b74410bb6e"},"url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/git/commits/86039f5592842446c62d9e8dd2c2fb9f0c8af097","comment_count":0,"verification":{"verified":false,"reason":"unsigned","signature":null,"payload":null}},"url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/86039f5592842446c62d9e8dd2c2fb9f0c8af097","html_url":"https://github.com/EnricoDAlessandro97UNI/syncope/commit/86039f5592842446c62d9e8dd2c2fb9f0c8af097","comments_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/86039f5592842446c62d9e8dd2c2fb9f0c8af097/comments","author":{"login":"mat-ale","id":25547301,"node_id":"MDQ6VXNlcjI1NTQ3MzAx","avatar_url":"https://avatars.githubusercontent.com/u/25547301?v=4","gravatar_id":"","url":"https://api.github.com/users/mat-ale","html_url":"https://github.com/mat-ale","followers_url":"https://api.github.com/users/mat-ale/followers","following_url":"https://api.github.com/users/mat-ale/following{/other_user}","gists_url":"https://api.github.com/users/mat-ale/gists{/gist_id}","starred_url":"https://api.github.com/users/mat-ale/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mat-ale/subscriptions","organizations_url":"https://api.github.com/users/mat-ale/orgs","repos_url":"https://api.github.com/users/mat-ale/repos","events_url":"https://api.github.com/users/mat-ale/events{/privacy}","received_events_url":"https://api.github.com/users/mat-ale/received_events","type":"User","site_admin":false},"committer":{"login":"mat-ale","id":25547301,"node_id":"MDQ6VXNlcjI1NTQ3MzAx","avatar_url":"https://avatars.githubusercontent.com/u/25547301?v=4","gravatar_id":"","url":"https://api.github.com/users/mat-ale","html_url":"https://github.com/mat-ale","followers_url":"https://api.github.com/users/mat-ale/followers","following_url":"https://api.github.com/users/mat-ale/following{/other_user}","gists_url":"https://api.github.com/users/mat-ale/gists{/gist_id}","starred_url":"https://api.github.com/users/mat-ale/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mat-ale/subscriptions","organizations_url":"https://api.github.com/users/mat-ale/orgs","repos_url":"https://api.github.com/users/mat-ale/repos","events_url":"https://api.github.com/users/mat-ale/events{/privacy}","received_events_url":"https://api.github.com/users/mat-ale/received_events","type":"User","site_admin":false},"parents":[{"sha":"07f3eaad67c3116d7f538758a4d5ad4648c7a6df","url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/07f3eaad67c3116d7f538758a4d5ad4648c7a6df","html_url":"https://github.com/EnricoDAlessandro97UNI/syncope/commit/07f3eaad67c3116d7f538758a4d5ad4648c7a6df"}],"stats":{"total":50,"additions":24,"deletions":26},"files":[{"sha":"4aec759821d8a3a7fdeffc4be0bb7e9dcc65e6c1","filename":"core/provisioning-java/src/main/java/org/apache/syncope/core/provisioning/java/propagation/AzurePropagationActions.java","status":"modified","additions":24,"deletions":26,"changes":50,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/86039f5592842446c62d9e8dd2c2fb9f0c8af097/core%2Fprovisioning-java%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fprovisioning%2Fjava%2Fpropagation%2FAzurePropagationActions.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/86039f5592842446c62d9e8dd2c2fb9f0c8af097/core%2Fprovisioning-java%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fprovisioning%2Fjava%2Fpropagation%2FAzurePropagationActions.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fprovisioning-java%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fprovisioning%2Fjava%2Fpropagation%2FAzurePropagationActions.java?ref=86039f5592842446c62d9e8dd2c2fb9f0c8af097","patch":"@@ -90,36 +90,16 @@ protected String getAzureGroupIdSchema() {\n     @Transactional\n     @Override\n     public void before(final PropagationTask task, final ConnectorObject beforeObj) {\n+        if (task.getOperation() == ResourceOperation.DELETE || task.getOperation() == ResourceOperation.NONE) {\n+            return;\n+        }\n+\n         switch (task.getAnyTypeKind()) {\n             case USER:\n-                User user = userDAO.find(task.getEntityKey());\n-                if (user != null) {\n-                    Set<Attribute> attributes = new HashSet<>(task.getAttributes());\n-\n-                    // Ensure to set __NAME__ value to user's \"mailNickname\"\n-                    Name name = AttributeUtil.getNameFromAttributes(attributes);\n-                    if (name != null) {\n-                        attributes.remove(name);\n-                    }\n-                    attributes.add(\n-                            new Name(AttributeUtil.find(USER_MAIL_NICKNAME, attributes).getValue().get(0).toString()));\n-\n-                    task.setAttributes(attributes);\n-                }\n-\n+                setName(task, USER_MAIL_NICKNAME);\n                 break;\n             case GROUP:\n-                Set<Attribute> attributes = new HashSet<>(task.getAttributes());\n-\n-                // Ensure to set __NAME__ value to user's \"mailNickname\"\n-                Name name = AttributeUtil.getNameFromAttributes(attributes);\n-                if (name != null) {\n-                    attributes.remove(name);\n-                }\n-                attributes.add(\n-                        new Name(AttributeUtil.find(GROUP_MAIL_NICKNAME, attributes).getValue().get(0).toString()));\n-\n-                task.setAttributes(attributes);\n+                setName(task, GROUP_MAIL_NICKNAME);\n                 break;\n             default:\n                 LOG.debug(\"Not about user, or group, not doing anything\");\n@@ -215,4 +195,22 @@ public void after(final PropagationTask task, final TaskExec execution, final Co\n         }\n     }\n \n+    private void setName(final PropagationTask task, final String attributeName) {\n+        Set<Attribute> attributes = new HashSet<>(task.getAttributes());\n+\n+        if (AttributeUtil.find(attributeName, attributes) == null) {\n+            LOG.warn(\"Can't find {} attribute to set as __NAME__ attribute value, skipping...\", attributeName);\n+            return;\n+        }\n+\n+        Name name = AttributeUtil.getNameFromAttributes(attributes);\n+        if (name != null) {\n+            attributes.remove(name);\n+        }\n+        attributes.add(\n+                new Name(AttributeUtil.find(attributeName, attributes).getValue().get(0).toString()));\n+\n+        task.setAttributes(attributes);\n+    }\n+\n }"}]}