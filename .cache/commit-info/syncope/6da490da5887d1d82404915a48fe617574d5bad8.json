{"sha":"6da490da5887d1d82404915a48fe617574d5bad8","node_id":"MDY6Q29tbWl0NjM2ODc5MDYyOjZkYTQ5MGRhNTg4N2QxZDgyNDA0OTE1YTQ4ZmU2MTc1NzRkNWJhZDg=","commit":{"author":{"name":"Francesco Chicchiriccò","email":"ilgrosso@apache.org","date":"2017-09-15T12:00:31Z"},"committer":{"name":"Francesco Chicchiriccò","email":"ilgrosso@apache.org","date":"2017-09-15T12:04:09Z"},"message":"[syncope-1207] Further cleanup: now audit and notifications contain the actual patch applied","tree":{"sha":"5df71adf30631cb86813a6731ddfd91a0c1e2667","url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/git/trees/5df71adf30631cb86813a6731ddfd91a0c1e2667"},"url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/git/commits/6da490da5887d1d82404915a48fe617574d5bad8","comment_count":0,"verification":{"verified":false,"reason":"unsigned","signature":null,"payload":null}},"url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/6da490da5887d1d82404915a48fe617574d5bad8","html_url":"https://github.com/EnricoDAlessandro97UNI/syncope/commit/6da490da5887d1d82404915a48fe617574d5bad8","comments_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/6da490da5887d1d82404915a48fe617574d5bad8/comments","author":{"login":"ilgrosso","id":1064664,"node_id":"MDQ6VXNlcjEwNjQ2NjQ=","avatar_url":"https://avatars.githubusercontent.com/u/1064664?v=4","gravatar_id":"","url":"https://api.github.com/users/ilgrosso","html_url":"https://github.com/ilgrosso","followers_url":"https://api.github.com/users/ilgrosso/followers","following_url":"https://api.github.com/users/ilgrosso/following{/other_user}","gists_url":"https://api.github.com/users/ilgrosso/gists{/gist_id}","starred_url":"https://api.github.com/users/ilgrosso/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ilgrosso/subscriptions","organizations_url":"https://api.github.com/users/ilgrosso/orgs","repos_url":"https://api.github.com/users/ilgrosso/repos","events_url":"https://api.github.com/users/ilgrosso/events{/privacy}","received_events_url":"https://api.github.com/users/ilgrosso/received_events","type":"User","site_admin":false},"committer":{"login":"ilgrosso","id":1064664,"node_id":"MDQ6VXNlcjEwNjQ2NjQ=","avatar_url":"https://avatars.githubusercontent.com/u/1064664?v=4","gravatar_id":"","url":"https://api.github.com/users/ilgrosso","html_url":"https://github.com/ilgrosso","followers_url":"https://api.github.com/users/ilgrosso/followers","following_url":"https://api.github.com/users/ilgrosso/following{/other_user}","gists_url":"https://api.github.com/users/ilgrosso/gists{/gist_id}","starred_url":"https://api.github.com/users/ilgrosso/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ilgrosso/subscriptions","organizations_url":"https://api.github.com/users/ilgrosso/orgs","repos_url":"https://api.github.com/users/ilgrosso/repos","events_url":"https://api.github.com/users/ilgrosso/events{/privacy}","received_events_url":"https://api.github.com/users/ilgrosso/received_events","type":"User","site_admin":false},"parents":[{"sha":"c4ba54c9658f1a552ca567a873a4da0d4f62bdb7","url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/c4ba54c9658f1a552ca567a873a4da0d4f62bdb7","html_url":"https://github.com/EnricoDAlessandro97UNI/syncope/commit/c4ba54c9658f1a552ca567a873a4da0d4f62bdb7"}],"stats":{"total":179,"additions":113,"deletions":66},"files":[{"sha":"e126281823ac49987ac51a47bdfec483032fb6b8","filename":"core/provisioning-java/src/main/java/org/apache/syncope/core/provisioning/java/DefaultAnyObjectProvisioningManager.java","status":"modified","additions":5,"deletions":5,"changes":10,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/6da490da5887d1d82404915a48fe617574d5bad8/core%2Fprovisioning-java%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fprovisioning%2Fjava%2FDefaultAnyObjectProvisioningManager.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/6da490da5887d1d82404915a48fe617574d5bad8/core%2Fprovisioning-java%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fprovisioning%2Fjava%2FDefaultAnyObjectProvisioningManager.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fprovisioning-java%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fprovisioning%2Fjava%2FDefaultAnyObjectProvisioningManager.java?ref=6da490da5887d1d82404915a48fe617574d5bad8","patch":"@@ -98,19 +98,19 @@ public Pair<AnyObjectPatch, List<PropagationStatus>> update(\n     public Pair<AnyObjectPatch, List<PropagationStatus>> update(\n             final AnyObjectPatch anyObjectPatch, final Set<String> excludedResources, final boolean nullPriorityAsync) {\n \n-        WorkflowResult<String> updated = awfAdapter.update(anyObjectPatch);\n+        WorkflowResult<AnyObjectPatch> updated = awfAdapter.update(anyObjectPatch);\n \n         List<PropagationTask> tasks = propagationManager.getUpdateTasks(\n                 AnyTypeKind.ANY_OBJECT,\n-                updated.getResult(),\n+                updated.getResult().getKey(),\n                 false,\n                 null,\n                 updated.getPropByRes(),\n                 anyObjectPatch.getVirAttrs(),\n                 excludedResources);\n         PropagationReporter propagationReporter = taskExecutor.execute(tasks, nullPriorityAsync);\n \n-        return Pair.of(anyObjectPatch, propagationReporter.getStatuses());\n+        return Pair.of(updated.getResult(), propagationReporter.getStatuses());\n     }\n \n     @Override\n@@ -149,12 +149,12 @@ public List<PropagationStatus> delete(\n \n     @Override\n     public String unlink(final AnyObjectPatch anyObjectPatch) {\n-        return awfAdapter.update(anyObjectPatch).getResult();\n+        return awfAdapter.update(anyObjectPatch).getResult().getKey();\n     }\n \n     @Override\n     public String link(final AnyObjectPatch anyObjectPatch) {\n-        return awfAdapter.update(anyObjectPatch).getResult();\n+        return awfAdapter.update(anyObjectPatch).getResult().getKey();\n     }\n \n     @Override"},{"sha":"7ff1156d3fd825ceb8b2e97234c7f7a99fe44f07","filename":"core/provisioning-java/src/main/java/org/apache/syncope/core/provisioning/java/DefaultGroupProvisioningManager.java","status":"modified","additions":5,"deletions":6,"changes":11,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/6da490da5887d1d82404915a48fe617574d5bad8/core%2Fprovisioning-java%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fprovisioning%2Fjava%2FDefaultGroupProvisioningManager.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/6da490da5887d1d82404915a48fe617574d5bad8/core%2Fprovisioning-java%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fprovisioning%2Fjava%2FDefaultGroupProvisioningManager.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fprovisioning-java%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fprovisioning%2Fjava%2FDefaultGroupProvisioningManager.java?ref=6da490da5887d1d82404915a48fe617574d5bad8","patch":"@@ -123,19 +123,19 @@ public Pair<GroupPatch, List<PropagationStatus>> update(\n     public Pair<GroupPatch, List<PropagationStatus>> update(\n             final GroupPatch groupPatch, final Set<String> excludedResources, final boolean nullPriorityAsync) {\n \n-        WorkflowResult<String> updated = gwfAdapter.update(groupPatch);\n+        WorkflowResult<GroupPatch> updated = gwfAdapter.update(groupPatch);\n \n         List<PropagationTask> tasks = propagationManager.getUpdateTasks(\n                 AnyTypeKind.GROUP,\n-                updated.getResult(),\n+                updated.getResult().getKey(),\n                 false,\n                 null,\n                 updated.getPropByRes(),\n                 groupPatch.getVirAttrs(),\n                 excludedResources);\n         PropagationReporter propagationReporter = taskExecutor.execute(tasks, nullPriorityAsync);\n \n-        return Pair.of(groupPatch, propagationReporter.getStatuses());\n+        return Pair.of(updated.getResult(), propagationReporter.getStatuses());\n     }\n \n     @Override\n@@ -185,8 +185,7 @@ public List<PropagationStatus> delete(\n \n     @Override\n     public String unlink(final GroupPatch groupPatch) {\n-        WorkflowResult<String> updated = gwfAdapter.update(groupPatch);\n-        return updated.getResult();\n+        return gwfAdapter.update(groupPatch).getResult().getKey();\n     }\n \n     @Override\n@@ -230,7 +229,7 @@ public List<PropagationStatus> deprovision(\n \n     @Override\n     public String link(final GroupPatch groupPatch) {\n-        return gwfAdapter.update(groupPatch).getResult();\n+        return gwfAdapter.update(groupPatch).getResult().getKey();\n     }\n \n }"},{"sha":"b6fe9acf5d0cd5d49355ffe414942814576fcdd8","filename":"core/provisioning-java/src/main/java/org/apache/syncope/core/provisioning/java/pushpull/AbstractPullResultHandler.java","status":"modified","additions":19,"deletions":10,"changes":29,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/6da490da5887d1d82404915a48fe617574d5bad8/core%2Fprovisioning-java%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fprovisioning%2Fjava%2Fpushpull%2FAbstractPullResultHandler.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/6da490da5887d1d82404915a48fe617574d5bad8/core%2Fprovisioning-java%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fprovisioning%2Fjava%2Fpushpull%2FAbstractPullResultHandler.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fprovisioning-java%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fprovisioning%2Fjava%2Fpushpull%2FAbstractPullResultHandler.java?ref=6da490da5887d1d82404915a48fe617574d5bad8","patch":"@@ -328,6 +328,7 @@ protected List<ProvisioningReport> update(\n             if (!profile.isDryRun()) {\n                 Result resultStatus;\n                 Object output;\n+                AnyPatch effectivePatch = null;\n \n                 if (before == null) {\n                     resultStatus = Result.FAILURE;\n@@ -346,7 +347,8 @@ protected List<ProvisioningReport> update(\n                             workingDelta = action.beforeUpdate(profile, workingDelta, before, anyPatch);\n                         }\n \n-                        AnyTO updated = AnyOperations.patch(before, doUpdate(before, anyPatch, workingDelta, result));\n+                        effectivePatch = doUpdate(before, anyPatch, workingDelta, result);\n+                        AnyTO updated = AnyOperations.patch(before, effectivePatch);\n \n                         for (PullActions action : profile.getActions()) {\n                             action.after(profile, workingDelta, updated, result);\n@@ -375,7 +377,8 @@ protected List<ProvisioningReport> update(\n                         resultStatus = Result.FAILURE;\n                     }\n                 }\n-                finalize(MatchingRule.toEventName(MatchingRule.UPDATE), resultStatus, before, output, workingDelta);\n+                finalize(MatchingRule.toEventName(MatchingRule.UPDATE),\n+                        resultStatus, before, output, workingDelta, effectivePatch);\n             }\n             results.add(result);\n         }\n@@ -531,8 +534,9 @@ protected List<ProvisioningReport> link(\n             }\n \n             if (!profile.isDryRun()) {\n-                Object output;\n                 Result resultStatus;\n+                Object output;\n+                AnyPatch effectivePatch = null;\n \n                 if (before == null) {\n                     resultStatus = Result.FAILURE;\n@@ -551,12 +555,13 @@ protected List<ProvisioningReport> link(\n                             }\n                         }\n \n-                        AnyPatch patch = newPatch(before.getKey());\n-                        patch.getResources().add(new StringPatchItem.Builder().\n+                        AnyPatch anyPatch = newPatch(before.getKey());\n+                        anyPatch.getResources().add(new StringPatchItem.Builder().\n                                 operation(unlink ? PatchOperation.DELETE : PatchOperation.ADD_REPLACE).\n                                 value(profile.getTask().getResource().getKey()).build());\n \n-                        output = getAnyTO(update(patch).getResult());\n+                        effectivePatch = update(anyPatch).getResult();\n+                        output = AnyOperations.patch(before, effectivePatch);\n \n                         for (PullActions action : profile.getActions()) {\n                             action.after(profile, delta, AnyTO.class.cast(output), result);\n@@ -585,7 +590,8 @@ protected List<ProvisioningReport> link(\n                 }\n                 finalize(unlink\n                         ? MatchingRule.toEventName(MatchingRule.UNLINK)\n-                        : MatchingRule.toEventName(MatchingRule.LINK), resultStatus, before, output, delta);\n+                        : MatchingRule.toEventName(MatchingRule.LINK),\n+                        resultStatus, before, output, delta, effectivePatch);\n             }\n             results.add(result);\n         }\n@@ -813,7 +819,8 @@ protected void finalize(\n             final Result result,\n             final Object before,\n             final Object output,\n-            final SyncDelta delta) {\n+            final SyncDelta delta,\n+            final Object... furtherInput) {\n \n         synchronized (this) {\n             this.latestResult = result;\n@@ -826,7 +833,8 @@ protected void finalize(\n                 result,\n                 before,\n                 output,\n-                delta);\n+                delta,\n+                furtherInput);\n \n         auditManager.audit(AuditElements.EventCategoryType.PULL,\n                 getAnyUtils().getAnyTypeKind().name().toLowerCase(),\n@@ -835,6 +843,7 @@ protected void finalize(\n                 result,\n                 before,\n                 output,\n-                delta);\n+                delta,\n+                furtherInput);\n     }\n }"},{"sha":"76bfe3e3b82ffa2da55c8193ac1d2e8cdcf3a44e","filename":"core/provisioning-java/src/main/java/org/apache/syncope/core/provisioning/java/pushpull/AbstractSyncopeResultHandler.java","status":"modified","additions":1,"deletions":1,"changes":2,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/6da490da5887d1d82404915a48fe617574d5bad8/core%2Fprovisioning-java%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fprovisioning%2Fjava%2Fpushpull%2FAbstractSyncopeResultHandler.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/6da490da5887d1d82404915a48fe617574d5bad8/core%2Fprovisioning-java%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fprovisioning%2Fjava%2Fpushpull%2FAbstractSyncopeResultHandler.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fprovisioning-java%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fprovisioning%2Fjava%2Fpushpull%2FAbstractSyncopeResultHandler.java?ref=6da490da5887d1d82404915a48fe617574d5bad8","patch":"@@ -108,7 +108,7 @@\n \n     protected abstract AnyPatch newPatch(String key);\n \n-    protected abstract WorkflowResult<String> update(AnyPatch patch);\n+    protected abstract WorkflowResult<? extends AnyPatch> update(AnyPatch patch);\n \n     @Override\n     public void setProfile(final ProvisioningProfile<T, A> profile) {"},{"sha":"3e652eea73ccb52d88327afb2a982b4c15646a35","filename":"core/provisioning-java/src/main/java/org/apache/syncope/core/provisioning/java/pushpull/AnyObjectPullResultHandlerImpl.java","status":"modified","additions":1,"deletions":1,"changes":2,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/6da490da5887d1d82404915a48fe617574d5bad8/core%2Fprovisioning-java%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fprovisioning%2Fjava%2Fpushpull%2FAnyObjectPullResultHandlerImpl.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/6da490da5887d1d82404915a48fe617574d5bad8/core%2Fprovisioning-java%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fprovisioning%2Fjava%2Fpushpull%2FAnyObjectPullResultHandlerImpl.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fprovisioning-java%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fprovisioning%2Fjava%2Fpushpull%2FAnyObjectPullResultHandlerImpl.java?ref=6da490da5887d1d82404915a48fe617574d5bad8","patch":"@@ -81,7 +81,7 @@ protected AnyPatch newPatch(final String key) {\n     }\n \n     @Override\n-    protected WorkflowResult<String> update(final AnyPatch patch) {\n+    protected WorkflowResult<? extends AnyPatch> update(final AnyPatch patch) {\n         return awfAdapter.update((AnyObjectPatch) patch);\n     }\n "},{"sha":"48f464a7df3e155367ea37af615022c9d93c6e16","filename":"core/provisioning-java/src/main/java/org/apache/syncope/core/provisioning/java/pushpull/AnyObjectPushResultHandlerImpl.java","status":"modified","additions":1,"deletions":1,"changes":2,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/6da490da5887d1d82404915a48fe617574d5bad8/core%2Fprovisioning-java%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fprovisioning%2Fjava%2Fpushpull%2FAnyObjectPushResultHandlerImpl.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/6da490da5887d1d82404915a48fe617574d5bad8/core%2Fprovisioning-java%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fprovisioning%2Fjava%2Fpushpull%2FAnyObjectPushResultHandlerImpl.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fprovisioning-java%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fprovisioning%2Fjava%2Fpushpull%2FAnyObjectPushResultHandlerImpl.java?ref=6da490da5887d1d82404915a48fe617574d5bad8","patch":"@@ -63,7 +63,7 @@ protected AnyPatch newPatch(final String key) {\n     }\n \n     @Override\n-    protected WorkflowResult<String> update(final AnyPatch patch) {\n+    protected WorkflowResult<? extends AnyObjectPatch> update(final AnyPatch patch) {\n         return awfAdapter.update((AnyObjectPatch) patch);\n     }\n "},{"sha":"3e2b5bd02844cd6232e8135ef5f748f0776ebf03","filename":"core/provisioning-java/src/main/java/org/apache/syncope/core/provisioning/java/pushpull/GroupPullResultHandlerImpl.java","status":"modified","additions":1,"deletions":1,"changes":2,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/6da490da5887d1d82404915a48fe617574d5bad8/core%2Fprovisioning-java%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fprovisioning%2Fjava%2Fpushpull%2FGroupPullResultHandlerImpl.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/6da490da5887d1d82404915a48fe617574d5bad8/core%2Fprovisioning-java%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fprovisioning%2Fjava%2Fpushpull%2FGroupPullResultHandlerImpl.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fprovisioning-java%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fprovisioning%2Fjava%2Fpushpull%2FGroupPullResultHandlerImpl.java?ref=6da490da5887d1d82404915a48fe617574d5bad8","patch":"@@ -91,7 +91,7 @@ protected AnyPatch newPatch(final String key) {\n     }\n \n     @Override\n-    protected WorkflowResult<String> update(final AnyPatch patch) {\n+    protected WorkflowResult<? extends AnyPatch> update(final AnyPatch patch) {\n         return gwfAdapter.update((GroupPatch) patch);\n     }\n "},{"sha":"01a112d17c53d2d1e47d85bfecb5b9e7c8b9fe73","filename":"core/provisioning-java/src/main/java/org/apache/syncope/core/provisioning/java/pushpull/GroupPushResultHandlerImpl.java","status":"modified","additions":1,"deletions":1,"changes":2,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/6da490da5887d1d82404915a48fe617574d5bad8/core%2Fprovisioning-java%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fprovisioning%2Fjava%2Fpushpull%2FGroupPushResultHandlerImpl.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/6da490da5887d1d82404915a48fe617574d5bad8/core%2Fprovisioning-java%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fprovisioning%2Fjava%2Fpushpull%2FGroupPushResultHandlerImpl.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fprovisioning-java%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fprovisioning%2Fjava%2Fpushpull%2FGroupPushResultHandlerImpl.java?ref=6da490da5887d1d82404915a48fe617574d5bad8","patch":"@@ -63,7 +63,7 @@ protected AnyPatch newPatch(final String key) {\n     }\n \n     @Override\n-    protected WorkflowResult<String> update(final AnyPatch patch) {\n+    protected WorkflowResult<? extends AnyPatch> update(final AnyPatch patch) {\n         return gwfAdapter.update((GroupPatch) patch);\n     }\n "},{"sha":"fa299a046eb7d6357616436f5ecd807d454eefd7","filename":"core/provisioning-java/src/main/java/org/apache/syncope/core/provisioning/java/pushpull/UserPullResultHandlerImpl.java","status":"modified","additions":2,"deletions":3,"changes":5,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/6da490da5887d1d82404915a48fe617574d5bad8/core%2Fprovisioning-java%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fprovisioning%2Fjava%2Fpushpull%2FUserPullResultHandlerImpl.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/6da490da5887d1d82404915a48fe617574d5bad8/core%2Fprovisioning-java%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fprovisioning%2Fjava%2Fpushpull%2FUserPullResultHandlerImpl.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fprovisioning-java%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fprovisioning%2Fjava%2Fpushpull%2FUserPullResultHandlerImpl.java?ref=6da490da5887d1d82404915a48fe617574d5bad8","patch":"@@ -81,10 +81,9 @@ protected AnyPatch newPatch(final String key) {\n     }\n \n     @Override\n-    protected WorkflowResult<String> update(final AnyPatch patch) {\n+    protected WorkflowResult<? extends AnyPatch> update(final AnyPatch patch) {\n         WorkflowResult<Pair<UserPatch, Boolean>> update = uwfAdapter.update((UserPatch) patch);\n-        return new WorkflowResult<>(\n-                update.getResult().getLeft().getKey(), update.getPropByRes(), update.getPerformedTasks());\n+        return new WorkflowResult<>(update.getResult().getLeft(), update.getPropByRes(), update.getPerformedTasks());\n     }\n \n     @Override"},{"sha":"b89850f79173055a3202f6372eea2260a9fb27b7","filename":"core/provisioning-java/src/main/java/org/apache/syncope/core/provisioning/java/pushpull/UserPushResultHandlerImpl.java","status":"modified","additions":2,"deletions":3,"changes":5,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/6da490da5887d1d82404915a48fe617574d5bad8/core%2Fprovisioning-java%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fprovisioning%2Fjava%2Fpushpull%2FUserPushResultHandlerImpl.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/6da490da5887d1d82404915a48fe617574d5bad8/core%2Fprovisioning-java%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fprovisioning%2Fjava%2Fpushpull%2FUserPushResultHandlerImpl.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fprovisioning-java%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fprovisioning%2Fjava%2Fpushpull%2FUserPushResultHandlerImpl.java?ref=6da490da5887d1d82404915a48fe617574d5bad8","patch":"@@ -91,10 +91,9 @@ protected AnyPatch newPatch(final String key) {\n     }\n \n     @Override\n-    protected WorkflowResult<String> update(final AnyPatch patch) {\n+    protected WorkflowResult<? extends AnyPatch> update(final AnyPatch patch) {\n         WorkflowResult<Pair<UserPatch, Boolean>> update = uwfAdapter.update((UserPatch) patch);\n-        return new WorkflowResult<>(\n-                update.getResult().getLeft().getKey(), update.getPropByRes(), update.getPerformedTasks());\n+        return new WorkflowResult<>(update.getResult().getLeft(), update.getPropByRes(), update.getPerformedTasks());\n     }\n \n }"},{"sha":"3a9f21f0f547e838027069a00306c11de0e94523","filename":"core/workflow-api/src/main/java/org/apache/syncope/core/workflow/api/AnyObjectWorkflowAdapter.java","status":"modified","additions":1,"deletions":1,"changes":2,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/6da490da5887d1d82404915a48fe617574d5bad8/core%2Fworkflow-api%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fworkflow%2Fapi%2FAnyObjectWorkflowAdapter.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/6da490da5887d1d82404915a48fe617574d5bad8/core%2Fworkflow-api%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fworkflow%2Fapi%2FAnyObjectWorkflowAdapter.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fworkflow-api%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fworkflow%2Fapi%2FAnyObjectWorkflowAdapter.java?ref=6da490da5887d1d82404915a48fe617574d5bad8","patch":"@@ -50,7 +50,7 @@ public interface AnyObjectWorkflowAdapter extends WorkflowAdapter {\n      * @param anyObjectPatch modification set to be performed\n      * @return anyObject just updated and propagations to be performed\n      */\n-    WorkflowResult<String> update(AnyObjectPatch anyObjectPatch);\n+    WorkflowResult<AnyObjectPatch> update(AnyObjectPatch anyObjectPatch);\n \n     /**\n      * Delete a anyObject."},{"sha":"72595f6acc2865694ec388de54a767762d22a153","filename":"core/workflow-api/src/main/java/org/apache/syncope/core/workflow/api/GroupWorkflowAdapter.java","status":"modified","additions":1,"deletions":1,"changes":2,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/6da490da5887d1d82404915a48fe617574d5bad8/core%2Fworkflow-api%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fworkflow%2Fapi%2FGroupWorkflowAdapter.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/6da490da5887d1d82404915a48fe617574d5bad8/core%2Fworkflow-api%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fworkflow%2Fapi%2FGroupWorkflowAdapter.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fworkflow-api%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fworkflow%2Fapi%2FGroupWorkflowAdapter.java?ref=6da490da5887d1d82404915a48fe617574d5bad8","patch":"@@ -50,7 +50,7 @@ public interface GroupWorkflowAdapter extends WorkflowAdapter {\n      * @param groupPatch modification set to be performed\n      * @return group just updated and propagations to be performed\n      */\n-    WorkflowResult<String> update(GroupPatch groupPatch);\n+    WorkflowResult<GroupPatch> update(GroupPatch groupPatch);\n \n     /**\n      * Delete a group."},{"sha":"2862380a956add106c12036635c7e0379439270e","filename":"core/workflow-flowable/src/main/java/org/apache/syncope/core/workflow/flowable/FlowableUserWorkflowAdapter.java","status":"modified","additions":3,"deletions":6,"changes":9,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/6da490da5887d1d82404915a48fe617574d5bad8/core%2Fworkflow-flowable%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fworkflow%2Fflowable%2FFlowableUserWorkflowAdapter.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/6da490da5887d1d82404915a48fe617574d5bad8/core%2Fworkflow-flowable%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fworkflow%2Fflowable%2FFlowableUserWorkflowAdapter.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fworkflow-flowable%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fworkflow%2Fflowable%2FFlowableUserWorkflowAdapter.java?ref=6da490da5887d1d82404915a48fe617574d5bad8","patch":"@@ -278,8 +278,7 @@ protected WorkflowResult<Pair<String, Boolean>> doCreate(\n \n         Set<String> tasks = getPerformedTasks(user);\n \n-        return new WorkflowResult<>(\n-                Pair.of(user.getKey(), propagateEnable), propByRes, tasks);\n+        return new WorkflowResult<>(Pair.of(user.getKey(), propagateEnable), propByRes, tasks);\n     }\n \n     protected Set<String> doExecuteTask(final User user, final String task, final Map<String, Object> moreVariables) {\n@@ -348,8 +347,7 @@ protected WorkflowResult<Pair<UserPatch, Boolean>> doUpdate(final User user, fin\n         Boolean propagateEnable = engine.getRuntimeService().getVariable(\n                 user.getWorkflowId(), PROPAGATE_ENABLE, Boolean.class);\n \n-        return new WorkflowResult<>(\n-                Pair.of(updatedPatch, propagateEnable), propByRes, tasks);\n+        return new WorkflowResult<>(Pair.of(updatedPatch, propagateEnable), propByRes, tasks);\n     }\n \n     @Override\n@@ -418,8 +416,7 @@ protected WorkflowResult<Pair<UserPatch, Boolean>> doConfirmPasswordReset(\n         Boolean propagateEnable = engine.getRuntimeService().getVariable(\n                 user.getWorkflowId(), PROPAGATE_ENABLE, Boolean.class);\n \n-        return new WorkflowResult<>(\n-                Pair.of(updatedPatch, propagateEnable), propByRes, tasks);\n+        return new WorkflowResult<>(Pair.of(updatedPatch, propagateEnable), propByRes, tasks);\n     }\n \n     @Override"},{"sha":"7f1c11455c53011ba8bdc26d965fceb530d7b768","filename":"core/workflow-flowable/src/main/java/org/apache/syncope/core/workflow/flowable/task/Update.java","status":"modified","additions":15,"deletions":0,"changes":15,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/6da490da5887d1d82404915a48fe617574d5bad8/core%2Fworkflow-flowable%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fworkflow%2Fflowable%2Ftask%2FUpdate.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/6da490da5887d1d82404915a48fe617574d5bad8/core%2Fworkflow-flowable%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fworkflow%2Fflowable%2Ftask%2FUpdate.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fworkflow-flowable%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fworkflow%2Fflowable%2Ftask%2FUpdate.java?ref=6da490da5887d1d82404915a48fe617574d5bad8","patch":"@@ -18,7 +18,12 @@\n  */\n package org.apache.syncope.core.workflow.flowable.task;\n \n+import java.util.Set;\n+import org.apache.syncope.common.lib.AnyOperations;\n+import org.apache.syncope.common.lib.patch.PasswordPatch;\n import org.apache.syncope.common.lib.patch.UserPatch;\n+import org.apache.syncope.common.lib.to.AttrTO;\n+import org.apache.syncope.common.lib.to.UserTO;\n import org.apache.syncope.core.provisioning.api.PropagationByResource;\n import org.apache.syncope.core.persistence.api.entity.user.User;\n import org.apache.syncope.core.provisioning.api.data.UserDataBinder;\n@@ -39,7 +44,17 @@ protected void doExecute(final String executionId) {\n         UserPatch userPatch = engine.getRuntimeService().\n                 getVariable(executionId, FlowableUserWorkflowAdapter.USER_PATCH, UserPatch.class);\n \n+        UserTO original = dataBinder.getUserTO(user, true);\n+\n         PropagationByResource propByRes = dataBinder.update(user, userPatch);\n+        PasswordPatch password = userPatch.getPassword();\n+        Set<AttrTO> virAttrs = userPatch.getVirAttrs();\n+\n+        UserTO updated = dataBinder.getUserTO(user.getKey());\n+        userPatch = AnyOperations.diff(updated, original, false);\n+        userPatch.setPassword(password);\n+        userPatch.getVirAttrs().clear();\n+        userPatch.getVirAttrs().addAll(virAttrs);\n \n         // report updated user and propagation by resource as result\n         engine.getRuntimeService().setVariable(executionId, FlowableUserWorkflowAdapter.USER, user);"},{"sha":"f502fb37fcb72e05ccc2b67dc83823334a4ce037","filename":"core/workflow-java/src/main/java/org/apache/syncope/core/workflow/java/AbstractAnyObjectWorkflowAdapter.java","status":"modified","additions":4,"deletions":3,"changes":7,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/6da490da5887d1d82404915a48fe617574d5bad8/core%2Fworkflow-java%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fworkflow%2Fjava%2FAbstractAnyObjectWorkflowAdapter.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/6da490da5887d1d82404915a48fe617574d5bad8/core%2Fworkflow-java%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fworkflow%2Fjava%2FAbstractAnyObjectWorkflowAdapter.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fworkflow-java%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fworkflow%2Fjava%2FAbstractAnyObjectWorkflowAdapter.java?ref=6da490da5887d1d82404915a48fe617574d5bad8","patch":"@@ -56,11 +56,12 @@ public WorkflowResult<String> create(final AnyObjectTO anyObjectTO) {\n         return doCreate(anyObjectTO);\n     }\n \n-    protected abstract WorkflowResult<String> doUpdate(AnyObject anyObject, AnyObjectPatch anyObjectPatch);\n+    protected abstract WorkflowResult<AnyObjectPatch> doUpdate(AnyObject anyObject, AnyObjectPatch anyObjectPatch);\n \n     @Override\n-    public WorkflowResult<String> update(final AnyObjectPatch anyObjectPatch) {\n-        WorkflowResult<String> result = doUpdate(anyObjectDAO.authFind(anyObjectPatch.getKey()), anyObjectPatch);\n+    public WorkflowResult<AnyObjectPatch> update(final AnyObjectPatch anyObjectPatch) {\n+        WorkflowResult<AnyObjectPatch> result =\n+                doUpdate(anyObjectDAO.authFind(anyObjectPatch.getKey()), anyObjectPatch);\n \n         // re-read to ensure that requester's administration rights are still valid\n         anyObjectDAO.authFind(anyObjectPatch.getKey());"},{"sha":"153fb8a9e3f4b5fd9b31a2b7cd252a7d9ba158b0","filename":"core/workflow-java/src/main/java/org/apache/syncope/core/workflow/java/AbstractGroupWorkflowAdapter.java","status":"modified","additions":3,"deletions":3,"changes":6,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/6da490da5887d1d82404915a48fe617574d5bad8/core%2Fworkflow-java%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fworkflow%2Fjava%2FAbstractGroupWorkflowAdapter.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/6da490da5887d1d82404915a48fe617574d5bad8/core%2Fworkflow-java%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fworkflow%2Fjava%2FAbstractGroupWorkflowAdapter.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fworkflow-java%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fworkflow%2Fjava%2FAbstractGroupWorkflowAdapter.java?ref=6da490da5887d1d82404915a48fe617574d5bad8","patch":"@@ -55,11 +55,11 @@ public WorkflowResult<String> create(final GroupTO groupTO) {\n         return doCreate(groupTO);\n     }\n \n-    protected abstract WorkflowResult<String> doUpdate(Group group, GroupPatch groupPatch);\n+    protected abstract WorkflowResult<GroupPatch> doUpdate(Group group, GroupPatch groupPatch);\n \n     @Override\n-    public WorkflowResult<String> update(final GroupPatch groupPatch) {\n-        WorkflowResult<String> result = doUpdate(groupDAO.authFind(groupPatch.getKey()), groupPatch);\n+    public WorkflowResult<GroupPatch> update(final GroupPatch groupPatch) {\n+        WorkflowResult<GroupPatch> result = doUpdate(groupDAO.authFind(groupPatch.getKey()), groupPatch);\n \n         // re-read to ensure that requester's administration rights are still valid\n         groupDAO.authFind(groupPatch.getKey());"},{"sha":"8899b06b20267a20a6efd32c6e40ce183f9e889d","filename":"core/workflow-java/src/main/java/org/apache/syncope/core/workflow/java/DefaultAnyObjectWorkflowAdapter.java","status":"modified","additions":12,"deletions":3,"changes":15,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/6da490da5887d1d82404915a48fe617574d5bad8/core%2Fworkflow-java%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fworkflow%2Fjava%2FDefaultAnyObjectWorkflowAdapter.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/6da490da5887d1d82404915a48fe617574d5bad8/core%2Fworkflow-java%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fworkflow%2Fjava%2FDefaultAnyObjectWorkflowAdapter.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fworkflow-java%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fworkflow%2Fjava%2FDefaultAnyObjectWorkflowAdapter.java?ref=6da490da5887d1d82404915a48fe617574d5bad8","patch":"@@ -21,8 +21,11 @@\n import java.io.OutputStream;\n import java.util.Collections;\n import java.util.List;\n+import java.util.Set;\n+import org.apache.syncope.common.lib.AnyOperations;\n import org.apache.syncope.common.lib.patch.AnyObjectPatch;\n import org.apache.syncope.common.lib.to.AnyObjectTO;\n+import org.apache.syncope.common.lib.to.AttrTO;\n import org.apache.syncope.common.lib.to.WorkflowDefinitionTO;\n import org.apache.syncope.common.lib.to.WorkflowFormTO;\n import org.apache.syncope.core.provisioning.api.PropagationByResource;\n@@ -50,12 +53,18 @@ protected WorkflowResult<String> doCreate(final AnyObjectTO anyObjectTO) {\n     }\n \n     @Override\n-    protected WorkflowResult<String> doUpdate(final AnyObject anyObject, final AnyObjectPatch anyObjectPatch) {\n+    protected WorkflowResult<AnyObjectPatch> doUpdate(final AnyObject anyObject, final AnyObjectPatch anyObjectPatch) {\n+        AnyObjectTO original = dataBinder.getAnyObjectTO(anyObject, true);\n+\n         PropagationByResource propByRes = dataBinder.update(anyObject, anyObjectPatch);\n+        Set<AttrTO> virAttrs = anyObjectPatch.getVirAttrs();\n \n-        AnyObject updated = anyObjectDAO.save(anyObject);\n+        AnyObjectTO updated = dataBinder.getAnyObjectTO(anyObjectDAO.save(anyObject), true);\n+        AnyObjectPatch effectivePatch = AnyOperations.diff(updated, original, false);\n+        effectivePatch.getVirAttrs().clear();\n+        effectivePatch.getVirAttrs().addAll(virAttrs);\n \n-        return new WorkflowResult<>(updated.getKey(), propByRes, \"update\");\n+        return new WorkflowResult<>(effectivePatch, propByRes, \"update\");\n     }\n \n     @Override"},{"sha":"b61bbf3aa8422e9a37252731c5b9378053c1521a","filename":"core/workflow-java/src/main/java/org/apache/syncope/core/workflow/java/DefaultGroupWorkflowAdapter.java","status":"modified","additions":12,"deletions":3,"changes":15,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/6da490da5887d1d82404915a48fe617574d5bad8/core%2Fworkflow-java%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fworkflow%2Fjava%2FDefaultGroupWorkflowAdapter.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/6da490da5887d1d82404915a48fe617574d5bad8/core%2Fworkflow-java%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fworkflow%2Fjava%2FDefaultGroupWorkflowAdapter.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fworkflow-java%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fworkflow%2Fjava%2FDefaultGroupWorkflowAdapter.java?ref=6da490da5887d1d82404915a48fe617574d5bad8","patch":"@@ -21,7 +21,10 @@\n import java.io.OutputStream;\n import java.util.Collections;\n import java.util.List;\n+import java.util.Set;\n+import org.apache.syncope.common.lib.AnyOperations;\n import org.apache.syncope.common.lib.patch.GroupPatch;\n+import org.apache.syncope.common.lib.to.AttrTO;\n import org.apache.syncope.common.lib.to.GroupTO;\n import org.apache.syncope.common.lib.to.WorkflowDefinitionTO;\n import org.apache.syncope.common.lib.to.WorkflowFormTO;\n@@ -50,12 +53,18 @@ protected WorkflowResult<String> doCreate(final GroupTO groupTO) {\n     }\n \n     @Override\n-    protected WorkflowResult<String> doUpdate(final Group group, final GroupPatch groupPatch) {\n+    protected WorkflowResult<GroupPatch> doUpdate(final Group group, final GroupPatch groupPatch) {\n+        GroupTO original = dataBinder.getGroupTO(group, true);\n+\n         PropagationByResource propByRes = dataBinder.update(group, groupPatch);\n+        Set<AttrTO> virAttrs = groupPatch.getVirAttrs();\n \n-        Group updated = groupDAO.save(group);\n+        GroupTO updated = dataBinder.getGroupTO(groupDAO.save(group), true);\n+        GroupPatch effectivePatch = AnyOperations.diff(updated, original, false);\n+        effectivePatch.getVirAttrs().clear();\n+        effectivePatch.getVirAttrs().addAll(virAttrs);\n \n-        return new WorkflowResult<>(updated.getKey(), propByRes, \"update\");\n+        return new WorkflowResult<>(effectivePatch, propByRes, \"update\");\n     }\n \n     @Override"},{"sha":"6365c3376ee419e94613852a9a9ee9a11fec2d21","filename":"core/workflow-java/src/main/java/org/apache/syncope/core/workflow/java/DefaultUserWorkflowAdapter.java","status":"modified","additions":13,"deletions":2,"changes":15,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/6da490da5887d1d82404915a48fe617574d5bad8/core%2Fworkflow-java%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fworkflow%2Fjava%2FDefaultUserWorkflowAdapter.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/6da490da5887d1d82404915a48fe617574d5bad8/core%2Fworkflow-java%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fworkflow%2Fjava%2FDefaultUserWorkflowAdapter.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fworkflow-java%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fworkflow%2Fjava%2FDefaultUserWorkflowAdapter.java?ref=6da490da5887d1d82404915a48fe617574d5bad8","patch":"@@ -21,9 +21,12 @@\n import java.io.OutputStream;\n import java.util.Collections;\n import java.util.List;\n+import java.util.Set;\n import org.apache.commons.lang3.tuple.Pair;\n+import org.apache.syncope.common.lib.AnyOperations;\n import org.apache.syncope.common.lib.patch.PasswordPatch;\n import org.apache.syncope.common.lib.patch.UserPatch;\n+import org.apache.syncope.common.lib.to.AttrTO;\n import org.apache.syncope.common.lib.to.UserTO;\n import org.apache.syncope.common.lib.to.WorkflowDefinitionTO;\n import org.apache.syncope.common.lib.to.WorkflowFormTO;\n@@ -96,11 +99,19 @@ protected WorkflowResult<String> doActivate(final User user, final String token)\n \n     @Override\n     protected WorkflowResult<Pair<UserPatch, Boolean>> doUpdate(final User user, final UserPatch userPatch) {\n+        UserTO original = dataBinder.getUserTO(user, true);\n+\n         PropagationByResource propByRes = dataBinder.update(user, userPatch);\n+        PasswordPatch password = userPatch.getPassword();\n+        Set<AttrTO> virAttrs = userPatch.getVirAttrs();\n \n-        userDAO.save(user);\n+        UserTO updated = dataBinder.getUserTO(userDAO.save(user), true);\n+        UserPatch effectivePatch = AnyOperations.diff(updated, original, false);\n+        effectivePatch.setPassword(password);\n+        effectivePatch.getVirAttrs().clear();\n+        effectivePatch.getVirAttrs().addAll(virAttrs);\n \n-        return new WorkflowResult<>(Pair.of(userPatch, !user.isSuspended()), propByRes, \"update\");\n+        return new WorkflowResult<>(Pair.of(effectivePatch, !user.isSuspended()), propByRes, \"update\");\n     }\n \n     @Override"},{"sha":"8d1c24b602d42dee44c23688348bf66a0e796f73","filename":"ext/camel/provisioning-camel/src/main/java/org/apache/syncope/core/provisioning/camel/CamelAnyObjectProvisioningManager.java","status":"modified","additions":2,"deletions":2,"changes":4,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/6da490da5887d1d82404915a48fe617574d5bad8/ext%2Fcamel%2Fprovisioning-camel%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fprovisioning%2Fcamel%2FCamelAnyObjectProvisioningManager.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/6da490da5887d1d82404915a48fe617574d5bad8/ext%2Fcamel%2Fprovisioning-camel%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fprovisioning%2Fcamel%2FCamelAnyObjectProvisioningManager.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/ext%2Fcamel%2Fprovisioning-camel%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fprovisioning%2Fcamel%2FCamelAnyObjectProvisioningManager.java?ref=6da490da5887d1d82404915a48fe617574d5bad8","patch":"@@ -135,7 +135,7 @@ public String unlink(final AnyObjectPatch anyObjectPatch) {\n             throw (RuntimeException) exchange.getProperty(Exchange.EXCEPTION_CAUGHT);\n         }\n \n-        return exchange.getIn().getBody(String.class);\n+        return exchange.getIn().getBody(AnyObjectPatch.class).getKey();\n     }\n \n     @Override\n@@ -150,7 +150,7 @@ public String link(final AnyObjectPatch anyObjectPatch) {\n             throw (RuntimeException) exchange.getProperty(Exchange.EXCEPTION_CAUGHT);\n         }\n \n-        return exchange.getIn().getBody(String.class);\n+        return exchange.getIn().getBody(AnyObjectPatch.class).getKey();\n     }\n \n     @Override"},{"sha":"430a3517b6706acb41113ea1c33cb029a081a568","filename":"ext/camel/provisioning-camel/src/main/java/org/apache/syncope/core/provisioning/camel/CamelGroupProvisioningManager.java","status":"modified","additions":2,"deletions":2,"changes":4,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/6da490da5887d1d82404915a48fe617574d5bad8/ext%2Fcamel%2Fprovisioning-camel%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fprovisioning%2Fcamel%2FCamelGroupProvisioningManager.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/6da490da5887d1d82404915a48fe617574d5bad8/ext%2Fcamel%2Fprovisioning-camel%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fprovisioning%2Fcamel%2FCamelGroupProvisioningManager.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/ext%2Fcamel%2Fprovisioning-camel%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fprovisioning%2Fcamel%2FCamelGroupProvisioningManager.java?ref=6da490da5887d1d82404915a48fe617574d5bad8","patch":"@@ -154,7 +154,7 @@ public String unlink(final GroupPatch groupPatch) {\n             throw (RuntimeException) exchange.getProperty(Exchange.EXCEPTION_CAUGHT);\n         }\n \n-        return exchange.getIn().getBody(String.class);\n+        return exchange.getIn().getBody(GroupPatch.class).getKey();\n     }\n \n     @Override\n@@ -169,7 +169,7 @@ public String link(final GroupPatch groupPatch) {\n             throw (RuntimeException) exchange.getProperty(Exchange.EXCEPTION_CAUGHT);\n         }\n \n-        return exchange.getIn().getBody(String.class);\n+        return exchange.getIn().getBody(GroupPatch.class).getKey();\n     }\n \n     @Override"},{"sha":"b6ebe66d04d360607486280c242270f93e925d1d","filename":"ext/camel/provisioning-camel/src/main/java/org/apache/syncope/core/provisioning/camel/CamelUserProvisioningManager.java","status":"modified","additions":2,"deletions":4,"changes":6,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/6da490da5887d1d82404915a48fe617574d5bad8/ext%2Fcamel%2Fprovisioning-camel%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fprovisioning%2Fcamel%2FCamelUserProvisioningManager.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/6da490da5887d1d82404915a48fe617574d5bad8/ext%2Fcamel%2Fprovisioning-camel%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fprovisioning%2Fcamel%2FCamelUserProvisioningManager.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/ext%2Fcamel%2Fprovisioning-camel%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fprovisioning%2Fcamel%2FCamelUserProvisioningManager.java?ref=6da490da5887d1d82404915a48fe617574d5bad8","patch":"@@ -154,8 +154,7 @@ public String unlink(final UserPatch userPatch) {\n             throw (RuntimeException) exchange.getProperty(Exchange.EXCEPTION_CAUGHT);\n         }\n \n-        exchange.getIn().setBody((exchange.getIn().getBody(UserPatch.class).getKey()));\n-        return exchange.getIn().getBody(String.class);\n+        return exchange.getIn().getBody(UserPatch.class).getKey();\n     }\n \n     @Override\n@@ -258,8 +257,7 @@ public String link(final UserPatch anyPatch) {\n             throw (RuntimeException) exchange.getProperty(Exchange.EXCEPTION_CAUGHT);\n         }\n \n-        exchange.getIn().setBody((exchange.getIn().getBody(UserPatch.class).getKey()));\n-        return exchange.getIn().getBody(String.class);\n+        return exchange.getIn().getBody(UserPatch.class).getKey();\n     }\n \n     @Override"},{"sha":"bbff7e234b9239c1a96bab774faabd6e30b2bbd1","filename":"ext/camel/provisioning-camel/src/main/java/org/apache/syncope/core/provisioning/camel/producer/UpdateProducer.java","status":"modified","additions":4,"deletions":3,"changes":7,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/6da490da5887d1d82404915a48fe617574d5bad8/ext%2Fcamel%2Fprovisioning-camel%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fprovisioning%2Fcamel%2Fproducer%2FUpdateProducer.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/6da490da5887d1d82404915a48fe617574d5bad8/ext%2Fcamel%2Fprovisioning-camel%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fprovisioning%2Fcamel%2Fproducer%2FUpdateProducer.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/ext%2Fcamel%2Fprovisioning-camel%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fprovisioning%2Fcamel%2Fproducer%2FUpdateProducer.java?ref=6da490da5887d1d82404915a48fe617574d5bad8","patch":"@@ -63,11 +63,12 @@ public void process(final Exchange exchange) throws Exception {\n                 exchange.getOut().setBody(Pair.of(\n                         updated.getResult().getLeft(), propagationReporter.getStatuses()));\n             } else if (actual instanceof AnyPatch) {\n-                WorkflowResult<String> updated = (WorkflowResult<String>) exchange.getIn().getBody();\n+                WorkflowResult<? extends AnyPatch> updated =\n+                        (WorkflowResult<? extends AnyPatch>) exchange.getIn().getBody();\n \n                 List<PropagationTask> tasks = getPropagationManager().getUpdateTasks(\n                         actual instanceof AnyObjectPatch ? AnyTypeKind.ANY_OBJECT : AnyTypeKind.GROUP,\n-                        updated.getResult(),\n+                        updated.getResult().getKey(),\n                         false,\n                         null,\n                         updated.getPropByRes(),\n@@ -76,7 +77,7 @@ public void process(final Exchange exchange) throws Exception {\n                 PropagationReporter propagationReporter =\n                         getPropagationTaskExecutor().execute(tasks, nullPriorityAsync);\n \n-                exchange.getOut().setBody(Pair.of(actual, propagationReporter.getStatuses()));\n+                exchange.getOut().setBody(Pair.of(updated.getResult(), propagationReporter.getStatuses()));\n             }\n         }\n     }"},{"sha":"ca81a1d295890b7b342c65c4b895fc87235d0f67","filename":"fit/core-reference/src/test/java/org/apache/syncope/fit/core/UserIssuesITCase.java","status":"modified","additions":1,"deletions":1,"changes":2,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/6da490da5887d1d82404915a48fe617574d5bad8/fit%2Fcore-reference%2Fsrc%2Ftest%2Fjava%2Forg%2Fapache%2Fsyncope%2Ffit%2Fcore%2FUserIssuesITCase.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/6da490da5887d1d82404915a48fe617574d5bad8/fit%2Fcore-reference%2Fsrc%2Ftest%2Fjava%2Forg%2Fapache%2Fsyncope%2Ffit%2Fcore%2FUserIssuesITCase.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/fit%2Fcore-reference%2Fsrc%2Ftest%2Fjava%2Forg%2Fapache%2Fsyncope%2Ffit%2Fcore%2FUserIssuesITCase.java?ref=6da490da5887d1d82404915a48fe617574d5bad8","patch":"@@ -565,7 +565,7 @@ public void issueSYNCOPE136AES() {\n     }\n \n     @Test\n-    public void isseSYNCOPE136Random() {\n+    public void issueSYNCOPE136Random() {\n         // 1. create user with no resources\n         UserTO userTO = UserITCase.getUniqueSampleTO(\"syncope136_Random@apache.org\");\n         userTO.getResources().clear();"}]}