{"sha":"3395c6ed6a53f6b52ac0cb66d458e52d2c1c3bf1","node_id":"MDY6Q29tbWl0NjM2ODc5MDYyOjMzOTVjNmVkNmE1M2Y2YjUyYWMwY2I2NmQ0NThlNTJkMmMxYzNiZjE=","commit":{"author":{"name":"Massimiliano Perrone","email":"massimiliano.perrone@tirasa.net","date":"2015-12-15T17:03:59Z"},"committer":{"name":"Massimiliano Perrone","email":"massimiliano.perrone@tirasa.net","date":"2015-12-15T17:08:02Z"},"message":"Activiti option, SYNCOPE-637","tree":{"sha":"9950529c34e25e1ebcae45a621c756ea19bb7028","url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/git/trees/9950529c34e25e1ebcae45a621c756ea19bb7028"},"url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/git/commits/3395c6ed6a53f6b52ac0cb66d458e52d2c1c3bf1","comment_count":0,"verification":{"verified":false,"reason":"unsigned","signature":null,"payload":null}},"url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/3395c6ed6a53f6b52ac0cb66d458e52d2c1c3bf1","html_url":"https://github.com/EnricoDAlessandro97UNI/syncope/commit/3395c6ed6a53f6b52ac0cb66d458e52d2c1c3bf1","comments_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/3395c6ed6a53f6b52ac0cb66d458e52d2c1c3bf1/comments","author":{"login":"massx1","id":1792923,"node_id":"MDQ6VXNlcjE3OTI5MjM=","avatar_url":"https://avatars.githubusercontent.com/u/1792923?v=4","gravatar_id":"","url":"https://api.github.com/users/massx1","html_url":"https://github.com/massx1","followers_url":"https://api.github.com/users/massx1/followers","following_url":"https://api.github.com/users/massx1/following{/other_user}","gists_url":"https://api.github.com/users/massx1/gists{/gist_id}","starred_url":"https://api.github.com/users/massx1/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/massx1/subscriptions","organizations_url":"https://api.github.com/users/massx1/orgs","repos_url":"https://api.github.com/users/massx1/repos","events_url":"https://api.github.com/users/massx1/events{/privacy}","received_events_url":"https://api.github.com/users/massx1/received_events","type":"User","site_admin":false},"committer":{"login":"massx1","id":1792923,"node_id":"MDQ6VXNlcjE3OTI5MjM=","avatar_url":"https://avatars.githubusercontent.com/u/1792923?v=4","gravatar_id":"","url":"https://api.github.com/users/massx1","html_url":"https://github.com/massx1","followers_url":"https://api.github.com/users/massx1/followers","following_url":"https://api.github.com/users/massx1/following{/other_user}","gists_url":"https://api.github.com/users/massx1/gists{/gist_id}","starred_url":"https://api.github.com/users/massx1/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/massx1/subscriptions","organizations_url":"https://api.github.com/users/massx1/orgs","repos_url":"https://api.github.com/users/massx1/repos","events_url":"https://api.github.com/users/massx1/events{/privacy}","received_events_url":"https://api.github.com/users/massx1/received_events","type":"User","site_admin":false},"parents":[{"sha":"335d7f61ab7e60a4f87cd76ac179eda4f318d30c","url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/335d7f61ab7e60a4f87cd76ac179eda4f318d30c","html_url":"https://github.com/EnricoDAlessandro97UNI/syncope/commit/335d7f61ab7e60a4f87cd76ac179eda4f318d30c"}],"stats":{"total":96,"additions":64,"deletions":32},"files":[{"sha":"3f0ae2c23552a06a722d4c866975bf4a682b7a7b","filename":"installer/pom.xml","status":"modified","additions":6,"deletions":0,"changes":6,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/3395c6ed6a53f6b52ac0cb66d458e52d2c1c3bf1/installer%2Fpom.xml","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/3395c6ed6a53f6b52ac0cb66d458e52d2c1c3bf1/installer%2Fpom.xml","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/installer%2Fpom.xml?ref=3395c6ed6a53f6b52ac0cb66d458e52d2c1c3bf1","patch":"@@ -194,6 +194,12 @@ under the License.\n           <include>provisioning.properties</include>\n         </includes>\n       </resource>\n+      <resource>\n+        <directory>${basedir}/../fit/core-reference/src/main/resources</directory>\n+        <includes>\n+          <include>workflow.properties</include>\n+        </includes>\n+      </resource>\n       <resource>\n         <directory>${basedir}</directory>\n         <targetPath>META-INF</targetPath>"},{"sha":"36b4d37e517986f20743d0c269ab3332e9c9d344","filename":"installer/src/main/java/org/apache/syncope/installer/files/CorePom.java","status":"modified","additions":5,"deletions":0,"changes":5,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/3395c6ed6a53f6b52ac0cb66d458e52d2c1c3bf1/installer%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Finstaller%2Ffiles%2FCorePom.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/3395c6ed6a53f6b52ac0cb66d458e52d2c1c3bf1/installer%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Finstaller%2Ffiles%2FCorePom.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/installer%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Finstaller%2Ffiles%2FCorePom.java?ref=3395c6ed6a53f6b52ac0cb66d458e52d2c1c3bf1","patch":"@@ -48,6 +48,11 @@ public final class CorePom {\n             + \"    </dependency>\\n\"\n             + \"  </dependencies>\\n\";\n \n+    public static final String ACTIVITI_PLACEHOLDER = \"    <dependency>\\n\"\n+            + \"      <groupId>org.apache.syncope.core</groupId>\\n\"\n+            + \"      <artifactId>syncope-core-workflow-activiti</artifactId>\\n\"\n+            + \"    </dependency>\\n\";\n+\n     private CorePom() {\n         // private constructor for static utility class\n     }"},{"sha":"66ca0359106ff22af1a9db93a414da8f0756521c","filename":"installer/src/main/java/org/apache/syncope/installer/processes/ArchetypeProcess.java","status":"modified","additions":42,"deletions":27,"changes":69,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/3395c6ed6a53f6b52ac0cb66d458e52d2c1c3bf1/installer%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Finstaller%2Fprocesses%2FArchetypeProcess.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/3395c6ed6a53f6b52ac0cb66d458e52d2c1c3bf1/installer%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Finstaller%2Fprocesses%2FArchetypeProcess.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/installer%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Finstaller%2Fprocesses%2FArchetypeProcess.java?ref=3395c6ed6a53f6b52ac0cb66d458e52d2c1c3bf1","patch":"@@ -98,11 +98,12 @@ public void run(final AbstractUIProcessHandler handler, final String[] args) {\n \n         if (syncopeVersion.contains(\"SNAPSHOT\")) {\n             final File pomFile = new File(syncopeInstallDir + PROPERTIES.getProperty(\"pomFile\"));\n-            String contentPomFile = fileSystemUtils.readFile(pomFile);       \n+            String contentPomFile = fileSystemUtils.readFile(pomFile);\n             fileSystemUtils.\n-                    writeToFile(pomFile, contentPomFile.replace(ParentPom.REPOSITORY_PLACEHOLDER, ParentPom.REPOSITORY_CONTENT_TO_ADD));\n+                    writeToFile(pomFile, contentPomFile.replace(ParentPom.REPOSITORY_PLACEHOLDER,\n+                            ParentPom.REPOSITORY_CONTENT_TO_ADD));\n         }\n-        \n+\n         if (swagger) {\n             final File pomFile = new File(\n                     syncopeInstallDir\n@@ -115,7 +116,7 @@ public void run(final AbstractUIProcessHandler handler, final String[] args) {\n \n             fileSystemUtils.writeToFile(pomFile, contentPomFile);\n         }\n-        \n+\n         if (camel) {\n             final File pomFile = new File(\n                     syncopeInstallDir\n@@ -128,45 +129,59 @@ public void run(final AbstractUIProcessHandler handler, final String[] args) {\n \n             fileSystemUtils.writeToFile(pomFile, contentPomFile);\n             fileSystemUtils.copyFileFromResources(\"/provisioning.properties\",\n-                syncopeInstallDir + PROPERTIES.getProperty(\"provisioningPropertiesFile\"), handler);\n+                    syncopeInstallDir + PROPERTIES.getProperty(\"provisioningPropertiesFile\"), handler);\n         }\n \n         fileSystemUtils.createDirectory(confDirectory);\n         fileSystemUtils.createDirectory(logsDirectory);\n         fileSystemUtils.createDirectory(bundlesDirectory);\n         fileSystemUtils.createDirectory(modelerDirectory);\n \n-        fileSystemUtils.copyFileFromResources(File.separator + PROPERTIES.getProperty(\"modelerPomFile\"),\n-                modelerDirectory + File.separator + PROPERTIES.getProperty(\"pomFile\"), handler);\n-\n-        final File modelerPomFile = new File(modelerDirectory + File.separator + PROPERTIES.getProperty(\"pomFile\"));\n+        if (activiti) {\n+            fileSystemUtils.copyFileFromResources(File.separator + PROPERTIES.getProperty(\"modelerPomFile\"),\n+                    modelerDirectory + File.separator + PROPERTIES.getProperty(\"pomFile\"), handler);\n \n-        final String contentModelerPomFile = fileSystemUtils.readFile(modelerPomFile);\n-        fileSystemUtils.\n-                writeToFile(modelerPomFile, String.format(contentModelerPomFile, modelerDirectory));\n+            final File modelerPomFile = new File(modelerDirectory + File.separator + PROPERTIES.getProperty(\"pomFile\"));\n \n-        fileSystemUtils.copyFile(\n-                syncopeInstallDir\n-                + PROPERTIES.getProperty(\"consoleResDirectory\")\n-                + File.separator + PROPERTIES.getProperty(\"urlConfig\"),\n-                modelerDirectory + File.separator + PROPERTIES.getProperty(\"urlConfig\"));\n-        fileSystemUtils.copyFile(\n-                syncopeInstallDir\n-                + PROPERTIES.getProperty(\"consoleResDirectory\")\n-                + File.separator + PROPERTIES.getProperty(\"saveModel\"),\n-                modelerDirectory + File.separator + PROPERTIES.getProperty(\"saveModel\"));\n+            final String contentModelerPomFile = fileSystemUtils.readFile(modelerPomFile);\n+            fileSystemUtils.\n+                    writeToFile(modelerPomFile, String.format(contentModelerPomFile, modelerDirectory));\n+            fileSystemUtils.copyFile(\n+                    syncopeInstallDir\n+                    + PROPERTIES.getProperty(\"consoleResDirectory\")\n+                    + File.separator + PROPERTIES.getProperty(\"urlConfig\"),\n+                    modelerDirectory + File.separator + PROPERTIES.getProperty(\"urlConfig\"));\n+            fileSystemUtils.copyFile(\n+                    syncopeInstallDir\n+                    + PROPERTIES.getProperty(\"consoleResDirectory\")\n+                    + File.separator + PROPERTIES.getProperty(\"saveModel\"),\n+                    modelerDirectory + File.separator + PROPERTIES.getProperty(\"saveModel\"));\n+\n+            final Properties modelerProperties = new Properties();\n+            modelerProperties.setProperty(\"modeler.directory\", modelerDirectory);\n+            mavenUtils.mvnCleanPackageWithProperties(modelerDirectory, modelerProperties, customMavenProxySettings);\n+            FileSystemUtils.delete(new File(modelerDirectory + File.separator + PROPERTIES.getProperty(\"saveModel\")));\n+            FileSystemUtils.delete(new File(modelerDirectory + File.separator + PROPERTIES.getProperty(\"urlConfig\")));\n+        } else {\n+            final File pomFile = new File(\n+                    syncopeInstallDir\n+                    + File.separator\n+                    + \"core\"\n+                    + File.separator\n+                    + PROPERTIES.getProperty(\"pomFile\"));\n+            String contentPomFile = fileSystemUtils.readFile(pomFile);\n+            contentPomFile = contentPomFile.replace(CorePom.ACTIVITI_PLACEHOLDER, \"\");\n+            fileSystemUtils.writeToFile(pomFile, contentPomFile);\n \n-        final Properties modelerProperties = new Properties();\n-        modelerProperties.setProperty(\"modeler.directory\", modelerDirectory);\n-        mavenUtils.mvnCleanPackageWithProperties(modelerDirectory, modelerProperties, customMavenProxySettings);\n+            fileSystemUtils.copyFileFromResources(\"/workflow.properties\",\n+                    syncopeInstallDir + PROPERTIES.getProperty(\"workflowPropertiesFile\"), handler);\n+        }\n \n         final Properties syncopeProperties = new Properties();\n         syncopeProperties.setProperty(\"conf.directory\", confDirectory);\n         syncopeProperties.setProperty(\"log.directory\", logsDirectory);\n         syncopeProperties.setProperty(\"bundles.directory\", bundlesDirectory);\n         mavenUtils.mvnCleanPackageWithProperties(\n                 installPath + File.separator + artifactId, syncopeProperties, customMavenProxySettings);\n-        FileSystemUtils.delete(new File(modelerDirectory + File.separator + PROPERTIES.getProperty(\"saveModel\")));\n-        FileSystemUtils.delete(new File(modelerDirectory + File.separator + PROPERTIES.getProperty(\"urlConfig\")));\n     }\n }"},{"sha":"febfa0bc0fc4c937b38818e0f464104719bd139d","filename":"installer/src/main/resources/installer.properties","status":"modified","additions":1,"deletions":0,"changes":1,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/3395c6ed6a53f6b52ac0cb66d458e52d2c1c3bf1/installer%2Fsrc%2Fmain%2Fresources%2Finstaller.properties","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/3395c6ed6a53f6b52ac0cb66d458e52d2c1c3bf1/installer%2Fsrc%2Fmain%2Fresources%2Finstaller.properties","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/installer%2Fsrc%2Fmain%2Fresources%2Finstaller.properties?ref=3395c6ed6a53f6b52ac0cb66d458e52d2c1c3bf1","patch":"@@ -23,6 +23,7 @@ enduserResDirectory=enduser/src/main/resources\n pomFile=pom.xml\n masterDomainFile=core/src/main/resources/domains/MasterDomain.xml\n coreMetaInfDirectory=core/src/main/resources/META-INF\n+workflowPropertiesFile=core/src/main/resources/workflow.properties\n provisioningPropertiesFile=core/src/main/resources/provisioning.properties\n masterPropertiesFile=core/src/main/resources/domains/Master.properties\n consolePropertiesFile=console.properties"},{"sha":"327cf1018e205f25a24bb66e4b35fe71732cbcbb","filename":"installer/src/main/resources/izpack/install.xml","status":"modified","additions":5,"deletions":0,"changes":5,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/3395c6ed6a53f6b52ac0cb66d458e52d2c1c3bf1/installer%2Fsrc%2Fmain%2Fresources%2Fizpack%2Finstall.xml","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/3395c6ed6a53f6b52ac0cb66d458e52d2c1c3bf1/installer%2Fsrc%2Fmain%2Fresources%2Fizpack%2Finstall.xml","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/installer%2Fsrc%2Fmain%2Fresources%2Fizpack%2Finstall.xml?ref=3395c6ed6a53f6b52ac0cb66d458e52d2c1c3bf1","patch":"@@ -70,6 +70,11 @@ under the License.\n       <value>true</value>\n     </condition>\n     \n+    <condition type=\"variable\" id=\"options.choice.activiti\">\n+      <name>options.activiti.workflow.adapter</name>\n+      <value>true</value>\n+    </condition>\n+    \n     <condition type=\"variable\" id=\"postgres.choice\">\n       <name>install.type.selection</name>\n       <value>postgres</value>"},{"sha":"5e9124911244915add584f98f741cff9dce76b5f","filename":"installer/src/main/resources/izpack/userInputSpec.xml","status":"modified","additions":5,"deletions":5,"changes":10,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/3395c6ed6a53f6b52ac0cb66d458e52d2c1c3bf1/installer%2Fsrc%2Fmain%2Fresources%2Fizpack%2FuserInputSpec.xml","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/3395c6ed6a53f6b52ac0cb66d458e52d2c1c3bf1/installer%2Fsrc%2Fmain%2Fresources%2Fizpack%2FuserInputSpec.xml","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/installer%2Fsrc%2Fmain%2Fresources%2Fizpack%2FuserInputSpec.xml?ref=3395c6ed6a53f6b52ac0cb66d458e52d2c1c3bf1","patch":"@@ -52,10 +52,6 @@ under the License.\n       <spec id=\"archetype.mvn.log.directory\" size=\"20\" set=\"/var/tmp/syncope/log\" mustExist=\"false\" create=\"true\"/>\n     </field>\n     <field type=\"space\"/>\n-    <field type=\"dir\" variable=\"mvn.modeler.directory\">\n-      <spec id=\"archetype.mvn.modeler.directory\" size=\"20\" set=\"/var/tmp/syncope/modeler\" mustExist=\"false\" create=\"true\"/>\n-    </field>\n-    <field type=\"space\"/>\n     <field type=\"dir\" variable=\"mvn.bundle.directory\">\n       <spec id=\"archetype.mvn.bundle.directory\" size=\"20\" set=\"/var/tmp/syncope/bundles\" mustExist=\"false\" create=\"true\"/>\n     </field>\n@@ -113,7 +109,11 @@ under the License.\n       <spec id=\"options.camel.id\" true=\"true\" false=\"false\" set=\"false\"/>\n     </field>\n     <field type=\"check\" variable=\"options.activiti.workflow.adapter\">\n-      <spec id=\"options.activiti.workflow.adapter.id\" true=\"true\" false=\"false\" set=\"false\"/>\n+      <spec id=\"options.activiti.workflow.adapter.id\" true=\"true\" false=\"false\" set=\"true\"/>\n+    </field>\n+    <field type=\"space\"/>\n+    <field type=\"dir\" variable=\"mvn.modeler.directory\" conditionid=\"options.choice.activiti\">\n+      <spec id=\"archetype.mvn.modeler.directory\" size=\"20\" set=\"/var/tmp/syncope/modeler\" mustExist=\"false\" create=\"true\"/>\n     </field>\n   </panel>\n   "}]}