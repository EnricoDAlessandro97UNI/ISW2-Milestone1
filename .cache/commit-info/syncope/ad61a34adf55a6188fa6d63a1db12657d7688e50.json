{"sha":"ad61a34adf55a6188fa6d63a1db12657d7688e50","node_id":"MDY6Q29tbWl0NjM2ODc5MDYyOmFkNjFhMzRhZGY1NWE2MTg4ZmE2ZDYzYTFkYjEyNjU3ZDc2ODhlNTA=","commit":{"author":{"name":"Unknown","email":"unknown@apache.org","date":"2011-01-13T16:48:23Z"},"committer":{"name":"Unknown","email":"unknown@apache.org","date":"2011-01-13T16:48:23Z"},"message":"Improving, improving, improving performance\n\ngit-svn-id: https://svn.apache.org/repos/asf/incubator/syncope/trunk@1246730 13f79535-47bb-0310-9956-ffa450edef68","tree":{"sha":"cd918b04bf5e02fc39f759bb07f3682a00ba1924","url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/git/trees/cd918b04bf5e02fc39f759bb07f3682a00ba1924"},"url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/git/commits/ad61a34adf55a6188fa6d63a1db12657d7688e50","comment_count":0,"verification":{"verified":false,"reason":"unsigned","signature":null,"payload":null}},"url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/ad61a34adf55a6188fa6d63a1db12657d7688e50","html_url":"https://github.com/EnricoDAlessandro97UNI/syncope/commit/ad61a34adf55a6188fa6d63a1db12657d7688e50","comments_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/ad61a34adf55a6188fa6d63a1db12657d7688e50/comments","author":null,"committer":null,"parents":[{"sha":"db684bc4ee7a6dc8dedfe0202ff20ab1e91595e1","url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/db684bc4ee7a6dc8dedfe0202ff20ab1e91595e1","html_url":"https://github.com/EnricoDAlessandro97UNI/syncope/commit/db684bc4ee7a6dc8dedfe0202ff20ab1e91595e1"}],"stats":{"total":66,"additions":26,"deletions":40},"files":[{"sha":"7f193399dce949c36969de5d045dc9cebf973e5a","filename":"core/src/main/java/org/syncope/core/persistence/beans/role/SyncopeRole.java","status":"modified","additions":0,"deletions":33,"changes":33,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/ad61a34adf55a6188fa6d63a1db12657d7688e50/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fcore%2Fpersistence%2Fbeans%2Frole%2FSyncopeRole.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/ad61a34adf55a6188fa6d63a1db12657d7688e50/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fcore%2Fpersistence%2Fbeans%2Frole%2FSyncopeRole.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fcore%2Fpersistence%2Fbeans%2Frole%2FSyncopeRole.java?ref=ad61a34adf55a6188fa6d63a1db12657d7688e50","patch":"@@ -35,8 +35,6 @@\n import org.syncope.core.persistence.beans.AbstractAttr;\n import org.syncope.core.persistence.beans.AbstractDerAttr;\n import org.syncope.core.persistence.beans.Entitlement;\n-import org.syncope.core.persistence.beans.membership.Membership;\n-import org.syncope.core.persistence.beans.user.SyncopeUser;\n import org.hibernate.validator.constraints.Range;\n \n @Entity\n@@ -56,10 +54,6 @@ public class SyncopeRole extends AbstractAttributable {\n     @ManyToOne(optional = true)\n     private SyncopeRole parent;\n \n-    @OneToMany(cascade = CascadeType.MERGE, mappedBy = \"syncopeRole\")\n-    @Valid\n-    private List<Membership> memberships;\n-\n     @ManyToMany(fetch = FetchType.LAZY)\n     private Set<Entitlement> entitlements;\n \n@@ -82,7 +76,6 @@ public class SyncopeRole extends AbstractAttributable {\n     public SyncopeRole() {\n         super();\n \n-        memberships = new ArrayList<Membership>();\n         entitlements = new HashSet<Entitlement>();\n         attributes = new ArrayList<RAttr>();\n         derivedAttributes = new ArrayList<RDerAttr>();\n@@ -127,32 +120,6 @@ public void setEntitlements(Set<Entitlement> entitlements) {\n         this.entitlements = entitlements;\n     }\n \n-    public boolean addMembership(Membership membership) {\n-        return memberships.add(membership);\n-    }\n-\n-    public boolean removeMembership(Membership membership) {\n-        return memberships.remove(membership);\n-    }\n-\n-    public List<Membership> getMemberships() {\n-        return memberships;\n-    }\n-\n-    public void setMemberships(List<Membership> memberships) {\n-        this.memberships = memberships;\n-    }\n-\n-    public Set<SyncopeUser> getUsers() {\n-        Set<SyncopeUser> result = new HashSet<SyncopeUser>();\n-\n-        for (Membership membership : memberships) {\n-            result.add(membership.getSyncopeUser());\n-        }\n-\n-        return result;\n-    }\n-\n     @Override\n     public <T extends AbstractAttr> boolean addAttribute(T attribute) {\n         return attributes.add((RAttr) attribute);"},{"sha":"31212338bac71384471dd1b562bbc5b711a147cd","filename":"core/src/main/java/org/syncope/core/persistence/dao/SyncopeRoleDAO.java","status":"modified","additions":3,"deletions":0,"changes":3,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/ad61a34adf55a6188fa6d63a1db12657d7688e50/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fcore%2Fpersistence%2Fdao%2FSyncopeRoleDAO.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/ad61a34adf55a6188fa6d63a1db12657d7688e50/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fcore%2Fpersistence%2Fdao%2FSyncopeRoleDAO.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fcore%2Fpersistence%2Fdao%2FSyncopeRoleDAO.java?ref=ad61a34adf55a6188fa6d63a1db12657d7688e50","patch":"@@ -15,6 +15,7 @@\n package org.syncope.core.persistence.dao;\n \n import java.util.List;\n+import org.syncope.core.persistence.beans.membership.Membership;\n import org.syncope.core.persistence.beans.role.SyncopeRole;\n import org.syncope.core.persistence.validation.entity.InvalidEntityException;\n \n@@ -30,6 +31,8 @@ public interface SyncopeRoleDAO extends DAO {\n \n     List<SyncopeRole> findAll();\n \n+    List<Membership> getMemberships(SyncopeRole role);\n+\n     SyncopeRole save(SyncopeRole syncopeRole)\n             throws InvalidEntityException;\n "},{"sha":"2ba84379afecce37f15bbf8bdf14f39018bb60b3","filename":"core/src/main/java/org/syncope/core/persistence/dao/impl/MembershipDAOImpl.java","status":"modified","additions":0,"deletions":1,"changes":1,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/ad61a34adf55a6188fa6d63a1db12657d7688e50/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fcore%2Fpersistence%2Fdao%2Fimpl%2FMembershipDAOImpl.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/ad61a34adf55a6188fa6d63a1db12657d7688e50/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fcore%2Fpersistence%2Fdao%2Fimpl%2FMembershipDAOImpl.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fcore%2Fpersistence%2Fdao%2Fimpl%2FMembershipDAOImpl.java?ref=ad61a34adf55a6188fa6d63a1db12657d7688e50","patch":"@@ -84,7 +84,6 @@ public void delete(final Long id) {\n         syncopeUserDAO.save(membership.getSyncopeUser());\n         membership.setSyncopeUser(null);\n \n-        membership.getSyncopeRole().removeMembership(membership);\n         syncopeRoleDAO.save(membership.getSyncopeRole());\n         membership.setSyncopeRole(null);\n "},{"sha":"104ad2ee4f4fa7f8662b027616d8674f8559b4c7","filename":"core/src/main/java/org/syncope/core/persistence/dao/impl/SyncopeRoleDAOImpl.java","status":"modified","additions":12,"deletions":3,"changes":15,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/ad61a34adf55a6188fa6d63a1db12657d7688e50/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fcore%2Fpersistence%2Fdao%2Fimpl%2FSyncopeRoleDAOImpl.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/ad61a34adf55a6188fa6d63a1db12657d7688e50/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fcore%2Fpersistence%2Fdao%2Fimpl%2FSyncopeRoleDAOImpl.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fcore%2Fpersistence%2Fdao%2Fimpl%2FSyncopeRoleDAOImpl.java?ref=ad61a34adf55a6188fa6d63a1db12657d7688e50","patch":"@@ -98,6 +98,16 @@ public List<SyncopeRole> findAll() {\n         return query.getResultList();\n     }\n \n+    @Override\n+    public List<Membership> getMemberships(final SyncopeRole role) {\n+        Query query = entityManager.createQuery(\n+                \"SELECT e FROM \" + Membership.class.getSimpleName() + \" e\"\n+                + \" WHERE e.syncopeRole=:role\");\n+        query.setParameter(\"role\", role);\n+\n+        return query.getResultList();\n+    }\n+\n     @Override\n     public SyncopeRole save(final SyncopeRole syncopeRole) {\n         return entityManager.merge(syncopeRole);\n@@ -119,14 +129,13 @@ public void delete(final Long id) {\n             delete(child.getId());\n         }\n \n-        for (Membership membership : role.getMemberships()) {\n+        for (Membership membership : getMemberships(role)) {\n             membership.setSyncopeRole(null);\n             membership.getSyncopeUser().removeMembership(membership);\n-            membership.setSyncopeRole(null);\n+            membership.setSyncopeUser(null);\n \n             entityManager.remove(membership);\n         }\n-        role.setMemberships(Collections.EMPTY_LIST);\n \n         for (Entitlement entitlement : role.getEntitlements()) {\n             entitlement.removeRole(role);"},{"sha":"e3e0e49e43beab4ad22452ce64ccdc6f34632ae8","filename":"core/src/main/java/org/syncope/core/persistence/dao/impl/SyncopeUserDAOImpl.java","status":"modified","additions":0,"deletions":1,"changes":1,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/ad61a34adf55a6188fa6d63a1db12657d7688e50/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fcore%2Fpersistence%2Fdao%2Fimpl%2FSyncopeUserDAOImpl.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/ad61a34adf55a6188fa6d63a1db12657d7688e50/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fcore%2Fpersistence%2Fdao%2Fimpl%2FSyncopeUserDAOImpl.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fcore%2Fpersistence%2Fdao%2Fimpl%2FSyncopeUserDAOImpl.java?ref=ad61a34adf55a6188fa6d63a1db12657d7688e50","patch":"@@ -232,7 +232,6 @@ public void delete(final SyncopeUser user) {\n         for (Membership membership : user.getMemberships()) {\n             membership.setSyncopeUser(null);\n \n-            membership.getSyncopeRole().removeMembership(membership);\n             syncopeRoleDAO.save(membership.getSyncopeRole());\n             membership.setSyncopeRole(null);\n "},{"sha":"f417ae3d661d0a39f125d02c61a073b2fc3c1033","filename":"core/src/test/java/org/syncope/core/persistence/relationships/MembershipTest.java","status":"modified","additions":5,"deletions":1,"changes":6,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/ad61a34adf55a6188fa6d63a1db12657d7688e50/core%2Fsrc%2Ftest%2Fjava%2Forg%2Fsyncope%2Fcore%2Fpersistence%2Frelationships%2FMembershipTest.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/ad61a34adf55a6188fa6d63a1db12657d7688e50/core%2Fsrc%2Ftest%2Fjava%2Forg%2Fsyncope%2Fcore%2Fpersistence%2Frelationships%2FMembershipTest.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fsrc%2Ftest%2Fjava%2Forg%2Fsyncope%2Fcore%2Fpersistence%2Frelationships%2FMembershipTest.java?ref=ad61a34adf55a6188fa6d63a1db12657d7688e50","patch":"@@ -24,13 +24,17 @@\n import org.syncope.core.persistence.beans.user.SyncopeUser;\n import org.syncope.core.persistence.dao.MembershipDAO;\n import org.syncope.core.persistence.AbstractTest;\n+import org.syncope.core.persistence.dao.SyncopeRoleDAO;\n \n @Transactional\n public class MembershipTest extends AbstractTest {\n \n     @Autowired\n     private MembershipDAO membershipDAO;\n \n+    @Autowired\n+    private SyncopeRoleDAO syncopeRoleDAO;\n+\n     @Test\n     public final void delete() {\n         Membership membership = membershipDAO.find(4L);\n@@ -44,7 +48,7 @@ public final void delete() {\n         for (Membership m : user.getMemberships()) {\n             assertTrue(m.getId() != 4L);\n         }\n-        for (Membership m : role.getMemberships()) {\n+        for (Membership m : syncopeRoleDAO.getMemberships(role)) {\n             assertTrue(m.getId() != 4L);\n         }\n     }"},{"sha":"62b92b357c152bfaad8d9dbcc11df95d4aacf9bb","filename":"core/src/test/java/org/syncope/core/persistence/relationships/UserTest.java","status":"modified","additions":6,"deletions":1,"changes":7,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/ad61a34adf55a6188fa6d63a1db12657d7688e50/core%2Fsrc%2Ftest%2Fjava%2Forg%2Fsyncope%2Fcore%2Fpersistence%2Frelationships%2FUserTest.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/ad61a34adf55a6188fa6d63a1db12657d7688e50/core%2Fsrc%2Ftest%2Fjava%2Forg%2Fsyncope%2Fcore%2Fpersistence%2Frelationships%2FUserTest.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fsrc%2Ftest%2Fjava%2Forg%2Fsyncope%2Fcore%2Fpersistence%2Frelationships%2FUserTest.java?ref=ad61a34adf55a6188fa6d63a1db12657d7688e50","patch":"@@ -14,6 +14,7 @@\n  */\n package org.syncope.core.persistence.relationships;\n \n+import java.util.List;\n import static org.junit.Assert.*;\n import org.junit.Test;\n \n@@ -28,6 +29,7 @@\n import org.syncope.core.persistence.dao.SyncopeRoleDAO;\n import org.syncope.core.persistence.dao.SyncopeUserDAO;\n import org.syncope.core.persistence.AbstractTest;\n+import org.syncope.core.persistence.beans.membership.Membership;\n \n @Transactional\n public class UserTest extends AbstractTest {\n@@ -57,6 +59,9 @@ public final void test() {\n         assertNull(attributeDAO.find(550L, UAttr.class));\n         assertNull(attributeValueDAO.find(22L, UAttrValue.class));\n         assertNotNull(schemaDAO.find(\"loginDate\", USchema.class));\n-        assertTrue(syncopeRoleDAO.find(7L).getUsers().isEmpty());\n+\n+        List<Membership> memberships =\n+                syncopeRoleDAO.getMemberships(syncopeRoleDAO.find(7L));\n+        assertTrue(memberships.isEmpty());\n     }\n }"}]}