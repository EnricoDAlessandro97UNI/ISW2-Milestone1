{"sha":"fa18eaa2a43198c832fe665d917009c78a7e5fad","node_id":"MDY6Q29tbWl0NjM2ODc5MDYyOmZhMThlYWEyYTQzMTk4YzgzMmZlNjY1ZDkxNzAwOWM3OGE3ZTVmYWQ=","commit":{"author":{"name":"Francesco Chicchiriccò","email":"ilgrosso@apache.org","date":"2014-09-15T12:19:52Z"},"committer":{"name":"Francesco Chicchiriccò","email":"ilgrosso@apache.org","date":"2014-09-15T12:19:52Z"},"message":"Core upgrader: some enhancements + support for PostgreSQL\n\ngit-svn-id: https://svn.apache.org/repos/asf/syncope/branches/1_2_X@1625012 13f79535-47bb-0310-9956-ffa450edef68","tree":{"sha":"c138d2d958a2cd91904aced01dd0b607ce0b059c","url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/git/trees/c138d2d958a2cd91904aced01dd0b607ce0b059c"},"url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/git/commits/fa18eaa2a43198c832fe665d917009c78a7e5fad","comment_count":0,"verification":{"verified":false,"reason":"unsigned","signature":null,"payload":null}},"url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/fa18eaa2a43198c832fe665d917009c78a7e5fad","html_url":"https://github.com/EnricoDAlessandro97UNI/syncope/commit/fa18eaa2a43198c832fe665d917009c78a7e5fad","comments_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/fa18eaa2a43198c832fe665d917009c78a7e5fad/comments","author":{"login":"ilgrosso","id":1064664,"node_id":"MDQ6VXNlcjEwNjQ2NjQ=","avatar_url":"https://avatars.githubusercontent.com/u/1064664?v=4","gravatar_id":"","url":"https://api.github.com/users/ilgrosso","html_url":"https://github.com/ilgrosso","followers_url":"https://api.github.com/users/ilgrosso/followers","following_url":"https://api.github.com/users/ilgrosso/following{/other_user}","gists_url":"https://api.github.com/users/ilgrosso/gists{/gist_id}","starred_url":"https://api.github.com/users/ilgrosso/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ilgrosso/subscriptions","organizations_url":"https://api.github.com/users/ilgrosso/orgs","repos_url":"https://api.github.com/users/ilgrosso/repos","events_url":"https://api.github.com/users/ilgrosso/events{/privacy}","received_events_url":"https://api.github.com/users/ilgrosso/received_events","type":"User","site_admin":false},"committer":{"login":"ilgrosso","id":1064664,"node_id":"MDQ6VXNlcjEwNjQ2NjQ=","avatar_url":"https://avatars.githubusercontent.com/u/1064664?v=4","gravatar_id":"","url":"https://api.github.com/users/ilgrosso","html_url":"https://github.com/ilgrosso","followers_url":"https://api.github.com/users/ilgrosso/followers","following_url":"https://api.github.com/users/ilgrosso/following{/other_user}","gists_url":"https://api.github.com/users/ilgrosso/gists{/gist_id}","starred_url":"https://api.github.com/users/ilgrosso/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ilgrosso/subscriptions","organizations_url":"https://api.github.com/users/ilgrosso/orgs","repos_url":"https://api.github.com/users/ilgrosso/repos","events_url":"https://api.github.com/users/ilgrosso/events{/privacy}","received_events_url":"https://api.github.com/users/ilgrosso/received_events","type":"User","site_admin":false},"parents":[{"sha":"e81f7d6d364703757004349706a2f7e9a80e1b27","url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/e81f7d6d364703757004349706a2f7e9a80e1b27","html_url":"https://github.com/EnricoDAlessandro97UNI/syncope/commit/e81f7d6d364703757004349706a2f7e9a80e1b27"},{"sha":"3549ea69dbc395951064e50d92dea4fb9bbf5717","url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/3549ea69dbc395951064e50d92dea4fb9bbf5717","html_url":"https://github.com/EnricoDAlessandro97UNI/syncope/commit/3549ea69dbc395951064e50d92dea4fb9bbf5717"}],"stats":{"total":127,"additions":118,"deletions":9},"files":[{"sha":"03ae15fbf6a7c3c54864ff0076aff913e031c6b4","filename":"core-upgrader/src/main/java/org/apache/syncope/upgrader/ContentUpgrader.java","status":"modified","additions":7,"deletions":3,"changes":10,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/fa18eaa2a43198c832fe665d917009c78a7e5fad/core-upgrader%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fupgrader%2FContentUpgrader.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/fa18eaa2a43198c832fe665d917009c78a7e5fad/core-upgrader%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fupgrader%2FContentUpgrader.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core-upgrader%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fupgrader%2FContentUpgrader.java?ref=fa18eaa2a43198c832fe665d917009c78a7e5fad","patch":"@@ -593,7 +593,6 @@ private void addTemplatesToRAttrs() {\n             jdbcTemplate.update(\"ALTER TABLE RAttr DROP COLUMN schema_name;\");\n             jdbcTemplate.update(\"ALTER TABLE RDerAttr DROP COLUMN DERIVEDSCHEMA_NAME;\");\n             jdbcTemplate.update(\"ALTER TABLE RVirAttr DROP COLUMN VIRTUALSCHEMA_NAME;\");\n-\n         } catch (DataAccessException ex) {\n             LOG.error(\"Error accessing RAttr or RAttrTemplate table\", ex);\n         }\n@@ -671,6 +670,7 @@ private void addTemplatesToMAttrs() {\n                 // add template to normal attributes\n                 for (Long attrId : jdbcTemplate.queryForList(\"SELECT id FROM MAttr WHERE OWNER_ID = ?\", Long.class,\n                         membership.getId())) {\n+                    \n                     final MAttr mAttr = attrDAO.find(attrId, MAttr.class);\n \n                     LOG.info(\"Adding template to membership normal attribute {}\", mAttr);\n@@ -685,6 +685,7 @@ private void addTemplatesToMAttrs() {\n                 // add template to derived attributes\n                 for (Long attrId : jdbcTemplate.queryForList(\"SELECT id FROM MDerAttr WHERE OWNER_ID = ?\", Long.class,\n                         membership.getId())) {\n+                    \n                     final MDerAttr mDerAttr = derAttrDAO.find(attrId, MDerAttr.class);\n \n                     LOG.info(\"Adding template to membership derived attribute {}\", mDerAttr);\n@@ -699,6 +700,7 @@ private void addTemplatesToMAttrs() {\n                 // add template to virtual attributes\n                 for (Long attrId : jdbcTemplate.queryForList(\"SELECT id FROM MVirAttr WHERE OWNER_ID = ?\", Long.class,\n                         membership.getId())) {\n+                    \n                     final MVirAttr mVirAttr = virAttrDAO.find(attrId, MVirAttr.class);\n \n                     LOG.info(\"Adding template to membership virtual attribute {}\", mVirAttr);\n@@ -725,12 +727,14 @@ private void addTemplatesToMAttrs() {\n \n     private <T extends AbstractAttrTemplate<K>, K extends AbstractSchema> T getTemplate(final Object obj,\n             final String schemaName, final Class<T> reference) {\n+\n         T attrTemplate = null;\n         for (Number number : attrTemplateDAO.findBySchemaName(schemaName, reference)) {\n             final T attrTemplateTemp = attrTemplateDAO.find((Long) number, reference);\n \n-            if (attrTemplateTemp.getOwner().equals(obj instanceof SyncopeRole ? (SyncopeRole) obj : ((Membership) obj).\n-                    getSyncopeRole())) {\n+            if (attrTemplateTemp.getOwner().equals(obj instanceof SyncopeRole\n+                    ? (SyncopeRole) obj : ((Membership) obj).getSyncopeRole())) {\n+\n                 attrTemplate = attrTemplateTemp;\n             }\n         }"},{"sha":"2690b5cd417f875b7a46abee3fe25ad9a7acabf9","filename":"core-upgrader/src/main/resources/mysql-upgrade.sql","status":"renamed","additions":0,"deletions":0,"changes":0,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/fa18eaa2a43198c832fe665d917009c78a7e5fad/core-upgrader%2Fsrc%2Fmain%2Fresources%2Fmysql-upgrade.sql","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/fa18eaa2a43198c832fe665d917009c78a7e5fad/core-upgrader%2Fsrc%2Fmain%2Fresources%2Fmysql-upgrade.sql","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core-upgrader%2Fsrc%2Fmain%2Fresources%2Fmysql-upgrade.sql?ref=fa18eaa2a43198c832fe665d917009c78a7e5fad","previous_filename":"core-upgrader/src/main/resources/syncope-1.1.X-1.2.X.sql"},{"sha":"744a03d2012e79788f3cdc730f1bcf8fd9dd1048","filename":"core-upgrader/src/main/resources/postgresql-upgrade.sql","status":"added","additions":101,"deletions":0,"changes":101,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/fa18eaa2a43198c832fe665d917009c78a7e5fad/core-upgrader%2Fsrc%2Fmain%2Fresources%2Fpostgresql-upgrade.sql","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/fa18eaa2a43198c832fe665d917009c78a7e5fad/core-upgrader%2Fsrc%2Fmain%2Fresources%2Fpostgresql-upgrade.sql","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core-upgrader%2Fsrc%2Fmain%2Fresources%2Fpostgresql-upgrade.sql?ref=fa18eaa2a43198c832fe665d917009c78a7e5fad","patch":"@@ -0,0 +1,101 @@\n+-- Licensed to the Apache Software Foundation (ASF) under one\n+-- or more contributor license agreements.  See the NOTICE file\n+-- distributed with this work for additional information\n+-- regarding copyright ownership.  The ASF licenses this file\n+-- to you under the Apache License, Version 2.0 (the\n+-- \"License\"); you may not use this file except in compliance\n+-- with the License.  You may obtain a copy of the License at\n+\n+--  http://www.apache.org/licenses/LICENSE-2.0\n+\n+-- Unless required by applicable law or agreed to in writing,\n+-- software distributed under the License is distributed on an\n+-- \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+-- KIND, either express or implied.  See the License for the\n+-- specific language governing permissions and limitations\n+-- under the License.\n+\n+-- delete views and indexes, they will be recreated by ContentInitializer\n+\n+DROP VIEW user_search;\n+DROP VIEW user_search_attr;\n+DROP VIEW user_search_membership;\n+DROP VIEW user_search_resource;\n+DROP VIEW user_search_null_attr;\n+DROP VIEW user_search_role_resource;\n+DROP VIEW user_search_unique_attr;\n+DROP VIEW role_search;\n+DROP VIEW role_search_attr;\n+DROP VIEW role_search_entitlements;\n+DROP VIEW role_search_null_attr;\n+DROP VIEW role_search_resource;\n+DROP VIEW role_search_unique_attr;\n+\n+DROP INDEX UAttrValue_stringvalueIndex;\n+DROP INDEX UAttrValue_datevalueIndex; \n+DROP INDEX UAttrValue_longvalueIndex;\n+DROP INDEX UAttrValue_doublevalueIndex;\n+DROP INDEX UAttrValue_booleanvalueIndex;\n+DROP INDEX MAttrValue_stringvalueIndex;\n+DROP INDEX MAttrValue_datevalueIndex;\n+DROP INDEX MAttrValue_longvalueIndex;\n+DROP INDEX MAttrValue_doublevalueIndex;\n+DROP INDEX MAttrValue_booleanvalueIndex;\n+DROP INDEX RAttrValue_stringvalueIndex;\n+DROP INDEX RAttrValue_datevalueIndex;\n+DROP INDEX RAttrValue_longvalueIndex;\n+DROP INDEX RAttrValue_doublevalueIndex;\n+DROP INDEX RAttrValue_booleanvalueIndex;\n+DROP INDEX Task_executedIndex;\n+DROP INDEX ACT_RU_TASK_PARENT_TASK_ID_;\n+\n+--SYNCOPE-451 upgrade table definitions to comply with new Apache OpenJpa 2.3.0 version\n+ALTER TABLE ConnInstance_capabilities ALTER COLUMN capabilities TYPE VARCHAR(20);\n+ALTER TABLE ExternalResource ALTER COLUMN createTraceLevel TYPE VARCHAR(20);\n+ALTER TABLE ExternalResource ALTER COLUMN deleteTraceLevel TYPE VARCHAR(20);\n+ALTER TABLE ExternalResource ALTER COLUMN syncTraceLevel TYPE VARCHAR(20);\n+ALTER TABLE ExternalResource ALTER COLUMN propagationMode TYPE VARCHAR(20);\n+ALTER TABLE ExternalResource ALTER COLUMN updateTraceLevel TYPE VARCHAR(20);\n+ALTER TABLE MSchema ALTER COLUMN type TYPE VARCHAR(20);\n+ALTER TABLE RMappingItem ALTER COLUMN intMappingType TYPE VARCHAR(23);\n+ALTER TABLE RMappingItem ALTER COLUMN purpose TYPE VARCHAR(20);\n+ALTER TABLE RSchema ALTER COLUMN type TYPE VARCHAR(20);\n+ALTER TABLE SyncopeLogger ALTER COLUMN logLevel TYPE VARCHAR(20);\n+ALTER TABLE SyncopeLogger ALTER COLUMN logType TYPE VARCHAR(20);\n+ALTER TABLE SyncopeUser ALTER COLUMN cipherAlgorithm TYPE VARCHAR(20);\n+ALTER TABLE UMappingItem ALTER COLUMN intMappingType TYPE VARCHAR(23);\n+ALTER TABLE UMappingItem ALTER COLUMN purpose TYPE VARCHAR(20);\n+ALTER TABLE USchema ALTER COLUMN type TYPE VARCHAR(20);\n+ALTER TABLE SyncopeUser ALTER COLUMN password TYPE VARCHAR(255);\n+\n+-- SYNCOPE5-524\n+ALTER TABLE ExternalResource RENAME COLUMN xmlConfiguration TO jsonConf;\n+ALTER TABLE ConnInstance RENAME COLUMN xmlConfiguration TO jsonConf;\n+\n+-- preliminary steps for upgrade of (refactored) role and membership attributes\n+ALTER TABLE RAttr DROP CONSTRAINT rattr_schema_name_fkey;\n+ALTER TABLE RDerAttr DROP CONSTRAINT rderattr_derivedschema_name_fkey;\n+ALTER TABLE RVirAttr DROP CONSTRAINT rvirattr_virtualschema_name_fkey;\n+\n+ALTER TABLE MAttr DROP CONSTRAINT mattr_schema_name_fkey;\n+ALTER TABLE MDerAttr DROP CONSTRAINT mderattr_derivedschema_name_fkey;\n+ALTER TABLE MVirAttr DROP CONSTRAINT mvirattr_virtualschema_name_fkey;\n+\n+ALTER TABLE UDerAttr DROP CONSTRAINT uderattr_derivedschema_name_fkey;\n+ALTER TABLE UDerAttr RENAME DERIVEDSCHEMA_NAME TO DERSCHEMA_NAME;\n+ALTER TABLE UDerAttr ADD CONSTRAINT uderattr_derschema_name_fkey FOREIGN KEY (DERSCHEMA_NAME) REFERENCES UDerSchema (name);  \n+\n+ALTER TABLE UVirAttr DROP CONSTRAINT uvirattr_virtualschema_name_fkey;\n+ALTER TABLE UVirAttr RENAME VIRTUALSCHEMA_NAME TO VIRSCHEMA_NAME;\n+ALTER TABLE UVirAttr ADD CONSTRAINT uvirattr_virschema_name_fkey FOREIGN KEY (VIRSCHEMA_NAME) REFERENCES UVirSchema (name);  \n+\n+-- SYNCOPE-444, SYNCOPE-409, SYNCOPE-445\n+ALTER TABLE Notification DROP COLUMN xmlAbout;\n+ALTER TABLE Notification DROP COLUMN xmlRecipients;\n+\n+-- create a backup of SyncopeConf table into new SyncopeConf_temp table\n+create table SyncopeConf_temp (confKey varchar(255) primary key, confValue varchar(255));\n+insert into SyncopeConf_temp (confKey,confValue) select confKey,confValue from SyncopeConf;\n+\n+-- delete SyncopeConf table, it will be created and initilized respectively by OpenJpa and ContentInitializer\n+DROP TABLE SyncopeConf;"},{"sha":"63f5c87c9af4cf480501e9d3557443e6ba3eb21a","filename":"core/src/main/java/org/apache/syncope/core/persistence/beans/ConnInstance.java","status":"modified","additions":10,"deletions":4,"changes":14,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/fa18eaa2a43198c832fe665d917009c78a7e5fad/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fpersistence%2Fbeans%2FConnInstance.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/fa18eaa2a43198c832fe665d917009c78a7e5fad/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fpersistence%2Fbeans%2FConnInstance.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fpersistence%2Fbeans%2FConnInstance.java?ref=fa18eaa2a43198c832fe665d917009c78a7e5fad","patch":"@@ -34,6 +34,7 @@\n import javax.persistence.Id;\n import javax.persistence.Lob;\n import javax.persistence.OneToMany;\n+import org.apache.commons.lang3.ArrayUtils;\n import org.apache.commons.lang3.StringUtils;\n import org.apache.syncope.common.types.ConnConfProperty;\n import org.apache.syncope.common.types.ConnectorCapability;\n@@ -155,10 +156,15 @@ public void setVersion(final String version) {\n     }\n \n     public Set<ConnConfProperty> getConfiguration() {\n-        return StringUtils.isBlank(jsonConf)\n-                ? Collections.<ConnConfProperty>emptySet()\n-                : new HashSet<ConnConfProperty>(\n-                        Arrays.asList(POJOHelper.deserialize(jsonConf, ConnConfProperty[].class)));\n+        Set<ConnConfProperty> configuration = Collections.<ConnConfProperty>emptySet();\n+        if (!StringUtils.isBlank(jsonConf)) {\n+            ConnConfProperty[] deserialized = POJOHelper.deserialize(jsonConf, ConnConfProperty[].class);\n+            if (ArrayUtils.isNotEmpty(deserialized)) {\n+                configuration = new HashSet<ConnConfProperty>(Arrays.asList(deserialized));\n+            }\n+        }\n+\n+        return configuration;\n     }\n \n     public void setConfiguration(final Set<ConnConfProperty> configuration) {"},{"sha":"4ac47563a5cb8781e437c2c73b14e8bac2ab408e","filename":"src/site/xdoc/release-process.xml","status":"modified","additions":0,"deletions":2,"changes":2,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/fa18eaa2a43198c832fe665d917009c78a7e5fad/src%2Fsite%2Fxdoc%2Frelease-process.xml","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/fa18eaa2a43198c832fe665d917009c78a7e5fad/src%2Fsite%2Fxdoc%2Frelease-process.xml","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/src%2Fsite%2Fxdoc%2Frelease-process.xml?ref=fa18eaa2a43198c832fe665d917009c78a7e5fad","patch":"@@ -469,8 +469,6 @@ svn mv -m \"Moving the voted release artifacts to dist/release\" \\\n https://dist.apache.org/repos/dist/dev/syncope/<version>\n https://dist.apache.org/repos/dist/release/syncope/<version>\n \n-svn rm -m \"Cleaning up older releases\" https://dist.apache.org/repos/dist/dev/syncope/<version>\n-\n svn co https://dist.apache.org/repos/dist/release/syncope syncope-dist-release\n cd syncope-dist-release\n svn rm <any older release artifact (if present)>"}]}