{"sha":"6f459ae6b90095617142572f7d66cadc4511dc62","node_id":"C_kwDOJfYA1toAKDZmNDU5YWU2YjkwMDk1NjE3MTQyNTcyZjdkNjZjYWRjNDUxMWRjNjI","commit":{"author":{"name":"Francesco Chicchiriccò","email":"ilgrosso@apache.org","date":"2023-05-04T06:47:41Z"},"committer":{"name":"Francesco Chicchiriccò","email":"ilgrosso@apache.org","date":"2023-05-04T06:49:19Z"},"message":"WA integration tests: relax checks waiting for refresh","tree":{"sha":"acb437c4b176aaabc5e9fe4944a7e3a651c4a5e8","url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/git/trees/acb437c4b176aaabc5e9fe4944a7e3a651c4a5e8"},"url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/git/commits/6f459ae6b90095617142572f7d66cadc4511dc62","comment_count":0,"verification":{"verified":false,"reason":"unsigned","signature":null,"payload":null}},"url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/6f459ae6b90095617142572f7d66cadc4511dc62","html_url":"https://github.com/EnricoDAlessandro97UNI/syncope/commit/6f459ae6b90095617142572f7d66cadc4511dc62","comments_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/6f459ae6b90095617142572f7d66cadc4511dc62/comments","author":{"login":"ilgrosso","id":1064664,"node_id":"MDQ6VXNlcjEwNjQ2NjQ=","avatar_url":"https://avatars.githubusercontent.com/u/1064664?v=4","gravatar_id":"","url":"https://api.github.com/users/ilgrosso","html_url":"https://github.com/ilgrosso","followers_url":"https://api.github.com/users/ilgrosso/followers","following_url":"https://api.github.com/users/ilgrosso/following{/other_user}","gists_url":"https://api.github.com/users/ilgrosso/gists{/gist_id}","starred_url":"https://api.github.com/users/ilgrosso/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ilgrosso/subscriptions","organizations_url":"https://api.github.com/users/ilgrosso/orgs","repos_url":"https://api.github.com/users/ilgrosso/repos","events_url":"https://api.github.com/users/ilgrosso/events{/privacy}","received_events_url":"https://api.github.com/users/ilgrosso/received_events","type":"User","site_admin":false},"committer":{"login":"ilgrosso","id":1064664,"node_id":"MDQ6VXNlcjEwNjQ2NjQ=","avatar_url":"https://avatars.githubusercontent.com/u/1064664?v=4","gravatar_id":"","url":"https://api.github.com/users/ilgrosso","html_url":"https://github.com/ilgrosso","followers_url":"https://api.github.com/users/ilgrosso/followers","following_url":"https://api.github.com/users/ilgrosso/following{/other_user}","gists_url":"https://api.github.com/users/ilgrosso/gists{/gist_id}","starred_url":"https://api.github.com/users/ilgrosso/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ilgrosso/subscriptions","organizations_url":"https://api.github.com/users/ilgrosso/orgs","repos_url":"https://api.github.com/users/ilgrosso/repos","events_url":"https://api.github.com/users/ilgrosso/events{/privacy}","received_events_url":"https://api.github.com/users/ilgrosso/received_events","type":"User","site_admin":false},"parents":[{"sha":"db9158af51615f2fd362cd7292d86c19840f5f54","url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/db9158af51615f2fd362cd7292d86c19840f5f54","html_url":"https://github.com/EnricoDAlessandro97UNI/syncope/commit/db9158af51615f2fd362cd7292d86c19840f5f54"}],"stats":{"total":11,"additions":10,"deletions":1},"files":[{"sha":"baf6dccb7cbdee388f3fa88ed8845d2e5474c6d0","filename":"fit/wa-reference/src/main/resources/wa-embedded.properties","status":"modified","additions":1,"deletions":0,"changes":1,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/6f459ae6b90095617142572f7d66cadc4511dc62/fit%2Fwa-reference%2Fsrc%2Fmain%2Fresources%2Fwa-embedded.properties","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/6f459ae6b90095617142572f7d66cadc4511dc62/fit%2Fwa-reference%2Fsrc%2Fmain%2Fresources%2Fwa-embedded.properties","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/fit%2Fwa-reference%2Fsrc%2Fmain%2Fresources%2Fwa-embedded.properties?ref=6f459ae6b90095617142572f7d66cadc4511dc62","patch":"@@ -15,6 +15,7 @@\n # specific language governing permissions and limitations\n # under the License.\n spring.main.allow-circular-references=true\n+spring.cloud.refresh.never-refreshable=com.zaxxer.hikari.HikariDataSource,org.apereo.cas.configuration.model.core.CasServerProperties\n \n keymaster.address=https://localhost:9443/syncope/rest/keymaster\n keymaster.username=${anonymousUser}"},{"sha":"2de353057ffd918fb129a8cfe12c259c9175362e","filename":"fit/wa-reference/src/test/java/org/apache/syncope/fit/AbstractITCase.java","status":"modified","additions":9,"deletions":1,"changes":10,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/6f459ae6b90095617142572f7d66cadc4511dc62/fit%2Fwa-reference%2Fsrc%2Ftest%2Fjava%2Forg%2Fapache%2Fsyncope%2Ffit%2FAbstractITCase.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/6f459ae6b90095617142572f7d66cadc4511dc62/fit%2Fwa-reference%2Fsrc%2Ftest%2Fjava%2Forg%2Fapache%2Fsyncope%2Ffit%2FAbstractITCase.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/fit%2Fwa-reference%2Fsrc%2Ftest%2Fjava%2Forg%2Fapache%2Fsyncope%2Ffit%2FAbstractITCase.java?ref=6f459ae6b90095617142572f7d66cadc4511dc62","patch":"@@ -114,7 +114,7 @@ public static void restSetup() {\n     public static void waitForWARefresh() {\n         SAML2IdPEntityService samlIdPEntityService = ADMIN_CLIENT.getService(SAML2IdPEntityService.class);\n \n-        await().atMost(50, TimeUnit.SECONDS).pollInterval(5, TimeUnit.SECONDS).until(() -> {\n+        await().atMost(60, TimeUnit.SECONDS).pollInterval(20, TimeUnit.SECONDS).until(() -> {\n             boolean refreshed = false;\n             try {\n                 String metadata = IOUtils.readInputStreamToString(\n@@ -133,6 +133,14 @@ public static void waitForWARefresh() {\n                     WA_CONFIG_SERVICE.pushToWA(WAConfigService.PushSubject.conf, List.of());\n                     throw new IllegalStateException();\n                 }\n+                metadata = IOUtils.readInputStreamToString(\n+                        (InputStream) WebClient.create(\n+                                WA_ADDRESS + \"/actuator/registeredServices\", \"anonymous\", \"anonymousKey\", null).\n+                                get().getEntity(), StandardCharsets.UTF_8);\n+                if (metadata.contains(\"localhost:8080/syncope-wa\")) {\n+                    WA_CONFIG_SERVICE.pushToWA(WAConfigService.PushSubject.conf, List.of());\n+                    throw new IllegalStateException();\n+                }\n \n                 samlIdPEntityService.get(SAML2IdPEntityService.DEFAULT_OWNER);\n                 refreshed = true;"}]}