{"sha":"5f13c73f2132fd0413c84aed0855da49711eee7d","node_id":"MDY6Q29tbWl0NjM2ODc5MDYyOjVmMTNjNzNmMjEzMmZkMDQxM2M4NGFlZDA4NTVkYTQ5NzExZWVlN2Q=","commit":{"author":{"name":"Francesco Chicchiriccò","email":"ilgrosso@apache.org","date":"2019-03-28T09:26:03Z"},"committer":{"name":"Francesco Chicchiriccò","email":"ilgrosso@apache.org","date":"2019-03-28T10:59:03Z"},"message":"[SYNCOPE-1453] Moving hasMustChangePassword() under @Transactional, for safety","tree":{"sha":"1365513d0b1c76c3c18eefac1ba7f46f906ca4e3","url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/git/trees/1365513d0b1c76c3c18eefac1ba7f46f906ca4e3"},"url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/git/commits/5f13c73f2132fd0413c84aed0855da49711eee7d","comment_count":0,"verification":{"verified":false,"reason":"unsigned","signature":null,"payload":null}},"url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/5f13c73f2132fd0413c84aed0855da49711eee7d","html_url":"https://github.com/EnricoDAlessandro97UNI/syncope/commit/5f13c73f2132fd0413c84aed0855da49711eee7d","comments_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/5f13c73f2132fd0413c84aed0855da49711eee7d/comments","author":{"login":"ilgrosso","id":1064664,"node_id":"MDQ6VXNlcjEwNjQ2NjQ=","avatar_url":"https://avatars.githubusercontent.com/u/1064664?v=4","gravatar_id":"","url":"https://api.github.com/users/ilgrosso","html_url":"https://github.com/ilgrosso","followers_url":"https://api.github.com/users/ilgrosso/followers","following_url":"https://api.github.com/users/ilgrosso/following{/other_user}","gists_url":"https://api.github.com/users/ilgrosso/gists{/gist_id}","starred_url":"https://api.github.com/users/ilgrosso/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ilgrosso/subscriptions","organizations_url":"https://api.github.com/users/ilgrosso/orgs","repos_url":"https://api.github.com/users/ilgrosso/repos","events_url":"https://api.github.com/users/ilgrosso/events{/privacy}","received_events_url":"https://api.github.com/users/ilgrosso/received_events","type":"User","site_admin":false},"committer":{"login":"ilgrosso","id":1064664,"node_id":"MDQ6VXNlcjEwNjQ2NjQ=","avatar_url":"https://avatars.githubusercontent.com/u/1064664?v=4","gravatar_id":"","url":"https://api.github.com/users/ilgrosso","html_url":"https://github.com/ilgrosso","followers_url":"https://api.github.com/users/ilgrosso/followers","following_url":"https://api.github.com/users/ilgrosso/following{/other_user}","gists_url":"https://api.github.com/users/ilgrosso/gists{/gist_id}","starred_url":"https://api.github.com/users/ilgrosso/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ilgrosso/subscriptions","organizations_url":"https://api.github.com/users/ilgrosso/orgs","repos_url":"https://api.github.com/users/ilgrosso/repos","events_url":"https://api.github.com/users/ilgrosso/events{/privacy}","received_events_url":"https://api.github.com/users/ilgrosso/received_events","type":"User","site_admin":false},"parents":[{"sha":"37c6aacd0dbfccdea7e98c95c94aea882b563d1b","url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/37c6aacd0dbfccdea7e98c95c94aea882b563d1b","html_url":"https://github.com/EnricoDAlessandro97UNI/syncope/commit/37c6aacd0dbfccdea7e98c95c94aea882b563d1b"}],"stats":{"total":27,"additions":18,"deletions":9},"files":[{"sha":"1e00c38245b0c38c67718caa65e4768751823bd7","filename":"core/provisioning-api/src/main/java/org/apache/syncope/core/provisioning/api/MappingManager.java","status":"modified","additions":8,"deletions":0,"changes":8,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/5f13c73f2132fd0413c84aed0855da49711eee7d/core%2Fprovisioning-api%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fprovisioning%2Fapi%2FMappingManager.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/5f13c73f2132fd0413c84aed0855da49711eee7d/core%2Fprovisioning-api%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fprovisioning%2Fapi%2FMappingManager.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fprovisioning-api%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fprovisioning%2Fapi%2FMappingManager.java?ref=5f13c73f2132fd0413c84aed0855da49711eee7d","patch":"@@ -119,4 +119,12 @@ Pair<String, Set<Attribute>> prepareAttrs(\n      * @param realmTO realm\n      */\n     void setIntValues(Item orgUnitItem, Attribute attr, RealmTO realmTO);\n+\n+    /**\n+     * Checks if there is a mapping item in the given {@link Provision} for {@code mustChangePassword}.\n+     *\n+     * @param provision provision\n+     * @return if there is a mapping item in the given provision for {@code mustChangePassword}\n+     */\n+    boolean hasMustChangePassword(Provision provision);\n }"},{"sha":"2bee73a44a096c4b702ef6a3b4fe88a67a411313","filename":"core/provisioning-java/src/main/java/org/apache/syncope/core/provisioning/java/MappingManagerImpl.java","status":"modified","additions":8,"deletions":0,"changes":8,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/5f13c73f2132fd0413c84aed0855da49711eee7d/core%2Fprovisioning-java%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fprovisioning%2Fjava%2FMappingManagerImpl.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/5f13c73f2132fd0413c84aed0855da49711eee7d/core%2Fprovisioning-java%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fprovisioning%2Fjava%2FMappingManagerImpl.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fprovisioning-java%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fprovisioning%2Fjava%2FMappingManagerImpl.java?ref=5f13c73f2132fd0413c84aed0855da49711eee7d","patch":"@@ -858,4 +858,12 @@ public void setIntValues(final Item orgUnitItem, final Attribute attr, final Rea\n             }\n         }\n     }\n+\n+    @Transactional(readOnly = true)\n+    @Override\n+    public boolean hasMustChangePassword(final Provision provision) {\n+        return provision != null && provision.getMapping() != null\n+                && provision.getMapping().getItems().stream().\n+                        anyMatch(mappingItem -> \"mustChangePassword\".equals(mappingItem.getIntAttrName()));\n+    }\n }"},{"sha":"37b67cd372967575d9fd7431df933dba6b433717","filename":"core/provisioning-java/src/main/java/org/apache/syncope/core/provisioning/java/data/UserDataBinderImpl.java","status":"modified","additions":1,"deletions":2,"changes":3,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/5f13c73f2132fd0413c84aed0855da49711eee7d/core%2Fprovisioning-java%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fprovisioning%2Fjava%2Fdata%2FUserDataBinderImpl.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/5f13c73f2132fd0413c84aed0855da49711eee7d/core%2Fprovisioning-java%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fprovisioning%2Fjava%2Fdata%2FUserDataBinderImpl.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fprovisioning-java%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fprovisioning%2Fjava%2Fdata%2FUserDataBinderImpl.java?ref=5f13c73f2132fd0413c84aed0855da49711eee7d","patch":"@@ -71,7 +71,6 @@\n import org.apache.syncope.core.persistence.api.entity.user.UMembership;\n import org.apache.syncope.core.persistence.api.entity.user.UPlainAttr;\n import org.apache.syncope.core.persistence.api.entity.user.URelationship;\n-import org.apache.syncope.core.provisioning.java.utils.MappingUtils;\n import org.springframework.beans.factory.annotation.Autowired;\n import org.springframework.stereotype.Component;\n import org.springframework.transaction.annotation.Transactional;\n@@ -336,7 +335,7 @@ public PropagationByResource update(final User toBeUpdated, final UserUR userUR)\n                     ResourceOperation.UPDATE,\n                     anyUtils.getAllResources(toBeUpdated).stream().\n                             filter(resource -> resource.getProvision(toBeUpdated.getType()).isPresent()).\n-                            filter(resource -> MappingUtils.hasMustChangePassword(\n+                            filter(resource -> mappingManager.hasMustChangePassword(\n                             resource.getProvision(toBeUpdated.getType()).get())).\n                             map(Entity::getKey).\n                             collect(Collectors.toSet()));"},{"sha":"5f9e5615099832df503a0bcc87f6330510b3f592","filename":"core/provisioning-java/src/main/java/org/apache/syncope/core/provisioning/java/utils/ConnObjectUtils.java","status":"modified","additions":1,"deletions":1,"changes":2,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/5f13c73f2132fd0413c84aed0855da49711eee7d/core%2Fprovisioning-java%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fprovisioning%2Fjava%2Futils%2FConnObjectUtils.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/5f13c73f2132fd0413c84aed0855da49711eee7d/core%2Fprovisioning-java%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fprovisioning%2Fjava%2Futils%2FConnObjectUtils.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fprovisioning-java%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fprovisioning%2Fjava%2Futils%2FConnObjectUtils.java?ref=5f13c73f2132fd0413c84aed0855da49711eee7d","patch":"@@ -255,7 +255,7 @@ public <U extends AnyUR> U getAnyUR(\n \n                     updatedUser.setSecurityQuestion(originalUser.getSecurityQuestion());\n \n-                    if (!MappingUtils.hasMustChangePassword(provision)) {\n+                    if (!mappingManager.hasMustChangePassword(provision)) {\n                         updatedUser.setMustChangePassword(originalUser.isMustChangePassword());\n                     }\n "},{"sha":"5d0c9d261fddfa70cbf8672b639f5da212d687bc","filename":"core/provisioning-java/src/main/java/org/apache/syncope/core/provisioning/java/utils/MappingUtils.java","status":"modified","additions":0,"deletions":6,"changes":6,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/5f13c73f2132fd0413c84aed0855da49711eee7d/core%2Fprovisioning-java%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fprovisioning%2Fjava%2Futils%2FMappingUtils.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/5f13c73f2132fd0413c84aed0855da49711eee7d/core%2Fprovisioning-java%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fprovisioning%2Fjava%2Futils%2FMappingUtils.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fprovisioning-java%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fprovisioning%2Fjava%2Futils%2FMappingUtils.java?ref=5f13c73f2132fd0413c84aed0855da49711eee7d","patch":"@@ -214,12 +214,6 @@ public static OperationOptions buildOperationOptions(final Iterator<? extends It\n         return builder.build();\n     }\n \n-    public static boolean hasMustChangePassword(final Provision provision) {\n-        return provision != null && provision.getMapping() != null\n-                && provision.getMapping().getItems().stream().\n-                        anyMatch(mappingItem -> \"mustChangePassword\".equals(mappingItem.getIntAttrName()));\n-    }\n-\n     /**\n      * Private default constructor, for static-only classes.\n      */"}]}