{"sha":"a86bb796ecf5cb0c27e602c74f04d46c8d28b08a","node_id":"MDY6Q29tbWl0NjM2ODc5MDYyOmE4NmJiNzk2ZWNmNWNiMGMyN2U2MDJjNzRmMDRkNDZjOGQyOGIwOGE=","commit":{"author":{"name":"Unknown","email":"unknown@apache.org","date":"2010-06-04T16:47:54Z"},"committer":{"name":"Unknown","email":"unknown@apache.org","date":"2010-06-04T16:47:54Z"},"message":"Some stupidfix + using core from external application now working\n\ngit-svn-id: https://svn.apache.org/repos/asf/incubator/syncope/trunk@1245972 13f79535-47bb-0310-9956-ffa450edef68","tree":{"sha":"8f4163693f19657d21818d75334e9fd9d0985911","url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/git/trees/8f4163693f19657d21818d75334e9fd9d0985911"},"url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/git/commits/a86bb796ecf5cb0c27e602c74f04d46c8d28b08a","comment_count":0,"verification":{"verified":false,"reason":"unsigned","signature":null,"payload":null}},"url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/a86bb796ecf5cb0c27e602c74f04d46c8d28b08a","html_url":"https://github.com/EnricoDAlessandro97UNI/syncope/commit/a86bb796ecf5cb0c27e602c74f04d46c8d28b08a","comments_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/a86bb796ecf5cb0c27e602c74f04d46c8d28b08a/comments","author":null,"committer":null,"parents":[{"sha":"a9eb6ebec82cbdd089543ea86cb0f42c3031109f","url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/a9eb6ebec82cbdd089543ea86cb0f42c3031109f","html_url":"https://github.com/EnricoDAlessandro97UNI/syncope/commit/a9eb6ebec82cbdd089543ea86cb0f42c3031109f"}],"stats":{"total":178,"additions":84,"deletions":94},"files":[{"sha":"14d452e377760aa941daf31873f61803ea10efa6","filename":"core/pom.xml","status":"modified","additions":5,"deletions":33,"changes":38,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/a86bb796ecf5cb0c27e602c74f04d46c8d28b08a/core%2Fpom.xml","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/a86bb796ecf5cb0c27e602c74f04d46c8d28b08a/core%2Fpom.xml","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fpom.xml?ref=a86bb796ecf5cb0c27e602c74f04d46c8d28b08a","patch":"@@ -67,6 +67,11 @@\n             <artifactId>hibernate-annotations</artifactId>\n         </dependency>\n \n+        <dependency>\n+            <groupId>postgresql</groupId>\n+            <artifactId>postgresql</artifactId>\n+        </dependency>\n+\n         <dependency>\n             <groupId>log4j</groupId>\n             <artifactId>log4j</artifactId>\n@@ -106,39 +111,6 @@\n     </dependencies>\n \n     <build>\n-        <plugins>\n-            <plugin>\n-                <groupId>org.codehaus.mojo</groupId>\n-                <artifactId>hibernate3-maven-plugin</artifactId>\n-                <executions>\n-                    <execution>\n-                        <phase>process-classes</phase>\n-                        <goals>\n-                            <goal>hbm2ddl</goal>\n-                        </goals>\n-                    </execution>\n-                </executions>\n-                <configuration>\n-                    <components>\n-                        <component>\n-                            <name>hbm2ddl</name>\n-                            <implementation>annotationconfiguration</implementation>\n-                        </component>\n-                    </components>\n-                    <componentProperties>\n-                        <implementation>jpaconfiguration</implementation>\n-                        <persistenceunit>syncopePersistenceUnit</persistenceunit>\n-                        <outputfilename>syncopeSchema.ddl</outputfilename>\n-                        <propertyfile>${basedir}/src/main/resources/database.properties</propertyfile>\n-                        <drop>false</drop>\n-                        <create>true</create>\n-                        <export>false</export>\n-                        <format>true</format>\n-                    </componentProperties>\n-                </configuration>\n-            </plugin>\n-        </plugins>\n-\n         <resources>\n             <resource>\n                 <directory>src/main/resources</directory>"},{"sha":"a39ff640e1baa5dc460637ca88057b12a971f205","filename":"core/src/main/java/org/syncope/core/beans/UserAttribute.java","status":"modified","additions":16,"deletions":29,"changes":45,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/a86bb796ecf5cb0c27e602c74f04d46c8d28b08a/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fcore%2Fbeans%2FUserAttribute.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/a86bb796ecf5cb0c27e602c74f04d46c8d28b08a/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fcore%2Fbeans%2FUserAttribute.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fcore%2Fbeans%2FUserAttribute.java?ref=a86bb796ecf5cb0c27e602c74f04d46c8d28b08a","patch":"@@ -74,42 +74,29 @@ public void setValues(Set<UserAttributeValue> values) {\n         this.values = values;\n     }\n \n-    public boolean addValue(Object value) {\n-        UserAttributeValue actualValue = null;\n-        try {\n-            actualValue = getSchema().getValidator().getValue(value);\n-        } catch (ValidationException e) {\n-            log.error(\"While validating '\" + value + \"'\", e);\n-        }\n+    public void addValue(Object value)\n+            throws ValidationException {\n+\n+        UserAttributeValue actualValue =\n+                getSchema().getValidator().getValue(value);\n \n-        boolean result = false;\n-        if (actualValue != null) {\n-            if (!schema.isMultivalue()) {\n-                values.clear();\n-            }\n-            result = values.add(actualValue);\n+        if (!schema.isMultivalue()) {\n+            values.clear();\n         }\n \n-        return result;\n+        values.add(actualValue);\n     }\n \n-    public boolean removeValue(Object value) {\n-        UserAttributeValue actualValue = null;\n-        try {\n-            actualValue = getSchema().getValidator().getValue(value);\n-        } catch (ValidationException e) {\n-            log.error(\"While validating '\" + value + \"'\", e);\n-        }\n+    public void removeValue(Object value)\n+            throws ValidationException {\n \n-        boolean result = false;\n-        if (actualValue != null) {\n-            result = values.remove(actualValue);\n-            if (!values.isEmpty() && !schema.isMultivalue()) {\n-                values.clear();\n-            }\n-        }\n+        UserAttributeValue actualValue =\n+                getSchema().getValidator().getValue(value);\n \n-        return result;\n+        values.remove(actualValue);\n+        if (!values.isEmpty() && !schema.isMultivalue()) {\n+            values.clear();\n+        }\n     }\n \n     @Override"},{"sha":"f87ecddf047b9d376d6d1198d1ba842169f4eab4","filename":"core/src/main/java/org/syncope/core/beans/UserAttributeSchema.java","status":"modified","additions":1,"deletions":1,"changes":2,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/a86bb796ecf5cb0c27e602c74f04d46c8d28b08a/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fcore%2Fbeans%2FUserAttributeSchema.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/a86bb796ecf5cb0c27e602c74f04d46c8d28b08a/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fcore%2Fbeans%2FUserAttributeSchema.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fcore%2Fbeans%2FUserAttributeSchema.java?ref=a86bb796ecf5cb0c27e602c74f04d46c8d28b08a","patch":"@@ -95,7 +95,7 @@ public UserAttributeValidator getValidator()\n             return validator;\n         }\n \n-        if (getValidatorClass() != null && getValidatorClass().length() == 0) {\n+        if (getValidatorClass() != null && getValidatorClass().length() > 0) {\n             try {\n                 Constructor validatorConstructor =\n                         Class.forName(getValidatorClass()).getConstructor("},{"sha":"837c63c6e3f38aff8efde2bc8ca7ab87de599c62","filename":"core/src/main/resources/applicationContext.xml","status":"modified","additions":24,"deletions":14,"changes":38,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/a86bb796ecf5cb0c27e602c74f04d46c8d28b08a/core%2Fsrc%2Fmain%2Fresources%2FapplicationContext.xml","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/a86bb796ecf5cb0c27e602c74f04d46c8d28b08a/core%2Fsrc%2Fmain%2Fresources%2FapplicationContext.xml","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fsrc%2Fmain%2Fresources%2FapplicationContext.xml?ref=a86bb796ecf5cb0c27e602c74f04d46c8d28b08a","patch":"@@ -1,5 +1,6 @@\n <?xml version=\"1.0\" encoding=\"UTF-8\"?>\n <beans xmlns=\"http://www.springframework.org/schema/beans\"\n+       xmlns:context=\"http://www.springframework.org/schema/context\"\n        xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n        xmlns:p=\"http://www.springframework.org/schema/p\"\n        xmlns:tx=\"http://www.springframework.org/schema/tx\"\n@@ -8,24 +9,33 @@\n        http://www.springframework.org/schema/tx\n        http://www.springframework.org/schema/tx/spring-tx.xsd\">\n \n-    <bean id=\"hsqlMemoryDb\"\n+    <bean id=\"propertyConfigurer\"\n+          class=\"org.springframework.beans.factory.config.PropertyPlaceholderConfigurer\">\n+        <property name=\"locations\">\n+            <list>\n+                <value>classpath:org/syncope/core/db.properties</value>\n+            </list>\n+        </property>\n+    </bean>\n+\n+    <bean id=\"dataSource\"\n           class=\"org.springframework.jdbc.datasource.DriverManagerDataSource\">\n-        <property name=\"driverClassName\" value=\"org.hsqldb.jdbcDriver\" />\n-        <property name=\"url\" value=\"jdbc:hsqldb:mem:syncopeTest\" />\n-        <property name=\"username\" value=\"sa\" />\n-        <property name=\"password\" value=\"\" />\n+        <property name=\"driverClassName\" value=\"${db.driverClassName}\"/>\n+        <property name=\"url\" value=\"${db.url}\"/>\n+        <property name=\"username\" value=\"${db.username}\"/>\n+        <property name=\"password\" value=\"${db.password}\"/>\n     </bean>\n \n     <bean id=\"entityManagerFactory\"\n           class=\"org.springframework.orm.jpa.LocalContainerEntityManagerFactoryBean\">\n         <property name=\"persistenceUnitName\" value=\"syncopePersistenceUnit\"/>\n-        <property name=\"dataSource\" ref=\"hsqlMemoryDb\" />\n+        <property name=\"dataSource\" ref=\"dataSource\"/>\n         <property name=\"jpaVendorAdapter\">\n             <bean class=\"org.springframework.orm.jpa.vendor.HibernateJpaVendorAdapter\">\n-                <property name=\"showSql\" value=\"true\" />\n-                <property name=\"generateDdl\" value=\"true\" />\n+                <property name=\"showSql\" value=\"true\"/>\n+                <property name=\"generateDdl\" value=\"true\"/>\n                 <property name=\"databasePlatform\"\n-                          value=\"org.hibernate.dialect.HSQLDialect\" />\n+                          value=\"${db.sqlDialect}\"/>\n             </bean>\n         </property>\n     </bean>\n@@ -44,22 +54,22 @@\n     <!-- DAOs -->\n     <bean id=\"syncopeUserDAO\"\n           class=\"org.syncope.core.dao.impl.SyncopeUserDAOImpl\">\n-        <property name=\"entityManager\" ref=\"entityManager\" />\n+        <property name=\"entityManager\" ref=\"entityManager\"/>\n     </bean>\n     <bean id=\"userAttributeSchemaDAO\"\n           class=\"org.syncope.core.dao.impl.UserAttributeSchemaDAOImpl\">\n-        <property name=\"entityManager\" ref=\"entityManager\" />\n+        <property name=\"entityManager\" ref=\"entityManager\"/>\n     </bean>\n     <bean id=\"userAttributeDAO\"\n           class=\"org.syncope.core.dao.impl.UserAttributeDAOImpl\">\n-        <property name=\"entityManager\" ref=\"entityManager\" />\n+        <property name=\"entityManager\" ref=\"entityManager\"/>\n     </bean>\n     <bean id=\"userDerivedAttributeSchemaDAO\"\n           class=\"org.syncope.core.dao.impl.UserDerivedAttributeSchemaDAOImpl\">\n-        <property name=\"entityManager\" ref=\"entityManager\" />\n+        <property name=\"entityManager\" ref=\"entityManager\"/>\n     </bean>\n     <bean id=\"userDerivedAttributeDAO\"\n           class=\"org.syncope.core.dao.impl.UserDerivedAttributeDAOImpl\">\n-        <property name=\"entityManager\" ref=\"entityManager\" />\n+        <property name=\"entityManager\" ref=\"entityManager\"/>\n     </bean>\n </beans>\n\\ No newline at end of file"},{"sha":"312dcc30de31b05f13c4b01fb53b640430adf8ea","filename":"core/src/main/resources/database.properties","status":"removed","additions":0,"deletions":1,"changes":1,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/a9eb6ebec82cbdd089543ea86cb0f42c3031109f/core%2Fsrc%2Fmain%2Fresources%2Fdatabase.properties","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/a9eb6ebec82cbdd089543ea86cb0f42c3031109f/core%2Fsrc%2Fmain%2Fresources%2Fdatabase.properties","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fsrc%2Fmain%2Fresources%2Fdatabase.properties?ref=a9eb6ebec82cbdd089543ea86cb0f42c3031109f","patch":"@@ -1 +0,0 @@\n-hibernate.dialect=org.hibernate.dialect.HSQLDialect"},{"sha":"e06728a129f9a97f93984c70f5127fd5309afdf3","filename":"core/src/main/resources/org/syncope/core/db.properties","status":"added","additions":5,"deletions":0,"changes":5,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/a86bb796ecf5cb0c27e602c74f04d46c8d28b08a/core%2Fsrc%2Fmain%2Fresources%2Forg%2Fsyncope%2Fcore%2Fdb.properties","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/a86bb796ecf5cb0c27e602c74f04d46c8d28b08a/core%2Fsrc%2Fmain%2Fresources%2Forg%2Fsyncope%2Fcore%2Fdb.properties","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fsrc%2Fmain%2Fresources%2Forg%2Fsyncope%2Fcore%2Fdb.properties?ref=a86bb796ecf5cb0c27e602c74f04d46c8d28b08a","patch":"@@ -0,0 +1,5 @@\n+db.driverClassName=org.postgresql.Driver\n+db.url=jdbc:postgresql://localhost:5432/syncope\n+db.username=syncope\n+db.password=syncope\n+db.sqlDialect=org.hibernate.dialect.PostgreSQLDialect"},{"sha":"01e343c4c7859e28f16150ab7a59f37ef4314c4c","filename":"core/src/test/java/org/syncope/core/test/dao/UserAttributeDAOTest.java","status":"modified","additions":19,"deletions":2,"changes":21,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/a86bb796ecf5cb0c27e602c74f04d46c8d28b08a/core%2Fsrc%2Ftest%2Fjava%2Forg%2Fsyncope%2Fcore%2Ftest%2Fdao%2FUserAttributeDAOTest.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/a86bb796ecf5cb0c27e602c74f04d46c8d28b08a/core%2Fsrc%2Ftest%2Fjava%2Forg%2Fsyncope%2Fcore%2Ftest%2Fdao%2FUserAttributeDAOTest.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fsrc%2Ftest%2Fjava%2Forg%2Fsyncope%2Fcore%2Ftest%2Fdao%2FUserAttributeDAOTest.java?ref=a86bb796ecf5cb0c27e602c74f04d46c8d28b08a","patch":"@@ -22,6 +22,7 @@\n import org.syncope.core.beans.UserAttribute;\n import org.syncope.core.dao.UserAttributeSchemaDAO;\n import org.syncope.core.dao.UserAttributeDAO;\n+import org.syncope.core.validation.ValidationException;\n \n public class UserAttributeDAOTest extends AbstractDAOTest {\n \n@@ -63,6 +64,8 @@ public final void testSave() throws ClassNotFoundException {\n         UserAttributeSchema emailSchema = new UserAttributeSchema();\n         emailSchema.setName(\"email\");\n         emailSchema.setType(AttributeType.String);\n+        emailSchema.setValidatorClass(\n+                \"org.syncope.core.validation.EmailAddressValidator\");\n         emailSchema.setMandatory(false);\n         emailSchema.setMultivalue(true);\n \n@@ -75,8 +78,22 @@ public final void testSave() throws ClassNotFoundException {\n \n         UserAttribute attribute =\n                 new UserAttribute(actualEmailSchema);\n-        attribute.addValue(\"john.doe@gmail.com\");\n-        attribute.addValue(\"mario.rossi@gmail.com\");\n+\n+        Exception thrown = null;\n+        try {\n+            attribute.addValue(\"john.doe@gmail.com\");\n+            attribute.addValue(\"mario.rossi@gmail.com\");\n+        } catch (ValidationException e) {\n+            thrown = e;\n+        }\n+        assertNull(\"no validation exception expected here \", thrown);\n+\n+        try {\n+            attribute.addValue(\"http://www.apache.org\");\n+        } catch (ValidationException e) {\n+            thrown = e;\n+        }\n+        assertNotNull(\"validation exception expected here \", thrown);\n \n         attribute = getDAO().save(attribute);\n "},{"sha":"716dad27d17b0bfcdb912c66e698ec65115c5032","filename":"core/src/test/resources/org/syncope/core/db.properties","status":"added","additions":5,"deletions":0,"changes":5,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/a86bb796ecf5cb0c27e602c74f04d46c8d28b08a/core%2Fsrc%2Ftest%2Fresources%2Forg%2Fsyncope%2Fcore%2Fdb.properties","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/a86bb796ecf5cb0c27e602c74f04d46c8d28b08a/core%2Fsrc%2Ftest%2Fresources%2Forg%2Fsyncope%2Fcore%2Fdb.properties","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fsrc%2Ftest%2Fresources%2Forg%2Fsyncope%2Fcore%2Fdb.properties?ref=a86bb796ecf5cb0c27e602c74f04d46c8d28b08a","patch":"@@ -0,0 +1,5 @@\n+db.driverClassName=org.hsqldb.jdbcDriver\n+db.url=jdbc:hsqldb:mem:syncopeTest\n+db.username=sa\n+db.password=\n+db.sqlDialect=org.hibernate.dialect.HSQLDialect"},{"sha":"4ffd50a95f3ef06d287f371bc85b35acbc8c1937","filename":"pom.xml","status":"modified","additions":9,"deletions":14,"changes":23,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/a86bb796ecf5cb0c27e602c74f04d46c8d28b08a/pom.xml","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/a86bb796ecf5cb0c27e602c74f04d46c8d28b08a/pom.xml","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/pom.xml?ref=a86bb796ecf5cb0c27e602c74f04d46c8d28b08a","patch":"@@ -102,6 +102,8 @@\n \n         <hibernate.version>3.4.0.GA</hibernate.version>\n \n+        <postgresql.jdbc-driver.version>8.1-408.jdbc3</postgresql.jdbc-driver.version>\n+\n         <wicket.version>1.4.7</wicket.version>\n \n         <jersey.version>1.2</jersey.version>\n@@ -144,7 +146,7 @@\n                 <artifactId>commons-jexl</artifactId>\n                 <version>${commons-jexl.version}</version>\n             </dependency>\n-            \n+\n             <dependency>\n                 <groupId>com.forgerock.openam</groupId>\n                 <artifactId>clientsdk</artifactId>\n@@ -170,6 +172,12 @@\n             </dependency>\n             <!-- /Hibernate -->\n \n+            <dependency>\n+                <groupId>postgresql</groupId>\n+                <artifactId>postgresql</artifactId>\n+                <version>${postgresql.jdbc-driver.version}</version>\n+            </dependency>\n+\n             <!-- Spring -->\n             <dependency>\n                 <groupId>org.springframework</groupId>\n@@ -338,19 +346,6 @@\n                     <artifactId>maven-jetty-plugin</artifactId>\n                     <version>${jetty.version}</version>\n                 </plugin>\n-                <plugin>\n-                    <groupId>org.codehaus.mojo</groupId>\n-                    <artifactId>hibernate3-maven-plugin</artifactId>\n-                    <version>2.2</version>\n-                    <executions>\n-                        <execution>\n-                            <phase>process-classes</phase>\n-                            <goals>\n-                                <goal>hbm2ddl</goal>\n-                            </goals>\n-                        </execution>\n-                    </executions>\n-                </plugin>\n             </plugins>\n         </pluginManagement>\n     </build>"}]}