{"sha":"0e908289a61dc61387f4d4cd5ba0dd0a76f33b10","node_id":"MDY6Q29tbWl0NjM2ODc5MDYyOjBlOTA4Mjg5YTYxZGM2MTM4N2Y0ZDRjZDViYTBkZDBhNzZmMzNiMTA=","commit":{"author":{"name":"giacomolm","email":"giacomolm@hotmail.it","date":"2015-06-22T11:02:41Z"},"committer":{"name":"giacomolm","email":"giacomolm@hotmail.it","date":"2015-06-22T11:02:41Z"},"message":"[SYNCOPE-660]Merge from 1_2_X","tree":{"sha":"2e7cd8f01d46afb0c68a957dd4a970e6bdd5c7b4","url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/git/trees/2e7cd8f01d46afb0c68a957dd4a970e6bdd5c7b4"},"url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/git/commits/0e908289a61dc61387f4d4cd5ba0dd0a76f33b10","comment_count":0,"verification":{"verified":false,"reason":"unsigned","signature":null,"payload":null}},"url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/0e908289a61dc61387f4d4cd5ba0dd0a76f33b10","html_url":"https://github.com/EnricoDAlessandro97UNI/syncope/commit/0e908289a61dc61387f4d4cd5ba0dd0a76f33b10","comments_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/0e908289a61dc61387f4d4cd5ba0dd0a76f33b10/comments","author":{"login":"giacomolm","id":4027829,"node_id":"MDQ6VXNlcjQwMjc4Mjk=","avatar_url":"https://avatars.githubusercontent.com/u/4027829?v=4","gravatar_id":"","url":"https://api.github.com/users/giacomolm","html_url":"https://github.com/giacomolm","followers_url":"https://api.github.com/users/giacomolm/followers","following_url":"https://api.github.com/users/giacomolm/following{/other_user}","gists_url":"https://api.github.com/users/giacomolm/gists{/gist_id}","starred_url":"https://api.github.com/users/giacomolm/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/giacomolm/subscriptions","organizations_url":"https://api.github.com/users/giacomolm/orgs","repos_url":"https://api.github.com/users/giacomolm/repos","events_url":"https://api.github.com/users/giacomolm/events{/privacy}","received_events_url":"https://api.github.com/users/giacomolm/received_events","type":"User","site_admin":false},"committer":{"login":"giacomolm","id":4027829,"node_id":"MDQ6VXNlcjQwMjc4Mjk=","avatar_url":"https://avatars.githubusercontent.com/u/4027829?v=4","gravatar_id":"","url":"https://api.github.com/users/giacomolm","html_url":"https://github.com/giacomolm","followers_url":"https://api.github.com/users/giacomolm/followers","following_url":"https://api.github.com/users/giacomolm/following{/other_user}","gists_url":"https://api.github.com/users/giacomolm/gists{/gist_id}","starred_url":"https://api.github.com/users/giacomolm/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/giacomolm/subscriptions","organizations_url":"https://api.github.com/users/giacomolm/orgs","repos_url":"https://api.github.com/users/giacomolm/repos","events_url":"https://api.github.com/users/giacomolm/events{/privacy}","received_events_url":"https://api.github.com/users/giacomolm/received_events","type":"User","site_admin":false},"parents":[{"sha":"016b441a19e2a7bc4bd393198b166cc91d12df6d","url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/016b441a19e2a7bc4bd393198b166cc91d12df6d","html_url":"https://github.com/EnricoDAlessandro97UNI/syncope/commit/016b441a19e2a7bc4bd393198b166cc91d12df6d"}],"stats":{"total":29,"additions":28,"deletions":1},"files":[{"sha":"caba10e0aceff7a776fcb52fdb3d2025ba0a93fa","filename":"core/persistence-jpa/src/main/resources/content.xml","status":"modified","additions":5,"deletions":0,"changes":5,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/0e908289a61dc61387f4d4cd5ba0dd0a76f33b10/core%2Fpersistence-jpa%2Fsrc%2Fmain%2Fresources%2Fcontent.xml","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/0e908289a61dc61387f4d4cd5ba0dd0a76f33b10/core%2Fpersistence-jpa%2Fsrc%2Fmain%2Fresources%2Fcontent.xml","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fpersistence-jpa%2Fsrc%2Fmain%2Fresources%2Fcontent.xml?ref=0e908289a61dc61387f4d4cd5ba0dd0a76f33b10","patch":"@@ -80,6 +80,11 @@ under the License.\n   <CPlainAttr id=\"11\" owner_id=\"1\" schema_name=\"log.lastlogindate\"/>\n   <CPlainAttrValue id=\"11\" attribute_id=\"11\" booleanValue=\"1\"/>\n \n+  <PlainSchema name=\"tasks.interruptMaxRetries\" type=\"Long\"\n+               mandatoryCondition=\"true\" multivalue=\"0\" uniqueConstraint=\"0\" readonly=\"0\"/>\n+  <CPlainAttr id=\"12\" owner_id=\"1\" schema_name=\"tasks.interruptMaxRetries\"/>\n+  <CPlainAttrValue id=\"12\" attribute_id=\"12\" longValue=\"20\"/>\n+\n   <!-- For usage with admin console -->\n   <PlainSchema name=\"admin.user.layout\" type=\"String\"\n                mandatoryCondition=\"false\" multivalue=\"1\" uniqueConstraint=\"0\" readonly=\"0\"/>"},{"sha":"b7c7ecce90fafc5fa8077ef1ce7aba2680814a3f","filename":"core/persistence-jpa/src/test/java/org/apache/syncope/core/persistence/jpa/inner/PlainSchemaTest.java","status":"modified","additions":1,"deletions":1,"changes":2,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/0e908289a61dc61387f4d4cd5ba0dd0a76f33b10/core%2Fpersistence-jpa%2Fsrc%2Ftest%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fpersistence%2Fjpa%2Finner%2FPlainSchemaTest.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/0e908289a61dc61387f4d4cd5ba0dd0a76f33b10/core%2Fpersistence-jpa%2Fsrc%2Ftest%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fpersistence%2Fjpa%2Finner%2FPlainSchemaTest.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fpersistence-jpa%2Fsrc%2Ftest%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fpersistence%2Fjpa%2Finner%2FPlainSchemaTest.java?ref=0e908289a61dc61387f4d4cd5ba0dd0a76f33b10","patch":"@@ -47,7 +47,7 @@ public class PlainSchemaTest extends AbstractTest {\n     @Test\n     public void findAll() {\n         List<PlainSchema> schemas = plainSchemaDAO.findAll();\n-        assertEquals(42, schemas.size());\n+        assertEquals(43, schemas.size());\n     }\n \n     @Test"},{"sha":"ffbd42f7b1d37f266095c64c5484dea36774a8f9","filename":"core/persistence-jpa/src/test/resources/content.xml","status":"modified","additions":5,"deletions":0,"changes":5,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/0e908289a61dc61387f4d4cd5ba0dd0a76f33b10/core%2Fpersistence-jpa%2Fsrc%2Ftest%2Fresources%2Fcontent.xml","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/0e908289a61dc61387f4d4cd5ba0dd0a76f33b10/core%2Fpersistence-jpa%2Fsrc%2Ftest%2Fresources%2Fcontent.xml","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fpersistence-jpa%2Fsrc%2Ftest%2Fresources%2Fcontent.xml?ref=0e908289a61dc61387f4d4cd5ba0dd0a76f33b10","patch":"@@ -78,6 +78,11 @@ under the License.\n   <CPlainAttr id=\"11\" owner_id=\"1\" schema_name=\"log.lastlogindate\"/>\n   <CPlainAttrValue id=\"11\" attribute_id=\"11\" booleanValue=\"1\"/>\n \n+  <PlainSchema name=\"tasks.interruptMaxRetries\" type=\"Long\"\n+               mandatoryCondition=\"true\" multivalue=\"0\" uniqueConstraint=\"0\" readonly=\"0\"/>\n+  <CPlainAttr id=\"12\" owner_id=\"1\" schema_name=\"tasks.interruptMaxRetries\"/>\n+  <CPlainAttrValue id=\"12\" attribute_id=\"12\" longValue=\"20\"/>\n+\n   <!-- For usage with admin console -->\n   <PlainSchema name=\"admin.user.layout\" type=\"String\"\n                mandatoryCondition=\"false\" multivalue=\"1\" uniqueConstraint=\"0\" readonly=\"0\"/>"},{"sha":"4c4965503eaf2c120870b703ee11ba085133ba21","filename":"core/provisioning-java/src/main/java/org/apache/syncope/core/provisioning/java/job/AbstractTaskJob.java","status":"modified","additions":17,"deletions":0,"changes":17,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/0e908289a61dc61387f4d4cd5ba0dd0a76f33b10/core%2Fprovisioning-java%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fprovisioning%2Fjava%2Fjob%2FAbstractTaskJob.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/0e908289a61dc61387f4d4cd5ba0dd0a76f33b10/core%2Fprovisioning-java%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fprovisioning%2Fjava%2Fjob%2FAbstractTaskJob.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fprovisioning-java%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fprovisioning%2Fjava%2Fjob%2FAbstractTaskJob.java?ref=0e908289a61dc61387f4d4cd5ba0dd0a76f33b10","patch":"@@ -33,6 +33,7 @@\n import org.apache.syncope.core.provisioning.api.job.TaskJob;\n import org.apache.syncope.core.misc.AuditManager;\n import org.apache.syncope.core.misc.ExceptionUtils2;\n+import org.apache.syncope.core.persistence.api.dao.ConfDAO;\n import org.apache.syncope.core.provisioning.api.notification.NotificationManager;\n import org.quartz.DisallowConcurrentExecution;\n import org.quartz.JobExecutionContext;\n@@ -80,6 +81,12 @@ public enum Status {\n     @Autowired\n     private TaskExecDAO taskExecDAO;\n \n+    /**\n+     * Configuration DAO.\n+     */\n+    @Autowired\n+    private ConfDAO confDAO;\n+\n     /**\n      * Notification manager.\n      */\n@@ -197,6 +204,16 @@ public void interrupt() throws UnableToInterruptJobException {\n             LOG.info(\"Interrupting job time {} \", (new SimpleDateFormat(SyncopeConstants.DEFAULT_DATE_PATTERN, Locale.\n                     getDefault())).format(new Date()));\n             thread.interrupt();\n+            if (thread.isAlive()) {\n+                long maxRetry = confDAO.find(\"tasks.interruptMaxRetries\", \"0\").getValues().get(0).getLongValue();\n+                for (int i = 0; i <= maxRetry && thread.isAlive(); i++) {\n+                    thread.interrupt();\n+                }\n+                //if the thread is still alive, it should be available in the next stop\n+                if (thread.isAlive()) {\n+                    this.runningThread.set(thread);\n+                }\n+            }\n         } else {\n             LOG.warn(\"Unable to retrieve the right thread related to the current job execution\");\n         }"}]}