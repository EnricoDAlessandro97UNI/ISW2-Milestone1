{"sha":"eed265e8c96836228c19247f2e8cbd918ec22dee","node_id":"MDY6Q29tbWl0NjM2ODc5MDYyOmVlZDI2NWU4Yzk2ODM2MjI4YzE5MjQ3ZjJlOGNiZDkxOGVjMjJkZWU=","commit":{"author":{"name":"Massimiliano Perrone","email":"massi@apache.org","date":"2014-07-02T16:02:10Z"},"committer":{"name":"Massimiliano Perrone","email":"massi@apache.org","date":"2014-07-02T16:02:10Z"},"message":"Fixed SYNCOPE-523\n\ngit-svn-id: https://svn.apache.org/repos/asf/syncope/trunk@1607406 13f79535-47bb-0310-9956-ffa450edef68","tree":{"sha":"3dfdba61e85c72a34d5075fd90398609e92ad93e","url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/git/trees/3dfdba61e85c72a34d5075fd90398609e92ad93e"},"url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/git/commits/eed265e8c96836228c19247f2e8cbd918ec22dee","comment_count":0,"verification":{"verified":false,"reason":"unsigned","signature":null,"payload":null}},"url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/eed265e8c96836228c19247f2e8cbd918ec22dee","html_url":"https://github.com/EnricoDAlessandro97UNI/syncope/commit/eed265e8c96836228c19247f2e8cbd918ec22dee","comments_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/eed265e8c96836228c19247f2e8cbd918ec22dee/comments","author":null,"committer":null,"parents":[{"sha":"f5e1c9921fa913956703cf765782512c97889b39","url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/f5e1c9921fa913956703cf765782512c97889b39","html_url":"https://github.com/EnricoDAlessandro97UNI/syncope/commit/f5e1c9921fa913956703cf765782512c97889b39"}],"stats":{"total":117,"additions":91,"deletions":26},"files":[{"sha":"c9d42fe67d576ce08bc90a36e7e2c595251089e6","filename":"installer/pom.xml","status":"modified","additions":0,"deletions":11,"changes":11,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/eed265e8c96836228c19247f2e8cbd918ec22dee/installer%2Fpom.xml","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/eed265e8c96836228c19247f2e8cbd918ec22dee/installer%2Fpom.xml","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/installer%2Fpom.xml?ref=eed265e8c96836228c19247f2e8cbd918ec22dee","patch":"@@ -69,17 +69,6 @@ under the License.\n       <groupId>com.fasterxml.jackson.core</groupId>\n       <artifactId>jackson-databind</artifactId>\n     </dependency>\n-\n-    <dependency>\n-      <groupId>org.postgresql</groupId>\n-      <artifactId>postgresql</artifactId>\n-      <version>9.3-1101-jdbc41</version>\n-    </dependency>\n-    <dependency>\n-      <groupId>mysql</groupId>\n-      <artifactId>mysql-connector-java</artifactId>\n-      <version>5.1.31</version>\n-    </dependency>\n     \n     <dependency>\n       <groupId>commons-codec</groupId>"},{"sha":"d007f311ce0b7781e5979702448e95df88d27a97","filename":"installer/src/main/java/org/apache/syncope/installer/utilities/DriverLoader.java","status":"added","additions":79,"deletions":0,"changes":79,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/eed265e8c96836228c19247f2e8cbd918ec22dee/installer%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Finstaller%2Futilities%2FDriverLoader.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/eed265e8c96836228c19247f2e8cbd918ec22dee/installer%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Finstaller%2Futilities%2FDriverLoader.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/installer%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Finstaller%2Futilities%2FDriverLoader.java?ref=eed265e8c96836228c19247f2e8cbd918ec22dee","patch":"@@ -0,0 +1,79 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *   http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+package org.apache.syncope.installer.utilities;\n+\n+import java.net.MalformedURLException;\n+import org.apache.syncope.installer.enums.DBs;\n+\n+import java.net.URL;\n+import java.net.URLClassLoader;\n+import java.sql.Driver;\n+\n+public class DriverLoader extends URLClassLoader {\n+\n+    private final static String POSTGRES_JAR = \"http://jdbc.postgresql.org/download/postgresql-9.3-1101.jdbc41.jar\";\n+\n+    private final static String MYSQL_JAR\n+            = \"http://central.maven.org/maven2/mysql/mysql-connector-java/5.1.6/mysql-connector-java-5.1.6.jar\";\n+\n+    private static final String POSTGRES_CLASS_DRIVER = \"org.postgresql.Driver\";\n+\n+    private static final String MYSQL_CLASS_DRIVER = \"com.mysql.jdbc.Driver\";\n+\n+    private DriverLoader(final URL[] urls) {\n+        super(urls);\n+        addURL(urls[0]);\n+    }\n+\n+    private static DriverLoader driverLoader;\n+\n+    public static Driver load(final DBs selectedDB) {\n+        Driver driver = null;\n+        switch (selectedDB) {\n+            case POSTGRES:\n+                driver = downloadDriver(POSTGRES_JAR, POSTGRES_CLASS_DRIVER);\n+                break;\n+            case MYSQL:\n+                driver = downloadDriver(MYSQL_JAR, MYSQL_CLASS_DRIVER);\n+                break;\n+            case SQLSERVER:\n+                break;\n+            case ORACLE:\n+                break;\n+            default:\n+                break;\n+        }\n+        return driver;\n+    }\n+\n+    private static Driver downloadDriver(final String driverUrl, final String driverClassName) {\n+        Driver driver = null;\n+        try {\n+            final URL[] url = {new URL(driverUrl)};\n+            driverLoader = new DriverLoader(url);\n+            driver = (Driver) driverLoader.loadClass(driverClassName).newInstance();\n+        } catch (ClassNotFoundException e) {\n+        } catch (InstantiationException ex) {\n+        } catch (IllegalAccessException ex) {\n+        } catch (MalformedURLException ex) {\n+        }\n+\n+        return driver;\n+    }\n+}"},{"sha":"89b605626255a8dca0961c8d15d0ff2fba54bae5","filename":"installer/src/main/java/org/apache/syncope/installer/validators/PersistenceValidator.java","status":"modified","additions":12,"deletions":13,"changes":25,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/eed265e8c96836228c19247f2e8cbd918ec22dee/installer%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Finstaller%2Fvalidators%2FPersistenceValidator.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/eed265e8c96836228c19247f2e8cbd918ec22dee/installer%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Finstaller%2Fvalidators%2FPersistenceValidator.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/installer%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Finstaller%2Fvalidators%2FPersistenceValidator.java?ref=eed265e8c96836228c19247f2e8cbd918ec22dee","patch":"@@ -19,16 +19,14 @@\n package org.apache.syncope.installer.validators;\n \n import com.izforge.izpack.api.data.InstallData;\n-import java.sql.DriverManager;\n+import java.sql.Driver;\n import java.sql.SQLException;\n+import java.util.Properties;\n import org.apache.syncope.installer.enums.DBs;\n+import org.apache.syncope.installer.utilities.DriverLoader;\n \n public class PersistenceValidator extends AbstractValidator {\n \n-    private static final String POSTGRES_CLASS_DRIVER = \"org.postgresql.Driver\";\n-\n-    private static final String MYSQL_CLASS_DRIVER = \"com.mysql.jdbc.Driver\";\n-\n     private String persistenceUrl;\n \n     private String persistenceDbuser;\n@@ -70,9 +68,9 @@ public Status validateData(final InstallData installData) {\n \n         switch (selectedDB) {\n             case POSTGRES:\n-                return checkConnection(POSTGRES_CLASS_DRIVER);\n+                return checkConnection(selectedDB);\n             case MYSQL:\n-                return checkConnection(MYSQL_CLASS_DRIVER);\n+                return checkConnection(selectedDB);\n             case SQLSERVER:\n                 warning = new StringBuilder(\"Remember to check your SqlServer db connection\");\n                 return Status.WARNING;\n@@ -85,17 +83,18 @@ public Status validateData(final InstallData installData) {\n         }\n     }\n \n-    private Status checkConnection(final String driverClass) {\n+    private Status checkConnection(final DBs selectedDb) {\n+\n         try {\n-            Class.forName(driverClass);\n-            DriverManager.getConnection(persistenceUrl, persistenceDbuser, persistenceDbPassword);\n+            final Driver driver = DriverLoader.load(selectedDb);\n+            final Properties props = new Properties();\n+            props.put(\"user\", persistenceDbuser);\n+            props.put(\"password\", persistenceDbPassword);\n+            driver.connect(persistenceUrl, props);\n             return Status.OK;\n         } catch (SQLException ex) {\n             error = new StringBuilder(\"Db connection error: please check your insert data\");\n             return Status.ERROR;\n-        } catch (ClassNotFoundException ex) {\n-            error = new StringBuilder(\"General error please contact Apache Syncope developers!\");\n-            return Status.ERROR;\n         }\n     }\n "},{"sha":"87bb75eeb0a63e7034eb0ec4d6d6ca1b876f45ef","filename":"installer/src/main/resources/izpack/install.xml","status":"modified","additions":0,"deletions":2,"changes":2,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/eed265e8c96836228c19247f2e8cbd918ec22dee/installer%2Fsrc%2Fmain%2Fresources%2Fizpack%2Finstall.xml","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/eed265e8c96836228c19247f2e8cbd918ec22dee/installer%2Fsrc%2Fmain%2Fresources%2Fizpack%2Finstall.xml","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/installer%2Fsrc%2Fmain%2Fresources%2Fizpack%2Finstall.xml?ref=eed265e8c96836228c19247f2e8cbd918ec22dee","patch":"@@ -133,8 +133,6 @@ under the License.\n   </resources>\n   \n   <jar src=\"../syncope-installer-1.2.0-SNAPSHOT.jar\" stage=\"install\"/>\n-  <jar src=\"lib/postgresql-9.3-1101-jdbc41.jar\"/>\n-  <jar src=\"lib/mysql-connector-java-5.1.31.jar\"/>\n   <jar src=\"lib/commons-logging-1.1.3.jar\"/>\n   <jar src=\"lib/commons-codec-1.9.jar\"/>\n   <jar src=\"lib/commons-io-2.4.jar\"/>"}]}