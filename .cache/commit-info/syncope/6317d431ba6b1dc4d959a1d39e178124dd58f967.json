{"sha":"6317d431ba6b1dc4d959a1d39e178124dd58f967","node_id":"MDY6Q29tbWl0NjM2ODc5MDYyOjYzMTdkNDMxYmE2YjFkYzRkOTU5YTFkMzllMTc4MTI0ZGQ1OGY5Njc=","commit":{"author":{"name":"Unknown","email":"unknown@apache.org","date":"2011-04-27T10:05:37Z"},"committer":{"name":"Unknown","email":"unknown@apache.org","date":"2011-04-27T10:05:37Z"},"message":"Fixes #27\n\ngit-svn-id: https://svn.apache.org/repos/asf/incubator/syncope/trunk@1246896 13f79535-47bb-0310-9956-ffa450edef68","tree":{"sha":"3f5f3031426dd07288e1d7233ecdde99d065c72c","url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/git/trees/3f5f3031426dd07288e1d7233ecdde99d065c72c"},"url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/git/commits/6317d431ba6b1dc4d959a1d39e178124dd58f967","comment_count":0,"verification":{"verified":false,"reason":"unsigned","signature":null,"payload":null}},"url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/6317d431ba6b1dc4d959a1d39e178124dd58f967","html_url":"https://github.com/EnricoDAlessandro97UNI/syncope/commit/6317d431ba6b1dc4d959a1d39e178124dd58f967","comments_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/6317d431ba6b1dc4d959a1d39e178124dd58f967/comments","author":null,"committer":null,"parents":[{"sha":"af515608e59142c2286f924ce351bbcaec6ec395","url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/af515608e59142c2286f924ce351bbcaec6ec395","html_url":"https://github.com/EnricoDAlessandro97UNI/syncope/commit/af515608e59142c2286f924ce351bbcaec6ec395"}],"stats":{"total":1723,"additions":1165,"deletions":558},"files":[{"sha":"dfcf16d0710017514c0757ef27a2ac0d3e4c7b4e","filename":"client/src/main/java/org/syncope/client/to/AbstractAttributableTO.java","status":"modified","additions":12,"deletions":1,"changes":13,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/6317d431ba6b1dc4d959a1d39e178124dd58f967/client%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fclient%2Fto%2FAbstractAttributableTO.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/6317d431ba6b1dc4d959a1d39e178124dd58f967/client%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fclient%2Fto%2FAbstractAttributableTO.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/client%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fclient%2Fto%2FAbstractAttributableTO.java?ref=6317d431ba6b1dc4d959a1d39e178124dd58f967","patch":"@@ -67,7 +67,18 @@ public void setAttributes(final List<AttributeTO> attributes) {\n     public Map<String, List<String>> getAttributeMap() {\n         Map<String, List<String>> result =\n                 new HashMap<String, List<String>>(attributes.size());\n-        for (AttributeTO attributeTO : getAttributes()) {\n+        for (AttributeTO attributeTO : attributes) {\n+            result.put(attributeTO.getSchema(), attributeTO.getValues());\n+        }\n+\n+        return result;\n+    }\n+\n+    @JsonIgnore\n+    public Map<String, List<String>> getDerivedAttributeMap() {\n+        Map<String, List<String>> result =\n+                new HashMap<String, List<String>>(derivedAttributes.size());\n+        for (AttributeTO attributeTO : derivedAttributes) {\n             result.put(attributeTO.getSchema(), attributeTO.getValues());\n         }\n "},{"sha":"1261e658bc9b5c78dab6a00c299ee147f0670c94","filename":"client/src/main/java/org/syncope/types/SourceMappingType.java","status":"modified","additions":3,"deletions":1,"changes":4,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/6317d431ba6b1dc4d959a1d39e178124dd58f967/client%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Ftypes%2FSourceMappingType.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/6317d431ba6b1dc4d959a1d39e178124dd58f967/client%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Ftypes%2FSourceMappingType.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/client%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Ftypes%2FSourceMappingType.java?ref=6317d431ba6b1dc4d959a1d39e178124dd58f967","patch":"@@ -17,9 +17,11 @@\n public enum SourceMappingType {\n \n     UserSchema,\n+    UserDerivedSchema,\n     RoleSchema,\n+    RoleDerivedSchema,\n     MembershipSchema,\n+    MembershipDerivedSchema,\n     SyncopeUserId,\n     Password;\n-\n }"},{"sha":"edf2a3c4df82b922b639c548986c285667535bde","filename":"console/src/main/java/org/syncope/console/commons/SchemaWrapper.java","status":"modified","additions":2,"deletions":5,"changes":7,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/6317d431ba6b1dc4d959a1d39e178124dd58f967/console%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fconsole%2Fcommons%2FSchemaWrapper.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/6317d431ba6b1dc4d959a1d39e178124dd58f967/console%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fconsole%2Fcommons%2FSchemaWrapper.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/console%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fconsole%2Fcommons%2FSchemaWrapper.java?ref=6317d431ba6b1dc4d959a1d39e178124dd58f967","patch":"@@ -12,7 +12,6 @@\n  *  limitations under the License.\n  *  under the License.\n  */\n-\n package org.syncope.console.commons;\n \n import java.io.Serializable;\n@@ -27,6 +26,7 @@\n public class SchemaWrapper implements Serializable {\n \n     SchemaTO schemaTO;\n+\n     List<String> values;\n \n     public SchemaWrapper(SchemaTO schemaTO) {\n@@ -53,9 +53,6 @@ public void setValues(List<String> values) {\n     }\n \n     public void setValues(Set<String> values) {\n-        this.values = new ArrayList<String>();\n-        for (String value : values) {\n-            this.values.add(value);\n-        }\n+        this.values = new ArrayList<String>(values);\n     }\n }"},{"sha":"17cda9237377a06963a0de1c803a71eeecbd742c","filename":"console/src/main/java/org/syncope/console/pages/DisplayAttributesModalPage.java","status":"modified","additions":1,"deletions":0,"changes":1,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/6317d431ba6b1dc4d959a1d39e178124dd58f967/console%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fconsole%2Fpages%2FDisplayAttributesModalPage.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/6317d431ba6b1dc4d959a1d39e178124dd58f967/console%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fconsole%2Fpages%2FDisplayAttributesModalPage.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/console%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fconsole%2Fpages%2FDisplayAttributesModalPage.java?ref=6317d431ba6b1dc4d959a1d39e178124dd58f967","patch":"@@ -53,6 +53,7 @@ public DisplayAttributesModalPage(final Users basePage,\n \n         userAttributesForm.add(new CheckBoxMultipleChoice(\"schemaNames\",\n                 new PropertyModel(this, \"selectedSchemas\"), schemaNames));\n+        \n         IndicatingAjaxButton submit = new IndicatingAjaxButton(\"submit\",\n                 new Model(getString(\"submit\"))) {\n "},{"sha":"d4ed2b4f170925988477377465a04f47808d9c4b","filename":"console/src/main/java/org/syncope/console/pages/MembershipModalPage.java","status":"modified","additions":122,"deletions":16,"changes":138,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/6317d431ba6b1dc4d959a1d39e178124dd58f967/console%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fconsole%2Fpages%2FMembershipModalPage.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/6317d431ba6b1dc4d959a1d39e178124dd58f967/console%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fconsole%2Fpages%2FMembershipModalPage.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/console%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fconsole%2Fpages%2FMembershipModalPage.java?ref=6317d431ba6b1dc4d959a1d39e178124dd58f967","patch":"@@ -24,25 +24,33 @@\n import java.util.List;\n import org.apache.wicket.Page;\n import org.apache.wicket.ajax.AjaxRequestTarget;\n+import org.apache.wicket.ajax.IAjaxCallDecorator;\n+import org.apache.wicket.ajax.calldecorator.AjaxPreprocessingCallDecorator;\n import org.apache.wicket.ajax.markup.html.form.AjaxButton;\n import org.apache.wicket.authorization.strategies.role.metadata.MetaDataRoleAuthorizationStrategy;\n import org.apache.wicket.extensions.ajax.markup.html.IndicatingAjaxButton;\n import org.apache.wicket.extensions.ajax.markup.html.modal.ModalWindow;\n import org.apache.wicket.markup.html.WebMarkupContainer;\n import org.apache.wicket.markup.html.basic.Label;\n+import org.apache.wicket.markup.html.form.DropDownChoice;\n import org.apache.wicket.markup.html.form.Form;\n+import org.apache.wicket.markup.html.form.TextField;\n import org.apache.wicket.markup.html.list.ListItem;\n import org.apache.wicket.markup.html.list.ListView;\n import org.apache.wicket.markup.html.panel.Panel;\n import org.apache.wicket.model.CompoundPropertyModel;\n+import org.apache.wicket.model.IModel;\n+import org.apache.wicket.model.LoadableDetachableModel;\n import org.apache.wicket.model.Model;\n+import org.apache.wicket.model.PropertyModel;\n import org.apache.wicket.spring.injection.annot.SpringBean;\n import org.syncope.client.to.AttributeTO;\n import org.syncope.client.to.MembershipTO;\n import org.syncope.client.to.SchemaTO;\n import org.syncope.console.commons.SchemaWrapper;\n import org.syncope.console.rest.SchemaRestClient;\n import org.syncope.console.wicket.markup.html.form.AjaxCheckBoxPanel;\n+import org.syncope.console.wicket.markup.html.form.AjaxDecoratedCheckbox;\n import org.syncope.console.wicket.markup.html.form.AjaxTextFieldPanel;\n import org.syncope.console.wicket.markup.html.form.DateFieldPanel;\n import org.syncope.types.SchemaType;\n@@ -70,13 +78,21 @@ public MembershipModalPage(final Page basePage, final ModalWindow window,\n \n         setupSchemaWrappers(createFlag, membershipTO);\n \n+        final IModel<List<String>> derivedSchemaNames =\n+                new LoadableDetachableModel<List<String>>() {\n+\n+                    @Override\n+                    protected List<String> load() {\n+                        return schemaRestClient.getDerivedSchemaNames(\"membership\");\n+                    }\n+                };\n+\n         final ListView userAttributesView = new ListView(\"membershipSchemas\",\n                 schemaWrappers) {\n \n             @Override\n             protected void populateItem(ListItem item) {\n-                final SchemaWrapper schemaWrapper = (SchemaWrapper) item.\n-                        getDefaultModelObject();\n+                final SchemaWrapper schemaWrapper = (SchemaWrapper) item.getDefaultModelObject();\n \n                 final SchemaTO schemaTO = schemaWrapper.getSchemaTO();\n \n@@ -113,8 +129,7 @@ public void setObject(Serializable object) {\n                                 }\n                             }, required);\n                         } else if (schemaTO.getType() == SchemaType.Boolean) {\n-                            panel = new AjaxCheckBoxPanel(\"panel\", schemaTO.\n-                                    getName(), new Model() {\n+                            panel = new AjaxCheckBoxPanel(\"panel\", schemaTO.getName(), new Model() {\n \n                                 @Override\n                                 public Serializable getObject() {\n@@ -136,12 +151,10 @@ public void setObject(Serializable object) {\n                                 @Override\n                                 public Serializable getObject() {\n                                     DateFormat formatter =\n-                                            new SimpleDateFormat(schemaTO.\n-                                            getConversionPattern());\n+                                            new SimpleDateFormat(schemaTO.getConversionPattern());\n                                     Date date = new Date();\n                                     try {\n-                                        String dateValue = (String) item.\n-                                                getModelObject();\n+                                        String dateValue = (String) item.getModelObject();\n                                         formatter = new SimpleDateFormat(\n                                                 schemaTO.getConversionPattern());\n \n@@ -225,17 +238,19 @@ protected void onSubmit(AjaxRequestTarget target, Form form) {\n             @Override\n             protected void onSubmit(AjaxRequestTarget target, Form form) {\n \n-                MembershipTO membershipTO = (MembershipTO) form.\n-                        getDefaultModelObject();\n-                membershipTO.setAttributes(getMembershipAttributes());\n+                MembershipTO membershipTO =\n+                        (MembershipTO) form.getDefaultModelObject();\n \n-                UserModalPage userModalPage = (UserModalPage) basePage;\n+                membershipTO.setAttributes(getMembershipAttributes());\n \n                 if (createFlag) {\n-                    userModalPage.getMembershipTOs().add(membershipTO);\n+                    ((UserModalPage) basePage).getMembershipTOs().add(\n+                            membershipTO);\n                 } else {\n-                    userModalPage.getMembershipTOs().remove(membershipTO);\n-                    userModalPage.getMembershipTOs().add(membershipTO);\n+                    ((UserModalPage) basePage).getMembershipTOs().remove(\n+                            membershipTO);\n+                    ((UserModalPage) basePage).getMembershipTOs().add(\n+                            membershipTO);\n                 }\n                 window.close(target);\n             }\n@@ -266,6 +281,97 @@ protected void onError(AjaxRequestTarget target, Form form) {\n \n         form.add(container);\n \n+        //--------------------------------\n+        // Derived attributes container\n+        //--------------------------------\n+        final WebMarkupContainer derivedAttributesContainer =\n+                new WebMarkupContainer(\"derivedAttributesContainer\");\n+        derivedAttributesContainer.setOutputMarkupId(true);\n+        form.add(derivedAttributesContainer);\n+\n+        AjaxButton addDerivedAttributeBtn = new IndicatingAjaxButton(\n+                \"addDerivedAttributeBtn\",\n+                new Model(getString(\"addDerivedAttributeBtn\"))) {\n+\n+            @Override\n+            protected void onSubmit(final AjaxRequestTarget target,\n+                    final Form form) {\n+\n+                membershipTO.getDerivedAttributes().add(new AttributeTO());\n+                target.addComponent(derivedAttributesContainer);\n+            }\n+        };\n+        addDerivedAttributeBtn.setDefaultFormProcessing(false);\n+        form.add(addDerivedAttributeBtn);\n+\n+        ListView<AttributeTO> derivedAttributes = new ListView<AttributeTO>(\n+                \"derivedAttributes\", membershipTO.getDerivedAttributes()) {\n+\n+            @Override\n+            protected void populateItem(final ListItem<AttributeTO> item) {\n+                final AttributeTO derivedAttributeTO = item.getModelObject();\n+\n+                item.add(new AjaxDecoratedCheckbox(\"toRemove\",\n+                        new Model(Boolean.FALSE)) {\n+\n+                    @Override\n+                    protected void onUpdate(final AjaxRequestTarget target) {\n+                        membershipTO.getDerivedAttributes().remove(\n+                                derivedAttributeTO);\n+                        item.getParent().removeAll();\n+                        target.addComponent(derivedAttributesContainer);\n+                    }\n+\n+                    @Override\n+                    protected IAjaxCallDecorator getAjaxCallDecorator() {\n+                        return new AjaxPreprocessingCallDecorator(\n+                                super.getAjaxCallDecorator()) {\n+\n+                            @Override\n+                            public CharSequence preDecorateScript(\n+                                    final CharSequence script) {\n+\n+                                return \"if (confirm('\"\n+                                        + getString(\"confirmDelete\") + \"'))\"\n+                                        + \"{\" + script + \"} \"\n+                                        + \"else {this.checked = false;}\";\n+                            }\n+                        };\n+                    }\n+                });\n+\n+                final DropDownChoice<String> derivedSchemaChoice =\n+                        new DropDownChoice<String>(\n+                        \"schema\",\n+                        new PropertyModel<String>(derivedAttributeTO, \"schema\"),\n+                        derivedSchemaNames);\n+\n+                derivedSchemaChoice.setOutputMarkupId(true);\n+\n+                if (derivedAttributeTO.getSchema() != null) {\n+                    item.add(derivedSchemaChoice.setEnabled(Boolean.FALSE));\n+                } else {\n+                    item.add(derivedSchemaChoice.setRequired(true));\n+                }\n+\n+                final List<String> values = derivedAttributeTO.getValues();\n+\n+                if (values == null || values.isEmpty()) {\n+                    item.add(new TextField(\n+                            \"derivedAttributeValue\",\n+                            new Model(null)).setVisible(Boolean.FALSE));\n+                } else {\n+                    item.add(new TextField(\n+                            \"derivedAttributeValue\",\n+                            new Model(values.get(0))).setEnabled(\n+                            Boolean.FALSE));\n+                }\n+            }\n+        };\n+        derivedAttributes.setReuseItems(true);\n+        derivedAttributesContainer.add(derivedAttributes);\n+        //--------------------------------\n+\n         add(form);\n     }\n \n@@ -295,7 +401,7 @@ public void setupSchemaWrappers(boolean create, MembershipTO membershipTO) {\n         schemaWrappers = new ArrayList<SchemaWrapper>();\n         SchemaWrapper schemaWrapper;\n \n-        List<SchemaTO> schemas = schemaRestClient.getAllMemberhipSchemas();\n+        List<SchemaTO> schemas = schemaRestClient.getSchemas(\"membership\");\n \n         boolean found = false;\n "},{"sha":"1bee818d6baf553a6b1679675e64784c1fd9c059","filename":"console/src/main/java/org/syncope/console/pages/ResourceModalPage.java","status":"modified","additions":48,"deletions":7,"changes":55,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/6317d431ba6b1dc4d959a1d39e178124dd58f967/console%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fconsole%2Fpages%2FResourceModalPage.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/6317d431ba6b1dc4d959a1d39e178124dd58f967/console%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fconsole%2Fpages%2FResourceModalPage.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/console%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fconsole%2Fpages%2FResourceModalPage.java?ref=6317d431ba6b1dc4d959a1d39e178124dd58f967","patch":"@@ -70,20 +70,37 @@ public class ResourceModalPage extends BaseModalPage {\n \n     private List<String> uSchemaAttrNames;\n \n+    private List<String> uDerSchemaAttrNames;\n+\n     private List<String> rSchemaAttrNames;\n \n+    private List<String> rDerSchemaAttrNames;\n+\n     private List<String> mSchemaAttrNames;\n \n+    private List<String> mDerSchemaAttrNames;\n+\n     private WebMarkupContainer mappingContainer;\n \n     public ResourceModalPage(final Resources basePage, final ModalWindow window,\n             final ResourceTO resourceTO, final boolean createFlag) {\n \n         super();\n \n-        uSchemaAttrNames = schemaRestClient.getAllUSchemaNames();\n-        rSchemaAttrNames = schemaRestClient.getAllRSchemaNames();\n-        mSchemaAttrNames = schemaRestClient.getAllMSchemaNames();\n+        uSchemaAttrNames =\n+                schemaRestClient.getSchemaNames(\"user\");\n+        uDerSchemaAttrNames =\n+                schemaRestClient.getDerivedSchemaNames(\"user\");\n+\n+        rSchemaAttrNames =\n+                schemaRestClient.getSchemaNames(\"role\");\n+        rDerSchemaAttrNames =\n+                schemaRestClient.getDerivedSchemaNames(\"role\");\n+\n+        mSchemaAttrNames =\n+                schemaRestClient.getSchemaNames(\"membership\");\n+        mDerSchemaAttrNames =\n+                schemaRestClient.getDerivedSchemaNames(\"membership\");\n \n         final IModel<List<ConnInstanceTO>> connectors =\n                 new LoadableDetachableModel<List<ConnInstanceTO>>() {\n@@ -212,8 +229,7 @@ protected void onUpdate(final AjaxRequestTarget target) {\n \n                     @Override\n                     protected IAjaxCallDecorator getAjaxCallDecorator() {\n-                        return new AjaxPreprocessingCallDecorator(super.\n-                                getAjaxCallDecorator()) {\n+                        return new AjaxPreprocessingCallDecorator(super.getAjaxCallDecorator()) {\n \n                             @Override\n                             public CharSequence preDecorateScript(\n@@ -232,7 +248,9 @@ public CharSequence preDecorateScript(\n                         new DropDownChoice<String>(\n                         \"sourceAttrNames\", new PropertyModel<String>(\n                         mappingTO, \"sourceAttrName\"), (IModel) null);\n+\n                 schemaAttrChoice.setOutputMarkupId(true);\n+\n                 if (mappingTO.getSourceMappingType() == null) {\n                     schemaAttrChoice.setChoices(Collections.EMPTY_LIST);\n                 } else {\n@@ -241,14 +259,26 @@ public CharSequence preDecorateScript(\n                             schemaAttrChoice.setChoices(uSchemaAttrNames);\n                             break;\n \n+                        case UserDerivedSchema:\n+                            schemaAttrChoice.setChoices(uDerSchemaAttrNames);\n+                            break;\n+\n                         case RoleSchema:\n                             schemaAttrChoice.setChoices(rSchemaAttrNames);\n                             break;\n \n+                        case RoleDerivedSchema:\n+                            schemaAttrChoice.setChoices(rDerSchemaAttrNames);\n+                            break;\n+\n                         case MembershipSchema:\n                             schemaAttrChoice.setChoices(mSchemaAttrNames);\n                             break;\n \n+                        case MembershipDerivedSchema:\n+                            schemaAttrChoice.setChoices(mDerSchemaAttrNames);\n+                            break;\n+\n                         case SyncopeUserId:\n                             schemaAttrChoice.setEnabled(false);\n                             schemaAttrChoice.setRequired(false);\n@@ -278,8 +308,7 @@ public CharSequence preDecorateScript(\n                         setOutputMarkupId(true));\n \n                 item.add(new TextField(\"destAttrName\",\n-                        new PropertyModel(mappingTO, \"destAttrName\")).\n-                        setRequired(true).\n+                        new PropertyModel(mappingTO, \"destAttrName\")).setRequired(true).\n                         setLabel(new Model(getString(\"fieldName\"))).\n                         setOutputMarkupId(true));\n \n@@ -409,14 +438,26 @@ protected List<String> load() {\n                                             result = uSchemaAttrNames;\n                                             break;\n \n+                                        case UserDerivedSchema:\n+                                            result = uDerSchemaAttrNames;\n+                                            break;\n+\n                                         case RoleSchema:\n                                             result = rSchemaAttrNames;\n                                             break;\n \n+                                        case RoleDerivedSchema:\n+                                            result = rDerSchemaAttrNames;\n+                                            break;\n+\n                                         case MembershipSchema:\n                                             result = mSchemaAttrNames;\n                                             break;\n \n+                                        case MembershipDerivedSchema:\n+                                            result = mDerSchemaAttrNames;\n+                                            break;\n+\n                                         case SyncopeUserId:\n                                         case Password:\n                                         default:"},{"sha":"099f4b7b22d76f1f262941376bc0b0a69b5d8f5c","filename":"console/src/main/java/org/syncope/console/pages/RoleModalPage.java","status":"modified","additions":155,"deletions":24,"changes":179,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/6317d431ba6b1dc4d959a1d39e178124dd58f967/console%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fconsole%2Fpages%2FRoleModalPage.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/6317d431ba6b1dc4d959a1d39e178124dd58f967/console%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fconsole%2Fpages%2FRoleModalPage.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/console%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fconsole%2Fpages%2FRoleModalPage.java?ref=6317d431ba6b1dc4d959a1d39e178124dd58f967","patch":"@@ -38,12 +38,16 @@\n import org.apache.wicket.markup.html.form.TextField;\n import org.apache.wicket.markup.html.basic.Label;\n import org.apache.wicket.markup.html.form.ChoiceRenderer;\n+import org.apache.wicket.markup.html.form.DropDownChoice;\n import org.apache.wicket.markup.html.form.Form;\n import org.apache.wicket.markup.html.list.ListItem;\n import org.apache.wicket.markup.html.list.ListView;\n import org.apache.wicket.markup.html.panel.Panel;\n import org.apache.wicket.model.CompoundPropertyModel;\n+import org.apache.wicket.model.IModel;\n+import org.apache.wicket.model.LoadableDetachableModel;\n import org.apache.wicket.model.Model;\n+import org.apache.wicket.model.PropertyModel;\n import org.apache.wicket.model.util.ListModel;\n import org.apache.wicket.spring.injection.annot.SpringBean;\n import org.syncope.client.mod.AttributeMod;\n@@ -59,6 +63,7 @@\n import org.syncope.console.rest.RoleRestClient;\n import org.syncope.console.rest.SchemaRestClient;\n import org.syncope.console.wicket.markup.html.form.AjaxCheckBoxPanel;\n+import org.syncope.console.wicket.markup.html.form.AjaxDecoratedCheckbox;\n import org.syncope.console.wicket.markup.html.form.AjaxTextFieldPanel;\n import org.syncope.console.wicket.markup.html.form.DateFieldPanel;\n import org.syncope.types.SchemaType;\n@@ -116,13 +121,22 @@ public RoleModalPage(final BasePage basePage, final ModalWindow window,\n \n         setupSchemaWrappers(createFlag, roleTO);\n \n+        final IModel<List<String>> derivedSchemaNames =\n+                new LoadableDetachableModel<List<String>>() {\n+\n+                    @Override\n+                    protected List<String> load() {\n+                        return schemaRestClient.getDerivedSchemaNames(\"role\");\n+                    }\n+                };\n+\n         final ListView roleAttributesView = new ListView(\"roleSchemas\",\n                 schemaWrappers) {\n \n             @Override\n             protected void populateItem(final ListItem item) {\n-                final SchemaWrapper schemaWrapper = (SchemaWrapper) item.\n-                        getDefaultModelObject();\n+                final SchemaWrapper schemaWrapper =\n+                        (SchemaWrapper) item.getDefaultModelObject();\n \n                 final SchemaTO schemaTO = schemaWrapper.getSchemaTO();\n \n@@ -145,8 +159,7 @@ protected void populateItem(final ListItem item) {\n                         }\n \n                         if (schemaTO.getType() == SchemaType.Boolean) {\n-                            panel = new AjaxCheckBoxPanel(\"panel\", schemaTO.\n-                                    getName(), new Model() {\n+                            panel = new AjaxCheckBoxPanel(\"panel\", schemaTO.getName(), new Model() {\n \n                                 @Override\n                                 public Serializable getObject() {\n@@ -170,8 +183,7 @@ public Serializable getObject() {\n                                             schemaTO.getConversionPattern());\n                                     Date date = new Date();\n                                     try {\n-                                        String dateValue = (String) item.\n-                                                getModelObject();\n+                                        String dateValue = (String) item.getModelObject();\n                                         //Default value:yyyy-MM-dd\n                                         if (!dateValue.equals(\"\")) {\n                                             date = formatter.parse(dateValue);\n@@ -199,8 +211,7 @@ public void setObject(Serializable object) {\n                             /*Common other cases :\n                             java.lang.String,java.lang.Double, java.lang.Long*/\n \n-                            panel = new AjaxTextFieldPanel(\"panel\", schemaTO.\n-                                    getName(), new Model() {\n+                            panel = new AjaxTextFieldPanel(\"panel\", schemaTO.getName(), new Model() {\n \n                                 @Override\n                                 public Serializable getObject() {\n@@ -247,8 +258,7 @@ protected void onSubmit(final AjaxRequestTarget target,\n \n                     @Override\n                     protected IAjaxCallDecorator getAjaxCallDecorator() {\n-                        return new AjaxPreprocessingCallDecorator(super.\n-                                getAjaxCallDecorator()) {\n+                        return new AjaxPreprocessingCallDecorator(super.getAjaxCallDecorator()) {\n \n                             @Override\n                             public CharSequence preDecorateScript(\n@@ -284,6 +294,97 @@ public CharSequence preDecorateScript(\n \n         form.add(roleAttributesView);\n \n+        //--------------------------------\n+        // Derived attributes container\n+        //--------------------------------\n+        final WebMarkupContainer derivedAttributesContainer =\n+                new WebMarkupContainer(\"derivedAttributesContainer\");\n+\n+        derivedAttributesContainer.setOutputMarkupId(true);\n+        form.add(derivedAttributesContainer);\n+\n+        AjaxButton addDerivedAttributeBtn = new IndicatingAjaxButton(\n+                \"addDerivedAttributeBtn\",\n+                new Model(getString(\"addDerivedAttributeBtn\"))) {\n+\n+            @Override\n+            protected void onSubmit(final AjaxRequestTarget target,\n+                    final Form form) {\n+\n+                roleTO.getDerivedAttributes().add(new AttributeTO());\n+                target.addComponent(derivedAttributesContainer);\n+            }\n+        };\n+        addDerivedAttributeBtn.setDefaultFormProcessing(false);\n+        form.add(addDerivedAttributeBtn);\n+\n+        ListView<AttributeTO> derivedAttributes = new ListView<AttributeTO>(\n+                \"derivedAttributes\", roleTO.getDerivedAttributes()) {\n+\n+            @Override\n+            protected void populateItem(final ListItem<AttributeTO> item) {\n+                final AttributeTO derivedAttributeTO = item.getModelObject();\n+\n+                item.add(new AjaxDecoratedCheckbox(\"toRemove\",\n+                        new Model(Boolean.FALSE)) {\n+\n+                    @Override\n+                    protected void onUpdate(final AjaxRequestTarget target) {\n+                        roleTO.getDerivedAttributes().remove(derivedAttributeTO);\n+                        item.getParent().removeAll();\n+                        target.addComponent(derivedAttributesContainer);\n+                    }\n+\n+                    @Override\n+                    protected IAjaxCallDecorator getAjaxCallDecorator() {\n+                        return new AjaxPreprocessingCallDecorator(\n+                                super.getAjaxCallDecorator()) {\n+\n+                            @Override\n+                            public CharSequence preDecorateScript(\n+                                    final CharSequence script) {\n+\n+                                return \"if (confirm('\"\n+                                        + getString(\"confirmDelete\") + \"'))\"\n+                                        + \"{\" + script + \"} \"\n+                                        + \"else {this.checked = false;}\";\n+                            }\n+                        };\n+                    }\n+                });\n+\n+                final DropDownChoice<String> derivedSchemaChoice =\n+                        new DropDownChoice<String>(\n+                        \"schema\",\n+                        new PropertyModel<String>(derivedAttributeTO, \"schema\"),\n+                        derivedSchemaNames);\n+\n+                derivedSchemaChoice.setOutputMarkupId(true);\n+\n+                if (derivedAttributeTO.getSchema() != null) {\n+                    item.add(derivedSchemaChoice.setEnabled(Boolean.FALSE));\n+                } else {\n+                    item.add(derivedSchemaChoice.setRequired(true));\n+                }\n+\n+                final List<String> values = derivedAttributeTO.getValues();\n+\n+                if (values == null || values.isEmpty()) {\n+                    item.add(new TextField(\n+                            \"derivedAttributeValue\",\n+                            new Model(null)).setVisible(Boolean.FALSE));\n+                } else {\n+                    item.add(new TextField(\n+                            \"derivedAttributeValue\",\n+                            new Model(values.get(0))).setEnabled(\n+                            Boolean.FALSE));\n+                }\n+            }\n+        };\n+        derivedAttributes.setReuseItems(true);\n+        derivedAttributesContainer.add(derivedAttributes);\n+        //--------------------------------\n+\n         ListModel<ResourceTO> selectedResources = new ListModel<ResourceTO>();\n         selectedResources.setObject(getSelectedResources(roleTO));\n \n@@ -429,7 +530,7 @@ public void setupSchemaWrappers(boolean create, RoleTO roleTO) {\n         schemaWrappers = new ArrayList<SchemaWrapper>();\n         SchemaWrapper schemaWrapper;\n \n-        List<SchemaTO> schemas = schemaRestClient.getAllRoleSchemas();\n+        List<SchemaTO> schemas = schemaRestClient.getSchemas(\"role\");\n \n         boolean found = false;\n \n@@ -494,23 +595,36 @@ public void cloneOldRoleTO(RoleTO roleTO) {\n         final List<AttributeTO> attributes = new ArrayList<AttributeTO>();\n \n         AttributeTO attributeTO;\n-        List<String> values;\n+\n         for (AttributeTO attribute : roleTO.getAttributes()) {\n             attributeTO = new AttributeTO();\n-            attributeTO.setSchema(new String(attribute.getSchema()));\n+            attributeTO.setReadonly(attribute.isReadonly());\n+            attributeTO.setSchema(attribute.getSchema());\n \n-            values = new ArrayList<String>();\n-            for (String val : attribute.getValues()) {\n-                values.add(val);\n+            for (String value : attribute.getValues()) {\n+                attributeTO.addValue(value);\n             }\n-            attributeTO.setValues(values);\n \n             attributes.add(attributeTO);\n         }\n \n         oldRole.setAttributes(attributes);\n \n-        oldRole.setResources(roleTO.getResources());\n+        for (AttributeTO attribute : roleTO.getDerivedAttributes()) {\n+            attributeTO = new AttributeTO();\n+            attributeTO.setReadonly(attribute.isReadonly());\n+            attributeTO.setSchema(attribute.getSchema());\n+\n+            for (String value : attribute.getValues()) {\n+                attributeTO.addValue(value);\n+            }\n+\n+            oldRole.addDerivedAttribute(attributeTO);\n+        }\n+\n+        for (String resource : roleTO.getResources()) {\n+            oldRole.addResource(resource);\n+        }\n \n         List<String> entList = new ArrayList<String>();\n \n@@ -522,18 +636,36 @@ public void cloneOldRoleTO(RoleTO roleTO) {\n     }\n \n     public void setupRoleMod(final RoleTO roleTO) {\n+        roleMod = new RoleMod();\n+\n         //1.Check if the role's name has been changed\n         if (!oldRole.getName().equals(roleTO.getName())) {\n-            roleMod = new RoleMod();\n             roleMod.setName(roleTO.getName());\n         }\n \n-        //2.Search and update role's attributes\n+        //2.Update user's schema derived attributes\n+        final List<AttributeTO> newDerivedAttributes =\n+                roleTO.getDerivedAttributes();\n+\n+        final List<AttributeTO> oldDerivedAttributes =\n+                oldRole.getDerivedAttributes();\n+\n+        for (AttributeTO oldDerivedAttribute : oldDerivedAttributes) {\n+            roleMod.addDerivedAttributeToBeRemoved(\n+                    oldDerivedAttribute.getSchema());\n+        }\n+\n+        for (AttributeTO newDerivedAttribute : newDerivedAttributes) {\n+            roleMod.addDerivedAttributeToBeAdded(\n+                    newDerivedAttribute.getSchema());\n+        }\n+\n+        //3.Search and update role's attributes\n         for (AttributeTO attributeTO : roleTO.getAttributes()) {\n             searchAndUpdateAttribute(attributeTO);\n         }\n \n-        //3.Search and update role's resources\n+        //4.Search and update role's resources\n         for (String resource : roleTO.getResources()) {\n             searchAndAddResource(resource);\n         }\n@@ -542,7 +674,7 @@ public void setupRoleMod(final RoleTO roleTO) {\n             searchAndDropResource(resource, roleTO);\n         }\n \n-        //4.Check if entitlements' list has been changed\n+        //5.Check if entitlements' list has been changed\n         if (!oldRole.getEntitlements().equals(roleTO.getEntitlements())) {\n             roleMod.setEntitlements(roleTO.getEntitlements());\n         }\n@@ -629,8 +761,7 @@ public void searchAndUpdateAttribute(AttributeTO attributeTO) {\n             if (attributeTO.getSchema().equals(oldAttribute.getSchema())) {\n \n                 if (attributeTO.getSchema().equals(oldAttribute.getSchema())\n-                        && !attributeTO.equals(oldAttribute) && !oldAttribute.\n-                        isReadonly()) {\n+                        && !attributeTO.equals(oldAttribute) && !oldAttribute.isReadonly()) {\n \n                     if (attributeTO.getValues().size() > 1) {\n                         attributeMod.setValuesToBeAdded("},{"sha":"b4c7a92e18a9d22b7d2a1c82f5288636d7815b08","filename":"console/src/main/java/org/syncope/console/pages/Schema.java","status":"modified","additions":7,"deletions":8,"changes":15,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/6317d431ba6b1dc4d959a1d39e178124dd58f967/console%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fconsole%2Fpages%2FSchema.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/6317d431ba6b1dc4d959a1d39e178124dd58f967/console%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fconsole%2Fpages%2FSchema.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/console%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fconsole%2Fpages%2FSchema.java?ref=6317d431ba6b1dc4d959a1d39e178124dd58f967","patch":"@@ -62,16 +62,15 @@ private enum SchemaType {\n         RoleSchema,\n         UserSchema,\n         MembershipSchema\n-\n     };\n \n     private enum SchemaDerivedType {\n \n         RoleDerivedSchema,\n         UserDerivedSchema,\n         MembershipDerivedSchema\n-\n     };\n+\n     private static final int WIN_WIDTH = 400;\n \n     private static final int WIN_HEIGHT = 200;\n@@ -1317,15 +1316,15 @@ private List<SchemaTO> getSchemaDB() {\n             List<SchemaTO> list;\n             switch (schemaType) {\n                 case UserSchema:\n-                    list = restClient.getAllUserSchemas();\n+                    list = restClient.getSchemas(\"user\");\n                     break;\n \n                 case RoleSchema:\n-                    list = restClient.getAllRoleSchemas();\n+                    list = restClient.getSchemas(\"role\");\n                     break;\n \n                 case MembershipSchema:\n-                    list = restClient.getAllMemberhipSchemas();\n+                    list = restClient.getSchemas(\"membership\");\n                     break;\n \n                 default:\n@@ -1377,11 +1376,11 @@ private List<DerivedSchemaTO> getDerivedSchemaDB() {\n             List<DerivedSchemaTO> list = null;\n \n             if (schema == SchemaDerivedType.RoleDerivedSchema) {\n-                list = restClient.getAllRoleDerivedSchemas();\n+                list = restClient.getDerivedSchemas(\"role\");\n             } else if (schema == SchemaDerivedType.UserDerivedSchema) {\n-                list = restClient.getAllUserDerivedSchemas();\n+                list = restClient.getDerivedSchemas(\"user\");\n             } else if (schema == SchemaDerivedType.MembershipDerivedSchema) {\n-                list = restClient.getAllMembershipDerivedSchemas();\n+                list = restClient.getDerivedSchemas(\"membership\");\n             }\n \n             return list;"},{"sha":"eccadbde0cd88655e2d214663277579c53d1c9e2","filename":"console/src/main/java/org/syncope/console/pages/UserModalPage.java","status":"modified","additions":325,"deletions":162,"changes":487,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/6317d431ba6b1dc4d959a1d39e178124dd58f967/console%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fconsole%2Fpages%2FUserModalPage.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/6317d431ba6b1dc4d959a1d39e178124dd58f967/console%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fconsole%2Fpages%2FUserModalPage.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/console%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fconsole%2Fpages%2FUserModalPage.java?ref=6317d431ba6b1dc4d959a1d39e178124dd58f967","patch":"@@ -32,6 +32,8 @@\n import org.apache.wicket.Component;\n import org.apache.wicket.Page;\n import org.apache.wicket.ajax.AjaxRequestTarget;\n+import org.apache.wicket.ajax.IAjaxCallDecorator;\n+import org.apache.wicket.ajax.calldecorator.AjaxPreprocessingCallDecorator;\n import org.apache.wicket.ajax.markup.html.AjaxLink;\n import org.apache.wicket.ajax.markup.html.form.AjaxButton;\n import org.apache.wicket.authorization.strategies.role.metadata.MetaDataRoleAuthorizationStrategy;\n@@ -45,15 +47,18 @@\n import org.apache.wicket.markup.html.WebMarkupContainerWithAssociatedMarkup;\n import org.apache.wicket.markup.html.basic.Label;\n import org.apache.wicket.markup.html.form.ChoiceRenderer;\n+import org.apache.wicket.markup.html.form.DropDownChoice;\n import org.apache.wicket.markup.html.form.Form;\n import org.apache.wicket.markup.html.form.PasswordTextField;\n+import org.apache.wicket.markup.html.form.TextField;\n import org.apache.wicket.markup.html.list.ListItem;\n import org.apache.wicket.markup.html.list.ListView;\n import org.apache.wicket.markup.html.panel.Panel;\n import org.apache.wicket.markup.html.tree.BaseTree;\n import org.apache.wicket.markup.html.tree.LinkTree;\n import org.apache.wicket.model.CompoundPropertyModel;\n import org.apache.wicket.model.IModel;\n+import org.apache.wicket.model.LoadableDetachableModel;\n import org.apache.wicket.model.Model;\n import org.apache.wicket.model.PropertyModel;\n import org.apache.wicket.model.util.ListModel;\n@@ -62,6 +67,7 @@\n import org.syncope.client.mod.MembershipMod;\n import org.syncope.client.mod.UserMod;\n import org.syncope.client.to.AttributeTO;\n+import org.syncope.client.to.DerivedSchemaTO;\n import org.syncope.client.to.MembershipTO;\n import org.syncope.client.to.ResourceTO;\n import org.syncope.client.to.RoleTO;\n@@ -77,6 +83,7 @@\n import org.syncope.console.rest.UserRestClient;\n import org.syncope.console.wicket.ajax.markup.html.IndicatingDeleteOnConfirmAjaxLink;\n import org.syncope.console.wicket.markup.html.form.AjaxCheckBoxPanel;\n+import org.syncope.console.wicket.markup.html.form.AjaxDecoratedCheckbox;\n import org.syncope.console.wicket.markup.html.form.AjaxTextFieldPanel;\n import org.syncope.console.wicket.markup.html.form.DateFieldPanel;\n import org.syncope.types.SchemaType;\n@@ -141,173 +148,270 @@ public UserModalPage(final Users basePage, final ModalWindow window,\n         setupSchemaWrappers(createFlag, userTO);\n         setupMemberships(createFlag, userTO);\n \n-        final ListView userAttributesView = new ListView(\"userSchemas\",\n-                schemaWrappers) {\n+        final IModel<List<String>> derivedSchemaNames =\n+                new LoadableDetachableModel<List<String>>() {\n \n-            @Override\n-            protected void populateItem(ListItem item) {\n-                final SchemaWrapper schemaWrapper =\n-                        (SchemaWrapper) item.getDefaultModelObject();\n+                    @Override\n+                    protected List<String> load() {\n+                        return schemaRestClient.getDerivedSchemaNames(\"user\");\n+                    }\n+                };\n \n-                final SchemaTO schemaTO = schemaWrapper.getSchemaTO();\n+        final ListView userAttributesView =\n+                new ListView(\"userSchemas\", schemaWrappers) {\n \n-                item.add(new Label(\"name\",\n-                        schemaWrapper.getSchemaTO().getName()));\n+                    @Override\n+                    protected void populateItem(ListItem item) {\n+                        final SchemaWrapper schemaWrapper =\n+                                (SchemaWrapper) item.getDefaultModelObject();\n \n-                item.add(new ListView(\"fields\", schemaWrapper.getValues()) {\n+                        final SchemaTO schemaTO = schemaWrapper.getSchemaTO();\n \n-                    Panel panel;\n+                        item.add(new Label(\"name\",\n+                                schemaWrapper.getSchemaTO().getName()));\n \n-                    @Override\n-                    protected void populateItem(final ListItem item) {\n+                        item.add(new ListView(\"fields\", schemaWrapper.getValues()) {\n \n-                        String mandatoryCondition = schemaTO.\n-                                getMandatoryCondition();\n-                        boolean required = false;\n+                            Panel panel;\n \n-                        if (mandatoryCondition.equalsIgnoreCase(\"true\")) {\n-                            required = true;\n-                        }\n+                            @Override\n+                            protected void populateItem(final ListItem item) {\n \n-                        if (schemaTO.getType() == SchemaType.String) {\n-                            panel = new AjaxTextFieldPanel(\"panel\",\n-                                    schemaTO.getName(), new Model() {\n+                                String mandatoryCondition = schemaTO.getMandatoryCondition();\n+                                boolean required = false;\n \n-                                @Override\n-                                public Serializable getObject() {\n-                                    return (String) item.getModelObject();\n+                                if (mandatoryCondition.equalsIgnoreCase(\"true\")) {\n+                                    required = true;\n                                 }\n \n-                                @Override\n-                                public void setObject(Serializable object) {\n-                                    item.setModelObject((String) object);\n-                                }\n-                            }, required, schemaTO.isReadonly());\n-                        } else if (schemaTO.getType() == SchemaType.Boolean) {\n-                            panel = new AjaxCheckBoxPanel(\"panel\",\n-                                    schemaTO.getName(), new Model() {\n-\n-                                @Override\n-                                public Serializable getObject() {\n-                                    return (String) item.getModelObject();\n-                                }\n+                                if (schemaTO.getType() == SchemaType.String) {\n+                                    panel = new AjaxTextFieldPanel(\"panel\",\n+                                            schemaTO.getName(), new Model() {\n \n-                                @Override\n-                                public void setObject(Serializable object) {\n-                                    Boolean val = (Boolean) object;\n-                                    item.setModelObject(val.toString());\n-                                }\n-                            }, required, schemaTO.isReadonly());\n-\n-                        } else if (schemaTO.getType() == SchemaType.Date) {\n-                            panel = new DateFieldPanel(\"panel\",\n-                                    schemaTO.getName(), new Model() {\n-\n-                                @Override\n-                                public Serializable getObject() {\n-                                    DateFormat formatter =\n-                                            new SimpleDateFormat(\n-                                            schemaTO.getConversionPattern());\n-                                    Date date = new Date();\n-                                    try {\n-                                        String dateValue = (String) item.\n-                                                getModelObject();\n-                                        //Default value:yyyy-MM-dd\n-                                        if (!dateValue.equals(\"\")) {\n-                                            date = formatter.parse(\n-                                                    dateValue);\n-                                        } else {\n-                                            date = null;\n+                                        @Override\n+                                        public Serializable getObject() {\n+                                            return (String) item.getModelObject();\n                                         }\n-                                    } catch (ParseException e) {\n-                                        LOG.error(\"While parsing date\", e);\n-                                    }\n-                                    return date;\n-                                }\n \n-                                @Override\n-                                public void setObject(Serializable object) {\n-                                    Date date = (Date) object;\n-                                    Format formatter = new SimpleDateFormat(\n-                                            schemaTO.getConversionPattern());\n-                                    String val = formatter.format(date);\n-                                    item.setModelObject(val);\n-                                }\n-                            }, schemaTO.getConversionPattern(),\n-                                    required,\n-                                    schemaTO.isReadonly(), userForm);\n-                        } else {\n-                            panel = new AjaxTextFieldPanel(\"panel\",\n-                                    schemaTO.getName(), new Model() {\n-\n-                                @Override\n-                                public Serializable getObject() {\n-                                    return (String) item.getModelObject();\n-                                }\n+                                        @Override\n+                                        public void setObject(Serializable object) {\n+                                            item.setModelObject((String) object);\n+                                        }\n+                                    }, required, schemaTO.isReadonly());\n+                                } else if (schemaTO.getType() == SchemaType.Boolean) {\n+                                    panel = new AjaxCheckBoxPanel(\"panel\",\n+                                            schemaTO.getName(), new Model() {\n+\n+                                        @Override\n+                                        public Serializable getObject() {\n+                                            return (String) item.getModelObject();\n+                                        }\n+\n+                                        @Override\n+                                        public void setObject(Serializable object) {\n+                                            Boolean val = (Boolean) object;\n+                                            item.setModelObject(val.toString());\n+                                        }\n+                                    }, required, schemaTO.isReadonly());\n+\n+                                } else if (schemaTO.getType() == SchemaType.Date) {\n+                                    panel = new DateFieldPanel(\"panel\",\n+                                            schemaTO.getName(), new Model() {\n+\n+                                        @Override\n+                                        public Serializable getObject() {\n+                                            DateFormat formatter =\n+                                                    new SimpleDateFormat(\n+                                                    schemaTO.getConversionPattern());\n+                                            Date date = new Date();\n+                                            try {\n+                                                String dateValue = (String) item.getModelObject();\n+                                                //Default value:yyyy-MM-dd\n+                                                if (!dateValue.equals(\"\")) {\n+                                                    date = formatter.parse(\n+                                                            dateValue);\n+                                                } else {\n+                                                    date = null;\n+                                                }\n+                                            } catch (ParseException e) {\n+                                                LOG.error(\"While parsing date\", e);\n+                                            }\n+                                            return date;\n+                                        }\n+\n+                                        @Override\n+                                        public void setObject(Serializable object) {\n+                                            Date date = (Date) object;\n+                                            Format formatter = new SimpleDateFormat(\n+                                                    schemaTO.getConversionPattern());\n+                                            String val = formatter.format(date);\n+                                            item.setModelObject(val);\n+                                        }\n+                                    }, schemaTO.getConversionPattern(),\n+                                            required,\n+                                            schemaTO.isReadonly(), userForm);\n+                                } else {\n+                                    panel = new AjaxTextFieldPanel(\"panel\",\n+                                            schemaTO.getName(), new Model() {\n+\n+                                        @Override\n+                                        public Serializable getObject() {\n+                                            return (String) item.getModelObject();\n+                                        }\n \n-                                @Override\n-                                public void setObject(Serializable object) {\n-                                    item.setModelObject((String) object);\n+                                        @Override\n+                                        public void setObject(Serializable object) {\n+                                            item.setModelObject((String) object);\n+                                        }\n+                                    }, required, schemaTO.isReadonly());\n                                 }\n-                            }, required, schemaTO.isReadonly());\n+\n+                                item.add(panel);\n+                            }\n+                        });\n+\n+                        AjaxButton addButton = new IndicatingAjaxButton(\"add\",\n+                                new Model(getString(\"add\"))) {\n+\n+                            @Override\n+                            protected void onSubmit(AjaxRequestTarget target,\n+                                    Form form) {\n+                                schemaWrapper.getValues().add(\"\");\n+\n+                                target.addComponent(container);\n+                            }\n+                        };\n+\n+                        AjaxButton dropButton = new IndicatingAjaxButton(\"drop\",\n+                                new Model(getString(\"drop\"))) {\n+\n+                            @Override\n+                            protected void onSubmit(AjaxRequestTarget target,\n+                                    Form form) {\n+                                //Drop the last component added\n+                                schemaWrapper.getValues().remove(\n+                                        schemaWrapper.getValues().size() - 1);\n+\n+                                target.addComponent(container);\n+                            }\n+                        };\n+\n+                        if (schemaTO.getType() == SchemaType.Boolean) {\n+                            addButton.setVisible(false);\n+                            dropButton.setVisible(false);\n                         }\n \n-                        item.add(panel);\n-                    }\n-                });\n+                        addButton.setDefaultFormProcessing(false);\n+                        addButton.setVisible(schemaTO.isMultivalue());\n \n-                AjaxButton addButton = new IndicatingAjaxButton(\"add\",\n-                        new Model(getString(\"add\"))) {\n+                        dropButton.setDefaultFormProcessing(false);\n+                        dropButton.setVisible(schemaTO.isMultivalue());\n \n-                    @Override\n-                    protected void onSubmit(AjaxRequestTarget target,\n-                            Form form) {\n-                        schemaWrapper.getValues().add(\"\");\n+                        if (schemaWrapper.getValues().size() == 1) {\n+                            dropButton.setVisible(false);\n+                        }\n \n-                        target.addComponent(container);\n+                        if (schemaTO.isReadonly()) {\n+                            addButton.setEnabled(false);\n+                            dropButton.setEnabled(false);\n+                        }\n+\n+                        item.add(addButton);\n+                        item.add(dropButton);\n                     }\n                 };\n \n-                AjaxButton dropButton = new IndicatingAjaxButton(\"drop\",\n-                        new Model(getString(\"drop\"))) {\n+        userForm.add(userAttributesView);\n+\n+        //--------------------------------\n+        // Derived attributes container\n+        //--------------------------------\n+        final WebMarkupContainer derivedAttributesContainer =\n+                new WebMarkupContainer(\"derivedAttributesContainer\");\n+        derivedAttributesContainer.setOutputMarkupId(true);\n+        userForm.add(derivedAttributesContainer);\n \n-                    @Override\n-                    protected void onSubmit(AjaxRequestTarget target,\n-                            Form form) {\n-                        //Drop the last component added\n-                        schemaWrapper.getValues().remove(\n-                                schemaWrapper.getValues().size() - 1);\n+        AjaxButton addDerivedAttributeBtn = new IndicatingAjaxButton(\n+                \"addDerivedAttributeBtn\",\n+                new Model(getString(\"addDerivedAttributeBtn\"))) {\n \n-                        target.addComponent(container);\n+            @Override\n+            protected void onSubmit(final AjaxRequestTarget target,\n+                    final Form form) {\n+\n+                userTO.getDerivedAttributes().add(new AttributeTO());\n+                target.addComponent(derivedAttributesContainer);\n+            }\n+        };\n+        addDerivedAttributeBtn.setDefaultFormProcessing(false);\n+        userForm.add(addDerivedAttributeBtn);\n+\n+        ListView<AttributeTO> derivedAttributes = new ListView<AttributeTO>(\n+                \"derivedAttributes\", userTO.getDerivedAttributes()) {\n+\n+            @Override\n+            protected void populateItem(final ListItem<AttributeTO> item) {\n+                final AttributeTO derivedAttributeTO = item.getModelObject();\n+\n+                item.add(new AjaxDecoratedCheckbox(\"toRemove\",\n+                        new Model(Boolean.FALSE)) {\n+\n+                    @Override\n+                    protected void onUpdate(final AjaxRequestTarget target) {\n+                        userTO.getDerivedAttributes().remove(derivedAttributeTO);\n+                        item.getParent().removeAll();\n+                        target.addComponent(derivedAttributesContainer);\n                     }\n-                };\n \n-                if (schemaTO.getType() == SchemaType.Boolean) {\n-                    addButton.setVisible(false);\n-                    dropButton.setVisible(false);\n-                }\n+                    @Override\n+                    protected IAjaxCallDecorator getAjaxCallDecorator() {\n+                        return new AjaxPreprocessingCallDecorator(\n+                                super.getAjaxCallDecorator()) {\n+\n+                            @Override\n+                            public CharSequence preDecorateScript(\n+                                    final CharSequence script) {\n+\n+                                return \"if (confirm('\"\n+                                        + getString(\"confirmDelete\") + \"'))\"\n+                                        + \"{\" + script + \"} \"\n+                                        + \"else {this.checked = false;}\";\n+                            }\n+                        };\n+                    }\n+                });\n \n-                addButton.setDefaultFormProcessing(false);\n-                addButton.setVisible(schemaTO.isMultivalue());\n+                final DropDownChoice<String> derivedSchemaChoice =\n+                        new DropDownChoice<String>(\n+                        \"schema\",\n+                        new PropertyModel<String>(derivedAttributeTO, \"schema\"),\n+                        derivedSchemaNames);\n \n-                dropButton.setDefaultFormProcessing(false);\n-                dropButton.setVisible(schemaTO.isMultivalue());\n+                derivedSchemaChoice.setOutputMarkupId(true);\n \n-                if (schemaWrapper.getValues().size() == 1) {\n-                    dropButton.setVisible(false);\n+                if (derivedAttributeTO.getSchema() != null) {\n+                    item.add(derivedSchemaChoice.setEnabled(Boolean.FALSE));\n+                } else {\n+                    item.add(derivedSchemaChoice.setRequired(true));\n                 }\n \n-                if (schemaTO.isReadonly()) {\n-                    addButton.setEnabled(false);\n-                    dropButton.setEnabled(false);\n-                }\n+                final List<String> values = derivedAttributeTO.getValues();\n \n-                item.add(addButton);\n-                item.add(dropButton);\n+                if (values == null || values.isEmpty()) {\n+                    item.add(new TextField(\n+                            \"derivedAttributeValue\",\n+                            new Model(null)).setVisible(Boolean.FALSE));\n+                } else {\n+                    item.add(new TextField(\n+                            \"derivedAttributeValue\",\n+                            new Model(values.get(0))).setEnabled(\n+                            Boolean.FALSE));\n+                }\n             }\n         };\n-\n-        userForm.add(userAttributesView);\n+        derivedAttributes.setReuseItems(true);\n+        derivedAttributesContainer.add(derivedAttributes);\n+        //--------------------------------\n \n         ListModel<ResourceTO> selectedResources = new ListModel<ResourceTO>();\n         selectedResources.setObject(getSelectedResources(userTO));\n@@ -342,6 +446,7 @@ public void onComponentTag(final Component component,\n                 }\n             }\n         });\n+\n         container.add(mandatoryPassword);\n \n         container.setOutputMarkupId(true);\n@@ -355,10 +460,11 @@ public void onComponentTag(final Component component,\n             protected void onSubmit(final AjaxRequestTarget target,\n                     final Form form) {\n \n-                UserTO userTO = (UserTO) form.getDefaultModelObject();\n+                UserTO userTO = (UserTO) form.getModelObject();\n+\n                 try {\n-                    userTO.setResources(getResourcesSet(resourcesPalette.\n-                            getModelCollection()));\n+                    userTO.setResources(getResourcesSet(\n+                            resourcesPalette.getModelCollection()));\n                     userTO.setAttributes(getUserAttributesList());\n                     userTO.setMemberships(getMembershipsSet());\n \n@@ -416,8 +522,7 @@ protected IModel getNodeTextModel(final IModel model) {\n             protected void onNodeLinkClicked(final Object node,\n                     final BaseTree tree, final AjaxRequestTarget target) {\n \n-                final RoleTO roleTO = (RoleTO) ((DefaultMutableTreeNode) node).\n-                        getUserObject();\n+                final RoleTO roleTO = (RoleTO) ((DefaultMutableTreeNode) node).getUserObject();\n \n                 membershipWin.setPageCreator(new ModalWindow.PageCreator() {\n \n@@ -531,6 +636,22 @@ private List<ResourceTO> getSelectedResources(final UserTO userTO) {\n         return resources;\n     }\n \n+    private List<DerivedSchemaTO> getSelectedDerivedSchemas(final UserTO userTO) {\n+        List<AttributeTO> attributes = userTO.getDerivedAttributes();\n+\n+        List<DerivedSchemaTO> schemas = new ArrayList<DerivedSchemaTO>();\n+\n+        DerivedSchemaTO schema;\n+\n+        for (AttributeTO attribute : attributes) {\n+            schema = new DerivedSchemaTO();\n+            schema.setName(attribute.getSchema());\n+            schemas.add(schema);\n+        }\n+\n+        return schemas;\n+    }\n+\n     private List<ResourceTO> getAvailableResources(final UserTO userTO) {\n         List<ResourceTO> resources = new ArrayList<ResourceTO>();\n \n@@ -543,6 +664,10 @@ private List<ResourceTO> getAvailableResources(final UserTO userTO) {\n         return resources;\n     }\n \n+    private List<DerivedSchemaTO> getAvailableDerivedSchemas(final UserTO userTO) {\n+        return schemaRestClient.getDerivedSchemas(\"user\");\n+    }\n+\n     /**\n      * Create a copy of old userTO object.\n      * @param userTO the original TO\n@@ -553,22 +678,36 @@ private void cloneOldUserTO(final UserTO userTO) {\n         oldUser.setId(userTO.getId());\n         oldUser.setPassword(userTO.getPassword());\n \n-        AttributeTO tempAttr;\n+        AttributeTO attributeTO;\n         for (AttributeTO attribute : userTO.getAttributes()) {\n-            tempAttr = new AttributeTO();\n-            tempAttr.setReadonly(attribute.isReadonly());\n+            attributeTO = new AttributeTO();\n+            attributeTO.setReadonly(attribute.isReadonly());\n \n-            tempAttr.setSchema(attribute.getSchema());\n+            attributeTO.setSchema(attribute.getSchema());\n \n-            for (String tempVal : attribute.getValues()) {\n-                tempAttr.getValues().add(tempVal);\n+            for (String value : attribute.getValues()) {\n+                attributeTO.addValue(value);\n             }\n \n-            oldUser.getAttributes().add(tempAttr);\n+            oldUser.addAttribute(attributeTO);\n         }\n \n-        oldUser.setResources(userTO.getResources());\n-        oldUser.setMemberships(new ArrayList<MembershipTO>());\n+        for (AttributeTO attribute : userTO.getDerivedAttributes()) {\n+            attributeTO = new AttributeTO();\n+            attributeTO.setReadonly(attribute.isReadonly());\n+\n+            attributeTO.setSchema(attribute.getSchema());\n+\n+            for (String value : attribute.getValues()) {\n+                attributeTO.addValue(value);\n+            }\n+\n+            oldUser.addDerivedAttribute(attributeTO);\n+        }\n+\n+        for (String resource : userTO.getResources()) {\n+            oldUser.addResource(resource);\n+        }\n \n         MembershipTO membership;\n \n@@ -577,7 +716,7 @@ private void cloneOldUserTO(final UserTO userTO) {\n             membership.setId(membershipTO.getId());\n             membership.setRoleId(membershipTO.getRoleId());\n             membership.setAttributes(membershipTO.getAttributes());\n-            oldUser.getMemberships().add(membership);\n+            oldUser.addMembership(membership);\n         }\n     }\n \n@@ -598,7 +737,7 @@ private void setupSchemaWrappers(boolean create, final UserTO userTO) {\n         schemaWrappers = new ArrayList<SchemaWrapper>();\n         SchemaWrapper schemaWrapper;\n \n-        List<SchemaTO> schemas = schemaRestClient.getAllUserSchemas();\n+        List<SchemaTO> schemas = schemaRestClient.getSchemas(\"user\");\n \n         boolean found = false;\n \n@@ -699,18 +838,37 @@ public List<MembershipTO> getMembershipTOs() {\n      * @param userTO\n      */\n     private void setupUserMod(final UserTO userTO) {\n+        userMod = new UserMod();\n+\n         //1.Check if the password has been changed and update it\n-        if (!oldUser.getPassword().equals(userTO.getPassword())) {\n-            userMod = new UserMod();\n+        if (oldUser.getPassword() != null\n+                && !oldUser.getPassword().equals(userTO.getPassword())) {\n             userMod.setPassword(userTO.getPassword());\n         }\n \n-        //2.Update user's schema attributes\n+        //2.Update user's schema derived attributes\n+        final List<AttributeTO> newDerivedAttributes =\n+                userTO.getDerivedAttributes();\n+\n+        final List<AttributeTO> oldDerivedAttributes =\n+                oldUser.getDerivedAttributes();\n+\n+        for (AttributeTO oldDerivedAttribute : oldDerivedAttributes) {\n+            userMod.addDerivedAttributeToBeRemoved(\n+                    oldDerivedAttribute.getSchema());\n+        }\n+\n+        for (AttributeTO newDerivedAttribute : newDerivedAttributes) {\n+            userMod.addDerivedAttributeToBeAdded(\n+                    newDerivedAttribute.getSchema());\n+        }\n+\n+        //3.Update user's schema attributes\n         for (AttributeTO attributeTO : userTO.getAttributes()) {\n             searchAndUpdateAttribute(attributeTO);\n         }\n \n-        //3.Update user's resources\n+        //4.Update user's resources\n         for (String resource : userTO.getResources()) {\n             searchAndAddResource(resource);\n         }\n@@ -720,7 +878,7 @@ private void setupUserMod(final UserTO userTO) {\n             searchAndDropResource(resource, userTO);\n         }\n \n-        //4.Update user's memberships\n+        //5.Update user's memberships\n         for (MembershipTO membership : userTO.getMemberships()) {\n             searchAndUpdateMembership(membership);\n         }\n@@ -744,8 +902,7 @@ private void searchAndUpdateAttribute(AttributeTO attributeTO) {\n         for (AttributeTO oldAttribute : oldUser.getAttributes()) {\n             if (attributeTO.getSchema().equals(oldAttribute.getSchema())) {\n \n-                if (!attributeTO.equals(oldAttribute) && !oldAttribute.\n-                        isReadonly()) {\n+                if (!attributeTO.equals(oldAttribute) && !oldAttribute.isReadonly()) {\n \n                     if (attributeTO.getValues().size() > 1) {\n                         attributeMod.setValuesToBeAdded(\n@@ -840,31 +997,37 @@ private void searchAndDropResource(String resource, UserTO userTO) {\n      * Update the Membership.\n      * @param new membershipTO\n      */\n-    private void searchAndUpdateMembership(MembershipTO newMembership) {\n+    private void searchAndUpdateMembership(MembershipTO membership) {\n         boolean found = false;\n         boolean attrFound = false;\n \n         MembershipMod membershipMod = new MembershipMod();\n-        membershipMod.setRole(newMembership.getRoleId());\n+        membershipMod.setRole(membership.getRoleId());\n \n         AttributeMod attributeMod;\n \n         //1. If the membership exists update it\n         for (MembershipTO oldMembership : oldUser.getMemberships()) {\n-            if (newMembership.getRoleId() == oldMembership.getRoleId()) {\n+            if (membership.getRoleId() == oldMembership.getRoleId()) {\n+\n+                for (AttributeTO newDerivedAttribute :\n+                        membership.getDerivedAttributes()) {\n+                    membershipMod.addDerivedAttributeToBeAdded(\n+                            newDerivedAttribute.getSchema());\n+                }\n \n-                for (AttributeTO newAttribute : newMembership.getAttributes()) {\n+                for (AttributeTO newAttribute : membership.getAttributes()) {\n                     for (AttributeTO oldAttribute :\n                             oldMembership.getAttributes()) {\n \n-                        if (oldAttribute.getSchema().equals(newAttribute.\n-                                getSchema())) {\n+                        if (oldAttribute.getSchema().equals(\n+                                newAttribute.getSchema())) {\n \n                             attributeMod = new AttributeMod();\n                             attributeMod.setSchema(newAttribute.getSchema());\n \n-                            attributeMod.setValuesToBeAdded(newAttribute.\n-                                    getValues());\n+                            attributeMod.setValuesToBeAdded(\n+                                    newAttribute.getValues());\n \n                             membershipMod.addAttributeToBeUpdated(attributeMod);\n                             attrFound = true;\n@@ -897,7 +1060,7 @@ private void searchAndUpdateMembership(MembershipTO newMembership) {\n         if (!found) {\n             Set<AttributeMod> attributes = new HashSet<AttributeMod>();\n \n-            for (AttributeTO newAttribute : newMembership.getAttributes()) {\n+            for (AttributeTO newAttribute : membership.getAttributes()) {\n                 attributeMod = new AttributeMod();\n                 attributeMod.setSchema(newAttribute.getSchema());\n                 attributeMod.setValuesToBeAdded(newAttribute.getValues());"},{"sha":"6bd4750c4173887926033d2dee2aff085ce8232b","filename":"console/src/main/java/org/syncope/console/pages/Users.java","status":"modified","additions":50,"deletions":10,"changes":60,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/6317d431ba6b1dc4d959a1d39e178124dd58f967/console%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fconsole%2Fpages%2FUsers.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/6317d431ba6b1dc4d959a1d39e178124dd58f967/console%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fconsole%2Fpages%2FUsers.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/console%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fconsole%2Fpages%2FUsers.java?ref=6317d431ba6b1dc4d959a1d39e178124dd58f967","patch":"@@ -83,6 +83,8 @@ public class Users extends BasePage {\n \n     private final static int DISPLAYATTRS_MODAL_WIN_WIDTH = 600;\n \n+    private final static String DERIVED_ATTRIBUTE_PREFIX = \"[D] \";\n+\n     @SpringBean\n     private UserRestClient userRestClient;\n \n@@ -110,7 +112,33 @@ public class Users extends BasePage {\n \n                 @Override\n                 protected List<String> load() {\n-                    return schemaRestClient.getAllUSchemaNames();\n+                    return schemaRestClient.getSchemaNames(\"user\");\n+                }\n+            };\n+\n+    final private IModel<List<String>> choosableSchemaNames =\n+            new LoadableDetachableModel<List<String>>() {\n+\n+                @Override\n+                protected List<String> load() {\n+\n+                    List<String> schemas =\n+                            schemaRestClient.getSchemaNames(\"user\");\n+\n+                    if (schemas == null) {\n+                        schemas = new ArrayList<String>();\n+                    }\n+\n+                    List<String> derivedSchemas =\n+                            schemaRestClient.getDerivedSchemaNames(\"user\");\n+\n+                    if (derivedSchemas != null) {\n+                        for (String schema : derivedSchemas) {\n+                            schemas.add(DERIVED_ATTRIBUTE_PREFIX + schema);\n+                        }\n+                    }\n+\n+                    return schemas;\n                 }\n             };\n \n@@ -220,8 +248,8 @@ public void onClick(final AjaxRequestTarget target) {\n \n                     @Override\n                     public Page createPage() {\n-                        return new UserModalPage(Users.this, editModalWin,\n-                                new UserTO(), true);\n+                        return new UserModalPage(\n+                                Users.this, editModalWin, new UserTO(), true);\n                     }\n                 });\n \n@@ -244,7 +272,8 @@ public void onClick(final AjaxRequestTarget target) {\n                             @Override\n                             public Page createPage() {\n                                 return new DisplayAttributesModalPage(\n-                                        Users.this, schemaNames,\n+                                        Users.this,\n+                                        choosableSchemaNames,\n                                         displayAttrsModalWin);\n                             }\n                         });\n@@ -466,12 +495,14 @@ protected List<IColumn<UserTO>> getColumns(final ModalWindow editModalWin) {\n         columns.add(new PropertyColumn(\n                 new Model(getString(\"status\")), \"status\", \"status\"));\n         columns.add(new TokenColumn(new Model(getString(\"token\")), \"token\"));\n+        \n         for (String schemaName : prefMan.getList(getWebRequestCycle().\n                 getWebRequest(), Constants.PREF_USERS_ATTRIBUTES_VIEW)) {\n \n             columns.add(new UserAttrColumn(\n                     new Model<String>(schemaName), schemaName));\n         }\n+\n         columns.add(new AbstractColumn<UserTO>(new Model<String>(getString(\n                 \"edit\"))) {\n \n@@ -494,8 +525,8 @@ public void onClick(final AjaxRequestTarget target) {\n \n                                     @Override\n                                     public Page createPage() {\n-                                        return new UserModalPage(Users.this,\n-                                                editModalWin,\n+                                        return new UserModalPage(\n+                                                Users.this, editModalWin,\n                                                 model.getObject(), false);\n                                     }\n                                 });\n@@ -760,7 +791,12 @@ private static class UserAttrColumn extends AbstractColumn<UserTO> {\n         public UserAttrColumn(final IModel<String> displayModel,\n                 final String schemaName) {\n \n-            super(displayModel, schemaName);\n+            super(displayModel,\n+                    schemaName.startsWith(DERIVED_ATTRIBUTE_PREFIX)\n+                    ? schemaName.substring(\n+                    DERIVED_ATTRIBUTE_PREFIX.length(), schemaName.length())\n+                    : schemaName);\n+\n             this.schemaName = schemaName;\n         }\n \n@@ -773,7 +809,12 @@ public void populateItem(\n             Label label;\n \n             List<String> values =\n-                    rowModel.getObject().getAttributeMap().get(schemaName);\n+                    schemaName.startsWith(DERIVED_ATTRIBUTE_PREFIX)\n+                    ? rowModel.getObject().getDerivedAttributeMap().get(\n+                    schemaName.substring(\n+                    DERIVED_ATTRIBUTE_PREFIX.length(), schemaName.length()))\n+                    : rowModel.getObject().getAttributeMap().get(schemaName);\n+\n             if (values == null || values.isEmpty()) {\n                 label = new Label(componentId, \"\");\n             } else {\n@@ -886,8 +927,7 @@ protected void populateItem(\n                         protected void onUpdate(\n                                 final AjaxRequestTarget target) {\n \n-                            filterNameChooser.setChoices(searchCondition.\n-                                    getFilterType() == FilterType.ATTRIBUTE\n+                            filterNameChooser.setChoices(searchCondition.getFilterType() == FilterType.ATTRIBUTE\n                                     ? schemaNames : roleNames);\n                             target.addComponent(filterNameChooser);\n                             target.addComponent(searchFormContainer);"},{"sha":"2d880f73cf2000c4c4f13271b1516a6b7caf9872","filename":"console/src/main/java/org/syncope/console/rest/SchemaRestClient.java","status":"modified","additions":37,"deletions":152,"changes":189,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/6317d431ba6b1dc4d959a1d39e178124dd58f967/console%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fconsole%2Frest%2FSchemaRestClient.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/6317d431ba6b1dc4d959a1d39e178124dd58f967/console%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fconsole%2Frest%2FSchemaRestClient.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/console%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fconsole%2Frest%2FSchemaRestClient.java?ref=6317d431ba6b1dc4d959a1d39e178124dd58f967","patch":"@@ -30,16 +30,16 @@\n public class SchemaRestClient extends AbstractBaseRestClient {\n \n     /**\n-     * Get all user's schemas.\n-     * @return SchemaTOs\n+     * Get schemas.\n+     * @return List of schamas.\n      */\n-    public List<SchemaTO> getAllUserSchemas() {\n+    public List<SchemaTO> getSchemas(String kind) {\n         List<SchemaTO> userSchemas = null;\n \n         try {\n             userSchemas = Arrays.asList(\n                     restTemplate.getForObject(\n-                    baseURL + \"schema/user/list.json\",\n+                    baseURL + \"schema/\" + kind + \"/list.json\",\n                     SchemaTO[].class));\n         } catch (SyncopeClientCompositeErrorException e) {\n             LOG.error(\"While getting all user schemas\", e);\n@@ -49,66 +49,71 @@ public List<SchemaTO> getAllUserSchemas() {\n     }\n \n     /**\n-     * Get all user's schemas names.\n-     * @return String list of schemas' names.\n+     * Get schema names.\n+     * @return List of schema names.\n      */\n-    public List<String> getAllUSchemaNames() {\n+    public List<String> getSchemaNames(String kind) {\n+\n+        final List<String> schemasNames = new ArrayList<String>();\n \n-        List<SchemaTO> userSchemas = null;\n-        List<String> schemasNames = new ArrayList<String>();\n         try {\n-            userSchemas = Arrays.asList(restTemplate.getForObject(\n-                    baseURL\n-                    + \"schema/user/list.json\", SchemaTO[].class));\n+            final List<SchemaTO> userSchemas = Arrays.asList(\n+                    restTemplate.getForObject(baseURL\n+                    + \"schema/\" + kind + \"/list.json\", SchemaTO[].class));\n+\n+            for (SchemaTO schemaTO : userSchemas) {\n+                schemasNames.add(schemaTO.getName());\n+            }\n+\n         } catch (SyncopeClientCompositeErrorException e) {\n             LOG.error(\"While getting all user schema names\", e);\n         }\n \n-        for (SchemaTO schemaTO : userSchemas) {\n-            schemasNames.add(schemaTO.getName());\n-        }\n-\n         return schemasNames;\n     }\n \n     /**\n-     * Get all user's derived schemas.\n-     * @return DerivedSchemaTOs\n+     * Get derived schemas.\n+     * @return List of derived schemas.\n      */\n-    public List<DerivedSchemaTO> getAllUserDerivedSchemas() {\n+    public List<DerivedSchemaTO> getDerivedSchemas(String kind) {\n \n         List<DerivedSchemaTO> userDerivedSchemas = null;\n+\n         try {\n             userDerivedSchemas = Arrays.asList(\n                     restTemplate.getForObject(\n-                    baseURL + \"derivedSchema/user/list.json\",\n+                    baseURL + \"derivedSchema/\" + kind + \"/list.json\",\n                     DerivedSchemaTO[].class));\n         } catch (SyncopeClientCompositeErrorException e) {\n             LOG.error(\"While getting all user derived schemas\", e);\n         }\n+\n         return userDerivedSchemas;\n     }\n \n     /**\n-     * Get all user's derived schemas names.\n-     * @return String list of derived schemas' names.\n+     * Get derived schema names.\n+     * @return List of derived schema names.\n      */\n-    public List<String> getAllUserDerivedSchemasNames() {\n+    public List<String> getDerivedSchemaNames(String kind) {\n+\n+        final List<String> userDerivedSchemasNames = new ArrayList<String>();\n \n-        List<DerivedSchemaTO> userDerivedSchemas = null;\n-        List<String> userDerivedSchemasNames = new ArrayList<String>();\n         try {\n-            userDerivedSchemas = Arrays.asList(restTemplate.getForObject(\n-                    baseURL\n-                    + \"derivedSchema/user/list.json\", DerivedSchemaTO[].class));\n+            final List<DerivedSchemaTO> userDerivedSchemas =\n+                    Arrays.asList(restTemplate.getForObject(baseURL\n+                    + \"derivedSchema/\" + kind + \"/list.json\",\n+                    DerivedSchemaTO[].class));\n+\n+            for (DerivedSchemaTO schemaTO : userDerivedSchemas) {\n+                userDerivedSchemasNames.add(schemaTO.getName());\n+            }\n+\n         } catch (SyncopeClientCompositeErrorException e) {\n             LOG.error(\"While getting all user derived schema names\", e);\n         }\n \n-        for (DerivedSchemaTO schemaTO : userDerivedSchemas) {\n-            userDerivedSchemasNames.add(schemaTO.getName());\n-        }\n-\n         return userDerivedSchemasNames;\n     }\n \n@@ -230,70 +235,6 @@ public void deleteUserDerivedSchema(String name) {\n         }\n     }\n \n-    /**\n-     * Get all role's schemas.\n-     * @return SchemaTOs\n-     */\n-    public List<SchemaTO> getAllRoleSchemas() {\n-\n-        List<SchemaTO> roleSchemas = null;\n-\n-        try {\n-            roleSchemas = Arrays.asList(restTemplate.getForObject(\n-                    baseURL + \"schema/role/list.json\", SchemaTO[].class));\n-        } catch (SyncopeClientCompositeErrorException e) {\n-            LOG.error(\"While creating a derived user schema\", e);\n-        }\n-\n-        return roleSchemas;\n-    }\n-\n-    /**\n-     * Get all role's schemas names.\n-     * @return String list of role schemas' names\n-     */\n-    public List<String> getAllRSchemaNames() {\n-\n-        List<SchemaTO> roleSchemas = null;\n-        List<String> roleSchemasNames = new ArrayList<String>();\n-\n-        try {\n-            roleSchemas = Arrays.asList(restTemplate.getForObject(\n-                    baseURL + \"schema/role/list.json\", SchemaTO[].class));\n-        } catch (SyncopeClientCompositeErrorException e) {\n-            LOG.error(\"While getting all role schema names\", e);\n-        }\n-\n-        for (SchemaTO schemaTO : roleSchemas) {\n-            roleSchemasNames.add(schemaTO.getName());\n-        }\n-\n-        return roleSchemasNames;\n-    }\n-\n-    /**\n-     * Get all role's schemas names.\n-     * @return String list of role schemas' names\n-     */\n-    public List<String> getAllMSchemaNames() {\n-\n-        List<SchemaTO> membershipSchemas = null;\n-        List<String> membershipSchemasNames = new ArrayList<String>();\n-\n-        try {\n-            membershipSchemas = Arrays.asList(restTemplate.getForObject(\n-                    baseURL + \"schema/membership/list.json\", SchemaTO[].class));\n-        } catch (SyncopeClientCompositeErrorException e) {\n-            LOG.error(\"While getting all membership schema names\", e);\n-        }\n-\n-        for (SchemaTO schemaTO : membershipSchemas) {\n-            membershipSchemasNames.add(schemaTO.getName());\n-        }\n-\n-        return membershipSchemasNames;\n-    }\n-\n     /**\n      * Create new user schema.\n      * @param schemaTO\n@@ -353,24 +294,6 @@ public void deleteRoleSchema(String name) {\n         }\n     }\n \n-    /**\n-     * Get all role's derived schemas.\n-     * @return DerivedSchemaTOs\n-     */\n-    public List<DerivedSchemaTO> getAllRoleDerivedSchemas() {\n-        List<DerivedSchemaTO> roleDerivedSchemas = null;\n-\n-        try {\n-            roleDerivedSchemas = Arrays.asList(restTemplate.getForObject(\n-                    baseURL\n-                    + \"derivedSchema/role/list.json\", DerivedSchemaTO[].class));\n-        } catch (SyncopeClientCompositeErrorException e) {\n-            LOG.error(\"While getting all role derived schemas\", e);\n-        }\n-\n-        return roleDerivedSchemas;\n-    }\n-\n     /**\n      * Create new user schema.\n      * @param schemaTO\n@@ -433,25 +356,6 @@ public void deleteRoleDerivedSchema(String name) {\n         }\n     }\n \n-    /**\n-     * Get all role's schemas.\n-     * @return SchemaTOs\n-     */\n-    public List<SchemaTO> getAllMemberhipSchemas() {\n-\n-        List<SchemaTO> memberhipSchemas = null;\n-\n-        try {\n-            memberhipSchemas = Arrays.asList(restTemplate.getForObject(\n-                    baseURL\n-                    + \"schema/membership/list.json\", SchemaTO[].class));\n-        } catch (SyncopeClientCompositeErrorException e) {\n-            LOG.error(\"While getting all membership schemas\", e);\n-        }\n-\n-        return memberhipSchemas;\n-    }\n-\n     /**\n      * Create new membership schema.\n      * @param schemaTO\n@@ -528,25 +432,6 @@ public Set<String> getAllValidatorClasses() {\n         return validators;\n     }\n \n-    /**\n-     * Get all membership's derived schemas.\n-     * @return DerivedSchemaTOs\n-     */\n-    public List<DerivedSchemaTO> getAllMembershipDerivedSchemas() {\n-        List<DerivedSchemaTO> roleDerivedSchemas = null;\n-\n-        try {\n-            roleDerivedSchemas = Arrays.asList(restTemplate.getForObject(\n-                    baseURL\n-                    + \"derivedSchema/membership/list.json\",\n-                    DerivedSchemaTO[].class));\n-        } catch (SyncopeClientCompositeErrorException e) {\n-            LOG.error(\"While getting all membership derived schemas\", e);\n-        }\n-\n-        return roleDerivedSchemas;\n-    }\n-\n     /**\n      * Create new membership schema.\n      * @param schemaTO"},{"sha":"817ed8d898d63dce87287b7c0abafff8aa9d814e","filename":"console/src/main/resources/org/syncope/console/pages/MembershipModalPage.html","status":"modified","additions":41,"deletions":0,"changes":41,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/6317d431ba6b1dc4d959a1d39e178124dd58f967/console%2Fsrc%2Fmain%2Fresources%2Forg%2Fsyncope%2Fconsole%2Fpages%2FMembershipModalPage.html","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/6317d431ba6b1dc4d959a1d39e178124dd58f967/console%2Fsrc%2Fmain%2Fresources%2Forg%2Fsyncope%2Fconsole%2Fpages%2FMembershipModalPage.html","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/console%2Fsrc%2Fmain%2Fresources%2Forg%2Fsyncope%2Fconsole%2Fpages%2FMembershipModalPage.html?ref=6317d431ba6b1dc4d959a1d39e178124dd58f967","patch":"@@ -18,6 +18,7 @@\n     <div id=\"tabs\">\n         <ul>\n             <li><a href=\"#tabs-1\"><span><wicket:message key=\"tab1\"/></span></a></li>\n+            <li><a href=\"#tabs-2\"><span><wicket:message key=\"tab2\"/></span></a></li>\n         </ul>\n         <div id=\"tabs-1\">\n             <table style=\"font-size:1em\" width=\"100%\" wicket:id=\"container\">\n@@ -41,6 +42,46 @@\n                 </script>\n             </table>\n         </div>\n+        <div id=\"tabs-2\">\n+            <table id=\"derivedAttributes\"\n+                   class=\"ui-widget ui-widget-content ui-corner-all\"\n+                   style=\"font-size: 1em;margin-top:2px;\"\n+                   width=\"100%\" cellpadding=\"2px\" cellspacing=\"1px\">\n+                <thead>\n+                    <tr class=\"ui-widget-header\">\n+                        <th><wicket:message key=\"derivedAttributeToBeRemoved\"/></th>\n+                <th><wicket:message key=\"derivedAttributeName\"/></th>\n+                <th><wicket:message key=\"derivedAttributeValue\"/></th>\n+                </tr>\n+                </thead>\n+\n+                <tfoot>\n+                    <tr>\n+                        <td>\n+                            <input type=\"submit\" class=\"ui-button ui-widget ui-state-default ui-corner-all ui-button-text-only\"\n+                                   wicket:id=\"addDerivedAttributeBtn\" />\n+                        </td>\n+                    </tr>\n+                </tfoot>\n+\n+                <tbody wicket:id=\"derivedAttributesContainer\">\n+                    <tr wicket:id=\"derivedAttributes\">\n+                        <td align=\"center\" valign=\"middle\">\n+                            <input type=\"checkbox\" class=\"text ui-widget-content ui-corner-all\"  wicket:id=\"toRemove\"/>\n+                        </td>\n+\n+                        <td>\n+                            <select class=\"text ui-widget-content ui-corner-all\"\n+                                    style=\"width:100%\" wicket:id=\"schema\"/>\n+                        </td>\n+\n+                        <td align=\"center\" valign=\"middle\">\n+                            <input type=\"text\" class=\"text ui-widget-content ui-corner-all\"  wicket:id=\"derivedAttributeValue\"/>\n+                        </td>\n+                    </tr>\n+                </tbody>\n+            </table>\n+        </div>\n     </div>\n     <div>\n         &nbsp;"},{"sha":"377c813ea1e5a2ff591b9d8219cc41b036fce82b","filename":"console/src/main/resources/org/syncope/console/pages/MembershipModalPage.properties","status":"modified","additions":6,"deletions":0,"changes":6,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/6317d431ba6b1dc4d959a1d39e178124dd58f967/console%2Fsrc%2Fmain%2Fresources%2Forg%2Fsyncope%2Fconsole%2Fpages%2FMembershipModalPage.properties","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/6317d431ba6b1dc4d959a1d39e178124dd58f967/console%2Fsrc%2Fmain%2Fresources%2Forg%2Fsyncope%2Fconsole%2Fpages%2FMembershipModalPage.properties","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/console%2Fsrc%2Fmain%2Fresources%2Forg%2Fsyncope%2Fconsole%2Fpages%2FMembershipModalPage.properties?ref=6317d431ba6b1dc4d959a1d39e178124dd58f967","patch":"@@ -1,6 +1,12 @@\n tab1=Attributes\n+tab2=Derived attributes\n title=Roles\n add=+\n drop=-\n edit=Edit\n delete=Delete\n+derivedAttributes=Derived Attributes\n+derivedAttributeToBeRemoved=Delete\n+derivedAttributeName=Name\n+derivedAttributeValue=Derived value\n+addDerivedAttributeBtn=Add"},{"sha":"2b850b5b8193f3ac93ff8a783c758e5af2e9496a","filename":"console/src/main/resources/org/syncope/console/pages/MembershipModalPage_it.properties","status":"modified","additions":6,"deletions":0,"changes":6,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/6317d431ba6b1dc4d959a1d39e178124dd58f967/console%2Fsrc%2Fmain%2Fresources%2Forg%2Fsyncope%2Fconsole%2Fpages%2FMembershipModalPage_it.properties","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/6317d431ba6b1dc4d959a1d39e178124dd58f967/console%2Fsrc%2Fmain%2Fresources%2Forg%2Fsyncope%2Fconsole%2Fpages%2FMembershipModalPage_it.properties","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/console%2Fsrc%2Fmain%2Fresources%2Forg%2Fsyncope%2Fconsole%2Fpages%2FMembershipModalPage_it.properties?ref=6317d431ba6b1dc4d959a1d39e178124dd58f967","patch":"@@ -1,6 +1,12 @@\n tab1=Attributi\n+tab2=Attributi derivati\n title=Ruoli\n add=+\n drop=-\n edit=Edit\n delete=Delete\n+derivedAttributes=Attributi derivati\n+derivedAttributeToBeRemoved=Elimina\n+derivedAttributeName=Nome\n+derivedAttributeValue=Valore derivato\n+addDerivedAttributeBtn=Aggiungi"},{"sha":"c6903ce0e30eca96273ffa5e540fb82db8fa91ea","filename":"console/src/main/resources/org/syncope/console/pages/RoleModalPage.html","status":"modified","additions":47,"deletions":0,"changes":47,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/6317d431ba6b1dc4d959a1d39e178124dd58f967/console%2Fsrc%2Fmain%2Fresources%2Forg%2Fsyncope%2Fconsole%2Fpages%2FRoleModalPage.html","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/6317d431ba6b1dc4d959a1d39e178124dd58f967/console%2Fsrc%2Fmain%2Fresources%2Forg%2Fsyncope%2Fconsole%2Fpages%2FRoleModalPage.html","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/console%2Fsrc%2Fmain%2Fresources%2Forg%2Fsyncope%2Fconsole%2Fpages%2FRoleModalPage.html?ref=6317d431ba6b1dc4d959a1d39e178124dd58f967","patch":"@@ -14,6 +14,9 @@\n -->\n <wicket:head>\n     <style type=\"text/css\">\n+        #tabs-2 table{\n+            font-size: 1.1em;\n+        }\n         #tabs-3 table{\n             font-size: 1.1em;\n         }\n@@ -32,6 +35,7 @@\n             <div id=\"tabs\">\n                 <ul>\n                     <li><a href=\"#tabs-1\"><span><wicket:message key=\"tab1\"/></span></a></li>\n+                    <li><a href=\"#tabs-2\"><span><wicket:message key=\"tab2\"/></span></a></li>\n                     <li><a href=\"#tabs-3\"><span><wicket:message key=\"tab3\"/></span></a></li>\n                     <li><a href=\"#tabs-4\"><span><wicket:message key=\"tab4\"/></span></a></li>\n                 </ul>\n@@ -65,6 +69,49 @@\n                         </script>\n                     </table>\n                 </div>\n+\n+                <div id=\"tabs-2\">\n+                    <table id=\"derivedAttributes\"\n+                           class=\"ui-widget ui-widget-content ui-corner-all\"\n+                           style=\"font-size: 1em;margin-top:2px;\"\n+                           width=\"100%\" cellpadding=\"2px\" cellspacing=\"1px\">\n+                        <thead>\n+                            <tr class=\"ui-widget-header\">\n+                                <th><wicket:message key=\"derivedAttributeToBeRemoved\"/></th>\n+                        <th><wicket:message key=\"derivedAttributeName\"/></th>\n+                        <th><wicket:message key=\"derivedAttributeValue\"/></th>\n+                        </tr>\n+                        </thead>\n+\n+                        <tfoot>\n+                            <tr>\n+                                <td>\n+                                    <input type=\"submit\" class=\"ui-button ui-widget ui-state-default ui-corner-all ui-button-text-only\"\n+                                           wicket:id=\"addDerivedAttributeBtn\" />\n+                                </td>\n+                            </tr>\n+                        </tfoot>\n+\n+                        <tbody wicket:id=\"derivedAttributesContainer\">\n+                            <tr wicket:id=\"derivedAttributes\">\n+                                <td align=\"center\" valign=\"middle\">\n+                                    <input type=\"checkbox\" class=\"text ui-widget-content ui-corner-all\"  wicket:id=\"toRemove\"/>\n+                                </td>\n+\n+                                <td>\n+                                    <select class=\"text ui-widget-content ui-corner-all\"\n+                                            style=\"width:100%\" wicket:id=\"schema\"/>\n+                                </td>\n+\n+                                <td align=\"center\" valign=\"middle\">\n+                                    <input type=\"text\" class=\"text ui-widget-content ui-corner-all\"  wicket:id=\"derivedAttributeValue\"/>\n+                                </td>\n+                            </tr>\n+                        </tbody>\n+                    </table>\n+\n+                </div>\n+\n                 <div id=\"tabs-3\">\n                     <span wicket:id=\"resourcesPalette\"/>\n                 </div>"},{"sha":"94ff84889d431b88fd03dcb0b7cab1ae281b6bd6","filename":"console/src/main/resources/org/syncope/console/pages/RoleModalPage.properties","status":"modified","additions":6,"deletions":0,"changes":6,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/6317d431ba6b1dc4d959a1d39e178124dd58f967/console%2Fsrc%2Fmain%2Fresources%2Forg%2Fsyncope%2Fconsole%2Fpages%2FRoleModalPage.properties","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/6317d431ba6b1dc4d959a1d39e178124dd58f967/console%2Fsrc%2Fmain%2Fresources%2Forg%2Fsyncope%2Fconsole%2Fpages%2FRoleModalPage.properties","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/console%2Fsrc%2Fmain%2Fresources%2Forg%2Fsyncope%2Fconsole%2Fpages%2FRoleModalPage.properties?ref=6317d431ba6b1dc4d959a1d39e178124dd58f967","patch":"@@ -1,6 +1,7 @@\n required_alert=All form fields are required.\n title=Role\n tab1=Attributes\n+tab2=Derived attributes\n tab3=Resources\n tab4=Entitlements\n add=+\n@@ -11,3 +12,8 @@ firstResourcesList=Role's resources\n secondResourcesList=Available resources\n firstEntitlementsList=Role's entitlements\n secondEntitlementsList=Available entitlements\n+derivedAttributes=Derived Attributes\n+derivedAttributeToBeRemoved=Delete\n+derivedAttributeName=Name\n+derivedAttributeValue=Derived value\n+addDerivedAttributeBtn=Add"},{"sha":"c3ec3be2ff0f38da7ed4c2ad7ebb9e2ee5af4f24","filename":"console/src/main/resources/org/syncope/console/pages/RoleModalPage_it.properties","status":"modified","additions":6,"deletions":0,"changes":6,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/6317d431ba6b1dc4d959a1d39e178124dd58f967/console%2Fsrc%2Fmain%2Fresources%2Forg%2Fsyncope%2Fconsole%2Fpages%2FRoleModalPage_it.properties","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/6317d431ba6b1dc4d959a1d39e178124dd58f967/console%2Fsrc%2Fmain%2Fresources%2Forg%2Fsyncope%2Fconsole%2Fpages%2FRoleModalPage_it.properties","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/console%2Fsrc%2Fmain%2Fresources%2Forg%2Fsyncope%2Fconsole%2Fpages%2FRoleModalPage_it.properties?ref=6317d431ba6b1dc4d959a1d39e178124dd58f967","patch":"@@ -1,6 +1,7 @@\n required_alert=All form fields are required.\n title=Ruolo\n tab1=Attributi\n+tab2=Attributi derivati\n tab3=Risorse\n tab4=Entitlement\n add=+\n@@ -11,3 +12,8 @@ firstResourcesList=Risorse ruolo\n secondResourcesList=Risorse disponibili\n firstResourcesList=Entitlement ruolo\n secondResourcesList=Entitlement disponibili\n+derivedAttributes=Attributi derivati\n+derivedAttributeToBeRemoved=Elimina\n+derivedAttributeName=Nome\n+derivedAttributeValue=Valore derivato\n+addDerivedAttributeBtn=Aggiungi"},{"sha":"49bd469f54eb6a98eda73149215e1afdf340ecf3","filename":"console/src/main/resources/org/syncope/console/pages/UserModalPage.html","status":"modified","additions":48,"deletions":0,"changes":48,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/6317d431ba6b1dc4d959a1d39e178124dd58f967/console%2Fsrc%2Fmain%2Fresources%2Forg%2Fsyncope%2Fconsole%2Fpages%2FUserModalPage.html","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/6317d431ba6b1dc4d959a1d39e178124dd58f967/console%2Fsrc%2Fmain%2Fresources%2Forg%2Fsyncope%2Fconsole%2Fpages%2FUserModalPage.html","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/console%2Fsrc%2Fmain%2Fresources%2Forg%2Fsyncope%2Fconsole%2Fpages%2FUserModalPage.html?ref=6317d431ba6b1dc4d959a1d39e178124dd58f967","patch":"@@ -30,6 +30,11 @@\n             border-radius: 3px; /* Standard CSS */\n         }\n \n+        #tabs-2 table{\n+            font-size: 1.1em;\n+        }\n+\n+\n         #tabs-3 table{\n             font-size: 1.1em;\n         }\n@@ -50,6 +55,7 @@\n             <div id=\"tabs\">\n                 <ul>\n                     <li  class=\"tabs-selected\"><a href=\"#tabs-1\"><span><wicket:message key=\"tab1\"/></span></a></li>\n+                    <li><a href=\"#tabs-2\"><span><wicket:message key=\"tab2\"/></span></a></li>\n                     <li><a href=\"#tabs-3\"><span><wicket:message key=\"tab3\"/></span></a></li>\n                     <li><a href=\"#tabs-4\"><span><wicket:message key=\"tab4\"/></span></a></li>\n                 </ul>\n@@ -85,11 +91,53 @@\n                     </table>\n                 </div>\n \n+                <div id=\"tabs-2\">\n+                    <table id=\"derivedAttributes\"\n+                           class=\"ui-widget ui-widget-content ui-corner-all\"\n+                           style=\"font-size: 1em;margin-top:2px;\"\n+                           width=\"100%\" cellpadding=\"2px\" cellspacing=\"1px\">\n+                        <thead>\n+                            <tr class=\"ui-widget-header\">\n+                                <th><wicket:message key=\"derivedAttributeToBeRemoved\"/></th>\n+                        <th><wicket:message key=\"derivedAttributeName\"/></th>\n+                        <th><wicket:message key=\"derivedAttributeValue\"/></th>\n+                        </tr>\n+                        </thead>\n+\n+                        <tfoot>\n+                            <tr>\n+                                <td>\n+                                    <input type=\"submit\" class=\"ui-button ui-widget ui-state-default ui-corner-all ui-button-text-only\"\n+                                           wicket:id=\"addDerivedAttributeBtn\" />\n+                                </td>\n+                            </tr>\n+                        </tfoot>\n+\n+                        <tbody wicket:id=\"derivedAttributesContainer\">\n+                            <tr wicket:id=\"derivedAttributes\">\n+                                <td align=\"center\" valign=\"middle\">\n+                                    <input type=\"checkbox\" class=\"text ui-widget-content ui-corner-all\"  wicket:id=\"toRemove\"/>\n+                                </td>\n+\n+                                <td>\n+                                    <select class=\"text ui-widget-content ui-corner-all\"\n+                                            style=\"width:100%\" wicket:id=\"schema\"/>\n+                                </td>\n+\n+                                <td align=\"center\" valign=\"middle\">\n+                                    <input type=\"text\" class=\"text ui-widget-content ui-corner-all\"  wicket:id=\"derivedAttributeValue\"/>\n+                                </td>\n+                            </tr>\n+                        </tbody>\n+                    </table>\n+                </div>\n+\n                 <div id=\"tabs-3\">\n \n                     <span wicket:id=\"resourcesPalette\"/>\n \n                 </div>\n+\n                 <div id=\"tabs-4\">\n                     <p class=\"ui-widget ui-corner-all ui-widget-header\">\n                     <wicket:message key=\"membership_availability\"/>"},{"sha":"90bb7c90ae926714d66e658caee8c701235f648a","filename":"console/src/main/resources/org/syncope/console/pages/UserModalPage.properties","status":"modified","additions":6,"deletions":1,"changes":7,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/6317d431ba6b1dc4d959a1d39e178124dd58f967/console%2Fsrc%2Fmain%2Fresources%2Forg%2Fsyncope%2Fconsole%2Fpages%2FUserModalPage.properties","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/6317d431ba6b1dc4d959a1d39e178124dd58f967/console%2Fsrc%2Fmain%2Fresources%2Forg%2Fsyncope%2Fconsole%2Fpages%2FUserModalPage.properties","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/console%2Fsrc%2Fmain%2Fresources%2Forg%2Fsyncope%2Fconsole%2Fpages%2FUserModalPage.properties?ref=6317d431ba6b1dc4d959a1d39e178124dd58f967","patch":"@@ -4,7 +4,7 @@ password=password\n firstname=Firstname\n surname=Surname\n tab1=Attributes\n-tab2=User derived attributes\n+tab2=Derived attributes\n tab3=Resources\n tab4=Roles\n add=+\n@@ -21,3 +21,8 @@ edit=Edit\n delete=Delete\n membership_text=Selected roles\n membership_availability=Roles available\n+derivedAttributes=Derived Attributes\n+derivedAttributeToBeRemoved=Delete\n+derivedAttributeName=Name\n+derivedAttributeValue=Derived value\n+addDerivedAttributeBtn=Add"},{"sha":"8f35b85cae089acb51ceff8d3571cec8d142f6ce","filename":"console/src/main/resources/org/syncope/console/pages/UserModalPage_it.properties","status":"modified","additions":7,"deletions":1,"changes":8,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/6317d431ba6b1dc4d959a1d39e178124dd58f967/console%2Fsrc%2Fmain%2Fresources%2Forg%2Fsyncope%2Fconsole%2Fpages%2FUserModalPage_it.properties","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/6317d431ba6b1dc4d959a1d39e178124dd58f967/console%2Fsrc%2Fmain%2Fresources%2Forg%2Fsyncope%2Fconsole%2Fpages%2FUserModalPage_it.properties","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/console%2Fsrc%2Fmain%2Fresources%2Forg%2Fsyncope%2Fconsole%2Fpages%2FUserModalPage_it.properties?ref=6317d431ba6b1dc4d959a1d39e178124dd58f967","patch":"@@ -4,7 +4,7 @@ password=password\n firstname=Nome\n surname=Cognome\n tab1=Attributi\n-tab2=Attributi utente derivati\n+tab2=Attributi derivati\n tab3=Risorse\n tab4=Ruoli\n add=+\n@@ -21,3 +21,9 @@ delete=Elimina\n membership_text=Ruoli selezionati\n membership_availability=Ruoli disponibili\n name=Nome Ruolo\n+derivedAttributes=Attributi derivati\n+derivedAttributeToBeRemoved=Elimina\n+derivedAttributeName=Nome\n+derivedAttributeValue=Valore derivato\n+addDerivedAttributeBtn=Aggiungi\n+"},{"sha":"746ff464020599089b28c48731c5a8dec869dfab","filename":"core/src/main/java/org/syncope/core/persistence/beans/AbstractDerSchema.java","status":"modified","additions":0,"deletions":8,"changes":8,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/6317d431ba6b1dc4d959a1d39e178124dd58f967/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fcore%2Fpersistence%2Fbeans%2FAbstractDerSchema.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/6317d431ba6b1dc4d959a1d39e178124dd58f967/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fcore%2Fpersistence%2Fbeans%2FAbstractDerSchema.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fcore%2Fpersistence%2Fbeans%2FAbstractDerSchema.java?ref=6317d431ba6b1dc4d959a1d39e178124dd58f967","patch":"@@ -51,12 +51,4 @@ public void setExpression(String expression) {\n     public abstract List<? extends AbstractDerAttr> getDerivedAttributes();\n \n     public abstract <T extends AbstractDerAttr> void setDerivedAttributes(List<T> derivedAttributes);\n-\n-    public abstract boolean addMapping(SchemaMapping mapping);\n-\n-    public abstract boolean removeMapping(SchemaMapping mapping);\n-\n-    public abstract List<SchemaMapping> getMappings();\n-\n-    public abstract void setMappings(List<SchemaMapping> mappings);\n }"},{"sha":"41f40c7d9403021497bd422210bf9af74e8a1151","filename":"core/src/main/java/org/syncope/core/persistence/beans/membership/MDerSchema.java","status":"modified","additions":0,"deletions":39,"changes":39,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/6317d431ba6b1dc4d959a1d39e178124dd58f967/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fcore%2Fpersistence%2Fbeans%2Fmembership%2FMDerSchema.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/6317d431ba6b1dc4d959a1d39e178124dd58f967/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fcore%2Fpersistence%2Fbeans%2Fmembership%2FMDerSchema.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fcore%2Fpersistence%2Fbeans%2Fmembership%2FMDerSchema.java?ref=6317d431ba6b1dc4d959a1d39e178124dd58f967","patch":"@@ -15,13 +15,11 @@\n package org.syncope.core.persistence.beans.membership;\n \n import java.util.ArrayList;\n-import java.util.Collections;\n import java.util.List;\n import javax.persistence.Entity;\n import javax.persistence.OneToMany;\n import org.syncope.core.persistence.beans.AbstractDerAttr;\n import org.syncope.core.persistence.beans.AbstractDerSchema;\n-import org.syncope.core.persistence.beans.SchemaMapping;\n \n @Entity\n public class MDerSchema extends AbstractDerSchema {\n@@ -58,41 +56,4 @@ public <T extends AbstractDerAttr> void setDerivedAttributes(\n \n         this.derivedAttributes = (List<MDerAttr>) derivedAttributes;\n     }\n-\n-    /**\n-     * TODO: https://code.google.com/p/syncope/issues/detail?id=27\n-     * @param mapping\n-     * @return\n-     */\n-    @Override\n-    public boolean addMapping(SchemaMapping mapping) {\n-        return true;\n-    }\n-\n-    /**\n-     * TODO: https://code.google.com/p/syncope/issues/detail?id=27\n-     * @param mapping\n-     * @return\n-     */\n-    @Override\n-    public boolean removeMapping(SchemaMapping mapping) {\n-        return true;\n-    }\n-\n-    /**\n-     * TODO: https://code.google.com/p/syncope/issues/detail?id=27\n-     * @return\n-     */\n-    @Override\n-    public List<SchemaMapping> getMappings() {\n-        return Collections.EMPTY_LIST;\n-    }\n-\n-    /**\n-     * TODO: https://code.google.com/p/syncope/issues/detail?id=27\n-     * @param mappings\n-     */\n-    @Override\n-    public void setMappings(List<SchemaMapping> mappings) {\n-    }\n }"},{"sha":"c38c9f0d5a6fa7973d6bbb66fe6eada202ceafcd","filename":"core/src/main/java/org/syncope/core/persistence/beans/role/RDerSchema.java","status":"modified","additions":0,"deletions":39,"changes":39,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/6317d431ba6b1dc4d959a1d39e178124dd58f967/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fcore%2Fpersistence%2Fbeans%2Frole%2FRDerSchema.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/6317d431ba6b1dc4d959a1d39e178124dd58f967/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fcore%2Fpersistence%2Fbeans%2Frole%2FRDerSchema.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fcore%2Fpersistence%2Fbeans%2Frole%2FRDerSchema.java?ref=6317d431ba6b1dc4d959a1d39e178124dd58f967","patch":"@@ -15,13 +15,11 @@\n package org.syncope.core.persistence.beans.role;\n \n import java.util.ArrayList;\n-import java.util.Collections;\n import java.util.List;\n import javax.persistence.Entity;\n import javax.persistence.OneToMany;\n import org.syncope.core.persistence.beans.AbstractDerAttr;\n import org.syncope.core.persistence.beans.AbstractDerSchema;\n-import org.syncope.core.persistence.beans.SchemaMapping;\n \n @Entity\n public class RDerSchema extends AbstractDerSchema {\n@@ -58,41 +56,4 @@ public <T extends AbstractDerAttr> void setDerivedAttributes(\n \n         this.derivedAttributes = (List<RDerAttr>) derivedAttributes;\n     }\n-\n-    /**\n-     * TODO: https://code.google.com/p/syncope/issues/detail?id=27\n-     * @param mapping\n-     * @return\n-     */\n-    @Override\n-    public boolean addMapping(SchemaMapping mapping) {\n-        return true;\n-    }\n-\n-    /**\n-     * TODO: https://code.google.com/p/syncope/issues/detail?id=27\n-     * @param mapping\n-     * @return\n-     */\n-    @Override\n-    public boolean removeMapping(SchemaMapping mapping) {\n-        return true;\n-    }\n-\n-    /**\n-     * TODO: https://code.google.com/p/syncope/issues/detail?id=27\n-     * @return\n-     */\n-    @Override\n-    public List<SchemaMapping> getMappings() {\n-        return Collections.EMPTY_LIST;\n-    }\n-\n-    /**\n-     * TODO: https://code.google.com/p/syncope/issues/detail?id=27\n-     * @param mappings\n-     */\n-    @Override\n-    public void setMappings(List<SchemaMapping> mappings) {\n-    }\n }"},{"sha":"ed470100404bc0c7e368cdf1b4418ca4d8b0d4c0","filename":"core/src/main/java/org/syncope/core/persistence/beans/user/UDerSchema.java","status":"modified","additions":0,"deletions":39,"changes":39,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/6317d431ba6b1dc4d959a1d39e178124dd58f967/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fcore%2Fpersistence%2Fbeans%2Fuser%2FUDerSchema.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/6317d431ba6b1dc4d959a1d39e178124dd58f967/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fcore%2Fpersistence%2Fbeans%2Fuser%2FUDerSchema.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fcore%2Fpersistence%2Fbeans%2Fuser%2FUDerSchema.java?ref=6317d431ba6b1dc4d959a1d39e178124dd58f967","patch":"@@ -15,13 +15,11 @@\n package org.syncope.core.persistence.beans.user;\n \n import java.util.ArrayList;\n-import java.util.Collections;\n import java.util.List;\n import javax.persistence.Entity;\n import javax.persistence.OneToMany;\n import org.syncope.core.persistence.beans.AbstractDerAttr;\n import org.syncope.core.persistence.beans.AbstractDerSchema;\n-import org.syncope.core.persistence.beans.SchemaMapping;\n \n @Entity\n public class UDerSchema extends AbstractDerSchema {\n@@ -58,41 +56,4 @@ public <T extends AbstractDerAttr> void setDerivedAttributes(\n \n         this.derivedAttributes = (List<UDerAttr>) derivedAttributes;\n     }\n-\n-    /**\n-     * TODO: https://code.google.com/p/syncope/issues/detail?id=27\n-     * @param mapping\n-     * @return\n-     */\n-    @Override\n-    public boolean addMapping(SchemaMapping mapping) {\n-        return true;\n-    }\n-\n-    /**\n-     * TODO: https://code.google.com/p/syncope/issues/detail?id=27\n-     * @param mapping\n-     * @return\n-     */\n-    @Override\n-    public boolean removeMapping(SchemaMapping mapping) {\n-        return true;\n-    }\n-\n-    /**\n-     * TODO: https://code.google.com/p/syncope/issues/detail?id=27\n-     * @return\n-     */\n-    @Override\n-    public List<SchemaMapping> getMappings() {\n-        return Collections.EMPTY_LIST;\n-    }\n-\n-    /**\n-     * TODO: https://code.google.com/p/syncope/issues/detail?id=27\n-     * @param mappings\n-     */\n-    @Override\n-    public void setMappings(List<SchemaMapping> mappings) {\n-    }\n }"},{"sha":"563bf01cd5d68edfd277e969225ce4f77a8373c6","filename":"core/src/main/java/org/syncope/core/persistence/dao/DerSchemaDAO.java","status":"modified","additions":2,"deletions":2,"changes":4,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/6317d431ba6b1dc4d959a1d39e178124dd58f967/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fcore%2Fpersistence%2Fdao%2FDerSchemaDAO.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/6317d431ba6b1dc4d959a1d39e178124dd58f967/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fcore%2Fpersistence%2Fdao%2FDerSchemaDAO.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fcore%2Fpersistence%2Fdao%2FDerSchemaDAO.java?ref=6317d431ba6b1dc4d959a1d39e178124dd58f967","patch":"@@ -17,6 +17,7 @@\n import java.util.List;\n import org.syncope.core.persistence.beans.AbstractDerSchema;\n import org.syncope.core.persistence.validation.entity.InvalidEntityException;\n+import org.syncope.core.util.AttributableUtil;\n \n public interface DerSchemaDAO extends DAO {\n \n@@ -27,6 +28,5 @@ public interface DerSchemaDAO extends DAO {\n     <T extends AbstractDerSchema> T save(T derivedSchema)\n             throws InvalidEntityException;\n \n-    <T extends AbstractDerSchema> void delete(\n-            String name, Class<T> reference);\n+    void delete(String name, AttributableUtil attributableUtil);\n }"},{"sha":"4c4a06bdf7b8db3d0a449397a7ea6ae39f27fad2","filename":"core/src/main/java/org/syncope/core/persistence/dao/impl/DerSchemaDAOImpl.java","status":"modified","additions":17,"deletions":4,"changes":21,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/6317d431ba6b1dc4d959a1d39e178124dd58f967/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fcore%2Fpersistence%2Fdao%2Fimpl%2FDerSchemaDAOImpl.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/6317d431ba6b1dc4d959a1d39e178124dd58f967/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fcore%2Fpersistence%2Fdao%2Fimpl%2FDerSchemaDAOImpl.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fcore%2Fpersistence%2Fdao%2Fimpl%2FDerSchemaDAOImpl.java?ref=6317d431ba6b1dc4d959a1d39e178124dd58f967","patch":"@@ -24,13 +24,18 @@\n import org.syncope.core.persistence.beans.AbstractDerSchema;\n import org.syncope.core.persistence.dao.DerAttrDAO;\n import org.syncope.core.persistence.dao.DerSchemaDAO;\n+import org.syncope.core.persistence.dao.ResourceDAO;\n+import org.syncope.core.util.AttributableUtil;\n \n @Repository\n public class DerSchemaDAOImpl extends AbstractDAOImpl implements DerSchemaDAO {\n \n     @Autowired\n     private DerAttrDAO derivedAttributeDAO;\n \n+    @Autowired\n+    private ResourceDAO resourceDAO;\n+\n     @Override\n     public <T extends AbstractDerSchema> T find(final String name,\n             final Class<T> reference) {\n@@ -53,27 +58,35 @@ public <T extends AbstractDerSchema> T save(final T derivedSchema) {\n     }\n \n     @Override\n-    public <T extends AbstractDerSchema> void delete(final String name,\n-            final Class<T> reference) {\n+    public void delete(final String name,\n+            final AttributableUtil attributableUtil) {\n+\n+        final AbstractDerSchema derivedSchema =\n+                find(name, attributableUtil.derivedSchemaClass());\n \n-        T derivedSchema = find(name, reference);\n         if (derivedSchema == null) {\n             return;\n         }\n \n-        Set<Long> derivedAttributeIds =\n+        final Set<Long> derivedAttributeIds =\n                 new HashSet<Long>(derivedSchema.getDerivedAttributes().size());\n+\n         Class attributeClass = null;\n+\n         for (AbstractDerAttr attribute :\n                 derivedSchema.getDerivedAttributes()) {\n \n             derivedAttributeIds.add(attribute.getId());\n             attributeClass = attribute.getClass();\n         }\n+\n         for (Long derivedAttributeId : derivedAttributeIds) {\n             derivedAttributeDAO.delete(derivedAttributeId, attributeClass);\n         }\n \n+        resourceDAO.deleteMappings(\n+                name, attributableUtil.derivedSourceMappingType());\n+\n         entityManager.remove(derivedSchema);\n     }\n }"},{"sha":"624443ec081470cfc4a6b27ea3f0277233428419","filename":"core/src/main/java/org/syncope/core/persistence/propagation/PropagationManager.java","status":"modified","additions":76,"deletions":10,"changes":86,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/6317d431ba6b1dc4d959a1d39e178124dd58f967/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fcore%2Fpersistence%2Fpropagation%2FPropagationManager.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/6317d431ba6b1dc4d959a1d39e178124dd58f967/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fcore%2Fpersistence%2Fpropagation%2FPropagationManager.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fcore%2Fpersistence%2Fpropagation%2FPropagationManager.java?ref=6317d431ba6b1dc4d959a1d39e178124dd58f967","patch":"@@ -38,6 +38,7 @@\n import org.springframework.beans.factory.annotation.Autowired;\n import org.syncope.core.persistence.ConnInstanceLoader;\n import org.syncope.core.persistence.beans.AbstractAttrValue;\n+import org.syncope.core.persistence.beans.AbstractDerSchema;\n import org.syncope.core.persistence.beans.AbstractSchema;\n import org.syncope.core.persistence.beans.ConnInstance;\n import org.syncope.core.persistence.beans.TargetResource;\n@@ -50,7 +51,9 @@\n import org.syncope.core.persistence.beans.user.SyncopeUser;\n import org.syncope.core.persistence.beans.user.UAttr;\n import org.syncope.core.persistence.beans.user.UAttrValue;\n+import org.syncope.core.persistence.beans.user.UDerAttr;\n import org.syncope.core.persistence.beans.user.USchema;\n+import org.syncope.core.persistence.dao.DerSchemaDAO;\n import org.syncope.core.persistence.dao.SchemaDAO;\n import org.syncope.core.persistence.dao.TaskDAO;\n import org.syncope.core.persistence.dao.TaskExecutionDAO;\n@@ -80,6 +83,12 @@ public class PropagationManager {\n     @Autowired\n     private SchemaDAO schemaDAO;\n \n+    /**\n+     * Derived Schema DAO.\n+     */\n+    @Autowired\n+    private DerSchemaDAO derSchemaDAO;\n+\n     /**\n      * Task DAO.\n      */\n@@ -307,6 +316,17 @@ private Class getSourceMappingTypeClass(\n             case MembershipSchema:\n                 result = MSchema.class;\n \n+            case UserDerivedSchema:\n+                result = USchema.class;\n+                break;\n+\n+            case RoleDerivedSchema:\n+                result = RSchema.class;\n+                break;\n+\n+            case MembershipDerivedSchema:\n+                result = MSchema.class;\n+\n             default:\n                 result = null;\n         }\n@@ -336,7 +356,11 @@ private Map<String, Set<Attribute>> prepareAttributes(SyncopeUser user,\n \n         // syncope user attribute\n         UAttr attr;\n+        UDerAttr derAttr;\n+\n         AbstractSchema schema;\n+        AbstractDerSchema derSchema;\n+\n         // syncope user attribute schema type\n         SchemaType schemaType = null;\n         // syncope user attribute values\n@@ -345,17 +369,26 @@ private Map<String, Set<Attribute>> prepareAttributes(SyncopeUser user,\n         for (SchemaMapping mapping : resource.getMappings()) {\n             LOG.debug(\"Processing schema {}\", mapping.getSourceAttrName());\n \n+            schema = null;\n+            derSchema = null;\n+            values = null;\n+\n             try {\n                 switch (mapping.getSourceMappingType()) {\n                     case UserSchema:\n                     case RoleSchema:\n                     case MembershipSchema:\n-                        schema = schemaDAO.find(mapping.getSourceAttrName(),\n+\n+                        schema = schemaDAO.find(\n+                                mapping.getSourceAttrName(),\n                                 getSourceMappingTypeClass(\n                                 mapping.getSourceMappingType()));\n+\n+\n                         schemaType = schema.getType();\n \n-                        attr = user.getAttribute(mapping.getSourceAttrName());\n+                        attr = user.getAttribute(\n+                                mapping.getSourceAttrName());\n \n                         values = attr != null\n                                 ? (schema.isUniqueConstraint()\n@@ -364,14 +397,50 @@ private Map<String, Set<Attribute>> prepareAttributes(SyncopeUser user,\n                                 : attr.getValues())\n                                 : Collections.EMPTY_LIST;\n \n-                        LOG.debug(\"Retrieved attribute {}\"\n+                        LOG.debug(\"Retrieved attribute {}\", attr\n+                                + \"\\n* SourceAttrName {}\"\n+                                + \"\\n* SourceMappingType {}\"\n+                                + \"\\n* Attribute values {}\",\n+                                new Object[]{\n+                                    mapping.getSourceAttrName(),\n+                                    mapping.getSourceMappingType(),\n+                                    values});\n+                        break;\n+\n+                    case UserDerivedSchema:\n+                    case RoleDerivedSchema:\n+                    case MembershipDerivedSchema:\n+\n+                        derSchema = derSchemaDAO.find(\n+                                mapping.getSourceAttrName(),\n+                                getSourceMappingTypeClass(\n+                                mapping.getSourceMappingType()));\n+\n+                        schemaType = SchemaType.String;\n+\n+                        derAttr = user.getDerivedAttribute(\n+                                mapping.getSourceAttrName());\n+\n+                        if (derAttr != null) {\n+                            AbstractAttrValue value = new UAttrValue();\n+                            value.setStringValue(\n+                                    derAttr.getValue(user.getAttributes()));\n+\n+                            values = Collections.singletonList(value);\n+                        } else {\n+                            values = Collections.EMPTY_LIST;\n+                        }\n+\n+\n+                        LOG.debug(\"Retrieved attribute {}\", derAttr\n                                 + \"\\n* SourceAttrName {}\"\n                                 + \"\\n* SourceMappingType {}\"\n                                 + \"\\n* Attribute values {}\",\n-                                new Object[]{attr,\n+                                new Object[]{\n                                     mapping.getSourceAttrName(),\n                                     mapping.getSourceMappingType(),\n                                     values});\n+\n                         break;\n \n                     case SyncopeUserId:\n@@ -381,13 +450,11 @@ private Map<String, Set<Attribute>> prepareAttributes(SyncopeUser user,\n \n                         AbstractAttrValue uAttrValue = new UAttrValue();\n \n-                        if (SourceMappingType.SyncopeUserId == mapping.\n-                                getSourceMappingType()) {\n+                        if (SourceMappingType.SyncopeUserId == mapping.getSourceMappingType()) {\n \n                             uAttrValue.setStringValue(user.getId().toString());\n                         }\n-                        if (SourceMappingType.Password == mapping.\n-                                getSourceMappingType()\n+                        if (SourceMappingType.Password == mapping.getSourceMappingType()\n                                 && password != null) {\n \n                             uAttrValue.setStringValue(password);\n@@ -397,8 +464,7 @@ private Map<String, Set<Attribute>> prepareAttributes(SyncopeUser user,\n                         break;\n \n                     default:\n-                        schema = null;\n-                        values = null;\n+                        break;\n                 }\n \n                 if (LOG.isDebugEnabled()) {"},{"sha":"9960b837ae92a5e764b41299aa915a5803db0fa2","filename":"core/src/main/java/org/syncope/core/rest/controller/DerivedSchemaController.java","status":"modified","additions":2,"deletions":1,"changes":3,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/6317d431ba6b1dc4d959a1d39e178124dd58f967/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fcore%2Frest%2Fcontroller%2FDerivedSchemaController.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/6317d431ba6b1dc4d959a1d39e178124dd58f967/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fcore%2Frest%2Fcontroller%2FDerivedSchemaController.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fcore%2Frest%2Fcontroller%2FDerivedSchemaController.java?ref=6317d431ba6b1dc4d959a1d39e178124dd58f967","patch":"@@ -78,7 +78,8 @@ public void delete(HttpServletResponse response,\n \n             throw new NotFoundException(derivedSchemaName);\n         } else {\n-            derivedSchemaDAO.delete(derivedSchemaName, reference);\n+            derivedSchemaDAO.delete(\n+                    derivedSchemaName, getAttributableUtil(kind));\n         }\n     }\n "},{"sha":"ab0e459645b68b642c948608ed8969f5cd8aee1e","filename":"core/src/main/java/org/syncope/core/rest/controller/SchemaController.java","status":"modified","additions":5,"deletions":0,"changes":5,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/6317d431ba6b1dc4d959a1d39e178124dd58f967/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fcore%2Frest%2Fcontroller%2FSchemaController.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/6317d431ba6b1dc4d959a1d39e178124dd58f967/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fcore%2Frest%2Fcontroller%2FSchemaController.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fcore%2Frest%2Fcontroller%2FSchemaController.java?ref=6317d431ba6b1dc4d959a1d39e178124dd58f967","patch":"@@ -27,8 +27,10 @@\n import org.springframework.web.bind.annotation.RequestMethod;\n import org.syncope.client.to.SchemaTO;\n import org.syncope.client.validation.SyncopeClientCompositeErrorException;\n+import org.syncope.core.persistence.beans.AbstractDerSchema;\n import org.syncope.core.rest.data.SchemaDataBinder;\n import org.syncope.core.persistence.beans.AbstractSchema;\n+import org.syncope.core.persistence.dao.DerSchemaDAO;\n import org.syncope.core.persistence.dao.SchemaDAO;\n import org.syncope.core.util.AttributableUtil;\n \n@@ -39,6 +41,9 @@ public class SchemaController extends AbstractController {\n     @Autowired\n     private SchemaDAO schemaDAO;\n \n+    @Autowired\n+    private DerSchemaDAO derSchemaDAO;\n+\n     @Autowired\n     private SchemaDataBinder schemaDataBinder;\n "},{"sha":"00af2461067b71fb71d8fddfcedeff5defde71f8","filename":"core/src/main/java/org/syncope/core/rest/data/AbstractAttributableDataBinder.java","status":"modified","additions":32,"deletions":9,"changes":41,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/6317d431ba6b1dc4d959a1d39e178124dd58f967/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fcore%2Frest%2Fdata%2FAbstractAttributableDataBinder.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/6317d431ba6b1dc4d959a1d39e178124dd58f967/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fcore%2Frest%2Fdata%2FAbstractAttributableDataBinder.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fcore%2Frest%2Fdata%2FAbstractAttributableDataBinder.java?ref=6317d431ba6b1dc4d959a1d39e178124dd58f967","patch":"@@ -414,23 +414,41 @@ protected ResourceOperations fill(\n \n             derivedSchema = getDerivedSchema(derivedAttributeToBeRemoved,\n                     attributableUtil.derivedSchemaClass());\n+\n             if (derivedSchema != null) {\n-                for (SchemaMapping mapping : derivedSchema.getMappings()) {\n-                    if (mapping.getResource() != null\n-                            && resources.contains(mapping.getResource())) {\n-                        resourceOperations.add(ResourceOperationType.UPDATE,\n-                                mapping.getResource());\n-                    }\n-                }\n \n                 derivedAttribute = attributable.getDerivedAttribute(\n                         derivedSchema.getName());\n+\n                 if (derivedAttribute == null) {\n                     LOG.debug(\"No derived attribute found for schema {}\",\n                             derivedSchema.getName());\n                 } else {\n                     derivedAttributeDAO.delete(derivedAttribute);\n                 }\n+\n+                for (SchemaMapping mapping : resourceDAO.findAllMappings()) {\n+                    if (mapping.getSourceAttrName().equals(\n+                            derivedSchema.getName())\n+                            && mapping.getSourceMappingType()\n+                            == attributableUtil.derivedSourceMappingType()\n+                            && mapping.getResource() != null\n+                            && resources.contains(mapping.getResource())) {\n+\n+                        resourceOperations.add(ResourceOperationType.UPDATE,\n+                                mapping.getResource());\n+\n+                        if (mapping.isAccountid() && derivedAttribute != null\n+                                && !derivedAttribute.getValue(\n+                                attributable.getAttributes()).isEmpty()) {\n+\n+                            resourceOperations.addOldAccountId(\n+                                    mapping.getResource().getName(),\n+                                    derivedAttribute.getValue(\n+                                    attributable.getAttributes()));\n+                        }\n+                    }\n+                }\n             }\n         }\n \n@@ -443,9 +461,14 @@ protected ResourceOperations fill(\n \n             derivedSchema = getDerivedSchema(derivedAttributeToBeAdded,\n                     attributableUtil.derivedSchemaClass());\n+\n             if (derivedSchema != null) {\n-                for (SchemaMapping mapping : derivedSchema.getMappings()) {\n-                    if (mapping.getResource() != null\n+                for (SchemaMapping mapping : resourceDAO.findAllMappings()) {\n+                    if (mapping.getSourceAttrName().equals(\n+                            derivedSchema.getName())\n+                            && mapping.getSourceMappingType()\n+                            == attributableUtil.derivedSourceMappingType()\n+                            && mapping.getResource() != null\n                             && resources.contains(mapping.getResource())) {\n \n                         resourceOperations.add(ResourceOperationType.UPDATE,"},{"sha":"be9dafc02aa739b9bd78c2dccebf857b61e92241","filename":"core/src/main/java/org/syncope/core/util/AttributableUtil.java","status":"modified","additions":18,"deletions":0,"changes":18,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/6317d431ba6b1dc4d959a1d39e178124dd58f967/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fcore%2Futil%2FAttributableUtil.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/6317d431ba6b1dc4d959a1d39e178124dd58f967/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fcore%2Futil%2FAttributableUtil.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fcore%2Futil%2FAttributableUtil.java?ref=6317d431ba6b1dc4d959a1d39e178124dd58f967","patch":"@@ -61,6 +61,24 @@ public SourceMappingType sourceMappingType() {\n         return result;\n     }\n \n+    public SourceMappingType derivedSourceMappingType() {\n+        SourceMappingType result = null;\n+\n+        switch (this) {\n+            case USER:\n+                result = SourceMappingType.UserDerivedSchema;\n+                break;\n+            case ROLE:\n+                result = SourceMappingType.RoleDerivedSchema;\n+                break;\n+            case MEMBERSHIP:\n+                result = SourceMappingType.MembershipDerivedSchema;\n+                break;\n+        }\n+\n+        return result;\n+    }\n+\n     public <T extends AbstractSchema> Class<T> schemaClass() {\n         Class result = null;\n "},{"sha":"f6a8ab7dadddecd2853cdb04c7997c5608861952","filename":"core/src/test/java/org/syncope/core/persistence/dao/DerSchemaTest.java","status":"modified","additions":4,"deletions":2,"changes":6,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/6317d431ba6b1dc4d959a1d39e178124dd58f967/core%2Fsrc%2Ftest%2Fjava%2Forg%2Fsyncope%2Fcore%2Fpersistence%2Fdao%2FDerSchemaTest.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/6317d431ba6b1dc4d959a1d39e178124dd58f967/core%2Fsrc%2Ftest%2Fjava%2Forg%2Fsyncope%2Fcore%2Fpersistence%2Fdao%2FDerSchemaTest.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fsrc%2Ftest%2Fjava%2Forg%2Fsyncope%2Fcore%2Fpersistence%2Fdao%2FDerSchemaTest.java?ref=6317d431ba6b1dc4d959a1d39e178124dd58f967","patch":"@@ -22,6 +22,7 @@\n import org.springframework.transaction.annotation.Transactional;\n import org.syncope.core.persistence.beans.user.UDerSchema;\n import org.syncope.core.persistence.AbstractTest;\n+import org.syncope.core.util.AttributableUtil;\n \n @Transactional\n public class DerSchemaTest extends AbstractTest {\n@@ -67,8 +68,9 @@ public final void delete() {\n         UDerSchema attributeSchema =\n                 derSchemaDAO.find(\"cn\", UDerSchema.class);\n \n-        derSchemaDAO.delete(attributeSchema.getName(),\n-                UDerSchema.class);\n+        derSchemaDAO.delete(\n+                attributeSchema.getName(),\n+                AttributableUtil.USER);\n \n         UDerSchema actual =\n                 derSchemaDAO.find(\"cn\", UDerSchema.class);"},{"sha":"fc135f7af14733e4d4e12cc4871566b16c240d82","filename":"core/src/test/java/org/syncope/core/persistence/relationships/DerSchemaTest.java","status":"modified","additions":6,"deletions":3,"changes":9,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/6317d431ba6b1dc4d959a1d39e178124dd58f967/core%2Fsrc%2Ftest%2Fjava%2Forg%2Fsyncope%2Fcore%2Fpersistence%2Frelationships%2FDerSchemaTest.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/6317d431ba6b1dc4d959a1d39e178124dd58f967/core%2Fsrc%2Ftest%2Fjava%2Forg%2Fsyncope%2Fcore%2Fpersistence%2Frelationships%2FDerSchemaTest.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fsrc%2Ftest%2Fjava%2Forg%2Fsyncope%2Fcore%2Fpersistence%2Frelationships%2FDerSchemaTest.java?ref=6317d431ba6b1dc4d959a1d39e178124dd58f967","patch":"@@ -27,6 +27,7 @@\n import org.syncope.core.persistence.dao.SchemaDAO;\n import org.syncope.core.persistence.dao.UserDAO;\n import org.syncope.core.persistence.AbstractTest;\n+import org.syncope.core.util.AttributableUtil;\n \n @Transactional\n public class DerSchemaTest extends AbstractTest {\n@@ -48,12 +49,14 @@ public class DerSchemaTest extends AbstractTest {\n \n     @Test\n     public final void test() {\n-        derSchemaDAO.delete(\"cn\", UDerSchema.class);\n+        UDerSchema schema = derSchemaDAO.find(\"cn\", UDerSchema.class);\n+\n+        derSchemaDAO.delete(schema.getName(), AttributableUtil.USER);\n \n         derSchemaDAO.flush();\n \n-        assertNull(derSchemaDAO.find(\"cn\", UDerSchema.class));\n+        assertNull(derSchemaDAO.find(schema.getName(), UDerSchema.class));\n         assertNull(derAttrDAO.find(1000L, UDerAttr.class));\n-        assertNull(userDAO.find(3L).getDerivedAttribute(\"cn\"));\n+        assertNull(userDAO.find(3L).getDerivedAttribute(schema.getName()));\n     }\n }"},{"sha":"89703575cc6a46cfc699fe05703ee4c055c75ad1","filename":"core/src/test/java/org/syncope/core/persistence/relationships/ResourceTest.java","status":"modified","additions":22,"deletions":1,"changes":23,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/6317d431ba6b1dc4d959a1d39e178124dd58f967/core%2Fsrc%2Ftest%2Fjava%2Forg%2Fsyncope%2Fcore%2Fpersistence%2Frelationships%2FResourceTest.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/6317d431ba6b1dc4d959a1d39e178124dd58f967/core%2Fsrc%2Ftest%2Fjava%2Forg%2Fsyncope%2Fcore%2Fpersistence%2Frelationships%2FResourceTest.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fsrc%2Ftest%2Fjava%2Forg%2Fsyncope%2Fcore%2Fpersistence%2Frelationships%2FResourceTest.java?ref=6317d431ba6b1dc4d959a1d39e178124dd58f967","patch":"@@ -38,6 +38,8 @@\n import org.syncope.core.rest.data.ResourceDataBinder;\n import org.syncope.core.persistence.AbstractTest;\n import org.syncope.core.persistence.beans.Task;\n+import org.syncope.core.persistence.beans.user.UDerSchema;\n+import org.syncope.core.persistence.dao.DerSchemaDAO;\n import org.syncope.core.persistence.dao.TaskDAO;\n import org.syncope.types.PropagationMode;\n import org.syncope.types.SourceMappingType;\n@@ -51,6 +53,9 @@ public class ResourceTest extends AbstractTest {\n     @Autowired\n     private SchemaDAO schemaDAO;\n \n+    @Autowired\n+    private DerSchemaDAO derSchemaDAO;\n+\n     @Autowired\n     private ConnInstanceDAO connectorInstanceDAO;\n \n@@ -161,6 +166,22 @@ public final void save()\n \n         resource.addMapping(accountId);\n \n+        // search for the derived attribute schema\n+        UDerSchema derivedSchema =\n+                derSchemaDAO.find(\"cn\", UDerSchema.class);\n+\n+        assertNotNull(derivedSchema);\n+\n+        // map a derived attribute\n+        SchemaMapping derived = new SchemaMapping();\n+        derived.setResource(resource);\n+        derived.setAccountid(false);\n+        derived.setDestAttrName(\"fullname\");\n+        derived.setSourceAttrName(derivedSchema.getName());\n+        derived.setSourceMappingType(SourceMappingType.UserSchema);\n+\n+        resource.addMapping(derived);\n+\n         // specify an user schema\n         SyncopeUser user = userDAO.find(1L);\n \n@@ -200,7 +221,7 @@ public final void save()\n         List<SchemaMapping> schemaMappings = resource.getMappings();\n \n         assertNotNull(schemaMappings);\n-        assertEquals(4, schemaMappings.size());\n+        assertEquals(5, schemaMappings.size());\n     }\n \n     @Test"},{"sha":"6d5dca076fb16eaded462de311cfc2500d636fda","filename":"core/src/test/java/org/syncope/core/rest/ResourceTestITCase.java","status":"modified","additions":7,"deletions":0,"changes":7,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/6317d431ba6b1dc4d959a1d39e178124dd58f967/core%2Fsrc%2Ftest%2Fjava%2Forg%2Fsyncope%2Fcore%2Frest%2FResourceTestITCase.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/6317d431ba6b1dc4d959a1d39e178124dd58f967/core%2Fsrc%2Ftest%2Fjava%2Forg%2Fsyncope%2Fcore%2Frest%2FResourceTestITCase.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fsrc%2Ftest%2Fjava%2Forg%2Fsyncope%2Fcore%2Frest%2FResourceTestITCase.java?ref=6317d431ba6b1dc4d959a1d39e178124dd58f967","patch":"@@ -69,6 +69,13 @@ public void create() {\n         schemaMappingTO.setAccountid(true);\n         resourceTO.addMapping(schemaMappingTO);\n \n+        schemaMappingTO = new SchemaMappingTO();\n+        schemaMappingTO.setDestAttrName(\"fullname\");\n+        schemaMappingTO.setSourceAttrName(\"cn\");\n+        schemaMappingTO.setSourceMappingType(SourceMappingType.UserSchema);\n+        schemaMappingTO.setAccountid(false);\n+        resourceTO.addMapping(schemaMappingTO);\n+\n         ResourceTO actual = restTemplate.postForObject(\n                 BASE_URL + \"resource/create.json\",\n                 resourceTO, ResourceTO.class);"},{"sha":"54243617f712f240230b985eaaeea6f771a42d1a","filename":"core/src/test/java/org/syncope/core/rest/UserTestITCase.java","status":"modified","additions":6,"deletions":1,"changes":7,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/6317d431ba6b1dc4d959a1d39e178124dd58f967/core%2Fsrc%2Ftest%2Fjava%2Forg%2Fsyncope%2Fcore%2Frest%2FUserTestITCase.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/6317d431ba6b1dc4d959a1d39e178124dd58f967/core%2Fsrc%2Ftest%2Fjava%2Forg%2Fsyncope%2Fcore%2Frest%2FUserTestITCase.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fsrc%2Ftest%2Fjava%2Forg%2Fsyncope%2Fcore%2Frest%2FUserTestITCase.java?ref=6317d431ba6b1dc4d959a1d39e178124dd58f967","patch":"@@ -87,6 +87,11 @@ private UserTO getSampleTO(final String email) {\n         loginDateTO.addValue(sdf.format(new Date()));\n         userTO.addAttribute(loginDateTO);\n \n+        // add a derived attribute\n+        AttributeTO cnTO = new AttributeTO();\n+        cnTO.setSchema(\"cn\");\n+        userTO.addDerivedAttribute(cnTO);\n+\n         return userTO;\n     }\n \n@@ -586,7 +591,7 @@ public final void update() {\n         userTO = restTemplate.postForObject(BASE_URL + \"user/activate\",\n                 userTO, UserTO.class);\n \n-        assertTrue(userTO.getDerivedAttributes().isEmpty());\n+        assertFalse(userTO.getDerivedAttributes().isEmpty());\n         assertEquals(1, userTO.getMemberships().size());\n \n         AttributeMod attributeMod = new AttributeMod();"},{"sha":"92d04dae035bfc88bc5b5bc159f4b265cd8ad128","filename":"core/src/test/resources/content.xml","status":"modified","additions":8,"deletions":3,"changes":11,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/6317d431ba6b1dc4d959a1d39e178124dd58f967/core%2Fsrc%2Ftest%2Fresources%2Fcontent.xml","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/6317d431ba6b1dc4d959a1d39e178124dd58f967/core%2Fsrc%2Ftest%2Fresources%2Fcontent.xml","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fsrc%2Ftest%2Fresources%2Fcontent.xml?ref=6317d431ba6b1dc4d959a1d39e178124dd58f967","patch":"@@ -273,18 +273,23 @@\n                    sourceAttrName=\"firstname\" sourceMappingType=\"UserSchema\" mandatoryCondition=\"type == 'F'\"\n                    accountid=\"0\" password=\"0\"/>\n \n-    <SchemaMapping id=\"114\" destAttrName=\"name\"\n+    <SchemaMapping id=\"114\" destAttrName=\"fullname\"\n+                   resource_name=\"ws-target-resource-2\"\n+                   sourceAttrName=\"cn\" sourceMappingType=\"UserDerivedSchema\" mandatoryCondition=\"true\"\n+                   accountid=\"0\" password=\"0\"/>\n+\n+    <SchemaMapping id=\"115\" destAttrName=\"name\"\n                    resource_name=\"ws-target-resource-nopropagation\"\n                    sourceAttrName=\"firstname\" sourceMappingType=\"UserSchema\" mandatoryCondition=\"true\"\n                    accountid=\"0\" password=\"0\"/>\n \n     <Task id=\"1\" propagationMode=\"ASYNC\" resourceOperationType=\"UPDATE\"\n                  resource_name=\"ws-target-resource-2\"\n-                 xmlAttributes=\"%3Cset%3E%0A++%3Corg.identityconnectors.framework.common.objects.Name%3E%0A++++%3Cname%3E__NAME__%3C%2Fname%3E%0A++++%3Cvalue+class%3D%22java.util.Collections%24UnmodifiableRandomAccessList%22+resolves-to%3D%22java.util.Collections%24UnmodifiableList%22%3E%0A++++++%3Cc+class%3D%22list%22%3E%0A++++++++%3Cstring%3EuserId%3C%2Fstring%3E%0A++++++%3C%2Fc%3E%0A++++++%3Clist+reference%3D%22..%2Fc%22%2F%3E%0A++++%3C%2Fvalue%3E%0A++%3C%2Forg.identityconnectors.framework.common.objects.Name%3E%0A++%3Corg.identityconnectors.framework.common.objects.Attribute%3E%0A++++%3Cname%3E__PASSWORD__%3C%2Fname%3E%0A++++%3Cvalue+class%3D%22java.util.Collections%24UnmodifiableRandomAccessList%22+resolves-to%3D%22java.util.Collections%24UnmodifiableList%22%3E%0A++++++%3Cc+class%3D%22list%22%3E%0A++++++++%3Corg.identityconnectors.common.security.GuardedString%3E%0A++++++++++%3C__readOnly%3Efalse%3C%2F__readOnly%3E%0A++++++++++%3C__disposed%3Efalse%3C%2F__disposed%3E%0A++++++++++%3C__encryptedBytes%3EQTOgwEhIHqtAI%2FYlgDhYc37esEF8VLDMU2IY1ciltrg%3D%3C%2F__encryptedBytes%3E%0A++++++++++%3C__base64SHA1Hash%3EW5%2FrwtdCnI8gAnIUhKcahMEnMMc%3D%3C%2F__base64SHA1Hash%3E%0A++++++++%3C%2Forg.identityconnectors.common.security.GuardedString%3E%0A++++++%3C%2Fc%3E%0A++++++%3Clist+reference%3D%22..%2Fc%22%2F%3E%0A++++%3C%2Fvalue%3E%0A++%3C%2Forg.identityconnectors.framework.common.objects.Attribute%3E%0A++%3Corg.identityconnectors.framework.common.objects.Attribute%3E%0A++++%3Cname%3Etype%3C%2Fname%3E%0A++++%3Cvalue+class%3D%22java.util.Collections%24UnmodifiableRandomAccessList%22+resolves-to%3D%22java.util.Collections%24UnmodifiableList%22%3E%0A++++++%3Cc+class%3D%22list%22%3E%0A++++++++%3Cstring%3Etype%3C%2Fstring%3E%0A++++++%3C%2Fc%3E%0A++++++%3Clist+reference%3D%22..%2Fc%22%2F%3E%0A++++%3C%2Fvalue%3E%0A++%3C%2Forg.identityconnectors.framework.common.objects.Attribute%3E%0A%3C%2Fset%3E\"/>\n+                 xmlAttributes=\"%3Cset%3E%0A++%3Corg.identityconnectors.framework.common.objects.Name%3E%0A++++%3Cname%3E__NAME__%3C%2Fname%3E%0A++++%3Cvalue+class%3D%22java.util.Collections%24UnmodifiableRandomAccessList%22+resolves-to%3D%22java.util.Collections%24UnmodifiableList%22%3E%0A++++++%3Cc+class%3D%22list%22%3E%0A++++++++%3Cstring%3EuserId%3C%2Fstring%3E%0A++++++%3C%2Fc%3E%0A++++++%3Clist+reference%3D%22..%2Fc%22%2F%3E%0A++++%3C%2Fvalue%3E%0A++%3C%2Forg.identityconnectors.framework.common.objects.Name%3E%0A++%3Corg.identityconnectors.framework.common.objects.Attribute%3E%0A++++%3Cname%3E__PASSWORD__%3C%2Fname%3E%0A++++%3Cvalue+class%3D%22java.util.Collections%24UnmodifiableRandomAccessList%22+resolves-to%3D%22java.util.Collections%24UnmodifiableList%22%3E%0A++++++%3Cc+class%3D%22list%22%3E%0A++++++++%3Corg.identityconnectors.common.security.GuardedString%3E%0A++++++++++%3C__readOnly%3Efalse%3C%2F__readOnly%3E%0A++++++++++%3C__disposed%3Efalse%3C%2F__disposed%3E%0A++++++++++%3C__encryptedBytes%3EQTOgwEhIHqtAI%2FYlgDhYc37esEF8VLDMU2IY1ciltrg%3D%3C%2F__encryptedBytes%3E%0A++++++++++%3C__base64SHA1Hash%3EW5%2FrwtdCnI8gAnIUhKcahMEnMMc%3D%3C%2F__base64SHA1Hash%3E%0A++++++++%3C%2Forg.identityconnectors.common.security.GuardedString%3E%0A++++++%3C%2Fc%3E%0A++++++%3Clist+reference%3D%22..%2Fc%22%2F%3E%0A++++%3C%2Fvalue%3E%0A++%3C%2Forg.identityconnectors.framework.common.objects.Attribute%3E%0A++%3Corg.identityconnectors.framework.common.objects.Attribute%3E%0A++++%3Cname%3Etype%3C%2Fname%3E%0A++++%3Cvalue+class%3D%22java.util.Collections%24UnmodifiableRandomAccessList%22+resolves-to%3D%22java.util.Collections%24UnmodifiableList%22%3E%0A++++++%3Cc+class%3D%22list%22%3E%0A++++++++%3Cstring%3Etype%3C%2Fstring%3E%0A++++++%3C%2Fc%3E%0A++++++%3Clist+reference%3D%22..%2Fc%22%2F%3E%0A++++%3C%2Fvalue%3E%0A++%3C%2Forg.identityconnectors.framework.common.objects.Attribute%3E%0A++%3Corg.identityconnectors.framework.common.objects.Attribute%3E%0A++++%3Cname%3Efullname%3C%2Fname%3E%0A++++%3Cvalue+class%3D%22java.util.Collections%24UnmodifiableRandomAccessList%22+resolves-to%3D%22java.util.Collections%24UnmodifiableList%22%3E%0A++++++%3Cc+class%3D%22list%22%3E%0A++++++++%3Cstring%3Efullname%3C%2Fstring%3E%0A++++++%3C%2Fc%3E%0A++++++%3Clist+reference%3D%22..%2Fc%22%2F%3E%0A++++%3C%2Fvalue%3E%0A++%3C%2Forg.identityconnectors.framework.common.objects.Attribute%3E%0A%3C%2Fset%3E%0A\"/>\n     <TaskExecution id=\"1\" task_id=\"1\" workflowId=\"0\"/>\n     <Task id=\"2\" propagationMode=\"SYNC\" resourceOperationType=\"CREATE\"\n                  resource_name=\"ws-target-resource-2\"\n-                 xmlAttributes=\"%3Cset%3E%0A++%3Corg.identityconnectors.framework.common.objects.Name%3E%0A++++%3Cname%3E__NAME__%3C%2Fname%3E%0A++++%3Cvalue+class%3D%22java.util.Collections%24UnmodifiableRandomAccessList%22+resolves-to%3D%22java.util.Collections%24UnmodifiableList%22%3E%0A++++++%3Cc+class%3D%22list%22%3E%0A++++++++%3Cstring%3EuserId%3C%2Fstring%3E%0A++++++%3C%2Fc%3E%0A++++++%3Clist+reference%3D%22..%2Fc%22%2F%3E%0A++++%3C%2Fvalue%3E%0A++%3C%2Forg.identityconnectors.framework.common.objects.Name%3E%0A++%3Corg.identityconnectors.framework.common.objects.Attribute%3E%0A++++%3Cname%3E__PASSWORD__%3C%2Fname%3E%0A++++%3Cvalue+class%3D%22java.util.Collections%24UnmodifiableRandomAccessList%22+resolves-to%3D%22java.util.Collections%24UnmodifiableList%22%3E%0A++++++%3Cc+class%3D%22list%22%3E%0A++++++++%3Corg.identityconnectors.common.security.GuardedString%3E%0A++++++++++%3C__readOnly%3Efalse%3C%2F__readOnly%3E%0A++++++++++%3C__disposed%3Efalse%3C%2F__disposed%3E%0A++++++++++%3C__encryptedBytes%3EQTOgwEhIHqtAI%2FYlgDhYc37esEF8VLDMU2IY1ciltrg%3D%3C%2F__encryptedBytes%3E%0A++++++++++%3C__base64SHA1Hash%3EW5%2FrwtdCnI8gAnIUhKcahMEnMMc%3D%3C%2F__base64SHA1Hash%3E%0A++++++++%3C%2Forg.identityconnectors.common.security.GuardedString%3E%0A++++++%3C%2Fc%3E%0A++++++%3Clist+reference%3D%22..%2Fc%22%2F%3E%0A++++%3C%2Fvalue%3E%0A++%3C%2Forg.identityconnectors.framework.common.objects.Attribute%3E%0A++%3Corg.identityconnectors.framework.common.objects.Attribute%3E%0A++++%3Cname%3Etype%3C%2Fname%3E%0A++++%3Cvalue+class%3D%22java.util.Collections%24UnmodifiableRandomAccessList%22+resolves-to%3D%22java.util.Collections%24UnmodifiableList%22%3E%0A++++++%3Cc+class%3D%22list%22%3E%0A++++++++%3Cstring%3Etype%3C%2Fstring%3E%0A++++++%3C%2Fc%3E%0A++++++%3Clist+reference%3D%22..%2Fc%22%2F%3E%0A++++%3C%2Fvalue%3E%0A++%3C%2Forg.identityconnectors.framework.common.objects.Attribute%3E%0A%3C%2Fset%3E\"/>\n+                 xmlAttributes=\"%3Cset%3E%0A++%3Corg.identityconnectors.framework.common.objects.Name%3E%0A++++%3Cname%3E__NAME__%3C%2Fname%3E%0A++++%3Cvalue+class%3D%22java.util.Collections%24UnmodifiableRandomAccessList%22+resolves-to%3D%22java.util.Collections%24UnmodifiableList%22%3E%0A++++++%3Cc+class%3D%22list%22%3E%0A++++++++%3Cstring%3EuserId%3C%2Fstring%3E%0A++++++%3C%2Fc%3E%0A++++++%3Clist+reference%3D%22..%2Fc%22%2F%3E%0A++++%3C%2Fvalue%3E%0A++%3C%2Forg.identityconnectors.framework.common.objects.Name%3E%0A++%3Corg.identityconnectors.framework.common.objects.Attribute%3E%0A++++%3Cname%3E__PASSWORD__%3C%2Fname%3E%0A++++%3Cvalue+class%3D%22java.util.Collections%24UnmodifiableRandomAccessList%22+resolves-to%3D%22java.util.Collections%24UnmodifiableList%22%3E%0A++++++%3Cc+class%3D%22list%22%3E%0A++++++++%3Corg.identityconnectors.common.security.GuardedString%3E%0A++++++++++%3C__readOnly%3Efalse%3C%2F__readOnly%3E%0A++++++++++%3C__disposed%3Efalse%3C%2F__disposed%3E%0A++++++++++%3C__encryptedBytes%3EQTOgwEhIHqtAI%2FYlgDhYc37esEF8VLDMU2IY1ciltrg%3D%3C%2F__encryptedBytes%3E%0A++++++++++%3C__base64SHA1Hash%3EW5%2FrwtdCnI8gAnIUhKcahMEnMMc%3D%3C%2F__base64SHA1Hash%3E%0A++++++++%3C%2Forg.identityconnectors.common.security.GuardedString%3E%0A++++++%3C%2Fc%3E%0A++++++%3Clist+reference%3D%22..%2Fc%22%2F%3E%0A++++%3C%2Fvalue%3E%0A++%3C%2Forg.identityconnectors.framework.common.objects.Attribute%3E%0A++%3Corg.identityconnectors.framework.common.objects.Attribute%3E%0A++++%3Cname%3Etype%3C%2Fname%3E%0A++++%3Cvalue+class%3D%22java.util.Collections%24UnmodifiableRandomAccessList%22+resolves-to%3D%22java.util.Collections%24UnmodifiableList%22%3E%0A++++++%3Cc+class%3D%22list%22%3E%0A++++++++%3Cstring%3Etype%3C%2Fstring%3E%0A++++++%3C%2Fc%3E%0A++++++%3Clist+reference%3D%22..%2Fc%22%2F%3E%0A++++%3C%2Fvalue%3E%0A++%3C%2Forg.identityconnectors.framework.common.objects.Attribute%3E%0A++%3Corg.identityconnectors.framework.common.objects.Attribute%3E%0A++++%3Cname%3Efullname%3C%2Fname%3E%0A++++%3Cvalue+class%3D%22java.util.Collections%24UnmodifiableRandomAccessList%22+resolves-to%3D%22java.util.Collections%24UnmodifiableList%22%3E%0A++++++%3Cc+class%3D%22list%22%3E%0A++++++++%3Cstring%3Efullname%3C%2Fstring%3E%0A++++++%3C%2Fc%3E%0A++++++%3Clist+reference%3D%22..%2Fc%22%2F%3E%0A++++%3C%2Fvalue%3E%0A++%3C%2Forg.identityconnectors.framework.common.objects.Attribute%3E%0A%3C%2Fset%3E%0A\"/>\n     <Task id=\"3\" propagationMode=\"ASYNC\" resourceOperationType=\"DELETE\"\n                  resource_name=\"ws-target-resource-2\"\n                  xmlAttributes=\"%3Cset%3E%0A++%3Corg.identityconnectors.framework.common.objects.Name%3E%0A++++%3Cname%3E__NAME__%3C%2Fname%3E%0A++++%3Cvalue+class%3D%22java.util.Collections%24UnmodifiableRandomAccessList%22+resolves-to%3D%22java.util.Collections%24UnmodifiableList%22%3E%0A++++++%3Cc+class%3D%22list%22%3E%0A++++++++%3Cstring%3EuserId%3C%2Fstring%3E%0A++++++%3C%2Fc%3E%0A++++++%3Clist+reference%3D%22..%2Fc%22%2F%3E%0A++++%3C%2Fvalue%3E%0A++%3C%2Forg.identityconnectors.framework.common.objects.Name%3E%0A++%3Corg.identityconnectors.framework.common.objects.Attribute%3E%0A++++%3Cname%3E__PASSWORD__%3C%2Fname%3E%0A++++%3Cvalue+class%3D%22java.util.Collections%24UnmodifiableRandomAccessList%22+resolves-to%3D%22java.util.Collections%24UnmodifiableList%22%3E%0A++++++%3Cc+class%3D%22list%22%3E%0A++++++++%3Corg.identityconnectors.common.security.GuardedString%3E%0A++++++++++%3C__readOnly%3Efalse%3C%2F__readOnly%3E%0A++++++++++%3C__disposed%3Efalse%3C%2F__disposed%3E%0A++++++++++%3C__encryptedBytes%3EQTOgwEhIHqtAI%2FYlgDhYc37esEF8VLDMU2IY1ciltrg%3D%3C%2F__encryptedBytes%3E%0A++++++++++%3C__base64SHA1Hash%3EW5%2FrwtdCnI8gAnIUhKcahMEnMMc%3D%3C%2F__base64SHA1Hash%3E%0A++++++++%3C%2Forg.identityconnectors.common.security.GuardedString%3E%0A++++++%3C%2Fc%3E%0A++++++%3Clist+reference%3D%22..%2Fc%22%2F%3E%0A++++%3C%2Fvalue%3E%0A++%3C%2Forg.identityconnectors.framework.common.objects.Attribute%3E%0A++%3Corg.identityconnectors.framework.common.objects.Attribute%3E%0A++++%3Cname%3Etype%3C%2Fname%3E%0A++++%3Cvalue+class%3D%22java.util.Collections%24UnmodifiableRandomAccessList%22+resolves-to%3D%22java.util.Collections%24UnmodifiableList%22%3E%0A++++++%3Cc+class%3D%22list%22%3E%0A++++++++%3Cstring%3Etype%3C%2Fstring%3E%0A++++++%3C%2Fc%3E%0A++++++%3Clist+reference%3D%22..%2Fc%22%2F%3E%0A++++%3C%2Fvalue%3E%0A++%3C%2Forg.identityconnectors.framework.common.objects.Attribute%3E%0A%3C%2Fset%3E\"/>"},{"sha":"77ce7df65528df446cfa73960bc616701fa397f3","filename":"identityconnectors/bundles/staticws/staticwebservice/src/test/java/org/syncope/identityconnectors/bundles/StaticWSTestITCase.java","status":"modified","additions":1,"deletions":0,"changes":1,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/6317d431ba6b1dc4d959a1d39e178124dd58f967/identityconnectors%2Fbundles%2Fstaticws%2Fstaticwebservice%2Fsrc%2Ftest%2Fjava%2Forg%2Fsyncope%2Fidentityconnectors%2Fbundles%2FStaticWSTestITCase.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/6317d431ba6b1dc4d959a1d39e178124dd58f967/identityconnectors%2Fbundles%2Fstaticws%2Fstaticwebservice%2Fsrc%2Ftest%2Fjava%2Forg%2Fsyncope%2Fidentityconnectors%2Fbundles%2FStaticWSTestITCase.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/identityconnectors%2Fbundles%2Fstaticws%2Fstaticwebservice%2Fsrc%2Ftest%2Fjava%2Forg%2Fsyncope%2Fidentityconnectors%2Fbundles%2FStaticWSTestITCase.java?ref=6317d431ba6b1dc4d959a1d39e178124dd58f967","patch":"@@ -322,6 +322,7 @@ public void create() {\n \n         attrs.add(AttributeBuilder.build(\"name\", \"John\"));\n         attrs.add(AttributeBuilder.build(\"surname\", \"Doe\"));\n+        attrs.add(AttributeBuilder.build(\"fullname\", \"John Doe\"));\n         attrs.add(AttributeBuilder.build(\"type\", \"person\"));\n         attrs.add(AttributeBuilder.build(\"birthdate\", \"12/03/1990\"));\n "},{"sha":"4968fd33e4bb3eeab30c0a100d6addc2d1c9171a","filename":"identityconnectors/bundles/staticws/ws-target-resource/src/main/java/org/syncope/identityconnectors/bundles/staticwebservice/wstarget/ProvisioningImpl.java","status":"modified","additions":12,"deletions":6,"changes":18,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/6317d431ba6b1dc4d959a1d39e178124dd58f967/identityconnectors%2Fbundles%2Fstaticws%2Fws-target-resource%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fidentityconnectors%2Fbundles%2Fstaticwebservice%2Fwstarget%2FProvisioningImpl.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/6317d431ba6b1dc4d959a1d39e178124dd58f967/identityconnectors%2Fbundles%2Fstaticws%2Fws-target-resource%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fidentityconnectors%2Fbundles%2Fstaticwebservice%2Fwstarget%2FProvisioningImpl.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/identityconnectors%2Fbundles%2Fstaticws%2Fws-target-resource%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fidentityconnectors%2Fbundles%2Fstaticwebservice%2Fwstarget%2FProvisioningImpl.java?ref=6317d431ba6b1dc4d959a1d39e178124dd58f967","patch":"@@ -266,7 +266,7 @@ public List<WSUser> query(Operand query) {\n     public String create(List<WSAttributeValue> data)\n             throws ProvisioningException {\n \n-        LOG.debug(\"Create request received\");\n+        LOG.debug(\"Create request received with data {}\", data);\n \n         List<WSAttribute> schema = schema();\n         Set<String> schemaNames = new HashSet<String>();\n@@ -282,17 +282,15 @@ public String create(List<WSAttributeValue> data)\n             conn = connect();\n             Statement statement = conn.createStatement();\n \n-            StringBuffer keys = new StringBuffer();\n-            StringBuffer values = new StringBuffer();\n+            StringBuilder keys = new StringBuilder();\n+            StringBuilder values = new StringBuilder();\n \n             String accountid = null;\n             String value;\n \n             for (WSAttributeValue attr : data) {\n                 if (schemaNames.contains(attr.getName())) {\n-                    if (LOG.isDebugEnabled()) {\n-                        LOG.debug(\"Bind attribute: \" + attr);\n-                    }\n+                    LOG.debug(\"Bind attribute: {}\", attr);\n \n                     if (attr.getValues() == null\n                             || attr.getValues().isEmpty()) {\n@@ -480,6 +478,14 @@ public List<WSAttribute> schema() {\n         attr.setType(\"String\");\n         attrs.add(attr);\n \n+        attr = new WSAttribute();\n+        attr.setName(\"fullname\");\n+        attr.setNullable(false);\n+        attr.setPassword(false);\n+        attr.setKey(false);\n+        attr.setType(\"String\");\n+        attrs.add(attr);\n+\n         attr = new WSAttribute();\n         attr.setName(\"birthdate\");\n         attr.setNullable(true);"},{"sha":"00adeade1612e91add2f02f1fcac55d378d61f8b","filename":"identityconnectors/bundles/staticws/ws-target-resource/src/main/resources/content.xml","status":"modified","additions":4,"deletions":2,"changes":6,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/6317d431ba6b1dc4d959a1d39e178124dd58f967/identityconnectors%2Fbundles%2Fstaticws%2Fws-target-resource%2Fsrc%2Fmain%2Fresources%2Fcontent.xml","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/6317d431ba6b1dc4d959a1d39e178124dd58f967/identityconnectors%2Fbundles%2Fstaticws%2Fws-target-resource%2Fsrc%2Fmain%2Fresources%2Fcontent.xml","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/identityconnectors%2Fbundles%2Fstaticws%2Fws-target-resource%2Fsrc%2Fmain%2Fresources%2Fcontent.xml?ref=6317d431ba6b1dc4d959a1d39e178124dd58f967","patch":"@@ -7,7 +7,8 @@\n         password=\"XXX\"\n         name=\"Alberto\"\n         surname=\"Bianchi\"\n-        type=\"persona fisica\"\n+        fullname=\"Alberto Bianchi\"\n+        type=\"F\"\n         mandatoryDisclaimer=\"TRUE\"\n         promoRCSDisclaimer=\"TRUE\"\n         promoThirdPartyDisclaimer=\"TRUE\"\n@@ -19,7 +20,8 @@\n         password=\"XXX\"\n         name=\"Mario\"\n         surname=\"Rossi\"\n-        type=\"persona fisica\"\n+        fullname=\"Mario Rossi\"\n+        type=\"F\"\n         mandatoryDisclaimer=\"TRUE\"\n         promoRCSDisclaimer=\"TRUE\"\n         promoThirdPartyDisclaimer=\"TRUE\""},{"sha":"87da390a19a27377b3470ec3601c73bd4615852f","filename":"identityconnectors/bundles/staticws/ws-target-resource/src/main/resources/schema.sql","status":"modified","additions":1,"deletions":0,"changes":1,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/6317d431ba6b1dc4d959a1d39e178124dd58f967/identityconnectors%2Fbundles%2Fstaticws%2Fws-target-resource%2Fsrc%2Fmain%2Fresources%2Fschema.sql","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/6317d431ba6b1dc4d959a1d39e178124dd58f967/identityconnectors%2Fbundles%2Fstaticws%2Fws-target-resource%2Fsrc%2Fmain%2Fresources%2Fschema.sql","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/identityconnectors%2Fbundles%2Fstaticws%2Fws-target-resource%2Fsrc%2Fmain%2Fresources%2Fschema.sql?ref=6317d431ba6b1dc4d959a1d39e178124dd58f967","patch":"@@ -9,6 +9,7 @@ fax VARCHAR(20),\n preference VARCHAR(120),\n name VARCHAR(30),\n surname VARCHAR(35),\n+fullname VARCHAR(35) NOT NULL,\n birthdate VARCHAR(30),\n gender VARCHAR(1),\n taxNumber VARCHAR(30),"},{"sha":"d9ad54560ecc1820689c5bae55865e0b22dff6e9","filename":"identityconnectors/bundles/staticws/ws-target-resource/src/test/java/org/syncope/identityconnectors/bundles/staticwebservice/wstarget/test/ProvisioningTestITCase.java","status":"modified","additions":7,"deletions":1,"changes":8,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/6317d431ba6b1dc4d959a1d39e178124dd58f967/identityconnectors%2Fbundles%2Fstaticws%2Fws-target-resource%2Fsrc%2Ftest%2Fjava%2Forg%2Fsyncope%2Fidentityconnectors%2Fbundles%2Fstaticwebservice%2Fwstarget%2Ftest%2FProvisioningTestITCase.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/6317d431ba6b1dc4d959a1d39e178124dd58f967/identityconnectors%2Fbundles%2Fstaticws%2Fws-target-resource%2Fsrc%2Ftest%2Fjava%2Forg%2Fsyncope%2Fidentityconnectors%2Fbundles%2Fstaticwebservice%2Fwstarget%2Ftest%2FProvisioningTestITCase.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/identityconnectors%2Fbundles%2Fstaticws%2Fws-target-resource%2Fsrc%2Ftest%2Fjava%2Forg%2Fsyncope%2Fidentityconnectors%2Fbundles%2Fstaticwebservice%2Fwstarget%2Ftest%2FProvisioningTestITCase.java?ref=6317d431ba6b1dc4d959a1d39e178124dd58f967","patch":"@@ -162,6 +162,10 @@ public void create() {\n             surname.setName(\"surname\");\n             surname.setValues(Collections.singletonList(\"doe\"));\n \n+            WSAttributeValue fullname = new WSAttributeValue();\n+            fullname.setName(\"fullname\");\n+            fullname.setValues(Collections.singletonList(\"john doe\"));\n+\n             WSAttributeValue birthdate = new WSAttributeValue();\n             birthdate.setName(\"birthdate\");\n             birthdate.setValues(Collections.singletonList(\"01/01/1990\"));\n@@ -172,6 +176,7 @@ public void create() {\n             attrs.add(type);\n             attrs.add(name);\n             attrs.add(surname);\n+            attrs.add(fullname);\n             attrs.add(birthdate);\n \n             String accountId = provisioning.create(attrs);\n@@ -362,8 +367,9 @@ public void sync() {\n                 results = provisioning.sync();\n                 assertNotNull(results);\n \n-                for (WSChange change : results)\n+                for (WSChange change : results) {\n                     log.debug(\"Delta: \" + change.getId());\n+                }\n \n             }\n "}]}