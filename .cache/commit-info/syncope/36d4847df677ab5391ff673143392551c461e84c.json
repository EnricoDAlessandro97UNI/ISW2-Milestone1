{"sha":"36d4847df677ab5391ff673143392551c461e84c","node_id":"MDY6Q29tbWl0NjM2ODc5MDYyOjM2ZDQ4NDdkZjY3N2FiNTM5MWZmNjczMTQzMzkyNTUxYzQ2MWU4NGM=","commit":{"author":{"name":"Andrea Patricelli","email":"andreapatricelli@apache.org","date":"2019-04-09T12:40:12Z"},"committer":{"name":"Andrea Patricelli","email":"andreapatricelli@apache.org","date":"2019-04-09T12:40:12Z"},"message":"[SYNCOPE-1421] added captcha as last step of the wizard","tree":{"sha":"e0a45a47fb822c159ae2b08cc2d969e763a5c84c","url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/git/trees/e0a45a47fb822c159ae2b08cc2d969e763a5c84c"},"url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/git/commits/36d4847df677ab5391ff673143392551c461e84c","comment_count":0,"verification":{"verified":false,"reason":"unsigned","signature":null,"payload":null}},"url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/36d4847df677ab5391ff673143392551c461e84c","html_url":"https://github.com/EnricoDAlessandro97UNI/syncope/commit/36d4847df677ab5391ff673143392551c461e84c","comments_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/36d4847df677ab5391ff673143392551c461e84c/comments","author":{"login":"andrea-patricelli","id":3763111,"node_id":"MDQ6VXNlcjM3NjMxMTE=","avatar_url":"https://avatars.githubusercontent.com/u/3763111?v=4","gravatar_id":"","url":"https://api.github.com/users/andrea-patricelli","html_url":"https://github.com/andrea-patricelli","followers_url":"https://api.github.com/users/andrea-patricelli/followers","following_url":"https://api.github.com/users/andrea-patricelli/following{/other_user}","gists_url":"https://api.github.com/users/andrea-patricelli/gists{/gist_id}","starred_url":"https://api.github.com/users/andrea-patricelli/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/andrea-patricelli/subscriptions","organizations_url":"https://api.github.com/users/andrea-patricelli/orgs","repos_url":"https://api.github.com/users/andrea-patricelli/repos","events_url":"https://api.github.com/users/andrea-patricelli/events{/privacy}","received_events_url":"https://api.github.com/users/andrea-patricelli/received_events","type":"User","site_admin":false},"committer":{"login":"andrea-patricelli","id":3763111,"node_id":"MDQ6VXNlcjM3NjMxMTE=","avatar_url":"https://avatars.githubusercontent.com/u/3763111?v=4","gravatar_id":"","url":"https://api.github.com/users/andrea-patricelli","html_url":"https://github.com/andrea-patricelli","followers_url":"https://api.github.com/users/andrea-patricelli/followers","following_url":"https://api.github.com/users/andrea-patricelli/following{/other_user}","gists_url":"https://api.github.com/users/andrea-patricelli/gists{/gist_id}","starred_url":"https://api.github.com/users/andrea-patricelli/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/andrea-patricelli/subscriptions","organizations_url":"https://api.github.com/users/andrea-patricelli/orgs","repos_url":"https://api.github.com/users/andrea-patricelli/repos","events_url":"https://api.github.com/users/andrea-patricelli/events{/privacy}","received_events_url":"https://api.github.com/users/andrea-patricelli/received_events","type":"User","site_admin":false},"parents":[{"sha":"43aafa5b5c0afb64a46f3c9ecd806c8ce1607c0c","url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/43aafa5b5c0afb64a46f3c9ecd806c8ce1607c0c","html_url":"https://github.com/EnricoDAlessandro97UNI/syncope/commit/43aafa5b5c0afb64a46f3c9ecd806c8ce1607c0c"}],"stats":{"total":379,"additions":378,"deletions":1},"files":[{"sha":"deb52c0a6a1cbd17e561dcdfef98a09aeb2e0591","filename":"client/idrepo/enduser/src/main/java/org/apache/syncope/client/enduser/wizards/any/AbstractCaptchaPanel.java","status":"added","additions":89,"deletions":0,"changes":89,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/36d4847df677ab5391ff673143392551c461e84c/client%2Fidrepo%2Fenduser%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fclient%2Fenduser%2Fwizards%2Fany%2FAbstractCaptchaPanel.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/36d4847df677ab5391ff673143392551c461e84c/client%2Fidrepo%2Fenduser%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fclient%2Fenduser%2Fwizards%2Fany%2FAbstractCaptchaPanel.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/client%2Fidrepo%2Fenduser%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fclient%2Fenduser%2Fwizards%2Fany%2FAbstractCaptchaPanel.java?ref=36d4847df677ab5391ff673143392551c461e84c","patch":"@@ -0,0 +1,89 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *   http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+package org.apache.syncope.client.enduser.wizards.any;\n+\n+import org.apache.wicket.ajax.AjaxRequestTarget;\n+import org.apache.wicket.ajax.markup.html.form.AjaxButton;\n+import org.apache.wicket.extensions.markup.html.captcha.CaptchaImageResource;\n+import org.apache.wicket.markup.ComponentTag;\n+import org.apache.wicket.markup.html.form.RequiredTextField;\n+import org.apache.wicket.markup.html.image.Image;\n+import org.apache.wicket.markup.html.panel.Panel;\n+import org.apache.wicket.model.PropertyModel;\n+\n+public abstract class AbstractCaptchaPanel<T> extends Panel {\n+\n+    private static final long serialVersionUID = -4310189409064713307L;\n+\n+    protected String randomText;\n+\n+    protected String captchaText;\n+\n+    protected final CaptchaImageResource captchaImageResource;\n+\n+    public AbstractCaptchaPanel(final String id) {\n+        super(id);\n+        this.setOutputMarkupId(true);\n+\n+        captchaImageResource = createCaptchaImageResource();\n+        final Image captchaImage = new Image(\"image\", captchaImageResource);\n+        captchaImage.setOutputMarkupId(true);\n+        add(captchaImage);\n+\n+        AjaxButton realoadCaptchaButton = new AjaxButton(\"reloadButton\") {\n+\n+            private static final long serialVersionUID = -957948639666058749L;\n+\n+            @Override\n+            protected void onSubmit(final AjaxRequestTarget target) {\n+                captchaImageResource.invalidate();\n+                target.add(captchaImage);\n+            }\n+\n+        };\n+        realoadCaptchaButton.setDefaultFormProcessing(false);\n+        add(realoadCaptchaButton);\n+\n+        add(new RequiredTextField<String>(\"captcha\",\n+                new PropertyModel<>(AbstractCaptchaPanel.this, \"captchaText\"), String.class) {\n+\n+            private static final long serialVersionUID = -5918382907429502528L;\n+\n+            @Override\n+            protected void onComponentTag(final ComponentTag tag) {\n+                super.onComponentTag(tag);\n+                // clear the field after each render\n+                tag.put(\"value\", \"\");\n+            }\n+\n+        });\n+    }\n+\n+    public String getRandomText() {\n+        return randomText;\n+    }\n+\n+    public String getCaptchaText() {\n+        return captchaText;\n+    }\n+\n+    protected abstract CaptchaImageResource createCaptchaImageResource();\n+\n+    protected abstract void reload();\n+}"},{"sha":"0cb432d21c3553728e799f3c3334cf7bbe583908","filename":"client/idrepo/enduser/src/main/java/org/apache/syncope/client/enduser/wizards/any/AnyWizardBuilder.java","status":"modified","additions":9,"deletions":0,"changes":9,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/36d4847df677ab5391ff673143392551c461e84c/client%2Fidrepo%2Fenduser%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fclient%2Fenduser%2Fwizards%2Fany%2FAnyWizardBuilder.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/36d4847df677ab5391ff673143392551c461e84c/client%2Fidrepo%2Fenduser%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fclient%2Fenduser%2Fwizards%2Fany%2FAnyWizardBuilder.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/client%2Fidrepo%2Fenduser%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fclient%2Fenduser%2Fwizards%2Fany%2FAnyWizardBuilder.java?ref=36d4847df677ab5391ff673143392551c461e84c","patch":"@@ -42,6 +42,8 @@ public abstract class AnyWizardBuilder extends AbstractAnyWizardBuilder<UserTO>\n \n     protected UserFormLayoutInfo formLayoutInfo;\n \n+    protected Captcha captcha;\n+\n     /**\n      * Construct.\n      *\n@@ -127,6 +129,13 @@ public PageReference getPageReference() {\n             wizardModel.add(new Resources(modelObject));\n         }\n \n+        if (SyncopeWebApplication.get().isCaptchaEnabled()) {\n+            // add captcha\n+            captcha = new Captcha();\n+            captcha.setOutputMarkupId(true);\n+            wizardModel.add(captcha);\n+        }\n+\n         return wizardModel;\n     }\n "},{"sha":"d0a1243533f2c9c36d9518dde5faffa1bb04fe8e","filename":"client/idrepo/enduser/src/main/java/org/apache/syncope/client/enduser/wizards/any/Captcha.java","status":"added","additions":55,"deletions":0,"changes":55,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/36d4847df677ab5391ff673143392551c461e84c/client%2Fidrepo%2Fenduser%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fclient%2Fenduser%2Fwizards%2Fany%2FCaptcha.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/36d4847df677ab5391ff673143392551c461e84c/client%2Fidrepo%2Fenduser%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fclient%2Fenduser%2Fwizards%2Fany%2FCaptcha.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/client%2Fidrepo%2Fenduser%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fclient%2Fenduser%2Fwizards%2Fany%2FCaptcha.java?ref=36d4847df677ab5391ff673143392551c461e84c","patch":"@@ -0,0 +1,55 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *   http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+package org.apache.syncope.client.enduser.wizards.any;\n+\n+import org.apache.commons.lang3.StringUtils;\n+import org.apache.syncope.client.enduser.SyncopeWebApplication;\n+import org.apache.wicket.extensions.wizard.WizardModel;\n+import org.apache.wicket.extensions.wizard.WizardStep;\n+\n+public class Captcha extends WizardStep implements WizardModel.ICondition {\n+\n+    private static final long serialVersionUID = 702900610508752856L;\n+\n+    private final CaptchaPanel<Void> captchaPanel;\n+\n+    public Captcha() {\n+        captchaPanel = new CaptchaPanel<>(\"captchaPanel\");\n+        captchaPanel.setOutputMarkupId(true);\n+        add(captchaPanel);\n+    }\n+\n+    public boolean captchaCheck() {\n+        final String captchaText = captchaPanel.getCaptchaText();\n+        final String randomText = captchaPanel.getRandomText();\n+        return StringUtils.isBlank(captchaText) || StringUtils.isBlank(randomText)\n+                ? false\n+                : captchaText.equals(randomText);\n+    }\n+\n+    public void reload() {\n+        captchaPanel.reload();\n+    }\n+\n+    @Override\n+    public boolean evaluate() {\n+        return SyncopeWebApplication.get().isCaptchaEnabled();\n+    }\n+\n+}"},{"sha":"63158f7c336b7081e825e958acbcfbc1c5cdb232","filename":"client/idrepo/enduser/src/main/java/org/apache/syncope/client/enduser/wizards/any/CaptchaPanel.java","status":"added","additions":60,"deletions":0,"changes":60,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/36d4847df677ab5391ff673143392551c461e84c/client%2Fidrepo%2Fenduser%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fclient%2Fenduser%2Fwizards%2Fany%2FCaptchaPanel.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/36d4847df677ab5391ff673143392551c461e84c/client%2Fidrepo%2Fenduser%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fclient%2Fenduser%2Fwizards%2Fany%2FCaptchaPanel.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/client%2Fidrepo%2Fenduser%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fclient%2Fenduser%2Fwizards%2Fany%2FCaptchaPanel.java?ref=36d4847df677ab5391ff673143392551c461e84c","patch":"@@ -0,0 +1,60 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *   http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+package org.apache.syncope.client.enduser.wizards.any;\n+\n+import java.security.SecureRandom;\n+import org.apache.commons.text.RandomStringGenerator;\n+import org.apache.wicket.extensions.markup.html.captcha.CaptchaImageResource;\n+\n+public class CaptchaPanel<T> extends AbstractCaptchaPanel<T> {\n+\n+    private static final long serialVersionUID = 1169850573252481471L;\n+\n+    private static final SecureRandom RANDOM = new SecureRandom();\n+\n+    private static final RandomStringGenerator RANDOM_LETTERS = new RandomStringGenerator.Builder().\n+            usingRandom(RANDOM::nextInt).\n+            withinRange('a', 'z').\n+            build();\n+\n+    public CaptchaPanel(final String id) {\n+        super(id);\n+    }\n+\n+    @Override\n+    protected CaptchaImageResource createCaptchaImageResource() {\n+        return new CaptchaImageResource() {\n+\n+            private static final long serialVersionUID = 2436829189992948005L;\n+\n+            @Override\n+            protected byte[] render() {\n+                randomText = RANDOM_LETTERS.generate(6);\n+                getChallengeIdModel().setObject(randomText);\n+                return super.render();\n+            }\n+        };\n+    }\n+\n+    @Override\n+    protected void reload() {\n+        this.captchaImageResource.invalidate();\n+    }\n+\n+}"},{"sha":"4caecec97cad0dd330de375a3add6342dd28e13f","filename":"client/idrepo/enduser/src/main/java/org/apache/syncope/client/enduser/wizards/any/UserWizardBuilder.java","status":"modified","additions":7,"deletions":0,"changes":7,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/36d4847df677ab5391ff673143392551c461e84c/client%2Fidrepo%2Fenduser%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fclient%2Fenduser%2Fwizards%2Fany%2FUserWizardBuilder.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/36d4847df677ab5391ff673143392551c461e84c/client%2Fidrepo%2Fenduser%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fclient%2Fenduser%2Fwizards%2Fany%2FUserWizardBuilder.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/client%2Fidrepo%2Fenduser%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fclient%2Fenduser%2Fwizards%2Fany%2FUserWizardBuilder.java?ref=36d4847df677ab5391ff673143392551c461e84c","patch":"@@ -26,6 +26,7 @@\n import org.apache.syncope.client.enduser.rest.UserSelfRestClient;\n import org.apache.syncope.client.ui.commons.wizards.any.AnyWrapper;\n import org.apache.syncope.client.ui.commons.wizards.any.UserWrapper;\n+import org.apache.syncope.client.ui.commons.wizards.exception.CaptchaNotMatchingException;\n import org.apache.syncope.common.lib.AnyOperations;\n import org.apache.syncope.common.lib.EntityTOUtils;\n import org.apache.syncope.common.lib.request.PasswordPatch;\n@@ -77,6 +78,12 @@ public UserWizardBuilder(\n \n     @Override\n     protected Serializable onApplyInternal(final AnyWrapper<UserTO> modelObject) {\n+        // captcha check\n+        if (captcha != null && captcha.evaluate() && !captcha.captchaCheck()) {\n+//            sendError(\"Entered captcha is not matching\");\n+            // force captcha redrawing\n+            throw new CaptchaNotMatchingException();\n+        }\n         UserTO inner = modelObject.getInnerObject();\n \n         ProvisioningResult<UserTO> result;"},{"sha":"43860b2d533c66351428b2e49f517bf4531a69e8","filename":"client/idrepo/enduser/src/main/resources/org/apache/syncope/client/enduser/SyncopeWebApplication.properties","status":"modified","additions":3,"deletions":0,"changes":3,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/36d4847df677ab5391ff673143392551c461e84c/client%2Fidrepo%2Fenduser%2Fsrc%2Fmain%2Fresources%2Forg%2Fapache%2Fsyncope%2Fclient%2Fenduser%2FSyncopeWebApplication.properties","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/36d4847df677ab5391ff673143392551c461e84c/client%2Fidrepo%2Fenduser%2Fsrc%2Fmain%2Fresources%2Forg%2Fapache%2Fsyncope%2Fclient%2Fenduser%2FSyncopeWebApplication.properties","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/client%2Fidrepo%2Fenduser%2Fsrc%2Fmain%2Fresources%2Forg%2Fapache%2Fsyncope%2Fclient%2Fenduser%2FSyncopeWebApplication.properties?ref=36d4847df677ab5391ff673143392551c461e84c","patch":"@@ -75,3 +75,6 @@ timeout=Operation is taking to long: it will be executed in background. Please c\n security=Security\n before=Before\n after=After\n+\n+captcha_error=Captcha entered does not match\n+"},{"sha":"1dde420921e637e828327e0a0d53f8301566d0c3","filename":"client/idrepo/enduser/src/main/resources/org/apache/syncope/client/enduser/SyncopeWebApplication_it.properties","status":"modified","additions":3,"deletions":0,"changes":3,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/36d4847df677ab5391ff673143392551c461e84c/client%2Fidrepo%2Fenduser%2Fsrc%2Fmain%2Fresources%2Forg%2Fapache%2Fsyncope%2Fclient%2Fenduser%2FSyncopeWebApplication_it.properties","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/36d4847df677ab5391ff673143392551c461e84c/client%2Fidrepo%2Fenduser%2Fsrc%2Fmain%2Fresources%2Forg%2Fapache%2Fsyncope%2Fclient%2Fenduser%2FSyncopeWebApplication_it.properties","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/client%2Fidrepo%2Fenduser%2Fsrc%2Fmain%2Fresources%2Forg%2Fapache%2Fsyncope%2Fclient%2Fenduser%2FSyncopeWebApplication_it.properties?ref=36d4847df677ab5391ff673143392551c461e84c","patch":"@@ -74,3 +74,6 @@ timeout=L'operazione sta durando troppo: sar\\u00e0 eseguita in background. Verif\n security=Sicurezza\n before=Prima\n after=Dopo\n+\n+captcha_error=Il Captcha inserito non \\u00e8 corretto\n+"},{"sha":"149353acd6c8e0a0f2553498814c4b1ec406d434","filename":"client/idrepo/enduser/src/main/resources/org/apache/syncope/client/enduser/SyncopeWebApplication_ja.properties","status":"modified","additions":2,"deletions":0,"changes":2,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/36d4847df677ab5391ff673143392551c461e84c/client%2Fidrepo%2Fenduser%2Fsrc%2Fmain%2Fresources%2Forg%2Fapache%2Fsyncope%2Fclient%2Fenduser%2FSyncopeWebApplication_ja.properties","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/36d4847df677ab5391ff673143392551c461e84c/client%2Fidrepo%2Fenduser%2Fsrc%2Fmain%2Fresources%2Forg%2Fapache%2Fsyncope%2Fclient%2Fenduser%2FSyncopeWebApplication_ja.properties","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/client%2Fidrepo%2Fenduser%2Fsrc%2Fmain%2Fresources%2Forg%2Fapache%2Fsyncope%2Fclient%2Fenduser%2FSyncopeWebApplication_ja.properties?ref=36d4847df677ab5391ff673143392551c461e84c","patch":"@@ -72,3 +72,5 @@ timeout=\\u64cd\\u4f5c\\u306b\\u9577\\u6642\\u9593\\u304b\\u304b\\u3063\\u3066\\u3044\\u307e\n security=Security\n before=Before\n after=After\n+\n+captcha_error=Captcha entered does not match"},{"sha":"98531d6626da71851dea57b752fcd6a36d0ea988","filename":"client/idrepo/enduser/src/main/resources/org/apache/syncope/client/enduser/SyncopeWebApplication_pt_BR.properties","status":"modified","additions":2,"deletions":0,"changes":2,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/36d4847df677ab5391ff673143392551c461e84c/client%2Fidrepo%2Fenduser%2Fsrc%2Fmain%2Fresources%2Forg%2Fapache%2Fsyncope%2Fclient%2Fenduser%2FSyncopeWebApplication_pt_BR.properties","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/36d4847df677ab5391ff673143392551c461e84c/client%2Fidrepo%2Fenduser%2Fsrc%2Fmain%2Fresources%2Forg%2Fapache%2Fsyncope%2Fclient%2Fenduser%2FSyncopeWebApplication_pt_BR.properties","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/client%2Fidrepo%2Fenduser%2Fsrc%2Fmain%2Fresources%2Forg%2Fapache%2Fsyncope%2Fclient%2Fenduser%2FSyncopeWebApplication_pt_BR.properties?ref=36d4847df677ab5391ff673143392551c461e84c","patch":"@@ -74,3 +74,5 @@ timeout=Operation is taking to long: it will be executed in background. Please c\n security=Security\n before=Before\n after=After\n+\n+captcha_error=Captcha entered does not match"},{"sha":"46723d9766efc0731ad77385c9bcc78324e13112","filename":"client/idrepo/enduser/src/main/resources/org/apache/syncope/client/enduser/SyncopeWebApplication_ru.properties","status":"modified","additions":2,"deletions":0,"changes":2,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/36d4847df677ab5391ff673143392551c461e84c/client%2Fidrepo%2Fenduser%2Fsrc%2Fmain%2Fresources%2Forg%2Fapache%2Fsyncope%2Fclient%2Fenduser%2FSyncopeWebApplication_ru.properties","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/36d4847df677ab5391ff673143392551c461e84c/client%2Fidrepo%2Fenduser%2Fsrc%2Fmain%2Fresources%2Forg%2Fapache%2Fsyncope%2Fclient%2Fenduser%2FSyncopeWebApplication_ru.properties","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/client%2Fidrepo%2Fenduser%2Fsrc%2Fmain%2Fresources%2Forg%2Fapache%2Fsyncope%2Fclient%2Fenduser%2FSyncopeWebApplication_ru.properties?ref=36d4847df677ab5391ff673143392551c461e84c","patch":"@@ -73,3 +73,5 @@ timeout=Operation is taking to long: it will be executed in background. Please c\n security=Security\n before=Before\n after=After\n+\n+captcha_error=Captcha entered does not match"},{"sha":"c3164b100a6827f43a8e16acc5951c1ae1393872","filename":"client/idrepo/enduser/src/main/resources/org/apache/syncope/client/enduser/wizards/any/AbstractCaptchaPanel.html","status":"added","additions":24,"deletions":0,"changes":24,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/36d4847df677ab5391ff673143392551c461e84c/client%2Fidrepo%2Fenduser%2Fsrc%2Fmain%2Fresources%2Forg%2Fapache%2Fsyncope%2Fclient%2Fenduser%2Fwizards%2Fany%2FAbstractCaptchaPanel.html","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/36d4847df677ab5391ff673143392551c461e84c/client%2Fidrepo%2Fenduser%2Fsrc%2Fmain%2Fresources%2Forg%2Fapache%2Fsyncope%2Fclient%2Fenduser%2Fwizards%2Fany%2FAbstractCaptchaPanel.html","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/client%2Fidrepo%2Fenduser%2Fsrc%2Fmain%2Fresources%2Forg%2Fapache%2Fsyncope%2Fclient%2Fenduser%2Fwizards%2Fany%2FAbstractCaptchaPanel.html?ref=36d4847df677ab5391ff673143392551c461e84c","patch":"@@ -0,0 +1,24 @@\n+<!DOCTYPE html>\n+<!--\n+Licensed to the Apache Software Foundation (ASF) under one\n+or more contributor license agreements.  See the NOTICE file\n+distributed with this work for additional information\n+regarding copyright ownership.  The ASF licenses this file\n+to you under the Apache License, Version 2.0 (the\n+\"License\"); you may not use this file except in compliance\n+with the License.  You may obtain a copy of the License at\n+\n+  http://www.apache.org/licenses/LICENSE-2.0\n+\n+Unless required by applicable law or agreed to in writing,\n+software distributed under the License is distributed on an\n+\"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+KIND, either express or implied.  See the License for the\n+specific language governing permissions and limitations\n+under the License.\n+-->\n+<html xmlns=\"http://www.w3.org/1999/xhtml\" xmlns:wicket=\"http://wicket.apache.org\">\n+  <wicket:panel>\n+    <wicket:child/>\n+  </wicket:panel>\n+</html>\n\\ No newline at end of file"},{"sha":"1d2b1df3b549563a2683a57d6528fe6184a9bbdf","filename":"client/idrepo/enduser/src/main/resources/org/apache/syncope/client/enduser/wizards/any/AbstractCaptchaPanel.properties","status":"added","additions":17,"deletions":0,"changes":17,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/36d4847df677ab5391ff673143392551c461e84c/client%2Fidrepo%2Fenduser%2Fsrc%2Fmain%2Fresources%2Forg%2Fapache%2Fsyncope%2Fclient%2Fenduser%2Fwizards%2Fany%2FAbstractCaptchaPanel.properties","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/36d4847df677ab5391ff673143392551c461e84c/client%2Fidrepo%2Fenduser%2Fsrc%2Fmain%2Fresources%2Forg%2Fapache%2Fsyncope%2Fclient%2Fenduser%2Fwizards%2Fany%2FAbstractCaptchaPanel.properties","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/client%2Fidrepo%2Fenduser%2Fsrc%2Fmain%2Fresources%2Forg%2Fapache%2Fsyncope%2Fclient%2Fenduser%2Fwizards%2Fany%2FAbstractCaptchaPanel.properties?ref=36d4847df677ab5391ff673143392551c461e84c","patch":"@@ -0,0 +1,17 @@\n+# Licensed to the Apache Software Foundation (ASF) under one\n+# or more contributor license agreements.  See the NOTICE file\n+# distributed with this work for additional information\n+# regarding copyright ownership.  The ASF licenses this file\n+# to you under the Apache License, Version 2.0 (the\n+# \"License\"); you may not use this file except in compliance\n+# with the License.  You may obtain a copy of the License at\n+#\n+#   http://www.apache.org/licenses/LICENSE-2.0\n+#\n+# Unless required by applicable law or agreed to in writing,\n+# software distributed under the License is distributed on an\n+# \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+# KIND, either express or implied.  See the License for the\n+# specific language governing permissions and limitations\n+# under the License.\n+captcha.message=Please enter the code displayed within the image."},{"sha":"9593914fffa0b2e881ba996e961d42217dd18ce9","filename":"client/idrepo/enduser/src/main/resources/org/apache/syncope/client/enduser/wizards/any/Captcha.html","status":"added","additions":25,"deletions":0,"changes":25,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/36d4847df677ab5391ff673143392551c461e84c/client%2Fidrepo%2Fenduser%2Fsrc%2Fmain%2Fresources%2Forg%2Fapache%2Fsyncope%2Fclient%2Fenduser%2Fwizards%2Fany%2FCaptcha.html","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/36d4847df677ab5391ff673143392551c461e84c/client%2Fidrepo%2Fenduser%2Fsrc%2Fmain%2Fresources%2Forg%2Fapache%2Fsyncope%2Fclient%2Fenduser%2Fwizards%2Fany%2FCaptcha.html","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/client%2Fidrepo%2Fenduser%2Fsrc%2Fmain%2Fresources%2Forg%2Fapache%2Fsyncope%2Fclient%2Fenduser%2Fwizards%2Fany%2FCaptcha.html?ref=36d4847df677ab5391ff673143392551c461e84c","patch":"@@ -0,0 +1,25 @@\n+<!--\n+Licensed to the Apache Software Foundation (ASF) under one\n+or more contributor license agreements.  See the NOTICE file\n+distributed with this work for additional information\n+regarding copyright ownership.  The ASF licenses this file\n+to you under the Apache License, Version 2.0 (the\n+\"License\"); you may not use this file except in compliance\n+with the License.  You may obtain a copy of the License at\n+\n+  http://www.apache.org/licenses/LICENSE-2.0\n+\n+Unless required by applicable law or agreed to in writing,\n+software distributed under the License is distributed on an\n+\"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+KIND, either express or implied.  See the License for the\n+specific language governing permissions and limitations\n+under the License.\n+-->\n+<html xmlns=\"http://www.w3.org/1999/xhtml\" xmlns:wicket=\"http://wicket.apache.org\">\n+  <wicket:panel>\n+    <div class=\"box-body\">\n+      <span wicket:id=\"captchaPanel\">[CAPTCHA]</span>\n+    </div>\n+  </wicket:panel>\n+</html>\n\\ No newline at end of file"},{"sha":"e45fdf5d52731c4298d7d24f87bea47b4e82194a","filename":"client/idrepo/enduser/src/main/resources/org/apache/syncope/client/enduser/wizards/any/CaptchaPanel.html","status":"added","additions":40,"deletions":0,"changes":40,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/36d4847df677ab5391ff673143392551c461e84c/client%2Fidrepo%2Fenduser%2Fsrc%2Fmain%2Fresources%2Forg%2Fapache%2Fsyncope%2Fclient%2Fenduser%2Fwizards%2Fany%2FCaptchaPanel.html","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/36d4847df677ab5391ff673143392551c461e84c/client%2Fidrepo%2Fenduser%2Fsrc%2Fmain%2Fresources%2Forg%2Fapache%2Fsyncope%2Fclient%2Fenduser%2Fwizards%2Fany%2FCaptchaPanel.html","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/client%2Fidrepo%2Fenduser%2Fsrc%2Fmain%2Fresources%2Forg%2Fapache%2Fsyncope%2Fclient%2Fenduser%2Fwizards%2Fany%2FCaptchaPanel.html?ref=36d4847df677ab5391ff673143392551c461e84c","patch":"@@ -0,0 +1,40 @@\n+<!DOCTYPE html>\n+<!--\n+Licensed to the Apache Software Foundation (ASF) under one\n+or more contributor license agreements.  See the NOTICE file\n+distributed with this work for additional information\n+regarding copyright ownership.  The ASF licenses this file\n+to you under the Apache License, Version 2.0 (the\n+\"License\"); you may not use this file except in compliance\n+with the License.  You may obtain a copy of the License at\n+\n+  http://www.apache.org/licenses/LICENSE-2.0\n+\n+Unless required by applicable law or agreed to in writing,\n+software distributed under the License is distributed on an\n+\"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+KIND, either express or implied.  See the License for the\n+specific language governing permissions and limitations\n+under the License.\n+-->\n+<html xmlns=\"http://www.w3.org/1999/xhtml\" xmlns:wicket=\"http://wicket.apache.org\">\n+  <wicket:panel>\n+    <wicket:extend>\n+      <div id=\"captchaButtons\">\n+        <img wicket:id=\"image\" />\n+      </div>\n+      <div>\n+        <button wicket:id=\"reloadButton\" id=\"refresh\" type=\"button\" class=\"btn btn-default btn-xs fa fa-refresh\" \n+                title=\"Refresh Captcha\"></button>\n+        <button id=\"infoLink\" class=\"btn btn-default btn-xs fa fa-question-circle\" title=\"What is this?\"\n+                onclick=\"window.open('https://it.wikipedia.org/wiki/CAPTCHA')\"></button>\n+      </div>\n+      <div>\n+        <input wicket:id=\"captcha\" type=\"text\" size=\"28\" />\n+      </div>\n+      <div>\n+        <wicket:message key=\"captcha.message\">[CAPTCHA_MESSAGE]</wicket:message>\n+      </div>\n+    </wicket:extend>\n+  </wicket:panel>\n+</html>"},{"sha":"6128a015ef2172f8fb109ecbc32edb46427bb6f3","filename":"client/idrepo/ui/src/main/java/org/apache/syncope/client/ui/commons/Constants.java","status":"modified","additions":2,"deletions":0,"changes":2,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/36d4847df677ab5391ff673143392551c461e84c/client%2Fidrepo%2Fui%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fclient%2Fui%2Fcommons%2FConstants.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/36d4847df677ab5391ff673143392551c461e84c/client%2Fidrepo%2Fui%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fclient%2Fui%2Fcommons%2FConstants.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/client%2Fidrepo%2Fui%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fclient%2Fui%2Fcommons%2FConstants.java?ref=36d4847df677ab5391ff673143392551c461e84c","patch":"@@ -66,6 +66,8 @@ public final class Constants {\n     public static final String OPERATION_SUCCEEDED = \"operation_succeeded\";\n \n     public static final String OPERATION_ERROR = \"operation_error\";\n+    \n+    public static final String CAPTCHA_ERROR = \"captcha_error\";\n \n     public static final String SEARCH_ERROR = \"search_error\";\n "},{"sha":"475cda23d44413742856461ddce15b240ae24b66","filename":"client/idrepo/ui/src/main/java/org/apache/syncope/client/ui/commons/wizards/AjaxWizard.java","status":"modified","additions":9,"deletions":0,"changes":9,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/36d4847df677ab5391ff673143392551c461e84c/client%2Fidrepo%2Fui%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fclient%2Fui%2Fcommons%2Fwizards%2FAjaxWizard.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/36d4847df677ab5391ff673143392551c461e84c/client%2Fidrepo%2Fui%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fclient%2Fui%2Fcommons%2Fwizards%2FAjaxWizard.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/client%2Fidrepo%2Fui%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fclient%2Fui%2Fcommons%2Fwizards%2FAjaxWizard.java?ref=36d4847df677ab5391ff673143392551c461e84c","patch":"@@ -29,6 +29,7 @@\n import java.util.concurrent.TimeoutException;\n import org.apache.commons.lang3.StringUtils;\n import org.apache.commons.lang3.tuple.Pair;\n+import org.apache.syncope.client.ui.commons.Constants;\n import org.apache.wicket.Component;\n import org.apache.wicket.ajax.AjaxRequestTarget;\n import org.apache.wicket.event.Broadcast;\n@@ -45,6 +46,7 @@\n import org.apache.syncope.client.ui.commons.pages.BaseWebPage;\n import org.apache.syncope.client.ui.commons.panels.SubmitableModalPanel;\n import org.apache.syncope.client.ui.commons.panels.WizardModalPanel;\n+import org.apache.syncope.client.ui.commons.wizards.exception.CaptchaNotMatchingException;\n import org.apache.wicket.Application;\n import org.apache.wicket.PageReference;\n import org.apache.wicket.Session;\n@@ -216,6 +218,10 @@ public final void onFinish() {\n             }\n             sendWarning(getString(\"timeout\"));\n             ((BaseWebPage) pageRef.getPage()).getNotificationPanel().refresh(target);\n+        } catch (CaptchaNotMatchingException ce) {\n+            LOG.error(\"Wizard error on finish: captcha not matching\");\n+            sendError(getString(Constants.CAPTCHA_ERROR));\n+            ((BaseWebPage) pageRef.getPage()).getNotificationPanel().refresh(target);\n         } catch (Exception e) {\n             LOG.error(\"Wizard error on finish\", e);\n             sendError(StringUtils.isBlank(e.getMessage())\n@@ -397,6 +403,9 @@ private Serializable onApply(final AjaxRequestTarget target) throws TimeoutExcep\n \n             return res.getRight();\n         } catch (InterruptedException | ExecutionException e) {\n+            if (e.getCause() instanceof CaptchaNotMatchingException) {\n+                throw (CaptchaNotMatchingException) e.getCause();\n+            }\n             throw new RuntimeException(e);\n         }\n     }"},{"sha":"1223723a5a8c5c7469a906f307599bac3f7ff3d6","filename":"client/idrepo/ui/src/main/java/org/apache/syncope/client/ui/commons/wizards/exception/CaptchaNotMatchingException.java","status":"added","additions":28,"deletions":0,"changes":28,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/36d4847df677ab5391ff673143392551c461e84c/client%2Fidrepo%2Fui%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fclient%2Fui%2Fcommons%2Fwizards%2Fexception%2FCaptchaNotMatchingException.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/36d4847df677ab5391ff673143392551c461e84c/client%2Fidrepo%2Fui%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fclient%2Fui%2Fcommons%2Fwizards%2Fexception%2FCaptchaNotMatchingException.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/client%2Fidrepo%2Fui%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fclient%2Fui%2Fcommons%2Fwizards%2Fexception%2FCaptchaNotMatchingException.java?ref=36d4847df677ab5391ff673143392551c461e84c","patch":"@@ -0,0 +1,28 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *   http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+package org.apache.syncope.client.ui.commons.wizards.exception;\n+\n+public class CaptchaNotMatchingException extends RuntimeException {\n+\n+    private static final long serialVersionUID = -7735150705166393254L;\n+\n+    public CaptchaNotMatchingException() {\n+    }\n+\n+}"},{"sha":"ad59927b7e440d56ac18d0c81d0dbcac33fa0a23","filename":"fit/enduser-reference/src/test/resources/enduser.properties","status":"modified","additions":1,"deletions":1,"changes":2,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/36d4847df677ab5391ff673143392551c461e84c/fit%2Fenduser-reference%2Fsrc%2Ftest%2Fresources%2Fenduser.properties","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/36d4847df677ab5391ff673143392551c461e84c/fit%2Fenduser-reference%2Fsrc%2Ftest%2Fresources%2Fenduser.properties","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/fit%2Fenduser-reference%2Fsrc%2Ftest%2Fresources%2Fenduser.properties?ref=36d4847df677ab5391ff673143392551c461e84c","patch":"@@ -28,5 +28,5 @@ host=localhost\n port=9080\n rootPath=/syncope/rest/\n \n-captcha=false\n+captcha=true\n xsrf=false"}]}