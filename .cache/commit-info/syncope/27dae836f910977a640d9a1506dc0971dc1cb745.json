{"sha":"27dae836f910977a640d9a1506dc0971dc1cb745","node_id":"MDY6Q29tbWl0NjM2ODc5MDYyOjI3ZGFlODM2ZjkxMDk3N2E2NDBkOWExNTA2ZGMwOTcxZGMxY2I3NDU=","commit":{"author":{"name":"Francesco Chicchiriccò","email":"ilgrosso@apache.org","date":"2016-04-07T08:08:03Z"},"committer":{"name":"Francesco Chicchiriccò","email":"ilgrosso@apache.org","date":"2016-04-07T08:08:03Z"},"message":"[SYNCOPE-819] Delete confirmation now works everywhere","tree":{"sha":"1f390eba3c11d0e9dc1993d2ea4143c61b326a23","url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/git/trees/1f390eba3c11d0e9dc1993d2ea4143c61b326a23"},"url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/git/commits/27dae836f910977a640d9a1506dc0971dc1cb745","comment_count":0,"verification":{"verified":false,"reason":"unsigned","signature":null,"payload":null}},"url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/27dae836f910977a640d9a1506dc0971dc1cb745","html_url":"https://github.com/EnricoDAlessandro97UNI/syncope/commit/27dae836f910977a640d9a1506dc0971dc1cb745","comments_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/27dae836f910977a640d9a1506dc0971dc1cb745/comments","author":{"login":"ilgrosso","id":1064664,"node_id":"MDQ6VXNlcjEwNjQ2NjQ=","avatar_url":"https://avatars.githubusercontent.com/u/1064664?v=4","gravatar_id":"","url":"https://api.github.com/users/ilgrosso","html_url":"https://github.com/ilgrosso","followers_url":"https://api.github.com/users/ilgrosso/followers","following_url":"https://api.github.com/users/ilgrosso/following{/other_user}","gists_url":"https://api.github.com/users/ilgrosso/gists{/gist_id}","starred_url":"https://api.github.com/users/ilgrosso/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ilgrosso/subscriptions","organizations_url":"https://api.github.com/users/ilgrosso/orgs","repos_url":"https://api.github.com/users/ilgrosso/repos","events_url":"https://api.github.com/users/ilgrosso/events{/privacy}","received_events_url":"https://api.github.com/users/ilgrosso/received_events","type":"User","site_admin":false},"committer":{"login":"ilgrosso","id":1064664,"node_id":"MDQ6VXNlcjEwNjQ2NjQ=","avatar_url":"https://avatars.githubusercontent.com/u/1064664?v=4","gravatar_id":"","url":"https://api.github.com/users/ilgrosso","html_url":"https://github.com/ilgrosso","followers_url":"https://api.github.com/users/ilgrosso/followers","following_url":"https://api.github.com/users/ilgrosso/following{/other_user}","gists_url":"https://api.github.com/users/ilgrosso/gists{/gist_id}","starred_url":"https://api.github.com/users/ilgrosso/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ilgrosso/subscriptions","organizations_url":"https://api.github.com/users/ilgrosso/orgs","repos_url":"https://api.github.com/users/ilgrosso/repos","events_url":"https://api.github.com/users/ilgrosso/events{/privacy}","received_events_url":"https://api.github.com/users/ilgrosso/received_events","type":"User","site_admin":false},"parents":[{"sha":"7300ccdf35693a02192d9d56ace592ee676c612f","url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/7300ccdf35693a02192d9d56ace592ee676c612f","html_url":"https://github.com/EnricoDAlessandro97UNI/syncope/commit/7300ccdf35693a02192d9d56ace592ee676c612f"}],"stats":{"total":161,"additions":60,"deletions":101},"files":[{"sha":"22ec34be1ae1921b38743396cba287af3484a2cc","filename":"client/console/src/main/java/org/apache/syncope/client/console/topology/TopologyTogglePanel.java","status":"modified","additions":21,"deletions":29,"changes":50,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/27dae836f910977a640d9a1506dc0971dc1cb745/client%2Fconsole%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fclient%2Fconsole%2Ftopology%2FTopologyTogglePanel.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/27dae836f910977a640d9a1506dc0971dc1cb745/client%2Fconsole%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fclient%2Fconsole%2Ftopology%2FTopologyTogglePanel.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/client%2Fconsole%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fclient%2Fconsole%2Ftopology%2FTopologyTogglePanel.java?ref=27dae836f910977a640d9a1506dc0971dc1cb745","patch":"@@ -33,8 +33,8 @@\n import org.apache.syncope.client.console.tasks.PushTasks;\n import org.apache.syncope.client.console.tasks.SchedTasks;\n import org.apache.syncope.client.console.tasks.PullTasks;\n-import org.apache.syncope.client.console.wicket.markup.html.bootstrap.confirmation.ConfirmationModalBehavior;\n import org.apache.syncope.client.console.wicket.markup.html.bootstrap.dialog.BaseModal;\n+import org.apache.syncope.client.console.wicket.markup.html.form.IndicatingOnConfirmAjaxLink;\n import org.apache.syncope.common.lib.SyncopeClientException;\n import org.apache.syncope.common.lib.to.ConnInstanceTO;\n import org.apache.syncope.common.lib.to.ResourceTO;\n@@ -173,9 +173,9 @@ public void onClick(final AjaxRequestTarget target) {\n     }\n \n     private Fragment getConnectorFragment(final TopologyNode node, final PageReference pageRef) {\n-        final Fragment fragment = new Fragment(\"actions\", \"connectorActions\", this);\n+        Fragment fragment = new Fragment(\"actions\", \"connectorActions\", this);\n \n-        final AjaxLink<String> delete = new IndicatingAjaxLink<String>(\"delete\") {\n+        AjaxLink<String> delete = new IndicatingOnConfirmAjaxLink<String>(\"delete\", true) {\n \n             private static final long serialVersionUID = 3776750333491622263L;\n \n@@ -186,19 +186,16 @@ public void onClick(final AjaxRequestTarget target) {\n                     target.appendJavaScript(String.format(\"jsPlumb.remove('%s');\", node.getKey()));\n                     info(getString(Constants.OPERATION_SUCCEEDED));\n                 } catch (SyncopeClientException e) {\n-                    error(StringUtils.isBlank(e.getMessage()) ? e.getClass().getName() : e.getMessage());\n                     LOG.error(\"While deleting resource {}\", node.getKey(), e);\n+                    error(StringUtils.isBlank(e.getMessage()) ? e.getClass().getName() : e.getMessage());\n                 }\n                 SyncopeConsoleSession.get().getNotificationPanel().refresh(target);\n             }\n         };\n-\n-        fragment.add(delete);\n-        delete.add(new ConfirmationModalBehavior());\n-\n         MetaDataRoleAuthorizationStrategy.authorize(delete, ENABLE, StandardEntitlement.CONNECTOR_DELETE);\n+        fragment.add(delete);\n \n-        final AjaxLink<String> create = new IndicatingAjaxLink<String>(\"create\") {\n+        AjaxLink<String> create = new IndicatingAjaxLink<String>(\"create\") {\n \n             private static final long serialVersionUID = 3776750333491622263L;\n \n@@ -221,11 +218,10 @@ public void onClick(final AjaxRequestTarget target) {\n                 resourceModal.show(true);\n             }\n         };\n-        fragment.add(create);\n-\n         MetaDataRoleAuthorizationStrategy.authorize(create, ENABLE, StandardEntitlement.RESOURCE_CREATE);\n+        fragment.add(create);\n \n-        final AjaxLink<String> edit = new IndicatingAjaxLink<String>(\"edit\") {\n+        AjaxLink<String> edit = new IndicatingAjaxLink<String>(\"edit\") {\n \n             private static final long serialVersionUID = 3776750333491622263L;\n \n@@ -246,17 +242,16 @@ public void onClick(final AjaxRequestTarget target) {\n                 resourceModal.show(true);\n             }\n         };\n-        fragment.add(edit);\n-\n         MetaDataRoleAuthorizationStrategy.authorize(edit, ENABLE, StandardEntitlement.CONNECTOR_UPDATE);\n+        fragment.add(edit);\n \n         return fragment;\n     }\n \n     private Fragment getResurceFragment(final TopologyNode node, final PageReference pageRef) {\n-        final Fragment fragment = new Fragment(\"actions\", \"resourceActions\", this);\n+        Fragment fragment = new Fragment(\"actions\", \"resourceActions\", this);\n \n-        final AjaxLink<String> delete = new IndicatingAjaxLink<String>(\"delete\") {\n+        AjaxLink<String> delete = new IndicatingOnConfirmAjaxLink<String>(\"delete\", true) {\n \n             private static final long serialVersionUID = 3776750333491622263L;\n \n@@ -267,19 +262,16 @@ public void onClick(final AjaxRequestTarget target) {\n                     target.appendJavaScript(String.format(\"jsPlumb.remove('%s');\", node.getKey()));\n                     info(getString(Constants.OPERATION_SUCCEEDED));\n                 } catch (SyncopeClientException e) {\n-                    error(StringUtils.isBlank(e.getMessage()) ? e.getClass().getName() : e.getMessage());\n                     LOG.error(\"While deleting resource {}\", node.getKey(), e);\n+                    error(StringUtils.isBlank(e.getMessage()) ? e.getClass().getName() : e.getMessage());\n                 }\n                 SyncopeConsoleSession.get().getNotificationPanel().refresh(target);\n             }\n         };\n-        fragment.add(delete);\n-\n-        delete.add(new ConfirmationModalBehavior());\n-\n         MetaDataRoleAuthorizationStrategy.authorize(delete, ENABLE, StandardEntitlement.RESOURCE_DELETE);\n+        fragment.add(delete);\n \n-        final AjaxLink<String> edit = new IndicatingAjaxLink<String>(\"edit\") {\n+        AjaxLink<String> edit = new IndicatingAjaxLink<String>(\"edit\") {\n \n             private static final long serialVersionUID = 3776750333491622263L;\n \n@@ -300,10 +292,10 @@ public void onClick(final AjaxRequestTarget target) {\n                 resourceModal.show(true);\n             }\n         };\n-        fragment.add(edit);\n         MetaDataRoleAuthorizationStrategy.authorize(edit, ENABLE, StandardEntitlement.RESOURCE_UPDATE);\n+        fragment.add(edit);\n \n-        final AjaxLink<String> propagation = new IndicatingAjaxLink<String>(\"propagation\") {\n+        AjaxLink<String> propagation = new IndicatingAjaxLink<String>(\"propagation\") {\n \n             private static final long serialVersionUID = 3776750333491622263L;\n \n@@ -315,10 +307,10 @@ public void onClick(final AjaxRequestTarget target) {\n                 taskModal.show(true);\n             }\n         };\n-        fragment.add(propagation);\n         MetaDataRoleAuthorizationStrategy.authorize(propagation, ENABLE, StandardEntitlement.TASK_LIST);\n+        fragment.add(propagation);\n \n-        final AjaxLink<String> pull = new IndicatingAjaxLink<String>(\"pull\") {\n+        AjaxLink<String> pull = new IndicatingAjaxLink<String>(\"pull\") {\n \n             private static final long serialVersionUID = 3776750333491622263L;\n \n@@ -329,10 +321,10 @@ public void onClick(final AjaxRequestTarget target) {\n                 taskModal.show(true);\n             }\n         };\n-        fragment.add(pull);\n         MetaDataRoleAuthorizationStrategy.authorize(pull, ENABLE, StandardEntitlement.TASK_LIST);\n+        fragment.add(pull);\n \n-        final AjaxLink<String> push = new IndicatingAjaxLink<String>(\"push\") {\n+        AjaxLink<String> push = new IndicatingAjaxLink<String>(\"push\") {\n \n             private static final long serialVersionUID = 3776750333491622263L;\n \n@@ -343,8 +335,8 @@ public void onClick(final AjaxRequestTarget target) {\n                 taskModal.show(true);\n             }\n         };\n-        fragment.add(push);\n         MetaDataRoleAuthorizationStrategy.authorize(push, ENABLE, StandardEntitlement.TASK_LIST);\n+        fragment.add(push);\n \n         return fragment;\n     }"},{"sha":"79967660afcb4d5998a531ed16da907bdae96a7e","filename":"client/console/src/main/java/org/apache/syncope/client/console/wicket/markup/html/bootstrap/confirmation/ConfirmationModalBehavior.java","status":"removed","additions":0,"deletions":70,"changes":70,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/7300ccdf35693a02192d9d56ace592ee676c612f/client%2Fconsole%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fclient%2Fconsole%2Fwicket%2Fmarkup%2Fhtml%2Fbootstrap%2Fconfirmation%2FConfirmationModalBehavior.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/7300ccdf35693a02192d9d56ace592ee676c612f/client%2Fconsole%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fclient%2Fconsole%2Fwicket%2Fmarkup%2Fhtml%2Fbootstrap%2Fconfirmation%2FConfirmationModalBehavior.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/client%2Fconsole%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fclient%2Fconsole%2Fwicket%2Fmarkup%2Fhtml%2Fbootstrap%2Fconfirmation%2FConfirmationModalBehavior.java?ref=7300ccdf35693a02192d9d56ace592ee676c612f","patch":"@@ -1,70 +0,0 @@\n-/*\n- * Licensed to the Apache Software Foundation (ASF) under one\n- * or more contributor license agreements.  See the NOTICE file\n- * distributed with this work for additional information\n- * regarding copyright ownership.  The ASF licenses this file\n- * to you under the Apache License, Version 2.0 (the\n- * \"License\"); you may not use this file except in compliance\n- * with the License.  You may obtain a copy of the License at\n- *\n- *   http://www.apache.org/licenses/LICENSE-2.0\n- *\n- * Unless required by applicable law or agreed to in writing,\n- * software distributed under the License is distributed on an\n- * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n- * KIND, either express or implied.  See the License for the\n- * specific language governing permissions and limitations\n- * under the License.\n- */\n-package org.apache.syncope.client.console.wicket.markup.html.bootstrap.confirmation;\n-\n-import static de.agilecoders.wicket.jquery.JQuery.$;\n-\n-import de.agilecoders.wicket.jquery.function.JavaScriptInlineFunction;\n-import org.apache.wicket.Component;\n-import org.apache.wicket.behavior.Behavior;\n-import org.apache.wicket.markup.head.IHeaderResponse;\n-import org.apache.wicket.markup.head.JavaScriptHeaderItem;\n-import org.apache.wicket.model.ResourceModel;\n-\n-/**\n- * A behavior that shows a modal with OK/Cancel buttons to confirm an action.\n- *\n- */\n-public class ConfirmationModalBehavior extends Behavior {\n-\n-    private static final long serialVersionUID = 1741536820040325586L;\n-\n-    private final String message;\n-\n-    public ConfirmationModalBehavior() {\n-        this(\"confirmDelete\");\n-    }\n-\n-    public ConfirmationModalBehavior(final String msg) {\n-        message = new ResourceModel(msg, \"Are you sure?\").getObject();\n-    }\n-\n-    @Override\n-    public void renderHead(final Component component, final IHeaderResponse response) {\n-        super.renderHead(component, response);\n-\n-        response.render(JavaScriptHeaderItem.forScript(\"var confirm = false;\", null));\n-        response.render($(component).on(\"click\",\n-                new JavaScriptInlineFunction(\"\"\n-                        + \"var element = $(this);\"\n-                        + \"evt.preventDefault();\"\n-                        + \"if(confirm == false){\"\n-                        + \"evt.stopImmediatePropagation();\"\n-                        + \"bootbox.confirm(\\\"\" + message + \"\\\", function(result){\"\n-                        + \"if(result == true){\"\n-                        + \"confirm = true;\"\n-                        + \"element.click();\"\n-                        + \"}\"\n-                        + \"else{confirm = false;}\"\n-                        + \"return true;\"\n-                        + \"})} \"\n-                        + \"else {confirm = false;};\"\n-                )).asDomReadyScript());\n-    }\n-}"},{"sha":"53ab39c8c49a8e955fb3ad6573af633d8b96f5c1","filename":"client/console/src/main/java/org/apache/syncope/client/console/wicket/markup/html/form/IndicatingOnConfirmAjaxLink.java","status":"modified","additions":35,"deletions":2,"changes":37,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/27dae836f910977a640d9a1506dc0971dc1cb745/client%2Fconsole%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fclient%2Fconsole%2Fwicket%2Fmarkup%2Fhtml%2Fform%2FIndicatingOnConfirmAjaxLink.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/27dae836f910977a640d9a1506dc0971dc1cb745/client%2Fconsole%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fclient%2Fconsole%2Fwicket%2Fmarkup%2Fhtml%2Fform%2FIndicatingOnConfirmAjaxLink.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/client%2Fconsole%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fclient%2Fconsole%2Fwicket%2Fmarkup%2Fhtml%2Fform%2FIndicatingOnConfirmAjaxLink.java?ref=27dae836f910977a640d9a1506dc0971dc1cb745","patch":"@@ -18,24 +18,57 @@\n  */\n package org.apache.syncope.client.console.wicket.markup.html.form;\n \n-import org.apache.syncope.client.console.wicket.markup.html.bootstrap.confirmation.ConfirmationModalBehavior;\n+import static de.agilecoders.wicket.jquery.JQuery.$;\n+\n+import de.agilecoders.wicket.jquery.function.JavaScriptInlineFunction;\n import org.apache.wicket.extensions.ajax.markup.html.IndicatingAjaxLink;\n+import org.apache.wicket.markup.head.IHeaderResponse;\n+import org.apache.wicket.markup.head.JavaScriptHeaderItem;\n+import org.apache.wicket.model.ResourceModel;\n \n public abstract class IndicatingOnConfirmAjaxLink<T> extends IndicatingAjaxLink<T> {\n \n     private static final long serialVersionUID = 2228670850922265663L;\n \n     private final String msg;\n \n+    private final boolean enabled;\n+\n     public IndicatingOnConfirmAjaxLink(final String id, final boolean enabled) {\n         this(id, \"confirmDelete\", enabled);\n     }\n \n     public IndicatingOnConfirmAjaxLink(final String id, final String msg, final boolean enabled) {\n         super(id);\n         this.msg = msg;\n+        this.enabled = enabled;\n+    }\n+\n+    @Override\n+    public void renderHead(final IHeaderResponse response) {\n+        super.renderHead(response);\n+\n         if (enabled) {\n-            this.add(new ConfirmationModalBehavior(msg));\n+            response.render(JavaScriptHeaderItem.forScript(\"proceed = false;\", null));\n+            response.render($(this).on(\"click\",\n+                    new JavaScriptInlineFunction(\"\"\n+                            + \"var element = $(this);\"\n+                            + \"evt.preventDefault();\"\n+                            + \"if (proceed == false) {\"\n+                            + \"  evt.stopImmediatePropagation();\"\n+                            + \"  bootbox.confirm('\" + new ResourceModel(msg).getObject() + \"', function(result) {\"\n+                            + \"    if (result == true) {\"\n+                            + \"      proceed = true;\"\n+                            + \"      element.click();\"\n+                            + \"    } else {\"\n+                            + \"      proceed = false;\"\n+                            + \"    }\"\n+                            + \"  return true;\"\n+                            + \"  })\"\n+                            + \"} else {\"\n+                            + \"  proceed = false;\"\n+                            + \"};\"\n+                    )).asDomReadyScript());\n         }\n     }\n }"},{"sha":"39ab5ca3bbb9c0b6eccaedf9c9835e1b9424cb20","filename":"client/console/src/main/resources/org/apache/syncope/client/console/pages/BasePage.html","status":"modified","additions":4,"deletions":0,"changes":4,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/27dae836f910977a640d9a1506dc0971dc1cb745/client%2Fconsole%2Fsrc%2Fmain%2Fresources%2Forg%2Fapache%2Fsyncope%2Fclient%2Fconsole%2Fpages%2FBasePage.html","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/27dae836f910977a640d9a1506dc0971dc1cb745/client%2Fconsole%2Fsrc%2Fmain%2Fresources%2Forg%2Fapache%2Fsyncope%2Fclient%2Fconsole%2Fpages%2FBasePage.html","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/client%2Fconsole%2Fsrc%2Fmain%2Fresources%2Forg%2Fapache%2Fsyncope%2Fclient%2Fconsole%2Fpages%2FBasePage.html?ref=27dae836f910977a640d9a1506dc0971dc1cb745","patch":"@@ -34,6 +34,10 @@\n \n     <script type=\"text/javascript\" src=\"webjars/bootbox/${bootbox.version}/bootbox.js\"></script>\n     <script type=\"text/javascript\" src=\"webjars/jQuery-slimScroll/${jquery-slimscroll.version}/jquery.slimscroll.min.js\"></script>\n+    <script type=\"text/javascript\">\n+      // global variable for IndicatingOnConfirmAjaxLink\n+      var proceed = false;\n+    </script>\n   </head>\n   <body class=\"skin-green-light hold-transition sidebar-mini\" wicket:id=\"body\">\n "}]}