{"sha":"2c510a41865b14c7543c2639826a473d37a9a4a6","node_id":"MDY6Q29tbWl0NjM2ODc5MDYyOjJjNTEwYTQxODY1YjE0Yzc1NDNjMjYzOTgyNmE0NzNkMzdhOWE0YTY=","commit":{"author":{"name":"Unknown","email":"unknown@apache.org","date":"2012-01-19T11:13:00Z"},"committer":{"name":"Unknown","email":"unknown@apache.org","date":"2012-01-19T11:13:00Z"},"message":"Update issue 238\nAdding cache statistics\n\n\ngit-svn-id: https://svn.apache.org/repos/asf/incubator/syncope/branches/0_8_X_ASL@1247357 13f79535-47bb-0310-9956-ffa450edef68","tree":{"sha":"54ef0f560e0d7fe7f4ffe77ef141ec3502e24072","url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/git/trees/54ef0f560e0d7fe7f4ffe77ef141ec3502e24072"},"url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/git/commits/2c510a41865b14c7543c2639826a473d37a9a4a6","comment_count":0,"verification":{"verified":false,"reason":"unsigned","signature":null,"payload":null}},"url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/2c510a41865b14c7543c2639826a473d37a9a4a6","html_url":"https://github.com/EnricoDAlessandro97UNI/syncope/commit/2c510a41865b14c7543c2639826a473d37a9a4a6","comments_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/2c510a41865b14c7543c2639826a473d37a9a4a6/comments","author":null,"committer":null,"parents":[{"sha":"13f880e3cc7ceda21541bb0d8e5660d9a9a1f466","url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/13f880e3cc7ceda21541bb0d8e5660d9a9a1f466","html_url":"https://github.com/EnricoDAlessandro97UNI/syncope/commit/13f880e3cc7ceda21541bb0d8e5660d9a9a1f466"}],"stats":{"total":280,"additions":141,"deletions":139},"files":[{"sha":"6355521cf3614823b15f5183e184b432dfe3d96b","filename":"TODO","status":"modified","additions":0,"deletions":4,"changes":4,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/2c510a41865b14c7543c2639826a473d37a9a4a6/TODO","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/2c510a41865b14c7543c2639826a473d37a9a4a6/TODO","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/TODO?ref=2c510a41865b14c7543c2639826a473d37a9a4a6","patch":"@@ -6,7 +6,3 @@\n =console=\n \n * check Selenium\n-\n-=core=\n-\n-* statistics?"},{"sha":"a334d3cf2ae406a8d9f2d1e604131c9445848f48","filename":"core/src/main/java/org/syncope/core/monitor/CacheMonitor.java","status":"removed","additions":0,"deletions":106,"changes":106,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/13f880e3cc7ceda21541bb0d8e5660d9a9a1f466/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fcore%2Fmonitor%2FCacheMonitor.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/13f880e3cc7ceda21541bb0d8e5660d9a9a1f466/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fcore%2Fmonitor%2FCacheMonitor.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fcore%2Fmonitor%2FCacheMonitor.java?ref=13f880e3cc7ceda21541bb0d8e5660d9a9a1f466","patch":"@@ -1,106 +0,0 @@\n-/*\n- *  Licensed under the Apache License, Version 2.0 (the \"License\");\n- *  you may not use this file except in compliance with the License.\n- *  You may obtain a copy of the License at\n- *\n- *       http://www.apache.org/licenses/LICENSE-2.0\n- *\n- *  Unless required by applicable law or agreed to in writing, software\n- *  distributed under the License is distributed on an \"AS IS\" BASIS,\n- *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n- *  See the License for the specific language governing permissions and\n- *  limitations under the License.\n- *  under the License.\n- */\n-package org.syncope.core.monitor;\n-\n-import java.text.DecimalFormat;\n-import java.text.NumberFormat;\n-import javax.persistence.EntityManager;\n-import org.aspectj.lang.ProceedingJoinPoint;\n-import org.aspectj.lang.annotation.Around;\n-import org.aspectj.lang.annotation.Aspect;\n-//import org.hibernate.Session;\n-//import org.hibernate.stat.Statistics;\n-import org.slf4j.Logger;\n-import org.slf4j.LoggerFactory;\n-import org.springframework.beans.factory.annotation.Autowired;\n-\n-/**\n- * Log cache hits and misses.\n- */\n-@Aspect\n-public class CacheMonitor {\n-\n-    /**\n-     * Logger.\n-     */\n-    private static final Logger LOG = LoggerFactory.getLogger(\n-            CacheMonitor.class);\n-\n-    /**\n-     * Number formatter for hit / miss percentage.\n-     */\n-    private static final ThreadLocal<NumberFormat> PERCENT_FORMAT =\n-            new ThreadLocal<NumberFormat>() {\n-\n-                @Override\n-                protected NumberFormat initialValue() {\n-                    return new DecimalFormat(\"0.0###\");\n-                }\n-            };\n-\n-    /**\n-     * EntityManager.\n-     */\n-    @Autowired\n-    private EntityManager entityManager;\n-\n-    /**\n-     * Intercept any DAO method call and use Hibernate's statistics features to\n-     * log cache access.\n-     *\n-     * @param pjp Aspect's ProceedingJoinPoint\n-     * @return DAO method's return value\n-     * @throws Throwable if anything goes wrong\n-     */\n-    @Around(\"execution(* org.syncope.core.persistence.dao..*.*(..))\")\n-    public final Object log(final ProceedingJoinPoint pjp)\n-            throws Throwable {\n-\n-        Object result;\n-        /*if (!LOG.isDebugEnabled()) {*/\n-            result = pjp.proceed();\n-        /*} else {\n-            Statistics statistics =\n-                    ((Session) entityManager.getDelegate()).getSessionFactory().\n-                    getStatistics();\n-            //statistics.logSummary();\n-\n-            final long hit0 = statistics.getQueryCacheHitCount();\n-            final long miss0 = statistics.getQueryCacheMissCount();\n-\n-            result = pjp.proceed();\n-\n-            final long hit1 = statistics.getQueryCacheHitCount();\n-            final long miss1 = statistics.getQueryCacheMissCount();\n-\n-            final String ratio = PERCENT_FORMAT.get().\n-                    format((double) hit1 / (hit1 + miss1));\n-\n-            if (hit1 > hit0) {\n-                LOG.debug(\n-                        String.format(\"CACHE HIT; Ratio=%s; Signature=%s#%s()\",\n-                        ratio, pjp.getTarget().getClass().getName(),\n-                        pjp.getSignature().toShortString()));\n-            } else if (miss1 > miss0) {\n-                LOG.debug(\n-                        String.format(\"CACHE MISS; Ratio=%s; Signature=%s#%s()\",\n-                        ratio, pjp.getTarget().getClass().getName(),\n-                        pjp.getSignature().toShortString()));\n-            }\n-        }*/\n-\n-        return result;\n-    }\n-}"},{"sha":"6cc7b6106c56c6149bd1d3218640d3df4aead92b","filename":"core/src/main/resources/logback.xml","status":"modified","additions":0,"deletions":27,"changes":27,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/2c510a41865b14c7543c2639826a473d37a9a4a6/core%2Fsrc%2Fmain%2Fresources%2Flogback.xml","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/2c510a41865b14c7543c2639826a473d37a9a4a6/core%2Fsrc%2Fmain%2Fresources%2Flogback.xml","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fsrc%2Fmain%2Fresources%2Flogback.xml?ref=2c510a41865b14c7543c2639826a473d37a9a4a6","patch":"@@ -74,18 +74,6 @@\n         </encoder>\n     </appender>\n \n-    <appender name=\"monitor\" class=\"ch.qos.logback.core.rolling.RollingFileAppender\">\n-        <file>${log.directory}/core-monitor.log</file>\n-        <append>true</append>\n-        <rollingPolicy class=\"ch.qos.logback.core.rolling.TimeBasedRollingPolicy\">\n-            <fileNamePattern>${log.directory}/core-monitor.log.%d{yyyy-MM-dd}</fileNamePattern>\n-            <maxHistory>30</maxHistory>\n-        </rollingPolicy>\n-        <encoder>\n-            <pattern>%d{HH:mm:ss.SSS} %-5level %logger - %msg%n</pattern>\n-        </encoder>\n-    </appender>\n-\n     <logger name=\"org.syncope.client\" additivity=\"false\">\n         <level value=\"OFF\"/>\n         <appender-ref ref=\"main\"/>\n@@ -128,21 +116,6 @@\n         <appender-ref ref=\"test\"/>\n     </logger>\n \n-    <logger name=\"org.syncope.core.monitor\" additivity=\"false\">\n-        <level value=\"INFO\"/>\n-        <appender-ref ref=\"monitor\"/>\n-    </logger>\n-\n-    <logger name=\"org.hibernate.cache\" additivity=\"false\">\n-        <level value=\"INFO\"/>\n-        <appender-ref ref=\"monitor\"/>\n-    </logger>\n-    \n-    <logger name=\"org.hibernate.hql.ast\" additivity=\"false\">\n-        <level value=\"ERROR\"/>\n-        <appender-ref ref=\"monitor\"/>\n-    </logger>\n-\n     <logger name=\"org.springframework\" additivity=\"false\">\n         <level value=\"INFO\"/>\n         <appender-ref ref=\"main\"/>"},{"sha":"59bb82ce75c9f961cf96cfee7be1b087e6886693","filename":"core/src/main/resources/persistenceContext.xml","status":"modified","additions":0,"deletions":1,"changes":1,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/2c510a41865b14c7543c2639826a473d37a9a4a6/core%2Fsrc%2Fmain%2Fresources%2FpersistenceContext.xml","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/2c510a41865b14c7543c2639826a473d37a9a4a6/core%2Fsrc%2Fmain%2Fresources%2FpersistenceContext.xml","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fsrc%2Fmain%2Fresources%2FpersistenceContext.xml?ref=2c510a41865b14c7543c2639826a473d37a9a4a6","patch":"@@ -34,7 +34,6 @@\n     <context:component-scan base-package=\"org.syncope.core.policy\"/>\n \n     <aop:aspectj-autoproxy/>\n-    <bean class=\"org.syncope.core.monitor.CacheMonitor\"/>\n \n     <bean id=\"xStream\" class=\"com.thoughtworks.xstream.XStream\"/>\n "},{"sha":"5e949577d3c41ca7653ec22796ff6904a0f4a890","filename":"core/src/main/webapp/cacheStats.jsp","status":"added","additions":140,"deletions":0,"changes":140,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/2c510a41865b14c7543c2639826a473d37a9a4a6/core%2Fsrc%2Fmain%2Fwebapp%2FcacheStats.jsp","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/2c510a41865b14c7543c2639826a473d37a9a4a6/core%2Fsrc%2Fmain%2Fwebapp%2FcacheStats.jsp","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fsrc%2Fmain%2Fwebapp%2FcacheStats.jsp?ref=2c510a41865b14c7543c2639826a473d37a9a4a6","patch":"@@ -0,0 +1,140 @@\n+<%@page contentType=\"text/html; charset=UTF-8\" pageEncoding=\"UTF-8\"%>\n+<%@taglib uri=\"http://java.sun.com/jsp/jstl/core\" prefix=\"c\"%>\n+<%@taglib uri=\"http://java.sun.com/jsp/jstl/functions\" prefix=\"fn\"%>\n+<%@page import=\"org.syncope.client.SyncopeConstants\"%>\n+<%@page import=\"java.text.SimpleDateFormat\"%>\n+<%@page import=\"java.util.Date\"%>\n+<%@page import=\"org.apache.openjpa.datacache.CacheStatisticsImpl\"%>\n+<%@page import=\"javax.persistence.EntityManagerFactory\"%>\n+<%@page import=\"org.apache.openjpa.persistence.OpenJPAPersistence\"%>\n+<%@page import=\"org.apache.openjpa.persistence.OpenJPAEntityManagerFactory\"%>\n+<%@page import=\"org.syncope.core.util.ApplicationContextManager\"%>\n+<%@page import=\"org.springframework.context.ConfigurableApplicationContext\"%>\n+<!DOCTYPE html PUBLIC \"-//W3C//DTD HTML 4.01 Transitional//EN\" \"http://www.w3.org/TR/html4/loose.dtd\">\n+<html>\n+    <head>\n+        <meta http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\">\n+        <title>Cache Statistics</title>\n+        <style type=\"text/css\">\n+            .c{\n+                text-align: center;\n+            }\n+            .r{\n+                text-align: right;\n+            }\n+            .l{\n+                text-align: left;\n+            }\n+            .t{\n+                vertical-align: top;\n+            }\n+            .b{\n+                vertical-align: bottom;\n+            }\n+            .odd{\n+                background-color: #D4D4D4;\n+            }\n+            .even{\n+                background-color: #EEEEEE;\n+            }\n+            .bd1{\n+                border: solid #888888 1px;\n+            }\n+            .bg1{\n+                background-color: #CCCCCC;\n+            }\n+            .bg2{\n+                background-color: #DDDDDD;\n+            }\n+        </style>\n+    </head>\n+    <body>\n+        <p/>\n+        <%\n+            ConfigurableApplicationContext context =\n+                    ApplicationContextManager.getApplicationContext();\n+\n+            EntityManagerFactory emf = context.getBean(\n+                    EntityManagerFactory.class);\n+            OpenJPAEntityManagerFactory oemf = OpenJPAPersistence.cast(emf);\n+            CacheStatisticsImpl statistics = (CacheStatisticsImpl) oemf.\n+                    getStoreCache().getStatistics();\n+\n+            String action = request.getParameter(\"do\");\n+            StringBuilder info = new StringBuilder(512);\n+\n+            if (\"activate\".equals(action)\n+                    && !statistics.isEnabled()) {\n+\n+                statistics.enable();\n+                info.append(\"Statistics enabled\\n\");\n+            } else if (\"deactivate\".equals(action)\n+                    && !statistics.isEnabled()) {\n+\n+                statistics.disable();\n+                info.append(\"Statistics disabled\\n\");\n+            } else if (\"clear\".equals(action)) {\n+                statistics.reset();\n+                info.append(\"Statistics cleared\\n\");\n+            }\n+\n+            SimpleDateFormat sdf = new SimpleDateFormat(\n+                    SyncopeConstants.DEFAULT_DATE_PATTERN);\n+            if (info.length() > 0) {\n+        %>\n+        <p/><div class=\"success\">\n+            <c:out value=\"${fn:escapeXml(info)}\"/>\n+        </div>\n+        <%                    }%>\n+        <p/>\n+        <a href=\"?\">Reload</a>\n+        <p/>\n+           <a href=\"?do=<%=(statistics.isEnabled()\n+                   ? \"deactivate\" : \"activate\")%>\">\n+            <%=(statistics.isEnabled()\n+                    ? \"DEACTIVATE\" : \"ACTIVATE\")%></a>\n+        <a href=\"?do=clear\">CLEAR</a>\n+        <p/>\n+        Last update: <%=sdf.format(statistics.since())%><br/>\n+        Activation: <%=sdf.format(statistics.start())%><br/>\n+        <p/>\n+        <table>\n+            <tr>\n+                <th class=\"c bd1 bg1\">Hits</th>\n+                <td><%=statistics.getHitCount()%></td>\n+            </tr>\n+            <tr>\n+                <th class=\"c bd1 bg1\">Reads</th>\n+                <td><%=statistics.getHitCount()%></td>\n+            </tr>\n+            <tr>\n+                <th class=\"c bd1 bg1\">Writes</th>\n+                <td><%=statistics.getWriteCount()%></td>\n+            </tr>\n+        </table>\n+        <p/>\n+        <table width=\"100%\">\n+            <tr><th colspan=\"4\" class=\"c bd1 bg2\">2nd level cache statistics</th></tr>\n+            <tr>\n+                <th class=\"c bd1 bg1\">Region</th>\n+                <th class=\"c bd1 bg1\">Hits</th>\n+                <th class=\"c bd1 bg1\">Reads</th>\n+                <th class=\"c bd1 bg1\">Writes</th>\n+            </tr>\n+            <%\n+                boolean odd = true;\n+                for (String className : statistics.classNames()) {\n+            %>\n+            <tr class=\"<%=(odd ? \"odd\" : \"even\")%>\">\n+                <td><%=className%></td>\n+                <td><%=statistics.getHitCount(className)%></td>\n+                <td><%=statistics.getHitCount(className)%></td>\n+                <td><%=statistics.getWriteCount(className)%></td>\n+            </tr>\n+            <%\n+                    odd = !odd;\n+                }\n+            %>\n+        </table>\n+    </body>\n+</html>\n\\ No newline at end of file"},{"sha":"8d297c5651bbd36782829464b4a3137ff0ebcb34","filename":"pom.xml","status":"modified","additions":1,"deletions":1,"changes":2,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/2c510a41865b14c7543c2639826a473d37a9a4a6/pom.xml","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/2c510a41865b14c7543c2639826a473d37a9a4a6/pom.xml","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/pom.xml?ref=2c510a41865b14c7543c2639826a473d37a9a4a6","patch":"@@ -100,7 +100,7 @@\n         <quartz.version>1.8.5</quartz.version>\n \n         <openjpa.version>2.2.0-SNAPSHOT</openjpa.version>\n-        <ehcache.version>2.4.7</ehcache.version>\n+        <ehcache.version>2.5.0</ehcache.version>\n \n         <wicket.version>1.5.3</wicket.version>\n "}]}