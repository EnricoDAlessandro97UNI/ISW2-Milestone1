{"sha":"67568240f72b2bbadf151818f7aa20de24266d80","node_id":"MDY6Q29tbWl0NjM2ODc5MDYyOjY3NTY4MjQwZjcyYjJiYmFkZjE1MTgxOGY3YWEyMGRlMjQyNjZkODA=","commit":{"author":{"name":"fmartelli","email":"fabio.martelli@gmail.com","date":"2017-05-23T09:50:27Z"},"committer":{"name":"fmartelli","email":"fabio.martelli@gmail.com","date":"2017-05-23T09:50:58Z"},"message":"[SYNCOPE-1081] fix the approval + close action link toggle panel when asking for bulk actions","tree":{"sha":"24b0df0cc37d27651280f313fa6fc18b05e646e6","url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/git/trees/24b0df0cc37d27651280f313fa6fc18b05e646e6"},"url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/git/commits/67568240f72b2bbadf151818f7aa20de24266d80","comment_count":0,"verification":{"verified":false,"reason":"unsigned","signature":null,"payload":null}},"url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/67568240f72b2bbadf151818f7aa20de24266d80","html_url":"https://github.com/EnricoDAlessandro97UNI/syncope/commit/67568240f72b2bbadf151818f7aa20de24266d80","comments_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/67568240f72b2bbadf151818f7aa20de24266d80/comments","author":{"login":"fmartelli","id":1791932,"node_id":"MDQ6VXNlcjE3OTE5MzI=","avatar_url":"https://avatars.githubusercontent.com/u/1791932?v=4","gravatar_id":"","url":"https://api.github.com/users/fmartelli","html_url":"https://github.com/fmartelli","followers_url":"https://api.github.com/users/fmartelli/followers","following_url":"https://api.github.com/users/fmartelli/following{/other_user}","gists_url":"https://api.github.com/users/fmartelli/gists{/gist_id}","starred_url":"https://api.github.com/users/fmartelli/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/fmartelli/subscriptions","organizations_url":"https://api.github.com/users/fmartelli/orgs","repos_url":"https://api.github.com/users/fmartelli/repos","events_url":"https://api.github.com/users/fmartelli/events{/privacy}","received_events_url":"https://api.github.com/users/fmartelli/received_events","type":"User","site_admin":false},"committer":{"login":"fmartelli","id":1791932,"node_id":"MDQ6VXNlcjE3OTE5MzI=","avatar_url":"https://avatars.githubusercontent.com/u/1791932?v=4","gravatar_id":"","url":"https://api.github.com/users/fmartelli","html_url":"https://github.com/fmartelli","followers_url":"https://api.github.com/users/fmartelli/followers","following_url":"https://api.github.com/users/fmartelli/following{/other_user}","gists_url":"https://api.github.com/users/fmartelli/gists{/gist_id}","starred_url":"https://api.github.com/users/fmartelli/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/fmartelli/subscriptions","organizations_url":"https://api.github.com/users/fmartelli/orgs","repos_url":"https://api.github.com/users/fmartelli/repos","events_url":"https://api.github.com/users/fmartelli/events{/privacy}","received_events_url":"https://api.github.com/users/fmartelli/received_events","type":"User","site_admin":false},"parents":[{"sha":"5d1a0f00edc651d4a37e80ddd9a1bc1b24736e50","url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/5d1a0f00edc651d4a37e80ddd9a1bc1b24736e50","html_url":"https://github.com/EnricoDAlessandro97UNI/syncope/commit/5d1a0f00edc651d4a37e80ddd9a1bc1b24736e50"}],"stats":{"total":46,"additions":29,"deletions":17},"files":[{"sha":"f40d7c68a321cc1f0bc5289ae01eaac261181025","filename":"client/console/src/main/java/org/apache/syncope/client/console/approvals/ApprovalDirectoryPanel.java","status":"modified","additions":19,"deletions":2,"changes":21,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/67568240f72b2bbadf151818f7aa20de24266d80/client%2Fconsole%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fclient%2Fconsole%2Fapprovals%2FApprovalDirectoryPanel.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/67568240f72b2bbadf151818f7aa20de24266d80/client%2Fconsole%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fclient%2Fconsole%2Fapprovals%2FApprovalDirectoryPanel.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/client%2Fconsole%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fclient%2Fconsole%2Fapprovals%2FApprovalDirectoryPanel.java?ref=67568240f72b2bbadf151818f7aa20de24266d80","patch":"@@ -45,6 +45,7 @@\n import org.apache.wicket.extensions.markup.html.repeater.data.sort.SortOrder;\n import org.apache.wicket.extensions.markup.html.repeater.data.table.IColumn;\n import org.apache.wicket.extensions.markup.html.repeater.data.table.PropertyColumn;\n+import org.apache.wicket.markup.html.form.Form;\n import org.apache.wicket.model.AbstractReadOnlyModel;\n import org.apache.wicket.model.CompoundPropertyModel;\n import org.apache.wicket.model.IModel;\n@@ -132,9 +133,25 @@ public void onClick(final AjaxRequestTarget target, final WorkflowFormTO ignore)\n                 final IModel<WorkflowFormTO> formModel = new CompoundPropertyModel<>(model.getObject());\n                 modal.setFormModel(formModel);\n \n-                target.add(modal.setContent(new ApprovalModal(modal, pageRef, model.getObject())));\n-                modal.header(new Model<>(getString(\"approval.edit\", new Model<>(model.getObject()))));\n+                target.add(modal.setContent(new ApprovalModal(modal, pageRef, model.getObject()) {\n+\n+                    private static final long serialVersionUID = 5546519445061007248L;\n+\n+                    @Override\n+                    public void onSubmit(final AjaxRequestTarget target, final Form<?> form) {\n+                        try {\n+                            super.onSubmit(target, form);\n \n+                            ApprovalDirectoryPanel.this.getTogglePanel().close(target);\n+                        } catch (SyncopeClientException e) {\n+                            SyncopeConsoleSession.get().error(getString(Constants.ERROR) + \": \" + e.getMessage());\n+                        }\n+                        ((BasePage) pageRef.getPage()).getNotificationPanel().refresh(target);\n+                    }\n+\n+                }));\n+                \n+                modal.header(new Model<>(getString(\"approval.edit\", new Model<>(model.getObject()))));\n                 modal.show(true);\n             }\n "},{"sha":"4a75c06468659eeeffed5eba977a4d97bc4ba6c4","filename":"client/console/src/main/java/org/apache/syncope/client/console/approvals/ApprovalModal.java","status":"modified","additions":4,"deletions":12,"changes":16,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/67568240f72b2bbadf151818f7aa20de24266d80/client%2Fconsole%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fclient%2Fconsole%2Fapprovals%2FApprovalModal.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/67568240f72b2bbadf151818f7aa20de24266d80/client%2Fconsole%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fclient%2Fconsole%2Fapprovals%2FApprovalModal.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/client%2Fconsole%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fclient%2Fconsole%2Fapprovals%2FApprovalModal.java?ref=67568240f72b2bbadf151818f7aa20de24266d80","patch":"@@ -24,7 +24,6 @@\n import org.apache.syncope.client.console.panels.MultilevelPanel;\n import org.apache.syncope.client.console.rest.UserWorkflowRestClient;\n import org.apache.syncope.client.console.wicket.markup.html.bootstrap.dialog.BaseModal;\n-import org.apache.syncope.common.lib.SyncopeClientException;\n import org.apache.syncope.common.lib.to.WorkflowFormTO;\n import org.apache.wicket.PageReference;\n import org.apache.wicket.ajax.AjaxRequestTarget;\n@@ -65,17 +64,10 @@ protected void viewDetails(final WorkflowFormTO formTO, final AjaxRequestTarget\n \n     @Override\n     public void onSubmit(final AjaxRequestTarget target, final Form<?> form) {\n-        try {\n-            new UserWorkflowRestClient().submitForm(formTO);\n-\n-            this.modal.show(false);\n-            this.modal.close(target);\n-\n-            SyncopeConsoleSession.get().info(getString(Constants.OPERATION_SUCCEEDED));\n-        } catch (SyncopeClientException e) {\n-            SyncopeConsoleSession.get().error(getString(Constants.ERROR) + \": \" + e.getMessage());\n-        }\n-        ((BasePage) pageRef.getPage()).getNotificationPanel().refresh(target);\n+        new UserWorkflowRestClient().submitForm(formTO);\n+        this.modal.show(false);\n+        this.modal.close(target);\n+        SyncopeConsoleSession.get().info(getString(Constants.OPERATION_SUCCEEDED));\n     }\n \n     @Override"},{"sha":"c2098b2f0b70c0ddcbcf4e659cd32b5c822b8bb5","filename":"client/console/src/main/java/org/apache/syncope/client/console/panels/AjaxDataTablePanel.java","status":"modified","additions":5,"deletions":0,"changes":5,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/67568240f72b2bbadf151818f7aa20de24266d80/client%2Fconsole%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fclient%2Fconsole%2Fpanels%2FAjaxDataTablePanel.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/67568240f72b2bbadf151818f7aa20de24266d80/client%2Fconsole%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fclient%2Fconsole%2Fpanels%2FAjaxDataTablePanel.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/client%2Fconsole%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fclient%2Fconsole%2Fpanels%2FAjaxDataTablePanel.java?ref=67568240f72b2bbadf151818f7aa20de24266d80","patch":"@@ -238,6 +238,11 @@ protected ActionLinksTogglePanel<T> getTogglePanel() {\n \n             @Override\n             protected void onSubmit(final AjaxRequestTarget target, final Form<?> form) {\n+                // send event to close eventually opened actions toggle panel\n+                if (builder.getTogglePanel() != null) {\n+                    builder.getTogglePanel().close(target);\n+                }\n+\n                 if (builder.multiLevelPanel == null) {\n                     bulkModal.header(new ResourceModel(\"bulk.action\", \"Bulk action\"));\n                     bulkModal.changeCloseButtonLabel(getString(\"cancel\", null, \"Cancel\"), target);"},{"sha":"15c6a0d27f8359503f78d641557496b884051739","filename":"client/console/src/main/java/org/apache/syncope/client/console/wicket/extensions/markup/html/repeater/data/table/AjaxFallbackDataTable.java","status":"modified","additions":1,"deletions":3,"changes":4,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/67568240f72b2bbadf151818f7aa20de24266d80/client%2Fconsole%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fclient%2Fconsole%2Fwicket%2Fextensions%2Fmarkup%2Fhtml%2Frepeater%2Fdata%2Ftable%2FAjaxFallbackDataTable.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/67568240f72b2bbadf151818f7aa20de24266d80/client%2Fconsole%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fclient%2Fconsole%2Fwicket%2Fextensions%2Fmarkup%2Fhtml%2Frepeater%2Fdata%2Ftable%2FAjaxFallbackDataTable.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/client%2Fconsole%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fclient%2Fconsole%2Fwicket%2Fextensions%2Fmarkup%2Fhtml%2Frepeater%2Fdata%2Ftable%2FAjaxFallbackDataTable.java?ref=67568240f72b2bbadf151818f7aa20de24266d80","patch":"@@ -129,9 +129,7 @@ protected String findIndicatorId() {\n \n                     @Override\n                     protected void onEvent(final AjaxRequestTarget target) {\n-                        if (target.getLastFocusedElementId() == null\n-                                || (!target.getLastFocusedElementId().startsWith(\"check\")\n-                                && !target.getLastFocusedElementId().startsWith(\"groupselector\"))) {\n+                        if (target.getLastFocusedElementId() == null) {\n                             togglePanel.toggleWithContent(target, getActions(model), model.getObject());\n                         }\n                     }"}]}