{"sha":"bc66c49ac4aa3b6b7ff22b2f9692afbc144e77ee","node_id":"MDY6Q29tbWl0NjM2ODc5MDYyOmJjNjZjNDlhYzRhYTNiNmI3ZmYyMmIyZjk2OTJhZmJjMTQ0ZTc3ZWU=","commit":{"author":{"name":"Unknown","email":"unknown@apache.org","date":"2010-06-25T11:36:17Z"},"committer":{"name":"Unknown","email":"unknown@apache.org","date":"2010-06-25T11:36:17Z"},"message":"New web.xml including resource-ref and integration test handling in pom.xml\n\ngit-svn-id: https://svn.apache.org/repos/asf/incubator/syncope/trunk@1246245 13f79535-47bb-0310-9956-ffa450edef68","tree":{"sha":"7c0266c77b44027a610f2fc5c21f7bb9c71e5be0","url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/git/trees/7c0266c77b44027a610f2fc5c21f7bb9c71e5be0"},"url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/git/commits/bc66c49ac4aa3b6b7ff22b2f9692afbc144e77ee","comment_count":0,"verification":{"verified":false,"reason":"unsigned","signature":null,"payload":null}},"url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/bc66c49ac4aa3b6b7ff22b2f9692afbc144e77ee","html_url":"https://github.com/EnricoDAlessandro97UNI/syncope/commit/bc66c49ac4aa3b6b7ff22b2f9692afbc144e77ee","comments_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/bc66c49ac4aa3b6b7ff22b2f9692afbc144e77ee/comments","author":null,"committer":null,"parents":[{"sha":"52812bbb1f6c9df07b12bf31837df045cce00239","url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/52812bbb1f6c9df07b12bf31837df045cce00239","html_url":"https://github.com/EnricoDAlessandro97UNI/syncope/commit/52812bbb1f6c9df07b12bf31837df045cce00239"}],"stats":{"total":234,"additions":145,"deletions":89},"files":[{"sha":"11c3a3b016ddff96ac7fd913730254065e6e36c9","filename":"client/src/main/java/org/syncope/client/to/AttributeTO.java","status":"removed","additions":0,"deletions":39,"changes":39,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/52812bbb1f6c9df07b12bf31837df045cce00239/client%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fclient%2Fto%2FAttributeTO.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/52812bbb1f6c9df07b12bf31837df045cce00239/client%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fclient%2Fto%2FAttributeTO.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/client%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fclient%2Fto%2FAttributeTO.java?ref=52812bbb1f6c9df07b12bf31837df045cce00239","patch":"@@ -1,39 +0,0 @@\n-/*\n- *  Licensed under the Apache License, Version 2.0 (the \"License\");\n- *  you may not use this file except in compliance with the License.\n- *  You may obtain a copy of the License at\n- *\n- *       http://www.apache.org/licenses/LICENSE-2.0\n- *\n- *  Unless required by applicable law or agreed to in writing, software\n- *  distributed under the License is distributed on an \"AS IS\" BASIS,\n- *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n- *  See the License for the specific language governing permissions and\n- *  limitations under the License.\n- *  under the License.\n- */\n-package org.syncope.client.to;\n-\n-import java.util.Set;\n-\n-public class AttributeTO extends AbstractBaseTO {\n-\n-    private String name;\n-    private Set<String> values;\n-\n-    public String getName() {\n-        return name;\n-    }\n-\n-    public void setName(String name) {\n-        this.name = name;\n-    }\n-\n-    public Set<String> getValues() {\n-        return values;\n-    }\n-\n-    public void setValues(Set<String> values) {\n-        this.values = values;\n-    }\n-}"},{"sha":"04eb45fad20718252456b0dbb4410aa96b8da6d0","filename":"client/src/main/java/org/syncope/client/to/UserTO.java","status":"modified","additions":47,"deletions":16,"changes":63,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/bc66c49ac4aa3b6b7ff22b2f9692afbc144e77ee/client%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fclient%2Fto%2FUserTO.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/bc66c49ac4aa3b6b7ff22b2f9692afbc144e77ee/client%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fclient%2Fto%2FUserTO.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/client%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fclient%2Fto%2FUserTO.java?ref=bc66c49ac4aa3b6b7ff22b2f9692afbc144e77ee","patch":"@@ -14,41 +14,72 @@\n  */\n package org.syncope.client.to;\n \n-import java.util.HashSet;\n+import java.util.HashMap;\n+import java.util.Map;\n import java.util.Set;\n \n public class UserTO extends AbstractBaseTO {\n \n-    private Long id;\n-    private Set<AttributeTO> attributes;\n-    private Set<AttributeTO> derivedAttributes;\n+    private long id;\n+    private String password;\n+    private Set<String> roles;\n+    private Map<String, Set<String>> attributes;\n+    private Map<String, Set<String>> derivedAttributes;\n \n     public UserTO() {\n-        attributes = new HashSet<AttributeTO>();\n-        derivedAttributes = new HashSet<AttributeTO>();\n+        attributes = new HashMap<String, Set<String>>();\n+        derivedAttributes = new HashMap<String, Set<String>>();\n     }\n \n-    public Long getId() {\n+    public long getId() {\n         return id;\n     }\n \n-    public void setId(Long Id) {\n-        this.id = Id;\n+    public void setId(long id) {\n+        this.id = id;\n     }\n \n-    public Set<AttributeTO> getAttributes() {\n+    public String getPassword() {\n+        return password;\n+    }\n+\n+    public void setPassword(String password) {\n+        this.password = password;\n+    }\n+\n+    public boolean addRole(String role) {\n+        return roles.add(role);\n+    }\n+\n+    public boolean removeRole(String role) {\n+        return roles.remove(role);\n+    }\n+\n+    public Set<String> getRoles() {\n+        return roles;\n+    }\n+\n+    public void setRoles(Set<String> roles) {\n+        this.roles = roles;\n+    }\n+\n+    public Set<String> addAttribute(String name, Set<String> values) {\n+        return attributes.put(name, values);\n+    }\n+\n+    public Set<String> removeAttribute(String name) {\n+        return attributes.remove(name);\n+    }\n+\n+    public Map<String, Set<String>> getAttributes() {\n         return attributes;\n     }\n \n-    public void setAttributes(Set<AttributeTO> attributes) {\n+    public void setAttributes(Map<String, Set<String>> attributes) {\n         this.attributes = attributes;\n     }\n \n-    public Set<AttributeTO> getDerivedAttributes() {\n+    public Map<String, Set<String>> getDerivedAttributes() {\n         return derivedAttributes;\n     }\n-\n-    public void setDerivedAttributes(Set<AttributeTO> derivedAttributes) {\n-        this.derivedAttributes = derivedAttributes;\n-    }\n }"},{"sha":"8cdec487626e1548ad151329f10bac0c1cbecd24","filename":"core/pom.xml","status":"modified","additions":61,"deletions":0,"changes":61,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/bc66c49ac4aa3b6b7ff22b2f9692afbc144e77ee/core%2Fpom.xml","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/bc66c49ac4aa3b6b7ff22b2f9692afbc144e77ee/core%2Fpom.xml","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fpom.xml?ref=bc66c49ac4aa3b6b7ff22b2f9692afbc144e77ee","patch":"@@ -261,6 +261,60 @@\n                 </executions>\n             </plugin>\n \n+            <plugin>\n+                <groupId>org.codehaus.mojo</groupId>\n+                <artifactId>xml-maven-plugin</artifactId>\n+                <inherited>true</inherited>\n+                <executions>\n+                    <execution>\n+                        <id>integration-test-web.xml</id>\n+                        <phase>process-resources</phase>\n+                        <goals>\n+                            <goal>transform</goal>\n+                        </goals>\n+                        <configuration>\n+                            <transformationSets>\n+                                <transformationSet>\n+                                    <dir>${basedir}/src/main/webapp/WEB-INF</dir>\n+                                    <includes>\n+                                        <include>web.xml</include>\n+                                    </includes>\n+                                    <outputDir>${project.build.directory}</outputDir>\n+                                    <stylesheet>${basedir}/src/test/resources/web.xsl</stylesheet>\n+                                </transformationSet>\n+                            </transformationSets>\n+                        </configuration>\n+                    </execution>\n+                </executions>\n+            </plugin>\n+\n+            <plugin>\n+                <groupId>org.apache.maven.plugins</groupId>\n+                <artifactId>maven-resources-plugin</artifactId>\n+                <inherited>true</inherited>\n+                <executions>\n+                    <execution>\n+                        <id>restore-web.xml</id>\n+                        <phase>integration-test</phase>\n+                        <goals>\n+                            <goal>copy-resources</goal>\n+                        </goals>\n+                        <configuration>\n+                            <outputDirectory>${project.build.directory}/${project.build.finalName}/WEB-INF</outputDirectory>\n+                            <overwrite>true</overwrite>\n+                            <resources>\n+                                <resource>\n+                                    <directory>src/main/webapp/WEB-INF</directory>\n+                                    <includes>\n+                                        <include>web.xml</include>\n+                                    </includes>\n+                                </resource>\n+                            </resources>\n+                        </configuration>\n+                    </execution>\n+                </executions>\n+            </plugin>\n+\n             <plugin>\n                 <groupId>org.apache.maven.plugins</groupId>\n                 <artifactId>maven-war-plugin</artifactId>\n@@ -278,6 +332,13 @@\n                                 WEB-INF/classes/org/syncope/core/persistence/content.xml\n                             </packagingExcludes>\n                             <webResources>\n+                                <resource>\n+                                    <directory>${project.build.directory}</directory>\n+                                    <targetPath>WEB-INF</targetPath>\n+                                    <includes>\n+                                        <include>web.xml</include>\n+                                    </includes>\n+                                </resource>\n                                 <resource>\n                                     <directory>${project.build.directory}</directory>\n                                     <targetPath>WEB-INF/lib</targetPath>"},{"sha":"ac75d0db68bef72fd8f4044019628ba7c6af9b02","filename":"core/src/main/java/org/syncope/core/rest/controller/UserController.java","status":"modified","additions":3,"deletions":15,"changes":18,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/bc66c49ac4aa3b6b7ff22b2f9692afbc144e77ee/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fcore%2Frest%2Fcontroller%2FUserController.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/bc66c49ac4aa3b6b7ff22b2f9692afbc144e77ee/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fcore%2Frest%2Fcontroller%2FUserController.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fcore%2Frest%2Fcontroller%2FUserController.java?ref=bc66c49ac4aa3b6b7ff22b2f9692afbc144e77ee","patch":"@@ -31,7 +31,6 @@\n import org.springframework.web.context.WebApplicationContext;\n import org.springframework.web.servlet.ModelAndView;\n import org.springframework.web.servlet.support.RequestContextUtils;\n-import org.syncope.client.to.AttributeTO;\n import org.syncope.client.to.SearchParameters;\n import org.syncope.client.to.UserTO;\n import org.syncope.core.persistence.dao.SyncopeUserDAO;\n@@ -86,25 +85,14 @@ public ModelAndView read(@PathVariable(\"userId\") Long userId)\n         usernameValues.add(\"chicchiricco\");\n         usernameValues.add(\"fabio.martelli\");\n \n-        AttributeTO usernameAttribute = new AttributeTO();\n-        usernameAttribute.setName(\"username\");\n-        usernameAttribute.setValues(usernameValues);\n-\n         Set<String> surnameValues = new HashSet<String>();\n         surnameValues.add(\"Chicchiriccò\");\n         surnameValues.add(\"Martelli\");\n \n-        AttributeTO surnameAttribute = new AttributeTO();\n-        surnameAttribute.setName(\"surname\");\n-        surnameAttribute.setValues(surnameValues);\n-\n-        Set<AttributeTO> attributes = new HashSet<AttributeTO>();\n-        attributes.add(usernameAttribute);\n-        attributes.add(surnameAttribute);\n-\n         UserTO userTO = new UserTO();\n-        userTO.setId(userId);\n-        userTO.setAttributes(attributes);\n+        userTO.addAttribute(\"username\", usernameValues);\n+        userTO.addAttribute(\"surname\", surnameValues);\n+        //userTO.setAttributes(attributes);\n \n         ModelAndView mav = new ModelAndView();\n         mav.addObject(userTO);"},{"sha":"5c8c523b75b7041796696f3bd22fc9bb285ad232","filename":"core/src/main/webapp/WEB-INF/sun-web.xml","status":"modified","additions":6,"deletions":5,"changes":11,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/bc66c49ac4aa3b6b7ff22b2f9692afbc144e77ee/core%2Fsrc%2Fmain%2Fwebapp%2FWEB-INF%2Fsun-web.xml","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/bc66c49ac4aa3b6b7ff22b2f9692afbc144e77ee/core%2Fsrc%2Fmain%2Fwebapp%2FWEB-INF%2Fsun-web.xml","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fsrc%2Fmain%2Fwebapp%2FWEB-INF%2Fsun-web.xml?ref=bc66c49ac4aa3b6b7ff22b2f9692afbc144e77ee","patch":"@@ -14,9 +14,10 @@\n   limitations under the License.\n -->\n <sun-web-app error-url=\"\">\n-    <context-root>/syncope</context-root>\n-    <class-loader delegate=\"false\"/>\n-    <jsp-config>\n-        <property name=\"keepgenerated\" value=\"true\"/>\n-    </jsp-config>\n+  <context-root>/syncope</context-root>\n+  <resource-ref>\n+    <res-ref-name>jdbc/syncopeDataSource</res-ref-name>\n+    <jndi-name>jdbc/syncopeDataSource</jndi-name>\n+  </resource-ref>\n+  <class-loader delegate=\"false\"/>\n </sun-web-app>"},{"sha":"2bd326f6c0974f399866a7e918652f0bc6cc057f","filename":"core/src/main/webapp/WEB-INF/web.xml","status":"modified","additions":6,"deletions":0,"changes":6,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/bc66c49ac4aa3b6b7ff22b2f9692afbc144e77ee/core%2Fsrc%2Fmain%2Fwebapp%2FWEB-INF%2Fweb.xml","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/bc66c49ac4aa3b6b7ff22b2f9692afbc144e77ee/core%2Fsrc%2Fmain%2Fwebapp%2FWEB-INF%2Fweb.xml","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fsrc%2Fmain%2Fwebapp%2FWEB-INF%2Fweb.xml?ref=bc66c49ac4aa3b6b7ff22b2f9692afbc144e77ee","patch":"@@ -72,4 +72,10 @@\n         <url-pattern>/*</url-pattern>\n     </filter-mapping>\n \n+    <resource-ref>\n+        <res-ref-name>jdbc/syncopeDataSource</res-ref-name>\n+        <res-type>javax.sql.XADataSource</res-type>\n+        <res-auth>Container</res-auth>\n+    </resource-ref>\n+\n </web-app>"},{"sha":"501c717641fd22b94d563572acc60a79fe2afbe7","filename":"core/src/test/java/org/syncope/core/test/rest/UserTestITCase.java","status":"modified","additions":5,"deletions":14,"changes":19,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/bc66c49ac4aa3b6b7ff22b2f9692afbc144e77ee/core%2Fsrc%2Ftest%2Fjava%2Forg%2Fsyncope%2Fcore%2Ftest%2Frest%2FUserTestITCase.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/bc66c49ac4aa3b6b7ff22b2f9692afbc144e77ee/core%2Fsrc%2Ftest%2Fjava%2Forg%2Fsyncope%2Fcore%2Ftest%2Frest%2FUserTestITCase.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fsrc%2Ftest%2Fjava%2Forg%2Fsyncope%2Fcore%2Ftest%2Frest%2FUserTestITCase.java?ref=bc66c49ac4aa3b6b7ff22b2f9692afbc144e77ee","patch":"@@ -22,21 +22,16 @@\n import org.junit.Test;\n import org.springframework.http.HttpStatus;\n import org.springframework.web.client.HttpStatusCodeException;\n-import org.syncope.client.to.AttributeTO;\n import org.syncope.client.to.SearchParameters;\n import org.syncope.client.to.UserTO;\n \n public class UserTestITCase extends AbstractTestITCase {\n-    \n+\n     @Test\n     public void create() {\n-        AttributeTO attribute = new AttributeTO();\n-        attribute.setName(\"attr1\");\n-        attribute.setValues(Collections.singleton(\"value1\"));\n-\n         UserTO newUserTO = new UserTO();\n-        newUserTO.setId(0L);\n-        newUserTO.setAttributes(Collections.singleton(attribute));\n+        newUserTO.setAttributes(Collections.singletonMap(\"attr1\",\n+                Collections.singleton(\"value1\")));\n \n         UserTO userTO = restTemplate.postForObject(BASE_URL + \"user/create\",\n                 newUserTO, UserTO.class);\n@@ -109,13 +104,9 @@ public void search() {\n \n     @Test\n     public void update() {\n-        AttributeTO attribute = new AttributeTO();\n-        attribute.setName(\"attr1\");\n-        attribute.setValues(Collections.singleton(\"value1\"));\n-\n         UserTO newUserTO = new UserTO();\n-        newUserTO.setId(0L);\n-        newUserTO.setAttributes(Collections.singleton(attribute));\n+        newUserTO.setAttributes(Collections.singletonMap(\"attr1\",\n+                Collections.singleton(\"value1\")));\n \n         UserTO userTO = restTemplate.postForObject(BASE_URL + \"user/update\",\n                 newUserTO, UserTO.class);"},{"sha":"472f425f5a32638c814d7c80346cba67a9f2045d","filename":"core/src/test/resources/web.xsl","status":"added","additions":17,"deletions":0,"changes":17,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/bc66c49ac4aa3b6b7ff22b2f9692afbc144e77ee/core%2Fsrc%2Ftest%2Fresources%2Fweb.xsl","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/bc66c49ac4aa3b6b7ff22b2f9692afbc144e77ee/core%2Fsrc%2Ftest%2Fresources%2Fweb.xsl","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fsrc%2Ftest%2Fresources%2Fweb.xsl?ref=bc66c49ac4aa3b6b7ff22b2f9692afbc144e77ee","patch":"@@ -0,0 +1,17 @@\n+<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n+<xsl:stylesheet xmlns:xsl=\"http://www.w3.org/1999/XSL/Transform\"\n+                xmlns:javaee=\"http://java.sun.com/xml/ns/javaee\"\n+                version=\"1.0\">\n+\n+    <xsl:output method=\"xml\"/>\n+\n+    <xsl:template match=\"javaee:resource-ref\"/>\n+\n+    <xsl:template match=\"node()|@*\">\n+        <xsl:copy>\n+            <xsl:apply-templates select=\"@*\" />\n+            <xsl:apply-templates />\n+        </xsl:copy>\n+    </xsl:template>\n+\n+</xsl:stylesheet>"}]}