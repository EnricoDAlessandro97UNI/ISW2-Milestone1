{"sha":"c880152a92095bde4e962c7d1d827abd27d02990","node_id":"MDY6Q29tbWl0NjM2ODc5MDYyOmM4ODAxNTJhOTIwOTViZGU0ZTk2MmM3ZDFkODI3YWJkMjdkMDI5OTA=","commit":{"author":{"name":"Francesco Chicchiriccò","email":"ilgrosso@apache.org","date":"2019-07-18T13:11:53Z"},"committer":{"name":"Francesco Chicchiriccò","email":"ilgrosso@apache.org","date":"2019-07-18T13:11:53Z"},"message":"Restoring Camel scripting features for Groovy","tree":{"sha":"24cf8425c7fed2298d2c6acc1fac104ec1c4d64e","url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/git/trees/24cf8425c7fed2298d2c6acc1fac104ec1c4d64e"},"url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/git/commits/c880152a92095bde4e962c7d1d827abd27d02990","comment_count":0,"verification":{"verified":false,"reason":"unsigned","signature":null,"payload":null}},"url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/c880152a92095bde4e962c7d1d827abd27d02990","html_url":"https://github.com/EnricoDAlessandro97UNI/syncope/commit/c880152a92095bde4e962c7d1d827abd27d02990","comments_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/c880152a92095bde4e962c7d1d827abd27d02990/comments","author":{"login":"ilgrosso","id":1064664,"node_id":"MDQ6VXNlcjEwNjQ2NjQ=","avatar_url":"https://avatars.githubusercontent.com/u/1064664?v=4","gravatar_id":"","url":"https://api.github.com/users/ilgrosso","html_url":"https://github.com/ilgrosso","followers_url":"https://api.github.com/users/ilgrosso/followers","following_url":"https://api.github.com/users/ilgrosso/following{/other_user}","gists_url":"https://api.github.com/users/ilgrosso/gists{/gist_id}","starred_url":"https://api.github.com/users/ilgrosso/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ilgrosso/subscriptions","organizations_url":"https://api.github.com/users/ilgrosso/orgs","repos_url":"https://api.github.com/users/ilgrosso/repos","events_url":"https://api.github.com/users/ilgrosso/events{/privacy}","received_events_url":"https://api.github.com/users/ilgrosso/received_events","type":"User","site_admin":false},"committer":{"login":"ilgrosso","id":1064664,"node_id":"MDQ6VXNlcjEwNjQ2NjQ=","avatar_url":"https://avatars.githubusercontent.com/u/1064664?v=4","gravatar_id":"","url":"https://api.github.com/users/ilgrosso","html_url":"https://github.com/ilgrosso","followers_url":"https://api.github.com/users/ilgrosso/followers","following_url":"https://api.github.com/users/ilgrosso/following{/other_user}","gists_url":"https://api.github.com/users/ilgrosso/gists{/gist_id}","starred_url":"https://api.github.com/users/ilgrosso/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ilgrosso/subscriptions","organizations_url":"https://api.github.com/users/ilgrosso/orgs","repos_url":"https://api.github.com/users/ilgrosso/repos","events_url":"https://api.github.com/users/ilgrosso/events{/privacy}","received_events_url":"https://api.github.com/users/ilgrosso/received_events","type":"User","site_admin":false},"parents":[{"sha":"2b1b1212a7fed82c88de709580685daf30b14428","url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/2b1b1212a7fed82c88de709580685daf30b14428","html_url":"https://github.com/EnricoDAlessandro97UNI/syncope/commit/2b1b1212a7fed82c88de709580685daf30b14428"}],"stats":{"total":37,"additions":27,"deletions":10},"files":[{"sha":"68ea7c0756343c943cc163ae284466014a94ff9f","filename":"ext/camel/provisioning-camel/pom.xml","status":"modified","additions":4,"deletions":0,"changes":4,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/c880152a92095bde4e962c7d1d827abd27d02990/ext%2Fcamel%2Fprovisioning-camel%2Fpom.xml","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/c880152a92095bde4e962c7d1d827abd27d02990/ext%2Fcamel%2Fprovisioning-camel%2Fpom.xml","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/ext%2Fcamel%2Fprovisioning-camel%2Fpom.xml?ref=c880152a92095bde4e962c7d1d827abd27d02990","patch":"@@ -50,6 +50,10 @@ under the License.\n       <groupId>org.apache.camel</groupId>\n       <artifactId>camel-spring-javaconfig</artifactId>\n     </dependency>\n+    <dependency>\n+      <groupId>org.apache.camel</groupId>\n+      <artifactId>camel-groovy</artifactId>\n+    </dependency>\n     <dependency>\n       <groupId>org.apache.camel</groupId>\n       <artifactId>camel-metrics</artifactId>"},{"sha":"19f8fc20718f0c2e2f58a04f4cb88364663fd896","filename":"ext/camel/provisioning-camel/src/main/java/org/apache/syncope/core/provisioning/camel/SyncopeCamelContext.java","status":"modified","additions":8,"deletions":10,"changes":18,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/c880152a92095bde4e962c7d1d827abd27d02990/ext%2Fcamel%2Fprovisioning-camel%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fprovisioning%2Fcamel%2FSyncopeCamelContext.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/c880152a92095bde4e962c7d1d827abd27d02990/ext%2Fcamel%2Fprovisioning-camel%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fprovisioning%2Fcamel%2FSyncopeCamelContext.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/ext%2Fcamel%2Fprovisioning-camel%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fprovisioning%2Fcamel%2FSyncopeCamelContext.java?ref=c880152a92095bde4e962c7d1d827abd27d02990","patch":"@@ -22,7 +22,6 @@\n import java.util.Arrays;\n import java.util.List;\n import java.util.stream.Collectors;\n-import org.apache.camel.CamelContext;\n import org.apache.camel.component.metrics.routepolicy.MetricsRoutePolicyFactory;\n import org.apache.camel.model.ModelHelper;\n import org.apache.camel.model.RoutesDefinition;\n@@ -49,7 +48,7 @@ public class SyncopeCamelContext {\n \n     private SpringCamelContext camelContext;\n \n-    public CamelContext getCamelContext() {\n+    public SpringCamelContext getCamelContext() {\n         synchronized (this) {\n             if (camelContext == null) {\n                 camelContext = ApplicationContextProvider.getBeanFactory().getBean(SpringCamelContext.class);\n@@ -60,7 +59,7 @@ public CamelContext getCamelContext() {\n                 List<CamelRoute> routes = routeDAO.findAll();\n                 LOG.debug(\"{} route(s) are going to be loaded \", routes.size());\n \n-                loadRouteDefinitions(routes.stream().map(input -> input.getContent()).collect(Collectors.toList()));\n+                loadRouteDefinitions(routes.stream().map(CamelRoute::getContent).collect(Collectors.toList()));\n             }\n         }\n \n@@ -76,22 +75,22 @@ private void loadRouteDefinitions(final List<String> routes) {\n                             + \"</routes>\", StandardCharsets.UTF_8));\n             camelContext.addRouteDefinitions(routeDefs.getRoutes());\n         } catch (Exception e) {\n-            LOG.error(\"While adding route definitions into Camel Context {}\", camelContext, e);\n+            LOG.error(\"While adding route definitions into Camel Context {}\", getCamelContext(), e);\n             throw new CamelException(e);\n         }\n     }\n \n     @Transactional(propagation = Propagation.SUPPORTS)\n     public void updateContext(final String routeKey) {\n-        if (!camelContext.getRouteDefinitions().isEmpty()) {\n-            camelContext.getRouteDefinitions().remove(camelContext.getRouteDefinition(routeKey));\n+        if (!getCamelContext().getRouteDefinitions().isEmpty()) {\n+            getCamelContext().getRouteDefinitions().remove(getCamelContext().getRouteDefinition(routeKey));\n             loadRouteDefinitions(Arrays.asList(routeDAO.find(routeKey).getContent()));\n         }\n     }\n \n     public void restoreRoute(final String routeKey, final String routeContent) {\n         try {\n-            camelContext.getRouteDefinitions().remove(camelContext.getRouteDefinition(routeKey));\n+            getCamelContext().getRouteDefinitions().remove(getCamelContext().getRouteDefinition(routeKey));\n             loadRouteDefinitions(Arrays.asList(routeContent));\n         } catch (Exception e) {\n             LOG.error(\"While restoring Camel route {}\", routeKey, e);\n@@ -101,12 +100,11 @@ public void restoreRoute(final String routeKey, final String routeContent) {\n \n     public void restartContext() {\n         try {\n-            camelContext.stop();\n-            camelContext.start();\n+            getCamelContext().stop();\n+            getCamelContext().start();\n         } catch (Exception e) {\n             LOG.error(\"While restarting Camel context\", e);\n             throw new CamelException(e);\n         }\n     }\n-\n }"},{"sha":"ddf0e086cd3acf729abf3a1b6dd38480f89249d0","filename":"pom.xml","status":"modified","additions":15,"deletions":0,"changes":15,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/c880152a92095bde4e962c7d1d827abd27d02990/pom.xml","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/c880152a92095bde4e962c7d1d827abd27d02990/pom.xml","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/pom.xml?ref=c880152a92095bde4e962c7d1d827abd27d02990","patch":"@@ -731,6 +731,21 @@ under the License.\n           </exclusion>\n         </exclusions>\n       </dependency>\n+      <dependency>\n+        <groupId>org.apache.camel</groupId>\n+        <artifactId>camel-groovy</artifactId>\n+        <version>${camel.version}</version>\n+        <exclusions>\n+          <exclusion>\n+            <groupId>com.sun.xml.bind</groupId>\n+            <artifactId>jaxb-core</artifactId>\n+          </exclusion>\n+          <exclusion>\n+            <groupId>com.sun.xml.bind</groupId>\n+            <artifactId>jaxb-impl</artifactId>\n+          </exclusion>\n+        </exclusions>\n+      </dependency>\n       <dependency>\n         <groupId>org.apache.camel</groupId>\n         <artifactId>camel-metrics</artifactId>"}]}