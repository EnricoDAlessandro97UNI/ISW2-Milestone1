{"sha":"d81f4c8207e0da8da54ec53dc6413b211b14d986","node_id":"MDY6Q29tbWl0NjM2ODc5MDYyOmQ4MWY0YzgyMDdlMGRhOGRhNTRlYzUzZGM2NDEzYjIxMWIxNGQ5ODY=","commit":{"author":{"name":"Francesco Chicchiriccò","email":"ilgrosso@apache.org","date":"2019-11-22T13:52:37Z"},"committer":{"name":"Francesco Chicchiriccò","email":"ilgrosso@apache.org","date":"2019-11-22T13:53:31Z"},"message":"[SYNCOPE-1499] Fix: usernames are to be returned, not keys","tree":{"sha":"514a1e7cb1b404b55e52a5f4c4a23662208ccc56","url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/git/trees/514a1e7cb1b404b55e52a5f4c4a23662208ccc56"},"url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/git/commits/d81f4c8207e0da8da54ec53dc6413b211b14d986","comment_count":0,"verification":{"verified":false,"reason":"unsigned","signature":null,"payload":null}},"url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/d81f4c8207e0da8da54ec53dc6413b211b14d986","html_url":"https://github.com/EnricoDAlessandro97UNI/syncope/commit/d81f4c8207e0da8da54ec53dc6413b211b14d986","comments_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/d81f4c8207e0da8da54ec53dc6413b211b14d986/comments","author":{"login":"ilgrosso","id":1064664,"node_id":"MDQ6VXNlcjEwNjQ2NjQ=","avatar_url":"https://avatars.githubusercontent.com/u/1064664?v=4","gravatar_id":"","url":"https://api.github.com/users/ilgrosso","html_url":"https://github.com/ilgrosso","followers_url":"https://api.github.com/users/ilgrosso/followers","following_url":"https://api.github.com/users/ilgrosso/following{/other_user}","gists_url":"https://api.github.com/users/ilgrosso/gists{/gist_id}","starred_url":"https://api.github.com/users/ilgrosso/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ilgrosso/subscriptions","organizations_url":"https://api.github.com/users/ilgrosso/orgs","repos_url":"https://api.github.com/users/ilgrosso/repos","events_url":"https://api.github.com/users/ilgrosso/events{/privacy}","received_events_url":"https://api.github.com/users/ilgrosso/received_events","type":"User","site_admin":false},"committer":{"login":"ilgrosso","id":1064664,"node_id":"MDQ6VXNlcjEwNjQ2NjQ=","avatar_url":"https://avatars.githubusercontent.com/u/1064664?v=4","gravatar_id":"","url":"https://api.github.com/users/ilgrosso","html_url":"https://github.com/ilgrosso","followers_url":"https://api.github.com/users/ilgrosso/followers","following_url":"https://api.github.com/users/ilgrosso/following{/other_user}","gists_url":"https://api.github.com/users/ilgrosso/gists{/gist_id}","starred_url":"https://api.github.com/users/ilgrosso/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ilgrosso/subscriptions","organizations_url":"https://api.github.com/users/ilgrosso/orgs","repos_url":"https://api.github.com/users/ilgrosso/repos","events_url":"https://api.github.com/users/ilgrosso/events{/privacy}","received_events_url":"https://api.github.com/users/ilgrosso/received_events","type":"User","site_admin":false},"parents":[{"sha":"80cbe283ebd5858a00a6d50ddd035f2ada72d415","url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/80cbe283ebd5858a00a6d50ddd035f2ada72d415","html_url":"https://github.com/EnricoDAlessandro97UNI/syncope/commit/80cbe283ebd5858a00a6d50ddd035f2ada72d415"}],"stats":{"total":13,"additions":7,"deletions":6},"files":[{"sha":"32d33957af39d0d34ef489f1dc9c7ef0a7b35027","filename":"ext/oidcclient/logic/src/main/java/org/apache/syncope/core/logic/oidc/OIDCUserManager.java","status":"modified","additions":2,"deletions":1,"changes":3,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/d81f4c8207e0da8da54ec53dc6413b211b14d986/ext%2Foidcclient%2Flogic%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Flogic%2Foidc%2FOIDCUserManager.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/d81f4c8207e0da8da54ec53dc6413b211b14d986/ext%2Foidcclient%2Flogic%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Flogic%2Foidc%2FOIDCUserManager.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/ext%2Foidcclient%2Flogic%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Flogic%2Foidc%2FOIDCUserManager.java?ref=d81f4c8207e0da8da54ec53dc6413b211b14d986","patch":"@@ -38,6 +38,7 @@\n import org.apache.syncope.core.persistence.api.dao.UserDAO;\n import org.apache.syncope.core.persistence.api.entity.OIDCProvider;\n import org.apache.syncope.core.persistence.api.entity.OIDCProviderItem;\n+import org.apache.syncope.core.persistence.api.entity.user.User;\n import org.apache.syncope.core.provisioning.api.IntAttrName;\n import org.apache.syncope.core.provisioning.api.OIDCProviderActions;\n import org.apache.syncope.core.provisioning.api.UserProvisioningManager;\n@@ -83,7 +84,7 @@ public List<String> findMatchingUser(final String connObjectKeyValue, final OIDC\n         return inboundMatcher.matchByConnObjectKeyValue(\n                 connObjectKeyItem, connObjectKeyValue, AnyTypeKind.USER, false, null).stream().\n                 filter(match -> match.getAny() != null).\n-                map(match -> match.getAny().getKey()).\n+                map(match -> ((User) match.getAny()).getUsername()).\n                 collect(Collectors.toList());\n     }\n "},{"sha":"b63318db9a757d45bc4cd2b1b4da0dee68c07a33","filename":"ext/saml2sp/logic/src/main/java/org/apache/syncope/core/logic/SAML2SPLogic.java","status":"modified","additions":3,"deletions":4,"changes":7,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/d81f4c8207e0da8da54ec53dc6413b211b14d986/ext%2Fsaml2sp%2Flogic%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Flogic%2FSAML2SPLogic.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/d81f4c8207e0da8da54ec53dc6413b211b14d986/ext%2Fsaml2sp%2Flogic%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Flogic%2FSAML2SPLogic.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/ext%2Fsaml2sp%2Flogic%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Flogic%2FSAML2SPLogic.java?ref=d81f4c8207e0da8da54ec53dc6413b211b14d986","patch":"@@ -519,8 +519,8 @@ public SAML2LoginResponseTO validateLoginResponse(final SAML2ReceivedResponseTO\n             if (idp.isUpdateMatching()) {\n                 LOG.debug(\"About to update {} for {}\", matchingUsers.get(0), keyValue);\n \n-                username = AuthContextUtils.callAsAdmin(AuthContextUtils.getDomain(), ()\n-                        -> userManager.update(matchingUsers.get(0), idp, responseTO));\n+                username = AuthContextUtils.callAsAdmin(AuthContextUtils.getDomain(),\n+                        () -> userManager.update(matchingUsers.get(0), idp, responseTO));\n             } else {\n                 username = matchingUsers.get(0);\n             }\n@@ -539,8 +539,7 @@ public SAML2LoginResponseTO validateLoginResponse(final SAML2ReceivedResponseTO\n         byte[] authorities = null;\n         try {\n             authorities = ENCRYPTOR.encode(POJOHelper.serialize(\n-                    authDataAccessor.getAuthorities(responseTO.getUsername())), CipherAlgorithm.AES).\n-                    getBytes();\n+                    authDataAccessor.getAuthorities(responseTO.getUsername())), CipherAlgorithm.AES).getBytes();\n         } catch (Exception e) {\n             LOG.error(\"Could not fetch authorities\", e);\n         }"},{"sha":"1d33f34e0897a312460019a918112bca0a877756","filename":"ext/saml2sp/logic/src/main/java/org/apache/syncope/core/logic/saml2/SAML2UserManager.java","status":"modified","additions":2,"deletions":1,"changes":3,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/d81f4c8207e0da8da54ec53dc6413b211b14d986/ext%2Fsaml2sp%2Flogic%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Flogic%2Fsaml2%2FSAML2UserManager.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/d81f4c8207e0da8da54ec53dc6413b211b14d986/ext%2Fsaml2sp%2Flogic%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Flogic%2Fsaml2%2FSAML2UserManager.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/ext%2Fsaml2sp%2Flogic%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Flogic%2Fsaml2%2FSAML2UserManager.java?ref=d81f4c8207e0da8da54ec53dc6413b211b14d986","patch":"@@ -40,6 +40,7 @@\n import org.apache.syncope.core.persistence.api.dao.SAML2IdPDAO;\n import org.apache.syncope.core.persistence.api.dao.UserDAO;\n import org.apache.syncope.core.persistence.api.entity.SAML2IdP;\n+import org.apache.syncope.core.persistence.api.entity.user.User;\n import org.apache.syncope.core.provisioning.api.IntAttrName;\n import org.apache.syncope.core.provisioning.api.SAML2IdPActions;\n import org.apache.syncope.core.provisioning.api.UserProvisioningManager;\n@@ -97,7 +98,7 @@ public List<String> findMatchingUser(final String connObjectKeyValue, final Stri\n         return inboundMatcher.matchByConnObjectKeyValue(\n                 idp.getConnObjectKeyItem().get(), connObjectKeyValue, AnyTypeKind.USER, false, null).stream().\n                 filter(match -> match.getAny() != null).\n-                map(match -> match.getAny().getKey()).\n+                map(match -> ((User) match.getAny()).getUsername()).\n                 collect(Collectors.toList());\n     }\n "}]}