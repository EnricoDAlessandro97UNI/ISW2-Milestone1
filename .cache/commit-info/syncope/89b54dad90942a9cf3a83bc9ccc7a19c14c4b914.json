{"sha":"89b54dad90942a9cf3a83bc9ccc7a19c14c4b914","node_id":"MDY6Q29tbWl0NjM2ODc5MDYyOjg5YjU0ZGFkOTA5NDJhOWNmM2E4M2JjOWNjYzdhMTljMTRjNGI5MTQ=","commit":{"author":{"name":"massi","email":"massimiliano.perrone@tirasa.net","date":"2015-10-14T09:41:39Z"},"committer":{"name":"massi","email":"massimiliano.perrone@tirasa.net","date":"2015-10-14T09:41:39Z"},"message":"Fixed SYNCOPE-708","tree":{"sha":"3aa28b50a6c4e6a37390e72a87ac034c2b993583","url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/git/trees/3aa28b50a6c4e6a37390e72a87ac034c2b993583"},"url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/git/commits/89b54dad90942a9cf3a83bc9ccc7a19c14c4b914","comment_count":0,"verification":{"verified":false,"reason":"unsigned","signature":null,"payload":null}},"url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/89b54dad90942a9cf3a83bc9ccc7a19c14c4b914","html_url":"https://github.com/EnricoDAlessandro97UNI/syncope/commit/89b54dad90942a9cf3a83bc9ccc7a19c14c4b914","comments_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/89b54dad90942a9cf3a83bc9ccc7a19c14c4b914/comments","author":{"login":"massx1","id":1792923,"node_id":"MDQ6VXNlcjE3OTI5MjM=","avatar_url":"https://avatars.githubusercontent.com/u/1792923?v=4","gravatar_id":"","url":"https://api.github.com/users/massx1","html_url":"https://github.com/massx1","followers_url":"https://api.github.com/users/massx1/followers","following_url":"https://api.github.com/users/massx1/following{/other_user}","gists_url":"https://api.github.com/users/massx1/gists{/gist_id}","starred_url":"https://api.github.com/users/massx1/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/massx1/subscriptions","organizations_url":"https://api.github.com/users/massx1/orgs","repos_url":"https://api.github.com/users/massx1/repos","events_url":"https://api.github.com/users/massx1/events{/privacy}","received_events_url":"https://api.github.com/users/massx1/received_events","type":"User","site_admin":false},"committer":{"login":"massx1","id":1792923,"node_id":"MDQ6VXNlcjE3OTI5MjM=","avatar_url":"https://avatars.githubusercontent.com/u/1792923?v=4","gravatar_id":"","url":"https://api.github.com/users/massx1","html_url":"https://github.com/massx1","followers_url":"https://api.github.com/users/massx1/followers","following_url":"https://api.github.com/users/massx1/following{/other_user}","gists_url":"https://api.github.com/users/massx1/gists{/gist_id}","starred_url":"https://api.github.com/users/massx1/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/massx1/subscriptions","organizations_url":"https://api.github.com/users/massx1/orgs","repos_url":"https://api.github.com/users/massx1/repos","events_url":"https://api.github.com/users/massx1/events{/privacy}","received_events_url":"https://api.github.com/users/massx1/received_events","type":"User","site_admin":false},"parents":[{"sha":"6852628030c6492a85fbaeaa81d9001315f5d985","url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/6852628030c6492a85fbaeaa81d9001315f5d985","html_url":"https://github.com/EnricoDAlessandro97UNI/syncope/commit/6852628030c6492a85fbaeaa81d9001315f5d985"}],"stats":{"total":63,"additions":55,"deletions":8},"files":[{"sha":"20b83473cd422e449d34395b931dbccd26f92a68","filename":"common/lib/src/main/java/org/apache/syncope/common/lib/types/Entitlement.java","status":"modified","additions":4,"deletions":0,"changes":4,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/89b54dad90942a9cf3a83bc9ccc7a19c14c4b914/common%2Flib%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcommon%2Flib%2Ftypes%2FEntitlement.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/89b54dad90942a9cf3a83bc9ccc7a19c14c4b914/common%2Flib%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcommon%2Flib%2Ftypes%2FEntitlement.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/common%2Flib%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcommon%2Flib%2Ftypes%2FEntitlement.java?ref=89b54dad90942a9cf3a83bc9ccc7a19c14c4b914","patch":"@@ -222,6 +222,8 @@ public final class Entitlement {\n \n     public static final String REPORT_EXECUTE = \"REPORT_EXECUTE\";\n \n+    public static final String LOG_READ = \"LOG_READ\";\n+\n     public static final String LOG_LIST = \"LOG_LIST\";\n \n     public static final String LOG_SET_LEVEL = \"LOG_SET_LEVEL\";\n@@ -230,6 +232,8 @@ public final class Entitlement {\n \n     public static final String AUDIT_LIST = \"AUDIT_LIST\";\n \n+    public static final String AUDIT_READ = \"AUDIT_READ\";\n+\n     public static final String AUDIT_ENABLE = \"AUDIT_ENABLE\";\n \n     public static final String AUDIT_DISABLE = \"AUDIT_DISABLE\";"},{"sha":"30e73743f7fa0769a8d070f93ae6f713ae64dc82","filename":"core/logic/src/main/java/org/apache/syncope/core/logic/LoggerLogic.java","status":"modified","additions":26,"deletions":0,"changes":26,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/89b54dad90942a9cf3a83bc9ccc7a19c14c4b914/core%2Flogic%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Flogic%2FLoggerLogic.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/89b54dad90942a9cf3a83bc9ccc7a19c14c4b914/core%2Flogic%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Flogic%2FLoggerLogic.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Flogic%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Flogic%2FLoggerLogic.java?ref=89b54dad90942a9cf3a83bc9ccc7a19c14c4b914","patch":"@@ -134,6 +134,32 @@ private void throwInvalidLogger(final LoggerType type) {\n         throw sce;\n     }\n \n+    @PreAuthorize(\"hasRole('\" + Entitlement.LOG_READ + \"') and authentication.details.domain == \"\n+            + \"T(org.apache.syncope.common.lib.SyncopeConstants).MASTER_DOMAIN\")\n+    @Transactional(readOnly = true)\n+    public LoggerTO readLog(final String name) {\n+        for (final LoggerTO logger : listLogs()) {\n+            if (logger.getKey().equals(name)) {\n+                return logger;\n+            }\n+        }\n+        throw new NotFoundException(\"Logger \" + name);\n+    }\n+\n+    @PreAuthorize(\"hasRole('\" + Entitlement.AUDIT_READ + \"')\")\n+    @Transactional(readOnly = true)\n+    public LoggerTO readAudit(final String name) {\n+        for (final AuditLoggerName logger : listAudits()) {\n+            if (logger.toLoggerName().equals(name)) {\n+                final LoggerTO loggerTO = new LoggerTO();\n+                loggerTO.setKey(logger.toLoggerName());\n+                loggerTO.setLevel(LoggerLevel.DEBUG);\n+                return loggerTO;\n+            }\n+        }\n+        throw new NotFoundException(\"Logger \" + name);\n+    }\n+\n     private LoggerTO setLevel(final String name, final Level level, final LoggerType expectedType) {\n         Logger syncopeLogger = loggerDAO.find(name);\n         if (syncopeLogger == null) {"},{"sha":"32ae12c9a04d768c462c6b50ed888affba77263a","filename":"core/rest-cxf/src/main/java/org/apache/syncope/core/rest/cxf/service/LoggerServiceImpl.java","status":"modified","additions":9,"deletions":7,"changes":16,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/89b54dad90942a9cf3a83bc9ccc7a19c14c4b914/core%2Frest-cxf%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Frest%2Fcxf%2Fservice%2FLoggerServiceImpl.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/89b54dad90942a9cf3a83bc9ccc7a19c14c4b914/core%2Frest-cxf%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Frest%2Fcxf%2Fservice%2FLoggerServiceImpl.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Frest-cxf%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Frest%2Fcxf%2Fservice%2FLoggerServiceImpl.java?ref=89b54dad90942a9cf3a83bc9ccc7a19c14c4b914","patch":"@@ -21,7 +21,6 @@\n import java.text.ParseException;\n import java.util.List;\n import javax.ws.rs.BadRequestException;\n-import javax.ws.rs.NotFoundException;\n import org.apache.syncope.common.lib.to.EventCategoryTO;\n import org.apache.syncope.common.lib.to.LoggerTO;\n import org.apache.syncope.common.lib.types.AuditLoggerName;\n@@ -76,13 +75,16 @@ public List<LoggerTO> list(final LoggerType type) {\n \n     @Override\n     public LoggerTO read(final LoggerType type, final String name) {\n-        List<LoggerTO> logger = list(type);\n-        for (LoggerTO l : logger) {\n-            if (l.getKey().equals(name)) {\n-                return l;\n-            }\n+        switch (type) {\n+            case LOG:\n+                return logic.readLog(name);\n+\n+            case AUDIT:\n+                return logic.readAudit(name);\n+\n+            default:\n+                throw new BadRequestException();\n         }\n-        throw new NotFoundException();\n     }\n \n     @Override"},{"sha":"68761cd521a72494fe5d398683c524e1954e283d","filename":"fit/core-reference/src/test/java/org/apache/syncope/fit/core/reference/ConfigurationITCase.java","status":"modified","additions":0,"deletions":1,"changes":1,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/89b54dad90942a9cf3a83bc9ccc7a19c14c4b914/fit%2Fcore-reference%2Fsrc%2Ftest%2Fjava%2Forg%2Fapache%2Fsyncope%2Ffit%2Fcore%2Freference%2FConfigurationITCase.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/89b54dad90942a9cf3a83bc9ccc7a19c14c4b914/fit%2Fcore-reference%2Fsrc%2Ftest%2Fjava%2Forg%2Fapache%2Fsyncope%2Ffit%2Fcore%2Freference%2FConfigurationITCase.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/fit%2Fcore-reference%2Fsrc%2Ftest%2Fjava%2Forg%2Fapache%2Fsyncope%2Ffit%2Fcore%2Freference%2FConfigurationITCase.java?ref=89b54dad90942a9cf3a83bc9ccc7a19c14c4b914","patch":"@@ -85,7 +85,6 @@ public void delete() throws UnsupportedEncodingException {\n \n         actual = configurationService.get(tokenLength.getSchema());\n         assertEquals(actual, tokenLength);\n-\n     }\n \n     @Test"},{"sha":"6655342976a22b1c55ff0f95268c5894fec7a0e8","filename":"fit/core-reference/src/test/java/org/apache/syncope/fit/core/reference/LoggerITCase.java","status":"modified","additions":16,"deletions":0,"changes":16,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/89b54dad90942a9cf3a83bc9ccc7a19c14c4b914/fit%2Fcore-reference%2Fsrc%2Ftest%2Fjava%2Forg%2Fapache%2Fsyncope%2Ffit%2Fcore%2Freference%2FLoggerITCase.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/89b54dad90942a9cf3a83bc9ccc7a19c14c4b914/fit%2Fcore-reference%2Fsrc%2Ftest%2Fjava%2Forg%2Fapache%2Fsyncope%2Ffit%2Fcore%2Freference%2FLoggerITCase.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/fit%2Fcore-reference%2Fsrc%2Ftest%2Fjava%2Forg%2Fapache%2Fsyncope%2Ffit%2Fcore%2Freference%2FLoggerITCase.java?ref=89b54dad90942a9cf3a83bc9ccc7a19c14c4b914","patch":"@@ -22,9 +22,13 @@\n import static org.junit.Assert.assertTrue;\n import static org.junit.Assert.assertFalse;\n import static org.junit.Assert.assertNotNull;\n+import static org.junit.Assert.fail;\n \n import java.text.ParseException;\n import java.util.List;\n+import javax.ws.rs.core.Response;\n+import javax.xml.ws.WebServiceException;\n+import org.apache.syncope.common.lib.SyncopeClientException;\n import org.apache.syncope.common.lib.to.EventCategoryTO;\n import org.apache.syncope.common.lib.to.LoggerTO;\n import org.apache.syncope.common.lib.types.AnyTypeKind;\n@@ -211,4 +215,16 @@ public void listAuditEvents() {\n         }\n         assertTrue(found);\n     }\n+\n+    @Test\n+    public void issueSYNCOPE708() {\n+        try {\n+            loggerService.read(LoggerType.LOG, \"notExists\");\n+            fail(\"Read a not exists logger, it should go in exception\");\n+        } catch (final WebServiceException ex) {\n+            fail(\"Exception is WebServiceException but it should be SyncopeClientException\");\n+        } catch (final SyncopeClientException ex) {\n+            assertEquals(Response.Status.NOT_FOUND, ex.getType().getResponseStatus());\n+        }\n+    }\n }"}]}