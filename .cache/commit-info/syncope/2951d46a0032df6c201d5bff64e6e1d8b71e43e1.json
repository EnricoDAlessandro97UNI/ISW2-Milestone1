{"sha":"2951d46a0032df6c201d5bff64e6e1d8b71e43e1","node_id":"MDY6Q29tbWl0NjM2ODc5MDYyOjI5NTFkNDZhMDAzMmRmNmMyMDFkNWJmZjY0ZTZlMWQ4YjcxZTQzZTE=","commit":{"author":{"name":"Francesco Chicchiriccò","email":"ilgrosso@apache.org","date":"2012-04-04T12:49:48Z"},"committer":{"name":"Francesco Chicchiriccò","email":"ilgrosso@apache.org","date":"2012-04-04T12:49:48Z"},"message":"[SYNCOPE-53] Now all UserTO information is available in mail templates by using Velocity Template Language (VTL) - some examples included\n\ngit-svn-id: https://svn.apache.org/repos/asf/incubator/syncope/trunk@1309361 13f79535-47bb-0310-9956-ffa450edef68","tree":{"sha":"5fdf72c8d7d3743020083b35a88cc2f6c2c317e5","url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/git/trees/5fdf72c8d7d3743020083b35a88cc2f6c2c317e5"},"url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/git/commits/2951d46a0032df6c201d5bff64e6e1d8b71e43e1","comment_count":0,"verification":{"verified":false,"reason":"unsigned","signature":null,"payload":null}},"url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/2951d46a0032df6c201d5bff64e6e1d8b71e43e1","html_url":"https://github.com/EnricoDAlessandro97UNI/syncope/commit/2951d46a0032df6c201d5bff64e6e1d8b71e43e1","comments_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/2951d46a0032df6c201d5bff64e6e1d8b71e43e1/comments","author":{"login":"ilgrosso","id":1064664,"node_id":"MDQ6VXNlcjEwNjQ2NjQ=","avatar_url":"https://avatars.githubusercontent.com/u/1064664?v=4","gravatar_id":"","url":"https://api.github.com/users/ilgrosso","html_url":"https://github.com/ilgrosso","followers_url":"https://api.github.com/users/ilgrosso/followers","following_url":"https://api.github.com/users/ilgrosso/following{/other_user}","gists_url":"https://api.github.com/users/ilgrosso/gists{/gist_id}","starred_url":"https://api.github.com/users/ilgrosso/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ilgrosso/subscriptions","organizations_url":"https://api.github.com/users/ilgrosso/orgs","repos_url":"https://api.github.com/users/ilgrosso/repos","events_url":"https://api.github.com/users/ilgrosso/events{/privacy}","received_events_url":"https://api.github.com/users/ilgrosso/received_events","type":"User","site_admin":false},"committer":{"login":"ilgrosso","id":1064664,"node_id":"MDQ6VXNlcjEwNjQ2NjQ=","avatar_url":"https://avatars.githubusercontent.com/u/1064664?v=4","gravatar_id":"","url":"https://api.github.com/users/ilgrosso","html_url":"https://github.com/ilgrosso","followers_url":"https://api.github.com/users/ilgrosso/followers","following_url":"https://api.github.com/users/ilgrosso/following{/other_user}","gists_url":"https://api.github.com/users/ilgrosso/gists{/gist_id}","starred_url":"https://api.github.com/users/ilgrosso/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ilgrosso/subscriptions","organizations_url":"https://api.github.com/users/ilgrosso/orgs","repos_url":"https://api.github.com/users/ilgrosso/repos","events_url":"https://api.github.com/users/ilgrosso/events{/privacy}","received_events_url":"https://api.github.com/users/ilgrosso/received_events","type":"User","site_admin":false},"parents":[{"sha":"074201c7afdcbf7f2f11ba45aa5310da3eb25195","url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/074201c7afdcbf7f2f11ba45aa5310da3eb25195","html_url":"https://github.com/EnricoDAlessandro97UNI/syncope/commit/074201c7afdcbf7f2f11ba45aa5310da3eb25195"}],"stats":{"total":78,"additions":51,"deletions":27},"files":[{"sha":"f2bc73b8fab05b02f7cc14d35c08109910a84562","filename":"core/src/main/java/org/syncope/core/notification/NotificationManager.java","status":"modified","additions":7,"deletions":10,"changes":17,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/2951d46a0032df6c201d5bff64e6e1d8b71e43e1/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fcore%2Fnotification%2FNotificationManager.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/2951d46a0032df6c201d5bff64e6e1d8b71e43e1/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fcore%2Fnotification%2FNotificationManager.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fcore%2Fnotification%2FNotificationManager.java?ref=2951d46a0032df6c201d5bff64e6e1d8b71e43e1","patch":"@@ -19,6 +19,7 @@\n package org.syncope.core.notification;\n \n import java.util.ArrayList;\n+import java.util.Collections;\n import java.util.HashMap;\n import java.util.HashSet;\n import java.util.List;\n@@ -32,7 +33,6 @@\n import org.springframework.beans.factory.annotation.Autowired;\n import org.springframework.transaction.annotation.Transactional;\n import org.springframework.ui.velocity.VelocityEngineUtils;\n-import org.syncope.core.persistence.beans.AbstractAttr;\n import org.syncope.core.persistence.beans.Notification;\n import org.syncope.core.persistence.beans.NotificationTask;\n import org.syncope.core.persistence.beans.TaskExec;\n@@ -47,6 +47,7 @@\n import org.syncope.core.persistence.dao.TaskExecDAO;\n import org.syncope.core.persistence.dao.UserDAO;\n import org.syncope.core.persistence.dao.UserSearchDAO;\n+import org.syncope.core.rest.data.UserDataBinder;\n import org.syncope.core.scheduling.NotificationJob;\n import org.syncope.core.util.ConnObjectUtil;\n import org.syncope.core.util.EntitlementUtil;\n@@ -84,6 +85,9 @@ public class NotificationManager {\n     @Autowired\n     private UserDAO userDAO;\n \n+    @Autowired\n+    private UserDataBinder userDataBinder;\n+\n     /**\n      * User Search DAO.\n      */\n@@ -160,14 +164,7 @@ private NotificationTask getNotificationTask(final Notification notification, fi\n         task.setSubject(notification.getSubject());\n \n         final Map<String, Object> model = new HashMap<String, Object>();\n-        for (AbstractAttr attr : user.getAttributes()) {\n-            List<String> values = attr.getValuesAsStrings();\n-            model.put(attr.getSchema().getName(), values.isEmpty()\n-                    ? \"\"\n-                    : (values.size() == 1\n-                    ? values.iterator().next()\n-                    : values));\n-        }\n+        model.put(\"user\", userDataBinder.getUserTO(user));\n \n         String htmlBody;\n         String textBody;\n@@ -255,7 +252,7 @@ private String getRecipientEmail(\n      * @param execution task execution.\n      * @return merged task execution.\n      */\n-    public TaskExec storeExecution(TaskExec execution) {\n+    public TaskExec storeExecution(final TaskExec execution) {\n         NotificationTask task = taskDAO.find(execution.getTask().getId());\n         task.addExec(execution);\n         return taskExecDAO.save(execution);"},{"sha":"f832a1d6105bac616c80926255bc4686c4e98f0c","filename":"core/src/main/resources/mailTemplates/optin.html.vm","status":"modified","additions":34,"deletions":15,"changes":49,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/2951d46a0032df6c201d5bff64e6e1d8b71e43e1/core%2Fsrc%2Fmain%2Fresources%2FmailTemplates%2Foptin.html.vm","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/2951d46a0032df6c201d5bff64e6e1d8b71e43e1/core%2Fsrc%2Fmain%2Fresources%2FmailTemplates%2Foptin.html.vm","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fsrc%2Fmain%2Fresources%2FmailTemplates%2Foptin.html.vm?ref=2951d46a0032df6c201d5bff64e6e1d8b71e43e1","patch":"@@ -1,20 +1,39 @@\n-# Licensed under the Apache License, Version 2.0 (the \"License\");\n-# you may not use this file except in compliance with the License.\n-# You may obtain a copy of the License at\n-#\n-#       http://www.apache.org/licenses/LICENSE-2.0\n-#\n-# Unless required by applicable law or agreed to in writing, software\n-# distributed under the License is distributed on an \"AS IS\" BASIS,\n-# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n-# See the License for the specific language governing permissions and\n-# limitations under the License.\n+<!--\n+Licensed to the Apache Software Foundation (ASF) under one\n+or more contributor license agreements.  See the NOTICE file\n+distributed with this work for additional information\n+regarding copyright ownership.  The ASF licenses this file\n+to you under the Apache License, Version 2.0 (the\n+\"License\"); you may not use this file except in compliance\n+with the License.  You may obtain a copy of the License at\n+\n+  http://www.apache.org/licenses/LICENSE-2.0\n+\n+Unless required by applicable law or agreed to in writing,\n+software distributed under the License is distributed on an\n+\"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+KIND, either express or implied.  See the License for the\n+specific language governing permissions and limitations\n+under the License.\n+\n+-->\n <html>\n <body>\n-<h3>Hi ${firstname} ${surname}, welcome to Syncope!</h3>\n+<h3>Hi $user.getAttributeMap().get(\"firstname\").getValues().get(0) $user.getAttributeMap().get(\"surname\").getValues().get(0), welcome to Syncope!</h3>\n+\n+<p>\n+   Your username is $user.getUsername().<br/>\n+   Your email address is $user.getAttributeMap().get(\"email\").getValues().get(0).\n+</p>\n+\n+#if(!$user.getMemberships().isEmpty())\n+You have been provided with the following roles:\n+<ul>\n+#foreach($membership in $user.getMemberships())\n+  <li>$membership.roleName</i>\n+#end\n+</ul>\n+#end\n \n-<div>\n-   Your email address is <a href=\"mailto:${email}\">${email}</a>.\n-</div>\n </body>\n </html>\n\\ No newline at end of file"},{"sha":"f12813160129a365651528d881d61df826a729a7","filename":"core/src/main/resources/mailTemplates/optin.txt.vm","status":"modified","additions":10,"deletions":2,"changes":12,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/2951d46a0032df6c201d5bff64e6e1d8b71e43e1/core%2Fsrc%2Fmain%2Fresources%2FmailTemplates%2Foptin.txt.vm","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/2951d46a0032df6c201d5bff64e6e1d8b71e43e1/core%2Fsrc%2Fmain%2Fresources%2FmailTemplates%2Foptin.txt.vm","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fsrc%2Fmain%2Fresources%2FmailTemplates%2Foptin.txt.vm?ref=2951d46a0032df6c201d5bff64e6e1d8b71e43e1","patch":"@@ -9,6 +9,14 @@\n # WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n # See the License for the specific language governing permissions and\n # limitations under the License.\n-Hi ${firstname} ${surname}, welcome to Syncope!\n+Hi $user.getAttributeMap().get(\"firstname\").getValues().get(0) $user.getAttributeMap().get(\"surname\").getValues().get(0), welcome to Syncope!\n \n-Your email address is ${email}.\n+Your username is $user.getUsername().\n+Your email address is $user.getAttributeMap().get(\"email\").getValues().get(0).\n+\n+#if(!$user.getMemberships().isEmpty())\n+You have been provided with the following roles:\n+#foreach($membership in $user.getMemberships())\n+  * $membership.roleName\n+#end\n+#end\n\\ No newline at end of file"}]}