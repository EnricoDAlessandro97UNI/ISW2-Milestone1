{"sha":"6a90dbae175ce6c5614e8e7d029e9900692cdc02","node_id":"MDY6Q29tbWl0NjM2ODc5MDYyOjZhOTBkYmFlMTc1Y2U2YzU2MTRlOGU3ZDAyOWU5OTAwNjkyY2RjMDI=","commit":{"author":{"name":"Unknown","email":"unknown@apache.org","date":"2010-06-23T09:19:59Z"},"committer":{"name":"Unknown","email":"unknown@apache.org","date":"2010-06-23T09:19:59Z"},"message":"console file authentication\n\ngit-svn-id: https://svn.apache.org/repos/asf/incubator/syncope/trunk@1246226 13f79535-47bb-0310-9956-ffa450edef68","tree":{"sha":"8abec2f4cce1ea576e82ae4cbd4a6735e2eb8996","url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/git/trees/8abec2f4cce1ea576e82ae4cbd4a6735e2eb8996"},"url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/git/commits/6a90dbae175ce6c5614e8e7d029e9900692cdc02","comment_count":0,"verification":{"verified":false,"reason":"unsigned","signature":null,"payload":null}},"url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/6a90dbae175ce6c5614e8e7d029e9900692cdc02","html_url":"https://github.com/EnricoDAlessandro97UNI/syncope/commit/6a90dbae175ce6c5614e8e7d029e9900692cdc02","comments_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/6a90dbae175ce6c5614e8e7d029e9900692cdc02/comments","author":null,"committer":null,"parents":[{"sha":"89bd49df0de96f5e53dd2fdbcbb2bb6bc22b2215","url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/89bd49df0de96f5e53dd2fdbcbb2bb6bc22b2215","html_url":"https://github.com/EnricoDAlessandro97UNI/syncope/commit/89bd49df0de96f5e53dd2fdbcbb2bb6bc22b2215"}],"stats":{"total":175,"additions":150,"deletions":25},"files":[{"sha":"8f78bf1e18ed2512ab127489c1c3f9504de8e9a3","filename":"console/pom.xml","status":"modified","additions":7,"deletions":1,"changes":8,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/6a90dbae175ce6c5614e8e7d029e9900692cdc02/console%2Fpom.xml","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/6a90dbae175ce6c5614e8e7d029e9900692cdc02/console%2Fpom.xml","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/console%2Fpom.xml?ref=6a90dbae175ce6c5614e8e7d029e9900692cdc02","patch":"@@ -51,7 +51,7 @@\n             <artifactId>wicket</artifactId>\n         </dependency>\n \n-        <dependency>\n+      <dependency>\n             <groupId>org.apache.wicket</groupId>\n             <artifactId>wicket-spring</artifactId>\n             <!-- exclude spring framework that wicket pulls in -->\n@@ -75,10 +75,16 @@\n             <groupId>org.springframework</groupId>\n             <artifactId>spring-webmvc</artifactId>\n         </dependency>\n+        \n         <dependency>\n             <groupId>org.codehaus.jackson</groupId>\n             <artifactId>jackson-mapper-lgpl</artifactId>\n         </dependency>\n+\n+        <dependency>\n+            <groupId>javax.servlet</groupId>\n+            <artifactId>servlet-api</artifactId>\n+        </dependency>\n     </dependencies>\n \n     <build>"},{"sha":"9361c97ae45e515f472887d34af07dd8a6dd99ca","filename":"console/src/main/java/org/syncope/console/SyncopeApplication.java","status":"modified","additions":20,"deletions":2,"changes":22,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/6a90dbae175ce6c5614e8e7d029e9900692cdc02/console%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fconsole%2FSyncopeApplication.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/6a90dbae175ce6c5614e8e7d029e9900692cdc02/console%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fconsole%2FSyncopeApplication.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/console%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fconsole%2FSyncopeApplication.java?ref=6a90dbae175ce6c5614e8e7d029e9900692cdc02","patch":"@@ -14,33 +14,41 @@\n  */\n package org.syncope.console;\n \n+import java.io.InputStream;\n import org.apache.wicket.Request;\n import org.apache.wicket.Response;\n import org.apache.wicket.Session;\n import org.apache.wicket.protocol.http.WebApplication;\n+import org.apache.wicket.spring.injection.annot.SpringBean;\n import org.apache.wicket.spring.injection.annot.SpringComponentInjector;\n import org.springframework.beans.BeansException;\n import org.springframework.context.ApplicationContext;\n import org.springframework.context.ApplicationContextAware;\n import org.syncope.console.pages.HomePage;\n import org.syncope.console.pages.Login;\n+import org.syncope.console.rest.RestClient;\n \n /**\n  * SyncopeApplication class.\n  */\n public class SyncopeApplication extends WebApplication implements ApplicationContextAware\n {\n     SyncopeUser user = null;\n+    @SpringBean(name = \"restClient\")\n+    RestClient restClient;\n+    String file;\n     \n     private ApplicationContext ctx;\n-    \n+\n     public SyncopeApplication()\n     {\n     }\n \n     @Override\n     protected void init()\n     {\n+\n+        file = getServletContext().getInitParameter(\"authenticationFile\");\n         addComponentInstantiationListener(new SpringComponentInjector(this));\n         getResourceSettings().setThrowExceptionOnMissingResource( true );\n     }\n@@ -90,4 +98,14 @@ public void setApplicationContext(ApplicationContext applicationContext) throws\n           this.ctx = applicationContext;\n     }\n \n-}\n\\ No newline at end of file\n+\n+    public void setRestClient(RestClient restClient) {\n+        this.restClient = restClient;\n+    }\n+    public InputStream getAuthenticationFile(){\n+    return getServletContext().getResourceAsStream(file);\n+    }\n+\n+}\n+\n+"},{"sha":"583aedfb926b534f56adc696ad73f03a8a3a66b7","filename":"console/src/main/java/org/syncope/console/pages/Authentication.java","status":"added","additions":85,"deletions":0,"changes":85,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/6a90dbae175ce6c5614e8e7d029e9900692cdc02/console%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fconsole%2Fpages%2FAuthentication.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/6a90dbae175ce6c5614e8e7d029e9900692cdc02/console%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fconsole%2Fpages%2FAuthentication.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/console%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fconsole%2Fpages%2FAuthentication.java?ref=6a90dbae175ce6c5614e8e7d029e9900692cdc02","patch":"@@ -0,0 +1,85 @@\n+/*\n+ *  Licensed under the Apache License, Version 2.0 (the \"License\");\n+ *  you may not use this file except in compliance with the License.\n+ *  You may obtain a copy of the License at\n+ * \n+ *       http://www.apache.org/licenses/LICENSE-2.0\n+ * \n+ *  Unless required by applicable law or agreed to in writing, software\n+ *  distributed under the License is distributed on an \"AS IS\" BASIS,\n+ *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ *  See the License for the specific language governing permissions and\n+ *  limitations under the License.\n+ *  under the License.\n+ */\n+package org.syncope.console.pages;\n+\n+import java.io.*;\n+import javax.xml.parsers.SAXParser;\n+import javax.xml.parsers.SAXParserFactory;\n+import org.xml.sax.Attributes;\n+import org.xml.sax.SAXException;\n+import org.xml.sax.helpers.DefaultHandler;\n+\n+public class Authentication {\n+\n+    static public String nodo;\n+    static public Writer out;\n+    public Boolean authenticated = false;\n+    public String xmlUsername;\n+    public String xmlPassword;\n+\n+    public boolean authentication(String username, String password, InputStream inputStream) {\n+        try {\n+            SAXParserFactory factory = SAXParserFactory.newInstance();\n+            SAXParser saxParser = factory.newSAXParser();\n+            DefaultHandler handler = new DefaultHandler() {\n+\n+                boolean bfname = false;\n+                boolean blname = false;\n+                boolean bnname = false;\n+                boolean bsalary = false;\n+\n+                @Override\n+                public void startElement(String uri, String localName,\n+                        String qName, Attributes attributes)\n+                        throws SAXException {\n+                    if (qName.equalsIgnoreCase(\"username\")) {\n+                        bfname = true;\n+                    }\n+                    if (qName.equalsIgnoreCase(\"password\")) {\n+                        blname = true;\n+                    }\n+                }\n+\n+                @Override\n+                public void endElement(String uri, String localName,\n+                        String qName)\n+                        throws SAXException {\n+                }\n+\n+                @Override\n+                public void characters(char ch[], int start, int length)\n+                        throws SAXException {\n+                    if (bfname) {\n+                        xmlUsername = new String(ch, start, length);\n+                        bfname = false;\n+                    }\n+                    if (blname) {\n+                        xmlPassword = new String(ch, start, length);\n+                        blname = false;\n+                    }\n+                }\n+            };\n+\n+            \n+            saxParser.parse(inputStream, handler);\n+            if (username.equals(xmlUsername) && password.equals(xmlPassword)) {\n+                authenticated = true;\n+            }\n+        } catch (Exception e) {\n+            e.printStackTrace();\n+        }\n+        return authenticated;\n+    }\n+}"},{"sha":"1b2006f265729e1c500b7740525df56c95761a58","filename":"console/src/main/java/org/syncope/console/pages/Login.java","status":"modified","additions":22,"deletions":7,"changes":29,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/6a90dbae175ce6c5614e8e7d029e9900692cdc02/console%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fconsole%2Fpages%2FLogin.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/6a90dbae175ce6c5614e8e7d029e9900692cdc02/console%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fconsole%2Fpages%2FLogin.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/console%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fconsole%2Fpages%2FLogin.java?ref=6a90dbae175ce6c5614e8e7d029e9900692cdc02","patch":"@@ -12,13 +12,14 @@\n  *  limitations under the License.\n  *  under the License.\n  */\n-\n package org.syncope.console.pages;\n \n+import java.io.InputStream;\n import java.util.Arrays;\n import java.util.List;\n import java.util.Locale;\n import org.apache.wicket.PageParameters;\n+import org.apache.wicket.Session;\n import org.apache.wicket.markup.html.WebPage;\n import org.apache.wicket.markup.html.form.Button;\n import org.apache.wicket.markup.html.form.ChoiceRenderer;\n@@ -28,6 +29,9 @@\n import org.apache.wicket.markup.html.form.TextField;\n import org.apache.wicket.model.IModel;\n import org.apache.wicket.model.Model;\n+import org.syncope.console.SyncopeApplication;\n+import org.syncope.console.SyncopeSession;\n+import org.syncope.console.SyncopeUser;\n \n /**\n  * Syncope Login page.\n@@ -38,10 +42,13 @@ public class Login extends WebPage {\n     public TextField usernameField;\n     public TextField passwordField;\n     public DropDownChoice<String> languageSelect;\n+    public InputStream inputStream;\n \n     public Login(PageParameters parameters) {\n         super(parameters);\n-\n+        this.getClass().getClassLoader().getResource(\"/WEB-INF/classes/authentication.xml\");\n+        //System.out.println(((WebApplication)(SyncopeApplication.get())).getServletContext());\n+        //System.out.println(WebApplication.get().getServletContext());\n         form = new Form(\"login\");\n \n         usernameField = new TextField(\"username\", new Model());\n@@ -52,23 +59,31 @@ public Login(PageParameters parameters) {\n         passwordField.setMarkupId(\"password\");\n         form.add(passwordField);\n \n-        languageSelect = new LocaleDropDown(\"language\", Arrays\n-        .asList(new Locale[] { Locale.ENGLISH, Locale.ITALIAN }));\n+        languageSelect = new LocaleDropDown(\"language\", Arrays.asList(new Locale[]{Locale.ENGLISH, Locale.ITALIAN}));\n \n         form.add(languageSelect);\n \n         Button submitButton = new Button(\"submit\", new Model(getString(\"submit\"))) {\n+\n             @Override\n             public void onSubmit() {\n-                setResponsePage(new HomePage(null));\n+                //file = ((SyncopeApplication)getApplication()).getInitParameter(\"authenticationFile\");\n+                //file = ((SyncopeApplication)getApplication()).getServletContext().getInitParameter(\"authenticationFile\");\n+                inputStream = ((SyncopeApplication)getApplication()).getAuthenticationFile();\n+                Authentication auth = new Authentication();\n+                Boolean authenticated = auth.authentication(usernameField.getRawInput(), passwordField.getRawInput(), inputStream);\n+                if (authenticated == true) {\n+                    SyncopeUser user = new SyncopeUser();\n+                    user.setUsername(usernameField.getRawInput());\n+                    ((SyncopeSession)Session.get()).setUser(user);\n+                    setResponsePage(new HomePage(null));\n+                }\n             }\n         };\n \n         submitButton.setDefaultFormProcessing(false);\n         form.add(submitButton);\n-\n         form.add(new Button(\"reset\", new Model(getString(\"reset\"))));\n-\n         add(form);\n     }\n "},{"sha":"cbb53177677bd244a3e7fe5eb2d7f452543af8c4","filename":"console/src/main/java/org/syncope/console/pages/Users.java","status":"modified","additions":0,"deletions":1,"changes":1,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/6a90dbae175ce6c5614e8e7d029e9900692cdc02/console%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fconsole%2Fpages%2FUsers.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/6a90dbae175ce6c5614e8e7d029e9900692cdc02/console%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fconsole%2Fpages%2FUsers.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/console%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fconsole%2Fpages%2FUsers.java?ref=6a90dbae175ce6c5614e8e7d029e9900692cdc02","patch":"@@ -44,7 +44,6 @@ public Users(PageParameters parameters) {\n         add(new Button(\"newUserBtn\",new Model(getString(\"newUserBtn\"))));\n \n         final Set<UserTO> users = restClient.getUserList();\n-        System.out.println(\"Numero di user: \"+users.size());\n \n         if(!users.isEmpty())\n         {"},{"sha":"08a2c80d87ba2349b8fede350f166c62d6f078a7","filename":"console/src/main/webapp/WEB-INF/authentication.xml","status":"added","additions":8,"deletions":0,"changes":8,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/6a90dbae175ce6c5614e8e7d029e9900692cdc02/console%2Fsrc%2Fmain%2Fwebapp%2FWEB-INF%2Fauthentication.xml","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/6a90dbae175ce6c5614e8e7d029e9900692cdc02/console%2Fsrc%2Fmain%2Fwebapp%2FWEB-INF%2Fauthentication.xml","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/console%2Fsrc%2Fmain%2Fwebapp%2FWEB-INF%2Fauthentication.xml?ref=6a90dbae175ce6c5614e8e7d029e9900692cdc02","patch":"@@ -0,0 +1,8 @@\n+<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n+\n+<root>\n+    <user>\n+        <username>admin</username>\n+        <password>password</password>\n+    </user>\n+</root>"},{"sha":"ea8dad322e9325eaf60d4cd45fc2a39bfd39737a","filename":"console/src/main/webapp/WEB-INF/web.xml","status":"modified","additions":8,"deletions":14,"changes":22,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/6a90dbae175ce6c5614e8e7d029e9900692cdc02/console%2Fsrc%2Fmain%2Fwebapp%2FWEB-INF%2Fweb.xml","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/6a90dbae175ce6c5614e8e7d029e9900692cdc02/console%2Fsrc%2Fmain%2Fwebapp%2FWEB-INF%2Fweb.xml","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/console%2Fsrc%2Fmain%2Fwebapp%2FWEB-INF%2Fweb.xml?ref=6a90dbae175ce6c5614e8e7d029e9900692cdc02","patch":"@@ -1,11 +1,6 @@\n <?xml version=\"1.0\" encoding=\"UTF-8\"?>\n-<web-app xmlns=\"http://java.sun.com/xml/ns/javaee\"\n-\txmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n-\txsi:schemaLocation=\"http://java.sun.com/xml/ns/javaee http://java.sun.com/xml/ns/javaee/web-app_2_5.xsd\"\n-\tversion=\"2.5\">\n-\n+<web-app version=\"2.5\" xmlns=\"http://java.sun.com/xml/ns/javaee\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:schemaLocation=\"http://java.sun.com/xml/ns/javaee http://java.sun.com/xml/ns/javaee/web-app_2_5.xsd\">\n     <display-name>Syncope console</display-name>\n-\n     <servlet>\n         <servlet-name>SyncopeApplication</servlet-name>\n         <servlet-class>org.apache.wicket.protocol.http.WicketServlet</servlet-class>\n@@ -20,22 +15,21 @@\n         <servlet-name>SyncopeApplication</servlet-name>\n         <url-pattern>/*</url-pattern>\n     </servlet-mapping>\n-\n     <context-param>\n         <param-name>contextConfigLocation</param-name>\n         <param-value>/WEB-INF/classes/applicationContext.xml\n         </param-value>\n     </context-param>\n+    <context-param>\n+        <param-name>authenticationFile</param-name>\n+        <param-value>/WEB-INF/authentication.xml\n+        </param-value>\n+    </context-param>\n \n     <listener>\n         <listener-class>\n-\t\t\torg.springframework.web.context.ContextLoaderListener\n+            org.springframework.web.context.ContextLoaderListener\n         </listener-class>\n-    </listener>    \n-    \n-    <init-param>\n-        <param-name>applicationBean</param-name>\n-        <param-value>syncopeApplication</param-value>\n-    </init-param>\n+    </listener>\n \n </web-app>"}]}