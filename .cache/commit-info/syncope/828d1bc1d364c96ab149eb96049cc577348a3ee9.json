{"sha":"828d1bc1d364c96ab149eb96049cc577348a3ee9","node_id":"MDY6Q29tbWl0NjM2ODc5MDYyOjgyOGQxYmMxZDM2NGM5NmFiMTQ5ZWI5NjA0OWNjNTc3MzQ4YTNlZTk=","commit":{"author":{"name":"Francesco Chicchiriccò","email":"ilgrosso@apache.org","date":"2018-01-16T10:18:16Z"},"committer":{"name":"Francesco Chicchiriccò","email":"ilgrosso@apache.org","date":"2018-01-16T11:14:53Z"},"message":"Completing the work for SYNCOPE-1249 with pull support","tree":{"sha":"3c24ca64cd70b929c1e0b90601b8d6fcc33f0b4e","url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/git/trees/3c24ca64cd70b929c1e0b90601b8d6fcc33f0b4e"},"url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/git/commits/828d1bc1d364c96ab149eb96049cc577348a3ee9","comment_count":0,"verification":{"verified":false,"reason":"unsigned","signature":null,"payload":null}},"url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/828d1bc1d364c96ab149eb96049cc577348a3ee9","html_url":"https://github.com/EnricoDAlessandro97UNI/syncope/commit/828d1bc1d364c96ab149eb96049cc577348a3ee9","comments_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/828d1bc1d364c96ab149eb96049cc577348a3ee9/comments","author":{"login":"ilgrosso","id":1064664,"node_id":"MDQ6VXNlcjEwNjQ2NjQ=","avatar_url":"https://avatars.githubusercontent.com/u/1064664?v=4","gravatar_id":"","url":"https://api.github.com/users/ilgrosso","html_url":"https://github.com/ilgrosso","followers_url":"https://api.github.com/users/ilgrosso/followers","following_url":"https://api.github.com/users/ilgrosso/following{/other_user}","gists_url":"https://api.github.com/users/ilgrosso/gists{/gist_id}","starred_url":"https://api.github.com/users/ilgrosso/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ilgrosso/subscriptions","organizations_url":"https://api.github.com/users/ilgrosso/orgs","repos_url":"https://api.github.com/users/ilgrosso/repos","events_url":"https://api.github.com/users/ilgrosso/events{/privacy}","received_events_url":"https://api.github.com/users/ilgrosso/received_events","type":"User","site_admin":false},"committer":{"login":"ilgrosso","id":1064664,"node_id":"MDQ6VXNlcjEwNjQ2NjQ=","avatar_url":"https://avatars.githubusercontent.com/u/1064664?v=4","gravatar_id":"","url":"https://api.github.com/users/ilgrosso","html_url":"https://github.com/ilgrosso","followers_url":"https://api.github.com/users/ilgrosso/followers","following_url":"https://api.github.com/users/ilgrosso/following{/other_user}","gists_url":"https://api.github.com/users/ilgrosso/gists{/gist_id}","starred_url":"https://api.github.com/users/ilgrosso/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ilgrosso/subscriptions","organizations_url":"https://api.github.com/users/ilgrosso/orgs","repos_url":"https://api.github.com/users/ilgrosso/repos","events_url":"https://api.github.com/users/ilgrosso/events{/privacy}","received_events_url":"https://api.github.com/users/ilgrosso/received_events","type":"User","site_admin":false},"parents":[{"sha":"0c2e4ba0c340d66d23bd9fff516151384ce59fc1","url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/0c2e4ba0c340d66d23bd9fff516151384ce59fc1","html_url":"https://github.com/EnricoDAlessandro97UNI/syncope/commit/0c2e4ba0c340d66d23bd9fff516151384ce59fc1"}],"stats":{"total":25,"additions":18,"deletions":7},"files":[{"sha":"0203a066f641825decff282f473c539ea8750cca","filename":"core/persistence-jpa/src/test/java/org/apache/syncope/core/persistence/jpa/outer/PlainSchemaTest.java","status":"modified","additions":2,"deletions":2,"changes":4,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/828d1bc1d364c96ab149eb96049cc577348a3ee9/core%2Fpersistence-jpa%2Fsrc%2Ftest%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fpersistence%2Fjpa%2Fouter%2FPlainSchemaTest.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/828d1bc1d364c96ab149eb96049cc577348a3ee9/core%2Fpersistence-jpa%2Fsrc%2Ftest%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fpersistence%2Fjpa%2Fouter%2FPlainSchemaTest.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fpersistence-jpa%2Fsrc%2Ftest%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fpersistence%2Fjpa%2Fouter%2FPlainSchemaTest.java?ref=828d1bc1d364c96ab149eb96049cc577348a3ee9","patch":"@@ -210,15 +210,15 @@ public void deleteSurname() {\n \n     @Test\n     public void deleteFirstname() {\n-        assertEquals(5, resourceDAO.find(\"resource-db-pull\").\n+        assertEquals(6, resourceDAO.find(\"resource-db-pull\").\n                 getProvision(anyTypeDAO.findUser()).get().getMapping().getItems().size());\n \n         plainSchemaDAO.delete(\"firstname\");\n         assertNull(plainSchemaDAO.find(\"firstname\"));\n \n         plainSchemaDAO.flush();\n \n-        assertEquals(4, resourceDAO.find(\"resource-db-pull\").\n+        assertEquals(5, resourceDAO.find(\"resource-db-pull\").\n                 getProvision(anyTypeDAO.findUser()).get().getMapping().getItems().size());\n     }\n }"},{"sha":"d8eb1beaf6710b59446085d9b41e1b7fa40073f5","filename":"core/persistence-jpa/src/test/resources/domains/MasterContent.xml","status":"modified","additions":3,"deletions":0,"changes":3,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/828d1bc1d364c96ab149eb96049cc577348a3ee9/core%2Fpersistence-jpa%2Fsrc%2Ftest%2Fresources%2Fdomains%2FMasterContent.xml","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/828d1bc1d364c96ab149eb96049cc577348a3ee9/core%2Fpersistence-jpa%2Fsrc%2Ftest%2Fresources%2Fdomains%2FMasterContent.xml","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fpersistence-jpa%2Fsrc%2Ftest%2Fresources%2Fdomains%2FMasterContent.xml?ref=828d1bc1d364c96ab149eb96049cc577348a3ee9","patch":"@@ -1105,6 +1105,9 @@ under the License.\n   <MappingItem id=\"e7215305-93c9-460b-b862-46f7b60de72d\" connObjectKey=\"0\" mapping_id=\"cda910bd-fc28-4f63-890e-66edc62d428b\"\n                extAttrName=\"EMAIL\" intAttrName=\"userId\" \n                mandatoryCondition=\"false\" password=\"0\" purpose=\"PULL\"/>\n+  <MappingItem id=\"fb59d169-cf59-43f6-a517-adfd9aacc609\" connObjectKey=\"0\" mapping_id=\"cda910bd-fc28-4f63-890e-66edc62d428b\"\n+               extAttrName=\"MUSTCHANGEPASSWORD\" intAttrName=\"mustChangePassword\" \n+               mandatoryCondition=\"false\" password=\"0\" purpose=\"PULL\"/>\n               \n   <Provision id=\"6d7cb60a-c4ad-4a70-94ae-e5b88eb24930\" resource_id=\"resource-db-virattr\" anyType_id=\"USER\" objectClass=\"__ACCOUNT__\"/>\n   <Mapping id=\"45280585-308f-4571-9788-c7a4734b3614\" provision_id=\"6d7cb60a-c4ad-4a70-94ae-e5b88eb24930\"/>"},{"sha":"8d0d83f5331bf85c42deeb1e8b18a703c45c02f5","filename":"core/provisioning-java/src/main/java/org/apache/syncope/core/provisioning/java/MappingManagerImpl.java","status":"modified","additions":7,"deletions":0,"changes":7,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/828d1bc1d364c96ab149eb96049cc577348a3ee9/core%2Fprovisioning-java%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fprovisioning%2Fjava%2FMappingManagerImpl.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/828d1bc1d364c96ab149eb96049cc577348a3ee9/core%2Fprovisioning-java%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fprovisioning%2Fjava%2FMappingManagerImpl.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fprovisioning-java%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fprovisioning%2Fjava%2FMappingManagerImpl.java?ref=828d1bc1d364c96ab149eb96049cc577348a3ee9","patch":"@@ -25,6 +25,7 @@\n import java.util.List;\n import java.util.Optional;\n import java.util.Set;\n+import org.apache.commons.lang3.BooleanUtils;\n import org.apache.commons.lang3.StringUtils;\n import org.apache.commons.lang3.reflect.FieldUtils;\n import org.apache.commons.lang3.time.DateFormatUtils;\n@@ -657,6 +658,12 @@ public void setIntValues(final Item mapItem, final Attribute attr, final AnyTO a\n                     }\n                     break;\n \n+                case \"mustChangePassword\":\n+                    if (anyTO instanceof UserTO && !values.isEmpty() && values.get(0) != null) {\n+                        ((UserTO) anyTO).setMustChangePassword(BooleanUtils.toBoolean(values.get(0).toString()));\n+                    }\n+                    break;\n+\n                 case \"userOwner\":\n                 case \"groupOwner\":\n                     if (anyTO instanceof GroupTO && attr != null) {"},{"sha":"5ad534128d5b13e30449179f41bbea7392b0e802","filename":"fit/build-tools/src/main/resources/testdb.sql","status":"modified","additions":1,"deletions":0,"changes":1,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/828d1bc1d364c96ab149eb96049cc577348a3ee9/fit%2Fbuild-tools%2Fsrc%2Fmain%2Fresources%2Ftestdb.sql","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/828d1bc1d364c96ab149eb96049cc577348a3ee9/fit%2Fbuild-tools%2Fsrc%2Fmain%2Fresources%2Ftestdb.sql","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/fit%2Fbuild-tools%2Fsrc%2Fmain%2Fresources%2Ftestdb.sql?ref=828d1bc1d364c96ab149eb96049cc577348a3ee9","patch":"@@ -39,6 +39,7 @@ CREATE TABLE testpull (\n id CHAR(36) PRIMARY KEY,\n username VARCHAR(80),\n surname VARCHAR(80),\n+mustChangePassword BOOLEAN,\n email VARCHAR(80),\n lastModification TIMESTAMP);\n "},{"sha":"59fe873c58a3458f0c4af8a51675fd2958ca6e6f","filename":"fit/core-reference/src/test/java/org/apache/syncope/fit/core/PullTaskITCase.java","status":"modified","additions":5,"deletions":5,"changes":10,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/828d1bc1d364c96ab149eb96049cc577348a3ee9/fit%2Fcore-reference%2Fsrc%2Ftest%2Fjava%2Forg%2Fapache%2Fsyncope%2Ffit%2Fcore%2FPullTaskITCase.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/828d1bc1d364c96ab149eb96049cc577348a3ee9/fit%2Fcore-reference%2Fsrc%2Ftest%2Fjava%2Forg%2Fapache%2Fsyncope%2Ffit%2Fcore%2FPullTaskITCase.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/fit%2Fcore-reference%2Fsrc%2Ftest%2Fjava%2Forg%2Fapache%2Fsyncope%2Ffit%2Fcore%2FPullTaskITCase.java?ref=828d1bc1d364c96ab149eb96049cc577348a3ee9","patch":"@@ -520,9 +520,9 @@ public void filteredReconciliation() throws IOException {\n         try {\n             // 1. create 2 users on testpull\n             jdbcTemplate.execute(\"INSERT INTO testpull VALUES (\"\n-                    + \"'\" + user1OnTestPull + \"', 'user1', 'Doe', 'mail1@apache.org', NULL)\");\n+                    + \"'\" + user1OnTestPull + \"', 'user1', 'Doe', false, 'mail1@apache.org', NULL)\");\n             jdbcTemplate.execute(\"INSERT INTO testpull VALUES (\"\n-                    + \"'\" + user2OnTestPull + \"', 'user2', 'Rossi', 'mail2@apache.org', NULL)\");\n+                    + \"'\" + user2OnTestPull + \"', 'user2', 'Rossi', false, 'mail2@apache.org', NULL)\");\n \n             // 2. create new pull task for test-db, with reconciliation filter (surname 'Rossi') \n             ImplementationTO reconFilterBuilder = new ImplementationTO();\n@@ -621,10 +621,10 @@ public void syncTokenWithErrors() {\n             jdbcTemplate.execute(\"DELETE FROM testpull\");\n             jdbcTemplate.execute(\"INSERT INTO testpull VALUES \"\n                     + \"(1040, 'syncTokenWithErrors1', 'Surname1', \"\n-                    + \"'syncTokenWithErrors1@syncope.apache.org', '2014-05-23 13:53:24.293')\");\n+                    + \"false, 'syncTokenWithErrors1@syncope.apache.org', '2014-05-23 13:53:24.293')\");\n             jdbcTemplate.execute(\"INSERT INTO testpull VALUES \"\n                     + \"(1041, 'syncTokenWithErrors2', 'Surname2', \"\n-                    + \"'syncTokenWithErrors1@syncope.apache.org', '2015-05-23 13:53:24.293')\");\n+                    + \"false, 'syncTokenWithErrors1@syncope.apache.org', '2015-05-23 13:53:24.293')\");\n \n             ExecTO exec = execProvisioningTask(taskService, pullTask.getKey(), 50, false);\n             assertEquals(PropagationTaskExecStatus.SUCCESS, PropagationTaskExecStatus.valueOf(exec.getStatus()));\n@@ -729,7 +729,7 @@ public void issueSYNCOPE230() {\n \n         // 1. populate the external table\n         jdbcTemplate.execute(\"INSERT INTO testpull VALUES\"\n-                + \"('\" + id + \"', 'issuesyncope230', 'Surname', 'syncope230@syncope.apache.org', NULL)\");\n+                + \"('\" + id + \"', 'issuesyncope230', 'Surname', false, 'syncope230@syncope.apache.org', NULL)\");\n \n         // 2. execute PullTask for resource-db-pull (table TESTPULL on external H2)\n         execProvisioningTask(taskService, \"7c2242f4-14af-4ab5-af31-cdae23783655\", 50, false);"}]}