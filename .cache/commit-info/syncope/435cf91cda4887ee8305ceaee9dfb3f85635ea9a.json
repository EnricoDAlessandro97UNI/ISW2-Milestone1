{"sha":"435cf91cda4887ee8305ceaee9dfb3f85635ea9a","node_id":"MDY6Q29tbWl0NjM2ODc5MDYyOjQzNWNmOTFjZGE0ODg3ZWU4MzA1Y2VhZWU5ZGZiM2Y4NTYzNWVhOWE=","commit":{"author":{"name":"Francesco Chicchiriccò","email":"ilgrosso@apache.org","date":"2014-06-05T13:18:41Z"},"committer":{"name":"Francesco Chicchiriccò","email":"ilgrosso@apache.org","date":"2014-06-05T13:18:41Z"},"message":"[SYNCOPE-499] Added careful checks before using role template's parent, user owner and role owner\n\ngit-svn-id: https://svn.apache.org/repos/asf/syncope/branches/1_1_X@1600646 13f79535-47bb-0310-9956-ffa450edef68","tree":{"sha":"6e3ebbc63121427aa921eb7db6e2091e8c57a351","url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/git/trees/6e3ebbc63121427aa921eb7db6e2091e8c57a351"},"url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/git/commits/435cf91cda4887ee8305ceaee9dfb3f85635ea9a","comment_count":0,"verification":{"verified":false,"reason":"unsigned","signature":null,"payload":null}},"url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/435cf91cda4887ee8305ceaee9dfb3f85635ea9a","html_url":"https://github.com/EnricoDAlessandro97UNI/syncope/commit/435cf91cda4887ee8305ceaee9dfb3f85635ea9a","comments_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/435cf91cda4887ee8305ceaee9dfb3f85635ea9a/comments","author":{"login":"ilgrosso","id":1064664,"node_id":"MDQ6VXNlcjEwNjQ2NjQ=","avatar_url":"https://avatars.githubusercontent.com/u/1064664?v=4","gravatar_id":"","url":"https://api.github.com/users/ilgrosso","html_url":"https://github.com/ilgrosso","followers_url":"https://api.github.com/users/ilgrosso/followers","following_url":"https://api.github.com/users/ilgrosso/following{/other_user}","gists_url":"https://api.github.com/users/ilgrosso/gists{/gist_id}","starred_url":"https://api.github.com/users/ilgrosso/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ilgrosso/subscriptions","organizations_url":"https://api.github.com/users/ilgrosso/orgs","repos_url":"https://api.github.com/users/ilgrosso/repos","events_url":"https://api.github.com/users/ilgrosso/events{/privacy}","received_events_url":"https://api.github.com/users/ilgrosso/received_events","type":"User","site_admin":false},"committer":{"login":"ilgrosso","id":1064664,"node_id":"MDQ6VXNlcjEwNjQ2NjQ=","avatar_url":"https://avatars.githubusercontent.com/u/1064664?v=4","gravatar_id":"","url":"https://api.github.com/users/ilgrosso","html_url":"https://github.com/ilgrosso","followers_url":"https://api.github.com/users/ilgrosso/followers","following_url":"https://api.github.com/users/ilgrosso/following{/other_user}","gists_url":"https://api.github.com/users/ilgrosso/gists{/gist_id}","starred_url":"https://api.github.com/users/ilgrosso/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ilgrosso/subscriptions","organizations_url":"https://api.github.com/users/ilgrosso/orgs","repos_url":"https://api.github.com/users/ilgrosso/repos","events_url":"https://api.github.com/users/ilgrosso/events{/privacy}","received_events_url":"https://api.github.com/users/ilgrosso/received_events","type":"User","site_admin":false},"parents":[{"sha":"2a85fe9cd8eabba6fb03107acb3f30052c4c7d55","url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/2a85fe9cd8eabba6fb03107acb3f30052c4c7d55","html_url":"https://github.com/EnricoDAlessandro97UNI/syncope/commit/2a85fe9cd8eabba6fb03107acb3f30052c4c7d55"}],"stats":{"total":93,"additions":65,"deletions":28},"files":[{"sha":"8abdcb295bf2fd1c04a0bd2a14118672e3514c71","filename":"console/src/main/java/org/apache/syncope/console/pages/panels/RoleDetailsPanel.java","status":"modified","additions":35,"deletions":15,"changes":50,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/435cf91cda4887ee8305ceaee9dfb3f85635ea9a/console%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fconsole%2Fpages%2Fpanels%2FRoleDetailsPanel.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/435cf91cda4887ee8305ceaee9dfb3f85635ea9a/console%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fconsole%2Fpages%2Fpanels%2FRoleDetailsPanel.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/console%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fconsole%2Fpages%2Fpanels%2FRoleDetailsPanel.java?ref=435cf91cda4887ee8305ceaee9dfb3f85635ea9a","patch":"@@ -40,11 +40,18 @@\n import org.apache.wicket.model.IModel;\n import org.apache.wicket.model.PropertyModel;\n import org.apache.wicket.spring.injection.annot.SpringBean;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n \n public class RoleDetailsPanel extends Panel {\n \n     private static final long serialVersionUID = 855618618337931784L;\n \n+    /**\n+     * Logger.\n+     */\n+    protected static final Logger LOG = LoggerFactory.getLogger(RoleDetailsPanel.class);\n+\n     @SpringBean\n     private UserRestClient userRestClient;\n \n@@ -89,7 +96,7 @@ public RoleDetailsPanel(final String id, final RoleTO roleTO, final boolean temp\n             parent.setReadOnly(true);\n             parent.setOutputMarkupId(true);\n             parentFragment.add(parent);\n-            final IndicatingAjaxLink parentSelect = new IndicatingAjaxLink(\"parentSelect\") {\n+            final IndicatingAjaxLink<Void> parentSelect = new IndicatingAjaxLink<Void>(\"parentSelect\") {\n \n                 private static final long serialVersionUID = -7978723352517770644L;\n \n@@ -109,7 +116,7 @@ public Page createPage() {\n                 }\n             };\n             parentFragment.add(parentSelect);\n-            final IndicatingAjaxLink parentReset = new IndicatingAjaxLink(\"parentReset\") {\n+            final IndicatingAjaxLink<Void> parentReset = new IndicatingAjaxLink<Void>(\"parentReset\") {\n \n                 private static final long serialVersionUID = -7978723352517770644L;\n \n@@ -146,7 +153,7 @@ public void onClick(final AjaxRequestTarget target) {\n         userOwner.setReadOnly(true);\n         userOwner.setOutputMarkupId(true);\n         ownerContainer.add(userOwner);\n-        final IndicatingAjaxLink userOwnerSelect = new IndicatingAjaxLink(\"userOwnerSelect\") {\n+        final IndicatingAjaxLink<Void> userOwnerSelect = new IndicatingAjaxLink<Void>(\"userOwnerSelect\") {\n \n             private static final long serialVersionUID = -7978723352517770644L;\n \n@@ -165,7 +172,7 @@ public Page createPage() {\n             }\n         };\n         ownerContainer.add(userOwnerSelect);\n-        final IndicatingAjaxLink userOwnerReset = new IndicatingAjaxLink(\"userOwnerReset\") {\n+        final IndicatingAjaxLink<Void> userOwnerReset = new IndicatingAjaxLink<Void>(\"userOwnerReset\") {\n \n             private static final long serialVersionUID = -7978723352517770644L;\n \n@@ -182,7 +189,7 @@ public void onClick(final AjaxRequestTarget target) {\n         roleOwner.setReadOnly(true);\n         roleOwner.setOutputMarkupId(true);\n         ownerContainer.add(roleOwner);\n-        final IndicatingAjaxLink roleOwnerSelect = new IndicatingAjaxLink(\"roleOwnerSelect\") {\n+        final IndicatingAjaxLink<Void> roleOwnerSelect = new IndicatingAjaxLink<Void>(\"roleOwnerSelect\") {\n \n             private static final long serialVersionUID = -7978723352517770644L;\n \n@@ -202,7 +209,7 @@ public Page createPage() {\n             }\n         };\n         ownerContainer.add(roleOwnerSelect);\n-        final IndicatingAjaxLink roleOwnerReset = new IndicatingAjaxLink(\"roleOwnerReset\") {\n+        final IndicatingAjaxLink<Void> roleOwnerReset = new IndicatingAjaxLink<Void>(\"roleOwnerReset\") {\n \n             private static final long serialVersionUID = -7978723352517770644L;\n \n@@ -265,20 +272,30 @@ public Object getObject() {\n             switch (type) {\n                 case USER:\n                     if (roleTO.getUserOwner() != null) {\n-                        UserTO user = userRestClient.read(roleTO.getUserOwner());\n+                        UserTO user = null;\n+                        try {\n+                            user = userRestClient.read(roleTO.getUserOwner());\n+                        } catch (Exception e) {\n+                            LOG.warn(\"Could not find user with id {}, ignoring\", roleTO.getUserOwner(), e);\n+                        }\n                         if (user == null) {\n-                            object = String.valueOf(roleTO.getUserOwner());\n+                            roleTO.setUserOwner(null);\n                         } else {\n                             object = user.getId() + \" \" + user.getUsername();\n                         }\n                     }\n                     break;\n \n                 case ROLE:\n+                    RoleTO role = null;\n                     if (roleTO.getRoleOwner() != null) {\n-                        RoleTO role = roleRestClient.read(roleTO.getRoleOwner());\n+                        try {\n+                            role = roleRestClient.read(roleTO.getRoleOwner());\n+                        } catch (Exception e) {\n+                            LOG.warn(\"Could not find role with id {}, ignoring\", roleTO.getRoleOwner(), e);\n+                        }\n                         if (role == null) {\n-                            object = String.valueOf(roleTO.getRoleOwner());\n+                            roleTO.setRoleOwner(null);\n                         } else {\n                             object = role.getDisplayName();\n                         }\n@@ -328,9 +345,14 @@ public ParentModel(final RoleTO roleTO) {\n         public Object getObject() {\n             Object object = null;\n             if (roleTO.getParent() != 0) {\n-                RoleTO parent = roleRestClient.read(roleTO.getParent());\n+                RoleTO parent = null;\n+                try {\n+                    parent = roleRestClient.read(roleTO.getParent());\n+                } catch (Exception e) {\n+                    LOG.warn(\"Could not find role with id {}, ignoring\", roleTO.getParent(), e);\n+                }\n                 if (parent == null) {\n-                    object = String.valueOf(roleTO.getParent());\n+                    roleTO.setParent(0);\n                 } else {\n                     object = parent.getDisplayName();\n                 }\n@@ -340,9 +362,7 @@ public Object getObject() {\n \n         @Override\n         public void setObject(final Object object) {\n-            long parentId = (object instanceof Long)\n-                    ? ((Long) object).longValue() : 0;\n-            roleTO.setParent(parentId);\n+            roleTO.setParent((object instanceof Long) ? ((Long) object) : 0);\n         }\n \n         @Override"},{"sha":"a3596ea77f89e31efbdbff4935783b613c817011","filename":"console/src/main/java/org/apache/syncope/console/pages/panels/RolePanel.java","status":"modified","additions":3,"deletions":6,"changes":9,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/435cf91cda4887ee8305ceaee9dfb3f85635ea9a/console%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fconsole%2Fpages%2Fpanels%2FRolePanel.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/435cf91cda4887ee8305ceaee9dfb3f85635ea9a/console%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fconsole%2Fpages%2Fpanels%2FRolePanel.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/console%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fconsole%2Fpages%2Fpanels%2FRolePanel.java?ref=435cf91cda4887ee8305ceaee9dfb3f85635ea9a","patch":"@@ -98,8 +98,7 @@ public RolePanel build() {\n     private RolePanel(final Builder builder) {\n         super(builder.id);\n \n-        this.add(new RoleDetailsPanel(\n-                \"details\", builder.roleTO, builder.mode == RoleModalPage.Mode.TEMPLATE));\n+        this.add(new RoleDetailsPanel(\"details\", builder.roleTO, builder.mode == RoleModalPage.Mode.TEMPLATE));\n \n         if (builder.pageReference == null || builder.roleTO.getId() == 0) {\n             this.add(new Label(\"statuspanel\", \"\"));\n@@ -151,16 +150,14 @@ private RolePanel(final Builder builder) {\n         //--------------------------------\n         // Security container\n         //--------------------------------\n-\n         this.add(new RoleSecurityPanel(\"security\", builder.roleTO).setOutputMarkupId(true));\n         //--------------------------------\n \n         //--------------------------------\n         // Resources container\n         //--------------------------------\n-\n-        this.add(new ResourcesPanel.Builder(\"resources\").attributableTO(builder.roleTO).build()\n-                .setOutputMarkupId(true));\n+        this.add(new ResourcesPanel.Builder(\"resources\").attributableTO(builder.roleTO).build().\n+                setOutputMarkupId(true));\n         //--------------------------------\n \n         ListModel<String> selectedEntitlements = new ListModel<String>(builder.roleTO.getEntitlements());"},{"sha":"8b07d6d097f651892354d5467fd701c10d00d943","filename":"core/src/main/java/org/apache/syncope/core/connid/ConnObjectUtil.java","status":"modified","additions":23,"deletions":4,"changes":27,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/435cf91cda4887ee8305ceaee9dfb3f85635ea9a/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fconnid%2FConnObjectUtil.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/435cf91cda4887ee8305ceaee9dfb3f85635ea9a/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fconnid%2FConnObjectUtil.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fconnid%2FConnObjectUtil.java?ref=435cf91cda4887ee8305ceaee9dfb3f85635ea9a","patch":"@@ -52,6 +52,7 @@\n import org.apache.syncope.core.persistence.dao.PolicyDAO;\n import org.apache.syncope.core.persistence.dao.ResourceDAO;\n import org.apache.syncope.core.persistence.dao.RoleDAO;\n+import org.apache.syncope.core.persistence.dao.UserDAO;\n import org.apache.syncope.core.propagation.ConnectorFactory;\n import org.apache.syncope.core.propagation.Connector;\n import org.apache.syncope.core.rest.controller.UnauthorizedRoleException;\n@@ -95,6 +96,9 @@ public class ConnObjectUtil {\n     @Autowired\n     private PolicyDAO policyDAO;\n \n+    @Autowired\n+    private UserDAO userDAO;\n+\n     @Autowired\n     private RoleDAO roleDAO;\n \n@@ -379,10 +383,25 @@ private <T extends AbstractAttributableTO> T getAttributableTOFromConnObject(fin\n                     }\n                 }\n \n-                ((RoleTO) attributableTO).setParent(((RoleTO) template).getParent());\n+                if (((RoleTO) template).getParent() != 0) {\n+                    final SyncopeRole parentRole = roleDAO.find(((RoleTO) template).getParent());\n+                    if (parentRole != null) {\n+                        ((RoleTO) attributableTO).setParent(parentRole.getId());\n+                    }\n+                }\n \n-                ((RoleTO) attributableTO).setUserOwner(((RoleTO) template).getUserOwner());\n-                ((RoleTO) attributableTO).setRoleOwner(((RoleTO) template).getRoleOwner());\n+                if (((RoleTO) template).getUserOwner() != null) {\n+                    final SyncopeUser userOwner = userDAO.find(((RoleTO) template).getUserOwner());\n+                    if (userOwner != null) {\n+                        ((RoleTO) attributableTO).setUserOwner(userOwner.getId());\n+                    }\n+                }\n+                if (((RoleTO) template).getRoleOwner() != null) {\n+                    final SyncopeRole roleOwner = roleDAO.find(((RoleTO) template).getRoleOwner());\n+                    if (roleOwner != null) {\n+                        ((RoleTO) attributableTO).setRoleOwner(roleOwner.getId());\n+                    }\n+                }\n \n                 ((RoleTO) attributableTO).setEntitlements(((RoleTO) template).getEntitlements());\n \n@@ -537,7 +556,7 @@ private void retrieveVirAttrValue(\n                         final String accountId = attrUtil.getAccountIdItem(resource) == null\n                                 ? null\n                                 : MappingUtil.getAccountIdValue(\n-                                owner, resource, attrUtil.getAccountIdItem(resource));\n+                                        owner, resource, attrUtil.getAccountIdItem(resource));\n \n                         if (StringUtils.isBlank(accountId)) {\n                             throw new IllegalArgumentException(\"No AccountId found for \" + resource.getName());"},{"sha":"c800910ce35e2e5cc294bc6296ccfdbaa4627e66","filename":"core/src/main/java/org/apache/syncope/core/persistence/beans/SyncTask.java","status":"modified","additions":3,"deletions":2,"changes":5,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/435cf91cda4887ee8305ceaee9dfb3f85635ea9a/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fpersistence%2Fbeans%2FSyncTask.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/435cf91cda4887ee8305ceaee9dfb3f85635ea9a/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fpersistence%2Fbeans%2FSyncTask.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fpersistence%2Fbeans%2FSyncTask.java?ref=435cf91cda4887ee8305ceaee9dfb3f85635ea9a","patch":"@@ -27,6 +27,7 @@\n import org.apache.syncope.common.to.RoleTO;\n import org.apache.syncope.common.to.UserTO;\n import org.apache.syncope.core.persistence.validation.entity.SyncTaskCheck;\n+import org.apache.syncope.core.sync.impl.SyncJob;\n import org.apache.syncope.core.util.XMLSerializer;\n \n @Entity\n@@ -80,7 +81,7 @@ public class SyncTask extends SchedTask {\n     public SyncTask() {\n         super();\n \n-        super.setJobClassName(\"org.apache.syncope.core.sync.impl.SyncJob\");\n+        super.setJobClassName(SyncJob.class.getName());\n     }\n \n     @Override\n@@ -92,7 +93,7 @@ public ExternalResource getResource() {\n         return resource;\n     }\n \n-    public void setResource(ExternalResource resource) {\n+    public void setResource(final ExternalResource resource) {\n         this.resource = resource;\n     }\n "},{"sha":"19b5bf8c07de5482a04408b98a5c6e940f66b95c","filename":"pom.xml","status":"modified","additions":1,"deletions":1,"changes":2,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/435cf91cda4887ee8305ceaee9dfb3f85635ea9a/pom.xml","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/435cf91cda4887ee8305ceaee9dfb3f85635ea9a/pom.xml","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/pom.xml?ref=435cf91cda4887ee8305ceaee9dfb3f85635ea9a","patch":"@@ -307,7 +307,7 @@ under the License.\n     <jstl.version>1.2</jstl.version>\n         \n     <connid.version>1.3.3</connid.version>\n-    <connid.soap.version>1.2.6</connid.soap.version>\n+    <connid.soap.version>1.2.7</connid.soap.version>\n     <connid.db.table.version>2.1.6</connid.db.table.version>\n     <connid.csvdir.version>0.7</connid.csvdir.version>\n     <connid.ldap.version>1.3.6</connid.ldap.version>"}]}