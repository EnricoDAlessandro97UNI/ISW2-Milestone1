{"sha":"7732824c3d1ecb83143736cf66af9b036165c4c1","node_id":"MDY6Q29tbWl0NjM2ODc5MDYyOjc3MzI4MjRjM2QxZWNiODMxNDM3MzZjZjY2YWY5YjAzNjE2NWM0YzE=","commit":{"author":{"name":"Unknown","email":"unknown@apache.org","date":"2010-11-10T12:54:56Z"},"committer":{"name":"Unknown","email":"unknown@apache.org","date":"2010-11-10T12:54:56Z"},"message":"Bugfixing when deleting a JPAWorkflowEntry in rather complex scenarios\n\ngit-svn-id: https://svn.apache.org/repos/asf/incubator/syncope/trunk@1246625 13f79535-47bb-0310-9956-ffa450edef68","tree":{"sha":"327700fb8bdedf985ac55e881cf5a32ef8697825","url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/git/trees/327700fb8bdedf985ac55e881cf5a32ef8697825"},"url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/git/commits/7732824c3d1ecb83143736cf66af9b036165c4c1","comment_count":0,"verification":{"verified":false,"reason":"unsigned","signature":null,"payload":null}},"url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/7732824c3d1ecb83143736cf66af9b036165c4c1","html_url":"https://github.com/EnricoDAlessandro97UNI/syncope/commit/7732824c3d1ecb83143736cf66af9b036165c4c1","comments_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/7732824c3d1ecb83143736cf66af9b036165c4c1/comments","author":null,"committer":null,"parents":[{"sha":"1703f8bfe61cb91b3016de87c745d5dada8c3a89","url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/1703f8bfe61cb91b3016de87c745d5dada8c3a89","html_url":"https://github.com/EnricoDAlessandro97UNI/syncope/commit/1703f8bfe61cb91b3016de87c745d5dada8c3a89"}],"stats":{"total":24,"additions":18,"deletions":6},"files":[{"sha":"935d079d4c266726c6520d03edaa2bd37f4549bd","filename":"core/src/main/java/jpasymphony/beans/JPAWorkflowEntry.java","status":"modified","additions":0,"deletions":3,"changes":3,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/7732824c3d1ecb83143736cf66af9b036165c4c1/core%2Fsrc%2Fmain%2Fjava%2Fjpasymphony%2Fbeans%2FJPAWorkflowEntry.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/7732824c3d1ecb83143736cf66af9b036165c4c1/core%2Fsrc%2Fmain%2Fjava%2Fjpasymphony%2Fbeans%2FJPAWorkflowEntry.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fsrc%2Fmain%2Fjava%2Fjpasymphony%2Fbeans%2FJPAWorkflowEntry.java?ref=7732824c3d1ecb83143736cf66af9b036165c4c1","patch":"@@ -24,7 +24,6 @@\n import javax.persistence.Id;\n import javax.persistence.OneToMany;\n import javax.persistence.Table;\n-import org.hibernate.annotations.Cascade;\n import org.syncope.core.persistence.beans.AbstractBaseBean;\n \n @Entity\n@@ -41,11 +40,9 @@ public class JPAWorkflowEntry extends AbstractBaseBean\n     private Integer workflowState;\n \n     @OneToMany(cascade = CascadeType.ALL, mappedBy = \"workflowEntry\")\n-    @Cascade(org.hibernate.annotations.CascadeType.DELETE_ORPHAN)\n     private List<JPACurrentStep> currentSteps;\n \n     @OneToMany(cascade = CascadeType.ALL, mappedBy = \"workflowEntry\")\n-    @Cascade(org.hibernate.annotations.CascadeType.DELETE_ORPHAN)\n     private List<JPAHistoryStep> historySteps;\n \n     public JPAWorkflowEntry() {"},{"sha":"c1274ff44ce15af9350957cdfb2ded0c94a16381","filename":"core/src/main/java/jpasymphony/dao/impl/JPAWorkflowEntryDAOImpl.java","status":"modified","additions":14,"deletions":0,"changes":14,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/7732824c3d1ecb83143736cf66af9b036165c4c1/core%2Fsrc%2Fmain%2Fjava%2Fjpasymphony%2Fdao%2Fimpl%2FJPAWorkflowEntryDAOImpl.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/7732824c3d1ecb83143736cf66af9b036165c4c1/core%2Fsrc%2Fmain%2Fjava%2Fjpasymphony%2Fdao%2Fimpl%2FJPAWorkflowEntryDAOImpl.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fsrc%2Fmain%2Fjava%2Fjpasymphony%2Fdao%2Fimpl%2FJPAWorkflowEntryDAOImpl.java?ref=7732824c3d1ecb83143736cf66af9b036165c4c1","patch":"@@ -67,6 +67,20 @@ public void delete(final Long id) {\n             }\n         }\n \n+        // Force loading all of JPACurrentSteps belonging to this entry\n+        Query query = entityManager.createQuery(\n+                \"SELECT e FROM JPACurrentStep e \"\n+                + \"WHERE e.workflowEntry=:workflowEntry\");\n+        query.setParameter(\"workflowEntry\", entry);\n+        query.getResultList();\n+\n+        // Force loading all of JPAHistorySteps belonging to this entry\n+        query = entityManager.createQuery(\n+                \"SELECT e FROM JPAHistoryStep e \"\n+                + \"WHERE e.workflowEntry=:workflowEntry\");\n+        query.setParameter(\"workflowEntry\", entry);\n+        query.getResultList();\n+\n         entityManager.remove(entry);\n     }\n "},{"sha":"32bc1d36d01301c7663c1c7a8586a6214e19a870","filename":"core/src/main/java/org/syncope/core/persistence/beans/user/UserAttributeValue.java","status":"modified","additions":3,"deletions":3,"changes":6,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/7732824c3d1ecb83143736cf66af9b036165c4c1/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fcore%2Fpersistence%2Fbeans%2Fuser%2FUserAttributeValue.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/7732824c3d1ecb83143736cf66af9b036165c4c1/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fcore%2Fpersistence%2Fbeans%2Fuser%2FUserAttributeValue.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fcore%2Fpersistence%2Fbeans%2Fuser%2FUserAttributeValue.java?ref=7732824c3d1ecb83143736cf66af9b036165c4c1","patch":"@@ -2,9 +2,9 @@\n  *  Licensed under the Apache License, Version 2.0 (the \"License\");\n  *  you may not use this file except in compliance with the License.\n  *  You may obtain a copy of the License at\n- * \n+ *\n  *       http://www.apache.org/licenses/LICENSE-2.0\n- * \n+ *\n  *  Unless required by applicable law or agreed to in writing, software\n  *  distributed under the License is distributed on an \"AS IS\" BASIS,\n  *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n@@ -31,7 +31,7 @@ public <T extends AbstractAttribute> T getAttribute() {\n     }\n \n     @Override\n-    public <T extends AbstractAttribute> void setAttribute(T attribute) {\n+    public <T extends AbstractAttribute> void setAttribute(final T attribute) {\n         this.attribute = (UserAttribute) attribute;\n     }\n }"},{"sha":"b85f9ec7b586ef6afbb36c48f7697933ea9405ae","filename":"core/src/test/java/jpasymphony/relationships/JPAWorkflowEntryTest.java","status":"modified","additions":1,"deletions":0,"changes":1,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/7732824c3d1ecb83143736cf66af9b036165c4c1/core%2Fsrc%2Ftest%2Fjava%2Fjpasymphony%2Frelationships%2FJPAWorkflowEntryTest.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/7732824c3d1ecb83143736cf66af9b036165c4c1/core%2Fsrc%2Ftest%2Fjava%2Fjpasymphony%2Frelationships%2FJPAWorkflowEntryTest.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fsrc%2Ftest%2Fjava%2Fjpasymphony%2Frelationships%2FJPAWorkflowEntryTest.java?ref=7732824c3d1ecb83143736cf66af9b036165c4c1","patch":"@@ -60,6 +60,7 @@ public final void delete()\n \n         ((JPACurrentStep) step).setActionId(999);\n         workflowStore.moveToHistory(step);\n+\n         step = workflowStore.createCurrentStep(entry.getId(), 12,\n                 \"owner\", new Date(), new Date(), \"status\", new long[0]);\n "}]}