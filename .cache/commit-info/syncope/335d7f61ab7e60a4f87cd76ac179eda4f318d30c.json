{"sha":"335d7f61ab7e60a4f87cd76ac179eda4f318d30c","node_id":"MDY6Q29tbWl0NjM2ODc5MDYyOjMzNWQ3ZjYxYWI3ZTYwYTRmODdjZDc2YWMxNzllZGE0ZjMxOGQzMGM=","commit":{"author":{"name":"Massimiliano Perrone","email":"massimiliano.perrone@tirasa.net","date":"2015-12-15T14:49:23Z"},"committer":{"name":"Massimiliano Perrone","email":"massimiliano.perrone@tirasa.net","date":"2015-12-15T17:08:02Z"},"message":"Camel option, SYNCOPE-637","tree":{"sha":"f234151349699f2fb8e139450905a8cba509e8e5","url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/git/trees/f234151349699f2fb8e139450905a8cba509e8e5"},"url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/git/commits/335d7f61ab7e60a4f87cd76ac179eda4f318d30c","comment_count":0,"verification":{"verified":false,"reason":"unsigned","signature":null,"payload":null}},"url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/335d7f61ab7e60a4f87cd76ac179eda4f318d30c","html_url":"https://github.com/EnricoDAlessandro97UNI/syncope/commit/335d7f61ab7e60a4f87cd76ac179eda4f318d30c","comments_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/335d7f61ab7e60a4f87cd76ac179eda4f318d30c/comments","author":{"login":"massx1","id":1792923,"node_id":"MDQ6VXNlcjE3OTI5MjM=","avatar_url":"https://avatars.githubusercontent.com/u/1792923?v=4","gravatar_id":"","url":"https://api.github.com/users/massx1","html_url":"https://github.com/massx1","followers_url":"https://api.github.com/users/massx1/followers","following_url":"https://api.github.com/users/massx1/following{/other_user}","gists_url":"https://api.github.com/users/massx1/gists{/gist_id}","starred_url":"https://api.github.com/users/massx1/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/massx1/subscriptions","organizations_url":"https://api.github.com/users/massx1/orgs","repos_url":"https://api.github.com/users/massx1/repos","events_url":"https://api.github.com/users/massx1/events{/privacy}","received_events_url":"https://api.github.com/users/massx1/received_events","type":"User","site_admin":false},"committer":{"login":"massx1","id":1792923,"node_id":"MDQ6VXNlcjE3OTI5MjM=","avatar_url":"https://avatars.githubusercontent.com/u/1792923?v=4","gravatar_id":"","url":"https://api.github.com/users/massx1","html_url":"https://github.com/massx1","followers_url":"https://api.github.com/users/massx1/followers","following_url":"https://api.github.com/users/massx1/following{/other_user}","gists_url":"https://api.github.com/users/massx1/gists{/gist_id}","starred_url":"https://api.github.com/users/massx1/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/massx1/subscriptions","organizations_url":"https://api.github.com/users/massx1/orgs","repos_url":"https://api.github.com/users/massx1/repos","events_url":"https://api.github.com/users/massx1/events{/privacy}","received_events_url":"https://api.github.com/users/massx1/received_events","type":"User","site_admin":false},"parents":[{"sha":"e21587171946ae764b820d4db9c7f731e84e871f","url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/e21587171946ae764b820d4db9c7f731e84e871f","html_url":"https://github.com/EnricoDAlessandro97UNI/syncope/commit/e21587171946ae764b820d4db9c7f731e84e871f"}],"stats":{"total":136,"additions":100,"deletions":36},"files":[{"sha":"c69b4b4c9390850b39caa6e7ad1460c637ebf266","filename":"installer/pom.xml","status":"modified","additions":6,"deletions":0,"changes":6,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/335d7f61ab7e60a4f87cd76ac179eda4f318d30c/installer%2Fpom.xml","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/335d7f61ab7e60a4f87cd76ac179eda4f318d30c/installer%2Fpom.xml","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/installer%2Fpom.xml?ref=335d7f61ab7e60a4f87cd76ac179eda4f318d30c","patch":"@@ -188,6 +188,12 @@ under the License.\n           <include>**/MasterDomain.xml</include>\n         </includes>\n       </resource>\n+      <resource>\n+        <directory>${basedir}/../fit/core-reference/src/main/resources/all</directory>\n+        <includes>\n+          <include>provisioning.properties</include>\n+        </includes>\n+      </resource>\n       <resource>\n         <directory>${basedir}</directory>\n         <targetPath>META-INF</targetPath>"},{"sha":"54f5685033b38e41c4dcf2c5cc329b1aa30cf6f9","filename":"installer/src/main/java/org/apache/syncope/installer/files/CorePom.java","status":"added","additions":54,"deletions":0,"changes":54,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/335d7f61ab7e60a4f87cd76ac179eda4f318d30c/installer%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Finstaller%2Ffiles%2FCorePom.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/335d7f61ab7e60a4f87cd76ac179eda4f318d30c/installer%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Finstaller%2Ffiles%2FCorePom.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/installer%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Finstaller%2Ffiles%2FCorePom.java?ref=335d7f61ab7e60a4f87cd76ac179eda4f318d30c","patch":"@@ -0,0 +1,54 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *   http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+package org.apache.syncope.installer.files;\n+\n+public final class CorePom {\n+\n+    public static final String SWAGGER_PLACEHOLDER = \"</dependencies>\";\n+\n+    public static final String SWAGGER_CONTENT_TO_ADD = \"  <dependency>\\n\"\n+            + \"      <groupId>org.apache.syncope.ext</groupId>\\n\"\n+            + \"      <artifactId>syncope-ext-swagger-ui</artifactId>\\n\"\n+            + \"      <version>${syncope.version}</version>\\n\"\n+            + \"    </dependency>\\n\"\n+            + \"  </dependencies>\\n\";\n+\n+    public static final String CAMEL_PLACEHOLDER = \"</dependencies>\";\n+\n+    public static final String CAMEL_CONTENT_TO_ADD = \"  <dependency>\\n\"\n+            + \"      <groupId>org.apache.syncope.ext.camel</groupId>\\n\"\n+            + \"      <artifactId>syncope-ext-camel-rest-cxf</artifactId>\\n\"\n+            + \"      <version>${syncope.version}</version>\\n\"\n+            + \"    </dependency>\\n\"\n+            + \"    <dependency>\\n\"\n+            + \"      <groupId>org.apache.syncope.ext.camel</groupId>\\n\"\n+            + \"      <artifactId>syncope-ext-camel-persistence-jpa</artifactId>\\n\"\n+            + \"      <version>${syncope.version}</version>\\n\"\n+            + \"    </dependency>\\n\"\n+            + \"    <dependency>\\n\"\n+            + \"      <groupId>org.apache.syncope.ext.camel</groupId>\\n\"\n+            + \"      <artifactId>syncope-ext-camel-provisioning</artifactId>\\n\"\n+            + \"      <version>${syncope.version}</version>\\n\"\n+            + \"    </dependency>\\n\"\n+            + \"  </dependencies>\\n\";\n+\n+    private CorePom() {\n+        // private constructor for static utility class\n+    }\n+}"},{"sha":"4f23ca75b23066e447b5d182d348aa85cf6c0ea0","filename":"installer/src/main/java/org/apache/syncope/installer/files/ParentPom.java","status":"modified","additions":8,"deletions":17,"changes":25,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/335d7f61ab7e60a4f87cd76ac179eda4f318d30c/installer%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Finstaller%2Ffiles%2FParentPom.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/335d7f61ab7e60a4f87cd76ac179eda4f318d30c/installer%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Finstaller%2Ffiles%2FParentPom.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/installer%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Finstaller%2Ffiles%2FParentPom.java?ref=335d7f61ab7e60a4f87cd76ac179eda4f318d30c","patch":"@@ -20,26 +20,17 @@\n \n public final class ParentPom {\n \n-    public static final String SWAGGER_PLACEHOLDER = \"<dependencies>\";\n-\n-    public static final String SWAGGER_CONTENT_TO_ADD = \"<dependencies>\\n\"\n-            + \"    <dependency>\\n\"\n-            + \"      <groupId>org.apache.syncope.ext</groupId>\\n\"\n-            + \"      <artifactId>syncope-ext-swagger-ui</artifactId>\\n\"\n-            + \"      <version>${syncope.version}</version>\\n\"\n-            + \"    </dependency>\\n\";\n-\n     public static final String REPOSITORY_PLACEHOLDER = \"</project>\";\n \n     public static final String REPOSITORY_CONTENT_TO_ADD = \"  <repositories>\\n\"\n-            + \"  <repository>\\n\"\n-            + \"    <id>ASF</id>\\n\"\n-            + \"    <url>https://repository.apache.org/content/repositories/snapshots/</url>\\n\"\n-            + \"    <snapshots>\\n\"\n-            + \"      <enabled>true</enabled>\\n\"\n-            + \"    </snapshots>\\n\"\n-            + \"  </repository>\\n\"\n-            + \"</repositories>\\n\"\n+            + \"    <repository>\\n\"\n+            + \"      <id>ASF</id>\\n\"\n+            + \"      <url>https://repository.apache.org/content/repositories/snapshots/</url>\\n\"\n+            + \"      <snapshots>\\n\"\n+            + \"        <enabled>true</enabled>\\n\"\n+            + \"      </snapshots>\\n\"\n+            + \"    </repository>\\n\"\n+            + \"  </repositories>\\n\"\n             + \"</project>\\n\";\n \n     private ParentPom() {"},{"sha":"9c3f184f6a8539d3e52fc80dbd4dc3f3f7f5ac30","filename":"installer/src/main/java/org/apache/syncope/installer/processes/ArchetypeProcess.java","status":"modified","additions":24,"deletions":3,"changes":27,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/335d7f61ab7e60a4f87cd76ac179eda4f318d30c/installer%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Finstaller%2Fprocesses%2FArchetypeProcess.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/335d7f61ab7e60a4f87cd76ac179eda4f318d30c/installer%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Finstaller%2Fprocesses%2FArchetypeProcess.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/installer%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Finstaller%2Fprocesses%2FArchetypeProcess.java?ref=335d7f61ab7e60a4f87cd76ac179eda4f318d30c","patch":"@@ -25,6 +25,7 @@\n import java.util.Properties;\n import javax.xml.parsers.ParserConfigurationException;\n import javax.xml.transform.TransformerException;\n+import org.apache.syncope.installer.files.CorePom;\n import org.apache.syncope.installer.files.ParentPom;\n import org.apache.syncope.installer.utilities.InstallLog;\n import org.apache.syncope.installer.utilities.MavenUtils;\n@@ -95,6 +96,13 @@ public void run(final AbstractUIProcessHandler handler, final String[] args) {\n         mavenUtils.archetypeGenerate(\n                 syncopeVersion, groupId, artifactId, secretKey, anonymousKey, installPath, customMavenProxySettings);\n \n+        if (syncopeVersion.contains(\"SNAPSHOT\")) {\n+            final File pomFile = new File(syncopeInstallDir + PROPERTIES.getProperty(\"pomFile\"));\n+            String contentPomFile = fileSystemUtils.readFile(pomFile);       \n+            fileSystemUtils.\n+                    writeToFile(pomFile, contentPomFile.replace(ParentPom.REPOSITORY_PLACEHOLDER, ParentPom.REPOSITORY_CONTENT_TO_ADD));\n+        }\n+        \n         if (swagger) {\n             final File pomFile = new File(\n                     syncopeInstallDir\n@@ -103,11 +111,24 @@ public void run(final AbstractUIProcessHandler handler, final String[] args) {\n                     + File.separator\n                     + PROPERTIES.getProperty(\"pomFile\"));\n             String contentPomFile = fileSystemUtils.readFile(pomFile);\n-            contentPomFile = contentPomFile.replace(\n-                    ParentPom.REPOSITORY_PLACEHOLDER, ParentPom.REPOSITORY_CONTENT_TO_ADD);\n-            contentPomFile = contentPomFile.replace(ParentPom.SWAGGER_PLACEHOLDER, ParentPom.SWAGGER_CONTENT_TO_ADD);\n+            contentPomFile = contentPomFile.replace(CorePom.SWAGGER_PLACEHOLDER, CorePom.SWAGGER_CONTENT_TO_ADD);\n+\n+            fileSystemUtils.writeToFile(pomFile, contentPomFile);\n+        }\n+        \n+        if (camel) {\n+            final File pomFile = new File(\n+                    syncopeInstallDir\n+                    + File.separator\n+                    + \"core\"\n+                    + File.separator\n+                    + PROPERTIES.getProperty(\"pomFile\"));\n+            String contentPomFile = fileSystemUtils.readFile(pomFile);\n+            contentPomFile = contentPomFile.replace(CorePom.CAMEL_PLACEHOLDER, CorePom.CAMEL_CONTENT_TO_ADD);\n \n             fileSystemUtils.writeToFile(pomFile, contentPomFile);\n+            fileSystemUtils.copyFileFromResources(\"/provisioning.properties\",\n+                syncopeInstallDir + PROPERTIES.getProperty(\"provisioningPropertiesFile\"), handler);\n         }\n \n         fileSystemUtils.createDirectory(confDirectory);"},{"sha":"a36b759fdfe7574046ec085a0de14a04b27ec12c","filename":"installer/src/main/java/org/apache/syncope/installer/processes/PersistenceProcess.java","status":"modified","additions":5,"deletions":13,"changes":18,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/335d7f61ab7e60a4f87cd76ac179eda4f318d30c/installer%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Finstaller%2Fprocesses%2FPersistenceProcess.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/335d7f61ab7e60a4f87cd76ac179eda4f318d30c/installer%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Finstaller%2Fprocesses%2FPersistenceProcess.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/installer%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Finstaller%2Fprocesses%2FPersistenceProcess.java?ref=335d7f61ab7e60a4f87cd76ac179eda4f318d30c","patch":"@@ -55,15 +55,16 @@ public void run(final AbstractUIProcessHandler handler, final String[] args) {\n         mysqlInnoDB = Boolean.valueOf(args[6]);\n         schema = args[7];\n \n-        StringBuilder masterProperties = new StringBuilder(MasterProperties.HEADER);\n+        final StringBuilder masterProperties = new StringBuilder(MasterProperties.HEADER);\n         setSyncopeInstallDir(installPath, artifactId);\n \n-        FileSystemUtils fileSystemUtils = new FileSystemUtils(handler);\n+        final FileSystemUtils fileSystemUtils = new FileSystemUtils(handler);\n         final File provisioningFile = new File(\n                 syncopeInstallDir + PROPERTIES.getProperty(\"provisioningPropertiesFile\"));\n \n-        final StringBuilder provisioningProperties\n-                = new StringBuilder(removeLastTwoLine(fileSystemUtils.readFile(provisioningFile)));\n+        final String provisioningFileString = fileSystemUtils.readFile(provisioningFile);\n+        final StringBuilder provisioningProperties = new StringBuilder(\n+                provisioningFileString.substring(0, provisioningFileString.indexOf(\"quartz.jobstore\")));\n         handler.logOutput(\"Configure persistence for \" + dbSelected, false);\n         InstallLog.getInstance().info(\"Configure persistence for \" + dbSelected);\n \n@@ -111,13 +112,4 @@ public void run(final AbstractUIProcessHandler handler, final String[] args) {\n                 syncopeInstallDir + PROPERTIES.getProperty(\"masterPropertiesFile\")),\n                 masterProperties.toString());\n     }\n-\n-    private String removeLastTwoLine(final String string) {\n-        int truncateIndex = string.length();\n-\n-        for (int i = 0; i < 3; i++) {\n-            truncateIndex = string.lastIndexOf('\\n', truncateIndex - 1);\n-        }\n-        return string.substring(0, truncateIndex);\n-    }\n }"},{"sha":"0691f2f94b7a93dce3fb0bf7d1de448e9b95dcab","filename":"installer/src/main/resources/izpack/userInputSpec.xml","status":"modified","additions":3,"deletions":3,"changes":6,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/335d7f61ab7e60a4f87cd76ac179eda4f318d30c/installer%2Fsrc%2Fmain%2Fresources%2Fizpack%2FuserInputSpec.xml","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/335d7f61ab7e60a4f87cd76ac179eda4f318d30c/installer%2Fsrc%2Fmain%2Fresources%2Fizpack%2FuserInputSpec.xml","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/installer%2Fsrc%2Fmain%2Fresources%2Fizpack%2FuserInputSpec.xml?ref=335d7f61ab7e60a4f87cd76ac179eda4f318d30c","patch":"@@ -109,12 +109,12 @@ under the License.\n     <field type=\"check\" variable=\"options.swagger\">\n       <spec id=\"options.swagger.id\" true=\"true\" false=\"false\" set=\"false\"/>\n     </field>\n-    <field type=\"check\" variable=\"options.activiti.workflow.adapter\">\n-      <spec id=\"options.activiti.workflow.adapter.id\" true=\"true\" false=\"false\" set=\"false\"/>\n-    </field>\n     <field type=\"check\" variable=\"options.camel\">\n       <spec id=\"options.camel.id\" true=\"true\" false=\"false\" set=\"false\"/>\n     </field>\n+    <field type=\"check\" variable=\"options.activiti.workflow.adapter\">\n+      <spec id=\"options.activiti.workflow.adapter.id\" true=\"true\" false=\"false\" set=\"false\"/>\n+    </field>\n   </panel>\n   \n   <panel id=\"persistence\" order=\"3\" border=\"false\">"}]}