{"sha":"cca472be51fd9d882e4bd8aa8f1e03a4c16112d6","node_id":"MDY6Q29tbWl0NjM2ODc5MDYyOmNjYTQ3MmJlNTFmZDlkODgyZTRiZDhhYThmMWUwM2E0YzE2MTEyZDY=","commit":{"author":{"name":"Colm O hEigeartaigh","email":"coheigea@apache.org","date":"2017-06-26T16:12:57Z"},"committer":{"name":"Colm O hEigeartaigh","email":"coheigea@apache.org","date":"2017-06-26T16:13:21Z"},"message":"SYNCOPE-1119 - Support specifying the admin password using the installer","tree":{"sha":"a002eafe9b6c31135b297dd1aada8591661624b4","url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/git/trees/a002eafe9b6c31135b297dd1aada8591661624b4"},"url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/git/commits/cca472be51fd9d882e4bd8aa8f1e03a4c16112d6","comment_count":0,"verification":{"verified":false,"reason":"unsigned","signature":null,"payload":null}},"url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/cca472be51fd9d882e4bd8aa8f1e03a4c16112d6","html_url":"https://github.com/EnricoDAlessandro97UNI/syncope/commit/cca472be51fd9d882e4bd8aa8f1e03a4c16112d6","comments_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/cca472be51fd9d882e4bd8aa8f1e03a4c16112d6/comments","author":{"login":"coheigea","id":472162,"node_id":"MDQ6VXNlcjQ3MjE2Mg==","avatar_url":"https://avatars.githubusercontent.com/u/472162?v=4","gravatar_id":"","url":"https://api.github.com/users/coheigea","html_url":"https://github.com/coheigea","followers_url":"https://api.github.com/users/coheigea/followers","following_url":"https://api.github.com/users/coheigea/following{/other_user}","gists_url":"https://api.github.com/users/coheigea/gists{/gist_id}","starred_url":"https://api.github.com/users/coheigea/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/coheigea/subscriptions","organizations_url":"https://api.github.com/users/coheigea/orgs","repos_url":"https://api.github.com/users/coheigea/repos","events_url":"https://api.github.com/users/coheigea/events{/privacy}","received_events_url":"https://api.github.com/users/coheigea/received_events","type":"User","site_admin":false},"committer":{"login":"coheigea","id":472162,"node_id":"MDQ6VXNlcjQ3MjE2Mg==","avatar_url":"https://avatars.githubusercontent.com/u/472162?v=4","gravatar_id":"","url":"https://api.github.com/users/coheigea","html_url":"https://github.com/coheigea","followers_url":"https://api.github.com/users/coheigea/followers","following_url":"https://api.github.com/users/coheigea/following{/other_user}","gists_url":"https://api.github.com/users/coheigea/gists{/gist_id}","starred_url":"https://api.github.com/users/coheigea/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/coheigea/subscriptions","organizations_url":"https://api.github.com/users/coheigea/orgs","repos_url":"https://api.github.com/users/coheigea/repos","events_url":"https://api.github.com/users/coheigea/events{/privacy}","received_events_url":"https://api.github.com/users/coheigea/received_events","type":"User","site_admin":false},"parents":[{"sha":"2deb36904c8d381d0060f10dd79c32e03185cd5e","url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/2deb36904c8d381d0060f10dd79c32e03185cd5e","html_url":"https://github.com/EnricoDAlessandro97UNI/syncope/commit/2deb36904c8d381d0060f10dd79c32e03185cd5e"}],"stats":{"total":37,"additions":34,"deletions":3},"files":[{"sha":"f3ba98c7768489fe19652665a176e3ef6dc1a3a2","filename":"archetype/src/main/resources/META-INF/maven/archetype-metadata.xml","status":"modified","additions":3,"deletions":0,"changes":3,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/cca472be51fd9d882e4bd8aa8f1e03a4c16112d6/archetype%2Fsrc%2Fmain%2Fresources%2FMETA-INF%2Fmaven%2Farchetype-metadata.xml","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/cca472be51fd9d882e4bd8aa8f1e03a4c16112d6/archetype%2Fsrc%2Fmain%2Fresources%2FMETA-INF%2Fmaven%2Farchetype-metadata.xml","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/archetype%2Fsrc%2Fmain%2Fresources%2FMETA-INF%2Fmaven%2Farchetype-metadata.xml?ref=cca472be51fd9d882e4bd8aa8f1e03a4c16112d6","patch":"@@ -24,6 +24,9 @@ under the License.\n     <requiredProperty key=\"secretKey\"/>\n     <requiredProperty key=\"anonymousKey\"/>\n     <requiredProperty key=\"jwsKey\"/>\n+    <requiredProperty key=\"adminPassword\">\n+        <defaultValue>5baa61e4c9b93f3f0682250b6cf8331b7ee68fd8</defaultValue>\n+    </requiredProperty>\n   </requiredProperties>\n   \n   <modules>"},{"sha":"a322758f936eef99c250911cfaf772c768465263","filename":"archetype/src/main/resources/meta-pom.xml","status":"modified","additions":1,"deletions":0,"changes":1,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/cca472be51fd9d882e4bd8aa8f1e03a4c16112d6/archetype%2Fsrc%2Fmain%2Fresources%2Fmeta-pom.xml","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/cca472be51fd9d882e4bd8aa8f1e03a4c16112d6/archetype%2Fsrc%2Fmain%2Fresources%2Fmeta-pom.xml","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/archetype%2Fsrc%2Fmain%2Fresources%2Fmeta-pom.xml?ref=cca472be51fd9d882e4bd8aa8f1e03a4c16112d6","patch":"@@ -34,6 +34,7 @@ under the License.\n     <secretKey>${secretKey}</secretKey>\n     <anonymousKey>${anonymousKey}</anonymousKey>\n     <jwsKey>${jwsKey}</jwsKey>\n+    <adminPassword>${adminPassword}</adminPassword>\n     \n     <rat.skip>true</rat.skip>\n     <checkstyle.skip>true</checkstyle.skip>"},{"sha":"5c39d1e4499f9ebb5de6ec6392656b16d144bb26","filename":"core/spring/src/main/resources/security.properties","status":"modified","additions":1,"deletions":1,"changes":2,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/cca472be51fd9d882e4bd8aa8f1e03a4c16112d6/core%2Fspring%2Fsrc%2Fmain%2Fresources%2Fsecurity.properties","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/cca472be51fd9d882e4bd8aa8f1e03a4c16112d6/core%2Fspring%2Fsrc%2Fmain%2Fresources%2Fsecurity.properties","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fspring%2Fsrc%2Fmain%2Fresources%2Fsecurity.properties?ref=cca472be51fd9d882e4bd8aa8f1e03a4c16112d6","patch":"@@ -15,7 +15,7 @@\n # specific language governing permissions and limitations\n # under the License.\n adminUser=${adminUser}\n-adminPassword=5baa61e4c9b93f3f0682250b6cf8331b7ee68fd8\n+adminPassword=${adminPassword}\n adminPasswordAlgorithm=SHA1\n \n anonymousUser=${anonymousUser}"},{"sha":"59ee8981240961701d1c020fe9b3d1618dcd75a5","filename":"installer/src/main/java/org/apache/syncope/installer/utilities/MavenUtils.java","status":"modified","additions":19,"deletions":2,"changes":21,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/cca472be51fd9d882e4bd8aa8f1e03a4c16112d6/installer%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Finstaller%2Futilities%2FMavenUtils.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/cca472be51fd9d882e4bd8aa8f1e03a4c16112d6/installer%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Finstaller%2Futilities%2FMavenUtils.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/installer%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Finstaller%2Futilities%2FMavenUtils.java?ref=cca472be51fd9d882e4bd8aa8f1e03a4c16112d6","patch":"@@ -23,15 +23,23 @@\n import java.io.FileNotFoundException;\n import java.io.IOException;\n import java.io.PrintStream;\n+import java.nio.charset.StandardCharsets;\n import java.nio.file.Files;\n+import java.security.MessageDigest;\n+import java.security.NoSuchAlgorithmException;\n import java.util.ArrayList;\n import java.util.Collections;\n import java.util.List;\n import java.util.Properties;\n+import java.util.logging.Level;\n+import java.util.logging.Logger;\n+\n import javax.xml.parsers.DocumentBuilder;\n import javax.xml.parsers.DocumentBuilderFactory;\n import javax.xml.parsers.ParserConfigurationException;\n import javax.xml.transform.TransformerException;\n+\n+import org.apache.commons.codec.binary.Hex;\n import org.apache.commons.io.FileUtils;\n import org.apache.maven.shared.invoker.DefaultInvocationRequest;\n import org.apache.maven.shared.invoker.DefaultInvoker;\n@@ -110,8 +118,17 @@ private Properties archetypeProperties(\n         properties.setProperty(\"anonymousKey\", anonymousKey);\n         properties.setProperty(\"jwsKey\", jwsKey);\n \n-        //String encodedPassword = PasswordGenerator.password(adminPassword, \"SHA-1\");\n-        //properties.setProperty(\"adminPassword\", encodedPassword);\n+        if (adminPassword != null) {\n+            try {\n+                final MessageDigest cript = MessageDigest.getInstance(\"SHA-1\");\n+                String encodedPassword =\n+                    new String(Hex.encodeHex(cript.digest(adminPassword.getBytes(StandardCharsets.UTF_8))));\n+                properties.setProperty(\"adminPassword\", encodedPassword);\n+            } catch (final NoSuchAlgorithmException ex) {\n+                Logger.getLogger(MavenUtils.class.getName()).log(Level.SEVERE, \"NoSuchAlgorithmException\", ex);\n+\n+            }\n+        }\n         properties.setProperty(\"version\", \"1.0-SNAPSHOT\");\n         return properties;\n     }"},{"sha":"35181e34b769b2fb67da8508b71e9a51c61897b5","filename":"installer/src/main/java/org/apache/syncope/installer/validators/ArchetypeValidator.java","status":"modified","additions":5,"deletions":0,"changes":5,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/cca472be51fd9d882e4bd8aa8f1e03a4c16112d6/installer%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Finstaller%2Fvalidators%2FArchetypeValidator.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/cca472be51fd9d882e4bd8aa8f1e03a4c16112d6/installer%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Finstaller%2Fvalidators%2FArchetypeValidator.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/installer%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Finstaller%2Fvalidators%2FArchetypeValidator.java?ref=cca472be51fd9d882e4bd8aa8f1e03a4c16112d6","patch":"@@ -34,6 +34,7 @@ public Status validateData(final InstallData installData) {\n         final String mavenSecretKey = StringUtils.trim(installData.getVariable(\"mvn.secretkey\"));\n         final String mavenAnonymousKey = StringUtils.trim(installData.getVariable(\"mvn.anonymous.key\"));\n         final String mavenJwsKey = StringUtils.trim(installData.getVariable(\"mvn.jws.key\"));\n+        final String mavenAdminPassword = StringUtils.trim(installData.getVariable(\"mvn.syncope.admin.password\"));\n         final String mavenLogDirectory = StringUtils.trim(installData.getVariable(\"mvn.log.directory\"));\n         final String mavenBundleDirectory = StringUtils.trim(installData.getVariable(\"mvn.bundle.directory\"));\n \n@@ -66,6 +67,10 @@ public Status validateData(final InstallData installData) {\n             error.append(\"JwsKey\\n\");\n             verified = false;\n         }\n+        if (StringUtils.isBlank(mavenAdminPassword)) {\n+            error.append(\"AdminPassword\\n\");\n+            verified = false;\n+        }\n         if (StringUtils.isBlank(mavenLogDirectory)) {\n             error.append(\"Logs directory\\n\");\n             verified = false;"},{"sha":"51a4b42014609d476787618a7ee31ca07a2ec8ee","filename":"installer/src/main/resources/izpack/userInputSpec.xml","status":"modified","additions":4,"deletions":0,"changes":4,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/cca472be51fd9d882e4bd8aa8f1e03a4c16112d6/installer%2Fsrc%2Fmain%2Fresources%2Fizpack%2FuserInputSpec.xml","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/cca472be51fd9d882e4bd8aa8f1e03a4c16112d6/installer%2Fsrc%2Fmain%2Fresources%2Fizpack%2FuserInputSpec.xml","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/installer%2Fsrc%2Fmain%2Fresources%2Fizpack%2FuserInputSpec.xml?ref=cca472be51fd9d882e4bd8aa8f1e03a4c16112d6","patch":"@@ -53,6 +53,10 @@ under the License.\n       <spec id=\"mvn.jws.key.id\" size=\"20\" set=\"ZW7pRixehFuNUtnY5Se47IemgMryTzazPPJ9CGX5LTCmsOJpOgHAQEuPQeV9A28f\"/>\n     </field>\n     <field type=\"space\"/>\n+    <field type=\"text\" variable=\"mvn.syncope.admin.password\">\n+      <spec id=\"mvn.syncope.admin.password.id\" size=\"20\" set=\"password\"/>\n+    </field>\n+    <field type=\"space\"/>\n     <field type=\"dir\" variable=\"mvn.conf.directory\">\n       <spec id=\"archetype.mvn.conf.directory\" size=\"20\" set=\"/var/tmp/syncope/conf\" mustExist=\"false\" create=\"true\"/>\n     </field>"},{"sha":"198152c7a342d1c98c3ead641ac59c539b2b1bc2","filename":"pom.xml","status":"modified","additions":1,"deletions":0,"changes":1,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/cca472be51fd9d882e4bd8aa8f1e03a4c16112d6/pom.xml","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/cca472be51fd9d882e4bd8aa8f1e03a4c16112d6/pom.xml","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/pom.xml?ref=cca472be51fd9d882e4bd8aa8f1e03a4c16112d6","patch":"@@ -480,6 +480,7 @@ under the License.\n \n     <adminUser>admin</adminUser>\n     <anonymousUser>anonymous</anonymousUser>\n+    <adminPassword>5baa61e4c9b93f3f0682250b6cf8331b7ee68fd8</adminPassword>\n     <!-- static keys, only used for build: generated overlays will override during archetype:generate -->\n     <anonymousKey>anonymousKey</anonymousKey>\n     <secretKey>1abcdefghilmnopqrstuvz2!</secretKey>"}]}