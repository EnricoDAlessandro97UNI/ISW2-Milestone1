{"sha":"97744afe7fe103101ceca95294af51ed48333be3","node_id":"MDY6Q29tbWl0NjM2ODc5MDYyOjk3NzQ0YWZlN2ZlMTAzMTAxY2VjYTk1Mjk0YWY1MWVkNDgzMzNiZTM=","commit":{"author":{"name":"skylark17","email":"matteo.alessandroni@tirasa.net","date":"2017-08-10T08:44:51Z"},"committer":{"name":"skylark17","email":"matteo.alessandroni@tirasa.net","date":"2017-08-10T08:45:39Z"},"message":"[SYNCOPE-1190] Toggle menu header is now updated when elements get updated","tree":{"sha":"9a776b0b8bcf4fe38680a001680fadda30d0b7b5","url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/git/trees/9a776b0b8bcf4fe38680a001680fadda30d0b7b5"},"url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/git/commits/97744afe7fe103101ceca95294af51ed48333be3","comment_count":0,"verification":{"verified":false,"reason":"unsigned","signature":null,"payload":null}},"url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/97744afe7fe103101ceca95294af51ed48333be3","html_url":"https://github.com/EnricoDAlessandro97UNI/syncope/commit/97744afe7fe103101ceca95294af51ed48333be3","comments_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/97744afe7fe103101ceca95294af51ed48333be3/comments","author":{"login":"mat-ale","id":25547301,"node_id":"MDQ6VXNlcjI1NTQ3MzAx","avatar_url":"https://avatars.githubusercontent.com/u/25547301?v=4","gravatar_id":"","url":"https://api.github.com/users/mat-ale","html_url":"https://github.com/mat-ale","followers_url":"https://api.github.com/users/mat-ale/followers","following_url":"https://api.github.com/users/mat-ale/following{/other_user}","gists_url":"https://api.github.com/users/mat-ale/gists{/gist_id}","starred_url":"https://api.github.com/users/mat-ale/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mat-ale/subscriptions","organizations_url":"https://api.github.com/users/mat-ale/orgs","repos_url":"https://api.github.com/users/mat-ale/repos","events_url":"https://api.github.com/users/mat-ale/events{/privacy}","received_events_url":"https://api.github.com/users/mat-ale/received_events","type":"User","site_admin":false},"committer":{"login":"mat-ale","id":25547301,"node_id":"MDQ6VXNlcjI1NTQ3MzAx","avatar_url":"https://avatars.githubusercontent.com/u/25547301?v=4","gravatar_id":"","url":"https://api.github.com/users/mat-ale","html_url":"https://github.com/mat-ale","followers_url":"https://api.github.com/users/mat-ale/followers","following_url":"https://api.github.com/users/mat-ale/following{/other_user}","gists_url":"https://api.github.com/users/mat-ale/gists{/gist_id}","starred_url":"https://api.github.com/users/mat-ale/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mat-ale/subscriptions","organizations_url":"https://api.github.com/users/mat-ale/orgs","repos_url":"https://api.github.com/users/mat-ale/repos","events_url":"https://api.github.com/users/mat-ale/events{/privacy}","received_events_url":"https://api.github.com/users/mat-ale/received_events","type":"User","site_admin":false},"parents":[{"sha":"48c2ab45678ba615d5b6eb7dccad8f73b0134a48","url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/48c2ab45678ba615d5b6eb7dccad8f73b0134a48","html_url":"https://github.com/EnricoDAlessandro97UNI/syncope/commit/48c2ab45678ba615d5b6eb7dccad8f73b0134a48"}],"stats":{"total":216,"additions":152,"deletions":64},"files":[{"sha":"5246509b2cf27ead81a967cd4a9871d1f68e8a73","filename":"client/console/src/main/java/org/apache/syncope/client/console/panels/AbstractLogsPanel.java","status":"modified","additions":1,"deletions":0,"changes":1,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/97744afe7fe103101ceca95294af51ed48333be3/client%2Fconsole%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fclient%2Fconsole%2Fpanels%2FAbstractLogsPanel.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/97744afe7fe103101ceca95294af51ed48333be3/client%2Fconsole%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fclient%2Fconsole%2Fpanels%2FAbstractLogsPanel.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/client%2Fconsole%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fclient%2Fconsole%2Fpanels%2FAbstractLogsPanel.java?ref=97744afe7fe103101ceca95294af51ed48333be3","patch":"@@ -74,6 +74,7 @@ protected Component getValueComponent(final String key, final LoggerTO loggerTO)\n \n                     loggerTOs.hideLabel();\n                     loggerTOs.setChoices(Arrays.asList(LoggerLevel.values()));\n+                    loggerTOs.setNullValid(false);\n                     loggerTOs.getField().add(new IndicatorAjaxFormComponentUpdatingBehavior(Constants.ON_CHANGE) {\n \n                         private static final long serialVersionUID = -1107858522700306810L;"},{"sha":"883325dc51947f53dffc32e4c08e22fffb9127a1","filename":"client/console/src/main/java/org/apache/syncope/client/console/panels/SecurityQuestionsModalPanel.java","status":"modified","additions":6,"deletions":0,"changes":6,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/97744afe7fe103101ceca95294af51ed48333be3/client%2Fconsole%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fclient%2Fconsole%2Fpanels%2FSecurityQuestionsModalPanel.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/97744afe7fe103101ceca95294af51ed48333be3/client%2Fconsole%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fclient%2Fconsole%2Fpanels%2FSecurityQuestionsModalPanel.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/client%2Fconsole%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fclient%2Fconsole%2Fpanels%2FSecurityQuestionsModalPanel.java?ref=97744afe7fe103101ceca95294af51ed48333be3","patch":"@@ -27,6 +27,7 @@\n import org.apache.syncope.common.lib.to.SecurityQuestionTO;\n import org.apache.wicket.PageReference;\n import org.apache.wicket.ajax.AjaxRequestTarget;\n+import org.apache.wicket.event.Broadcast;\n import org.apache.wicket.markup.html.form.Form;\n \n public class SecurityQuestionsModalPanel extends AbstractModalPanel<SecurityQuestionTO> {\n@@ -62,6 +63,11 @@ public void onSubmit(final AjaxRequestTarget target, final Form<?> form) {\n             }\n \n             SyncopeConsoleSession.get().info(getString(Constants.OPERATION_SUCCEEDED));\n+\n+            // [SYNCOPE-1190] - refresh toggle panel after update\n+            send(pageRef.getPage(), Broadcast.BREADTH,\n+                    new TogglePanel.ActionLinkToggleUpdateEventPayload<>(target, securityQuestionTO));\n+\n             modal.close(target);\n         } catch (Exception e) {\n             LOG.error(\"While creating or updating {}\", securityQuestionTO, e);"},{"sha":"ba9f9b1b648f293907a1e4e44ddc4dc89ba525c7","filename":"client/console/src/main/java/org/apache/syncope/client/console/panels/TogglePanel.java","status":"modified","additions":105,"deletions":0,"changes":105,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/97744afe7fe103101ceca95294af51ed48333be3/client%2Fconsole%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fclient%2Fconsole%2Fpanels%2FTogglePanel.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/97744afe7fe103101ceca95294af51ed48333be3/client%2Fconsole%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fclient%2Fconsole%2Fpanels%2FTogglePanel.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/client%2Fconsole%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fclient%2Fconsole%2Fpanels%2FTogglePanel.java?ref=97744afe7fe103101ceca95294af51ed48333be3","patch":"@@ -21,14 +21,37 @@\n import java.io.Serializable;\n import org.apache.commons.lang3.StringUtils;\n import org.apache.syncope.client.console.commons.Constants;\n+import org.apache.syncope.client.console.commons.status.StatusBean;\n+import org.apache.syncope.client.console.policies.PolicyRuleDirectoryPanel;\n+import org.apache.syncope.client.console.reports.ReportletDirectoryPanel;\n import org.apache.syncope.client.console.wizards.WizardMgtPanel;\n+import org.apache.syncope.client.console.wizards.any.AnyWrapper;\n+import org.apache.syncope.client.console.wizards.any.GroupWrapper;\n+import org.apache.syncope.client.console.wizards.any.UserWrapper;\n+import org.apache.syncope.common.lib.policy.AbstractPolicyTO;\n+import org.apache.syncope.common.lib.to.AccessTokenTO;\n+import org.apache.syncope.common.lib.to.AnyObjectTO;\n+import org.apache.syncope.common.lib.to.AnyTO;\n+import org.apache.syncope.common.lib.to.AttrTO;\n+import org.apache.syncope.common.lib.to.ConnInstanceTO;\n+import org.apache.syncope.common.lib.to.EntityTO;\n+import org.apache.syncope.common.lib.to.ExecTO;\n+import org.apache.syncope.common.lib.to.GroupTO;\n+import org.apache.syncope.common.lib.to.JobTO;\n+import org.apache.syncope.common.lib.to.ReportTO;\n+import org.apache.syncope.common.lib.to.SchedTaskTO;\n+import org.apache.syncope.common.lib.to.SecurityQuestionTO;\n+import org.apache.syncope.common.lib.to.UserTO;\n+import org.apache.syncope.common.lib.to.WorkflowDefinitionTO;\n+import org.apache.syncope.common.lib.to.WorkflowFormTO;\n import org.apache.wicket.Component;\n import org.apache.wicket.PageReference;\n import org.apache.wicket.ajax.AjaxEventBehavior;\n import org.apache.wicket.ajax.AjaxRequestTarget;\n import org.apache.wicket.ajax.markup.html.AjaxLink;\n import org.apache.wicket.markup.html.WebMarkupContainer;\n import org.apache.wicket.markup.html.basic.Label;\n+import org.apache.wicket.model.ResourceModel;\n import org.slf4j.Logger;\n import org.slf4j.LoggerFactory;\n \n@@ -152,4 +175,86 @@ public void toggle(final AjaxRequestTarget target, final boolean toggle) {\n             status = Status.INACTIVE;\n         }\n     }\n+\n+    protected String getHeader(final T modelObject) {\n+        final String headerValue;\n+        if (modelObject == null) {\n+            headerValue = new ResourceModel(\"actions\", StringUtils.EMPTY).getObject();\n+        } else if (modelObject instanceof UserTO) {\n+            headerValue = ((UserTO) modelObject).getUsername();\n+        } else if (modelObject instanceof GroupTO) {\n+            headerValue = ((GroupTO) modelObject).getName();\n+        } else if (modelObject instanceof UserWrapper) {\n+            headerValue = UserWrapper.class.cast(modelObject).getInnerObject().getUsername();\n+        } else if (modelObject instanceof GroupWrapper) {\n+            headerValue = GroupWrapper.class.cast(modelObject).getInnerObject().getName();\n+        } else if (modelObject instanceof AnyWrapper) {\n+            AnyTO anyWrapper = AnyWrapper.class.cast(modelObject).getInnerObject();\n+            if (anyWrapper instanceof AnyObjectTO) {\n+                headerValue = ((AnyObjectTO) anyWrapper).getName();\n+            } else {\n+                headerValue = new ResourceModel(\"actions\", StringUtils.EMPTY).getObject();\n+            }\n+        } else if (modelObject instanceof ConnInstanceTO) {\n+            headerValue = ConnInstanceTO.class.cast(modelObject).getDisplayName();\n+        } else if (modelObject instanceof ReportTO) {\n+            headerValue = ((ReportTO) modelObject).getName();\n+        } else if (modelObject instanceof AnyObjectTO) {\n+            headerValue = ((AnyObjectTO) modelObject).getName();\n+        } else if (modelObject instanceof AttrTO) {\n+            headerValue = ((AttrTO) modelObject).getSchema();\n+        } else if (modelObject instanceof AbstractPolicyTO) {\n+            headerValue = ((AbstractPolicyTO) modelObject).getDescription();\n+        } else if (modelObject instanceof SecurityQuestionTO) {\n+            headerValue = ((SecurityQuestionTO) modelObject).getContent();\n+        } else if (modelObject instanceof AccessTokenTO) {\n+            headerValue = ((AccessTokenTO) modelObject).getOwner();\n+        } else if (modelObject instanceof ExecTO) {\n+            headerValue = ((ExecTO) modelObject).getKey();\n+        } else if (modelObject instanceof WorkflowDefinitionTO) {\n+            headerValue = ((WorkflowDefinitionTO) modelObject).getName();\n+        } else if (modelObject instanceof SchedTaskTO) {\n+            headerValue = ((SchedTaskTO) modelObject).getName();\n+        } else if (modelObject instanceof WorkflowFormTO) {\n+            headerValue = ((WorkflowFormTO) modelObject).getKey();\n+        } else if (modelObject instanceof EntityTO) {\n+            headerValue = ((EntityTO) modelObject).getKey();\n+        } else if (modelObject instanceof StatusBean) {\n+            headerValue = ((StatusBean) modelObject).getResource();\n+        } else if (modelObject instanceof PolicyRuleDirectoryPanel.PolicyRuleWrapper) {\n+            headerValue = ((PolicyRuleDirectoryPanel.PolicyRuleWrapper) modelObject).getName();\n+        } else if (modelObject instanceof PolicyRuleDirectoryPanel.PolicyRuleWrapper) {\n+            headerValue = ((PolicyRuleDirectoryPanel.PolicyRuleWrapper) modelObject).getName();\n+        } else if (modelObject instanceof ReportletDirectoryPanel.ReportletWrapper) {\n+            headerValue = ((ReportletDirectoryPanel.ReportletWrapper) modelObject).getName();\n+        } else if (modelObject instanceof JobTO) {\n+            headerValue = ((JobTO) modelObject).getRefKey() == null\n+                    ? ((JobTO) modelObject).getRefDesc() : ((JobTO) modelObject).getRefKey();\n+        } else {\n+            headerValue = new ResourceModel(\"actions\", StringUtils.EMPTY).getObject();\n+        }\n+\n+        return headerValue;\n+    }\n+\n+    public static class ActionLinkToggleUpdateEventPayload<T> {\n+\n+        private final AjaxRequestTarget target;\n+\n+        private final T modelObj;\n+\n+        public ActionLinkToggleUpdateEventPayload(final AjaxRequestTarget target, final T modelObj) {\n+            this.target = target;\n+            this.modelObj = modelObj;\n+        }\n+\n+        public AjaxRequestTarget getTarget() {\n+            return target;\n+        }\n+\n+        public T getModelObj() {\n+            return modelObj;\n+        }\n+\n+    }\n }"},{"sha":"608dcca310e4104a4994282def62b001fb3cf3ab","filename":"client/console/src/main/java/org/apache/syncope/client/console/policies/PolicyModalPanelBuilder.java","status":"modified","additions":7,"deletions":0,"changes":7,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/97744afe7fe103101ceca95294af51ed48333be3/client%2Fconsole%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fclient%2Fconsole%2Fpolicies%2FPolicyModalPanelBuilder.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/97744afe7fe103101ceca95294af51ed48333be3/client%2Fconsole%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fclient%2Fconsole%2Fpolicies%2FPolicyModalPanelBuilder.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/client%2Fconsole%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fclient%2Fconsole%2Fpolicies%2FPolicyModalPanelBuilder.java?ref=97744afe7fe103101ceca95294af51ed48333be3","patch":"@@ -27,6 +27,7 @@\n import org.apache.syncope.client.console.commons.Constants;\n import org.apache.syncope.client.console.pages.BasePage;\n import org.apache.syncope.client.console.panels.AbstractModalPanel;\n+import org.apache.syncope.client.console.panels.TogglePanel;\n import org.apache.syncope.client.console.panels.WizardModalPanel;\n import org.apache.syncope.client.console.rest.PolicyRestClient;\n import org.apache.syncope.client.console.rest.ResourceRestClient;\n@@ -45,6 +46,7 @@\n import org.apache.wicket.Component;\n import org.apache.wicket.PageReference;\n import org.apache.wicket.ajax.AjaxRequestTarget;\n+import org.apache.wicket.event.Broadcast;\n import org.apache.wicket.markup.html.form.Form;\n import org.apache.wicket.markup.html.list.ListItem;\n import org.apache.wicket.markup.html.list.ListView;\n@@ -161,6 +163,11 @@ public void onSubmit(final AjaxRequestTarget target, final Form<?> form) {\n                     restClient.updatePolicy(policyTO);\n                 }\n                 SyncopeConsoleSession.get().info(getString(Constants.OPERATION_SUCCEEDED));\n+\n+                // [SYNCOPE-1190] - refresh toggle panel after update\n+                send(pageRef.getPage(), Broadcast.BREADTH,\n+                        new TogglePanel.ActionLinkToggleUpdateEventPayload<>(target, policyTO));\n+\n                 Profile.this.modal.close(target);\n             } catch (Exception e) {\n                 LOG.error(\"While creating/updating policy\", e);"},{"sha":"99a80ba1f19c9eb4540623f21ee8a5b2122685ab","filename":"client/console/src/main/java/org/apache/syncope/client/console/topology/Topology.java","status":"modified","additions":1,"deletions":1,"changes":2,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/97744afe7fe103101ceca95294af51ed48333be3/client%2Fconsole%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fclient%2Fconsole%2Ftopology%2FTopology.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/97744afe7fe103101ceca95294af51ed48333be3/client%2Fconsole%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fclient%2Fconsole%2Ftopology%2FTopology.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/client%2Fconsole%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fclient%2Fconsole%2Ftopology%2FTopology.java?ref=97744afe7fe103101ceca95294af51ed48333be3","patch":"@@ -165,7 +165,7 @@ public void onClose(final AjaxRequestTarget target) {\n \n         body.add(new TopologyWebSocketBehavior());\n \n-        togglePanel = new TopologyTogglePanel(\"toggle\", getPageReference());\n+        togglePanel = new TopologyTogglePanel<>(\"toggle\", getPageReference());\n         body.add(togglePanel);\n \n         // -----------------------------------------"},{"sha":"57afa04612650df58052e7748d3e4d894d7a96c8","filename":"client/console/src/main/java/org/apache/syncope/client/console/topology/TopologyTogglePanel.java","status":"modified","additions":17,"deletions":1,"changes":18,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/97744afe7fe103101ceca95294af51ed48333be3/client%2Fconsole%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fclient%2Fconsole%2Ftopology%2FTopologyTogglePanel.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/97744afe7fe103101ceca95294af51ed48333be3/client%2Fconsole%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fclient%2Fconsole%2Ftopology%2FTopologyTogglePanel.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/client%2Fconsole%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fclient%2Fconsole%2Ftopology%2FTopologyTogglePanel.java?ref=97744afe7fe103101ceca95294af51ed48333be3","patch":"@@ -53,6 +53,7 @@\n import org.apache.wicket.ajax.markup.html.AjaxLink;\n import org.apache.wicket.authroles.authorization.strategies.role.metadata.MetaDataRoleAuthorizationStrategy;\n import org.apache.wicket.event.Broadcast;\n+import org.apache.wicket.event.IEvent;\n import org.apache.wicket.extensions.ajax.markup.html.IndicatingAjaxLink;\n import org.apache.wicket.extensions.ajax.markup.html.modal.ModalWindow;\n import org.apache.wicket.markup.html.WebMarkupContainer;\n@@ -63,7 +64,7 @@\n import org.apache.wicket.model.ResourceModel;\n import org.apache.wicket.model.StringResourceModel;\n \n-public class TopologyTogglePanel extends TogglePanel<Serializable> {\n+public class TopologyTogglePanel<T extends Serializable> extends TogglePanel<Serializable> {\n \n     private static final long serialVersionUID = -2025535531121434056L;\n \n@@ -648,4 +649,19 @@ public String getKey() {\n         }\n \n     }\n+\n+    @Override\n+    @SuppressWarnings(\"unchecked\")\n+    public void onEvent(final IEvent<?> event) {\n+        if (event.getPayload() instanceof ActionLinkToggleUpdateEventPayload) {\n+            String header = getHeader((T) ActionLinkToggleUpdateEventPayload.class.cast(event.\n+                    getPayload()).getModelObj());\n+            if (StringUtils.isNotBlank(header)) {\n+                setHeader(ActionLinkToggleUpdateEventPayload.class.cast(event.getPayload()).\n+                        getTarget(), StringUtils.abbreviate(header, 25));\n+            }\n+        }\n+\n+        super.onEvent(event);\n+    }\n }"},{"sha":"16b79f5b3b6f0e299d1d356a35acc9e5f1bc4b84","filename":"client/console/src/main/java/org/apache/syncope/client/console/wicket/markup/html/form/ActionLinksTogglePanel.java","status":"modified","additions":10,"deletions":62,"changes":72,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/97744afe7fe103101ceca95294af51ed48333be3/client%2Fconsole%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fclient%2Fconsole%2Fwicket%2Fmarkup%2Fhtml%2Fform%2FActionLinksTogglePanel.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/97744afe7fe103101ceca95294af51ed48333be3/client%2Fconsole%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fclient%2Fconsole%2Fwicket%2Fmarkup%2Fhtml%2Fform%2FActionLinksTogglePanel.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/client%2Fconsole%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fclient%2Fconsole%2Fwicket%2Fmarkup%2Fhtml%2Fform%2FActionLinksTogglePanel.java?ref=97744afe7fe103101ceca95294af51ed48333be3","patch":"@@ -22,31 +22,13 @@\n import java.io.Serializable;\n import java.util.UUID;\n import org.apache.commons.lang3.StringUtils;\n-import org.apache.syncope.client.console.commons.status.StatusBean;\n import org.apache.syncope.client.console.panels.TogglePanel;\n-import org.apache.syncope.client.console.policies.PolicyRuleDirectoryPanel.PolicyRuleWrapper;\n-import org.apache.syncope.client.console.reports.ReportletDirectoryPanel.ReportletWrapper;\n-import org.apache.syncope.common.lib.to.AnyObjectTO;\n-import org.apache.syncope.common.lib.to.EntityTO;\n-import org.apache.syncope.common.lib.to.GroupTO;\n-import org.apache.syncope.common.lib.to.ReportTO;\n-import org.apache.syncope.common.lib.to.UserTO;\n-import org.apache.syncope.common.lib.to.AttrTO;\n-import org.apache.syncope.common.lib.to.SecurityQuestionTO;\n-import org.apache.syncope.common.lib.policy.AbstractPolicyTO;\n-import org.apache.syncope.common.lib.to.AccessTokenTO;\n-import org.apache.syncope.common.lib.to.ExecTO;\n-import org.apache.syncope.common.lib.to.JobTO;\n-import org.apache.syncope.common.lib.to.SchedTaskTO;\n-import org.apache.syncope.common.lib.to.WorkflowDefinitionTO;\n-import org.apache.syncope.common.lib.to.WorkflowFormTO;\n import org.apache.wicket.PageReference;\n import org.apache.wicket.ajax.AjaxRequestTarget;\n import org.apache.wicket.event.IEvent;\n import org.apache.wicket.extensions.ajax.markup.html.modal.ModalWindow;\n import org.apache.wicket.markup.html.WebMarkupContainer;\n import org.apache.wicket.markup.html.panel.Fragment;\n-import org.apache.wicket.model.ResourceModel;\n \n public class ActionLinksTogglePanel<T extends Serializable> extends TogglePanel<Serializable> {\n \n@@ -69,50 +51,8 @@ public ActionLinksTogglePanel(final String id, final PageReference pageRef) {\n \n     public void toggleWithContent(\n             final AjaxRequestTarget target, final ActionsPanel<T> actionsPanel, final T modelObject) {\n-        final String header;\n-        if (modelObject == null) {\n-            header = new ResourceModel(\"actions\", StringUtils.EMPTY).getObject();\n-        } else if (modelObject instanceof UserTO) {\n-            header = ((UserTO) modelObject).getUsername();\n-        } else if (modelObject instanceof GroupTO) {\n-            header = ((GroupTO) modelObject).getName();\n-        } else if (modelObject instanceof ReportTO) {\n-            header = ((ReportTO) modelObject).getName();\n-        } else if (modelObject instanceof AnyObjectTO) {\n-            header = ((AnyObjectTO) modelObject).getName();\n-        } else if (modelObject instanceof AttrTO) {\n-            header = ((AttrTO) modelObject).getSchema();\n-        } else if (modelObject instanceof AbstractPolicyTO) {\n-            header = ((AbstractPolicyTO) modelObject).getDescription();\n-        } else if (modelObject instanceof SecurityQuestionTO) {\n-            header = ((SecurityQuestionTO) modelObject).getContent();\n-        } else if (modelObject instanceof AccessTokenTO) {\n-            header = ((AccessTokenTO) modelObject).getOwner();\n-        } else if (modelObject instanceof ExecTO) {\n-            header = ((ExecTO) modelObject).getKey();\n-        } else if (modelObject instanceof WorkflowDefinitionTO) {\n-            header = ((WorkflowDefinitionTO) modelObject).getName();\n-        } else if (modelObject instanceof SchedTaskTO) {\n-            header = ((SchedTaskTO) modelObject).getName();\n-        } else if (modelObject instanceof WorkflowFormTO) {\n-            header = ((WorkflowFormTO) modelObject).getKey();\n-        } else if (modelObject instanceof EntityTO) {\n-            header = ((EntityTO) modelObject).getKey();\n-        } else if (modelObject instanceof StatusBean) {\n-            header = ((StatusBean) modelObject).getResource();\n-        } else if (modelObject instanceof PolicyRuleWrapper) {\n-            header = ((PolicyRuleWrapper) modelObject).getName();\n-        } else if (modelObject instanceof PolicyRuleWrapper) {\n-            header = ((PolicyRuleWrapper) modelObject).getName();\n-        } else if (modelObject instanceof ReportletWrapper) {\n-            header = ((ReportletWrapper) modelObject).getName();\n-        } else if (modelObject instanceof JobTO) {\n-            header = ((JobTO) modelObject).getRefKey() == null\n-                    ? ((JobTO) modelObject).getRefDesc() : ((JobTO) modelObject).getRefKey();\n-        } else {\n-            header = new ResourceModel(\"actions\", StringUtils.EMPTY).getObject();\n-        }\n-        setHeader(target, StringUtils.abbreviate(header, 25));\n+\n+        setHeader(target, StringUtils.abbreviate(getHeader(modelObject), 25));\n \n         modal.setWindowClosedCallback(new ModalWindow.WindowClosedCallback() {\n \n@@ -139,9 +79,17 @@ private Fragment getEmptyFragment() {\n     }\n \n     @Override\n+    @SuppressWarnings(\"unchecked\")\n     public void onEvent(final IEvent<?> event) {\n         if (event.getPayload() instanceof ActionLinkToggleCloseEventPayload) {\n             close(ActionLinkToggleCloseEventPayload.class.cast(event.getPayload()).getTarget());\n+        } else if (event.getPayload() instanceof ActionLinkToggleUpdateEventPayload) {\n+            String header = getHeader((T) ActionLinkToggleUpdateEventPayload.class.cast(event.\n+                    getPayload()).getModelObj());\n+            if (StringUtils.isNotBlank(header)) {\n+                setHeader(ActionLinkToggleUpdateEventPayload.class.cast(event.getPayload()).getTarget(),\n+                        StringUtils.abbreviate(header, 25));\n+            }\n         }\n     }\n "},{"sha":"f0896f1950bdac9f7b256ffc855d39ae60ce261a","filename":"client/console/src/main/java/org/apache/syncope/client/console/wizards/AjaxWizardBuilder.java","status":"modified","additions":5,"deletions":0,"changes":5,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/97744afe7fe103101ceca95294af51ed48333be3/client%2Fconsole%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fclient%2Fconsole%2Fwizards%2FAjaxWizardBuilder.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/97744afe7fe103101ceca95294af51ed48333be3/client%2Fconsole%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fclient%2Fconsole%2Fwizards%2FAjaxWizardBuilder.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/client%2Fconsole%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fclient%2Fconsole%2Fwizards%2FAjaxWizardBuilder.java?ref=97744afe7fe103101ceca95294af51ed48333be3","patch":"@@ -22,6 +22,7 @@\n import java.util.ArrayList;\n import java.util.Arrays;\n import java.util.List;\n+import org.apache.syncope.client.console.panels.TogglePanel;\n import org.apache.wicket.Component;\n import org.apache.wicket.PageReference;\n import org.apache.wicket.ajax.AjaxRequestTarget;\n@@ -120,6 +121,10 @@ protected Serializable onApplyInternal(final AjaxRequestTarget target) {\n                     send(pageRef.getPage(), Broadcast.BUBBLE, payload);\n                 }\n \n+                // [SYNCOPE-1190] - refresh toggle panel after update\n+                send(pageRef.getPage(), Broadcast.BREADTH,\n+                        new TogglePanel.ActionLinkToggleUpdateEventPayload<>(target, modelObject));\n+\n                 return res;\n             }\n         }.setEventSink(eventSink).addOuterObject(outerObjects);"}]}