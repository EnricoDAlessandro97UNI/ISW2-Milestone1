{"sha":"790704c08790f8a2536af84ed46290f1596851f0","node_id":"MDY6Q29tbWl0NjM2ODc5MDYyOjc5MDcwNGMwODc5MGY4YTI1MzZhZjg0ZWQ0NjI5MGYxNTk2ODUxZjA=","commit":{"author":{"name":"giacomolm","email":"giacomolm@hotmail.it","date":"2015-05-28T15:27:12Z"},"committer":{"name":"giacomolm","email":"giacomolm@hotmail.it","date":"2015-05-29T08:30:57Z"},"message":"[SYNCOPE-660] Added console utilities for runtime task management","tree":{"sha":"acf833101cdc3851f21b67bebeaf94b2265af76b","url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/git/trees/acf833101cdc3851f21b67bebeaf94b2265af76b"},"url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/git/commits/790704c08790f8a2536af84ed46290f1596851f0","comment_count":0,"verification":{"verified":false,"reason":"unsigned","signature":null,"payload":null}},"url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/790704c08790f8a2536af84ed46290f1596851f0","html_url":"https://github.com/EnricoDAlessandro97UNI/syncope/commit/790704c08790f8a2536af84ed46290f1596851f0","comments_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/790704c08790f8a2536af84ed46290f1596851f0/comments","author":{"login":"giacomolm","id":4027829,"node_id":"MDQ6VXNlcjQwMjc4Mjk=","avatar_url":"https://avatars.githubusercontent.com/u/4027829?v=4","gravatar_id":"","url":"https://api.github.com/users/giacomolm","html_url":"https://github.com/giacomolm","followers_url":"https://api.github.com/users/giacomolm/followers","following_url":"https://api.github.com/users/giacomolm/following{/other_user}","gists_url":"https://api.github.com/users/giacomolm/gists{/gist_id}","starred_url":"https://api.github.com/users/giacomolm/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/giacomolm/subscriptions","organizations_url":"https://api.github.com/users/giacomolm/orgs","repos_url":"https://api.github.com/users/giacomolm/repos","events_url":"https://api.github.com/users/giacomolm/events{/privacy}","received_events_url":"https://api.github.com/users/giacomolm/received_events","type":"User","site_admin":false},"committer":{"login":"giacomolm","id":4027829,"node_id":"MDQ6VXNlcjQwMjc4Mjk=","avatar_url":"https://avatars.githubusercontent.com/u/4027829?v=4","gravatar_id":"","url":"https://api.github.com/users/giacomolm","html_url":"https://github.com/giacomolm","followers_url":"https://api.github.com/users/giacomolm/followers","following_url":"https://api.github.com/users/giacomolm/following{/other_user}","gists_url":"https://api.github.com/users/giacomolm/gists{/gist_id}","starred_url":"https://api.github.com/users/giacomolm/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/giacomolm/subscriptions","organizations_url":"https://api.github.com/users/giacomolm/orgs","repos_url":"https://api.github.com/users/giacomolm/repos","events_url":"https://api.github.com/users/giacomolm/events{/privacy}","received_events_url":"https://api.github.com/users/giacomolm/received_events","type":"User","site_admin":false},"parents":[{"sha":"f672ce4925667fd80582878bdd55b9b0d644af0d","url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/f672ce4925667fd80582878bdd55b9b0d644af0d","html_url":"https://github.com/EnricoDAlessandro97UNI/syncope/commit/f672ce4925667fd80582878bdd55b9b0d644af0d"}],"stats":{"total":410,"additions":404,"deletions":6},"files":[{"sha":"88fdf1cc352c5e37d6d14b878b56ed2e782023b5","filename":"console/src/main/java/org/apache/syncope/console/pages/Reports.java","status":"modified","additions":11,"deletions":0,"changes":11,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/790704c08790f8a2536af84ed46290f1596851f0/console%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fconsole%2Fpages%2FReports.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/790704c08790f8a2536af84ed46290f1596851f0/console%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fconsole%2Fpages%2FReports.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/console%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fconsole%2Fpages%2FReports.java?ref=790704c08790f8a2536af84ed46290f1596851f0","patch":"@@ -38,6 +38,7 @@\n import org.apache.syncope.console.wicket.ajax.markup.html.ClearIndicatingAjaxLink;\n import org.apache.syncope.console.wicket.extensions.markup.html.repeater.data.table.ActionColumn;\n import org.apache.syncope.console.wicket.extensions.markup.html.repeater.data.table.DatePropertyColumn;\n+import org.apache.syncope.console.wicket.extensions.markup.html.repeater.data.table.JobColumn;\n import org.apache.syncope.console.wicket.markup.html.form.ActionLink;\n import org.apache.syncope.console.wicket.markup.html.form.ActionLinksPanel;\n import org.apache.wicket.Component;\n@@ -61,6 +62,7 @@\n import org.apache.wicket.model.Model;\n import org.apache.wicket.model.PropertyModel;\n import org.apache.wicket.model.ResourceModel;\n+import org.apache.wicket.model.StringResourceModel;\n import org.apache.wicket.model.util.ListModel;\n import org.apache.wicket.request.mapper.parameter.PageParameters;\n import org.apache.wicket.spring.injection.annot.SpringBean;\n@@ -123,6 +125,8 @@ private void setupReport() {\n         columns.add(new DatePropertyColumn<ReportTO>(new ResourceModel(\"endDate\"), \"endDate\", \"endDate\"));\n         columns.add(new PropertyColumn<ReportTO, String>(\n                 new ResourceModel(\"latestExecStatus\"), \"latestExecStatus\", \"latestExecStatus\"));\n+        columns.add(new JobColumn<ReportTO, String>(new StringResourceModel(\"\", this, null, \"\"), \"runtime\",\n+                getPageReference(), reportRestClient));\n         columns.add(new ActionColumn<ReportTO, String>(new ResourceModel(\"actions\", \"\")) {\n \n             private static final long serialVersionUID = 2054811145491901166L;\n@@ -411,4 +415,11 @@ public ReportTO getObject() {\n             };\n         }\n     }\n+    /**\n+     * IndicatorMarkupId behaviour is embedded in Reports.html\n+     */\n+    @Override\n+    public String getAjaxIndicatorMarkupId() {\n+        return \"\";\n+    }\n }"},{"sha":"11819c681d613b4d833491ab0fd2a233bec71f12","filename":"console/src/main/java/org/apache/syncope/console/pages/Tasks.java","status":"modified","additions":12,"deletions":3,"changes":15,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/790704c08790f8a2536af84ed46290f1596851f0/console%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fconsole%2Fpages%2FTasks.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/790704c08790f8a2536af84ed46290f1596851f0/console%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fconsole%2Fpages%2FTasks.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/console%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fconsole%2Fpages%2FTasks.java?ref=790704c08790f8a2536af84ed46290f1596851f0","patch":"@@ -152,10 +152,10 @@ public TasksProvider(\n         @Override\n         public Iterator<T> iterator(final long first, final long count) {\n             final List<T> tasks = new ArrayList<T>();\n-            \n+\n             final int page = ((int) first / paginatorRows);\n-            \n-            for (T task : restClient.list(reference, (page < 0 ? 0 : page)  + 1, paginatorRows, getSort())) {\n+\n+            for (T task : restClient.list(reference, (page < 0 ? 0 : page) + 1, paginatorRows, getSort())) {\n                 if (task instanceof SchedTaskTO && ((SchedTaskTO) task).getLastExec() == null\n                         && task.getExecutions() != null && !task.getExecutions().isEmpty()) {\n \n@@ -227,4 +227,13 @@ public static AjaxDataTablePanel<AbstractTaskTO, String> updateTaskTable(\n \n         return table;\n     }\n+\n+    /**\n+     * IndicatorMarkupId behaviour is embedded in Tasks.html\n+     */\n+    @Override\n+    public String getAjaxIndicatorMarkupId() {\n+        return \"\";\n+    }\n+\n }"},{"sha":"9c7b4589a5fd33260832c356b32c7f57470b1308","filename":"console/src/main/java/org/apache/syncope/console/pages/panels/NotificationTasks.java","status":"modified","additions":4,"deletions":0,"changes":4,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/790704c08790f8a2536af84ed46290f1596851f0/console%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fconsole%2Fpages%2Fpanels%2FNotificationTasks.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/790704c08790f8a2536af84ed46290f1596851f0/console%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fconsole%2Fpages%2Fpanels%2FNotificationTasks.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/console%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fconsole%2Fpages%2Fpanels%2FNotificationTasks.java?ref=790704c08790f8a2536af84ed46290f1596851f0","patch":"@@ -28,6 +28,7 @@\n import org.apache.syncope.console.pages.Tasks;\n import org.apache.syncope.console.pages.Tasks.TasksProvider;\n import org.apache.syncope.console.wicket.extensions.markup.html.repeater.data.table.ActionColumn;\n+import org.apache.syncope.console.wicket.extensions.markup.html.repeater.data.table.JobColumn;\n import org.apache.syncope.console.wicket.markup.html.form.ActionLink;\n import org.apache.syncope.console.wicket.markup.html.form.ActionLinksPanel;\n import org.apache.wicket.Component;\n@@ -152,6 +153,9 @@ private List<IColumn<AbstractTaskTO, String>> getColumns() {\n         columns.add(new PropertyColumn<AbstractTaskTO, String>(\n                 new StringResourceModel(\"latestExecStatus\", this, null), \"latestExecStatus\", \"latestExecStatus\"));\n \n+        columns.add(new JobColumn<AbstractTaskTO, String>(new StringResourceModel(\"\", this, null, \"\"), \"runtime\",\n+                pageRef, restClient)); \n+\n         columns.add(new ActionColumn<AbstractTaskTO, String>(new StringResourceModel(\"actions\", this, null, \"\")) {\n \n             private static final long serialVersionUID = 2054811145491901166L;"},{"sha":"3bc525c62461df635ce858bcc3ec184886437f4a","filename":"console/src/main/java/org/apache/syncope/console/pages/panels/RuntimePanel.java","status":"added","additions":105,"deletions":0,"changes":105,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/790704c08790f8a2536af84ed46290f1596851f0/console%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fconsole%2Fpages%2Fpanels%2FRuntimePanel.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/790704c08790f8a2536af84ed46290f1596851f0/console%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fconsole%2Fpages%2Fpanels%2FRuntimePanel.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/console%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fconsole%2Fpages%2Fpanels%2FRuntimePanel.java?ref=790704c08790f8a2536af84ed46290f1596851f0","patch":"@@ -0,0 +1,105 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *   http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+package org.apache.syncope.console.pages.panels;\n+\n+import org.apache.syncope.console.rest.JobRestClient;\n+import org.apache.syncope.console.wicket.ajax.markup.html.ClearIndicatingAjaxLink;\n+import org.apache.wicket.PageReference;\n+import org.apache.wicket.ajax.AbstractAjaxTimerBehavior;\n+import org.apache.wicket.ajax.AjaxRequestTarget;\n+import org.apache.wicket.markup.html.panel.Fragment;\n+import org.apache.wicket.model.IModel;\n+import org.apache.wicket.markup.html.panel.Panel;\n+\n+public class RuntimePanel extends Panel {\n+\n+    private static final long serialVersionUID = -9002724127542172464L;\n+\n+    private boolean latestStatus;\n+\n+    private Fragment fragmentStop, fragmentSpinner;\n+\n+    public AbstractAjaxTimerBehavior timer;\n+\n+    private final PageReference pageRef;\n+\n+    private final long jobId;\n+\n+    private final JobRestClient jobRestClient;\n+\n+    public RuntimePanel(final String componentId, final IModel<?> model, final PageReference pageRef, final long jobId,\n+            final JobRestClient jobRestClient) {\n+        super(componentId, model);\n+        this.pageRef = pageRef;\n+        this.jobId = jobId;\n+        this.jobRestClient = jobRestClient;\n+        latestStatus = false;\n+        this.refresh();\n+\n+    }\n+\n+    public final void refresh() {\n+        boolean currentStatus = jobRestClient.isJobRunning(jobId);\n+        if (currentStatus && !latestStatus) {\n+            setRunning();\n+        } else if (!currentStatus) {\n+            setNotRunning();\n+        }\n+        latestStatus = currentStatus;\n+    }\n+\n+    public void setRunning() {\n+        fragmentStop = new Fragment(\"panelStop\", \"fragmentStop\", this);\n+        fragmentStop.addOrReplace(new ClearIndicatingAjaxLink<Void>(\"stopLink\", pageRef) {\n+\n+            private static final long serialVersionUID = -7978723352517770644L;\n+\n+            @Override\n+            protected void onClickInternal(final AjaxRequestTarget target) {\n+                jobRestClient.stopJob(jobId);\n+                this.setEnabled(false);\n+                target.add(this);\n+            }\n+\n+            @Override\n+            public String getAjaxIndicatorMarkupId() {\n+                return \"\";\n+            }\n+        });\n+        addOrReplace(fragmentStop);\n+        fragmentSpinner = new Fragment(\"panelSpinner\", \"fragmentSpinner\", this);\n+        addOrReplace(fragmentSpinner);\n+    }\n+\n+    public void setNotRunning() {\n+        fragmentStop = new Fragment(\"panelStop\", \"emptyFragment\", this);\n+        addOrReplace(fragmentStop);\n+        fragmentSpinner = new Fragment(\"panelSpinner\", \"emptyFragment\", this);\n+        addOrReplace(fragmentSpinner);\n+    }\n+\n+    public void setTimer(AbstractAjaxTimerBehavior timer) {\n+        if (this.timer != null) {\n+            remove(this.timer);\n+        }\n+        this.timer = timer;\n+        this.add(this.timer);\n+    }\n+\n+}"},{"sha":"78591a82befd5701b06beb3e07ed139535be2da1","filename":"console/src/main/java/org/apache/syncope/console/pages/panels/SchedTasks.java","status":"modified","additions":6,"deletions":0,"changes":6,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/790704c08790f8a2536af84ed46290f1596851f0/console%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fconsole%2Fpages%2Fpanels%2FSchedTasks.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/790704c08790f8a2536af84ed46290f1596851f0/console%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fconsole%2Fpages%2Fpanels%2FSchedTasks.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/console%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fconsole%2Fpages%2Fpanels%2FSchedTasks.java?ref=790704c08790f8a2536af84ed46290f1596851f0","patch":"@@ -18,6 +18,8 @@\n  */\n package org.apache.syncope.console.pages.panels;\n \n+import static org.apache.syncope.console.pages.panels.AbstractTasks.TASKS;\n+\n import java.util.ArrayList;\n import java.util.List;\n import org.apache.syncope.common.to.SchedTaskTO;\n@@ -30,6 +32,7 @@\n import org.apache.syncope.console.wicket.ajax.markup.html.ClearIndicatingAjaxLink;\n import org.apache.syncope.console.wicket.extensions.markup.html.repeater.data.table.ActionColumn;\n import org.apache.syncope.console.wicket.extensions.markup.html.repeater.data.table.DatePropertyColumn;\n+import org.apache.syncope.console.wicket.extensions.markup.html.repeater.data.table.JobColumn;\n import org.apache.syncope.console.wicket.markup.html.form.ActionLink;\n import org.apache.syncope.console.wicket.markup.html.form.ActionLinksPanel;\n import org.apache.wicket.Component;\n@@ -167,6 +170,9 @@ private List<IColumn<AbstractTaskTO, String>> getColumns() {\n         columns.add(new PropertyColumn<AbstractTaskTO, String>(\n                 new StringResourceModel(\"latestExecStatus\", this, null), \"latestExecStatus\", \"latestExecStatus\"));\n \n+        columns.add(new JobColumn<AbstractTaskTO, String>(new StringResourceModel(\"\", this, null, \"\"), \"runtime\",\n+                pageRef, restClient)); \n+\n         columns.add(new ActionColumn<AbstractTaskTO, String>(new StringResourceModel(\"actions\", this, null, \"\")) {\n \n             private static final long serialVersionUID = 2054811145491901166L;"},{"sha":"032f4e48f1a037d184213dbbdaac9dac809308e8","filename":"console/src/main/java/org/apache/syncope/console/pages/panels/SyncTasksPanel.java","status":"modified","additions":4,"deletions":0,"changes":4,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/790704c08790f8a2536af84ed46290f1596851f0/console%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fconsole%2Fpages%2Fpanels%2FSyncTasksPanel.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/790704c08790f8a2536af84ed46290f1596851f0/console%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fconsole%2Fpages%2Fpanels%2FSyncTasksPanel.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/console%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fconsole%2Fpages%2Fpanels%2FSyncTasksPanel.java?ref=790704c08790f8a2536af84ed46290f1596851f0","patch":"@@ -29,6 +29,7 @@\n import org.apache.syncope.console.pages.UserTemplateModalPage;\n import org.apache.syncope.console.wicket.extensions.markup.html.repeater.data.table.ActionColumn;\n import org.apache.syncope.console.wicket.extensions.markup.html.repeater.data.table.DatePropertyColumn;\n+import org.apache.syncope.console.wicket.extensions.markup.html.repeater.data.table.JobColumn;\n import org.apache.syncope.console.wicket.markup.html.form.ActionLink;\n import org.apache.syncope.console.wicket.markup.html.form.ActionLinksPanel;\n import org.apache.wicket.Component;\n@@ -69,6 +70,9 @@ protected List<IColumn<AbstractTaskTO, String>> getColumns() {\n                 new StringResourceModel(\"nextExec\", this, null), \"nextExec\", \"nextExec\"));\n         syncTaskscolumns.add(new PropertyColumn<AbstractTaskTO, String>(\n                 new StringResourceModel(\"latestExecStatus\", this, null), \"latestExecStatus\", \"latestExecStatus\"));\n+        \n+        syncTaskscolumns.add(new JobColumn<AbstractTaskTO, String>(new StringResourceModel(\"\", this, null, \"\"), \"runtime\",\n+                pageRef, restClient));        \n \n         syncTaskscolumns.add(\n                 new ActionColumn<AbstractTaskTO, String>(new StringResourceModel(\"actions\", this, null, \"\")) {"},{"sha":"de361f3eee69c00a8e31d0f329f4240c1a09a433","filename":"console/src/main/java/org/apache/syncope/console/rest/JobRestClient.java","status":"added","additions":31,"deletions":0,"changes":31,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/790704c08790f8a2536af84ed46290f1596851f0/console%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fconsole%2Frest%2FJobRestClient.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/790704c08790f8a2536af84ed46290f1596851f0/console%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fconsole%2Frest%2FJobRestClient.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/console%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fconsole%2Frest%2FJobRestClient.java?ref=790704c08790f8a2536af84ed46290f1596851f0","patch":"@@ -0,0 +1,31 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *   http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+package org.apache.syncope.console.rest;\n+\n+import org.springframework.stereotype.Component;\n+\n+@Component\n+public abstract class JobRestClient extends BaseRestClient{\n+\n+    public abstract boolean isJobRunning(final long id);\n+\n+    public abstract void startJob(final long id);\n+\n+    public abstract void stopJob(final long id);\n+}"},{"sha":"9b8afdb74fc3a99dbf17546fc2daece7569a0502","filename":"console/src/main/java/org/apache/syncope/console/rest/ReportRestClient.java","status":"modified","additions":24,"deletions":1,"changes":25,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/790704c08790f8a2536af84ed46290f1596851f0/console%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fconsole%2Frest%2FReportRestClient.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/790704c08790f8a2536af84ed46290f1596851f0/console%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fconsole%2Frest%2FReportRestClient.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/console%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fconsole%2Frest%2FReportRestClient.java?ref=790704c08790f8a2536af84ed46290f1596851f0","patch":"@@ -25,12 +25,15 @@\n import org.apache.syncope.common.to.ReportTO;\n import org.apache.syncope.common.types.ReportExecExportFormat;\n import org.apache.syncope.common.SyncopeClientException;\n+import org.apache.syncope.common.to.ReportExecTO;\n+import org.apache.syncope.common.types.JobAction;\n+import org.apache.syncope.common.types.JobStatusType;\n import org.apache.syncope.common.wrap.ReportletConfClass;\n import org.apache.wicket.extensions.markup.html.repeater.util.SortParam;\n import org.springframework.stereotype.Component;\n \n @Component\n-public class ReportRestClient extends BaseRestClient implements ExecutionRestClient {\n+public class ReportRestClient extends JobRestClient implements ExecutionRestClient {\n \n     private static final long serialVersionUID = 1644689667998953604L;\n \n@@ -105,4 +108,24 @@ public void deleteExecution(final long reportExecId) {\n     public Response exportExecutionResult(final Long executionId, final ReportExecExportFormat fmt) {\n         return getService(ReportService.class).exportExecutionResult(executionId, fmt);\n     }\n+\n+    @Override\n+    public boolean isJobRunning(final long reportId) {\n+        for (ReportExecTO reportExecTO : getService(ReportService.class).listJobs(JobStatusType.RUNNING)) {\n+            if (reportExecTO.getReport() == reportId) {\n+                return true;\n+            }\n+        }\n+        return false;\n+    }\n+\n+    @Override\n+    public void startJob(final long reportId) {\n+        getService(ReportService.class).actionJob(reportId, JobAction.START);\n+    }\n+\n+    @Override\n+    public void stopJob(final long reportId) {\n+        getService(ReportService.class).actionJob(reportId, JobAction.STOP);\n+    }\n }"},{"sha":"c83ce88ee728faae1265a107ba8c2b2c34cd62c1","filename":"console/src/main/java/org/apache/syncope/console/rest/TaskRestClient.java","status":"modified","additions":22,"deletions":1,"changes":23,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/790704c08790f8a2536af84ed46290f1596851f0/console%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fconsole%2Frest%2FTaskRestClient.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/790704c08790f8a2536af84ed46290f1596851f0/console%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fconsole%2Frest%2FTaskRestClient.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/console%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fconsole%2Frest%2FTaskRestClient.java?ref=790704c08790f8a2536af84ed46290f1596851f0","patch":"@@ -34,6 +34,9 @@\n import org.apache.syncope.common.util.CollectionWrapper;\n import org.apache.syncope.common.SyncopeClientException;\n import org.apache.syncope.common.to.PushTaskTO;\n+import org.apache.syncope.common.to.TaskExecTO;\n+import org.apache.syncope.common.types.JobAction;\n+import org.apache.syncope.common.types.JobStatusType;\n import org.apache.syncope.common.wrap.PushActionClass;\n import org.apache.wicket.extensions.markup.html.repeater.util.SortParam;\n import org.springframework.stereotype.Component;\n@@ -42,7 +45,7 @@\n  * Console client for invoking Rest Tasks services.\n  */\n @Component\n-public class TaskRestClient extends BaseRestClient implements ExecutionRestClient {\n+public class TaskRestClient extends JobRestClient implements ExecutionRestClient {\n \n     private static final long serialVersionUID = 6284485820911028843L;\n \n@@ -167,4 +170,22 @@ public void updateSyncTask(final SyncTaskTO taskTO) {\n     public BulkActionResult bulkAction(final BulkAction action) {\n         return getService(TaskService.class).bulk(action);\n     }\n+    \n+    @Override\n+    public boolean isJobRunning(final long taskId){\n+        for(TaskExecTO taskExecTO : getService(TaskService.class).listJobs(JobStatusType.RUNNING)){\n+            if(taskExecTO.getTask()== taskId) return true;\n+        }\n+        return false;\n+    }\n+    \n+    @Override\n+    public void startJob(final long taskId){\n+        getService(TaskService.class).actionJob(taskId, JobAction.START);\n+    }\n+\n+    @Override\n+    public void stopJob(final long taskId) {\n+        getService(TaskService.class).actionJob(taskId, JobAction.STOP);\n+    }\n }"},{"sha":"563e3cbc670b71ca87fdc8f8f44d6a30f0f6cc3a","filename":"console/src/main/java/org/apache/syncope/console/wicket/extensions/markup/html/repeater/data/table/JobColumn.java","status":"added","additions":94,"deletions":0,"changes":94,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/790704c08790f8a2536af84ed46290f1596851f0/console%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fconsole%2Fwicket%2Fextensions%2Fmarkup%2Fhtml%2Frepeater%2Fdata%2Ftable%2FJobColumn.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/790704c08790f8a2536af84ed46290f1596851f0/console%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fconsole%2Fwicket%2Fextensions%2Fmarkup%2Fhtml%2Frepeater%2Fdata%2Ftable%2FJobColumn.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/console%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fconsole%2Fwicket%2Fextensions%2Fmarkup%2Fhtml%2Frepeater%2Fdata%2Ftable%2FJobColumn.java?ref=790704c08790f8a2536af84ed46290f1596851f0","patch":"@@ -0,0 +1,94 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *   http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+package org.apache.syncope.console.wicket.extensions.markup.html.repeater.data.table;\n+\n+import org.apache.syncope.common.to.AbstractTaskTO;\n+import org.apache.syncope.common.to.ReportTO;\n+import org.apache.syncope.console.pages.panels.RuntimePanel;\n+import org.apache.syncope.console.rest.JobRestClient;\n+import org.apache.wicket.PageReference;\n+import org.apache.wicket.ajax.AbstractAjaxTimerBehavior;\n+import org.apache.wicket.ajax.AjaxRequestTarget;\n+import org.apache.wicket.ajax.attributes.AjaxRequestAttributes;\n+import org.apache.wicket.extensions.markup.html.repeater.data.grid.ICellPopulator;\n+import org.apache.wicket.extensions.markup.html.repeater.data.table.AbstractColumn;\n+import org.apache.wicket.markup.repeater.Item;\n+import org.apache.wicket.model.IModel;\n+import org.apache.wicket.util.time.Duration;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+public class JobColumn<T, S> extends AbstractColumn<T, S> {\n+\n+    private static final long serialVersionUID = 7955560320949560725L;\n+\n+    protected static final Logger LOG = LoggerFactory.getLogger(JobColumn.class);\n+\n+    private final PageReference pageRef;\n+\n+    private RuntimePanel panel;\n+\n+    private final JobRestClient jobRestClient;\n+\n+    public JobColumn(final IModel<String> displayModel, final S sortProperty, final PageReference pageRef,\n+            final JobRestClient jobRestClient) {\n+        super(displayModel, sortProperty);\n+        this.pageRef = pageRef;\n+        this.jobRestClient = jobRestClient;\n+    }\n+\n+    @Override\n+    public void populateItem(final Item<ICellPopulator<T>> item, final String componentId, final IModel<T> model) {\n+        Long jobId = null;\n+        if (model.getObject() instanceof AbstractTaskTO) {\n+            jobId = ((AbstractTaskTO) model.getObject()).getId();\n+        } else if (model.getObject() instanceof ReportTO) {\n+            jobId = ((ReportTO) model.getObject()).getId();\n+        }\n+        if (jobId != null) {\n+            panel = new RuntimePanel(componentId, model, pageRef, jobId, jobRestClient);\n+            startPolling(10);\n+            item.add(panel);\n+        }\n+    }\n+\n+    public void startPolling(final int seconds) {\n+        AbstractAjaxTimerBehavior timer = new AbstractAjaxTimerBehavior(Duration.seconds(seconds)) {\n+\n+            private static final long serialVersionUID = 1L;\n+\n+            @Override\n+            protected void onTimer(AjaxRequestTarget target) {\n+                panel.refresh();\n+                target.add(panel);\n+            }\n+\n+            @Override\n+            protected void updateAjaxAttributes(AjaxRequestAttributes attributes) {\n+                super.updateAjaxAttributes(attributes);\n+                attributes.getExtraParameters().put(\"pollingTimeout\", \"true\");\n+            }\n+\n+        };\n+\n+        panel.setTimer(timer);\n+\n+    }\n+\n+}"},{"sha":"ff5fb37f86f50a853d37fff9a481d8f0bd8338c8","filename":"console/src/main/resources/org/apache/syncope/console/pages/Reports.html","status":"modified","additions":13,"deletions":0,"changes":13,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/790704c08790f8a2536af84ed46290f1596851f0/console%2Fsrc%2Fmain%2Fresources%2Forg%2Fapache%2Fsyncope%2Fconsole%2Fpages%2FReports.html","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/790704c08790f8a2536af84ed46290f1596851f0/console%2Fsrc%2Fmain%2Fresources%2Forg%2Fapache%2Fsyncope%2Fconsole%2Fpages%2FReports.html","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/console%2Fsrc%2Fmain%2Fresources%2Forg%2Fapache%2Fsyncope%2Fconsole%2Fpages%2FReports.html?ref=790704c08790f8a2536af84ed46290f1596851f0","patch":"@@ -18,7 +18,20 @@\n -->\n <html xmlns=\"http://www.w3.org/1999/xhtml\" xmlns:wicket=\"http://wicket.apache.org\">\n   <wicket:extend>\n+    <script type=\"text/javascript\">\n+      window.onload = setupFunc;\n \n+      function setupFunc() {\n+        Wicket.Event.subscribe('/ajax/call/beforeSend', function (attributes, jqXHR, settings) {\n+          if (!jqXHR.ep || !jqXHR.ep[0] || !jqXHR.ep[0][\"value\"]) {\n+            document.getElementById(\"veil\").style.display = \"block\";\n+          }\n+        });\n+        Wicket.Event.subscribe('/ajax/call/complete', function (attributes, jqXHR, textStatus) {\n+          document.getElementById(\"veil\").style.display = \"none\";\n+        });\n+      }\n+    </script>\n     <div id=\"tabs\">\n       <ul>\n         <li class=\"tabs-selected\"><a href=\"#tabs-1\"><span><wicket:message key=\"reports\"/></span></a></li>"},{"sha":"81c9237ce574ebd257cd6d715682d02753137c4d","filename":"console/src/main/resources/org/apache/syncope/console/pages/Tasks.html","status":"modified","additions":15,"deletions":0,"changes":15,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/790704c08790f8a2536af84ed46290f1596851f0/console%2Fsrc%2Fmain%2Fresources%2Forg%2Fapache%2Fsyncope%2Fconsole%2Fpages%2FTasks.html","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/790704c08790f8a2536af84ed46290f1596851f0/console%2Fsrc%2Fmain%2Fresources%2Forg%2Fapache%2Fsyncope%2Fconsole%2Fpages%2FTasks.html","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/console%2Fsrc%2Fmain%2Fresources%2Forg%2Fapache%2Fsyncope%2Fconsole%2Fpages%2FTasks.html?ref=790704c08790f8a2536af84ed46290f1596851f0","patch":"@@ -18,6 +18,21 @@\n -->\n <wicket:extend>\n \n+  <script type=\"text/javascript\">\n+    window.onload = setupFunc;\n+\n+    function setupFunc() {\n+      Wicket.Event.subscribe('/ajax/call/beforeSend', function (attributes, jqXHR, settings) {\n+        if (!jqXHR.ep || !jqXHR.ep[0] || !jqXHR.ep[0][\"value\"]){\n+          document.getElementById(\"veil\").style.display = \"block\";\n+        }\n+      });\n+      Wicket.Event.subscribe('/ajax/call/complete', function (attributes, jqXHR, textStatus) {\n+        document.getElementById(\"veil\").style.display = \"none\";\n+      });\n+    }\n+  </script>\n+\n   <div id=\"tabs\">\n     <ul>\n       <li class=\"tabs-selected\"><a href=\"#tabs-1\"><span><wicket:message key=\"tab1\"/></span></a></li>"},{"sha":"828192c85851884a464af28682581ad91272f6c4","filename":"console/src/main/resources/org/apache/syncope/console/pages/panels/RuntimePanel.html","status":"added","additions":49,"deletions":0,"changes":49,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/790704c08790f8a2536af84ed46290f1596851f0/console%2Fsrc%2Fmain%2Fresources%2Forg%2Fapache%2Fsyncope%2Fconsole%2Fpages%2Fpanels%2FRuntimePanel.html","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/790704c08790f8a2536af84ed46290f1596851f0/console%2Fsrc%2Fmain%2Fresources%2Forg%2Fapache%2Fsyncope%2Fconsole%2Fpages%2Fpanels%2FRuntimePanel.html","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/console%2Fsrc%2Fmain%2Fresources%2Forg%2Fapache%2Fsyncope%2Fconsole%2Fpages%2Fpanels%2FRuntimePanel.html?ref=790704c08790f8a2536af84ed46290f1596851f0","patch":"@@ -0,0 +1,49 @@\n+<!--\n+Licensed to the Apache Software Foundation (ASF) under one\n+or more contributor license agreements.  See the NOTICE file\n+distributed with this work for additional information\n+regarding copyright ownership.  The ASF licenses this file\n+to you under the Apache License, Version 2.0 (the\n+\"License\"); you may not use this file except in compliance\n+with the License.  You may obtain a copy of the License at\n+\n+  http://www.apache.org/licenses/LICENSE-2.0\n+\n+Unless required by applicable law or agreed to in writing,\n+software distributed under the License is distributed on an\n+\"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+KIND, either express or implied.  See the License for the\n+specific language governing permissions and limitations\n+under the License.\n+-->\n+<html xmlns=\"http://www.w3.org/1999/xhtml\" xmlns:wicket=\"http://wicket.apache.org\">\n+  <wicket:head>\n+    <style>\n+      #runtime{\n+        text-align: center;\n+      }\n+    </style>\n+  </wicket:head>\n+  <wicket:panel wicket:id=\"runtime\">\n+    <div>\n+      <div id=\"runtime\">\n+        <div id=\"runtimePanel\">\n+          <span wicket:id=\"panelStop\"></span>\n+          <span wicket:id=\"panelSpinner\"></span>\n+\n+          <wicket:fragment wicket:id=\"fragmentStop\">\n+            <a href=\"#\" wicket:id=\"stopLink\"><img src=\"img/actions/suspend.png\" alt=\"stop icon\" title=\"Stop Now\"/></a>\n+          </wicket:fragment>\n+\n+          <wicket:fragment wicket:id=\"fragmentSpinner\">\n+            <img src=\"img/loading.gif\" alt=\"spinner icon\" title=\"Spinner\"/>\n+          </wicket:fragment>\n+\n+          <wicket:fragment wicket:id=\"emptyFragment\"></wicket:fragment>\n+\n+        </div>\n+\n+      </div>\n+    </div>\n+  </wicket:panel>\n+</html>"},{"sha":"e7aa31e033e7637f70ca1d3bcf4ffab67be632fa","filename":"core/src/main/java/org/apache/syncope/core/rest/controller/AbstractJobController.java","status":"modified","additions":14,"deletions":1,"changes":15,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/790704c08790f8a2536af84ed46290f1596851f0/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Frest%2Fcontroller%2FAbstractJobController.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/790704c08790f8a2536af84ed46290f1596851f0/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Frest%2Fcontroller%2FAbstractJobController.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Frest%2Fcontroller%2FAbstractJobController.java?ref=790704c08790f8a2536af84ed46290f1596851f0","patch":"@@ -158,7 +158,20 @@ protected void actionJob(final String jobName, final JobAction action) {\n                 if (scheduler.getScheduler().checkExists(jobKey)) {\n                     switch (action) {\n                         case START:\n-                            scheduler.getScheduler().triggerJob(jobKey);\n+                            Long currentId = getIdFromJobName(jobKey);\n+                            boolean found = false;\n+                            //Two or more equals jobs cannot be executed concurrently\n+                            for (int i = 0; i < scheduler.getScheduler().getCurrentlyExecutingJobs().size() && !found;\n+                                    i++) {\n+                                JobExecutionContext jec = scheduler.getScheduler().getCurrentlyExecutingJobs().get(i);\n+                                Long jobId = getIdFromJobName(jec.getJobDetail().getKey());\n+                                if (jobId == currentId) {\n+                                    found = true;\n+                                }\n+                            }\n+                            if (!found) {\n+                                scheduler.getScheduler().triggerJob(jobKey);\n+                            }\n                             break;\n \n                         case STOP:"}]}