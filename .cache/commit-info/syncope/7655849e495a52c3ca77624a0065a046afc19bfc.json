{"sha":"7655849e495a52c3ca77624a0065a046afc19bfc","node_id":"MDY6Q29tbWl0NjM2ODc5MDYyOjc2NTU4NDllNDk1YTUyYzNjYTc3NjI0YTAwNjVhMDQ2YWZjMTliZmM=","commit":{"author":{"name":"Francesco Chicchiriccò","email":"ilgrosso@apache.org","date":"2018-02-06T15:05:28Z"},"committer":{"name":"Francesco Chicchiriccò","email":"ilgrosso@apache.org","date":"2018-02-06T15:38:58Z"},"message":"Some clean up","tree":{"sha":"67ea12a961c95c06c944fe1eda73799ebdd849bc","url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/git/trees/67ea12a961c95c06c944fe1eda73799ebdd849bc"},"url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/git/commits/7655849e495a52c3ca77624a0065a046afc19bfc","comment_count":0,"verification":{"verified":false,"reason":"unsigned","signature":null,"payload":null}},"url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/7655849e495a52c3ca77624a0065a046afc19bfc","html_url":"https://github.com/EnricoDAlessandro97UNI/syncope/commit/7655849e495a52c3ca77624a0065a046afc19bfc","comments_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/7655849e495a52c3ca77624a0065a046afc19bfc/comments","author":{"login":"ilgrosso","id":1064664,"node_id":"MDQ6VXNlcjEwNjQ2NjQ=","avatar_url":"https://avatars.githubusercontent.com/u/1064664?v=4","gravatar_id":"","url":"https://api.github.com/users/ilgrosso","html_url":"https://github.com/ilgrosso","followers_url":"https://api.github.com/users/ilgrosso/followers","following_url":"https://api.github.com/users/ilgrosso/following{/other_user}","gists_url":"https://api.github.com/users/ilgrosso/gists{/gist_id}","starred_url":"https://api.github.com/users/ilgrosso/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ilgrosso/subscriptions","organizations_url":"https://api.github.com/users/ilgrosso/orgs","repos_url":"https://api.github.com/users/ilgrosso/repos","events_url":"https://api.github.com/users/ilgrosso/events{/privacy}","received_events_url":"https://api.github.com/users/ilgrosso/received_events","type":"User","site_admin":false},"committer":{"login":"ilgrosso","id":1064664,"node_id":"MDQ6VXNlcjEwNjQ2NjQ=","avatar_url":"https://avatars.githubusercontent.com/u/1064664?v=4","gravatar_id":"","url":"https://api.github.com/users/ilgrosso","html_url":"https://github.com/ilgrosso","followers_url":"https://api.github.com/users/ilgrosso/followers","following_url":"https://api.github.com/users/ilgrosso/following{/other_user}","gists_url":"https://api.github.com/users/ilgrosso/gists{/gist_id}","starred_url":"https://api.github.com/users/ilgrosso/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ilgrosso/subscriptions","organizations_url":"https://api.github.com/users/ilgrosso/orgs","repos_url":"https://api.github.com/users/ilgrosso/repos","events_url":"https://api.github.com/users/ilgrosso/events{/privacy}","received_events_url":"https://api.github.com/users/ilgrosso/received_events","type":"User","site_admin":false},"parents":[{"sha":"52c0ad3f2f5d6259ce583a0817ce2dbf10ceecf4","url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/52c0ad3f2f5d6259ce583a0817ce2dbf10ceecf4","html_url":"https://github.com/EnricoDAlessandro97UNI/syncope/commit/52c0ad3f2f5d6259ce583a0817ce2dbf10ceecf4"}],"stats":{"total":94,"additions":50,"deletions":44},"files":[{"sha":"eae157cc51260416335dcdddd2739a33d28501af","filename":"client/console/src/main/java/org/apache/syncope/client/console/panels/DerSchemaDetails.java","status":"modified","additions":3,"deletions":2,"changes":5,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/7655849e495a52c3ca77624a0065a046afc19bfc/client%2Fconsole%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fclient%2Fconsole%2Fpanels%2FDerSchemaDetails.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/7655849e495a52c3ca77624a0065a046afc19bfc/client%2Fconsole%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fclient%2Fconsole%2Fpanels%2FDerSchemaDetails.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/client%2Fconsole%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fclient%2Fconsole%2Fpanels%2FDerSchemaDetails.java?ref=7655849e495a52c3ca77624a0065a046afc19bfc","patch":"@@ -20,7 +20,7 @@\n \n import de.agilecoders.wicket.core.markup.html.bootstrap.components.TooltipConfig;\n import org.apache.syncope.client.console.commons.Constants;\n-import org.apache.syncope.common.lib.to.AbstractSchemaTO;\n+import org.apache.syncope.common.lib.to.DerSchemaTO;\n import org.apache.wicket.PageReference;\n import org.apache.wicket.markup.html.form.TextField;\n import org.apache.wicket.model.PropertyModel;\n@@ -31,7 +31,8 @@ public class DerSchemaDetails extends AbstractSchemaDetailsPanel {\n \n     public DerSchemaDetails(final String id,\n             final PageReference pageReference,\n-            final AbstractSchemaTO schemaTO) {\n+            final DerSchemaTO schemaTO) {\n+\n         super(id, pageReference, schemaTO);\n \n         TextField<String> expression = new TextField<>(\"expression\", new PropertyModel<>(schemaTO, \"expression\"));"},{"sha":"c2493976d01e939250bb36b98edac3f2cba6857f","filename":"client/console/src/main/java/org/apache/syncope/client/console/panels/PlainSchemaDetails.java","status":"modified","additions":8,"deletions":7,"changes":15,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/7655849e495a52c3ca77624a0065a046afc19bfc/client%2Fconsole%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fclient%2Fconsole%2Fpanels%2FPlainSchemaDetails.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/7655849e495a52c3ca77624a0065a046afc19bfc/client%2Fconsole%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fclient%2Fconsole%2Fpanels%2FPlainSchemaDetails.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/client%2Fconsole%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fclient%2Fconsole%2Fpanels%2FPlainSchemaDetails.java?ref=7655849e495a52c3ca77624a0065a046afc19bfc","patch":"@@ -72,7 +72,8 @@ public class PlainSchemaDetails extends AbstractSchemaDetailsPanel {\n     public PlainSchemaDetails(\n             final String id,\n             final PageReference pageReference,\n-            final AbstractSchemaTO schemaTO) {\n+            final PlainSchemaTO schemaTO) {\n+\n         super(id, pageReference, schemaTO);\n \n         final AjaxDropDownChoicePanel<AttrSchemaType> type = new AjaxDropDownChoicePanel<>(\n@@ -115,19 +116,19 @@ public PropertyList<PlainSchemaTO> getObject() {\n \n                     @Override\n                     public String getValues() {\n-                        return PlainSchemaTO.class.cast(schemaTO).getEnumerationValues();\n+                        return schemaTO.getEnumerationValues();\n                     }\n \n                     @Override\n                     public void setValues(final List<String> list) {\n-                        PlainSchemaTO.class.cast(schemaTO).setEnumerationValues(getEnumValuesAsString(list));\n+                        schemaTO.setEnumerationValues(getEnumValuesAsString(list));\n                     }\n                 };\n             }\n \n             @Override\n             public void setObject(final List<String> object) {\n-                PlainSchemaTO.class.cast(schemaTO).setEnumerationValues(PropertyList.getEnumValuesAsString(object));\n+                schemaTO.setEnumerationValues(PropertyList.getEnumValuesAsString(object));\n             }\n         }) {\n \n@@ -154,19 +155,19 @@ public PropertyList<PlainSchemaTO> getObject() {\n \n                     @Override\n                     public String getValues() {\n-                        return PlainSchemaTO.class.cast(schemaTO).getEnumerationKeys();\n+                        return schemaTO.getEnumerationKeys();\n                     }\n \n                     @Override\n                     public void setValues(final List<String> list) {\n-                        PlainSchemaTO.class.cast(schemaTO).setEnumerationKeys(PropertyList.getEnumValuesAsString(list));\n+                        schemaTO.setEnumerationKeys(PropertyList.getEnumValuesAsString(list));\n                     }\n                 };\n             }\n \n             @Override\n             public void setObject(final List<String> object) {\n-                PlainSchemaTO.class.cast(schemaTO).setEnumerationKeys(PropertyList.getEnumValuesAsString(object));\n+                schemaTO.setEnumerationKeys(PropertyList.getEnumValuesAsString(object));\n             }\n         }) {\n "},{"sha":"9c00fd2ab0b8e26e36285fd0a8e9eb3243d2261e","filename":"client/console/src/main/java/org/apache/syncope/client/console/panels/SchemaModalPanel.java","status":"modified","additions":8,"deletions":3,"changes":11,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/7655849e495a52c3ca77624a0065a046afc19bfc/client%2Fconsole%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fclient%2Fconsole%2Fpanels%2FSchemaModalPanel.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/7655849e495a52c3ca77624a0065a046afc19bfc/client%2Fconsole%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fclient%2Fconsole%2Fpanels%2FSchemaModalPanel.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/client%2Fconsole%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fclient%2Fconsole%2Fpanels%2FSchemaModalPanel.java?ref=7655849e495a52c3ca77624a0065a046afc19bfc","patch":"@@ -22,6 +22,9 @@\n import org.apache.syncope.client.console.wicket.markup.html.bootstrap.dialog.BaseModal;\n import org.apache.syncope.client.console.wicket.markup.html.form.AjaxDropDownChoicePanel;\n import org.apache.syncope.common.lib.to.AbstractSchemaTO;\n+import org.apache.syncope.common.lib.to.DerSchemaTO;\n+import org.apache.syncope.common.lib.to.PlainSchemaTO;\n+import org.apache.syncope.common.lib.to.VirSchemaTO;\n import org.apache.syncope.common.lib.types.SchemaType;\n import org.apache.wicket.PageReference;\n import org.apache.wicket.markup.html.form.Form;\n@@ -75,14 +78,16 @@ private AbstractSchemaDetailsPanel getSchemaPanel(final String id,\n \n         switch (schemaType) {\n             case DERIVED:\n-                panel = new DerSchemaDetails(id, pageRef, schemaTO);\n+                panel = new DerSchemaDetails(id, pageRef, (DerSchemaTO) schemaTO);\n                 break;\n+\n             case VIRTUAL:\n-                panel = new VirSchemaDetails(id, pageRef, schemaTO);\n+                panel = new VirSchemaDetails(id, pageRef, (VirSchemaTO) schemaTO);\n                 break;\n+\n             case PLAIN:\n             default:\n-                panel = new PlainSchemaDetails(id, pageRef, schemaTO);\n+                panel = new PlainSchemaDetails(id, pageRef, (PlainSchemaTO) schemaTO);\n         }\n         panel.setOutputMarkupId(true);\n         return panel;"},{"sha":"ef30352892ee79ad76a803a3d524cc0c7c8f1980","filename":"client/console/src/main/java/org/apache/syncope/client/console/panels/VirSchemaDetails.java","status":"modified","additions":2,"deletions":2,"changes":4,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/7655849e495a52c3ca77624a0065a046afc19bfc/client%2Fconsole%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fclient%2Fconsole%2Fpanels%2FVirSchemaDetails.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/7655849e495a52c3ca77624a0065a046afc19bfc/client%2Fconsole%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fclient%2Fconsole%2Fpanels%2FVirSchemaDetails.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/client%2Fconsole%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fclient%2Fconsole%2Fpanels%2FVirSchemaDetails.java?ref=7655849e495a52c3ca77624a0065a046afc19bfc","patch":"@@ -33,11 +33,11 @@\n import org.apache.syncope.client.console.wicket.markup.html.form.AjaxCheckBoxPanel;\n import org.apache.syncope.client.console.wicket.markup.html.form.AjaxDropDownChoicePanel;\n import org.apache.syncope.client.console.wicket.markup.html.form.AjaxTextFieldPanel;\n-import org.apache.syncope.common.lib.to.AbstractSchemaTO;\n import org.apache.syncope.common.lib.to.ConnIdObjectClassTO;\n import org.apache.syncope.common.lib.to.ConnInstanceTO;\n import org.apache.syncope.common.lib.to.EntityTO;\n import org.apache.syncope.common.lib.to.ResourceTO;\n+import org.apache.syncope.common.lib.to.VirSchemaTO;\n import org.apache.syncope.common.lib.types.StandardEntitlement;\n import org.apache.wicket.PageReference;\n import org.apache.wicket.ajax.AjaxRequestTarget;\n@@ -59,7 +59,7 @@ public class VirSchemaDetails extends AbstractSchemaDetailsPanel {\n \n     public VirSchemaDetails(final String id,\n             final PageReference pageReference,\n-            final AbstractSchemaTO schemaTO) {\n+            final VirSchemaTO schemaTO) {\n \n         super(id, pageReference, schemaTO);\n "},{"sha":"1ba5c3a4ac503287d0a8a3687a7169f0d4db6068","filename":"core/persistence-jpa/pom.xml","status":"modified","additions":6,"deletions":6,"changes":12,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/7655849e495a52c3ca77624a0065a046afc19bfc/core%2Fpersistence-jpa%2Fpom.xml","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/7655849e495a52c3ca77624a0065a046afc19bfc/core%2Fpersistence-jpa%2Fpom.xml","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fpersistence-jpa%2Fpom.xml?ref=7655849e495a52c3ca77624a0065a046afc19bfc","patch":"@@ -92,7 +92,12 @@ under the License.\n       <groupId>org.apache.commons</groupId>\n       <artifactId>commons-jexl3</artifactId>\n     </dependency>\n-      \n+    \n+    <dependency>\n+      <groupId>org.apache.tika</groupId>\n+      <artifactId>tika-core</artifactId>\n+    </dependency>\n+\n     <dependency>\n       <groupId>org.apache.syncope.core</groupId>\n       <artifactId>syncope-core-workflow-api</artifactId>\n@@ -103,11 +108,6 @@ under the License.\n       <artifactId>syncope-core-spring</artifactId>\n       <version>${project.version}</version>\n     </dependency>\n-    \n-    <dependency>\n-      <groupId>org.apache.tika</groupId>\n-      <artifactId>tika-core</artifactId>\n-    </dependency>\n         \n     <!-- TEST -->\n     <dependency> "},{"sha":"b32f91c68498a03e7bc6924ef642aeddb8500869","filename":"core/persistence-jpa/src/main/java/org/apache/syncope/core/persistence/jpa/attrvalue/validation/BinaryValidator.java","status":"modified","additions":16,"deletions":17,"changes":33,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/7655849e495a52c3ca77624a0065a046afc19bfc/core%2Fpersistence-jpa%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fpersistence%2Fjpa%2Fattrvalue%2Fvalidation%2FBinaryValidator.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/7655849e495a52c3ca77624a0065a046afc19bfc/core%2Fpersistence-jpa%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fpersistence%2Fjpa%2Fattrvalue%2Fvalidation%2FBinaryValidator.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fpersistence-jpa%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fpersistence%2Fjpa%2Fattrvalue%2Fvalidation%2FBinaryValidator.java?ref=7655849e495a52c3ca77624a0065a046afc19bfc","patch":"@@ -20,9 +20,9 @@\n \n import com.fasterxml.jackson.databind.ObjectMapper;\n import java.io.IOException;\n+import javax.ws.rs.core.MediaType;\n import org.apache.syncope.core.persistence.api.attrvalue.validation.InvalidPlainAttrValueException;\n import org.apache.syncope.core.persistence.api.entity.PlainAttrValue;\n-import org.apache.syncope.core.persistence.api.entity.PlainSchema;\n import org.apache.tika.Tika;\n \n public class BinaryValidator extends AbstractValidator {\n@@ -31,17 +31,24 @@ public class BinaryValidator extends AbstractValidator {\n \n     private static final ObjectMapper MAPPER = new ObjectMapper();\n \n+    private static final Tika TIKA = new Tika();\n+\n+    static {\n+        TIKA.setMaxStringLength(-1);\n+    }\n+\n     @Override\n     protected void doValidate(final PlainAttrValue attrValue) {\n         // check Binary schemas MIME Type mismatches\n         if (attrValue.getBinaryValue() != null) {\n-            PlainSchema currentSchema = attrValue.getAttr().getSchema();\n             byte[] binaryValue = attrValue.getBinaryValue();\n-            String mimeType = detectSchemaMimeType(binaryValue);\n+            String mimeType = TIKA.detect(binaryValue);\n+\n             boolean valid = true;\n-            if (!mimeType.equals(currentSchema.getMimeType())) {\n-                if (mimeType.equals(\"text/plain\")\n-                        && currentSchema.getMimeType().equals(\"application/json\")) {\n+            if (!mimeType.equals(attrValue.getAttr().getSchema().getMimeType())) {\n+                if (MediaType.TEXT_PLAIN.equals(mimeType)\n+                        && MediaType.APPLICATION_JSON.equals(attrValue.getAttr().getSchema().getMimeType())) {\n+\n                     String decoded = new String(binaryValue).trim();\n                     valid = (decoded.startsWith(\"{\") && decoded.endsWith(\"}\"))\n                             || (decoded.startsWith(\"[\") && decoded.endsWith(\"]\"))\n@@ -52,26 +59,18 @@ protected void doValidate(final PlainAttrValue attrValue) {\n             }\n             if (!valid) {\n                 throw new InvalidPlainAttrValueException(\n-                        \"Found MIME type: '\"\n-                        + mimeType\n-                        + \"', expecting: '\"\n-                        + currentSchema.getMimeType()\n-                        + \"'\");\n+                        \"Found MIME type: '\" + mimeType + \"', expecting: '\"\n+                        + attrValue.getAttr().getSchema().getMimeType() + \"'\");\n             }\n         }\n     }\n \n-    private String detectSchemaMimeType(final byte[] value) {\n-        Tika tika = new Tika();\n-        tika.setMaxStringLength(-1);\n-        return tika.detect(value);\n-    }\n-\n     private boolean isValidJSON(final String value) {\n         try {\n             MAPPER.readTree(value);\n             return true;\n         } catch (IOException e) {\n+            LOG.debug(\"Invalid JSON string: {}\", value, e);\n             return false;\n         }\n     }"},{"sha":"bc314b1d29fbd953dff67952511d406b46a89064","filename":"pom.xml","status":"modified","additions":7,"deletions":7,"changes":14,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/7655849e495a52c3ca77624a0065a046afc19bfc/pom.xml","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/7655849e495a52c3ca77624a0065a046afc19bfc/pom.xml","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/pom.xml?ref=7655849e495a52c3ca77624a0065a046afc19bfc","patch":"@@ -974,6 +974,12 @@ under the License.\n         <version>${commons-text.version}</version>\n       </dependency>\n \n+      <dependency>\n+        <groupId>org.apache.tika</groupId>\n+        <artifactId>tika-core</artifactId>\n+        <version>${tika.version}</version>\n+      </dependency>\n+\n       <dependency>\n         <groupId>net.tirasa.connid</groupId>\n         <artifactId>connector-framework</artifactId>\n@@ -1490,12 +1496,6 @@ under the License.\n         <version>${httpclient.version}</version>\n       </dependency>\n       \n-      <dependency>\n-        <groupId>org.apache.tika</groupId>\n-        <artifactId>tika-core</artifactId>\n-        <version>${tika.version}</version>\n-      </dependency>\n-\n       <dependency>\n         <groupId>org.netbeans.api</groupId>\n         <artifactId>org-netbeans-api-annotations-common</artifactId>\n@@ -2241,7 +2241,7 @@ under the License.\n             <link>https://commons.apache.org/proper/commons-lang/javadocs/api-release/</link>\n             <link>https://commons.apache.org/proper/commons-io/javadocs/api-2.6/</link>\n             <link>https://commons.apache.org/proper/commons-jexl/apidocs/</link>\n-            <link>http://docs.spring.io/spring/docs/5.0.x/javadoc-api/</link>\n+            <link>https://tika.apache.org/1.17/api/</link>\n             <link>http://docs.spring.io/spring-security/site/docs/4.2.x/apidocs/</link>\n             <link>http://www.flowable.org/docs/javadocs/</link>\n             <link>https://build.shibboleth.net/nexus/content/sites/site/java-opensaml/3.3.0/apidocs/</link>"}]}