{"sha":"436b05479e0b584fce1bd9ae7c7a8a10cf46c3a2","node_id":"MDY6Q29tbWl0NjM2ODc5MDYyOjQzNmIwNTQ3OWUwYjU4NGZjZTFiZDlhZTdjN2E4YTEwY2Y0NmMzYTI=","commit":{"author":{"name":"Unknown","email":"unknown@apache.org","date":"2011-02-03T16:12:26Z"},"committer":{"name":"Unknown","email":"unknown@apache.org","date":"2011-02-03T16:12:26Z"},"message":"Small fixes on task execution workflow\n\ngit-svn-id: https://svn.apache.org/repos/asf/incubator/syncope/trunk@1246767 13f79535-47bb-0310-9956-ffa450edef68","tree":{"sha":"f7b1d7872be948d8ab63768c304b0424ebd2e583","url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/git/trees/f7b1d7872be948d8ab63768c304b0424ebd2e583"},"url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/git/commits/436b05479e0b584fce1bd9ae7c7a8a10cf46c3a2","comment_count":0,"verification":{"verified":false,"reason":"unsigned","signature":null,"payload":null}},"url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/436b05479e0b584fce1bd9ae7c7a8a10cf46c3a2","html_url":"https://github.com/EnricoDAlessandro97UNI/syncope/commit/436b05479e0b584fce1bd9ae7c7a8a10cf46c3a2","comments_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/436b05479e0b584fce1bd9ae7c7a8a10cf46c3a2/comments","author":null,"committer":null,"parents":[{"sha":"14c89a0cc00308adfc0a988413a1a44b77eecce3","url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/14c89a0cc00308adfc0a988413a1a44b77eecce3","html_url":"https://github.com/EnricoDAlessandro97UNI/syncope/commit/14c89a0cc00308adfc0a988413a1a44b77eecce3"}],"stats":{"total":54,"additions":31,"deletions":23},"files":[{"sha":"fef8975a7764e737af9a698cecfda458fefb6e61","filename":"core/src/main/java/org/syncope/core/rest/controller/TaskController.java","status":"modified","additions":8,"deletions":2,"changes":10,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/436b05479e0b584fce1bd9ae7c7a8a10cf46c3a2/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fcore%2Frest%2Fcontroller%2FTaskController.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/436b05479e0b584fce1bd9ae7c7a8a10cf46c3a2/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fcore%2Frest%2Fcontroller%2FTaskController.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fcore%2Frest%2Fcontroller%2FTaskController.java?ref=436b05479e0b584fce1bd9ae7c7a8a10cf46c3a2","patch":"@@ -239,7 +239,7 @@ public void delete(@PathVariable(\"taskId\") Long taskId)\n         for (TaskExecution execution : task.getExecutions()) {\n             wfActions = workflow.getAvailableActions(\n                     execution.getWorkflowId(), null);\n-            if (wfActions != null && wfActions.length > 0) {\n+            if (wfActions != null && wfActions.length > 1) {\n                 incompleteTaskExecution.addElement(\n                         execution.getId().toString());\n             }\n@@ -252,6 +252,12 @@ public void delete(@PathVariable(\"taskId\") Long taskId)\n             throw scce;\n         }\n \n+        for (TaskExecution execution : task.getExecutions()) {\n+            if (execution.getWorkflowId() != null) {\n+                workflowEntryDAO.delete(execution.getWorkflowId());\n+            }\n+        }\n+\n         taskDAO.delete(task);\n     }\n \n@@ -268,7 +274,7 @@ public void deleteExecution(@PathVariable(\"executionId\") Long executionId)\n \n         int[] wfActions = workflow.getAvailableActions(\n                 execution.getWorkflowId(), null);\n-        if (wfActions != null && wfActions.length > 0) {\n+        if (wfActions != null && wfActions.length > 1) {\n             SyncopeClientException incompleteTaskExecution =\n                     new SyncopeClientException(\n                     SyncopeClientExceptionType.IncompleteTaskExecution);"},{"sha":"ae30b74ae9ae7265818a0cf1122a3f344dee1eb5","filename":"core/src/main/java/org/syncope/core/workflow/WFUtils.java","status":"modified","additions":1,"deletions":18,"changes":19,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/436b05479e0b584fce1bd9ae7c7a8a10cf46c3a2/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fcore%2Fworkflow%2FWFUtils.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/436b05479e0b584fce1bd9ae7c7a8a10cf46c3a2/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fcore%2Fworkflow%2FWFUtils.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fcore%2Fworkflow%2FWFUtils.java?ref=436b05479e0b584fce1bd9ae7c7a8a10cf46c3a2","patch":"@@ -101,34 +101,17 @@ public static TaskExecutionStatus getTaskExecutionStatus(\n             final Workflow workflow,\n             final TaskExecution execution) {\n \n-        TaskExecutionStatus result;\n+        TaskExecutionStatus result = TaskExecutionStatus.FAILURE;\n \n         try {\n             List<Step> steps =\n                     workflow.getCurrentSteps(execution.getWorkflowId());\n             if (steps != null && !steps.isEmpty()) {\n                 result = TaskExecutionStatus.valueOf(\n                         steps.iterator().next().getStatus());\n-            } else {\n-                steps = workflow.getHistorySteps(execution.getWorkflowId());\n-                Step newestStep = steps.get(0);\n-                if (steps.size() > 1) {\n-                    for (int i = 1; i < steps.size(); i++) {\n-                        if (newestStep.getFinishDate().getTime()\n-                                < steps.get(i).getFinishDate().getTime()) {\n-\n-                            newestStep = steps.get(i);\n-                        }\n-                    }\n-                }\n-\n-                result = TaskExecutionStatus.valueOf(\n-                        newestStep.getStatus());\n             }\n         } catch (Throwable t) {\n             LOG.error(\"While getting status of {}\", execution, t);\n-\n-            result = TaskExecutionStatus.FAILURE;\n         }\n \n         return result;"},{"sha":"fb52acc22f1ebdc7ecb6ab0fd4b8c5a7af8dfd4f","filename":"core/src/main/resources/taskExecutionWorkflow.xml","status":"modified","additions":22,"deletions":3,"changes":25,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/436b05479e0b584fce1bd9ae7c7a8a10cf46c3a2/core%2Fsrc%2Fmain%2Fresources%2FtaskExecutionWorkflow.xml","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/436b05479e0b584fce1bd9ae7c7a8a10cf46c3a2/core%2Fsrc%2Fmain%2Fresources%2FtaskExecutionWorkflow.xml","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fsrc%2Fmain%2Fresources%2FtaskExecutionWorkflow.xml?ref=436b05479e0b584fce1bd9ae7c7a8a10cf46c3a2","patch":"@@ -21,6 +21,13 @@\n             </results>\n         </action>\n     </initial-actions>\n+    <common-actions>\n+        <action name=\"useless\" id=\"100\">\n+            <results>\n+                <unconditional-result old-status=\"n/a\" status=\"CREATED\" step=\"1\"/>\n+            </results>\n+        </action>\n+    </common-actions>\n     <steps>\n         <step name=\"CREATED\" id=\"1\">\n             <actions>\n@@ -66,11 +73,23 @@\n             </actions>\n         </step>\n \n-        <step name=\"UNSUBMITTED\" id=\"3\"/>\n+        <step name=\"UNSUBMITTED\" id=\"3\">\n+            <actions>\n+                <common-action id=\"100\"/>\n+            </actions>\n+        </step>\n \n-        <step name=\"SUCCESS\" id=\"4\"/>\n+        <step name=\"SUCCESS\" id=\"4\">\n+            <actions>\n+                <common-action id=\"100\"/>\n+            </actions>\n+        </step>\n \n-        <step name=\"FAILURE\" id=\"5\"/>\n+        <step name=\"FAILURE\" id=\"5\">\n+            <actions>\n+                <common-action id=\"100\"/>\n+            </actions>\n+        </step>\n \n     </steps>\n "}]}