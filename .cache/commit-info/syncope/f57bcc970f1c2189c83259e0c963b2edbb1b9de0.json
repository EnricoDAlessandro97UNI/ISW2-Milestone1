{"sha":"f57bcc970f1c2189c83259e0c963b2edbb1b9de0","node_id":"MDY6Q29tbWl0NjM2ODc5MDYyOmY1N2JjYzk3MGYxYzIxODljODMyNTllMGM5NjNiMmVkYmIxYjlkZTA=","commit":{"author":{"name":"Francesco Chicchiriccò","email":"ilgrosso@apache.org","date":"2014-07-07T09:41:20Z"},"committer":{"name":"Francesco Chicchiriccò","email":"ilgrosso@apache.org","date":"2014-07-07T09:41:20Z"},"message":"Merge from 1_2_X\n\ngit-svn-id: https://svn.apache.org/repos/asf/syncope/trunk@1608388 13f79535-47bb-0310-9956-ffa450edef68","tree":{"sha":"3f9b6fc04daff3fdac6e84621ef9e9147566ad21","url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/git/trees/3f9b6fc04daff3fdac6e84621ef9e9147566ad21"},"url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/git/commits/f57bcc970f1c2189c83259e0c963b2edbb1b9de0","comment_count":0,"verification":{"verified":false,"reason":"unsigned","signature":null,"payload":null}},"url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/f57bcc970f1c2189c83259e0c963b2edbb1b9de0","html_url":"https://github.com/EnricoDAlessandro97UNI/syncope/commit/f57bcc970f1c2189c83259e0c963b2edbb1b9de0","comments_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/f57bcc970f1c2189c83259e0c963b2edbb1b9de0/comments","author":{"login":"ilgrosso","id":1064664,"node_id":"MDQ6VXNlcjEwNjQ2NjQ=","avatar_url":"https://avatars.githubusercontent.com/u/1064664?v=4","gravatar_id":"","url":"https://api.github.com/users/ilgrosso","html_url":"https://github.com/ilgrosso","followers_url":"https://api.github.com/users/ilgrosso/followers","following_url":"https://api.github.com/users/ilgrosso/following{/other_user}","gists_url":"https://api.github.com/users/ilgrosso/gists{/gist_id}","starred_url":"https://api.github.com/users/ilgrosso/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ilgrosso/subscriptions","organizations_url":"https://api.github.com/users/ilgrosso/orgs","repos_url":"https://api.github.com/users/ilgrosso/repos","events_url":"https://api.github.com/users/ilgrosso/events{/privacy}","received_events_url":"https://api.github.com/users/ilgrosso/received_events","type":"User","site_admin":false},"committer":{"login":"ilgrosso","id":1064664,"node_id":"MDQ6VXNlcjEwNjQ2NjQ=","avatar_url":"https://avatars.githubusercontent.com/u/1064664?v=4","gravatar_id":"","url":"https://api.github.com/users/ilgrosso","html_url":"https://github.com/ilgrosso","followers_url":"https://api.github.com/users/ilgrosso/followers","following_url":"https://api.github.com/users/ilgrosso/following{/other_user}","gists_url":"https://api.github.com/users/ilgrosso/gists{/gist_id}","starred_url":"https://api.github.com/users/ilgrosso/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ilgrosso/subscriptions","organizations_url":"https://api.github.com/users/ilgrosso/orgs","repos_url":"https://api.github.com/users/ilgrosso/repos","events_url":"https://api.github.com/users/ilgrosso/events{/privacy}","received_events_url":"https://api.github.com/users/ilgrosso/received_events","type":"User","site_admin":false},"parents":[{"sha":"736f0e17429104e89cfd23f0491a82611d4a2926","url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/736f0e17429104e89cfd23f0491a82611d4a2926","html_url":"https://github.com/EnricoDAlessandro97UNI/syncope/commit/736f0e17429104e89cfd23f0491a82611d4a2926"},{"sha":"04d3aa3af4b110843ec06ded7656bf578ee54064","url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/04d3aa3af4b110843ec06ded7656bf578ee54064","html_url":"https://github.com/EnricoDAlessandro97UNI/syncope/commit/04d3aa3af4b110843ec06ded7656bf578ee54064"}],"stats":{"total":111,"additions":69,"deletions":42},"files":[{"sha":"468917eb753fd72e7e6cd9da2963c29519689567","filename":"CHANGES","status":"modified","additions":20,"deletions":0,"changes":20,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/f57bcc970f1c2189c83259e0c963b2edbb1b9de0/CHANGES","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/f57bcc970f1c2189c83259e0c963b2edbb1b9de0/CHANGES","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/CHANGES?ref=f57bcc970f1c2189c83259e0c963b2edbb1b9de0","patch":"@@ -2,10 +2,30 @@ Apache Syncope - CHANGES\n Licensed under Apache License 2.0 - http://www.apache.org/licenses/LICENSE-2.0\n --------------------------------------------------------------------------------\n \n+Release Notes - Syncope - Version 1.1.8\n+================================================================================\n+** Bug\n+    * [SYNCOPE-499] - Deletion of role set as parent role in template generates exception\n+    * [SYNCOPE-500] - Wrong (unwanted) derived attribute insertion addition in membership modal page\n+    * [SYNCOPE-501] - Virtual attribute propagation not working when updating only virtual attributes\n+    * [SYNCOPE-504] - Sync/Push actions shouldn't be executed in dryrun\n+    * [SYNCOPE-509] - In Task page after change of number of rows (to display) is erroneously added a column to tasks table\n+    * [SYNCOPE-512] - If there are no roles in edit user modal page is possible to create membership between root (fake) role and user\n+    * [SYNCOPE-515] - Bad integration test causes role ownership conflicts\n+\n+** Improvement\n+    * [SYNCOPE-485] - Upgrade to Activiti 5.15.1\n+    * [SYNCOPE-486] - Update Selenium test configuration\n+    * [SYNCOPE-507] - User login date conditional logging\n+    * [SYNCOPE-511] - Enhance synchronization report information\n+    * [SYNCOPE-519] - Report default values for connector properties\n+    * [SYNCOPE-520] - Move reset sync token to resource actions\n+\n Release Notes - Syncope - Version 1.1.7\n ================================================================================\n ** Bug\n     * [SYNCOPE-484] - Reports and Content export fails over HTTPS connection\n+\n ** Improvement\n     * [SYNCOPE-487] - make Velocity tools available in templates for notifications\n "},{"sha":"75124c938cfaf449e96c736209280892f7e039ea","filename":"core/src/main/java/org/apache/syncope/core/security/SyncopeAuthenticationProvider.java","status":"modified","additions":29,"deletions":22,"changes":51,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/f57bcc970f1c2189c83259e0c963b2edbb1b9de0/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fsecurity%2FSyncopeAuthenticationProvider.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/f57bcc970f1c2189c83259e0c963b2edbb1b9de0/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fsecurity%2FSyncopeAuthenticationProvider.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fsecurity%2FSyncopeAuthenticationProvider.java?ref=f57bcc970f1c2189c83259e0c963b2edbb1b9de0","patch":"@@ -22,9 +22,7 @@\n import java.util.Date;\n import java.util.Iterator;\n import java.util.Set;\n-\n import javax.annotation.Resource;\n-\n import org.apache.syncope.common.types.AttributableType;\n import org.apache.syncope.common.types.AuditElements;\n import org.apache.syncope.common.types.AuditElements.Result;\n@@ -144,18 +142,17 @@ public Authentication authenticate(final Authentication authentication)\n                 }\n \n                 CAttr authStatuses = confDAO.find(\"authentication.statuses\");\n-                if (authStatuses != null) {\n-                    if (!authStatuses.getValuesAsStrings().contains(user.getStatus())) {\n-                        throw new DisabledException(\"User \" + user.getUsername() + \" not allowed to authenticate\");\n-                    }\n+                if (authStatuses != null && !authStatuses.getValuesAsStrings().contains(user.getStatus())) {\n+                    throw new DisabledException(\"User \" + user.getUsername() + \" not allowed to authenticate\");\n                 }\n \n                 authenticated = authenticate(user, authentication.getCredentials().toString());\n+\n+                updateLoginAttributes(user, authenticated);\n             }\n         }\n \n         UsernamePasswordAuthenticationToken token;\n-\n         if (authenticated) {\n             token = new UsernamePasswordAuthenticationToken(\n                     authentication.getPrincipal(),\n@@ -177,20 +174,7 @@ public Authentication authenticate(final Authentication authentication)\n \n             LOG.debug(\"User {} successfully authenticated, with roles {}\",\n                     authentication.getPrincipal(), token.getAuthorities());\n-\n-            if (user != null && confDAO.find(\"log.lastlogindate\", Boolean.toString(true)).\n-                    getValues().get(0).getBooleanValue()) {\n-\n-                user.setLastLoginDate(new Date());\n-                user.setFailedLogins(0);\n-                userDAO.save(user);\n-            }\n         } else {\n-            if (user != null) {\n-                user.setFailedLogins(user.getFailedLogins() + 1);\n-                userDAO.save(user);\n-            }\n-\n             auditManager.audit(\n                     AuditElements.EventCategoryType.REST,\n                     \"AuthenticationController\",\n@@ -210,6 +194,29 @@ public Authentication authenticate(final Authentication authentication)\n         return token;\n     }\n \n+    private void updateLoginAttributes(SyncopeUser user, boolean authenticated) {\n+        boolean userModified = false;\n+\n+        if (authenticated) {\n+            if (confDAO.find(\"log.lastlogindate\", Boolean.toString(true)).getValues().get(0).getBooleanValue()) {\n+                user.setLastLoginDate(new Date());\n+                userModified = true;\n+            }\n+\n+            if (user.getFailedLogins() != 0) {\n+                user.setFailedLogins(0);\n+                userModified = true;\n+            }\n+        } else {\n+            user.setFailedLogins(user.getFailedLogins() + 1);\n+            userModified = true;\n+        }\n+\n+        if (userModified) {\n+            userDAO.save(user);\n+        }\n+    }\n+\n     protected Set<ExternalResource> getPassthroughResources(final SyncopeUser user) {\n         Set<ExternalResource> result = null;\n \n@@ -244,7 +251,7 @@ protected Set<ExternalResource> getPassthroughResources(final SyncopeUser user)\n                 result.retainAll(global.getResources());\n             }\n         }\n-        \n+\n         if (result == null) {\n             result = Collections.emptySet();\n         }\n@@ -259,7 +266,7 @@ protected boolean authenticate(final SyncopeUser user, final String password) {\n         final AttributableUtil attrUtil = AttributableUtil.getInstance(AttributableType.USER);\n         for (Iterator<ExternalResource> itor = getPassthroughResources(user).iterator();\n                 itor.hasNext() && !authenticated;) {\n-            \n+\n             ExternalResource resource = itor.next();\n             String accountId = null;\n             try {"},{"sha":"dc75efee440381b4f45371e8925ffb6afd657bdf","filename":"src/site/xdoc/downloads.xml","status":"modified","additions":20,"deletions":20,"changes":40,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/f57bcc970f1c2189c83259e0c963b2edbb1b9de0/src%2Fsite%2Fxdoc%2Fdownloads.xml","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/f57bcc970f1c2189c83259e0c963b2edbb1b9de0/src%2Fsite%2Fxdoc%2Fdownloads.xml","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/src%2Fsite%2Fxdoc%2Fdownloads.xml?ref=f57bcc970f1c2189c83259e0c963b2edbb1b9de0","patch":"@@ -57,8 +57,8 @@ under the License.\n     </section>\n \n     <section name=\"Current Releases\">\n-      <subsection name=\"1.1.7 Ad libitum\">\n-        <p>Release date: Apr 11th, 2014</p>\n+      <subsection name=\"1.1.8 Ad libitum\">\n+        <p>Release date: Jul 3rd, 2014</p>\n         <p>\n           <a href=\"https://cwiki.apache.org/confluence/display/SYNCOPE/Ad+libitum\">Release notes</a>\n         </p>\n@@ -72,22 +72,22 @@ under the License.\n           <tbody>\n             <tr>\n               <td>\n-                <a href=\"http://www.apache.org/dyn/closer.cgi/syncope/1.1.7/syncope-1.1.7-source-release.zip\">syncope-1.1.7-source-release.zip</a>\n+                <a href=\"http://www.apache.org/dyn/closer.cgi/syncope/1.1.8/syncope-1.1.8-source-release.zip\">syncope-1.1.8-source-release.zip</a>\n               </td>\n               <td>\n-                <a href=\"http://www.apache.org/dist/syncope/1.1.7/syncope-1.1.7-source-release.zip.asc\">asc</a> \n-                <a href=\"http://www.apache.org/dist/syncope/1.1.7/syncope-1.1.7-source-release.zip.md5\">md5</a> \n-                <a href=\"http://www.apache.org/dist/syncope/1.1.7/syncope-1.1.7-source-release.zip.sha1\">sha1</a>\n+                <a href=\"http://www.apache.org/dist/syncope/1.1.8/syncope-1.1.8-source-release.zip.asc\">asc</a> \n+                <a href=\"http://www.apache.org/dist/syncope/1.1.8/syncope-1.1.8-source-release.zip.md5\">md5</a> \n+                <a href=\"http://www.apache.org/dist/syncope/1.1.8/syncope-1.1.8-source-release.zip.sha1\">sha1</a>\n               </td>\n             </tr>\n             <tr>\n               <td>\n-                <a href=\"http://www.apache.org/dyn/closer.cgi/syncope/1.1.7/syncope-standalone-1.1.7-distribution.zip\">syncope-standalone-1.1.7-distribution.zip</a>\n+                <a href=\"http://www.apache.org/dyn/closer.cgi/syncope/1.1.8/syncope-standalone-1.1.8-distribution.zip\">syncope-standalone-1.1.8-distribution.zip</a>\n               </td>\n               <td>\n-                <a href=\"http://www.apache.org/dist/syncope/1.1.7/syncope-standalone-1.1.7-distribution.zip.asc\">asc</a> \n-                <a href=\"http://www.apache.org/dist/syncope/1.1.7/syncope-standalone-1.1.7-distribution.zip.md5\">md5</a> \n-                <a href=\"http://www.apache.org/dist/syncope/1.1.7/syncope-standalone-1.1.7-distribution.zip.sha1\">sha1</a>\n+                <a href=\"http://www.apache.org/dist/syncope/1.1.8/syncope-standalone-1.1.8-distribution.zip.asc\">asc</a> \n+                <a href=\"http://www.apache.org/dist/syncope/1.1.8/syncope-standalone-1.1.8-distribution.zip.md5\">md5</a> \n+                <a href=\"http://www.apache.org/dist/syncope/1.1.8/syncope-standalone-1.1.8-distribution.zip.sha1\">sha1</a>\n               </td>\n             </tr>\n           </tbody>\n@@ -122,8 +122,8 @@ under the License.\n     </section>\n \n     <section name=\"Older Releases\">\n-      <subsection name=\"1.1.6 Ad libitum\">\n-        <p>Release date: Feb 22nd, 2014</p>\n+      <subsection name=\"1.1.7 Ad libitum\">\n+        <p>Release date: Apr 11th, 2014</p>\n         <p>\n           <a href=\"https://cwiki.apache.org/confluence/display/SYNCOPE/Ad+libitum\">Release notes</a>\n         </p>\n@@ -137,22 +137,22 @@ under the License.\n           <tbody>\n             <tr>\n               <td>\n-                <a href=\"http://archive.apache.org/dist/syncope/1.1.6/syncope-1.1.6-source-release.zip\">syncope-1.1.6-source-release.zip</a>\n+                <a href=\"http://archive.apache.org/dist/syncope/1.1.7/syncope-1.1.7-source-release.zip\">syncope-1.1.7-source-release.zip</a>\n               </td>\n               <td>\n-                <a href=\"http://archive.apache.org/dist/syncope/1.1.6/syncope-1.1.6-source-release.zip.asc\">asc</a> \n-                <a href=\"http://archive.apache.org/dist/syncope/1.1.6/syncope-1.1.6-source-release.zip.md5\">md5</a> \n-                <a href=\"http://archive.apache.org/dist/syncope/1.1.6/syncope-1.1.6-source-release.zip.sha1\">sha1</a>\n+                <a href=\"http://archive.apache.org/dist/syncope/1.1.7/syncope-1.1.7-source-release.zip.asc\">asc</a> \n+                <a href=\"http://archive.apache.org/dist/syncope/1.1.7/syncope-1.1.7-source-release.zip.md5\">md5</a> \n+                <a href=\"http://archive.apache.org/dist/syncope/1.1.7/syncope-1.1.7-source-release.zip.sha1\">sha1</a>\n               </td>\n             </tr>\n             <tr>\n               <td>\n-                <a href=\"http://archive.apache.org/dist/syncope/1.1.6/syncope-standalone-1.1.6-distribution.zip\">syncope-standalone-1.1.6-distribution.zip</a>\n+                <a href=\"http://archive.apache.org/dist/syncope/1.1.7/syncope-standalone-1.1.7-distribution.zip\">syncope-standalone-1.1.7-distribution.zip</a>\n               </td>\n               <td>\n-                <a href=\"http://archive.apache.org/dist/syncope/1.1.6/syncope-standalone-1.1.6-distribution.zip.asc\">asc</a> \n-                <a href=\"http://archive.apache.org/dist/syncope/1.1.6/syncope-standalone-1.1.6-distribution.zip.md5\">md5</a> \n-                <a href=\"http://archive.apache.org/dist/syncope/1.1.6/syncope-standalone-1.1.6-distribution.zip.sha1\">sha1</a>\n+                <a href=\"http://archive.apache.org/dist/syncope/1.1.7/syncope-standalone-1.1.7-distribution.zip.asc\">asc</a> \n+                <a href=\"http://archive.apache.org/dist/syncope/1.1.7/syncope-standalone-1.1.7-distribution.zip.md5\">md5</a> \n+                <a href=\"http://archive.apache.org/dist/syncope/1.1.7/syncope-standalone-1.1.7-distribution.zip.sha1\">sha1</a>\n               </td>\n             </tr>\n           </tbody>"}]}