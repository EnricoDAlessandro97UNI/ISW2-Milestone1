{"sha":"2191c595f5a7a42e26e7658c80d959f0cb9af330","node_id":"MDY6Q29tbWl0NjM2ODc5MDYyOjIxOTFjNTk1ZjVhN2E0MmUyNmU3NjU4YzgwZDk1OWYwY2I5YWYzMzA=","commit":{"author":{"name":"Nicola Scendoni","email":"scendoni@gmail.com","date":"2016-06-23T10:45:11Z"},"committer":{"name":"Francesco Chicchiricc√≤","email":"ilgrosso@apache.org","date":"2016-09-05T10:10:28Z"},"message":"[SYNCOPE-880] Identity Recertification","tree":{"sha":"7051bce7ac61ab4d5f84190d34bef38b42368eaf","url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/git/trees/7051bce7ac61ab4d5f84190d34bef38b42368eaf"},"url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/git/commits/2191c595f5a7a42e26e7658c80d959f0cb9af330","comment_count":0,"verification":{"verified":false,"reason":"unsigned","signature":null,"payload":null}},"url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/2191c595f5a7a42e26e7658c80d959f0cb9af330","html_url":"https://github.com/EnricoDAlessandro97UNI/syncope/commit/2191c595f5a7a42e26e7658c80d959f0cb9af330","comments_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/2191c595f5a7a42e26e7658c80d959f0cb9af330/comments","author":{"login":"nscendoni","id":7288042,"node_id":"MDQ6VXNlcjcyODgwNDI=","avatar_url":"https://avatars.githubusercontent.com/u/7288042?v=4","gravatar_id":"","url":"https://api.github.com/users/nscendoni","html_url":"https://github.com/nscendoni","followers_url":"https://api.github.com/users/nscendoni/followers","following_url":"https://api.github.com/users/nscendoni/following{/other_user}","gists_url":"https://api.github.com/users/nscendoni/gists{/gist_id}","starred_url":"https://api.github.com/users/nscendoni/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nscendoni/subscriptions","organizations_url":"https://api.github.com/users/nscendoni/orgs","repos_url":"https://api.github.com/users/nscendoni/repos","events_url":"https://api.github.com/users/nscendoni/events{/privacy}","received_events_url":"https://api.github.com/users/nscendoni/received_events","type":"User","site_admin":false},"committer":{"login":"ilgrosso","id":1064664,"node_id":"MDQ6VXNlcjEwNjQ2NjQ=","avatar_url":"https://avatars.githubusercontent.com/u/1064664?v=4","gravatar_id":"","url":"https://api.github.com/users/ilgrosso","html_url":"https://github.com/ilgrosso","followers_url":"https://api.github.com/users/ilgrosso/followers","following_url":"https://api.github.com/users/ilgrosso/following{/other_user}","gists_url":"https://api.github.com/users/ilgrosso/gists{/gist_id}","starred_url":"https://api.github.com/users/ilgrosso/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ilgrosso/subscriptions","organizations_url":"https://api.github.com/users/ilgrosso/orgs","repos_url":"https://api.github.com/users/ilgrosso/repos","events_url":"https://api.github.com/users/ilgrosso/events{/privacy}","received_events_url":"https://api.github.com/users/ilgrosso/received_events","type":"User","site_admin":false},"parents":[{"sha":"a99618d944d27e22b6ee57fd41807613aee0563e","url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/a99618d944d27e22b6ee57fd41807613aee0563e","html_url":"https://github.com/EnricoDAlessandro97UNI/syncope/commit/a99618d944d27e22b6ee57fd41807613aee0563e"}],"stats":{"total":481,"additions":473,"deletions":8},"files":[{"sha":"d3259e7c73c69cfe55dc35d10766b2acddaa2e0e","filename":"core/persistence-api/src/main/java/org/apache/syncope/core/persistence/api/entity/user/User.java","status":"modified","additions":8,"deletions":0,"changes":8,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/2191c595f5a7a42e26e7658c80d959f0cb9af330/core%2Fpersistence-api%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fpersistence%2Fapi%2Fentity%2Fuser%2FUser.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/2191c595f5a7a42e26e7658c80d959f0cb9af330/core%2Fpersistence-api%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fpersistence%2Fapi%2Fentity%2Fuser%2FUser.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fpersistence-api%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fpersistence%2Fapi%2Fentity%2Fuser%2FUser.java?ref=2191c595f5a7a42e26e7658c80d959f0cb9af330","patch":"@@ -96,4 +96,12 @@ public interface User extends\n \n     List<? extends Role> getRoles();\n \n+    String getLastRecertificator();\n+\n+    void setLastRecertificator(String lastRecertificator);\n+\n+    Date getLastRecertification();\n+\n+    void setLastRecertification(Date lastRecertificion);\n+\n }"},{"sha":"1cb4d86eb5af7d57bc5a0821f184c744dc0983f9","filename":"core/persistence-jpa/src/main/java/org/apache/syncope/core/persistence/jpa/entity/user/JPAUser.java","status":"modified","additions":30,"deletions":0,"changes":30,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/2191c595f5a7a42e26e7658c80d959f0cb9af330/core%2Fpersistence-jpa%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fpersistence%2Fjpa%2Fentity%2Fuser%2FJPAUser.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/2191c595f5a7a42e26e7658c80d959f0cb9af330/core%2Fpersistence-jpa%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fpersistence%2Fjpa%2Fentity%2Fuser%2FJPAUser.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fpersistence-jpa%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fpersistence%2Fjpa%2Fentity%2Fuser%2FJPAUser.java?ref=2191c595f5a7a42e26e7658c80d959f0cb9af330","patch":"@@ -136,6 +136,7 @@\n     @Temporal(TemporalType.TIMESTAMP)\n     private Date lastLoginDate;\n \n+ \n     /**\n      * Change password date.\n      */\n@@ -184,6 +185,14 @@\n     @Column(nullable = true)\n     private String securityAnswer;\n \n+    @Column(nullable = true)\n+    private String lastRecertificator;\n+\n+    @Column(nullable = true)\n+    @Temporal(TemporalType.TIMESTAMP)\n+    private Date lastRecertification;\n+\n+    \n     @Override\n     public AnyType getType() {\n         return ApplicationContextProvider.getBeanFactory().getBean(AnyTypeDAO.class).findUser();\n@@ -489,4 +498,25 @@ public boolean add(final UMembership membership) {\n     public List<? extends UMembership> getMemberships() {\n         return memberships;\n     }\n+\n+    @Override\n+    public String getLastRecertificator() {\n+        return lastRecertificator;\n+    }\n+\n+    @Override\n+    public void setLastRecertificator(final String lastRecertificator) {\n+        this.lastRecertificator = lastRecertificator;\n+    }\n+\n+    @Override\n+    public Date getLastRecertification() {\n+        return lastRecertification;\n+    }\n+\n+    @Override\n+    public void setLastRecertification(final Date lastRecertification) {\n+        this.lastRecertification = lastRecertification;\n+    }\n+\n }"},{"sha":"e730aed1d2c4c0b72d08b2cfed19f53275afed56","filename":"core/persistence-jpa/src/main/resources/domains/MasterContent.xml","status":"modified","additions":3,"deletions":0,"changes":3,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/2191c595f5a7a42e26e7658c80d959f0cb9af330/core%2Fpersistence-jpa%2Fsrc%2Fmain%2Fresources%2Fdomains%2FMasterContent.xml","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/2191c595f5a7a42e26e7658c80d959f0cb9af330/core%2Fpersistence-jpa%2Fsrc%2Fmain%2Fresources%2Fdomains%2FMasterContent.xml","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fpersistence-jpa%2Fsrc%2Fmain%2Fresources%2Fdomains%2FMasterContent.xml?ref=2191c595f5a7a42e26e7658c80d959f0cb9af330","patch":"@@ -138,6 +138,9 @@ under the License.\n   <PlainSchema id=\"email\" type=\"String\" anyTypeClass_id=\"BaseUser\"\n                mandatoryCondition=\"false\" multivalue=\"0\" uniqueConstraint=\"0\" readonly=\"0\"\n                validatorClass=\"org.apache.syncope.core.persistence.jpa.attrvalue.validation.EmailAddressValidator\"/>\n+\n+  <Task DTYPE=\"SchedTask\" id=\"e95555d2-1b09-42c8-b25b-f4c4ec598989\" name=\"Identity Recertification Task\"  active=\"1\"\n+        jobDelegateClassName=\"org.apache.syncope.core.provisioning.java.job.IdentityRecertification\" cronExpression=\"0 0 0 0 0 0\"/>\n   \n   <!-- Password reset notifications -->\n   <MailTemplate id=\"requestPasswordReset\""},{"sha":"918f9fcbaf7e2be3e47797d434eec6537f247ebc","filename":"core/persistence-jpa/src/test/java/org/apache/syncope/core/persistence/jpa/inner/PlainSchemaTest.java","status":"modified","additions":1,"deletions":1,"changes":2,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/2191c595f5a7a42e26e7658c80d959f0cb9af330/core%2Fpersistence-jpa%2Fsrc%2Ftest%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fpersistence%2Fjpa%2Finner%2FPlainSchemaTest.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/2191c595f5a7a42e26e7658c80d959f0cb9af330/core%2Fpersistence-jpa%2Fsrc%2Ftest%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fpersistence%2Fjpa%2Finner%2FPlainSchemaTest.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fpersistence-jpa%2Fsrc%2Ftest%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fpersistence%2Fjpa%2Finner%2FPlainSchemaTest.java?ref=2191c595f5a7a42e26e7658c80d959f0cb9af330","patch":"@@ -47,7 +47,7 @@ public class PlainSchemaTest extends AbstractTest {\n     @Test\n     public void findAll() {\n         List<PlainSchema> schemas = plainSchemaDAO.findAll();\n-        assertEquals(38, schemas.size());\n+        assertEquals(39, schemas.size());\n     }\n \n     @Test"},{"sha":"c77b312cfc7fe1e1e4064741c73e2061133c3509","filename":"core/persistence-jpa/src/test/java/org/apache/syncope/core/persistence/jpa/inner/TaskTest.java","status":"modified","additions":1,"deletions":1,"changes":2,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/2191c595f5a7a42e26e7658c80d959f0cb9af330/core%2Fpersistence-jpa%2Fsrc%2Ftest%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fpersistence%2Fjpa%2Finner%2FTaskTest.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/2191c595f5a7a42e26e7658c80d959f0cb9af330/core%2Fpersistence-jpa%2Fsrc%2Ftest%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fpersistence%2Fjpa%2Finner%2FTaskTest.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fpersistence-jpa%2Fsrc%2Ftest%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fpersistence%2Fjpa%2Finner%2FTaskTest.java?ref=2191c595f5a7a42e26e7658c80d959f0cb9af330","patch":"@@ -97,7 +97,7 @@ public void findPaginated() {\n     public void findAll() {\n         assertEquals(5, taskDAO.findAll(TaskType.PROPAGATION).size());\n         assertEquals(1, taskDAO.findAll(TaskType.NOTIFICATION).size());\n-        assertEquals(1, taskDAO.findAll(TaskType.SCHEDULED).size());\n+        assertEquals(2, taskDAO.findAll(TaskType.SCHEDULED).size());\n         assertEquals(10, taskDAO.findAll(TaskType.PULL).size());\n         assertEquals(11, taskDAO.findAll(TaskType.PUSH).size());\n     }"},{"sha":"1fae96be144e1d7839bf549de24e7c817416734e","filename":"core/persistence-jpa/src/test/resources/domains/MasterContent.xml","status":"modified","additions":12,"deletions":1,"changes":13,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/2191c595f5a7a42e26e7658c80d959f0cb9af330/core%2Fpersistence-jpa%2Fsrc%2Ftest%2Fresources%2Fdomains%2FMasterContent.xml","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/2191c595f5a7a42e26e7658c80d959f0cb9af330/core%2Fpersistence-jpa%2Fsrc%2Ftest%2Fresources%2Fdomains%2FMasterContent.xml","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fpersistence-jpa%2Fsrc%2Ftest%2Fresources%2Fdomains%2FMasterContent.xml?ref=2191c595f5a7a42e26e7658c80d959f0cb9af330","patch":"@@ -125,6 +125,15 @@ under the License.\n   <CPlainAttrValue id=\"e5fa94db-b524-4309-908d-8198d0b3f779\"\n                    attribute_id=\"bcfd7efc-0605-4b5e-b4bb-85c1d5f6493a\" booleanValue=\"0\"/>\n   \n+  <!-- Identity Recertification interval in days -->                   \n+  <SyncopeSchema id=\"identity.recertification.day.interval\"/>\n+  <PlainSchema id=\"identity.recertification.day.interval\" type=\"Long\"\n+               mandatoryCondition=\"false\" multivalue=\"0\" uniqueConstraint=\"0\" readonly=\"0\"/>\n+  <CPlainAttr id=\"bcfd7efc-0605-4b5e-b4bb-85c1d5f64bbb\"\n+              owner_id=\"cd64d66f-6fff-4008-b966-a06b1cc1436d\" schema_id=\"identity.recertification.day.interval\"/>\n+  <CPlainAttrValue id=\"e5fa94db-b524-4309-908d-8198d0b3f77b\"\n+                   attribute_id=\"bcfd7efc-0605-4b5e-b4bb-85c1d5f64bbb\" longValue=\"365\"/>\n+    \n   <!-- sample policies -->\n   <PullPolicy id=\"66691e96-285f-4464-bc19-e68384ea4c85\" description=\"a pull policy\"\n               specification='{\"conflictResolutionAction\":\"IGNORE\"}'/>\n@@ -461,7 +470,7 @@ under the License.\n   <SyncopeSchema id=\"mderToBePropagated\"/>\n   <DerSchema id=\"mderToBePropagated\" expression=\"mderived_sx + '-' + mderived_dx\" \n              anyTypeClass_id=\"generic membership\"/>\n-        \n+         \n   <SyncopeSchema id=\"model\"/>\n   <PlainSchema id=\"model\" type=\"String\" anyTypeClass_id=\"minimal printer\"\n                mandatoryCondition=\"false\" multivalue=\"0\" uniqueConstraint=\"0\" readonly=\"0\"/>\n@@ -1052,6 +1061,8 @@ under the License.\n                        template='{\"@class\":\"org.apache.syncope.common.lib.to.GroupTO\",\"creator\":null,\"creationDate\":null,\"lastModifier\":null,\"lastChangeDate\":null,\"key\":null,\"type\":\"GROUP\",\"realm\":null,\"status\":null,\"name\":null,\"userOwner\":null,\"groupOwner\":null,\"udynMembershipCond\":null,\"auxClasses\":[],\"derAttrs\":[],\"virAttrs\":[],\"resources\":[],\"plainAttrs\":[]}'/>\n   <Task DTYPE=\"SchedTask\" id=\"e95555d2-1b09-42c8-b25b-f4c4ec597979\" name=\"SampleJob Task\"  active=\"1\"\n         jobDelegateClassName=\"org.apache.syncope.fit.core.reference.TestSampleJobDelegate\" cronExpression=\"0 0 0 1 * ?\"/>\n+  <Task DTYPE=\"SchedTask\" id=\"e95555d2-1b09-42c8-b25b-f4c4ec598989\" name=\"Identity Recertification Task\"  active=\"1\"\n+        jobDelegateClassName=\"org.apache.syncope.core.provisioning.java.job.IdentityRecertification\" cronExpression=\"0 0 0 1 * ?\"/>\n   <Task DTYPE=\"PropagationTask\" id=\"d6c2d6d3-6329-44c1-9187-f1469ead1cfa\" operation=\"UPDATE\"\n         objectClassName=\"__ACCOUNT__\" resource_id=\"ws-target-resource-nopropagation\" anyTypeKind=\"USER\" entityKey=\"1417acbe-cbf6-4277-9372-e75e04f97000\"\n         attributes='[{\"name\":\"__PASSWORD__\",\"value\":[{\"readOnly\":false,\"disposed\":false,\"encryptedBytes\":\"m9nh2US0Sa6m+cXccCq0Xw==\",\"base64SHA1Hash\":\"GFJ69qfjxEOdrmt+9q+0Cw2uz60=\"}]},{\"name\":\"__NAME__\",\"value\":[\"userId\"],\"nameValue\":\"userId\"},{\"name\":\"fullname\",\"value\":[\"fullname\"]},{\"name\":\"type\",\"value\":[\"type\"]}]'/>"},{"sha":"463495ec17507d40ce3ff817a558fd95979c3fe1","filename":"core/provisioning-java/src/main/java/org/apache/syncope/core/provisioning/java/job/IdentityRecertification.java","status":"added","additions":105,"deletions":0,"changes":105,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/2191c595f5a7a42e26e7658c80d959f0cb9af330/core%2Fprovisioning-java%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fprovisioning%2Fjava%2Fjob%2FIdentityRecertification.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/2191c595f5a7a42e26e7658c80d959f0cb9af330/core%2Fprovisioning-java%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fprovisioning%2Fjava%2Fjob%2FIdentityRecertification.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fprovisioning-java%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fprovisioning%2Fjava%2Fjob%2FIdentityRecertification.java?ref=2191c595f5a7a42e26e7658c80d959f0cb9af330","patch":"@@ -0,0 +1,105 @@\n+/*\r\n+ * Licensed to the Apache Software Foundation (ASF) under one\r\n+ * or more contributor license agreements.  See the NOTICE file\r\n+ * distributed with this work for additional information\r\n+ * regarding copyright ownership.  The ASF licenses this file\r\n+ * to you under the Apache License, Version 2.0 (the\r\n+ * \"License\"); you may not use this file except in compliance\r\n+ * with the License.  You may obtain a copy of the License at\r\n+ *\r\n+ *   http://www.apache.org/licenses/LICENSE-2.0\r\n+ *\r\n+ * Unless required by applicable law or agreed to in writing,\r\n+ * software distributed under the License is distributed on an\r\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\r\n+ * KIND, either express or implied.  See the License for the\r\n+ * specific language governing permissions and limitations\r\n+ * under the License.\r\n+ */\r\n+package org.apache.syncope.core.provisioning.java.job;\r\n+\r\n+import java.util.Date;\r\n+import org.apache.syncope.core.persistence.api.dao.ConfDAO;\r\n+import org.apache.syncope.core.persistence.api.dao.UserDAO;\r\n+import org.apache.syncope.core.persistence.api.entity.conf.CPlainAttr;\r\n+import org.apache.syncope.core.persistence.api.entity.task.TaskExec;\r\n+import org.apache.syncope.core.persistence.api.entity.user.User;\r\n+import org.apache.syncope.core.workflow.api.UserWorkflowAdapter;\r\n+import org.quartz.JobExecutionException;\r\n+import org.springframework.beans.factory.annotation.Autowired;\r\n+\r\n+public class IdentityRecertification extends AbstractSchedTaskJobDelegate {\r\n+\r\n+    @Autowired\r\n+    private UserDAO userDao;\r\n+\r\n+    @Autowired \r\n+    private UserWorkflowAdapter engine;\r\n+    \r\n+    @Autowired\r\n+    private ConfDAO confDAO;\r\n+\r\n+    private long recertificationTimeLong = -1;\r\n+\r\n+    public static final String RECERTIFICATION_TIME = \"identity.recertification.day.interval\";\r\n+\r\n+    @Override\r\n+    protected String doExecute(final boolean dryRun) throws JobExecutionException {\r\n+\r\n+        LOG.info(\"TestIdentityRecertification {} running [SchedTask {}]\", (dryRun\r\n+              ? \"dry \"\r\n+              : \"\"), task.getKey());\r\n+        init();\r\n+\r\n+        if (recertificationTimeLong == -1) {\r\n+            LOG.debug(\"Identity Recertification disabled\");\r\n+            return (\"IDENTITY RECERT DISABLED\");\r\n+        }\r\n+\r\n+        for (User u :userDao.findAll()) {\r\n+            LOG.debug(\"Processing user: {}\", u.getUsername());\r\n+\r\n+            if (u.getWorkflowId() != null && !u.getWorkflowId().equals(\"\")\r\n+                    && toBeRecertified(u) && !dryRun) {\r\n+                engine.requestCertify(u);\r\n+            } else {\r\n+                LOG.warn(\"Workflow for user: {} is null or empty\", u.getUsername());\r\n+            }\r\n+        }\r\n+\r\n+        return (dryRun\r\n+                ? \"DRY \"\r\n+                : \"\") + \"RUNNING\";\r\n+    }\r\n+\r\n+    public void init() {\r\n+        CPlainAttr recertificationTime = confDAO.find(RECERTIFICATION_TIME);\r\n+        if (recertificationTime == null || recertificationTime.getValues().get(0).getLongValue() == null) {\r\n+            recertificationTimeLong = -1;\r\n+            return;\r\n+        }\r\n+        recertificationTimeLong = recertificationTime.getValues().get(0).getLongValue() * 1000 * 60 * 60 * 24;\r\n+    }\r\n+\r\n+    public boolean toBeRecertified(final User user) {\r\n+\r\n+        Date lastCertificationDate = user.getLastRecertification();\r\n+\r\n+        if (lastCertificationDate != null) {\r\n+            if (lastCertificationDate.getTime() + recertificationTimeLong < System.currentTimeMillis()) {\r\n+                LOG.debug(\"User:  {}  to be recertified\", user.getUsername());\r\n+                return true;\r\n+            } else {\r\n+                LOG.debug(\"User: {} do not needs to be recertified\", user.getUsername());\r\n+                return false;\r\n+            }\r\n+        }\r\n+        return true;\r\n+    }\r\n+\r\n+    @Override\r\n+    protected boolean hasToBeRegistered(final TaskExec execution) {\r\n+        return true;\r\n+    }\r\n+\r\n+}\r"},{"sha":"27b377f3eef6ab4ed31e8ab284cb68894978cd32","filename":"core/workflow-activiti/src/main/java/org/apache/syncope/core/workflow/activiti/ActivitiUserWorkflowAdapter.java","status":"modified","additions":19,"deletions":1,"changes":20,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/2191c595f5a7a42e26e7658c80d959f0cb9af330/core%2Fworkflow-activiti%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fworkflow%2Factiviti%2FActivitiUserWorkflowAdapter.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/2191c595f5a7a42e26e7658c80d959f0cb9af330/core%2Fworkflow-activiti%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fworkflow%2Factiviti%2FActivitiUserWorkflowAdapter.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fworkflow-activiti%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fworkflow%2Factiviti%2FActivitiUserWorkflowAdapter.java?ref=2191c595f5a7a42e26e7658c80d959f0cb9af330","patch":"@@ -195,7 +195,7 @@ protected Set<String> getPerformedTasks(final User user) {\n      * Saves resources to be propagated and password for later - after form submission - propagation.\n      *\n      * @param user user\n-     * @param password pasword\n+     * @param password password\n      * @param propByRes current propagation actions against resources\n      */\n     protected void saveForFormSubmit(final User user, final String password, final PropagationByResource propByRes) {\n@@ -348,12 +348,30 @@ protected WorkflowResult<Pair<UserPatch, Boolean>> doUpdate(final User user, fin\n                 new ImmutablePair<>(updatedPatch, propagateEnable), propByRes, tasks);\n     }\n \n+    @Override\n+    public WorkflowResult<String> requestCertify(final User user) {\n+        String authUser = AuthContextUtils.getUsername();\n+        engine.getRuntimeService().setVariable(user.getWorkflowId(), FORM_SUBMITTER, authUser);\n+\n+        LOG.debug(\"Executing request-certify\");\n+        Set<String> performedTasks = doExecuteTask(user, \"request-certify\", null);\n+                \n+        PropagationByResource propByRes = engine.getRuntimeService().getVariable(\n+                user.getWorkflowId(), PROP_BY_RESOURCE, PropagationByResource.class);\n+\n+        saveForFormSubmit(\n+                user, null, propByRes);\n+                \n+        return new WorkflowResult<>(user.getKey(), null, performedTasks);\n+    }\n+\n     @Override\n     protected WorkflowResult<String> doSuspend(final User user) {\n         Set<String> performedTasks = doExecuteTask(user, \"suspend\", null);\n         updateStatus(user);\n         User updated = userDAO.save(user);\n \n+\n         return new WorkflowResult<>(updated.getKey(), null, performedTasks);\n     }\n "},{"sha":"13908b28629778f3d0a732d879355e6f9508e758","filename":"core/workflow-activiti/src/main/java/org/apache/syncope/core/workflow/activiti/task/Recertify.java","status":"added","additions":59,"deletions":0,"changes":59,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/2191c595f5a7a42e26e7658c80d959f0cb9af330/core%2Fworkflow-activiti%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fworkflow%2Factiviti%2Ftask%2FRecertify.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/2191c595f5a7a42e26e7658c80d959f0cb9af330/core%2Fworkflow-activiti%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fworkflow%2Factiviti%2Ftask%2FRecertify.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fworkflow-activiti%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fworkflow%2Factiviti%2Ftask%2FRecertify.java?ref=2191c595f5a7a42e26e7658c80d959f0cb9af330","patch":"@@ -0,0 +1,59 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *   http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+package org.apache.syncope.core.workflow.activiti.task;\n+\n+import java.util.Date;\n+import org.apache.syncope.core.persistence.api.dao.UserDAO;\n+import org.apache.syncope.core.persistence.api.entity.AnyUtilsFactory;\n+import org.apache.syncope.core.persistence.api.entity.EntityFactory;\n+import org.apache.syncope.core.persistence.api.entity.user.User;\n+import org.apache.syncope.core.workflow.activiti.ActivitiUserWorkflowAdapter;\n+import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.stereotype.Component;\n+\n+@Component\n+public class Recertify extends AbstractActivitiServiceTask {\n+\n+    @Autowired\n+    protected UserDAO userDAO;\n+\n+    @Autowired\n+    protected EntityFactory entityFactory;\n+\n+    @Autowired\n+    protected AnyUtilsFactory anyUtilsFactory;\n+\n+    @Override\n+    protected void doExecute(final String executionId) {\n+\n+        LOG.debug(\"Processing Recertification {}\", executionId);\n+        User user = engine.getRuntimeService().\n+                getVariable(executionId, ActivitiUserWorkflowAdapter.USER, User.class);\n+        String submitter = engine.getRuntimeService().\n+                getVariable(executionId, ActivitiUserWorkflowAdapter.FORM_SUBMITTER, String.class);\n+\n+        LOG.debug(\"Saving Recertification information for user {}\", user.getUsername());\n+\n+        user.setLastRecertificator(submitter);\n+        user.setLastRecertification(new Date(System.currentTimeMillis()));\n+\n+        userDAO.save(user);\n+    }\n+\n+}"},{"sha":"f33f958a06a4be9041e9da6dc6cd6c0fec4bb7d7","filename":"core/workflow-activiti/src/main/resources/userWorkflow.bpmn20.xml","status":"modified","additions":56,"deletions":1,"changes":57,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/2191c595f5a7a42e26e7658c80d959f0cb9af330/core%2Fworkflow-activiti%2Fsrc%2Fmain%2Fresources%2FuserWorkflow.bpmn20.xml","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/2191c595f5a7a42e26e7658c80d959f0cb9af330/core%2Fworkflow-activiti%2Fsrc%2Fmain%2Fresources%2FuserWorkflow.bpmn20.xml","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fworkflow-activiti%2Fsrc%2Fmain%2Fresources%2FuserWorkflow.bpmn20.xml?ref=2191c595f5a7a42e26e7658c80d959f0cb9af330","patch":"@@ -82,12 +82,47 @@ under the License.\n     \n     <serviceTask id=\"delete\" name=\"Delete\" activiti:expression=\"#{delete.execute(execution.processInstanceId)}\"/>\n     <sequenceFlow id=\"flow99\" sourceRef=\"delete\" targetRef=\"theEnd\"/>\n+    <!-- Recertification tasks -->\n+    <userTask id=\"RecertificationRequest\" name=\"Recertification Request\" activiti:formKey=\"recertify\">\n+      <extensionElements>\n+        <activiti:formProperty id=\"fullname\" name=\"Identity\" type=\"string\" expression=\"${user.getPlainAttr('fullname').getUniqueValue().getStringValue()}\" writable=\"false\"/> \n+        <activiti:formProperty id=\"username\" name=\"Username\" type=\"string\" expression=\"${user.username}\" writable=\"false\"/>\n+        <activiti:formProperty id=\"approve\" name=\"Recertify?\" type=\"boolean\" required=\"true\"/>\n+        <activiti:formProperty id=\"rejectReason\" name=\"Reason for not recertifying\" type=\"string\" variable=\"rejectReason\"/>\n+      </extensionElements>\n+    </userTask>\n+    <serviceTask id=\"recertify-task\" name=\"Recertify\" activiti:expression=\"#{recertify.execute(execution.processInstanceId)}\"/>\n+    <sequenceFlow id=\"recert-request-start-flow\" sourceRef=\"activeGw\" targetRef=\"RecertificationRequest\">\n+      <conditionExpression xsi:type=\"tFormalExpression\"><![CDATA[${task == 'request-certify'}]]></conditionExpression>\n+    </sequenceFlow>\n+    <exclusiveGateway id=\"recert-condition\"/>\n+    <sequenceFlow id=\"recert-flow1\" sourceRef=\"RecertificationRequest\" targetRef=\"recertify-task\"/>\n+    <sequenceFlow id=\"recert-flow2\" sourceRef=\"recertify-task\" targetRef=\"recert-condition\"/>\n+    <sequenceFlow id=\"recert-approved-flow\" sourceRef=\"recert-condition\" targetRef=\"active\">\n+      <conditionExpression xsi:type=\"tFormalExpression\"><![CDATA[${approve}]]></conditionExpression>\n+    </sequenceFlow>\n+    <sequenceFlow id=\"recert-denied-flow\" sourceRef=\"recert-condition\" targetRef=\"suspend\">\n+      <conditionExpression xsi:type=\"tFormalExpression\"><![CDATA[${!approve}]]></conditionExpression>\n+    </sequenceFlow>\n+    <!-- End Recertification flow -->\n     <endEvent id=\"theEnd\"/>\n   </process>\n   \n   <bpmndi:BPMNDiagram id=\"BPMNDiagram_userWorkflow\">\n     <bpmndi:BPMNPlane bpmnElement=\"userWorkflow\" id=\"BPMNPlane_userWorkflow\">\n-      <bpmndi:BPMNShape bpmnElement=\"theStart\" id=\"BPMNShape_theStart\">\n+      <bpmndi:BPMNShape bpmnElement=\"RecertificationRequest\" id=\"BPMNShape_RecertificationRequest\">\n+        <omgdc:Bounds height=\"80.0\" width=\"100.0\" x=\"1370.0\" y=\"375.0\"/>\n+      </bpmndi:BPMNShape>\n+      <bpmndi:BPMNShape bpmnElement=\"recertify-task\" id=\"BPMNShape_recertify-task\">\n+        <omgdc:Bounds height=\"80.0\" width=\"100.0\" x=\"1230.0\" y=\"375.0\"/>\n+      </bpmndi:BPMNShape>\n+      <bpmndi:BPMNShape bpmnElement=\"theEnd\" id=\"BPMNShape_theEnd\">\n+        <omgdc:Bounds height=\"28.0\" width=\"28.0\" x=\"2080.0\" y=\"451.0\"/>\n+      </bpmndi:BPMNShape>\n+      <bpmndi:BPMNShape bpmnElement=\"recert-condition\" id=\"BPMNShape_recert-condition\">\n+        <omgdc:Bounds height=\"39.99999999999994\" width=\"40.0\" x=\"1178.1817939458806\" y=\"475.4545368832992\"/>\n+      </bpmndi:BPMNShape>\n+     <bpmndi:BPMNShape bpmnElement=\"theStart\" id=\"BPMNShape_theStart\">\n         <omgdc:Bounds height=\"30.0\" width=\"30.0\" x=\"540.0\" y=\"525.0\"/>\n       </bpmndi:BPMNShape>\n       <bpmndi:BPMNShape bpmnElement=\"create\" id=\"BPMNShape_create\">\n@@ -135,6 +170,26 @@ under the License.\n       <bpmndi:BPMNShape bpmnElement=\"activate\" id=\"BPMNShape_activate\">\n         <omgdc:Bounds height=\"80.0\" width=\"100.0\" x=\"828.286878319943\" y=\"500.0\"/>\n       </bpmndi:BPMNShape>\n+      <bpmndi:BPMNEdge bpmnElement=\"recert-approved-flow\" id=\"BPMNEdge_recert-approved-flow\">\n+        <omgdi:waypoint x=\"1194.0489013105641\" y=\"511.3216442479827\"/>\n+        <omgdi:waypoint x=\"1194.0489013105641\" y=\"541.0\"/>\n+        <omgdi:waypoint x=\"1130.0\" y=\"541.0\"/>\n+      </bpmndi:BPMNEdge>\n+      <bpmndi:BPMNEdge bpmnElement=\"recert-flow2\" id=\"BPMNEdge_recert-flow2\">\n+        <omgdi:waypoint x=\"1280.0\" y=\"455.0\"/>\n+        <omgdi:waypoint x=\"1280.0\" y=\"495.45453688329917\"/>\n+        <omgdi:waypoint x=\"1218.1817939458806\" y=\"495.45453688329917\"/>\n+      </bpmndi:BPMNEdge>\n+      <bpmndi:BPMNEdge bpmnElement=\"recert-flow1\" id=\"BPMNEdge_recert-flow1\">\n+        <omgdi:waypoint x=\"1370.0\" y=\"415.0\"/>\n+        <omgdi:waypoint x=\"1330.0\" y=\"415.0\"/>\n+      </bpmndi:BPMNEdge>\n+      <bpmndi:BPMNEdge bpmnElement=\"recert-denied-flow\" id=\"BPMNEdge_recert-denied-flow\">\n+        <omgdi:waypoint x=\"1198.1817939458806\" y=\"475.4545368832992\"/>\n+        <omgdi:waypoint x=\"1198.1817939458806\" y=\"313.6363529725508\"/>\n+        <omgdi:waypoint x=\"1540.0\" y=\"313.6363529725508\"/>\n+        <omgdi:waypoint x=\"1540.0\" y=\"370.0\"/>\n+      </bpmndi:BPMNEdge>\n       <bpmndi:BPMNEdge bpmnElement=\"flow12\" id=\"BPMNEdge_flow12\">\n         <omgdi:waypoint x=\"1990.0\" y=\"290.0\"/>\n         <omgdi:waypoint x=\"1990.0\" y=\"261.0\"/>"},{"sha":"6a02d504cbc4943dd0864b34bde7a1657c4bbe2d","filename":"core/workflow-api/src/main/java/org/apache/syncope/core/workflow/api/UserWorkflowAdapter.java","status":"modified","additions":5,"deletions":0,"changes":5,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/2191c595f5a7a42e26e7658c80d959f0cb9af330/core%2Fworkflow-api%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fworkflow%2Fapi%2FUserWorkflowAdapter.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/2191c595f5a7a42e26e7658c80d959f0cb9af330/core%2Fworkflow-api%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fworkflow%2Fapi%2FUserWorkflowAdapter.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fworkflow-api%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fworkflow%2Fapi%2FUserWorkflowAdapter.java?ref=2191c595f5a7a42e26e7658c80d959f0cb9af330","patch":"@@ -22,6 +22,7 @@\n import org.apache.syncope.common.lib.patch.UserPatch;\n import org.apache.syncope.core.provisioning.api.WorkflowResult;\n import org.apache.syncope.common.lib.to.UserTO;\n+import org.apache.syncope.core.persistence.api.entity.user.User;\n \n /**\n  * Interface for calling underlying workflow implementations.\n@@ -60,6 +61,10 @@ WorkflowResult<Pair<String, Boolean>> create(\n     WorkflowResult<Pair<String, Boolean>> create(\n             UserTO userTO, boolean disablePwdPolicyCheck, final Boolean enabled, boolean storePassword);\n \n+\n+    WorkflowResult<String> requestCertify(final User user);\n+\n+    \n     /**\n      * Execute a task on an user.\n      *"},{"sha":"878fe1bbc43751d05c9c227b09e1dc9e1f7b1125","filename":"core/workflow-java/src/main/java/org/apache/syncope/core/workflow/java/DefaultUserWorkflowAdapter.java","status":"modified","additions":5,"deletions":0,"changes":5,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/2191c595f5a7a42e26e7658c80d959f0cb9af330/core%2Fworkflow-java%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fworkflow%2Fjava%2FDefaultUserWorkflowAdapter.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/2191c595f5a7a42e26e7658c80d959f0cb9af330/core%2Fworkflow-java%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fworkflow%2Fjava%2FDefaultUserWorkflowAdapter.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fworkflow-java%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fworkflow%2Fjava%2FDefaultUserWorkflowAdapter.java?ref=2191c595f5a7a42e26e7658c80d959f0cb9af330","patch":"@@ -207,4 +207,9 @@ public WorkflowResult<UserPatch> submitForm(final WorkflowFormTO form) {\n         throw new WorkflowException(new UnsupportedOperationException(\"Not supported.\"));\n     }\n \n+    @Override\n+    public WorkflowResult<String> requestCertify(final User user) {\n+        throw new UnsupportedOperationException(\"Not supported.\"); \n+    }\n+\n }"},{"sha":"521affef7f86714e8e73fe321d68cb54733676dc","filename":"fit/core-reference/src/main/resources/userWorkflow.bpmn20.xml","status":"modified","additions":54,"deletions":1,"changes":55,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/2191c595f5a7a42e26e7658c80d959f0cb9af330/fit%2Fcore-reference%2Fsrc%2Fmain%2Fresources%2FuserWorkflow.bpmn20.xml","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/2191c595f5a7a42e26e7658c80d959f0cb9af330/fit%2Fcore-reference%2Fsrc%2Fmain%2Fresources%2FuserWorkflow.bpmn20.xml","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/fit%2Fcore-reference%2Fsrc%2Fmain%2Fresources%2FuserWorkflow.bpmn20.xml?ref=2191c595f5a7a42e26e7658c80d959f0cb9af330","patch":"@@ -187,6 +187,29 @@ try {\n     <sequenceFlow id=\"flow8ter\" sourceRef=\"rejectUpdate\" targetRef=\"active\"/>\n     <serviceTask id=\"update\" name=\"Update\" activiti:expression=\"#{update.execute(execution.processInstanceId)}\"/>\n     <sequenceFlow id=\"flow9\" sourceRef=\"update\" targetRef=\"active\"/>\n+    <!-- Recertification tasks -->\n+    <userTask id=\"RecertificationRequest\" name=\"Recertification Request\" activiti:candidateGroups=\"managingDirector\" activiti:formKey=\"recertify\">\n+      <extensionElements>\n+        <activiti:formProperty id=\"fullname\" name=\"Identity\" type=\"string\" expression=\"${user.getPlainAttr('fullname').getUniqueValue().getStringValue()}\" writable=\"false\"/> \n+        <activiti:formProperty id=\"username\" name=\"Username\" type=\"string\" expression=\"${user.username}\" writable=\"false\"/>\n+        <activiti:formProperty id=\"approve\" name=\"Recertify?\" type=\"boolean\" required=\"true\"/>\n+        <activiti:formProperty id=\"rejectReason\" name=\"Reason for not recertifying\" type=\"string\" variable=\"rejectReason\"/>\n+      </extensionElements>\n+    </userTask>\n+    <serviceTask id=\"recertify-task\" name=\"Recertify\" activiti:expression=\"#{recertify.execute(execution.processInstanceId)}\"/>\n+    <sequenceFlow id=\"recert-request-start-flow\" sourceRef=\"activeGw\" targetRef=\"RecertificationRequest\">\n+      <conditionExpression xsi:type=\"tFormalExpression\"><![CDATA[${task == 'request-certify'}]]></conditionExpression>\n+    </sequenceFlow>\n+    <exclusiveGateway id=\"recert-condition\"/>\n+    <sequenceFlow id=\"recert-flow1\" sourceRef=\"RecertificationRequest\" targetRef=\"recertify-task\"/>\n+    <sequenceFlow id=\"recert-flow2\" sourceRef=\"recertify-task\" targetRef=\"recert-condition\"/>\n+    <sequenceFlow id=\"recert-approved-flow\" sourceRef=\"recert-condition\" targetRef=\"active\">\n+      <conditionExpression xsi:type=\"tFormalExpression\"><![CDATA[${approve}]]></conditionExpression>\n+    </sequenceFlow>\n+    <sequenceFlow id=\"recert-denied-flow\" sourceRef=\"recert-condition\" targetRef=\"suspend\">\n+      <conditionExpression xsi:type=\"tFormalExpression\"><![CDATA[${!approve}]]></conditionExpression>\n+    </sequenceFlow>\n+    <!-- End Recertification flow -->\n     <serviceTask id=\"suspend\" name=\"Suspend\" activiti:expression=\"#{suspend.execute(execution.processInstanceId)}\"/>\n     <sequenceFlow id=\"flow10\" sourceRef=\"suspend\" targetRef=\"suspended\"/>\n     <userTask id=\"suspended\" name=\"Suspended\"/>\n@@ -255,6 +278,15 @@ try {\n   \n   <bpmndi:BPMNDiagram id=\"BPMNDiagram_userWorkflow\">\n     <bpmndi:BPMNPlane bpmnElement=\"userWorkflow\" id=\"BPMNPlane_userWorkflow\">\n+      <bpmndi:BPMNShape bpmnElement=\"recert-condition\" id=\"BPMNShape_recert-condition\">\n+        <omgdc:Bounds height=\"40.0\" width=\"40.0\" x=\"1439.4825360864054\" y=\"12.176664483986166\"/>\n+      </bpmndi:BPMNShape>\n+      <bpmndi:BPMNShape bpmnElement=\"recertify-task\" id=\"BPMNShape_recertify-task\">\n+        <omgdc:Bounds height=\"80.0\" width=\"100.0\" x=\"1110.0\" y=\"15.0\"/>\n+      </bpmndi:BPMNShape>\n+      <bpmndi:BPMNShape bpmnElement=\"RecertificationRequest\" id=\"BPMNShape_RecertificationRequest\">\n+        <omgdc:Bounds height=\"80.0\" width=\"100.0\" x=\"930.0\" y=\"15.0\"/>\n+      </bpmndi:BPMNShape>\n       <bpmndi:BPMNShape bpmnElement=\"theStart\" id=\"BPMNShape_theStart\">\n         <omgdc:Bounds height=\"30.0\" width=\"30.0\" x=\"0.0\" y=\"512.0\"/>\n       </bpmndi:BPMNShape>\n@@ -648,6 +680,27 @@ try {\n         <omgdi:waypoint x=\"2040.0\" y=\"388.0\"/>\n         <omgdi:waypoint x=\"2078.1893792531678\" y=\"388.0\"/>\n       </bpmndi:BPMNEdge>\n+      <bpmndi:BPMNEdge bpmnElement=\"recert-flow2\" id=\"BPMNEdge_recert-flow2\">\n+        <omgdi:waypoint x=\"1210.0\" y=\"51.18953815900822\"/>\n+        <omgdi:waypoint x=\"1440.8987892500566\" y=\"33.59291764763734\"/>\n+      </bpmndi:BPMNEdge>\n+      <bpmndi:BPMNEdge bpmnElement=\"recert-flow1\" id=\"BPMNEdge_recert-flow1\">\n+        <omgdi:waypoint x=\"1030.0\" y=\"55.0\"/>\n+        <omgdi:waypoint x=\"1110.0\" y=\"55.0\"/>\n+      </bpmndi:BPMNEdge>\n+      <bpmndi:BPMNEdge bpmnElement=\"recert-denied-flow\" id=\"BPMNEdge_recert-denied-flow\">\n+        <omgdi:waypoint x=\"1479.438749881016\" y=\"32.13287827859691\"/>\n+        <omgdi:waypoint x=\"1540.0\" y=\"32.0\"/>\n+        <omgdi:waypoint x=\"1540.0\" y=\"100.0\"/>\n+      </bpmndi:BPMNEdge>\n+      <bpmndi:BPMNEdge bpmnElement=\"recert-approved-flow\" id=\"BPMNEdge_recert-approved-flow\">\n+        <omgdi:waypoint x=\"1450.9385750878846\" y=\"43.63270348546535\"/>\n+        <omgdi:waypoint x=\"1102.3741233704363\" y=\"511.0\"/>\n+      </bpmndi:BPMNEdge>\n+       <bpmndi:BPMNEdge bpmnElement=\"recert-request-start-flow\" id=\"BPMNEdge_recert-request-start-flow\">\n+        <omgdi:waypoint x=\"1410.4864864864865\" y=\"529.5135135135135\"/>\n+        <omgdi:waypoint x=\"1016.2886597938144\" y=\"95.0\"/>\n+      </bpmndi:BPMNEdge>\n     </bpmndi:BPMNPlane>\n   </bpmndi:BPMNDiagram>\n-</definitions>\n+</definitions>\n\\ No newline at end of file"},{"sha":"9416d793742fd7bfd18bf54698137d4bd974c6b6","filename":"fit/core-reference/src/test/java/org/apache/syncope/fit/core/RecertificationITCase.java","status":"added","additions":51,"deletions":0,"changes":51,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/2191c595f5a7a42e26e7658c80d959f0cb9af330/fit%2Fcore-reference%2Fsrc%2Ftest%2Fjava%2Forg%2Fapache%2Fsyncope%2Ffit%2Fcore%2FRecertificationITCase.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/2191c595f5a7a42e26e7658c80d959f0cb9af330/fit%2Fcore-reference%2Fsrc%2Ftest%2Fjava%2Forg%2Fapache%2Fsyncope%2Ffit%2Fcore%2FRecertificationITCase.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/fit%2Fcore-reference%2Fsrc%2Ftest%2Fjava%2Forg%2Fapache%2Fsyncope%2Ffit%2Fcore%2FRecertificationITCase.java?ref=2191c595f5a7a42e26e7658c80d959f0cb9af330","patch":"@@ -0,0 +1,51 @@\n+/*\r\n+ * Licensed to the Apache Software Foundation (ASF) under one\r\n+ * or more contributor license agreements.  See the NOTICE file\r\n+ * distributed with this work for additional information\r\n+ * regarding copyright ownership.  The ASF licenses this file\r\n+ * to you under the Apache License, Version 2.0 (the\r\n+ * \"License\"); you may not use this file except in compliance\r\n+ * with the License.  You may obtain a copy of the License at\r\n+ *\r\n+ *   http://www.apache.org/licenses/LICENSE-2.0\r\n+ *\r\n+ * Unless required by applicable law or agreed to in writing,\r\n+ * software distributed under the License is distributed on an\r\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\r\n+ * KIND, either express or implied.  See the License for the\r\n+ * specific language governing permissions and limitations\r\n+ * under the License.\r\n+ */\r\n+package org.apache.syncope.fit.core;\r\n+\r\n+import java.util.List;\r\n+import org.apache.syncope.common.lib.to.WorkflowFormPropertyTO;\r\n+import org.apache.syncope.common.lib.to.WorkflowFormTO;\r\n+import static org.junit.Assert.assertFalse;\r\n+import static org.junit.Assert.assertTrue;\r\n+import org.junit.FixMethodOrder;\r\n+import org.junit.Test;\r\n+import org.junit.runners.MethodSorters;\r\n+\r\n+@FixMethodOrder(MethodSorters.JVM)\r\n+public class RecertificationITCase extends AbstractTaskITCase{\r\n+\r\n+    @Test\r\n+    public void recertification() {\r\n+        execTask(taskService, \"e95555d2-1b09-42c8-b25b-f4c4ec598989\", \"JOB_FIRED\", 10, false);\r\n+\r\n+        List<WorkflowFormTO> forms = userWorkflowService.getForms();\r\n+        assertFalse(forms.isEmpty());\r\n+        for (WorkflowFormTO f : forms) {\r\n+            userWorkflowService.claimForm(f.getTaskId());\r\n+            WorkflowFormPropertyTO w = f.getPropertyMap().get(\"approve\");\r\n+            w.setValue(\"true\");\r\n+            userWorkflowService.submitForm(f);\r\n+        }\r\n+\r\n+        forms = userWorkflowService.getForms();\r\n+        assertTrue(forms.isEmpty());\r\n+\r\n+    }\r\n+\r\n+}\n\\ No newline at end of file"},{"sha":"b79667ff072a72ffefe5c953f67b5b6c5a601776","filename":"pom.xml","status":"modified","additions":10,"deletions":0,"changes":10,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/2191c595f5a7a42e26e7658c80d959f0cb9af330/pom.xml","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/2191c595f5a7a42e26e7658c80d959f0cb9af330/pom.xml","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/pom.xml?ref=2191c595f5a7a42e26e7658c80d959f0cb9af330","patch":"@@ -196,6 +196,16 @@ under the License.\n       </roles>\n       <url>http://people.apache.org/~anzelld/</url>\n     </developer>\n+    <developer>\n+      <id>nscendoni</id>\n+      <name>Nicola Scendoni</name>\n+      <organization>The Apache Software Foundation</organization>\n+      <organizationUrl>http://www.apache.org/</organizationUrl>\n+      <roles>\n+        <role>committer</role>\n+      </roles>\n+      <url></url>\n+    </developer>\n     <developer>\n       <id>coheigea</id>\n       <name>Colm O hEigeartaigh</name>"},{"sha":"96a6ca70cdcc98572ea927e2301cd4c8a8e569fe","filename":"src/main/asciidoc/reference-guide/workingwithapachesyncope/systemadministration/configurationparameters.adoc","status":"modified","additions":2,"deletions":2,"changes":4,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/2191c595f5a7a42e26e7658c80d959f0cb9af330/src%2Fmain%2Fasciidoc%2Freference-guide%2Fworkingwithapachesyncope%2Fsystemadministration%2Fconfigurationparameters.adoc","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/2191c595f5a7a42e26e7658c80d959f0cb9af330/src%2Fmain%2Fasciidoc%2Freference-guide%2Fworkingwithapachesyncope%2Fsystemadministration%2Fconfigurationparameters.adoc","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/src%2Fmain%2Fasciidoc%2Freference-guide%2Fworkingwithapachesyncope%2Fsystemadministration%2Fconfigurationparameters.adoc?ref=2191c595f5a7a42e26e7658c80d959f0cb9af330","patch":"@@ -39,6 +39,6 @@ application) is allowed;\n * `authentication.statuses` - the list of <<workflow,workflow>> statuses for which users are allowed to authenticate;\n * `log.lastlogindate` - whether the system updates the `lastLoginDate` field of users upon authentication;\n * `tasks.interruptMaxRetries` - how many attempts shall be made when interrupting a running <<task,task>>;\n-* `return.password.value` - whether the hashed password value shall be returned when reading users.\n-\n+* `return.password.value` - whether the hashed password value shall be returned when reading users;\n+* `identity.recertification.day.interval` - Number of days bewteen identity recertifications.\n Besides this default set, new configuration parameters can be defined to support <<customization,custom>> code."},{"sha":"138ad516ee57193edbd8c316adbe8f6a37844c24","filename":"src/main/asciidoc/reference-guide/workingwithapachesyncope/systemadministration/identityrecertification.adoc","status":"added","additions":50,"deletions":0,"changes":50,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/2191c595f5a7a42e26e7658c80d959f0cb9af330/src%2Fmain%2Fasciidoc%2Freference-guide%2Fworkingwithapachesyncope%2Fsystemadministration%2Fidentityrecertification.adoc","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/2191c595f5a7a42e26e7658c80d959f0cb9af330/src%2Fmain%2Fasciidoc%2Freference-guide%2Fworkingwithapachesyncope%2Fsystemadministration%2Fidentityrecertification.adoc","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/src%2Fmain%2Fasciidoc%2Freference-guide%2Fworkingwithapachesyncope%2Fsystemadministration%2Fidentityrecertification.adoc?ref=2191c595f5a7a42e26e7658c80d959f0cb9af330","patch":"@@ -0,0 +1,50 @@\n+//\n+// Licensed to the Apache Software Foundation (ASF) under one\n+// or more contributor license agreements.  See the NOTICE file\n+// distributed with this work for additional information\n+// regarding copyright ownership.  The ASF licenses this file\n+// to you under the Apache License, Version 2.0 (the\n+// \"License\"); you may not use this file except in compliance\n+// with the License.  You may obtain a copy of the License at\n+//\n+//   http://www.apache.org/licenses/LICENSE-2.0\n+//\n+// Unless required by applicable law or agreed to in writing,\n+// software distributed under the License is distributed on an\n+// \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+// KIND, either express or implied.  See the License for the\n+// specific language governing permissions and limitations\n+// under the License.\n+//\n+==== Identity Recertification\n+\n+Recertification is the process to review all the identities and access within one organization. This is a tipical countermeasure against the  __privilege creep__, that is the rentention of accounts during time even when the user change his role, or even his job. Ths good practice is recomendded and often required by international or organizational standards.\n+\n+Tipically every \"object\" within one IDM system needs to be periodically re-certified:\n+\n+* Identities: Is the user still valid for the organization?\n+* Accounts: Is thie user still using this account?\n+* Group Membership/Entitlements: Does the user require this functionality?\n+\n+One simple scheduled job to implement Identity Recertification is provided. The class name is: __org.apache.syncope.core.provisioning.java.job.IdentityRecertification__ .\n+It can be used as base to implement more complex recertification processes.\n+It go through all the users and check if they have been recertified the past __identity.recertification.day.interval__ days. This is a global Parameter that can be set using Syncope Console or REST webservices.\n+The recertificaton task implemented by default set two attributes for each users:\n+- lastRertificator: the name of the user that re-certified the user\n+- lastRecertiication: the date when the re-certification is performed\n+This task is implement by the class: __org.apache.syncope.core.workflow.activiti.task.Recertify__\n+The certificator can be defined modifying the task: \"Create Recertification\". Actviti is very flexible, and allows to define approver user, groups, or even to use expression language to define approvers from attributes from the user, for example the user manager.\n+\n+Example 1: Certifier users are members of managingDirector group:\n+=====================================================================\n+    <userTask id=\"createApproval\" name=\"Create approval\"\n+              activiti:candidateGroups=\"managingDirector\" \n+              activiti:formKey=\"createApproval\">\n+=====================================================================\n+\n+Example 2: Certifier user is the user manager defined in the user attribute: __lastRecertificator__\n+=====================================================================\n+    < userTask id = \"createApproval\" name = \"Create Recertification\"\n+               activiti:candidateGroups=\"${user.lastRecertificator}\" \n+               activiti:formKey=\"createApproval\">\n+====================================================================="},{"sha":"e7e61d8c7943ddd5a39cbbbe21a41bdf9e0989b2","filename":"src/main/asciidoc/reference-guide/workingwithapachesyncope/systemadministration/systemadministration.adoc","status":"modified","additions":2,"deletions":0,"changes":2,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/2191c595f5a7a42e26e7658c80d959f0cb9af330/src%2Fmain%2Fasciidoc%2Freference-guide%2Fworkingwithapachesyncope%2Fsystemadministration%2Fsystemadministration.adoc","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/2191c595f5a7a42e26e7658c80d959f0cb9af330/src%2Fmain%2Fasciidoc%2Freference-guide%2Fworkingwithapachesyncope%2Fsystemadministration%2Fsystemadministration.adoc","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/src%2Fmain%2Fasciidoc%2Freference-guide%2Fworkingwithapachesyncope%2Fsystemadministration%2Fsystemadministration.adoc?ref=2191c595f5a7a42e26e7658c80d959f0cb9af330","patch":"@@ -70,4 +70,6 @@ include::connectorbundles.adoc[]\n \n include::emailconfiguration.adoc[]\n \n+include::identityrecertification.adoc[]\n+\n include::configurationparameters.adoc[]"}]}