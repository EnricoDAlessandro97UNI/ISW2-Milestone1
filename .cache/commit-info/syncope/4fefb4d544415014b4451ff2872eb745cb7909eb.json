{"sha":"4fefb4d544415014b4451ff2872eb745cb7909eb","node_id":"MDY6Q29tbWl0NjM2ODc5MDYyOjRmZWZiNGQ1NDQ0MTUwMTRiNDQ1MWZmMjg3MmViNzQ1Y2I3OTA5ZWI=","commit":{"author":{"name":"Francesco Chicchiriccò","email":"ilgrosso@apache.org","date":"2013-01-11T16:00:20Z"},"committer":{"name":"Francesco Chicchiriccò","email":"ilgrosso@apache.org","date":"2013-01-11T16:00:20Z"},"message":"[SYNCOPE-269] Merge from 1_0_X\n\ngit-svn-id: https://svn.apache.org/repos/asf/syncope/trunk@1432115 13f79535-47bb-0310-9956-ffa450edef68","tree":{"sha":"8be28e439e014d869520de1cdf30c04795197132","url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/git/trees/8be28e439e014d869520de1cdf30c04795197132"},"url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/git/commits/4fefb4d544415014b4451ff2872eb745cb7909eb","comment_count":0,"verification":{"verified":false,"reason":"unsigned","signature":null,"payload":null}},"url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/4fefb4d544415014b4451ff2872eb745cb7909eb","html_url":"https://github.com/EnricoDAlessandro97UNI/syncope/commit/4fefb4d544415014b4451ff2872eb745cb7909eb","comments_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/4fefb4d544415014b4451ff2872eb745cb7909eb/comments","author":{"login":"ilgrosso","id":1064664,"node_id":"MDQ6VXNlcjEwNjQ2NjQ=","avatar_url":"https://avatars.githubusercontent.com/u/1064664?v=4","gravatar_id":"","url":"https://api.github.com/users/ilgrosso","html_url":"https://github.com/ilgrosso","followers_url":"https://api.github.com/users/ilgrosso/followers","following_url":"https://api.github.com/users/ilgrosso/following{/other_user}","gists_url":"https://api.github.com/users/ilgrosso/gists{/gist_id}","starred_url":"https://api.github.com/users/ilgrosso/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ilgrosso/subscriptions","organizations_url":"https://api.github.com/users/ilgrosso/orgs","repos_url":"https://api.github.com/users/ilgrosso/repos","events_url":"https://api.github.com/users/ilgrosso/events{/privacy}","received_events_url":"https://api.github.com/users/ilgrosso/received_events","type":"User","site_admin":false},"committer":{"login":"ilgrosso","id":1064664,"node_id":"MDQ6VXNlcjEwNjQ2NjQ=","avatar_url":"https://avatars.githubusercontent.com/u/1064664?v=4","gravatar_id":"","url":"https://api.github.com/users/ilgrosso","html_url":"https://github.com/ilgrosso","followers_url":"https://api.github.com/users/ilgrosso/followers","following_url":"https://api.github.com/users/ilgrosso/following{/other_user}","gists_url":"https://api.github.com/users/ilgrosso/gists{/gist_id}","starred_url":"https://api.github.com/users/ilgrosso/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ilgrosso/subscriptions","organizations_url":"https://api.github.com/users/ilgrosso/orgs","repos_url":"https://api.github.com/users/ilgrosso/repos","events_url":"https://api.github.com/users/ilgrosso/events{/privacy}","received_events_url":"https://api.github.com/users/ilgrosso/received_events","type":"User","site_admin":false},"parents":[{"sha":"70130de9bf9e275163853b29eacb1a8140acc9be","url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/70130de9bf9e275163853b29eacb1a8140acc9be","html_url":"https://github.com/EnricoDAlessandro97UNI/syncope/commit/70130de9bf9e275163853b29eacb1a8140acc9be"}],"stats":{"total":82,"additions":52,"deletions":30},"files":[{"sha":"85ab2ab6784db05646af8737ef7b851b6fc096eb","filename":"archetype/pom.xml","status":"modified","additions":1,"deletions":1,"changes":2,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/4fefb4d544415014b4451ff2872eb745cb7909eb/archetype%2Fpom.xml","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/4fefb4d544415014b4451ff2872eb745cb7909eb/archetype%2Fpom.xml","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/archetype%2Fpom.xml?ref=4fefb4d544415014b4451ff2872eb745cb7909eb","patch":"@@ -154,13 +154,13 @@ under the License.\n                   <else>\n                     <get src=\"${SVNRepoURL}/core/src/test/resources/persistence.properties\" dest=\"${basedir}/src/main/resources/archetype-resources/core/src/test/resources/persistence.properties\" />\n                     <get src=\"${SVNRepoURL}/core/src/test/resources/workflow.properties\" dest=\"${basedir}/src/main/resources/archetype-resources/core/src/test/resources/workflow.properties\" />\n-                    <get src=\"${SVNRepoURL}/core/src/test/resources/security.properties\" dest=\"${basedir}/src/main/resources/archetype-resources/core/src/test/resources/security.properties\" />\n                     <get src=\"${SVNRepoURL}/core/src/test/resources/content.xml\" dest=\"${basedir}/src/main/resources/archetype-resources/core/src/test/resources/content.xml\" />\n                     <get src=\"${SVNRepoURL}/core/src/test/resources/test.csv\" dest=\"${basedir}/src/main/resources/archetype-resources/core/src/test/resources/test.csv\" />\n                     <get src=\"${SVNRepoURL}/core/src/test/resources/db.jsp\" dest=\"${basedir}/src/main/resources/archetype-resources/core/src/test/resources/db.jsp\" />\n \n                     <get src=\"${SVNRepoURL}/core/src/main/resources/persistence.properties\" dest=\"${basedir}/src/main/resources/archetype-resources/core/src/main/resources/persistence.properties\" />\n                     <get src=\"${SVNRepoURL}/core/src/main/resources/workflow.properties\" dest=\"${basedir}/src/main/resources/archetype-resources/core/src/main/resources/workflow.properties\" />\n+                    <get src=\"${SVNRepoURL}/core/src/main/resources/security.properties\" dest=\"${basedir}/src/main/resources/archetype-resources/core/src/main/resources/security.properties\" />\n                     <get src=\"${SVNRepoURL}/core/src/main/resources/content.xml\" dest=\"${basedir}/src/main/resources/archetype-resources/core/src/main/resources/content.xml\" />\n                     <get src=\"${SVNRepoURL}/core/src/main/resources/logback.xml\" dest=\"${basedir}/src/main/resources/archetype-resources/core/src/main/resources/logback.xml\" />\n                     <get src=\"${SVNRepoURL}/core/src/main/resources/META-INF/spring-persistence.xml\" dest=\"${basedir}/src/main/resources/archetype-resources/core/src/main/resources/META-INF/spring-persistence.xml\" />"},{"sha":"455d9bb4a4758df3b4f316095b59261e27f8b9dc","filename":"archetype/src/main/resources/META-INF/maven/archetype-metadata.xml","status":"modified","additions":4,"deletions":1,"changes":5,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/4fefb4d544415014b4451ff2872eb745cb7909eb/archetype%2Fsrc%2Fmain%2Fresources%2FMETA-INF%2Fmaven%2Farchetype-metadata.xml","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/4fefb4d544415014b4451ff2872eb745cb7909eb/archetype%2Fsrc%2Fmain%2Fresources%2FMETA-INF%2Fmaven%2Farchetype-metadata.xml","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/archetype%2Fsrc%2Fmain%2Fresources%2FMETA-INF%2Fmaven%2Farchetype-metadata.xml?ref=4fefb4d544415014b4451ff2872eb745cb7909eb","patch":"@@ -16,11 +16,14 @@ software distributed under the License is distributed on an\n KIND, either express or implied.  See the License for the\n specific language governing permissions and limitations\n under the License.\n-\n -->\n <archetype-descriptor xsi:schemaLocation=\"http://maven.apache.org/plugins/maven-archetype-plugin/archetype-descriptor/1.0.0 http://maven.apache.org/xsd/archetype-descriptor-1.0.0.xsd\" name=\"syncope-sample\"\n                       xmlns=\"http://maven.apache.org/plugins/maven-archetype-plugin/archetype-descriptor/1.0.0\"\n                       xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\">\n+  <requiredProperties>\n+    <requiredProperty key=\"secretKey\"/>\n+  </requiredProperties>\n+  \n   <modules>\n     <module id=\"core\" dir=\"core\" name=\"core\">\n       <fileSets>"},{"sha":"50fb943c1cb50748755ba66c2b642e81cdca08f4","filename":"archetype/src/main/resources/archetype-resources/console/src/main/resources/configuration.properties","status":"modified","additions":1,"deletions":1,"changes":2,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/4fefb4d544415014b4451ff2872eb745cb7909eb/archetype%2Fsrc%2Fmain%2Fresources%2Farchetype-resources%2Fconsole%2Fsrc%2Fmain%2Fresources%2Fconfiguration.properties","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/4fefb4d544415014b4451ff2872eb745cb7909eb/archetype%2Fsrc%2Fmain%2Fresources%2Farchetype-resources%2Fconsole%2Fsrc%2Fmain%2Fresources%2Fconfiguration.properties","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/archetype%2Fsrc%2Fmain%2Fresources%2Farchetype-resources%2Fconsole%2Fsrc%2Fmain%2Fresources%2Fconfiguration.properties?ref=4fefb4d544415014b4451ff2872eb745cb7909eb","patch":"@@ -17,4 +17,4 @@\n scheme=http\n host=localhost\n port=8080\n-path=/syncope/rest/\n+rootPath=/syncope/rest/"},{"sha":"40ce764077bd0fa09a706ae87464d3c861a9b71f","filename":"archetype/src/main/resources/archetype-resources/core/src/main/resources/security.properties","status":"removed","additions":0,"deletions":19,"changes":19,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/70130de9bf9e275163853b29eacb1a8140acc9be/archetype%2Fsrc%2Fmain%2Fresources%2Farchetype-resources%2Fcore%2Fsrc%2Fmain%2Fresources%2Fsecurity.properties","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/70130de9bf9e275163853b29eacb1a8140acc9be/archetype%2Fsrc%2Fmain%2Fresources%2Farchetype-resources%2Fcore%2Fsrc%2Fmain%2Fresources%2Fsecurity.properties","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/archetype%2Fsrc%2Fmain%2Fresources%2Farchetype-resources%2Fcore%2Fsrc%2Fmain%2Fresources%2Fsecurity.properties?ref=70130de9bf9e275163853b29eacb1a8140acc9be","patch":"@@ -1,19 +0,0 @@\n-# Licensed to the Apache Software Foundation (ASF) under one\n-# or more contributor license agreements.  See the NOTICE file\n-# distributed with this work for additional information\n-# regarding copyright ownership.  The ASF licenses this file\n-# to you under the Apache License, Version 2.0 (the\n-# \"License\"); you may not use this file except in compliance\n-# with the License.  You may obtain a copy of the License at\n-#\n-#   http://www.apache.org/licenses/LICENSE-2.0\n-#\n-# Unless required by applicable law or agreed to in writing,\n-# software distributed under the License is distributed on an\n-# \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n-# KIND, either express or implied.  See the License for the\n-# specific language governing permissions and limitations\n-# under the License.\n-adminUser=admin\n-adminPassword=5baa61e4c9b93f3f0682250b6cf8331b7ee68fd8\n-adminPasswordAlgorithm=SHA1"},{"sha":"12f2c958cd7b88c22718206314979a353c2241b0","filename":"core/pom.xml","status":"modified","additions":0,"deletions":1,"changes":1,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/4fefb4d544415014b4451ff2872eb745cb7909eb/core%2Fpom.xml","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/4fefb4d544415014b4451ff2872eb745cb7909eb/core%2Fpom.xml","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fpom.xml?ref=4fefb4d544415014b4451ff2872eb745cb7909eb","patch":"@@ -734,7 +734,6 @@ under the License.\n                     <excludes>\n                       <exclude>content.xml</exclude>\n                       <exclude>persistence.properties</exclude>\n-                      <exclude>security.properties</exclude>\n                       <exclude>workflow.properties</exclude>\n                     </excludes>\n                   </resource>"},{"sha":"75d8bb493151da3504e4bba793c77f159d9668ff","filename":"core/src/main/java/org/apache/syncope/core/util/PasswordEncoder.java","status":"modified","additions":37,"deletions":2,"changes":39,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/4fefb4d544415014b4451ff2872eb745cb7909eb/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Futil%2FPasswordEncoder.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/4fefb4d544415014b4451ff2872eb745cb7909eb/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Futil%2FPasswordEncoder.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Futil%2FPasswordEncoder.java?ref=4fefb4d544415014b4451ff2872eb745cb7909eb","patch":"@@ -18,9 +18,12 @@\n  */\n package org.apache.syncope.core.util;\n \n+import java.io.IOException;\n+import java.io.InputStream;\n import java.io.UnsupportedEncodingException;\n import java.security.InvalidKeyException;\n import java.security.NoSuchAlgorithmException;\n+import java.util.Properties;\n import javax.crypto.BadPaddingException;\n import javax.crypto.Cipher;\n import javax.crypto.IllegalBlockSizeException;\n@@ -41,8 +44,41 @@ public final class PasswordEncoder {\n     private static SecretKeySpec keySpec;\n \n     static {\n+        String secretKey = null;\n+\n+        InputStream propStream = null;\n+        try {\n+            propStream = PasswordEncoder.class.getResourceAsStream(\"/security.properties\");\n+            Properties props = new Properties();\n+            props.load(propStream);\n+            secretKey = props.getProperty(\"secretKey\");\n+        } catch (Exception e) {\n+            LOG.error(\"Could not read secretKey\", e);\n+        } finally {\n+            if (propStream != null) {\n+                try {\n+                    propStream.close();\n+                } catch (IOException e) {\n+                    LOG.error(\"While closing property stream\", e);\n+                }\n+            }\n+        }\n+\n+        if (secretKey == null) {\n+            secretKey = \"1abcdefghilmnopqrstuvz2!\";\n+            LOG.debug(\"secretKey not found, reverting to default\");\n+        }\n+        if (secretKey.length() < 16) {\n+            StringBuilder secretKeyPadding = new StringBuilder(secretKey);\n+            for (int i = 0; i < 16 - secretKey.length(); i++) {\n+                secretKeyPadding.append('0');\n+            }\n+            secretKey = secretKeyPadding.toString();\n+            LOG.debug(\"secretKey too short, adding some random characters\");\n+        }\n+\n         try {\n-            keySpec = new SecretKeySpec(ArrayUtils.subarray(\"1abcdefghilmnopqrstuvz2!\".getBytes(\"UTF8\"), 0, 16), \"AES\");\n+            keySpec = new SecretKeySpec(ArrayUtils.subarray(secretKey.getBytes(\"UTF8\"), 0, 16), \"AES\");\n         } catch (Exception e) {\n             LOG.error(\"Error during key specification\", e);\n         }\n@@ -67,7 +103,6 @@ public static String encodePassword(final String password, final CipherAlgorithm\n                 encodedPassword = BCrypt.hashpw(password, BCrypt.gensalt());\n             } else {\n                 encodedPassword = getDigester(cipherAlgorithm).digest(password);\n-\n             }\n         }\n "},{"sha":"4bb3d93e7f60f7ea6f6cd902ad4cc2002b5df830","filename":"core/src/main/resources/security.properties","status":"modified","additions":1,"deletions":0,"changes":1,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/4fefb4d544415014b4451ff2872eb745cb7909eb/core%2Fsrc%2Fmain%2Fresources%2Fsecurity.properties","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/4fefb4d544415014b4451ff2872eb745cb7909eb/core%2Fsrc%2Fmain%2Fresources%2Fsecurity.properties","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fsrc%2Fmain%2Fresources%2Fsecurity.properties?ref=4fefb4d544415014b4451ff2872eb745cb7909eb","patch":"@@ -17,3 +17,4 @@\n adminUser=admin\n adminPassword=5baa61e4c9b93f3f0682250b6cf8331b7ee68fd8\n adminPasswordAlgorithm=SHA1\n+secretKey=${secretKey}"},{"sha":"69b5ddffa295f464a51687a7082cdd83f7dcadb2","filename":"pom.xml","status":"modified","additions":8,"deletions":5,"changes":13,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/4fefb4d544415014b4451ff2872eb745cb7909eb/pom.xml","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/4fefb4d544415014b4451ff2872eb745cb7909eb/pom.xml","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/pom.xml?ref=4fefb4d544415014b4451ff2872eb745cb7909eb","patch":"@@ -322,6 +322,9 @@ under the License.\n     <test.csvdir.path>${project.build.directory}/test-csvdir</test.csvdir.path>\n         \n     <project.build.sourceEncoding>UTF-8</project.build.sourceEncoding>\n+    \n+    <!-- static secret key, only used for build: generated overlays will override this during archetype:generate -->\n+    <secretKey>1abcdefghilmnopqrstuvz2!</secretKey>\n   </properties>\n \n   <dependencyManagement>\n@@ -363,11 +366,11 @@ under the License.\n         <version>${commons-jexl.version}</version>\n       </dependency>\n \n-\t  <dependency>\n-\t\t<groupId>javax.ws.rs</groupId>\n-    \t<artifactId>javax.ws.rs-api</artifactId>\n-    \t<version>2.0-m10</version>\n-    </dependency>\n+      <dependency>\n+        <groupId>javax.ws.rs</groupId>\n+        <artifactId>javax.ws.rs-api</artifactId>\n+        <version>2.0-m10</version>\n+      </dependency>\n       <dependency>\n         <groupId>commons-lang</groupId>\n         <artifactId>commons-lang</artifactId>"}]}