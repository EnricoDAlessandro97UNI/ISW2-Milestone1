{"sha":"3080e978f309884e78bbe3acf388319910deb6fc","node_id":"MDY6Q29tbWl0NjM2ODc5MDYyOjMwODBlOTc4ZjMwOTg4NGU3OGJiZTNhY2YzODgzMTk5MTBkZWI2ZmM=","commit":{"author":{"name":"Francesco Chicchiriccò","email":"ilgrosso@apache.org","date":"2014-12-01T12:53:49Z"},"committer":{"name":"Francesco Chicchiriccò","email":"ilgrosso@apache.org","date":"2014-12-01T12:53:49Z"},"message":"Merge branch '1_2_X'","tree":{"sha":"8093b37ce9875ebe807abe56d14dd2611b53f8c0","url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/git/trees/8093b37ce9875ebe807abe56d14dd2611b53f8c0"},"url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/git/commits/3080e978f309884e78bbe3acf388319910deb6fc","comment_count":0,"verification":{"verified":false,"reason":"unsigned","signature":null,"payload":null}},"url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/3080e978f309884e78bbe3acf388319910deb6fc","html_url":"https://github.com/EnricoDAlessandro97UNI/syncope/commit/3080e978f309884e78bbe3acf388319910deb6fc","comments_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/3080e978f309884e78bbe3acf388319910deb6fc/comments","author":{"login":"ilgrosso","id":1064664,"node_id":"MDQ6VXNlcjEwNjQ2NjQ=","avatar_url":"https://avatars.githubusercontent.com/u/1064664?v=4","gravatar_id":"","url":"https://api.github.com/users/ilgrosso","html_url":"https://github.com/ilgrosso","followers_url":"https://api.github.com/users/ilgrosso/followers","following_url":"https://api.github.com/users/ilgrosso/following{/other_user}","gists_url":"https://api.github.com/users/ilgrosso/gists{/gist_id}","starred_url":"https://api.github.com/users/ilgrosso/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ilgrosso/subscriptions","organizations_url":"https://api.github.com/users/ilgrosso/orgs","repos_url":"https://api.github.com/users/ilgrosso/repos","events_url":"https://api.github.com/users/ilgrosso/events{/privacy}","received_events_url":"https://api.github.com/users/ilgrosso/received_events","type":"User","site_admin":false},"committer":{"login":"ilgrosso","id":1064664,"node_id":"MDQ6VXNlcjEwNjQ2NjQ=","avatar_url":"https://avatars.githubusercontent.com/u/1064664?v=4","gravatar_id":"","url":"https://api.github.com/users/ilgrosso","html_url":"https://github.com/ilgrosso","followers_url":"https://api.github.com/users/ilgrosso/followers","following_url":"https://api.github.com/users/ilgrosso/following{/other_user}","gists_url":"https://api.github.com/users/ilgrosso/gists{/gist_id}","starred_url":"https://api.github.com/users/ilgrosso/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ilgrosso/subscriptions","organizations_url":"https://api.github.com/users/ilgrosso/orgs","repos_url":"https://api.github.com/users/ilgrosso/repos","events_url":"https://api.github.com/users/ilgrosso/events{/privacy}","received_events_url":"https://api.github.com/users/ilgrosso/received_events","type":"User","site_admin":false},"parents":[{"sha":"ac606b3f0fc6173e91d1418f1d50572625376ecf","url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/ac606b3f0fc6173e91d1418f1d50572625376ecf","html_url":"https://github.com/EnricoDAlessandro97UNI/syncope/commit/ac606b3f0fc6173e91d1418f1d50572625376ecf"},{"sha":"2c04c8ee0693b5869286a3e65afefde16488262d","url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/2c04c8ee0693b5869286a3e65afefde16488262d","html_url":"https://github.com/EnricoDAlessandro97UNI/syncope/commit/2c04c8ee0693b5869286a3e65afefde16488262d"}],"stats":{"total":91,"additions":45,"deletions":46},"files":[{"sha":"22001e548aa1b5fac7c979be758d9245e1ded2d5","filename":"core/src/main/java/org/apache/syncope/core/rest/controller/RoleController.java","status":"modified","additions":1,"deletions":2,"changes":3,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/3080e978f309884e78bbe3acf388319910deb6fc/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Frest%2Fcontroller%2FRoleController.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/3080e978f309884e78bbe3acf388319910deb6fc/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Frest%2Fcontroller%2FRoleController.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Frest%2Fcontroller%2FRoleController.java?ref=3080e978f309884e78bbe3acf388319910deb6fc","patch":"@@ -57,7 +57,6 @@\n import org.apache.syncope.core.workflow.role.RoleWorkflowAdapter;\n import org.springframework.beans.factory.annotation.Autowired;\n import org.springframework.security.access.prepost.PreAuthorize;\n-import org.springframework.security.core.context.SecurityContextHolder;\n import org.springframework.stereotype.Component;\n import org.springframework.transaction.annotation.Transactional;\n import org.springframework.transaction.interceptor.TransactionInterceptor;\n@@ -128,7 +127,7 @@ public RoleTO readSelf(final Long roleId) {\n         }\n \n         Set<Long> ownedRoleIds;\n-        SyncopeUser authUser = userDAO.find(SecurityContextHolder.getContext().getAuthentication().getName());\n+        SyncopeUser authUser = userDAO.find(EntitlementUtil.getAuthenticatedUsername());\n         if (authUser == null) {\n             ownedRoleIds = Collections.<Long>emptySet();\n         } else {"},{"sha":"933d6a547d834b5e87ba6e604a8c6dbadf145418","filename":"core/src/main/java/org/apache/syncope/core/rest/controller/UserWorkflowController.java","status":"modified","additions":2,"deletions":4,"changes":6,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/3080e978f309884e78bbe3acf388319910deb6fc/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Frest%2Fcontroller%2FUserWorkflowController.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/3080e978f309884e78bbe3acf388319910deb6fc/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Frest%2Fcontroller%2FUserWorkflowController.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Frest%2Fcontroller%2FUserWorkflowController.java?ref=3080e978f309884e78bbe3acf388319910deb6fc","patch":"@@ -35,7 +35,6 @@\n import org.apache.syncope.core.workflow.user.UserWorkflowAdapter;\n import org.springframework.beans.factory.annotation.Autowired;\n import org.springframework.security.access.prepost.PreAuthorize;\n-import org.springframework.security.core.context.SecurityContextHolder;\n import org.springframework.stereotype.Component;\n import org.springframework.transaction.annotation.Transactional;\n \n@@ -57,7 +56,7 @@ public class UserWorkflowController extends AbstractTransactionalController<Work\n     @PreAuthorize(\"hasRole('WORKFLOW_FORM_CLAIM')\")\n     @Transactional(rollbackFor = { Throwable.class })\n     public WorkflowFormTO claimForm(final String taskId) {\n-        return uwfAdapter.claimForm(taskId, SecurityContextHolder.getContext().getAuthentication().getName());\n+        return uwfAdapter.claimForm(taskId);\n     }\n \n     @PreAuthorize(\"hasRole('USER_UPDATE')\")\n@@ -100,8 +99,7 @@ public List<WorkflowFormTO> getForms(final Long userId, final String formName) {\n     @PreAuthorize(\"hasRole('WORKFLOW_FORM_SUBMIT')\")\n     @Transactional(rollbackFor = { Throwable.class })\n     public UserTO submitForm(final WorkflowFormTO form) {\n-        WorkflowResult<? extends AbstractAttributableMod> updated =\n-                uwfAdapter.submitForm(form, SecurityContextHolder.getContext().getAuthentication().getName());\n+        WorkflowResult<? extends AbstractAttributableMod> updated = uwfAdapter.submitForm(form);\n \n         // propByRes can be made empty by the workflow definition if no propagation should occur \n         // (for example, with rejected users)"},{"sha":"a37aacbef3dcc55be8614e0e5dcacf28e203b256","filename":"core/src/main/java/org/apache/syncope/core/rest/data/UserDataBinder.java","status":"modified","additions":1,"deletions":2,"changes":3,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/3080e978f309884e78bbe3acf388319910deb6fc/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Frest%2Fdata%2FUserDataBinder.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/3080e978f309884e78bbe3acf388319910deb6fc/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Frest%2Fdata%2FUserDataBinder.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Frest%2Fdata%2FUserDataBinder.java?ref=3080e978f309884e78bbe3acf388319910deb6fc","patch":"@@ -58,7 +58,6 @@\n import org.apache.syncope.core.util.EntitlementUtil;\n import org.apache.syncope.core.util.Encryptor;\n import org.springframework.beans.factory.annotation.Autowired;\n-import org.springframework.security.core.context.SecurityContextHolder;\n import org.springframework.stereotype.Component;\n import org.springframework.transaction.annotation.Transactional;\n \n@@ -154,7 +153,7 @@ public Set<String> getResourceNamesForUserId(final Long userId) {\n     public UserTO getAuthenticatedUserTO() {\n         final UserTO authUserTO;\n \n-        final String authUsername = SecurityContextHolder.getContext().getAuthentication().getName();\n+        final String authUsername = EntitlementUtil.getAuthenticatedUsername();\n         if (anonymousUser.equals(authUsername)) {\n             authUserTO = new UserTO();\n             authUserTO.setId(-2);"},{"sha":"2aa96d53077ae79d5f1ba12d87ba44e5a174507a","filename":"core/src/main/java/org/apache/syncope/core/util/VelocityEngineFactoryBean.java","status":"modified","additions":17,"deletions":13,"changes":30,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/3080e978f309884e78bbe3acf388319910deb6fc/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Futil%2FVelocityEngineFactoryBean.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/3080e978f309884e78bbe3acf388319910deb6fc/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Futil%2FVelocityEngineFactoryBean.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Futil%2FVelocityEngineFactoryBean.java?ref=3080e978f309884e78bbe3acf388319910deb6fc","patch":"@@ -37,8 +37,8 @@ public class VelocityEngineFactoryBean implements FactoryBean<VelocityEngine>, I\n \n     private ResourceLoader resourceLoader = new DefaultResourceLoader();\n \n-\tprivate boolean overrideLogging = true;\n-    \n+    private boolean overrideLogging = true;\n+\n     private VelocityEngine velocityEngine;\n \n     public ResourceLoader getResourceLoader() {\n@@ -50,15 +50,19 @@ public void setResourceLoader(final ResourceLoader resourceLoader) {\n     }\n \n     public boolean isOverrideLogging() {\n-\t\treturn overrideLogging;\n-\t}\n+        return overrideLogging;\n+    }\n \n-    /** Configure Velocity to use Commons Logging (true by default). */\n-\tpublic void setOverrideLogging(boolean overrideLogging) {\n-\t\tthis.overrideLogging = overrideLogging;\n-\t}\n+    /**\n+     * Configure Velocity to use Commons Logging (true by default).\n+     *\n+     * @param overrideLogging whether default Velocity logging should be overriden or not.\n+     */\n+    public void setOverrideLogging(final boolean overrideLogging) {\n+        this.overrideLogging = overrideLogging;\n+    }\n \n-\tprivate void createVelocityEngine() throws IOException, VelocityException {\n+    private void createVelocityEngine() throws IOException, VelocityException {\n         velocityEngine = new VelocityEngine();\n \n         velocityEngine.setProperty(\n@@ -70,10 +74,10 @@ private void createVelocityEngine() throws IOException, VelocityException {\n                 SpringVelocityResourceLoader.SPRING_RESOURCE_LOADER_CACHE, \"true\");\n         velocityEngine.setApplicationAttribute(\n                 SpringVelocityResourceLoader.SPRING_RESOURCE_LOADER, getResourceLoader());\n-        \n-\t\tif (this.overrideLogging) {\n-\t\t\tvelocityEngine.setProperty(RuntimeConstants.RUNTIME_LOG_LOGSYSTEM, new CommonsLogLogChute());\n-\t\t}\n+\n+        if (this.overrideLogging) {\n+            velocityEngine.setProperty(RuntimeConstants.RUNTIME_LOG_LOGSYSTEM, new CommonsLogLogChute());\n+        }\n \n         velocityEngine.init();\n     }"},{"sha":"b5cf7d1ccca69104ec28097701a18f0f148c33c0","filename":"core/src/main/java/org/apache/syncope/core/workflow/WorkflowAdapter.java","status":"modified","additions":2,"deletions":4,"changes":6,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/3080e978f309884e78bbe3acf388319910deb6fc/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fworkflow%2FWorkflowAdapter.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/3080e978f309884e78bbe3acf388319910deb6fc/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fworkflow%2FWorkflowAdapter.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fworkflow%2FWorkflowAdapter.java?ref=3080e978f309884e78bbe3acf388319910deb6fc","patch":"@@ -91,22 +91,20 @@ public interface WorkflowAdapter {\n      * Claim a form for a given user.\n      *\n      * @param taskId Workflow task to which the form is associated\n-     * @param username claiming username\n      * @return updated form\n      * @throws NotFoundException not found exception\n      * @throws WorkflowException workflow exception\n      */\n-    WorkflowFormTO claimForm(String taskId, String username) throws NotFoundException, WorkflowException;\n+    WorkflowFormTO claimForm(String taskId) throws NotFoundException, WorkflowException;\n \n     /**\n      * Submit a form.\n      *\n      * @param form to be submitted\n-     * @param username submitting username\n      * @return user updated by this form submit\n      * @throws NotFoundException not found exception\n      * @throws WorkflowException workflow exception\n      */\n-    WorkflowResult<? extends AbstractAttributableMod> submitForm(WorkflowFormTO form, String username)\n+    WorkflowResult<? extends AbstractAttributableMod> submitForm(WorkflowFormTO form)\n             throws NotFoundException, WorkflowException;\n }"},{"sha":"fa648ba9dcb530bf463e1609a2392bbe84763a65","filename":"core/src/main/java/org/apache/syncope/core/workflow/role/NoOpRoleWorkflowAdapter.java","status":"modified","additions":2,"deletions":2,"changes":4,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/3080e978f309884e78bbe3acf388319910deb6fc/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fworkflow%2Frole%2FNoOpRoleWorkflowAdapter.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/3080e978f309884e78bbe3acf388319910deb6fc/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fworkflow%2Frole%2FNoOpRoleWorkflowAdapter.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fworkflow%2Frole%2FNoOpRoleWorkflowAdapter.java?ref=3080e978f309884e78bbe3acf388319910deb6fc","patch":"@@ -117,14 +117,14 @@ public WorkflowFormTO getForm(final String workflowId)\n     }\n \n     @Override\n-    public WorkflowFormTO claimForm(final String taskId, final String username)\n+    public WorkflowFormTO claimForm(final String taskId)\n             throws NotFoundException, WorkflowException {\n \n         throw new WorkflowException(new UnsupportedOperationException(\"Not supported.\"));\n     }\n \n     @Override\n-    public WorkflowResult<RoleMod> submitForm(final WorkflowFormTO form, final String username)\n+    public WorkflowResult<RoleMod> submitForm(final WorkflowFormTO form)\n             throws NotFoundException, WorkflowException {\n \n         throw new WorkflowException(new UnsupportedOperationException(\"Not supported.\"));"},{"sha":"1ffc4c71c91e1539ae8c1a2308db0ef3d2d9c8e2","filename":"core/src/main/java/org/apache/syncope/core/workflow/user/NoOpUserWorkflowAdapter.java","status":"modified","additions":2,"deletions":2,"changes":4,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/3080e978f309884e78bbe3acf388319910deb6fc/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fworkflow%2Fuser%2FNoOpUserWorkflowAdapter.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/3080e978f309884e78bbe3acf388319910deb6fc/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fworkflow%2Fuser%2FNoOpUserWorkflowAdapter.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fworkflow%2Fuser%2FNoOpUserWorkflowAdapter.java?ref=3080e978f309884e78bbe3acf388319910deb6fc","patch":"@@ -216,14 +216,14 @@ public WorkflowFormTO getForm(final String workflowId)\n     }\n \n     @Override\n-    public WorkflowFormTO claimForm(final String taskId, final String username)\n+    public WorkflowFormTO claimForm(final String taskId)\n             throws NotFoundException, WorkflowException {\n \n         throw new WorkflowException(new UnsupportedOperationException(\"Not supported.\"));\n     }\n \n     @Override\n-    public WorkflowResult<UserMod> submitForm(final WorkflowFormTO form, final String username)\n+    public WorkflowResult<UserMod> submitForm(final WorkflowFormTO form)\n             throws NotFoundException, WorkflowException {\n \n         throw new WorkflowException(new UnsupportedOperationException(\"Not supported.\"));"},{"sha":"f6cc3222df2bd9d50086b8986def7192d58a69b0","filename":"core/src/main/java/org/apache/syncope/core/workflow/user/activiti/ActivitiUserWorkflowAdapter.java","status":"modified","additions":18,"deletions":17,"changes":35,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/3080e978f309884e78bbe3acf388319910deb6fc/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fworkflow%2Fuser%2Factiviti%2FActivitiUserWorkflowAdapter.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/3080e978f309884e78bbe3acf388319910deb6fc/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fworkflow%2Fuser%2Factiviti%2FActivitiUserWorkflowAdapter.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fworkflow%2Fuser%2Factiviti%2FActivitiUserWorkflowAdapter.java?ref=3080e978f309884e78bbe3acf388319910deb6fc","patch":"@@ -687,7 +687,7 @@ private WorkflowFormTO getFormTO(\n     public List<WorkflowFormTO> getForms() {\n         List<WorkflowFormTO> forms = new ArrayList<WorkflowFormTO>();\n \n-        String authUser = EntitlementUtil.getAuthenticatedUsername();\n+        final String authUser = EntitlementUtil.getAuthenticatedUsername();\n         if (adminUser.equals(authUser)) {\n             forms.addAll(getForms(taskService.createTaskQuery().\n                     taskVariableValueEquals(TASK_IS_FORM, Boolean.TRUE)));\n@@ -775,7 +775,7 @@ public WorkflowFormTO getForm(final String workflowId)\n         return result;\n     }\n \n-    private Map.Entry<Task, TaskFormData> checkTask(final String taskId, final String username) {\n+    private Map.Entry<Task, TaskFormData> checkTask(final String taskId, final String authUser) {\n         Task task;\n         try {\n             task = taskService.createTaskQuery().taskId(taskId).singleResult();\n@@ -790,10 +790,10 @@ private Map.Entry<Task, TaskFormData> checkTask(final String taskId, final Strin\n             throw new NotFoundException(\"Form for Activiti Task \" + taskId, e);\n         }\n \n-        if (!adminUser.equals(username)) {\n-            SyncopeUser user = userDAO.find(username);\n+        if (!adminUser.equals(authUser)) {\n+            SyncopeUser user = userDAO.find(authUser);\n             if (user == null) {\n-                throw new NotFoundException(\"Syncope User \" + username);\n+                throw new NotFoundException(\"Syncope User \" + authUser);\n             }\n         }\n \n@@ -802,22 +802,23 @@ private Map.Entry<Task, TaskFormData> checkTask(final String taskId, final Strin\n \n     @Transactional\n     @Override\n-    public WorkflowFormTO claimForm(final String taskId, final String username)\n+    public WorkflowFormTO claimForm(final String taskId)\n             throws WorkflowException {\n \n-        Map.Entry<Task, TaskFormData> checked = checkTask(taskId, username);\n+        final String authUser = EntitlementUtil.getAuthenticatedUsername();\n+        Map.Entry<Task, TaskFormData> checked = checkTask(taskId, authUser);\n \n-        if (!adminUser.equals(username)) {\n-            List<Task> tasksForUser = taskService.createTaskQuery().taskId(taskId).taskCandidateUser(username).list();\n+        if (!adminUser.equals(authUser)) {\n+            List<Task> tasksForUser = taskService.createTaskQuery().taskId(taskId).taskCandidateUser(authUser).list();\n             if (tasksForUser.isEmpty()) {\n                 throw new WorkflowException(\n-                        new IllegalArgumentException(username + \" is not candidate for task \" + taskId));\n+                        new IllegalArgumentException(authUser + \" is not candidate for task \" + taskId));\n             }\n         }\n \n         Task task;\n         try {\n-            taskService.setOwner(taskId, username);\n+            taskService.setOwner(taskId, authUser);\n             task = taskService.createTaskQuery().taskId(taskId).singleResult();\n         } catch (ActivitiException e) {\n             throw new WorkflowException(\"While reading task \" + taskId, e);\n@@ -828,14 +829,15 @@ public WorkflowFormTO claimForm(final String taskId, final String username)\n \n     @Transactional\n     @Override\n-    public WorkflowResult<UserMod> submitForm(final WorkflowFormTO form, final String username)\n+    public WorkflowResult<UserMod> submitForm(final WorkflowFormTO form)\n             throws WorkflowException {\n \n-        Map.Entry<Task, TaskFormData> checked = checkTask(form.getTaskId(), username);\n+        final String authUser = EntitlementUtil.getAuthenticatedUsername();\n+        Map.Entry<Task, TaskFormData> checked = checkTask(form.getTaskId(), authUser);\n \n-        if (!checked.getKey().getOwner().equals(username)) {\n+        if (!checked.getKey().getOwner().equals(authUser)) {\n             throw new WorkflowException(new IllegalArgumentException(\"Task \" + form.getTaskId() + \" assigned to \"\n-                    + checked.getKey().getOwner() + \" but submitted by \" + username));\n+                    + checked.getKey().getOwner() + \" but submitted by \" + authUser));\n         }\n \n         SyncopeUser user = userDAO.findByWorkflowId(checked.getKey().getProcessInstanceId());\n@@ -846,8 +848,7 @@ public WorkflowResult<UserMod> submitForm(final WorkflowFormTO form, final Strin\n         Set<String> preTasks = getPerformedTasks(user);\n         try {\n             formService.submitTaskFormData(form.getTaskId(), form.getPropertiesForSubmit());\n-            runtimeService.setVariable(\n-                    user.getWorkflowId(), FORM_SUBMITTER, EntitlementUtil.getAuthenticatedUsername());\n+            runtimeService.setVariable(user.getWorkflowId(), FORM_SUBMITTER, authUser);\n         } catch (ActivitiException e) {\n             throwException(e, \"While submitting form for task \" + form.getTaskId());\n         }"}]}