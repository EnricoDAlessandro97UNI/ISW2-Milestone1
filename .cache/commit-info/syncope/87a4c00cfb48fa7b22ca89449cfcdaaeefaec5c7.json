{"sha":"87a4c00cfb48fa7b22ca89449cfcdaaeefaec5c7","node_id":"MDY6Q29tbWl0NjM2ODc5MDYyOjg3YTRjMDBjZmI0OGZhN2IyMmNhODk0NDljZmNkYWFlZWZhZWM1Yzc=","commit":{"author":{"name":"Francesco Chicchiriccò","email":"ilgrosso@apache.org","date":"2013-04-19T15:14:03Z"},"committer":{"name":"Francesco Chicchiriccò","email":"ilgrosso@apache.org","date":"2013-04-19T15:14:03Z"},"message":"[SYNCOPE-364] Merge from 1_1_X\n\ngit-svn-id: https://svn.apache.org/repos/asf/syncope/trunk@1469883 13f79535-47bb-0310-9956-ffa450edef68","tree":{"sha":"dade8ebc898dd25ae5e251799ea524def97dc30a","url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/git/trees/dade8ebc898dd25ae5e251799ea524def97dc30a"},"url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/git/commits/87a4c00cfb48fa7b22ca89449cfcdaaeefaec5c7","comment_count":0,"verification":{"verified":false,"reason":"unsigned","signature":null,"payload":null}},"url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/87a4c00cfb48fa7b22ca89449cfcdaaeefaec5c7","html_url":"https://github.com/EnricoDAlessandro97UNI/syncope/commit/87a4c00cfb48fa7b22ca89449cfcdaaeefaec5c7","comments_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/87a4c00cfb48fa7b22ca89449cfcdaaeefaec5c7/comments","author":{"login":"ilgrosso","id":1064664,"node_id":"MDQ6VXNlcjEwNjQ2NjQ=","avatar_url":"https://avatars.githubusercontent.com/u/1064664?v=4","gravatar_id":"","url":"https://api.github.com/users/ilgrosso","html_url":"https://github.com/ilgrosso","followers_url":"https://api.github.com/users/ilgrosso/followers","following_url":"https://api.github.com/users/ilgrosso/following{/other_user}","gists_url":"https://api.github.com/users/ilgrosso/gists{/gist_id}","starred_url":"https://api.github.com/users/ilgrosso/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ilgrosso/subscriptions","organizations_url":"https://api.github.com/users/ilgrosso/orgs","repos_url":"https://api.github.com/users/ilgrosso/repos","events_url":"https://api.github.com/users/ilgrosso/events{/privacy}","received_events_url":"https://api.github.com/users/ilgrosso/received_events","type":"User","site_admin":false},"committer":{"login":"ilgrosso","id":1064664,"node_id":"MDQ6VXNlcjEwNjQ2NjQ=","avatar_url":"https://avatars.githubusercontent.com/u/1064664?v=4","gravatar_id":"","url":"https://api.github.com/users/ilgrosso","html_url":"https://github.com/ilgrosso","followers_url":"https://api.github.com/users/ilgrosso/followers","following_url":"https://api.github.com/users/ilgrosso/following{/other_user}","gists_url":"https://api.github.com/users/ilgrosso/gists{/gist_id}","starred_url":"https://api.github.com/users/ilgrosso/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ilgrosso/subscriptions","organizations_url":"https://api.github.com/users/ilgrosso/orgs","repos_url":"https://api.github.com/users/ilgrosso/repos","events_url":"https://api.github.com/users/ilgrosso/events{/privacy}","received_events_url":"https://api.github.com/users/ilgrosso/received_events","type":"User","site_admin":false},"parents":[{"sha":"71550a66e999af49729687fd90e72b39c186ba0b","url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/71550a66e999af49729687fd90e72b39c186ba0b","html_url":"https://github.com/EnricoDAlessandro97UNI/syncope/commit/71550a66e999af49729687fd90e72b39c186ba0b"},{"sha":"41f8139113d1077feb667f6b33290d23c04a2279","url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/41f8139113d1077feb667f6b33290d23c04a2279","html_url":"https://github.com/EnricoDAlessandro97UNI/syncope/commit/41f8139113d1077feb667f6b33290d23c04a2279"}],"stats":{"total":62,"additions":44,"deletions":18},"files":[{"sha":"9711ca4c13744f23c163ad348dd2087102b3f56d","filename":"CHANGES","status":"modified","additions":11,"deletions":0,"changes":11,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/87a4c00cfb48fa7b22ca89449cfcdaaeefaec5c7/CHANGES","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/87a4c00cfb48fa7b22ca89449cfcdaaeefaec5c7/CHANGES","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/CHANGES?ref=87a4c00cfb48fa7b22ca89449cfcdaaeefaec5c7","patch":"@@ -185,6 +185,17 @@ Release Notes - Syncope - Version 1.1.0\n     * [SYNCOPE-326] - Check console style (CSS) on Internet Explorer\n     * [SYNCOPE-350] - Provide Getting started / Standalone distribution\n \n+Release Notes - Syncope - Version 1.0.8\n+================================================================================\n+** Bug\n+    * [SYNCOPE-351] - Errors when editing role membership assignment in notifications (About and Recipients)\n+\n+** Improvement\n+    * [SYNCOPE-348] - Email address validator regexp\n+\n+** Wish\n+    * [SYNCOPE-340] - Translate items of Syncope UI and config files labels for Portuguese language\n+\n Release Notes - Syncope - Version 1.0.7\n ================================================================================\n ** Bug"},{"sha":"5e7026b718eb1acb7c0dccd5d4e74e8bbab7e0f9","filename":"core/src/main/java/org/apache/syncope/core/rest/controller/UserController.java","status":"modified","additions":15,"deletions":12,"changes":27,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/87a4c00cfb48fa7b22ca89449cfcdaaeefaec5c7/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Frest%2Fcontroller%2FUserController.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/87a4c00cfb48fa7b22ca89449cfcdaaeefaec5c7/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Frest%2Fcontroller%2FUserController.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Frest%2Fcontroller%2FUserController.java?ref=87a4c00cfb48fa7b22ca89449cfcdaaeefaec5c7","patch":"@@ -602,19 +602,22 @@ public UserTO submitForm(@RequestBody final WorkflowFormTO form) {\n         LOG.debug(\"About to process form {}\", form);\n \n         WorkflowResult<Map.Entry<Long, String>> updated = uwfAdapter.submitForm(form,\n-                SecurityContextHolder.getContext().\n-                getAuthentication().getName());\n+                SecurityContextHolder.getContext().getAuthentication().getName());\n \n-        List<PropagationTask> tasks = propagationManager.getUserUpdateTaskIds(\n-                new WorkflowResult<Map.Entry<Long, Boolean>>(\n-                new SimpleEntry<Long, Boolean>(updated.getResult().getKey(), Boolean.TRUE),\n-                updated.getPropByRes(),\n-                updated.getPerformedTasks()),\n-                updated.getResult().getValue(),\n-                null,\n-                null,\n-                null);\n-        taskExecutor.execute(tasks);\n+        // propByRes can be made empty by the workflow definition is no propagation should occur \n+        // (for example, with rejected users)\n+        if (updated.getPropByRes() != null && !updated.getPropByRes().isEmpty()) {\n+            List<PropagationTask> tasks = propagationManager.getUserUpdateTaskIds(\n+                    new WorkflowResult<Map.Entry<Long, Boolean>>(\n+                    new SimpleEntry<Long, Boolean>(updated.getResult().getKey(), Boolean.TRUE),\n+                    updated.getPropByRes(),\n+                    updated.getPerformedTasks()),\n+                    updated.getResult().getValue(),\n+                    null,\n+                    null,\n+                    null);\n+            taskExecutor.execute(tasks);\n+        }\n \n         final UserTO savedTO = binder.getUserTO(updated.getResult().getKey());\n "},{"sha":"e628dfbea5ad0d2dbc211ee30d0b7e208419e4b8","filename":"core/src/main/java/org/apache/syncope/core/workflow/user/activiti/ActivitiUserWorkflowAdapter.java","status":"modified","additions":2,"deletions":2,"changes":4,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/87a4c00cfb48fa7b22ca89449cfcdaaeefaec5c7/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fworkflow%2Fuser%2Factiviti%2FActivitiUserWorkflowAdapter.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/87a4c00cfb48fa7b22ca89449cfcdaaeefaec5c7/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fworkflow%2Fuser%2Factiviti%2FActivitiUserWorkflowAdapter.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fworkflow%2Fuser%2Factiviti%2FActivitiUserWorkflowAdapter.java?ref=87a4c00cfb48fa7b22ca89449cfcdaaeefaec5c7","patch":"@@ -650,8 +650,8 @@ public WorkflowResult<Map.Entry<Long, String>> submitForm(final WorkflowFormTO f\n         SyncopeUser updated = userDAO.save(user);\n \n         // see if there is any propagation to be done\n-        PropagationByResource propByRes = (PropagationByResource) runtimeService.getVariable(user.getWorkflowId(),\n-                PROP_BY_RESOURCE);\n+        PropagationByResource propByRes =\n+                (PropagationByResource) runtimeService.getVariable(user.getWorkflowId(), PROP_BY_RESOURCE);\n \n         // fetch - if available - the encrpted password\n         String clearPassword = null;"},{"sha":"cb836f6969bd2a882db18cf9fb55e367a695f1ba","filename":"core/src/main/resources/userWorkflow.bpmn20.xml","status":"modified","additions":1,"deletions":0,"changes":1,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/87a4c00cfb48fa7b22ca89449cfcdaaeefaec5c7/core%2Fsrc%2Fmain%2Fresources%2FuserWorkflow.bpmn20.xml","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/87a4c00cfb48fa7b22ca89449cfcdaaeefaec5c7/core%2Fsrc%2Fmain%2Fresources%2FuserWorkflow.bpmn20.xml","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fsrc%2Fmain%2Fresources%2FuserWorkflow.bpmn20.xml?ref=87a4c00cfb48fa7b22ca89449cfcdaaeefaec5c7","patch":"@@ -162,6 +162,7 @@ under the License.\n       <!-- Do something with rejectReason -->\n       <script>\n         def scriptVar = rejectReason\n+        execution.setVariable(\"propByResource\", null);\n       </script>\n     </scriptTask>\n         "},{"sha":"dc288f0850e84fb9c53f0da7ad1aa83454cd8782","filename":"core/src/test/java/org/apache/syncope/core/rest/UserTestITCase.java","status":"modified","additions":15,"deletions":4,"changes":19,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/87a4c00cfb48fa7b22ca89449cfcdaaeefaec5c7/core%2Fsrc%2Ftest%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Frest%2FUserTestITCase.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/87a4c00cfb48fa7b22ca89449cfcdaaeefaec5c7/core%2Fsrc%2Ftest%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Frest%2FUserTestITCase.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fsrc%2Ftest%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Frest%2FUserTestITCase.java?ref=87a4c00cfb48fa7b22ca89449cfcdaaeefaec5c7","patch":"@@ -560,6 +560,7 @@ public void createWithReject() {\n         Assume.assumeTrue(ActivitiDetector.isActivitiEnabledForUsers());\n \n         UserTO userTO = getUniqueSampleTO(\"createWithReject@syncope.apache.org\");\n+        userTO.addResource(\"resource-testdb\");\n \n         // User with role 9 are defined in workflow as subject to approval\n         MembershipTO membershipTO = new MembershipTO();\n@@ -575,7 +576,6 @@ public void createWithReject() {\n \n         // 2. request if there is any pending task for user just created\n         WorkflowFormTO form = userWorkflowService.getFormForUser(userTO.getId());\n-\n         assertNotNull(form);\n         assertNotNull(form.getUserId());\n         assertEquals(userTO.getId(), form.getUserId());\n@@ -611,6 +611,17 @@ public void createWithReject() {\n         assertNotNull(userTO);\n         assertEquals(\"rejected\", userTO.getStatus());\n \n+        // 6. check that rejected user was not propagated to external resource (SYNCOPE-364)\n+        JdbcTemplate jdbcTemplate = new JdbcTemplate(testDataSource);\n+        Exception exception = null;\n+        try {\n+            jdbcTemplate.queryForObject(\"SELECT id FROM test WHERE id=?\",\n+                    new String[] {userTO.getUsername()}, Integer.class);\n+        } catch (EmptyResultDataAccessException e) {\n+            exception = e;\n+        }\n+        assertNotNull(exception);\n+\n         // reset admin credentials for restTemplate\n         super.resetRestTemplate();\n     }\n@@ -619,8 +630,6 @@ public void createWithReject() {\n     public void createWithApproval() {\n         Assume.assumeTrue(ActivitiDetector.isActivitiEnabledForUsers());\n \n-        JdbcTemplate jdbcTemplate = new JdbcTemplate(testDataSource);\n-\n         UserTO userTO = getUniqueSampleTO(\"createWithApproval@syncope.apache.org\");\n         userTO.addResource(RESOURCE_NAME_TESTDB);\n \n@@ -639,10 +648,12 @@ public void createWithApproval() {\n \n         assertTrue(userTO.getPropagationStatusTOs().isEmpty());\n \n+        JdbcTemplate jdbcTemplate = new JdbcTemplate(testDataSource);\n+\n         Exception exception = null;\n         try {\n             jdbcTemplate.queryForObject(\"SELECT id FROM test WHERE id=?\",\n-                    new String[]{userTO.getUsername()}, Integer.class);\n+                    new String[] {userTO.getUsername()}, Integer.class);\n         } catch (EmptyResultDataAccessException e) {\n             exception = e;\n         }"}]}