{"sha":"628060a9d53b4bfcde79ca7891f152ec0e76fdbd","node_id":"MDY6Q29tbWl0NjM2ODc5MDYyOjYyODA2MGE5ZDUzYjRiZmNkZTc5Y2E3ODkxZjE1MmVjMGU3NmZkYmQ=","commit":{"author":{"name":"Francesco Chicchiriccò","email":"ilgrosso@apache.org","date":"2020-01-28T09:32:46Z"},"committer":{"name":"Francesco Chicchiriccò","email":"ilgrosso@apache.org","date":"2020-01-28T09:32:54Z"},"message":"[SYNCOPE-1536] Stopping FileAlterationMonitor instance during SyncopeEnduserApplication#onDestroy","tree":{"sha":"d08330a2d94b6afd9cc6820058f55b05d0f8edb7","url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/git/trees/d08330a2d94b6afd9cc6820058f55b05d0f8edb7"},"url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/git/commits/628060a9d53b4bfcde79ca7891f152ec0e76fdbd","comment_count":0,"verification":{"verified":false,"reason":"unsigned","signature":null,"payload":null}},"url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/628060a9d53b4bfcde79ca7891f152ec0e76fdbd","html_url":"https://github.com/EnricoDAlessandro97UNI/syncope/commit/628060a9d53b4bfcde79ca7891f152ec0e76fdbd","comments_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/628060a9d53b4bfcde79ca7891f152ec0e76fdbd/comments","author":{"login":"ilgrosso","id":1064664,"node_id":"MDQ6VXNlcjEwNjQ2NjQ=","avatar_url":"https://avatars.githubusercontent.com/u/1064664?v=4","gravatar_id":"","url":"https://api.github.com/users/ilgrosso","html_url":"https://github.com/ilgrosso","followers_url":"https://api.github.com/users/ilgrosso/followers","following_url":"https://api.github.com/users/ilgrosso/following{/other_user}","gists_url":"https://api.github.com/users/ilgrosso/gists{/gist_id}","starred_url":"https://api.github.com/users/ilgrosso/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ilgrosso/subscriptions","organizations_url":"https://api.github.com/users/ilgrosso/orgs","repos_url":"https://api.github.com/users/ilgrosso/repos","events_url":"https://api.github.com/users/ilgrosso/events{/privacy}","received_events_url":"https://api.github.com/users/ilgrosso/received_events","type":"User","site_admin":false},"committer":{"login":"ilgrosso","id":1064664,"node_id":"MDQ6VXNlcjEwNjQ2NjQ=","avatar_url":"https://avatars.githubusercontent.com/u/1064664?v=4","gravatar_id":"","url":"https://api.github.com/users/ilgrosso","html_url":"https://github.com/ilgrosso","followers_url":"https://api.github.com/users/ilgrosso/followers","following_url":"https://api.github.com/users/ilgrosso/following{/other_user}","gists_url":"https://api.github.com/users/ilgrosso/gists{/gist_id}","starred_url":"https://api.github.com/users/ilgrosso/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ilgrosso/subscriptions","organizations_url":"https://api.github.com/users/ilgrosso/orgs","repos_url":"https://api.github.com/users/ilgrosso/repos","events_url":"https://api.github.com/users/ilgrosso/events{/privacy}","received_events_url":"https://api.github.com/users/ilgrosso/received_events","type":"User","site_admin":false},"parents":[{"sha":"74f539be5a17cd7f4e6a581aa6822e2af36cf497","url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/74f539be5a17cd7f4e6a581aa6822e2af36cf497","html_url":"https://github.com/EnricoDAlessandro97UNI/syncope/commit/74f539be5a17cd7f4e6a581aa6822e2af36cf497"}],"stats":{"total":22,"additions":16,"deletions":6},"files":[{"sha":"edc4ae40c9d85cf54c9fb4a532b831ca3862013a","filename":"client/idrepo/enduser/src/main/java/org/apache/syncope/client/enduser/SyncopeWebApplication.java","status":"modified","additions":16,"deletions":6,"changes":22,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/628060a9d53b4bfcde79ca7891f152ec0e76fdbd/client%2Fidrepo%2Fenduser%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fclient%2Fenduser%2FSyncopeWebApplication.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/628060a9d53b4bfcde79ca7891f152ec0e76fdbd/client%2Fidrepo%2Fenduser%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fclient%2Fenduser%2FSyncopeWebApplication.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/client%2Fidrepo%2Fenduser%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fclient%2Fenduser%2FSyncopeWebApplication.java?ref=628060a9d53b4bfcde79ca7891f152ec0e76fdbd","patch":"@@ -133,6 +133,8 @@ public static SyncopeWebApplication get() {\n \n     private Integer maxUploadFileSizeMB;\n \n+    private FileAlterationMonitor customFormAttributesMonitor;\n+\n     private Map<String, CustomAttributesInfo> customFormAttributes;\n \n     protected void setSecurityHeaders(final Properties props, final WebResponse response) {\n@@ -207,7 +209,7 @@ protected void init() {\n                     : new FileAlterationObserver(getClass().getResource('/' + CUSTOM_FORM_ATTRIBUTES_FILE).getFile(),\n                             pathname -> StringUtils.contains(pathname.getPath(), CUSTOM_FORM_ATTRIBUTES_FILE));\n \n-            FileAlterationMonitor monitor = new FileAlterationMonitor(5000);\n+            customFormAttributesMonitor = new FileAlterationMonitor(5000);\n \n             FileAlterationListener listener = new FileAlterationListenerAdaptor() {\n \n@@ -220,7 +222,8 @@ public void onFileChange(final File file) {\n                                 new TypeReference<HashMap<String, CustomAttributesInfo>>() {\n                         });\n                     } catch (IOException e) {\n-                        e.printStackTrace(System.err);\n+                        LOG.error(\"{} While reading app customization configuration.\",\n+                                CUSTOM_FORM_ATTRIBUTES_FILE, e);\n                     }\n                 }\n \n@@ -233,7 +236,8 @@ public void onFileCreate(final File file) {\n                                 new TypeReference<HashMap<String, CustomAttributesInfo>>() {\n                         });\n                     } catch (IOException e) {\n-                        e.printStackTrace(System.err);\n+                        LOG.error(\"{} While reading app customization configuration.\",\n+                                CUSTOM_FORM_ATTRIBUTES_FILE, e);\n                     }\n                 }\n \n@@ -246,8 +250,8 @@ public void onFileDelete(final File file) {\n             };\n \n             observer.addListener(listener);\n-            monitor.addObserver(observer);\n-            monitor.start();\n+            customFormAttributesMonitor.addObserver(observer);\n+            customFormAttributesMonitor.start();\n         } catch (Exception e) {\n             throw new WicketRuntimeException(\"Could not read \" + CUSTOM_FORM_ATTRIBUTES_FILE, e);\n         }\n@@ -359,7 +363,13 @@ public IResource getResource() {\n     protected void onDestroy() {\n         serviceOps.unregister(getNetworkService());\n \n-        super.onDestroy();\n+        if (customFormAttributesMonitor != null) {\n+            try {\n+                customFormAttributesMonitor.stop(0);\n+            } catch (Exception e) {\n+                LOG.error(\"{} While stopping file monitor\", CUSTOM_FORM_ATTRIBUTES_FILE, e);\n+            }\n+        }\n     }\n \n     @Override"}]}