{"sha":"8553f762b8957cd591f34055df3749058a0ded3d","node_id":"MDY6Q29tbWl0NjM2ODc5MDYyOjg1NTNmNzYyYjg5NTdjZDU5MWYzNDA1NWRmMzc0OTA1OGEwZGVkM2Q=","commit":{"author":{"name":"Unknown","email":"unknown@apache.org","date":"2010-06-21T10:56:36Z"},"committer":{"name":"Unknown","email":"unknown@apache.org","date":"2010-06-21T10:56:36Z"},"message":"Start refactoring for issue #11\n\ngit-svn-id: https://svn.apache.org/repos/asf/incubator/syncope/trunk@1246217 13f79535-47bb-0310-9956-ffa450edef68","tree":{"sha":"4729691f2303f4ea182863433f43c34a51f71430","url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/git/trees/4729691f2303f4ea182863433f43c34a51f71430"},"url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/git/commits/8553f762b8957cd591f34055df3749058a0ded3d","comment_count":0,"verification":{"verified":false,"reason":"unsigned","signature":null,"payload":null}},"url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/8553f762b8957cd591f34055df3749058a0ded3d","html_url":"https://github.com/EnricoDAlessandro97UNI/syncope/commit/8553f762b8957cd591f34055df3749058a0ded3d","comments_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/8553f762b8957cd591f34055df3749058a0ded3d/comments","author":null,"committer":null,"parents":[{"sha":"14370817a795ab98e3d57b38f9428e5ef0d82e4e","url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/14370817a795ab98e3d57b38f9428e5ef0d82e4e","html_url":"https://github.com/EnricoDAlessandro97UNI/syncope/commit/14370817a795ab98e3d57b38f9428e5ef0d82e4e"}],"stats":{"total":250,"additions":105,"deletions":145},"files":[{"sha":"d826ac72aa3ba75d15b9d30fc2192f81248a500e","filename":"core/src/main/java/org/syncope/core/persistence/beans/SyncopeRole.java","status":"modified","additions":28,"deletions":7,"changes":35,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/8553f762b8957cd591f34055df3749058a0ded3d/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fcore%2Fpersistence%2Fbeans%2FSyncopeRole.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/8553f762b8957cd591f34055df3749058a0ded3d/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fcore%2Fpersistence%2Fbeans%2FSyncopeRole.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fcore%2Fpersistence%2Fbeans%2FSyncopeRole.java?ref=8553f762b8957cd591f34055df3749058a0ded3d","patch":"@@ -17,16 +17,25 @@\n import java.util.HashSet;\n import java.util.Set;\n import javax.persistence.CascadeType;\n-import javax.persistence.EmbeddedId;\n import javax.persistence.Entity;\n import javax.persistence.FetchType;\n+import javax.persistence.GeneratedValue;\n+import javax.persistence.GenerationType;\n+import javax.persistence.Id;\n import javax.persistence.ManyToMany;\n+import javax.persistence.Table;\n+import javax.persistence.UniqueConstraint;\n \n @Entity\n+@Table(uniqueConstraints =\n+@UniqueConstraint(columnNames = {\"name\", \"parent\"}))\n public class SyncopeRole extends AbstractAttributableBean {\n \n-    @EmbeddedId\n-    private SyncopeRolePK syncopeRolePK;\n+    @Id\n+    @GeneratedValue(strategy = GenerationType.AUTO)\n+    private Long id;\n+    private String name;\n+    private String parent;\n     @ManyToMany(cascade = CascadeType.ALL, fetch = FetchType.EAGER,\n     mappedBy = \"roles\")\n     private Set<SyncopeUser> users;\n@@ -38,12 +47,24 @@ public SyncopeRole() {\n         entitlements = new HashSet<Entitlement>();\n     }\n \n-    public SyncopeRolePK getSyncopeRolePK() {\n-        return syncopeRolePK;\n+    public Long getId() {\n+        return id;\n     }\n \n-    public void setSyncopeRolePK(SyncopeRolePK syncopeRolePK) {\n-        this.syncopeRolePK = syncopeRolePK;\n+    public String getName() {\n+        return name;\n+    }\n+\n+    public void setName(String name) throws IllegalArgumentException {\n+        this.name = name;\n+    }\n+\n+    public String getParent() {\n+        return parent;\n+    }\n+\n+    public void setParent(String parent) {\n+        this.parent = parent;\n     }\n \n     public boolean addEntitlement(Entitlement entitlement) {"},{"sha":"57b975e8c0685e3dfe2f54573625590ba2e078e6","filename":"core/src/main/java/org/syncope/core/persistence/beans/SyncopeRolePK.java","status":"removed","additions":0,"deletions":60,"changes":60,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/14370817a795ab98e3d57b38f9428e5ef0d82e4e/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fcore%2Fpersistence%2Fbeans%2FSyncopeRolePK.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/14370817a795ab98e3d57b38f9428e5ef0d82e4e/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fcore%2Fpersistence%2Fbeans%2FSyncopeRolePK.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fcore%2Fpersistence%2Fbeans%2FSyncopeRolePK.java?ref=14370817a795ab98e3d57b38f9428e5ef0d82e4e","patch":"@@ -1,60 +0,0 @@\n-/*\n- *  Licensed under the Apache License, Version 2.0 (the \"License\");\n- *  you may not use this file except in compliance with the License.\n- *  You may obtain a copy of the License at\n- * \n- *       http://www.apache.org/licenses/LICENSE-2.0\n- * \n- *  Unless required by applicable law or agreed to in writing, software\n- *  distributed under the License is distributed on an \"AS IS\" BASIS,\n- *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n- *  See the License for the specific language governing permissions and\n- *  limitations under the License.\n- *  under the License.\n- */\n-package org.syncope.core.persistence.beans;\n-\n-import javax.persistence.Embeddable;\n-\n-@Embeddable\n-public class SyncopeRolePK extends AbstractBaseBean {\n-\n-    final public static String ROOT_ROLE = \"/\";\n-    private String name;\n-    private String parent;\n-\n-    public SyncopeRolePK() {\n-    }\n-\n-    public SyncopeRolePK(String name, String parent)\n-            throws IllegalArgumentException {\n-\n-        setName(name);\n-        setParent(parent);\n-    }\n-\n-    public String getName() {\n-        return name;\n-    }\n-\n-    public final void setName(String name) throws IllegalArgumentException {\n-        if (ROOT_ROLE.equals(name)) {\n-            throw new IllegalArgumentException(\n-                    ROOT_ROLE + \" is a reserved role name\");\n-        }\n-\n-        this.name = name;\n-    }\n-\n-    public String getParent() {\n-        return parent;\n-    }\n-\n-    public final void setParent(String parent) {\n-        if (parent == null || parent.length() == 0) {\n-            this.parent = ROOT_ROLE;\n-        } else {\n-            this.parent = parent;\n-        }\n-    }\n-}"},{"sha":"d48f2acaa6ca07be157a9c9b3b94e5cabb61ce82","filename":"core/src/main/java/org/syncope/core/persistence/dao/AttributeDAO.java","status":"modified","additions":2,"deletions":2,"changes":4,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/8553f762b8957cd591f34055df3749058a0ded3d/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fcore%2Fpersistence%2Fdao%2FAttributeDAO.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/8553f762b8957cd591f34055df3749058a0ded3d/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fcore%2Fpersistence%2Fdao%2FAttributeDAO.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fcore%2Fpersistence%2Fdao%2FAttributeDAO.java?ref=8553f762b8957cd591f34055df3749058a0ded3d","patch":"@@ -19,11 +19,11 @@\n \n public interface AttributeDAO extends DAO {\n \n-    Attribute find(long id);\n+    Attribute find(Long id);\n \n     List<Attribute> findAll();\n \n     Attribute save(Attribute attribute);\n \n-    void delete(long id);\n+    void delete(Long id);\n }"},{"sha":"cb0b44a32ee3c500f5ce1f6757a2d79b34fb1b06","filename":"core/src/main/java/org/syncope/core/persistence/dao/AttributeValueDAO.java","status":"modified","additions":2,"deletions":2,"changes":4,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/8553f762b8957cd591f34055df3749058a0ded3d/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fcore%2Fpersistence%2Fdao%2FAttributeValueDAO.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/8553f762b8957cd591f34055df3749058a0ded3d/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fcore%2Fpersistence%2Fdao%2FAttributeValueDAO.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fcore%2Fpersistence%2Fdao%2FAttributeValueDAO.java?ref=8553f762b8957cd591f34055df3749058a0ded3d","patch":"@@ -19,11 +19,11 @@\n \n public interface AttributeValueDAO extends DAO {\n \n-    AttributeValue find(long id);\n+    AttributeValue find(Long id);\n \n     List<AttributeValue> findAll();\n \n     AttributeValue save(AttributeValue attributeValue);\n \n-    void delete(long id);\n+    void delete(Long id);\n }"},{"sha":"db49d12758116ff5c65e58e92740661088c3a4cb","filename":"core/src/main/java/org/syncope/core/persistence/dao/DerivedAttributeDAO.java","status":"modified","additions":2,"deletions":2,"changes":4,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/8553f762b8957cd591f34055df3749058a0ded3d/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fcore%2Fpersistence%2Fdao%2FDerivedAttributeDAO.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/8553f762b8957cd591f34055df3749058a0ded3d/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fcore%2Fpersistence%2Fdao%2FDerivedAttributeDAO.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fcore%2Fpersistence%2Fdao%2FDerivedAttributeDAO.java?ref=8553f762b8957cd591f34055df3749058a0ded3d","patch":"@@ -19,11 +19,11 @@\n \n public interface DerivedAttributeDAO extends DAO {\n \n-    DerivedAttribute find(long id);\n+    DerivedAttribute find(Long id);\n \n     List<DerivedAttribute> findAll();\n \n     DerivedAttribute save(DerivedAttribute attribute);\n \n-    void delete(long id);\n+    void delete(Long id);\n }"},{"sha":"dde74a46cbac630a6c1831107ccb5699153d4ced","filename":"core/src/main/java/org/syncope/core/persistence/dao/SyncopeRoleDAO.java","status":"modified","additions":2,"deletions":3,"changes":5,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/8553f762b8957cd591f34055df3749058a0ded3d/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fcore%2Fpersistence%2Fdao%2FSyncopeRoleDAO.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/8553f762b8957cd591f34055df3749058a0ded3d/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fcore%2Fpersistence%2Fdao%2FSyncopeRoleDAO.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fcore%2Fpersistence%2Fdao%2FSyncopeRoleDAO.java?ref=8553f762b8957cd591f34055df3749058a0ded3d","patch":"@@ -16,19 +16,18 @@\n \n import java.util.List;\n import org.syncope.core.persistence.beans.SyncopeRole;\n-import org.syncope.core.persistence.beans.SyncopeRolePK;\n \n public interface SyncopeRoleDAO extends DAO {\n \n     SyncopeRole find(String name, String parent);\n \n-    SyncopeRole find(SyncopeRolePK syncopeRolePK);\n+    SyncopeRole find(Long id);\n \n     List<SyncopeRole> findAll();\n \n     SyncopeRole save(SyncopeRole syncopeRole);\n \n     void delete(String name, String parent);\n \n-    void delete(SyncopeRolePK syncopeRolePK);\n+    void delete(Long id);\n }"},{"sha":"5705e4fa5d80a0c98c4459ee98baa68a47c4769b","filename":"core/src/main/java/org/syncope/core/persistence/dao/SyncopeUserDAO.java","status":"modified","additions":2,"deletions":2,"changes":4,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/8553f762b8957cd591f34055df3749058a0ded3d/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fcore%2Fpersistence%2Fdao%2FSyncopeUserDAO.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/8553f762b8957cd591f34055df3749058a0ded3d/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fcore%2Fpersistence%2Fdao%2FSyncopeUserDAO.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fcore%2Fpersistence%2Fdao%2FSyncopeUserDAO.java?ref=8553f762b8957cd591f34055df3749058a0ded3d","patch":"@@ -19,11 +19,11 @@\n \n public interface SyncopeUserDAO extends DAO {\n \n-    SyncopeUser find(long id);\n+    SyncopeUser find(Long id);\n \n     List<SyncopeUser> findAll();\n \n     SyncopeUser save(SyncopeUser syncopeUser);\n \n-    void delete(long id);\n+    void delete(Long id);\n }"},{"sha":"6a738196bb5940830b1db134913c0837b0450087","filename":"core/src/main/java/org/syncope/core/persistence/dao/impl/AttributeDAOImpl.java","status":"modified","additions":2,"deletions":2,"changes":4,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/8553f762b8957cd591f34055df3749058a0ded3d/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fcore%2Fpersistence%2Fdao%2Fimpl%2FAttributeDAOImpl.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/8553f762b8957cd591f34055df3749058a0ded3d/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fcore%2Fpersistence%2Fdao%2Fimpl%2FAttributeDAOImpl.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fcore%2Fpersistence%2Fdao%2Fimpl%2FAttributeDAOImpl.java?ref=8553f762b8957cd591f34055df3749058a0ded3d","patch":"@@ -28,7 +28,7 @@ public class AttributeDAOImpl extends AbstractDAOImpl\n         implements AttributeDAO {\n \n     @Override\n-    public Attribute find(long id) {\n+    public Attribute find(Long id) {\n         Attribute result = entityManager.find(Attribute.class, id);\n         if (isDeletedOrNotManaged(result)) {\n             result = null;\n@@ -54,7 +54,7 @@ public Attribute save(Attribute attribute) {\n \n     @Override\n     @Transactional\n-    public void delete(long id) {\n+    public void delete(Long id) {\n         Attribute attribute = find(id);\n         if (attribute == null) {\n             return;"},{"sha":"9880ae32f80467ee6a5f24667ce2c69da827cbc8","filename":"core/src/main/java/org/syncope/core/persistence/dao/impl/AttributeValueDAOImpl.java","status":"modified","additions":2,"deletions":2,"changes":4,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/8553f762b8957cd591f34055df3749058a0ded3d/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fcore%2Fpersistence%2Fdao%2Fimpl%2FAttributeValueDAOImpl.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/8553f762b8957cd591f34055df3749058a0ded3d/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fcore%2Fpersistence%2Fdao%2Fimpl%2FAttributeValueDAOImpl.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fcore%2Fpersistence%2Fdao%2Fimpl%2FAttributeValueDAOImpl.java?ref=8553f762b8957cd591f34055df3749058a0ded3d","patch":"@@ -26,7 +26,7 @@ public class AttributeValueDAOImpl extends AbstractDAOImpl\n         implements AttributeValueDAO {\n \n     @Override\n-    public AttributeValue find(long id) {\n+    public AttributeValue find(Long id) {\n         AttributeValue result = entityManager.find(AttributeValue.class, id);\n         if (isDeletedOrNotManaged(result)) {\n             result = null;\n@@ -52,7 +52,7 @@ public AttributeValue save(AttributeValue attributeValue) {\n \n     @Override\n     @Transactional\n-    public void delete(long id) {\n+    public void delete(Long id) {\n         AttributeValue attributeValue = find(id);\n         if (attributeValue == null) {\n             return;"},{"sha":"72e7953dc7a79b74bba565e85ff80b13383494a6","filename":"core/src/main/java/org/syncope/core/persistence/dao/impl/DerivedAttributeDAOImpl.java","status":"modified","additions":2,"deletions":2,"changes":4,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/8553f762b8957cd591f34055df3749058a0ded3d/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fcore%2Fpersistence%2Fdao%2Fimpl%2FDerivedAttributeDAOImpl.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/8553f762b8957cd591f34055df3749058a0ded3d/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fcore%2Fpersistence%2Fdao%2Fimpl%2FDerivedAttributeDAOImpl.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fcore%2Fpersistence%2Fdao%2Fimpl%2FDerivedAttributeDAOImpl.java?ref=8553f762b8957cd591f34055df3749058a0ded3d","patch":"@@ -28,7 +28,7 @@ public class DerivedAttributeDAOImpl extends AbstractDAOImpl\n         implements DerivedAttributeDAO {\n \n     @Override\n-    public DerivedAttribute find(long id) {\n+    public DerivedAttribute find(Long id) {\n         DerivedAttribute result = entityManager.find(\n                 DerivedAttribute.class, id);\n         if (isDeletedOrNotManaged(result)) {\n@@ -55,7 +55,7 @@ public DerivedAttribute save(DerivedAttribute attribute) {\n \n     @Override\n     @Transactional\n-    public void delete(long id) {\n+    public void delete(Long id) {\n         DerivedAttribute derivedAttribute = find(id);\n         if (derivedAttribute == null) {\n             return;"},{"sha":"a14c49c29102a0f4724d827dc6f97739e9609a0c","filename":"core/src/main/java/org/syncope/core/persistence/dao/impl/SyncopeRoleDAOImpl.java","status":"modified","additions":32,"deletions":16,"changes":48,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/8553f762b8957cd591f34055df3749058a0ded3d/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fcore%2Fpersistence%2Fdao%2Fimpl%2FSyncopeRoleDAOImpl.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/8553f762b8957cd591f34055df3749058a0ded3d/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fcore%2Fpersistence%2Fdao%2Fimpl%2FSyncopeRoleDAOImpl.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fcore%2Fpersistence%2Fdao%2Fimpl%2FSyncopeRoleDAOImpl.java?ref=8553f762b8957cd591f34055df3749058a0ded3d","patch":"@@ -19,7 +19,6 @@\n import org.springframework.stereotype.Repository;\n import org.springframework.transaction.annotation.Transactional;\n import org.syncope.core.persistence.beans.SyncopeRole;\n-import org.syncope.core.persistence.beans.SyncopeRolePK;\n import org.syncope.core.persistence.dao.SyncopeRoleDAO;\n \n @Repository\n@@ -28,12 +27,27 @@ public class SyncopeRoleDAOImpl extends AbstractDAOImpl\n \n     @Override\n     public SyncopeRole find(String name, String parent) {\n-        return find(new SyncopeRolePK(name, parent));\n+        Query query = null;\n+\n+        if (parent != null) {\n+            query = entityManager.createQuery(\n+                    \"SELECT r FROM SyncopeRole r WHERE \"\n+                    + \"name=:name AND parent=:parent\");\n+            query.setParameter(\"parent\", parent);\n+        } else {\n+            query = entityManager.createQuery(\n+                    \"SELECT r FROM SyncopeRole r WHERE \"\n+                    + \"name=:name AND parent IS NULL\");\n+        }\n+        query.setParameter(\"name\", name);\n+\n+        List<SyncopeRole> result = query.getResultList();\n+        return result.isEmpty() ? null : result.get(0);\n     }\n \n     @Override\n-    public SyncopeRole find(SyncopeRolePK syncopeRolePK) {\n-        return entityManager.find(SyncopeRole.class, syncopeRolePK);\n+    public SyncopeRole find(Long id) {\n+        return entityManager.find(SyncopeRole.class, id);\n     }\n \n     @Override\n@@ -52,23 +66,25 @@ public SyncopeRole save(SyncopeRole syncopeRole) {\n     @Override\n     @Transactional\n     public void delete(String name, String parent) {\n-        delete(new SyncopeRolePK(name, parent));\n-    }\n-\n-    @Override\n-    @Transactional\n-    public void delete(SyncopeRolePK syncopeRolePK) {\n         Query query = entityManager.createQuery(\n                 \"SELECT r FROM SyncopeRole r WHERE \"\n                 + \"parent=:role\");\n-        query.setParameter(\"role\", syncopeRolePK.getName());\n+        query.setParameter(\"role\", name);\n         List<SyncopeRole> childrenRoles = query.getResultList();\n \n-        if (!childrenRoles.isEmpty())\n-            for (SyncopeRole child : childrenRoles)\n-                delete(child.getSyncopeRolePK().getName(),\n-                       syncopeRolePK.getName());\n+        if (!childrenRoles.isEmpty()) {\n+            for (SyncopeRole child : childrenRoles) {\n+                delete(child.getName(), child.getParent());\n+            }\n+        }\n+\n+        entityManager.remove(find(name, parent));\n+    }\n \n-        entityManager.remove(find(syncopeRolePK));\n+    @Override\n+    @Transactional\n+    public void delete(Long id) {\n+        SyncopeRole role = find(id);\n+        delete(role.getName(), role.getParent());\n     }\n }"},{"sha":"a6812ecd178b022e5cbda2c4f34a2d053e143624","filename":"core/src/main/java/org/syncope/core/persistence/dao/impl/SyncopeUserDAOImpl.java","status":"modified","additions":2,"deletions":2,"changes":4,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/8553f762b8957cd591f34055df3749058a0ded3d/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fcore%2Fpersistence%2Fdao%2Fimpl%2FSyncopeUserDAOImpl.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/8553f762b8957cd591f34055df3749058a0ded3d/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fcore%2Fpersistence%2Fdao%2Fimpl%2FSyncopeUserDAOImpl.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fcore%2Fpersistence%2Fdao%2Fimpl%2FSyncopeUserDAOImpl.java?ref=8553f762b8957cd591f34055df3749058a0ded3d","patch":"@@ -26,7 +26,7 @@ public class SyncopeUserDAOImpl extends AbstractDAOImpl\n         implements SyncopeUserDAO {\n \n     @Override\n-    public SyncopeUser find(long id) {\n+    public SyncopeUser find(Long id) {\n         return entityManager.find(SyncopeUser.class, id);\n     }\n \n@@ -46,7 +46,7 @@ public SyncopeUser save(SyncopeUser syncopeUser) {\n \n     @Override\n     @Transactional\n-    public void delete(long id) {\n+    public void delete(Long id) {\n         entityManager.remove(find(id));\n     }\n }"},{"sha":"c9407f1586e586a4e9e0372141c276d8720724c7","filename":"core/src/main/webapp/WEB-INF/syncope-core-rest-servlet.xml","status":"modified","additions":1,"deletions":9,"changes":10,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/8553f762b8957cd591f34055df3749058a0ded3d/core%2Fsrc%2Fmain%2Fwebapp%2FWEB-INF%2Fsyncope-core-rest-servlet.xml","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/8553f762b8957cd591f34055df3749058a0ded3d/core%2Fsrc%2Fmain%2Fwebapp%2FWEB-INF%2Fsyncope-core-rest-servlet.xml","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fsrc%2Fmain%2Fwebapp%2FWEB-INF%2Fsyncope-core-rest-servlet.xml?ref=8553f762b8957cd591f34055df3749058a0ded3d","patch":"@@ -67,15 +67,7 @@\n                 <bean class=\"org.springframework.web.servlet.view.xml.MarshallingView\">\n                     <constructor-arg>\n                         <bean class=\"org.springframework.oxm.xstream.XStreamMarshaller\"\n-                              p:autodetectAnnotations=\"false\" p:encoding=\"UTF-8\">\n-                            <property name=\"aliases\">\n-                                <props>\n-                                    <prop key=\"user\">org.syncope.client.to.UserTO</prop>\n-                                    <prop key=\"attribute\">org.syncope.client.to.AttributeTO</prop>\n-                                    <prop key=\"searchParameters\">org.syncope.client.to.SearchParameters</prop>\n-                                </props>\n-                            </property>\n-                        </bean>\n+                              p:autodetectAnnotations=\"false\" p:encoding=\"UTF-8\"/>\n                     </constructor-arg>\n                 </bean>\n "},{"sha":"2ee3107d8d8e49a37bc0feed96909c8f912d001b","filename":"core/src/test/java/org/syncope/core/persistence/test/SyncopeRoleDAOTest.java","status":"modified","additions":5,"deletions":6,"changes":11,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/8553f762b8957cd591f34055df3749058a0ded3d/core%2Fsrc%2Ftest%2Fjava%2Forg%2Fsyncope%2Fcore%2Fpersistence%2Ftest%2FSyncopeRoleDAOTest.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/8553f762b8957cd591f34055df3749058a0ded3d/core%2Fsrc%2Ftest%2Fjava%2Forg%2Fsyncope%2Fcore%2Fpersistence%2Ftest%2FSyncopeRoleDAOTest.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fsrc%2Ftest%2Fjava%2Forg%2Fsyncope%2Fcore%2Fpersistence%2Ftest%2FSyncopeRoleDAOTest.java?ref=8553f762b8957cd591f34055df3749058a0ded3d","patch":"@@ -21,7 +21,6 @@\n import org.springframework.beans.factory.annotation.Autowired;\n import org.springframework.transaction.annotation.Transactional;\n import org.syncope.core.persistence.beans.SyncopeRole;\n-import org.syncope.core.persistence.beans.SyncopeRolePK;\n import org.syncope.core.persistence.dao.AttributeSchemaDAO;\n import org.syncope.core.persistence.dao.AttributeDAO;\n import org.syncope.core.persistence.dao.EntitlementDAO;\n@@ -49,26 +48,26 @@ public final void findAll() {\n     public final void find() {\n         SyncopeRole role = syncopeRoleDAO.find(\"root\", null);\n         assertNotNull(\"did not find expected role\", role);\n-        role = syncopeRoleDAO.find(new SyncopeRolePK(null, null));\n+        role = syncopeRoleDAO.find(null, null);\n         assertNull(\"found role but did not expect it\", role);\n     }\n \n     @Test\n     public final void save() {\n-        SyncopeRolePK rolePK = new SyncopeRolePK(\"secondChild\", \"root\");\n         SyncopeRole role = new SyncopeRole();\n-        role.setSyncopeRolePK(rolePK);\n+        role.setName(\"secondChild\");\n+        role.setParent(\"root\");\n \n         role = syncopeRoleDAO.save(role);\n \n-        SyncopeRole actual = syncopeRoleDAO.find(role.getSyncopeRolePK());\n+        SyncopeRole actual = syncopeRoleDAO.find(role.getId());\n         assertNotNull(\"expected save to work\", actual);\n     }\n \n     @Test\n     public final void delete() {\n         SyncopeRole role = syncopeRoleDAO.find(\"employee\", \"citizen\");\n-        syncopeRoleDAO.delete(role.getSyncopeRolePK());\n+        syncopeRoleDAO.delete(role.getId());\n \n         SyncopeRole actual = syncopeRoleDAO.find(\"employee\", \"citizen\");\n         assertNull(\"delete did not work\", actual);"},{"sha":"92d3d007a959a0e87f49eb0979ffcdeb2c8087e5","filename":"core/src/test/resources/org/syncope/core/persistence/dbunitTestData.xml","status":"modified","additions":21,"deletions":28,"changes":49,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/8553f762b8957cd591f34055df3749058a0ded3d/core%2Fsrc%2Ftest%2Fresources%2Forg%2Fsyncope%2Fcore%2Fpersistence%2FdbunitTestData.xml","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/8553f762b8957cd591f34055df3749058a0ded3d/core%2Fsrc%2Ftest%2Fresources%2Forg%2Fsyncope%2Fcore%2Fpersistence%2FdbunitTestData.xml","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fsrc%2Ftest%2Fresources%2Forg%2Fsyncope%2Fcore%2Fpersistence%2FdbunitTestData.xml?ref=8553f762b8957cd591f34055df3749058a0ded3d","patch":"@@ -17,37 +17,30 @@\n     <SyncopeUser id=\"2\" password=\"YYY\"/>\n     <SyncopeUser id=\"3\" password=\"ZZZ\"/>\n \n-    <SyncopeRole name=\"root\" parent=\"/\"/>\n-    <SyncopeRole name=\"child\" parent=\"root\"/>\n-    <SyncopeRole name=\"citizen\" parent=\"/\"/>\n-    <SyncopeRole name=\"employee\" parent=\"citizen\"/>\n-    <SyncopeRole name=\"secretary\" parent=\"employee\"/>\n-    <SyncopeRole name=\"director\" parent=\"employee\"/>\n-    <SyncopeRole name=\"managingDirector\" parent=\"director\"/>\n+    <SyncopeRole id=\"1\" name=\"root\"/>\n+    <SyncopeRole id=\"2\" name=\"child\" parent=\"root\"/>\n+    <SyncopeRole id=\"3\" name=\"citizen\"/>\n+    <SyncopeRole id=\"4\" name=\"employee\" parent=\"citizen\"/>\n+    <SyncopeRole id=\"5\" name=\"secretary\" parent=\"employee\"/>\n+    <SyncopeRole id=\"6\" name=\"director\" parent=\"employee\"/>\n+    <SyncopeRole id=\"7\" name=\"managingDirector\" parent=\"director\"/>\n \n-    <SyncopeUser_SyncopeRole users_id=\"1\"\n-                             roles_name=\"root\" roles_parent=\"/\"/>\n-    <SyncopeUser_SyncopeRole users_id=\"2\"\n-                             roles_name=\"root\" roles_parent=\"/\"/>\n+    <SyncopeUser_SyncopeRole users_id=\"1\" roles_id=\"1\"/>\n+    <SyncopeUser_SyncopeRole users_id=\"2\" roles_id=\"1\"/>\n \n     <AttributeSchema name=\"username\" type=\"String\"\n-                     mandatory=\"true\" multivalue=\"false\"\n-                     conversionPattern=\"NULL\" validatorClass=\"NULL\"/>\n+                     mandatory=\"true\" multivalue=\"false\"/>\n     <AttributeSchema name=\"loginDate\" type=\"Date\"\n                      mandatory=\"false\" multivalue=\"true\"\n-                     conversionPattern=\"yyyy-MM-dd\" validatorClass=\"NULL\"/>\n+                     conversionPattern=\"yyyy-MM-dd\"/>\n     <AttributeSchema name=\"firstname\" type=\"String\"\n-                     mandatory=\"false\" multivalue=\"false\"\n-                     conversionPattern=\"NULL\" validatorClass=\"NULL\"/>\n+                     mandatory=\"false\" multivalue=\"false\"/>\n     <AttributeSchema name=\"surname\" type=\"String\"\n-                     mandatory=\"true\" multivalue=\"false\"\n-                     conversionPattern=\"NULL\" validatorClass=\"NULL\"/>\n+                     mandatory=\"true\" multivalue=\"false\"/>\n     <AttributeSchema name=\"icon\" type=\"String\"\n-                     mandatory=\"false\" multivalue=\"false\"\n-                     conversionPattern=\"NULL\" validatorClass=\"NULL\"/>\n+                     mandatory=\"false\" multivalue=\"false\"/>\n     <AttributeSchema name=\"show\" type=\"Boolean\"\n-                     mandatory=\"false\" multivalue=\"false\"\n-                     conversionPattern=\"NULL\" validatorClass=\"NULL\"/>\n+                     mandatory=\"false\" multivalue=\"false\"/>\n \n     <Attribute id=\"100\" schema_name=\"username\"/>\n     <Attribute id=\"200\" schema_name=\"loginDate\"/>\n@@ -88,11 +81,11 @@\n     <SyncopeUser_Attribute SyncopeUser_id='3'\n                            attributes_id='500'/>\n \n-    <SyncopeRole_Attribute SyncopeRole_name=\"root\" SyncopeRole_parent=\"/\"\n+    <SyncopeRole_Attribute SyncopeRole_id=\"1\"\n                            attributes_id=\"600\"/>\n-    <SyncopeRole_Attribute SyncopeRole_name=\"root\" SyncopeRole_parent=\"/\"\n+    <SyncopeRole_Attribute SyncopeRole_id=\"1\"\n                            attributes_id=\"800\"/>\n-    <SyncopeRole_Attribute SyncopeRole_name=\"child\" SyncopeRole_parent=\"root\"\n+    <SyncopeRole_Attribute SyncopeRole_id=\"2\"\n                            attributes_id=\"700\"/>\n \n     <DerivedAttributeSchema name=\"cn\" expression=\"surname + ', ' + firstname\"/>\n@@ -117,10 +110,10 @@\n     <Entitlement name=\"advanced\" description=\"Advanced entitlement\"/>\n \n     <SyncopeRole_Entitlement entitlements_name=\"base\"\n-                             roles_name=\"root\" roles_parent=\"/\"/>\n+                             roles_id=\"1\"/>\n     <SyncopeRole_Entitlement entitlements_name=\"advanced\"\n-                             roles_name=\"root\" roles_parent=\"/\"/>\n+                             roles_id=\"1\"/>\n     <SyncopeRole_Entitlement entitlements_name=\"base\"\n-                             roles_name=\"child\" roles_parent=\"root\"/>\n+                             roles_id=\"2\"/>\n \n </dataset>"}]}