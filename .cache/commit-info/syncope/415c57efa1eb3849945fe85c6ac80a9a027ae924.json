{"sha":"415c57efa1eb3849945fe85c6ac80a9a027ae924","node_id":"MDY6Q29tbWl0NjM2ODc5MDYyOjQxNWM1N2VmYTFlYjM4NDk5NDVmZTg1YzZhYzgwYTlhMDI3YWU5MjQ=","commit":{"author":{"name":"Fabio Martelli","email":"fmartelli@apache.org","date":"2013-01-08T11:34:23Z"},"committer":{"name":"Fabio Martelli","email":"fmartelli@apache.org","date":"2013-01-08T11:34:23Z"},"message":"SYNCOPE-267 merged\n\ngit-svn-id: https://svn.apache.org/repos/asf/syncope/trunk@1430222 13f79535-47bb-0310-9956-ffa450edef68","tree":{"sha":"d5a3a6c9f78b97566def9a16f05f55888485ddc8","url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/git/trees/d5a3a6c9f78b97566def9a16f05f55888485ddc8"},"url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/git/commits/415c57efa1eb3849945fe85c6ac80a9a027ae924","comment_count":0,"verification":{"verified":false,"reason":"unsigned","signature":null,"payload":null}},"url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/415c57efa1eb3849945fe85c6ac80a9a027ae924","html_url":"https://github.com/EnricoDAlessandro97UNI/syncope/commit/415c57efa1eb3849945fe85c6ac80a9a027ae924","comments_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/415c57efa1eb3849945fe85c6ac80a9a027ae924/comments","author":{"login":"fmartelli","id":1791932,"node_id":"MDQ6VXNlcjE3OTE5MzI=","avatar_url":"https://avatars.githubusercontent.com/u/1791932?v=4","gravatar_id":"","url":"https://api.github.com/users/fmartelli","html_url":"https://github.com/fmartelli","followers_url":"https://api.github.com/users/fmartelli/followers","following_url":"https://api.github.com/users/fmartelli/following{/other_user}","gists_url":"https://api.github.com/users/fmartelli/gists{/gist_id}","starred_url":"https://api.github.com/users/fmartelli/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/fmartelli/subscriptions","organizations_url":"https://api.github.com/users/fmartelli/orgs","repos_url":"https://api.github.com/users/fmartelli/repos","events_url":"https://api.github.com/users/fmartelli/events{/privacy}","received_events_url":"https://api.github.com/users/fmartelli/received_events","type":"User","site_admin":false},"committer":{"login":"fmartelli","id":1791932,"node_id":"MDQ6VXNlcjE3OTE5MzI=","avatar_url":"https://avatars.githubusercontent.com/u/1791932?v=4","gravatar_id":"","url":"https://api.github.com/users/fmartelli","html_url":"https://github.com/fmartelli","followers_url":"https://api.github.com/users/fmartelli/followers","following_url":"https://api.github.com/users/fmartelli/following{/other_user}","gists_url":"https://api.github.com/users/fmartelli/gists{/gist_id}","starred_url":"https://api.github.com/users/fmartelli/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/fmartelli/subscriptions","organizations_url":"https://api.github.com/users/fmartelli/orgs","repos_url":"https://api.github.com/users/fmartelli/repos","events_url":"https://api.github.com/users/fmartelli/events{/privacy}","received_events_url":"https://api.github.com/users/fmartelli/received_events","type":"User","site_admin":false},"parents":[{"sha":"ff6716aa4e160678e173a1a5c08a45c06b5772f9","url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/ff6716aa4e160678e173a1a5c08a45c06b5772f9","html_url":"https://github.com/EnricoDAlessandro97UNI/syncope/commit/ff6716aa4e160678e173a1a5c08a45c06b5772f9"}],"stats":{"total":51,"additions":49,"deletions":2},"files":[{"sha":"b94381a37c2adf049d41e3bc661cd1e10491cb62","filename":"core/src/main/java/org/apache/syncope/core/persistence/beans/AbstractAttrValue.java","status":"modified","additions":7,"deletions":1,"changes":8,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/415c57efa1eb3849945fe85c6ac80a9a027ae924/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fpersistence%2Fbeans%2FAbstractAttrValue.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/415c57efa1eb3849945fe85c6ac80a9a027ae924/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fpersistence%2Fbeans%2FAbstractAttrValue.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fpersistence%2Fbeans%2FAbstractAttrValue.java?ref=415c57efa1eb3849945fe85c6ac80a9a027ae924","patch":"@@ -37,6 +37,7 @@\n import org.apache.syncope.client.SyncopeConstants;\n import org.apache.syncope.core.persistence.validation.attrvalue.ParsingValidationException;\n import org.apache.syncope.core.persistence.validation.entity.AttrValueCheck;\n+import org.apache.syncope.types.SchemaType;\n \n @MappedSuperclass\n @AttrValueCheck\n@@ -185,7 +186,12 @@ public <T> T getValue() {\n     public String getValueAsString() {\n         String result = null;\n \n-        switch (getAttribute().getSchema().getType()) {\n+        final SchemaType type = getAttribute() == null || getAttribute().getSchema() == null\n+                || getAttribute().getSchema().getType() == null\n+                ? SchemaType.String\n+                : getAttribute().getSchema().getType();\n+\n+        switch (type) {\n \n             case Boolean:\n                 result = getBooleanValue().toString();"},{"sha":"5e392c22b9ef2672daf773fb4c849ee6caf8c1e6","filename":"core/src/test/java/org/apache/syncope/core/persistence/dao/ResourceTest.java","status":"modified","additions":1,"deletions":1,"changes":2,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/415c57efa1eb3849945fe85c6ac80a9a027ae924/core%2Fsrc%2Ftest%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fpersistence%2Fdao%2FResourceTest.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/415c57efa1eb3849945fe85c6ac80a9a027ae924/core%2Fsrc%2Ftest%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fpersistence%2Fdao%2FResourceTest.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fsrc%2Ftest%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fpersistence%2Fdao%2FResourceTest.java?ref=415c57efa1eb3849945fe85c6ac80a9a027ae924","patch":"@@ -66,7 +66,7 @@ public void findById() {\n     public void findAll() {\n         List<ExternalResource> resources = resourceDAO.findAll();\n         assertNotNull(resources);\n-        assertEquals(16, resources.size());\n+        assertEquals(17, resources.size());\n     }\n \n     @Test"},{"sha":"8390ac824f6b9af794ba44908cb346eb8b2a148f","filename":"core/src/test/java/org/apache/syncope/core/rest/UserTestITCase.java","status":"modified","additions":27,"deletions":0,"changes":27,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/415c57efa1eb3849945fe85c6ac80a9a027ae924/core%2Fsrc%2Ftest%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Frest%2FUserTestITCase.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/415c57efa1eb3849945fe85c6ac80a9a027ae924/core%2Fsrc%2Ftest%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Frest%2FUserTestITCase.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fsrc%2Ftest%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Frest%2FUserTestITCase.java?ref=415c57efa1eb3849945fe85c6ac80a9a027ae924","patch":"@@ -1823,4 +1823,31 @@ public void issueSYNCOPE260() {\n                 || connObjectTO.getAttributeMap().get(\"NAME\").getValues().isEmpty());\n         // ----------------------------------\n     }\n+    \n+    @Test\n+    public void issueSYNCOPE267() {\n+        // ----------------------------------\n+        // create user and check virtual attribute value propagation\n+        // ----------------------------------\n+        UserTO userTO = getSampleTO(\"syncope267@apache.org\");\n+        userTO.getResources().clear();\n+        userTO.addResource(\"resource-db-virattr\");\n+\n+        userTO = userService.create(userTO);\n+        assertNotNull(userTO);\n+        assertFalse(userTO.getPropagationTOs().isEmpty());\n+        assertEquals(\"resource-db-virattr\", userTO.getPropagationTOs().get(0).getResourceName());\n+        assertEquals(PropagationTaskExecStatus.SUBMITTED, userTO.getPropagationTOs().get(0).getStatus());\n+\n+        ConnObjectTO connObjectTO = readUserConnObj(\"resource-db-virattr\", String.valueOf(userTO.getId()));\n+        assertNotNull(connObjectTO);\n+        assertEquals(\"virtualvalue\", connObjectTO.getAttributeMap().get(\"USERNAME\").getValues().get(0));\n+        // ----------------------------------\n+\n+        userTO = userService.read(userTO.getId());\n+\n+        assertNotNull(userTO);\n+        assertEquals(1, userTO.getVirtualAttributes().size());\n+        assertEquals(\"virtualvalue\", userTO.getVirtualAttributes().get(0).getValues().get(0));\n+    }\n }"},{"sha":"6b4d621d1788b2af5a9be8e27291d05cb170c16d","filename":"core/src/test/resources/content.xml","status":"modified","additions":14,"deletions":0,"changes":14,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/415c57efa1eb3849945fe85c6ac80a9a027ae924/core%2Fsrc%2Ftest%2Fresources%2Fcontent.xml","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/415c57efa1eb3849945fe85c6ac80a9a027ae924/core%2Fsrc%2Ftest%2Fresources%2Fcontent.xml","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fsrc%2Ftest%2Fresources%2Fcontent.xml?ref=415c57efa1eb3849945fe85c6ac80a9a027ae924","patch":"@@ -393,6 +393,12 @@ under the License.\n                     createTraceLevel=\"ALL\" deleteTraceLevel=\"ALL\" syncTraceLevel=\"ALL\" updateTraceLevel=\"ALL\"\n                     enforceMandatoryCondition=\"0\" \n                     propagationMode=\"TWO_PHASES\" propagationPrimary=\"0\" propagationPriority=\"0\"/>\n+                    \n+  <!-- External resource for issue SYNCOPE-267 -->\n+  <ExternalResource name=\"resource-db-virattr\" connector_id=\"107\"\n+                    createTraceLevel=\"ALL\" deleteTraceLevel=\"ALL\" syncTraceLevel=\"ALL\" updateTraceLevel=\"ALL\"\n+                    enforceMandatoryCondition=\"0\" \n+                    propagationMode=\"TWO_PHASES\" propagationPrimary=\"0\" propagationPriority=\"0\"/>\n   \n   <SyncopeUser_ExternalResource user_id=\"3\" resource_name=\"ws-target-resource-delete\" />\n   <SyncopeRole_ExternalResource role_id=\"3\" resource_name=\"ws-target-resource-list-mappings-1\" />\n@@ -600,6 +606,14 @@ under the License.\n                 extAttrName=\"EMAIL\" intAttrName=\"userId\" intMappingType=\"UserSchema\" \n                 mandatoryCondition=\"false\" password=\"0\"/>\n               \n+  <UMapping id=\"17\" resource_name=\"resource-db-virattr\"/>\n+  <UMappingItem id=\"331\" mapping_id=\"17\" accountid=\"1\" password=\"0\"\n+                extAttrName=\"__NAME__\" intMappingType=\"UserId\" \n+                mandatoryCondition=\"true\"/>\n+  <UMappingItem id=\"332\" mapping_id=\"17\" accountid=\"0\" password=\"0\" \n+                extAttrName=\"USERNAME\" intAttrName=\"virtualdata\" intMappingType=\"UserVirtualSchema\"\n+                mandatoryCondition=\"false\" />\n+  \n   <Task DTYPE=\"PropagationTask\" id=\"1\" propagationMode=\"TWO_PHASES\" propagationOperation=\"UPDATE\"\n         objectClassName=\"__ACCOUNT__\" resource_name=\"ws-target-resource-2\" subjectType=\"USER\" subjectId=\"1\"\n         xmlAttributes=\"%3Cset%3E%0A++%3Corg.identityconnectors.framework.common.objects.Attribute%3E%0A++++%3Cname%3E__PASSWORD__%3C%2Fname%3E%0A++++%3Cvalue+class%3D%22java.util.Collections%24UnmodifiableRandomAccessList%22+resolves-to%3D%22java.util.Collections%24UnmodifiableList%22%3E%0A++++++%3Cc+class%3D%22list%22%3E%0A++++++++%3Corg.identityconnectors.common.security.GuardedString%3E%0A++++++++++%3Creadonly%3Efalse%3C%2Freadonly%3E%0A++++++++++%3Cdisposed%3Efalse%3C%2Fdisposed%3E%0A++++++++++%3CencryptedBytes%3Em9nh2US0Sa6m%2BcXccCq0Xw%3D%3D%3C%2FencryptedBytes%3E%0A++++++++%3C%2Forg.identityconnectors.common.security.GuardedString%3E%0A++++++%3C%2Fc%3E%0A++++++%3Clist+reference%3D%22..%2Fc%22%2F%3E%0A++++%3C%2Fvalue%3E%0A++%3C%2Forg.identityconnectors.framework.common.objects.Attribute%3E%0A++%3Corg.identityconnectors.framework.common.objects.Name%3E%0A++++%3Cname%3E__NAME__%3C%2Fname%3E%0A++++%3Cvalue+class%3D%22java.util.Collections%24UnmodifiableRandomAccessList%22+resolves-to%3D%22java.util.Collections%24UnmodifiableList%22%3E%0A++++++%3Cc+class%3D%22list%22%3E%0A++++++++%3Cstring%3EuserId%3C%2Fstring%3E%0A++++++%3C%2Fc%3E%0A++++++%3Clist+reference%3D%22..%2Fc%22%2F%3E%0A++++%3C%2Fvalue%3E%0A++%3C%2Forg.identityconnectors.framework.common.objects.Name%3E%0A++%3Corg.identityconnectors.framework.common.objects.Attribute%3E%0A++++%3Cname%3Efullname%3C%2Fname%3E%0A++++%3Cvalue+class%3D%22java.util.Collections%24UnmodifiableRandomAccessList%22+resolves-to%3D%22java.util.Collections%24UnmodifiableList%22%3E%0A++++++%3Cc+class%3D%22list%22%3E%0A++++++++%3Cstring%3Efullname%3C%2Fstring%3E%0A++++++%3C%2Fc%3E%0A++++++%3Clist+reference%3D%22..%2Fc%22%2F%3E%0A++++%3C%2Fvalue%3E%0A++%3C%2Forg.identityconnectors.framework.common.objects.Attribute%3E%0A++%3Corg.identityconnectors.framework.common.objects.Attribute%3E%0A++++%3Cname%3Etype%3C%2Fname%3E%0A++++%3Cvalue+class%3D%22java.util.Collections%24UnmodifiableRandomAccessList%22+resolves-to%3D%22java.util.Collections%24UnmodifiableList%22%3E%0A++++++%3Cc+class%3D%22list%22%3E%0A++++++++%3Cstring%3Etype%3C%2Fstring%3E%0A++++++%3C%2Fc%3E%0A++++++%3Clist+reference%3D%22..%2Fc%22%2F%3E%0A++++%3C%2Fvalue%3E%0A++%3C%2Forg.identityconnectors.framework.common.objects.Attribute%3E%0A%3C%2Fset%3E\"/>"}]}