{"sha":"b12295fb7786188a098d5339aa05ba6030f02604","node_id":"MDY6Q29tbWl0NjM2ODc5MDYyOmIxMjI5NWZiNzc4NjE4OGEwOThkNTMzOWFhMDViYTYwMzBmMDI2MDQ=","commit":{"author":{"name":"Francesco Chicchiriccò","email":"ilgrosso@apache.org","date":"2018-11-10T05:58:17Z"},"committer":{"name":"Francesco Chicchiriccò","email":"ilgrosso@apache.org","date":"2018-11-10T05:58:32Z"},"message":"[SYNCOPE-1395] small refactor for orderBy init","tree":{"sha":"1de776fb4c25944a8559d425a5c95e08c2988ab6","url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/git/trees/1de776fb4c25944a8559d425a5c95e08c2988ab6"},"url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/git/commits/b12295fb7786188a098d5339aa05ba6030f02604","comment_count":0,"verification":{"verified":false,"reason":"unsigned","signature":null,"payload":null}},"url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/b12295fb7786188a098d5339aa05ba6030f02604","html_url":"https://github.com/EnricoDAlessandro97UNI/syncope/commit/b12295fb7786188a098d5339aa05ba6030f02604","comments_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/b12295fb7786188a098d5339aa05ba6030f02604/comments","author":{"login":"ilgrosso","id":1064664,"node_id":"MDQ6VXNlcjEwNjQ2NjQ=","avatar_url":"https://avatars.githubusercontent.com/u/1064664?v=4","gravatar_id":"","url":"https://api.github.com/users/ilgrosso","html_url":"https://github.com/ilgrosso","followers_url":"https://api.github.com/users/ilgrosso/followers","following_url":"https://api.github.com/users/ilgrosso/following{/other_user}","gists_url":"https://api.github.com/users/ilgrosso/gists{/gist_id}","starred_url":"https://api.github.com/users/ilgrosso/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ilgrosso/subscriptions","organizations_url":"https://api.github.com/users/ilgrosso/orgs","repos_url":"https://api.github.com/users/ilgrosso/repos","events_url":"https://api.github.com/users/ilgrosso/events{/privacy}","received_events_url":"https://api.github.com/users/ilgrosso/received_events","type":"User","site_admin":false},"committer":{"login":"ilgrosso","id":1064664,"node_id":"MDQ6VXNlcjEwNjQ2NjQ=","avatar_url":"https://avatars.githubusercontent.com/u/1064664?v=4","gravatar_id":"","url":"https://api.github.com/users/ilgrosso","html_url":"https://github.com/ilgrosso","followers_url":"https://api.github.com/users/ilgrosso/followers","following_url":"https://api.github.com/users/ilgrosso/following{/other_user}","gists_url":"https://api.github.com/users/ilgrosso/gists{/gist_id}","starred_url":"https://api.github.com/users/ilgrosso/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ilgrosso/subscriptions","organizations_url":"https://api.github.com/users/ilgrosso/orgs","repos_url":"https://api.github.com/users/ilgrosso/repos","events_url":"https://api.github.com/users/ilgrosso/events{/privacy}","received_events_url":"https://api.github.com/users/ilgrosso/received_events","type":"User","site_admin":false},"parents":[{"sha":"ca771ac2dfe3f6135051099d8ef84245730dc90c","url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/ca771ac2dfe3f6135051099d8ef84245730dc90c","html_url":"https://github.com/EnricoDAlessandro97UNI/syncope/commit/ca771ac2dfe3f6135051099d8ef84245730dc90c"}],"stats":{"total":22,"additions":14,"deletions":8},"files":[{"sha":"6800dbe283b65ccd3df3e029ed2de9eb6c3af0ca","filename":"core/persistence-jpa/src/main/java/org/apache/syncope/core/persistence/jpa/dao/AbstractAnySearchDAO.java","status":"modified","additions":13,"deletions":7,"changes":20,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/b12295fb7786188a098d5339aa05ba6030f02604/core%2Fpersistence-jpa%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fpersistence%2Fjpa%2Fdao%2FAbstractAnySearchDAO.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/b12295fb7786188a098d5339aa05ba6030f02604/core%2Fpersistence-jpa%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fpersistence%2Fjpa%2Fdao%2FAbstractAnySearchDAO.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fpersistence-jpa%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fpersistence%2Fjpa%2Fdao%2FAbstractAnySearchDAO.java?ref=b12295fb7786188a098d5339aa05ba6030f02604","patch":"@@ -136,12 +136,6 @@ public <T extends Any<?>> List<T> search(\n         return search(SyncopeConstants.FULL_ADMIN_REALMS, cond, -1, -1, orderBy, kind);\n     }\n \n-    protected List<OrderByClause> filterOrderBy(final List<OrderByClause> orderBy) {\n-        return orderBy.stream().\n-                filter(clause -> !ArrayUtils.contains(ORDER_BY_NOT_ALLOWED, clause.getField())).\n-                collect(Collectors.toList());\n-    }\n-\n     protected abstract <T extends Any<?>> List<T> doSearch(\n             Set<String> adminRealms,\n             SearchCond searchCondition,\n@@ -353,7 +347,19 @@ public <T extends Any<?>> List<T> search(\n             return Collections.<T>emptyList();\n         }\n \n-        return doSearch(adminRealms, cond, page, itemsPerPage, orderBy, kind);\n+        List<OrderByClause> effectiveOrderBy;\n+        if (orderBy.isEmpty()) {\n+            OrderByClause keyClause = new OrderByClause();\n+            keyClause.setField(kind == AnyTypeKind.USER ? \"username\" : \"name\");\n+            keyClause.setDirection(OrderByClause.Direction.ASC);\n+            effectiveOrderBy = Collections.singletonList(keyClause);\n+        } else {\n+            effectiveOrderBy = orderBy.stream().\n+                    filter(clause -> !ArrayUtils.contains(ORDER_BY_NOT_ALLOWED, clause.getField())).\n+                    collect(Collectors.toList());;\n+        }\n+\n+        return doSearch(adminRealms, cond, page, itemsPerPage, effectiveOrderBy, kind);\n     }\n \n     @Override"},{"sha":"58102072acbf8f7f679d5d3d9cb403addc5187a7","filename":"core/persistence-jpa/src/main/java/org/apache/syncope/core/persistence/jpa/dao/JPAAnySearchDAO.java","status":"modified","additions":1,"deletions":1,"changes":2,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/b12295fb7786188a098d5339aa05ba6030f02604/core%2Fpersistence-jpa%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fpersistence%2Fjpa%2Fdao%2FJPAAnySearchDAO.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/b12295fb7786188a098d5339aa05ba6030f02604/core%2Fpersistence-jpa%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fpersistence%2Fjpa%2Fdao%2FJPAAnySearchDAO.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fpersistence-jpa%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fpersistence%2Fjpa%2Fdao%2FJPAAnySearchDAO.java?ref=b12295fb7786188a098d5339aa05ba6030f02604","patch":"@@ -326,7 +326,7 @@ private OrderBySupport parseOrderBy(\n \n         OrderBySupport obs = new OrderBySupport();\n \n-        filterOrderBy(orderBy).forEach(clause -> {\n+        orderBy.forEach(clause -> {\n             OrderBySupport.Item item = new OrderBySupport.Item();\n \n             if (anyUtils.getField(clause.getField()) == null) {"}]}