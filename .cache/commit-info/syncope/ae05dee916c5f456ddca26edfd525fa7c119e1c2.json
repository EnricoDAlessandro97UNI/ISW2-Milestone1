{"sha":"ae05dee916c5f456ddca26edfd525fa7c119e1c2","node_id":"MDY6Q29tbWl0NjM2ODc5MDYyOmFlMDVkZWU5MTZjNWY0NTZkZGNhMjZlZGZkNTI1ZmE3YzExOWUxYzI=","commit":{"author":{"name":"Andrea Patricelli","email":"andrea.patricelli@tirasa.net","date":"2015-12-30T11:17:46Z"},"committer":{"name":"Andrea Patricelli","email":"andrea.patricelli@tirasa.net","date":"2015-12-30T11:17:46Z"},"message":"[SYNCOPE-719] aligned virtual attributes to admin console's","tree":{"sha":"1b752a7b3156e53caa85137e2f9d4f5f1436907d","url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/git/trees/1b752a7b3156e53caa85137e2f9d4f5f1436907d"},"url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/git/commits/ae05dee916c5f456ddca26edfd525fa7c119e1c2","comment_count":0,"verification":{"verified":false,"reason":"unsigned","signature":null,"payload":null}},"url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/ae05dee916c5f456ddca26edfd525fa7c119e1c2","html_url":"https://github.com/EnricoDAlessandro97UNI/syncope/commit/ae05dee916c5f456ddca26edfd525fa7c119e1c2","comments_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/ae05dee916c5f456ddca26edfd525fa7c119e1c2/comments","author":{"login":"andrea-patricelli","id":3763111,"node_id":"MDQ6VXNlcjM3NjMxMTE=","avatar_url":"https://avatars.githubusercontent.com/u/3763111?v=4","gravatar_id":"","url":"https://api.github.com/users/andrea-patricelli","html_url":"https://github.com/andrea-patricelli","followers_url":"https://api.github.com/users/andrea-patricelli/followers","following_url":"https://api.github.com/users/andrea-patricelli/following{/other_user}","gists_url":"https://api.github.com/users/andrea-patricelli/gists{/gist_id}","starred_url":"https://api.github.com/users/andrea-patricelli/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/andrea-patricelli/subscriptions","organizations_url":"https://api.github.com/users/andrea-patricelli/orgs","repos_url":"https://api.github.com/users/andrea-patricelli/repos","events_url":"https://api.github.com/users/andrea-patricelli/events{/privacy}","received_events_url":"https://api.github.com/users/andrea-patricelli/received_events","type":"User","site_admin":false},"committer":{"login":"andrea-patricelli","id":3763111,"node_id":"MDQ6VXNlcjM3NjMxMTE=","avatar_url":"https://avatars.githubusercontent.com/u/3763111?v=4","gravatar_id":"","url":"https://api.github.com/users/andrea-patricelli","html_url":"https://github.com/andrea-patricelli","followers_url":"https://api.github.com/users/andrea-patricelli/followers","following_url":"https://api.github.com/users/andrea-patricelli/following{/other_user}","gists_url":"https://api.github.com/users/andrea-patricelli/gists{/gist_id}","starred_url":"https://api.github.com/users/andrea-patricelli/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/andrea-patricelli/subscriptions","organizations_url":"https://api.github.com/users/andrea-patricelli/orgs","repos_url":"https://api.github.com/users/andrea-patricelli/repos","events_url":"https://api.github.com/users/andrea-patricelli/events{/privacy}","received_events_url":"https://api.github.com/users/andrea-patricelli/received_events","type":"User","site_admin":false},"parents":[{"sha":"4d2cd5f9d6324ad81f44d93fd151d1c1853701f7","url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/4d2cd5f9d6324ad81f44d93fd151d1c1853701f7","html_url":"https://github.com/EnricoDAlessandro97UNI/syncope/commit/4d2cd5f9d6324ad81f44d93fd151d1c1853701f7"}],"stats":{"total":359,"additions":59,"deletions":300},"files":[{"sha":"24b27b812483aace61675ba2c7ec0bfed5d05a6b","filename":"client/enduser/pom.xml","status":"modified","additions":0,"deletions":4,"changes":4,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/ae05dee916c5f456ddca26edfd525fa7c119e1c2/client%2Fenduser%2Fpom.xml","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/ae05dee916c5f456ddca26edfd525fa7c119e1c2/client%2Fenduser%2Fpom.xml","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/client%2Fenduser%2Fpom.xml?ref=ae05dee916c5f456ddca26edfd525fa7c119e1c2","patch":"@@ -127,10 +127,6 @@ under the License.\n       <groupId>org.webjars.bower</groupId>\n       <artifactId>angular-sanitize</artifactId>\n     </dependency>\n-    <dependency>\n-      <groupId>org.webjars.bower</groupId>\n-      <artifactId>select2</artifactId>\n-    </dependency>\n     <dependency>\n       <groupId>org.webjars.bower</groupId>\n       <artifactId>FileSaver.js</artifactId>"},{"sha":"493e6294ac62ff5ddacb82c1a9a46ba80cf97c03","filename":"client/enduser/src/main/resources/META-INF/resources/app/index.html","status":"modified","additions":1,"deletions":2,"changes":3,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/ae05dee916c5f456ddca26edfd525fa7c119e1c2/client%2Fenduser%2Fsrc%2Fmain%2Fresources%2FMETA-INF%2Fresources%2Fapp%2Findex.html","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/ae05dee916c5f456ddca26edfd525fa7c119e1c2/client%2Fenduser%2Fsrc%2Fmain%2Fresources%2FMETA-INF%2Fresources%2Fapp%2Findex.html","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/client%2Fenduser%2Fsrc%2Fmain%2Fresources%2FMETA-INF%2Fresources%2Fapp%2Findex.html?ref=ae05dee916c5f456ddca26edfd525fa7c119e1c2","patch":"@@ -69,7 +69,7 @@\n     <script src=\"../webjars/angular-cookies/${angular-cookies.version}/angular-cookies.js\"></script>\n     <script src=\"../webjars/angular-sanitize/${angular-sanitize.version}/angular-sanitize.js\"></script>\n     <script src=\"../webjars/angular-ui-bootstrap/${angular-ui-bootstrap.version}/ui-bootstrap-tpls.js\"></script>\n-    <!--<script src=\"../webjars/angular-ui-select/${angular-ui-select.version}/select.js\"></script>-->\n+    <script src=\"../webjars/angular-ui-select/${angular-ui-select.version}/select.js\"></script>\n     <script src=\"../webjars/angular-growl-2/${angular-growl-2.version}/angular-growl.js\"></script>\n     <script type=\"text/javascript\" src=\"../webjars/bootstrap-select/${bootstrap-select.version}/js/bootstrap-select.min.js\"></script>\n     <script src=\"../webjars/FileSaver.js/${FileSaver.version}/FileSaver.js\" type=\"text/javascript\"></script>\n@@ -112,7 +112,6 @@\n     <link href=\"../webjars/ionicons/${ionicons.version}/css/ionicons.min.css\" rel=\"stylesheet\" type=\"text/css\" />\n     <link href=\"../webjars/angular-ui-select/${angular-ui-select.version}/select.css\" rel=\"stylesheet\" type=\"text/css\"/>\n     <link href=\"../webjars/angular-growl-2/${angular-growl-2.version}/angular-growl.css\" rel=\"stylesheet\" type=\"text/css\"/>\n-    <!--<link href=\"../webjars/select2/${select2.version}/select2.css\" rel=\"stylesheet\" />-->\n     <link href=\"css/app.css\" rel=\"stylesheet\" type=\"text/css\" />\n     <link href=\"css/login.css\" rel=\"stylesheet\" type=\"text/css\" />\n     <link href=\"css/editUser.css\" rel=\"stylesheet\" type=\"text/css\" />"},{"sha":"10fb3b7ba7177b41991116fd1d51b9e1df267cb4","filename":"client/enduser/src/main/resources/META-INF/resources/app/js/controllers/UserController.js","status":"modified","additions":19,"deletions":27,"changes":46,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/ae05dee916c5f456ddca26edfd525fa7c119e1c2/client%2Fenduser%2Fsrc%2Fmain%2Fresources%2FMETA-INF%2Fresources%2Fapp%2Fjs%2Fcontrollers%2FUserController.js","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/ae05dee916c5f456ddca26edfd525fa7c119e1c2/client%2Fenduser%2Fsrc%2Fmain%2Fresources%2FMETA-INF%2Fresources%2Fapp%2Fjs%2Fcontrollers%2FUserController.js","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/client%2Fenduser%2Fsrc%2Fmain%2Fresources%2FMETA-INF%2Fresources%2Fapp%2Fjs%2Fcontrollers%2FUserController.js?ref=ae05dee916c5f456ddca26edfd525fa7c119e1c2","patch":"@@ -45,10 +45,9 @@ angular.module(\"self\").controller(\"UserController\", ['$scope', '$rootScope', '$l\n         plainSchemas: [],\n         derSchemas: [],\n         virSchemas: [],\n-//        selectedDerSchemas: [],\n-//        selectedVirSchemas: [],\n         errorMessage: '',\n-        attributeTable: {}\n+        attributeTable: {},\n+        virtualAttributeTable: {}\n       };\n \n       var initSchemas = function () {\n@@ -77,16 +76,14 @@ angular.module(\"self\").controller(\"UserController\", ['$scope', '$rootScope', '$l\n                   fields: [schemas.plainSchemas[i].key + \"_\" + 0]\n                 };\n               }\n-            } else {\n+            } else if (schemas.plainSchemas[i].multivalue) {\n               // initialize multivalue schema and support table: update mode, all provided values\n-              if (schemas.plainSchemas[i].multivalue) {\n-                $scope.dynamicForm.attributeTable[schemas.plainSchemas[i].key] = {\n-                  fields: [schemas.plainSchemas[i].key + \"_\" + 0]\n-                };\n-                // add other values\n-                for (var j = 1; j < $scope.user.plainAttrs[plainSchemaKey].values.length; j++) {\n-                  $scope.dynamicForm.attributeTable[schemas.plainSchemas[i].key].fields.push(schemas.plainSchemas[i].key + \"_\" + j);\n-                }\n+              $scope.dynamicForm.attributeTable[schemas.plainSchemas[i].key] = {\n+                fields: [schemas.plainSchemas[i].key + \"_\" + 0]\n+              };\n+              // add other values\n+              for (var j = 1; j < $scope.user.plainAttrs[plainSchemaKey].values.length; j++) {\n+                $scope.dynamicForm.attributeTable[schemas.plainSchemas[i].key].fields.push(schemas.plainSchemas[i].key + \"_\" + j);\n               }\n             }\n           }\n@@ -119,24 +116,19 @@ angular.module(\"self\").controller(\"UserController\", ['$scope', '$rootScope', '$l\n                 values: [],\n                 readonly: schemas.virSchemas[i].readonly\n               };\n-\n               // initialize multivalue schema and support table: create mode, only first value\n-//              if (schemas.plainSchemas[i].multivalue) {\n-//                $scope.dynamicForm.attributeTable[schemas.plainSchemas[i].key] = {\n-//                  fields: [schemas.plainSchemas[i].key + \"_\" + 0]\n-//                };\n-//              }\n+              $scope.dynamicForm.virtualAttributeTable[schemas.virSchemas[i].key] = {\n+                fields: [schemas.virSchemas[i].key + \"_\" + 0]\n+              };\n             } else {\n               // initialize multivalue schema and support table: update mode, all provided values\n-//              if (schemas.virSchemas[i].multivalue) {\n-//                $scope.dynamicForm.attributeTable[schemas.virSchemas[i].key] = {\n-//                  fields: [schemas.virSchemas[i].key + \"_\" + 0]\n-//                };\n-//                // add other values\n-//                for (var j = 1; j < $scope.user.plainAttrs[plainSchemaKey].values.length; j++) {\n-//                  $scope.dynamicForm.attributeTable[schemas.plainSchemas[i].key].fields.push(schemas.plainSchemas[i].key + \"_\" + j);\n-//                }\n-//              }\n+              $scope.dynamicForm.virtualAttributeTable[schemas.virSchemas[i].key] = {\n+                fields: [schemas.virSchemas[i].key + \"_\" + 0]\n+              };\n+              // add other values\n+              for (var j = 1; j < $scope.user.virAttrs[virSchemaKey].values.length; j++) {\n+                $scope.dynamicForm.virtualAttributeTable[schemas.virSchemas[i].key].fields.push(schemas.virSchemas[i].key + \"_\" + j);\n+              }\n             }\n           }\n "},{"sha":"668c78c925ff2e1eddaf93e9045e7e8abd9becf0","filename":"client/enduser/src/main/resources/META-INF/resources/app/js/directives/dynamicDerivedAttribute.js","status":"modified","additions":2,"deletions":2,"changes":4,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/ae05dee916c5f456ddca26edfd525fa7c119e1c2/client%2Fenduser%2Fsrc%2Fmain%2Fresources%2FMETA-INF%2Fresources%2Fapp%2Fjs%2Fdirectives%2FdynamicDerivedAttribute.js","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/ae05dee916c5f456ddca26edfd525fa7c119e1c2/client%2Fenduser%2Fsrc%2Fmain%2Fresources%2FMETA-INF%2Fresources%2Fapp%2Fjs%2Fdirectives%2FdynamicDerivedAttribute.js","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/client%2Fenduser%2Fsrc%2Fmain%2Fresources%2FMETA-INF%2Fresources%2Fapp%2Fjs%2Fdirectives%2FdynamicDerivedAttribute.js?ref=ae05dee916c5f456ddca26edfd525fa7c119e1c2","patch":"@@ -19,7 +19,7 @@\n 'use strict';\n \n angular.module('self')\n-        .directive('dynamicDerivedAttribute', function ($filter) {\n+        .directive('dynamicDerivedAttribute', function () {\n           return {\n             restrict: 'E',\n             templateUrl: 'views/dynamicDerivedAttribute.html',\n@@ -28,7 +28,7 @@ angular.module('self')\n               index: \"=\",\n               user: \"=\"\n             },\n-            controller: function ($scope, $element, $window) {\n+            controller: function ($scope) {\n               $scope.$watch(function () {\n                 return $scope.user.derAttrs[$scope.schema.key].values[$scope.index];\n               }, function (newValue, oldValue) {"},{"sha":"2dbe6823ba62f9998fd1eaa6d28655e7407556dd","filename":"client/enduser/src/main/resources/META-INF/resources/app/js/directives/dynamicVirtualAttribute.js","status":"modified","additions":5,"deletions":160,"changes":165,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/ae05dee916c5f456ddca26edfd525fa7c119e1c2/client%2Fenduser%2Fsrc%2Fmain%2Fresources%2FMETA-INF%2Fresources%2Fapp%2Fjs%2Fdirectives%2FdynamicVirtualAttribute.js","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/ae05dee916c5f456ddca26edfd525fa7c119e1c2/client%2Fenduser%2Fsrc%2Fmain%2Fresources%2FMETA-INF%2Fresources%2Fapp%2Fjs%2Fdirectives%2FdynamicVirtualAttribute.js","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/client%2Fenduser%2Fsrc%2Fmain%2Fresources%2FMETA-INF%2Fresources%2Fapp%2Fjs%2Fdirectives%2FdynamicVirtualAttribute.js?ref=ae05dee916c5f456ddca26edfd525fa7c119e1c2","patch":"@@ -19,175 +19,20 @@\n 'use strict';\n \n angular.module('self')\n-        .directive('dynamicAttribute', function ($filter) {\n+        .directive('dynamicVirtualAttribute', function () {\n           return {\n             restrict: 'E',\n-            templateUrl: 'views/dynamicPlainAttribute.html',\n+            templateUrl: 'views/dynamicVirtualAttribute.html',\n             scope: {\n               schema: \"=\",\n               index: \"=\",\n               user: \"=\"\n             },\n-            controller: function ($scope, $element, $window) {\n-              $scope.initAttribute = function (schema, index) {\n-\n-                switch (schema.type) {\n-                  case \"Long\":\n-                  case \"Double\":\n-                    $scope.user.plainAttrs[schema.key].values[index] = Number($scope.user.plainAttrs[schema.key].values[index])\n-                            || undefined;\n-                    break;\n-                  case \"Enum\":\n-                    $scope.enumerationValues = [];\n-                    var enumerationValuesSplitted = schema.enumerationValues.toString().split(\";\");\n-                    for (var i = 0; i < enumerationValuesSplitted.length; i++) {\n-                      $scope.enumerationValues.push(enumerationValuesSplitted[i]);\n-                    }\n-                    $scope.user.plainAttrs[schema.key].values[index] = $scope.user.plainAttrs[schema.key].values[index]\n-                            || $scope.enumerationValues[0];\n-                    break;\n-                  case \"Binary\":\n-\n-                    $scope.userFile = $scope.userFile || '';\n-                    //for multivalue fields \n-//                    $scope.fileInputId = \"fileInputId_\" + index;\n-\n-                    $element.bind(\"change\", function (changeEvent) {\n-                      $scope.$apply(function () {\n-                        var reader = new FileReader();\n-                        var file = changeEvent.target.files[0];\n-                        $scope.userFile = file.name;\n-                        reader.onload = function (readerEvt) {\n-                          var binaryString = readerEvt.target.result;\n-                          $scope.user.plainAttrs[schema.key].values[index] = btoa(binaryString);\n-                        };\n-                        reader.readAsBinaryString(file);\n-                      });\n-                    });\n-\n-                    $scope.download = function () {\n-                      var byteString = atob($scope.user.plainAttrs[schema.key].values[index]);\n-\n-                      var ab = new ArrayBuffer(byteString.length);\n-                      var ia = new Uint8Array(ab);\n-                      for (var i = 0; i < byteString.length; i++) {\n-                        ia[i] = byteString.charCodeAt(i);\n-                      }\n-\n-                      var blob = new Blob([ia], {type: schema.mimeType});\n-\n-                      saveAs(blob, schema.key);\n-                    };\n-                    $scope.remove = function () {\n-                      $scope.user.plainAttrs[schema.key].values.splice(index, 1);\n-                      $scope.userFile = '';\n-                      $(\"#fileInput\").replaceWith($(\"#fileInput\").clone(true));\n-                    };\n-                    break;\n-                  case \"Date\":\n-\n-                    $scope.selectedDate = $scope.user.plainAttrs[schema.key].values[index];\n-                    $scope.format = $scope.schema.conversionPattern;\n-                    $scope.includeTimezone = false;\n-                    if ($scope.schema.conversionPattern.indexOf(\".SSS\") > -1) {\n-                      $scope.format = $scope.format.replace(\".SSS\", \".sss\");\n-                    }\n-                    if ($scope.schema.conversionPattern.indexOf(\"Z\") > -1) {\n-                      $scope.includeTimezone = true;\n-                      $scope.format = $scope.format.replace(\"Z\", \"\");\n-                    }\n-                    if ($scope.schema.conversionPattern.indexOf(\"\\'\") > -1) {\n-                      $scope.format = $scope.format.replace(new RegExp(\"\\'\", \"g\"), \"\");\n-                    }\n-\n-                    $scope.bindDateToModel = function (selectedDate, format) {\n-                      var newFormat = $scope.includeTimezone ? format.concat(\" Z\") : format;\n-                      if (selectedDate) {\n-                        selectedDate = $filter('date')(selectedDate, newFormat);\n-                        var dateGood = selectedDate.toString();\n-                        $scope.user.plainAttrs[schema.key].values[index] = dateGood;\n-                      } else {\n-                        $scope.user.plainAttrs[schema.key].values[index] = selectedDate;\n-                      }\n-                    };\n-\n-                    $scope.clear = function () {\n-                      $scope.user.plainAttrs[schema.key].values[index] = null;\n-                    };\n-\n-                    // Disable weekend selection\n-                    $scope.disabled = function (date, mode) {\n-                      // example if you want to disable weekends\n-                      // return (mode === 'day' && (date.getDay() === 0 || date.getDay() === 6));\n-                      return false;\n-                    };\n-\n-                    $scope.toggleMin = function () {\n-                      $scope.minDate = $scope.minDate ? null : new Date();\n-                    };\n-\n-                    $scope.maxDate = new Date(2050, 5, 22);\n-\n-                    $scope.open = function ($event) {\n-                      $scope.status.opened = true;\n-                    };\n-\n-                    $scope.setDate = function (year, month, day) {\n-                      $scope.user.plainAttrs[schema.key].values[index] = new Date(year, month, day);\n-                    };\n-\n-                    $scope.dateOptions = {\n-                      startingDay: 1\n-                    };\n-\n-                    $scope.status = {\n-                      opened: false\n-                    };\n-\n-                    var tomorrow = new Date();\n-                    tomorrow.setDate(tomorrow.getDate() + 1);\n-                    var afterTomorrow = new Date();\n-                    afterTomorrow.setDate(tomorrow.getDate() + 2);\n-                    $scope.events =\n-                            [\n-                              {\n-                                date: tomorrow,\n-                                status: 'full'\n-                              },\n-                              {\n-                                date: afterTomorrow,\n-                                status: 'partially'\n-                              }\n-                            ];\n-\n-                    $scope.getDayClass = function (date, mode) {\n-                      if (mode === 'day') {\n-                        var dayToCheck = new Date(date).setHours(0, 0, 0, 0);\n-\n-                        for (var i = 0; i < $scope.events.length; i++) {\n-                          var currentDay = new Date($scope.events[i].date).setHours(0, 0, 0, 0);\n-\n-                          if (dayToCheck === currentDay) {\n-                            return $scope.events[i].status;\n-                          }\n-                        }\n-                      }\n-\n-                    };\n-                    break;\n-\n-                  case \"Boolean\":\n-                    $scope.user.plainAttrs[schema.key].values[index] =\n-                            Boolean($scope.user.plainAttrs[schema.key].values[index]) || false;\n-                    break;\n-\n-                }\n-              };\n-\n+            controller: function ($scope) {\n               $scope.$watch(function () {\n-                return $scope.user.plainAttrs[$scope.schema.key].values[$scope.index];\n+                return $scope.user.virAttrs[$scope.schema.key].values[$scope.index];\n               }, function (newValue, oldValue) {\n-                $scope.user.plainAttrs[$scope.schema.key].values = $scope.user.plainAttrs[$scope.schema.key].values\n+                $scope.user.virAttrs[$scope.schema.key].values = $scope.user.virAttrs[$scope.schema.key].values\n                         .filter(function (n) {\n                           return (n !== undefined && n !== \"\");\n                         });"},{"sha":"460d300c68abc2234d61e07954f122f61eebb70f","filename":"client/enduser/src/main/resources/META-INF/resources/app/js/directives/dynamicVirtualAttributes.js","status":"modified","additions":8,"deletions":15,"changes":23,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/ae05dee916c5f456ddca26edfd525fa7c119e1c2/client%2Fenduser%2Fsrc%2Fmain%2Fresources%2FMETA-INF%2Fresources%2Fapp%2Fjs%2Fdirectives%2FdynamicVirtualAttributes.js","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/ae05dee916c5f456ddca26edfd525fa7c119e1c2/client%2Fenduser%2Fsrc%2Fmain%2Fresources%2FMETA-INF%2Fresources%2Fapp%2Fjs%2Fdirectives%2FdynamicVirtualAttributes.js","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/client%2Fenduser%2Fsrc%2Fmain%2Fresources%2FMETA-INF%2Fresources%2Fapp%2Fjs%2Fdirectives%2FdynamicVirtualAttributes.js?ref=ae05dee916c5f456ddca26edfd525fa7c119e1c2","patch":"@@ -29,24 +29,17 @@ angular.module('self')\n             },\n             controller: function ($scope) {\n \n-              $scope.addVirtualAttribute = function (item, model) {\n-                var virSchemaKey = item.key;\n-                console.log(\"ADDING VIRTUAL item: \", virSchemaKey);\n-                $scope.user.virAttrs[virSchemaKey] = {\n-                  schema: virSchemaKey,\n-                  values: [],\n-                  readonly: false\n-                };\n-\n+              $scope.addVirtualAttributeField = function (virSchemaKey) {\n+                console.log(\"ADDING VIRTUAL: \", virSchemaKey + \"_\" + ($scope.dynamicForm.virtualAttributeTable[virSchemaKey].fields.length));\n+                $scope.dynamicForm.virtualAttributeTable[virSchemaKey].fields.push(virSchemaKey + \"_\" + ($scope.dynamicForm.virtualAttributeTable[virSchemaKey].fields.length));\n               };\n \n-              $scope.removeVirtualAttribute = function (item, model) {\n-                var virSchemaKey = item.key;\n-                console.log(\"REMOVING VIRTUAL item: \", virSchemaKey);\n-                delete $scope.user.virAttrs[virSchemaKey];\n-                \n+              $scope.removeVirtualAttributeField = function (virSchemaKey, index) {\n+                console.log(\"REMOVING FROM: \" + virSchemaKey + \" VIRTUAL ATTRIBUTE INDEX: \" + index);\n+                $scope.dynamicForm.virtualAttributeTable[virSchemaKey].fields.splice(index, 1);\n+                // clean user model\n+                $scope.user.virAttrs[virSchemaKey].values.splice(index, 1);\n               };\n-\n             }\n           };\n         });"},{"sha":"e58a8de9d4dd541fc77023bac37426ecbde697e1","filename":"client/enduser/src/main/resources/META-INF/resources/app/views/dynamicDerivedAttributes.html","status":"modified","additions":1,"deletions":1,"changes":2,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/ae05dee916c5f456ddca26edfd525fa7c119e1c2/client%2Fenduser%2Fsrc%2Fmain%2Fresources%2FMETA-INF%2Fresources%2Fapp%2Fviews%2FdynamicDerivedAttributes.html","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/ae05dee916c5f456ddca26edfd525fa7c119e1c2/client%2Fenduser%2Fsrc%2Fmain%2Fresources%2FMETA-INF%2Fresources%2Fapp%2Fviews%2FdynamicDerivedAttributes.html","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/client%2Fenduser%2Fsrc%2Fmain%2Fresources%2FMETA-INF%2Fresources%2Fapp%2Fviews%2FdynamicDerivedAttributes.html?ref=ae05dee916c5f456ddca26edfd525fa7c119e1c2","patch":"@@ -1,4 +1,4 @@\n <div id=\"attribute\" class=\"form-group\" ng-repeat=\"derSchema in dynamicForm.derSchemas\">\n-  <label for=\"derivedSchema.key\">{{derSchema.key}} <span ng-if=\"Boolean(derSchema.mandatoryCondition) === 'true'\">*</span></label>\n+    <label for=\"derivedSchema.key\">{{derSchema.key}}</label>  <span uib-popover=\"{{derSchema.expression}}\" popover-trigger=\"mouseenter\" class=\"glyphicon glyphicon-question-sign\"/>\n   <dynamic-derived-attribute schema=\"derSchema\" user=\"user\" index=\"0\"></dynamic-derived-attribute>\n </div>"},{"sha":"5d4bb4038a1ddba7366ab92a6831876294550d91","filename":"client/enduser/src/main/resources/META-INF/resources/app/views/dynamicPlainAttributes.html","status":"modified","additions":1,"deletions":1,"changes":2,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/ae05dee916c5f456ddca26edfd525fa7c119e1c2/client%2Fenduser%2Fsrc%2Fmain%2Fresources%2FMETA-INF%2Fresources%2Fapp%2Fviews%2FdynamicPlainAttributes.html","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/ae05dee916c5f456ddca26edfd525fa7c119e1c2/client%2Fenduser%2Fsrc%2Fmain%2Fresources%2FMETA-INF%2Fresources%2Fapp%2Fviews%2FdynamicPlainAttributes.html","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/client%2Fenduser%2Fsrc%2Fmain%2Fresources%2FMETA-INF%2Fresources%2Fapp%2Fviews%2FdynamicPlainAttributes.html?ref=ae05dee916c5f456ddca26edfd525fa7c119e1c2","patch":"@@ -1,5 +1,5 @@\n <div id=\"attribute\" class=\"form-group\" ng-repeat=\"plainSchema in dynamicForm.plainSchemas\">\n-  <label for=\"plainSchema.key\">{{plainSchema.key}} <span ng-if=\"Boolean(plainSchema.mandatoryCondition)\">*</span></label>\n+  <label for=\"plainSchema.key\">{{plainSchema.key}} <span ng-if=\"plainSchema.mandatoryCondition === 'true'\">*</span></label>\n   <div ng-if=\"!plainSchema.multivalue\">\n     <dynamic-plain-attribute schema=\"plainSchema\" user=\"user\" index=\"0\"></dynamic-plain-attribute>\n   </div>"},{"sha":"826f249c984c4c933375eb6d573c748e94c36bac","filename":"client/enduser/src/main/resources/META-INF/resources/app/views/dynamicVirtualAttribute.html","status":"modified","additions":5,"deletions":58,"changes":63,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/ae05dee916c5f456ddca26edfd525fa7c119e1c2/client%2Fenduser%2Fsrc%2Fmain%2Fresources%2FMETA-INF%2Fresources%2Fapp%2Fviews%2FdynamicVirtualAttribute.html","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/ae05dee916c5f456ddca26edfd525fa7c119e1c2/client%2Fenduser%2Fsrc%2Fmain%2Fresources%2FMETA-INF%2Fresources%2Fapp%2Fviews%2FdynamicVirtualAttribute.html","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/client%2Fenduser%2Fsrc%2Fmain%2Fresources%2FMETA-INF%2Fresources%2Fapp%2Fviews%2FdynamicVirtualAttribute.html?ref=ae05dee916c5f456ddca26edfd525fa7c119e1c2","patch":"@@ -1,58 +1,5 @@\n-<div ng-switch=\"schema.type\" >\n-  <input ng-switch-when=\"String\" class=\"form-control\" type=\"text\"\n-         ng-model=\"user.plainAttrs[schema.key].values[index]\"\n-         ng-required=\"schema.mandatoryCondition\" \n-         ng-disabled=\"schema.readonly\" ng-init=\"initAttribute(schema, index)\"/>\n-  <input ng-switch-when=\"Encrypted\" class=\"form-control\" type=\"text\"\n-         ng-model=\"user.plainAttrs[schema.key].values[index]\"\n-         ng-required=\"schema.mandatoryCondition\" \n-         ng-disabled=\"schema.readonly\" ng-init=\"initAttribute(schema, index)\"/>\n-  <div ng-switch-when=\"Boolean\">\n-    <input type=\"checkbox\" ng-model=\"user.plainAttrs[schema.key].values[index]\" ng-required=\"schema.mandatoryCondition\" \n-           ng-init=\"initAttribute(schema, index)\" />\n-  </div>\n-  <input ng-switch-when=\"Long\" class=\"form-control\" type=\"number\" ng-model=\"user.plainAttrs[schema.key].values[index]\" ng-required=\"schema.mandatoryCondition\"\n-         ng-init=\"initAttribute(schema, index)\" />\n-  <input ng-switch-when=\"Double\" class=\"form-control\" type=\"number\" ng-model=\"user.plainAttrs[schema.key].values[index]\" ng-required=\"schema.mandatoryCondition\"\n-         ng-init=\"initAttribute(schema, index)\" />\n-  <p ng-switch-when=\"Date\" class=\"input-group\" >\n-    <input type=\"text\" class=\"form-control\" \n-           uib-datepicker-popup=\"{{format}}\"\n-           ng-model=\"selectedDate\"\n-           ng-change=\"bindDateToModel(selectedDate, format)\"\n-           min-date=\"minDate\" max-date=\"maxDate\"\n-           is-open=\"status.opened\" datepicker-options=\"dateOptions\"\n-           ng-required=\"schema.mandatoryCondition\" close-text=\"Close\" ng-init=\"initAttribute(schema, index)\"/>\n-    <span class=\"input-group-btn\">\n-      <button type=\"button\" class=\"btn btn-default\" ng-click=\"open($event)\"><i class=\"glyphicon glyphicon-calendar\"></i></button>\n-    </span>\n-  </p>\n-\n-  <div ng-switch-when=\"Enum\" ng-init=\"initAttribute(schema, index)\">\n-    <select class=\"form-control\"\n-            ng-model=\"user.plainAttrs[schema.key].values[index]\"\n-            ng-required=\"schema.mandatoryCondition\">\n-      <option ng-repeat=\"value in enumerationValues\" value=\"{{value}}\">{{schema.enumerationKeys[$index] || value}}</option>\n-    </select>\n-  </div>\n-\n-  <div ng-switch-when=\"Binary\" ng-init=\"initAttribute(schema, index)\">\n-    <div enctype=\"multipart/form-data\" accept-charset=\"UTF-8\">\n-      <input id=\"fileInput\" type=\"file\" ng-required=\"schema.mandatoryCondition\"/>\n-      <button type=\"button\" title=\"Download file\" class=\"fileButton btn btn-default btn-sm\" ng-click=\"download()\">\n-        <i class=\"glyphicon glyphicon-download\" ></i>\n-      </button>\n-      <button type=\"button\" class=\"fileButton btn btn-default btn-sm\" title=\"Remove file\" ng-click=\"remove()\">\n-        <i class=\"glyphicon glyphicon-remove-sign\" ></i>\n-      </button>\n-      <h4><span class=\"label label-primary\" ng-model=\"userFile\">{{userFile}}</span></h4>\n-    </div>\n-    \n-  </div>\n-\n-  <input ng-switch-default class=\"form-control\" type=\"text\"\n-         ng-model=\"user.plainAttrs[schema.key].values[index]\"\n-         ng-required=\"schema.mandatoryCondition\" \n-         ng-disabled=\"schema.readonly\" ng-init=\"initAttribute(schema, index)\"/>\n-\n-</div>\n+<div>\n+  <input class=\"form-control\" type=\"text\"\n+         ng-model=\"user.virAttrs[schema.key].values[index]\"\n+         ng-disabled=\"schema.readonly\"/>\n+</div>\n\\ No newline at end of file"},{"sha":"1334611de07df63538df598195fabfb21af22a35","filename":"client/enduser/src/main/resources/META-INF/resources/app/views/dynamicVirtualAttributes.html","status":"modified","additions":17,"deletions":18,"changes":35,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/ae05dee916c5f456ddca26edfd525fa7c119e1c2/client%2Fenduser%2Fsrc%2Fmain%2Fresources%2FMETA-INF%2Fresources%2Fapp%2Fviews%2FdynamicVirtualAttributes.html","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/ae05dee916c5f456ddca26edfd525fa7c119e1c2/client%2Fenduser%2Fsrc%2Fmain%2Fresources%2FMETA-INF%2Fresources%2Fapp%2Fviews%2FdynamicVirtualAttributes.html","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/client%2Fenduser%2Fsrc%2Fmain%2Fresources%2FMETA-INF%2Fresources%2Fapp%2Fviews%2FdynamicVirtualAttributes.html?ref=ae05dee916c5f456ddca26edfd525fa7c119e1c2","patch":"@@ -1,18 +1,17 @@\n-<ui-select on-select=\"addVirtualAttribute($item, $model)\" on-remove=\"removeVirtualAttribute($item, $model)\" multiple \n-           ng-model=\"dynamicForm.selectedVirSchemas\" theme=\"select2\" ng-disabled=\"false\" class=\"attribute-ui-select\">\n-  <ui-select-match placeholder=\"Select virtual attribute...\">{{$item.key}}</ui-select-match>\n-  <ui-select-choices repeat=\"virSchema in dynamicForm.virSchemas | propsFilter: {key: $select.search}\">\n-    <div ng-bind-html=\"virSchema.key | highlight: $select.search\"></div>\n-  </ui-select-choices>\n-</ui-select>\n-\n-<ul class=\"attribute-virtual-value-container\">\n-  <li class=\"attribute-virtual-value-field\" ng-repeat=\"selectedVirSchema in dynamicForm.selectedVirSchemas| filter:q as results\">\n-    {{selectedVirSchema.key}}\n-    <input style=\"font-weight: normal\" class=\"form-control\" type=\"text\" ng-disabled=\"selectedVirSchema.readonly\"\n-            ng-model=\"user.virAttrs[selectedVirSchema.key].values[0]\"/>\n-  </li>\n-  <li class=\"attribute-virtual-value-field\" ng-if=\"results.length == 0\">\n-    <strong>No virtual attributes selected...</strong>\n-  </li>\n-</ul>\n\\ No newline at end of file\n+<div id=\"attribute\" class=\"form-group\" ng-repeat=\"virtualSchema in dynamicForm.virSchemas\">\n+  <label for=\"virtualSchema.key\">{{virtualSchema.key}}</label>\n+  <!--all virtual schemas are multivalue-->\n+  <div ng-repeat=\"field in dynamicForm.virtualAttributeTable[virtualSchema.key].fields track by $index\" ng-model='dynamicForm.virtualAttributeTable[virtualSchema.key].fields[$index]'>\n+    <dynamic-virtual-attribute schema=\"virtualSchema\" user=\"user\" index=\"$index\"></dynamic-virtual-attribute>\n+    <span>\n+      <button class=\"btn btn-default btn-sm minus\" ng-if=\"$index > 0\" type=\"button\" ng-click=\"removeVirtualAttributeField(virtualSchema.key, $index)\">\n+        <i class=\"glyphicon glyphicon-minus\" title=\"Remove value\"></i>\n+      </button>\n+    </span>\n+  </div>\n+  <span>\n+    <button class=\"btn btn-default btn-sm\" type=\"button\" ng-click=\"addVirtualAttributeField(virtualSchema.key)\">\n+      <i class=\"glyphicon glyphicon-plus\" title=\"Add value\"></i>\n+    </button>\n+  </span>\n+</div>\n\\ No newline at end of file"},{"sha":"ca492fd824c5b34b343069dae71ec7adf33f3ad6","filename":"pom.xml","status":"modified","additions":0,"deletions":12,"changes":12,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/ae05dee916c5f456ddca26edfd525fa7c119e1c2/pom.xml","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/ae05dee916c5f456ddca26edfd525fa7c119e1c2/pom.xml","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/pom.xml?ref=ae05dee916c5f456ddca26edfd525fa7c119e1c2","patch":"@@ -402,7 +402,6 @@ under the License.\n     <angular-ui-select.version>0.13.1</angular-ui-select.version>\n     <angular-sanitize.version>1.4.8</angular-sanitize.version>\n     <angular-growl-2.version>0.7.3</angular-growl-2.version>\n-    <select2.version>3.4.8</select2.version>\n     <FileSaver.version>0.0.2</FileSaver.version>\n     \n     <izpack.version>5.0.6</izpack.version>\n@@ -1078,17 +1077,6 @@ under the License.\n         <artifactId>angular-growl-2</artifactId>\n         <version>${angular-growl-2.version}</version>\n       </dependency>\n-      <dependency>\n-        <groupId>org.webjars.bower</groupId>\n-        <artifactId>select2</artifactId>\n-        <version>${select2.version}</version>\n-        <exclusions>\n-          <exclusion>\n-            <groupId>org.webjars.bower</groupId>\n-            <artifactId>jquery</artifactId>\n-          </exclusion>\n-        </exclusions>\n-      </dependency>\n       <dependency>\n         <groupId>org.webjars.bower</groupId>\n         <artifactId>FileSaver.js</artifactId>"}]}