{"sha":"892e5bba130e2c6dcc7e5a6a4a123e46ba9440b3","node_id":"C_kwDOJfYA1toAKDg5MmU1YmJhMTMwZTJjNmRjYzdlNWE2YTRhMTIzZTQ2YmE5NDQwYjM","commit":{"author":{"name":"Francesco Chicchiriccò","email":"ilgrosso@users.noreply.github.com","date":"2022-02-09T13:49:54Z"},"committer":{"name":"GitHub","email":"noreply@github.com","date":"2022-02-09T13:49:54Z"},"message":"Enabling GH actions for Oracle DB (#311)","tree":{"sha":"a89afcf8f5c8c9eac95d41c2b3f8b29570bbe922","url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/git/trees/a89afcf8f5c8c9eac95d41c2b3f8b29570bbe922"},"url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/git/commits/892e5bba130e2c6dcc7e5a6a4a123e46ba9440b3","comment_count":0,"verification":{"verified":true,"reason":"valid","signature":"-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJiA8aCCRBK7hj4Ov3rIwAAFlEIAJkytB5NVf8uNRcsCAp94+Oz\n5sgmAJTPSIDIQaiI/R2vwQYyd8Jz0QC5o3TQ3D8OjJ8SSSzs+jWin1Sn7ocvHH7l\nTjhP8NuHtpp20lmXU48p/zomuiE3hi8KvuUgFBeYk0viOD6hlbgNp18oBpfyqDpb\nc7go4eeWw7ZKikd6PGwlRpgeebjfjcokZ4MaNttOlSVMxkMA4Xwu0u4ogqsJW1Ow\nogdgnnXIzRpyTc90Ft0usYZZFvf6ni7cEYHZxBrIbm3xqI256ffbd9wdnxMRxu7D\noOTIfc3owS9XnPvdT2nI5NRWaNyj3OpGMi93VUvqi6TNCjNP53x2gC3uURuHIls=\n=pLdc\n-----END PGP SIGNATURE-----\n","payload":"tree a89afcf8f5c8c9eac95d41c2b3f8b29570bbe922\nparent b7d454d8e691e97c9ee4cb1aa5052f5d0701ba7d\nauthor Francesco Chicchiriccò <ilgrosso@users.noreply.github.com> 1644414594 +0100\ncommitter GitHub <noreply@github.com> 1644414594 +0100\n\nEnabling GH actions for Oracle DB (#311)\n\n"}},"url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/892e5bba130e2c6dcc7e5a6a4a123e46ba9440b3","html_url":"https://github.com/EnricoDAlessandro97UNI/syncope/commit/892e5bba130e2c6dcc7e5a6a4a123e46ba9440b3","comments_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/892e5bba130e2c6dcc7e5a6a4a123e46ba9440b3/comments","author":{"login":"ilgrosso","id":1064664,"node_id":"MDQ6VXNlcjEwNjQ2NjQ=","avatar_url":"https://avatars.githubusercontent.com/u/1064664?v=4","gravatar_id":"","url":"https://api.github.com/users/ilgrosso","html_url":"https://github.com/ilgrosso","followers_url":"https://api.github.com/users/ilgrosso/followers","following_url":"https://api.github.com/users/ilgrosso/following{/other_user}","gists_url":"https://api.github.com/users/ilgrosso/gists{/gist_id}","starred_url":"https://api.github.com/users/ilgrosso/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ilgrosso/subscriptions","organizations_url":"https://api.github.com/users/ilgrosso/orgs","repos_url":"https://api.github.com/users/ilgrosso/repos","events_url":"https://api.github.com/users/ilgrosso/events{/privacy}","received_events_url":"https://api.github.com/users/ilgrosso/received_events","type":"User","site_admin":false},"committer":{"login":"web-flow","id":19864447,"node_id":"MDQ6VXNlcjE5ODY0NDQ3","avatar_url":"https://avatars.githubusercontent.com/u/19864447?v=4","gravatar_id":"","url":"https://api.github.com/users/web-flow","html_url":"https://github.com/web-flow","followers_url":"https://api.github.com/users/web-flow/followers","following_url":"https://api.github.com/users/web-flow/following{/other_user}","gists_url":"https://api.github.com/users/web-flow/gists{/gist_id}","starred_url":"https://api.github.com/users/web-flow/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/web-flow/subscriptions","organizations_url":"https://api.github.com/users/web-flow/orgs","repos_url":"https://api.github.com/users/web-flow/repos","events_url":"https://api.github.com/users/web-flow/events{/privacy}","received_events_url":"https://api.github.com/users/web-flow/received_events","type":"User","site_admin":false},"parents":[{"sha":"b7d454d8e691e97c9ee4cb1aa5052f5d0701ba7d","url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/b7d454d8e691e97c9ee4cb1aa5052f5d0701ba7d","html_url":"https://github.com/EnricoDAlessandro97UNI/syncope/commit/b7d454d8e691e97c9ee4cb1aa5052f5d0701ba7d"}],"stats":{"total":129,"additions":64,"deletions":65},"files":[{"sha":"8c24770eeb585b78c35256b3161327af78df1281","filename":".github/workflows/oracle.yml","status":"added","additions":47,"deletions":0,"changes":47,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/892e5bba130e2c6dcc7e5a6a4a123e46ba9440b3/.github%2Fworkflows%2Foracle.yml","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/892e5bba130e2c6dcc7e5a6a4a123e46ba9440b3/.github%2Fworkflows%2Foracle.yml","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/.github%2Fworkflows%2Foracle.yml?ref=892e5bba130e2c6dcc7e5a6a4a123e46ba9440b3","patch":"@@ -0,0 +1,47 @@\n+# Licensed to the Apache Software Foundation (ASF) under one\n+# or more contributor license agreements.  See the NOTICE file\n+# distributed with this work for additional information\n+# regarding copyright ownership.  The ASF licenses this file\n+# to you under the Apache License, Version 2.0 (the\n+# \"License\"); you may not use this file except in compliance\n+# with the License.  You may obtain a copy of the License at\n+#\n+#   http://www.apache.org/licenses/LICENSE-2.0\n+#\n+# Unless required by applicable law or agreed to in writing,\n+# software distributed under the License is distributed on an\n+# \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+# KIND, either express or implied.  See the License for the\n+# specific language governing permissions and limitations\n+# under the License\n+name: \"Oracle\"\n+\n+on:\n+  push:\n+    branches: ['master', 'pr-*']\n+  pull_request:\n+    # The branches below must be a subset of the branches above\n+    branches: [master]\n+  schedule:\n+    - cron: '0 13 * * 4'\n+\n+jobs:\n+  Oracle:\n+    runs-on: ubuntu-latest\n+\n+    steps:\n+    - name: Checkout repository\n+      uses: actions/checkout@v2\n+    - name: Setup Java JDK\n+      uses: actions/setup-java@v1.4.3\n+      with:\n+        java-version: 11\n+    - uses: actions/cache@v2.1.1\n+      with:\n+        path: ~/.m2\n+        key: ${{ runner.os }}-m2-${{ hashFiles('**/pom.xml') }}\n+        restore-keys: ${{ runner.os }}-m2\n+    - name: Build\n+      run: mvn -U -T 1C -P 'skipTests,all'\n+    - name: 'Integration Tests: Oracle'\n+      run: mvn -f fit/core-reference/pom.xml -P oracle-it -Dinvoker.streamLogs=true -Dmodernizer.skip=true -Drat.skip=true -Dcheckstyle.skip=true -Djacoco.skip=true"},{"sha":"1d519758f4dbdbb1c003409e208d265b60ba8278","filename":"core/provisioning-java/src/main/java/org/apache/syncope/core/provisioning/java/job/report/AuditReportlet.java","status":"modified","additions":5,"deletions":2,"changes":7,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/892e5bba130e2c6dcc7e5a6a4a123e46ba9440b3/core%2Fprovisioning-java%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fprovisioning%2Fjava%2Fjob%2Freport%2FAuditReportlet.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/892e5bba130e2c6dcc7e5a6a4a123e46ba9440b3/core%2Fprovisioning-java%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fprovisioning%2Fjava%2Fjob%2Freport%2FAuditReportlet.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fprovisioning-java%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fprovisioning%2Fjava%2Fjob%2Freport%2FAuditReportlet.java?ref=892e5bba130e2c6dcc7e5a6a4a123e46ba9440b3","patch":"@@ -111,8 +111,11 @@ private void doExtractConf(final ContentHandler handler, final AtomicReference<S\n             }\n \n             handler.startElement(\"\", \"\", \"throwable\", null);\n-            char[] throwable = row.get(\"THROWABLE\").toString().toCharArray();\n-            handler.characters(throwable, 0, throwable.length);\n+            Object throwableValue = row.get(\"THROWABLE\");\n+            if (throwableValue != null) {\n+                char[] throwable = throwableValue.toString().toCharArray();\n+                handler.characters(throwable, 0, throwable.length);\n+            }\n             handler.endElement(\"\", \"\", \"throwable\");\n \n             handler.endElement(\"\", \"\", \"event\");"},{"sha":"4f645fc98e76b67f3b458069e49687a028b38d58","filename":"fit/core-reference/pom.xml","status":"modified","additions":9,"deletions":14,"changes":23,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/892e5bba130e2c6dcc7e5a6a4a123e46ba9440b3/fit%2Fcore-reference%2Fpom.xml","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/892e5bba130e2c6dcc7e5a6a4a123e46ba9440b3/fit%2Fcore-reference%2Fpom.xml","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/fit%2Fcore-reference%2Fpom.xml?ref=892e5bba130e2c6dcc7e5a6a4a123e46ba9440b3","patch":"@@ -1140,10 +1140,10 @@ under the License.\n         </plugins>\n       </build>\n     </profile>\n-    \n+\n     <profile>\n       <id>oracle-it</id>\n-      \n+\n       <properties>\n         <jdbcdriver.groupId>com.oracle.database.jdbc</jdbcdriver.groupId>\n         <jdbcdriver.artifactId>ojdbc11</jdbcdriver.artifactId>\n@@ -1183,22 +1183,17 @@ under the License.\n               <images>\n                 <image>\n                   <alias>oracle</alias>\n-                  <name>oracleinanutshell/oracle-xe-11g:latest</name>\n+                  <name>gvenzl/oracle-xe:18-slim</name>\n                   <run>\n                     <env>\n-                      <ORACLE_ALLOW_REMOTE>true</ORACLE_ALLOW_REMOTE>\n-                      <ORACLE_ENABLE_XDB>true</ORACLE_ENABLE_XDB>\n-                      <ORACLE_DISABLE_ASYNCH_IO>true</ORACLE_DISABLE_ASYNCH_IO>\n+                      <ORACLE_PASSWORD>password</ORACLE_PASSWORD>\n+                      <APP_USER>syncope</APP_USER>\n+                      <APP_USER_PASSWORD>syncope</APP_USER_PASSWORD>\n                     </env>\n                     <wait>\n-                      <log>Disconnected from Oracle Database 11g Express Edition</log>\n+                      <log>DATABASE IS READY TO USE</log>\n                       <time>120000</time>\n-                    </wait>                \n-                    <volumes>\n-                      <bind>\n-                        <volume>${project.build.outputDirectory}/oracle/:/docker-entrypoint-initdb.d/</volume>\n-                      </bind>\n-                    </volumes>\n+                    </wait>\n                   </run>\n                 </image>\n               </images>\n@@ -1228,7 +1223,7 @@ under the License.\n               </execution>\n             </executions>\n           </plugin>\n-          \n+\n           <plugin>\n             <groupId>org.codehaus.cargo</groupId>\n             <artifactId>cargo-maven3-plugin</artifactId>"},{"sha":"2ddf7722689cce9c5f99b8108646f473a7407c89","filename":"fit/core-reference/src/main/resources/core-oracle.properties","status":"modified","additions":1,"deletions":1,"changes":2,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/892e5bba130e2c6dcc7e5a6a4a123e46ba9440b3/fit%2Fcore-reference%2Fsrc%2Fmain%2Fresources%2Fcore-oracle.properties","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/892e5bba130e2c6dcc7e5a6a4a123e46ba9440b3/fit%2Fcore-reference%2Fsrc%2Fmain%2Fresources%2Fcore-oracle.properties","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/fit%2Fcore-reference%2Fsrc%2Fmain%2Fresources%2Fcore-oracle.properties?ref=892e5bba130e2c6dcc7e5a6a4a123e46ba9440b3","patch":"@@ -17,7 +17,7 @@\n \n persistence.domain[0].key=Master\n persistence.domain[0].jdbcDriver=oracle.jdbc.OracleDriver\n-persistence.domain[0].jdbcURL=jdbc:oracle:thin:@${DB_CONTAINER_IP}:1521:XE\n+persistence.domain[0].jdbcURL=jdbc:oracle:thin:@${DB_CONTAINER_IP}:1521/XEPDB1\n persistence.domain[0].schema=SYNCOPE\n persistence.domain[0].dbUsername=syncope\n persistence.domain[0].dbPassword=syncope"},{"sha":"e45677a14b01bd66d7fc695c5db40901ae96660e","filename":"fit/core-reference/src/main/resources/oracle/init.sql","status":"removed","additions":0,"deletions":43,"changes":43,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/b7d454d8e691e97c9ee4cb1aa5052f5d0701ba7d/fit%2Fcore-reference%2Fsrc%2Fmain%2Fresources%2Foracle%2Finit.sql","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/b7d454d8e691e97c9ee4cb1aa5052f5d0701ba7d/fit%2Fcore-reference%2Fsrc%2Fmain%2Fresources%2Foracle%2Finit.sql","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/fit%2Fcore-reference%2Fsrc%2Fmain%2Fresources%2Foracle%2Finit.sql?ref=b7d454d8e691e97c9ee4cb1aa5052f5d0701ba7d","patch":"@@ -1,43 +0,0 @@\n--- Licensed to the Apache Software Foundation (ASF) under one\n--- or more contributor license agreements.  See the NOTICE file\n--- distributed with this work for additional information\n--- regarding copyright ownership.  The ASF licenses this file\n--- to you under the Apache License, Version 2.0 (the\n--- \"License\"); you may not use this file except in compliance\n--- with the License.  You may obtain a copy of the License at\n---\n---   http://www.apache.org/licenses/LICENSE-2.0\n---\n--- Unless required by applicable law or agreed to in writing,\n--- software distributed under the License is distributed on an\n--- \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n--- KIND, either express or implied.  See the License for the\n--- specific language governing permissions and limitations\n--- under the License.\n-\n-CREATE TABLESPACE SYNCOPE\n-  DATAFILE 'SYNCOPE.dat'\n-  SIZE 10M AUTOEXTEND on;\n-\n-CREATE TEMPORARY TABLESPACE SYNCOPE_TEMP\n-  TEMPFILE 'SYNCOPE_TEMP.dat'\n-  SIZE 5M AUTOEXTEND on;\n-\n-CREATE USER syncope\n-  IDENTIFIED BY syncope\n-  DEFAULT TABLESPACE SYNCOPE\n-  TEMPORARY TABLESPACE SYNCOPE_TEMP\n-  QUOTA 256M on SYNCOPE;\n-\n-GRANT create session TO syncope;\n-GRANT create table TO syncope;\n-GRANT create view TO syncope;\n-GRANT create any trigger TO syncope;\n-GRANT create any procedure TO syncope;\n-GRANT create sequence TO syncope;\n-GRANT create synonym TO syncope;\n-\n-CREATE DATABASE syncope\n-  CHARACTER SET US7ASCII\n-  DEFAULT TABLESPACE SYNCOPE\n-  DEFAULT TEMPORARY TABLESPACE SYNCOPE_TEMP"},{"sha":"687d281d4b34d3262a85c517a4d143f271d385f6","filename":"fit/core-reference/src/test/java/org/apache/syncope/fit/core/UserSelfITCase.java","status":"modified","additions":2,"deletions":5,"changes":7,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/892e5bba130e2c6dcc7e5a6a4a123e46ba9440b3/fit%2Fcore-reference%2Fsrc%2Ftest%2Fjava%2Forg%2Fapache%2Fsyncope%2Ffit%2Fcore%2FUserSelfITCase.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/892e5bba130e2c6dcc7e5a6a4a123e46ba9440b3/fit%2Fcore-reference%2Fsrc%2Ftest%2Fjava%2Forg%2Fapache%2Fsyncope%2Ffit%2Fcore%2FUserSelfITCase.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/fit%2Fcore-reference%2Fsrc%2Ftest%2Fjava%2Forg%2Fapache%2Fsyncope%2Ffit%2Fcore%2FUserSelfITCase.java?ref=892e5bba130e2c6dcc7e5a6a4a123e46ba9440b3","patch":"@@ -329,9 +329,6 @@ public void passwordReset() {\n         UserTO read = authClient.self().getRight();\n         assertNotNull(read);\n \n-        // SYNCOPE-1293:get users with token not null before requesting password reset\n-        PagedResult<UserTO> before = userService.search(new AnyQuery.Builder().fiql(\"token!=$null\").build());\n-\n         // 3. request password reset (as anonymous) providing the expected security answer\n         SyncopeClient anonClient = clientFactory.create();\n         try {\n@@ -350,8 +347,8 @@ public void passwordReset() {\n                 // ignore\n             }\n         }\n-        PagedResult<UserTO> after = userService.search(new AnyQuery.Builder().fiql(\"token!=$null\").build());\n-        assertEquals(before.getTotalCount() + 1, after.getTotalCount());\n+        PagedResult<UserTO> tokenized = userService.search(new AnyQuery.Builder().fiql(\"token!=$null\").build());\n+        assertTrue(tokenized.getResult().stream().anyMatch(u -> user.getUsername().equals(u.getUsername())));\n \n         // 4. get token (normally sent via e-mail, now reading as admin)\n         String token = userService.read(read.getKey()).getToken();"}]}