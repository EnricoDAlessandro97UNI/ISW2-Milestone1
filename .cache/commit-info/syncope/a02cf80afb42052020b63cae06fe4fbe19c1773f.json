{"sha":"a02cf80afb42052020b63cae06fe4fbe19c1773f","node_id":"MDY6Q29tbWl0NjM2ODc5MDYyOmEwMmNmODBhZmI0MjA1MjAyMGI2M2NhZTA2ZmU0ZmJlMTljMTc3M2Y=","commit":{"author":{"name":"Francesco Chicchiriccò","email":"ilgrosso@apache.org","date":"2014-08-04T13:54:54Z"},"committer":{"name":"Francesco Chicchiriccò","email":"ilgrosso@apache.org","date":"2014-08-04T13:54:54Z"},"message":"[SYNCOPE-138] Merge from 1_2_X\n\ngit-svn-id: https://svn.apache.org/repos/asf/syncope/trunk@1615560 13f79535-47bb-0310-9956-ffa450edef68","tree":{"sha":"5c9ce81ffaee621ef1786218cec39bb419623bef","url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/git/trees/5c9ce81ffaee621ef1786218cec39bb419623bef"},"url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/git/commits/a02cf80afb42052020b63cae06fe4fbe19c1773f","comment_count":0,"verification":{"verified":false,"reason":"unsigned","signature":null,"payload":null}},"url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/a02cf80afb42052020b63cae06fe4fbe19c1773f","html_url":"https://github.com/EnricoDAlessandro97UNI/syncope/commit/a02cf80afb42052020b63cae06fe4fbe19c1773f","comments_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/a02cf80afb42052020b63cae06fe4fbe19c1773f/comments","author":{"login":"ilgrosso","id":1064664,"node_id":"MDQ6VXNlcjEwNjQ2NjQ=","avatar_url":"https://avatars.githubusercontent.com/u/1064664?v=4","gravatar_id":"","url":"https://api.github.com/users/ilgrosso","html_url":"https://github.com/ilgrosso","followers_url":"https://api.github.com/users/ilgrosso/followers","following_url":"https://api.github.com/users/ilgrosso/following{/other_user}","gists_url":"https://api.github.com/users/ilgrosso/gists{/gist_id}","starred_url":"https://api.github.com/users/ilgrosso/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ilgrosso/subscriptions","organizations_url":"https://api.github.com/users/ilgrosso/orgs","repos_url":"https://api.github.com/users/ilgrosso/repos","events_url":"https://api.github.com/users/ilgrosso/events{/privacy}","received_events_url":"https://api.github.com/users/ilgrosso/received_events","type":"User","site_admin":false},"committer":{"login":"ilgrosso","id":1064664,"node_id":"MDQ6VXNlcjEwNjQ2NjQ=","avatar_url":"https://avatars.githubusercontent.com/u/1064664?v=4","gravatar_id":"","url":"https://api.github.com/users/ilgrosso","html_url":"https://github.com/ilgrosso","followers_url":"https://api.github.com/users/ilgrosso/followers","following_url":"https://api.github.com/users/ilgrosso/following{/other_user}","gists_url":"https://api.github.com/users/ilgrosso/gists{/gist_id}","starred_url":"https://api.github.com/users/ilgrosso/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ilgrosso/subscriptions","organizations_url":"https://api.github.com/users/ilgrosso/orgs","repos_url":"https://api.github.com/users/ilgrosso/repos","events_url":"https://api.github.com/users/ilgrosso/events{/privacy}","received_events_url":"https://api.github.com/users/ilgrosso/received_events","type":"User","site_admin":false},"parents":[{"sha":"e826be6ef3455b73d18e61f2fbaa8d43ea250142","url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/e826be6ef3455b73d18e61f2fbaa8d43ea250142","html_url":"https://github.com/EnricoDAlessandro97UNI/syncope/commit/e826be6ef3455b73d18e61f2fbaa8d43ea250142"},{"sha":"f064dce8b254b741eb6c8f7389392464ddad4032","url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/f064dce8b254b741eb6c8f7389392464ddad4032","html_url":"https://github.com/EnricoDAlessandro97UNI/syncope/commit/f064dce8b254b741eb6c8f7389392464ddad4032"}],"stats":{"total":318,"additions":256,"deletions":62},"files":[{"sha":"b32265b6b2fe09ce672156c6a1b530e142bbaf6d","filename":"core/src/main/java/org/apache/syncope/core/notification/NotificationManager.java","status":"modified","additions":10,"deletions":2,"changes":12,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/a02cf80afb42052020b63cae06fe4fbe19c1773f/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fnotification%2FNotificationManager.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/a02cf80afb42052020b63cae06fe4fbe19c1773f/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fnotification%2FNotificationManager.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fnotification%2FNotificationManager.java?ref=a02cf80afb42052020b63cae06fe4fbe19c1773f","patch":"@@ -83,6 +83,12 @@ public class NotificationManager {\n      */\n     private static final Logger LOG = LoggerFactory.getLogger(NotificationManager.class);\n \n+    public static final String MAIL_TEMPLATES = \"mailTemplates/\";\n+\n+    public static final String MAIL_TEMPLATE_HTML_SUFFIX = \".html.vm\";\n+\n+    public static final String MAIL_TEMPLATE_TEXT_SUFFIX = \".txt.vm\";\n+\n     /**\n      * Notification DAO.\n      */\n@@ -209,8 +215,10 @@ private NotificationTask getNotificationTask(\n         task.setSender(notification.getSender());\n         task.setSubject(notification.getSubject());\n \n-        String htmlBody = mergeTemplateIntoString(\"mailTemplates/\" + notification.getTemplate() + \".html.vm\", model);\n-        String textBody = mergeTemplateIntoString(\"mailTemplates/\" + notification.getTemplate() + \".txt.vm\", model);\n+        String htmlBody = mergeTemplateIntoString(\n+                MAIL_TEMPLATES + notification.getTemplate() + MAIL_TEMPLATE_HTML_SUFFIX, model);\n+        String textBody = mergeTemplateIntoString(\n+                MAIL_TEMPLATES + notification.getTemplate() + MAIL_TEMPLATE_TEXT_SUFFIX, model);\n \n         task.setHtmlBody(htmlBody);\n         task.setTextBody(textBody);"},{"sha":"a2f8d0dd705dc7398d5d37c3a0f6878a734e24db","filename":"core/src/main/java/org/apache/syncope/core/rest/controller/ConfigurationController.java","status":"modified","additions":11,"deletions":8,"changes":19,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/a02cf80afb42052020b63cae06fe4fbe19c1773f/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Frest%2Fcontroller%2FConfigurationController.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/a02cf80afb42052020b63cae06fe4fbe19c1773f/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Frest%2Fcontroller%2FConfigurationController.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Frest%2Fcontroller%2FConfigurationController.java?ref=a02cf80afb42052020b63cae06fe4fbe19c1773f","patch":"@@ -27,15 +27,16 @@\n import org.apache.syncope.common.to.ConfTO;\n import org.apache.syncope.core.init.ImplementationClassNamesLoader;\n import org.apache.syncope.core.init.WorkflowAdapterLoader;\n+import org.apache.syncope.core.notification.NotificationManager;\n import org.apache.syncope.core.persistence.beans.conf.CAttr;\n import org.apache.syncope.core.persistence.dao.ConfDAO;\n import org.apache.syncope.core.persistence.dao.NotFoundException;\n import org.apache.syncope.core.persistence.validation.attrvalue.Validator;\n import org.apache.syncope.core.rest.data.ConfigurationDataBinder;\n import org.apache.syncope.core.util.ContentExporter;\n+import org.apache.syncope.core.util.ResourceWithFallbackLoader;\n import org.springframework.beans.factory.annotation.Autowired;\n import org.springframework.core.io.Resource;\n-import org.springframework.core.io.support.ResourcePatternResolver;\n import org.springframework.security.access.prepost.PreAuthorize;\n import org.springframework.stereotype.Component;\n import org.springframework.transaction.annotation.Transactional;\n@@ -55,8 +56,8 @@ public class ConfigurationController extends AbstractTransactionalController<Con\n     @Autowired\n     private ImplementationClassNamesLoader classNamesLoader;\n \n-    @Autowired\n-    private ResourcePatternResolver resResolver;\n+    @javax.annotation.Resource(name = \"velocityResourceLoader\")\n+    private ResourceWithFallbackLoader resourceLoader;\n \n     @Autowired\n     private WorkflowAdapterLoader wfAdapterLoader;\n@@ -97,14 +98,16 @@ public Set<String> getMailTemplates() {\n         Set<String> textTemplates = new HashSet<String>();\n \n         try {\n-            for (Resource resource : resResolver.getResources(\"classpath:/mailTemplates/*.vm\")) {\n+            for (Resource resource : resourceLoader.getResources(NotificationManager.MAIL_TEMPLATES + \"*.vm\")) {\n                 String template = resource.getURL().toExternalForm();\n-                if (template.endsWith(\".html.vm\")) {\n+                if (template.endsWith(NotificationManager.MAIL_TEMPLATE_HTML_SUFFIX)) {\n                     htmlTemplates.add(\n-                            template.substring(template.indexOf(\"mailTemplates/\") + 14, template.indexOf(\".html.vm\")));\n-                } else if (template.endsWith(\".txt.vm\")) {\n+                            template.substring(template.indexOf(NotificationManager.MAIL_TEMPLATES) + 14,\n+                                    template.indexOf(NotificationManager.MAIL_TEMPLATE_HTML_SUFFIX)));\n+                } else if (template.endsWith(NotificationManager.MAIL_TEMPLATE_TEXT_SUFFIX)) {\n                     textTemplates.add(\n-                            template.substring(template.indexOf(\"mailTemplates/\") + 14, template.indexOf(\".txt.vm\")));\n+                            template.substring(template.indexOf(NotificationManager.MAIL_TEMPLATES) + 14,\n+                                    template.indexOf(NotificationManager.MAIL_TEMPLATE_TEXT_SUFFIX)));\n                 } else {\n                     LOG.warn(\"Unexpected template found: {}, ignoring...\", template);\n                 }"},{"sha":"c92e823bcbe4e6497a1685b3f6183d385f915e9d","filename":"core/src/main/java/org/apache/syncope/core/util/ResourceWithFallbackLoader.java","status":"modified","additions":33,"deletions":9,"changes":42,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/a02cf80afb42052020b63cae06fe4fbe19c1773f/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Futil%2FResourceWithFallbackLoader.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/a02cf80afb42052020b63cae06fe4fbe19c1773f/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Futil%2FResourceWithFallbackLoader.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Futil%2FResourceWithFallbackLoader.java?ref=a02cf80afb42052020b63cae06fe4fbe19c1773f","patch":"@@ -18,21 +18,25 @@\n  */\n package org.apache.syncope.core.util;\n \n+import java.io.IOException;\n+import org.apache.commons.lang3.StringUtils;\n+import org.apache.commons.lang3.ArrayUtils;\n import org.springframework.context.ResourceLoaderAware;\n import org.springframework.core.io.Resource;\n import org.springframework.core.io.ResourceLoader;\n+import org.springframework.core.io.support.ResourcePatternResolver;\n \n-public class ResourceWithFallbackLoader implements ResourceLoaderAware {\n+public class ResourceWithFallbackLoader implements ResourceLoaderAware, ResourcePatternResolver {\n \n-    private ResourceLoader resourceLoader;\n+    private ResourcePatternResolver resolver;\n \n     private String primary;\n \n     private String fallback;\n \n     @Override\n     public void setResourceLoader(final ResourceLoader resourceLoader) {\n-        this.resourceLoader = resourceLoader;\n+        this.resolver = (ResourcePatternResolver) resourceLoader;\n     }\n \n     public void setPrimary(final String primary) {\n@@ -43,16 +47,36 @@ public void setFallback(final String fallback) {\n         this.fallback = fallback;\n     }\n \n-    public Resource getResource() {\n-        Resource resource = resourceLoader.getResource(primary);\n-        if (!resource.exists()) {\n-            resource = resourceLoader.getResource(fallback);\n-        }\n+    @Override\n+    public Resource getResource(final String location) {\n+        Resource resource = resolver.getResource(primary + location);\n         if (!resource.exists()) {\n-            throw new IllegalArgumentException(\"Neither \" + primary + \" nor \" + fallback + \" were found.\");\n+            resource = resolver.getResource(fallback + location);\n         }\n \n         return resource;\n     }\n \n+    public Resource getResource() {\n+        return getResource(StringUtils.EMPTY);\n+    }\n+\n+    @Override\n+    public Resource[] getResources(final String locationPattern) throws IOException {\n+        Resource[] resources = resolver.getResources(primary + locationPattern);\n+        if (ArrayUtils.isEmpty(resources)) {\n+            resources = resolver.getResources(fallback + locationPattern);\n+        }\n+\n+        return resources;\n+    }\n+\n+    public Resource[] getResources() throws IOException {\n+        return getResources(StringUtils.EMPTY);\n+    }\n+\n+    @Override\n+    public ClassLoader getClassLoader() {\n+        return resolver.getClassLoader();\n+    }\n }"},{"sha":"9add860685db04d60fdc106e74df94b982da719a","filename":"core/src/main/java/org/apache/syncope/core/util/SpringVelocityResourceLoader.java","status":"added","additions":84,"deletions":0,"changes":84,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/a02cf80afb42052020b63cae06fe4fbe19c1773f/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Futil%2FSpringVelocityResourceLoader.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/a02cf80afb42052020b63cae06fe4fbe19c1773f/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Futil%2FSpringVelocityResourceLoader.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Futil%2FSpringVelocityResourceLoader.java?ref=a02cf80afb42052020b63cae06fe4fbe19c1773f","patch":"@@ -0,0 +1,84 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *   http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+package org.apache.syncope.core.util;\n+\n+import java.io.IOException;\n+import java.io.InputStream;\n+import org.apache.commons.collections.ExtendedProperties;\n+import org.apache.velocity.exception.ResourceNotFoundException;\n+import org.apache.velocity.runtime.resource.Resource;\n+import org.apache.velocity.runtime.resource.loader.ResourceLoader;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+/**\n+ * Velocity ResourceLoader adapter that loads via a Spring ResourceLoader.\n+ * Similar to {@link org.springframework.ui.velocity.SpringResourceLoader} but more integrated with\n+ * {@link VelocityEngineFactoryBean}.\n+ */\n+public class SpringVelocityResourceLoader extends ResourceLoader {\n+\n+    private static final Logger LOG = LoggerFactory.getLogger(SpringVelocityResourceLoader.class);\n+\n+    public static final String NAME = \"spring\";\n+\n+    public static final String SPRING_RESOURCE_LOADER_CLASS = \"spring.resource.loader.class\";\n+\n+    public static final String SPRING_RESOURCE_LOADER_CACHE = \"spring.resource.loader.cache\";\n+\n+    public static final String SPRING_RESOURCE_LOADER = \"spring.resource.loader\";\n+\n+    private org.springframework.core.io.ResourceLoader resourceLoader;\n+\n+    @Override\n+    public void init(ExtendedProperties configuration) {\n+        this.resourceLoader =\n+                (org.springframework.core.io.ResourceLoader) this.rsvc.getApplicationAttribute(SPRING_RESOURCE_LOADER);\n+        if (this.resourceLoader == null) {\n+            throw new IllegalArgumentException(\n+                    \"'\" + SPRING_RESOURCE_LOADER + \"' application attribute must be present for SpringResourceLoader\");\n+        }\n+\n+        LOG.info(\"SpringResourceLoader for Velocity: using resource loader [\" + this.resourceLoader + \"]\");\n+    }\n+\n+    @Override\n+    public InputStream getResourceStream(final String source) throws ResourceNotFoundException {\n+        LOG.debug(\"Looking for Velocity resource with name [{}]\", source);\n+\n+        org.springframework.core.io.Resource resource = this.resourceLoader.getResource(source);\n+        try {\n+            return resource.getInputStream();\n+        } catch (IOException e) {\n+            LOG.debug(\"Could not find Velocity resource: \" + resource, e);\n+        }\n+        throw new ResourceNotFoundException(\"Could not find resource [\" + source + \"]\");\n+    }\n+\n+    @Override\n+    public boolean isSourceModified(final Resource resource) {\n+        return false;\n+    }\n+\n+    @Override\n+    public long getLastModified(final Resource resource) {\n+        return 0;\n+    }\n+\n+}"},{"sha":"5410a508f4cbc2ab3b34674f129ebc871a49224f","filename":"core/src/main/java/org/apache/syncope/core/util/VelocityEngineFactoryBean.java","status":"added","additions":86,"deletions":0,"changes":86,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/a02cf80afb42052020b63cae06fe4fbe19c1773f/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Futil%2FVelocityEngineFactoryBean.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/a02cf80afb42052020b63cae06fe4fbe19c1773f/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Futil%2FVelocityEngineFactoryBean.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Futil%2FVelocityEngineFactoryBean.java?ref=a02cf80afb42052020b63cae06fe4fbe19c1773f","patch":"@@ -0,0 +1,86 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *   http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+package org.apache.syncope.core.util;\n+\n+import java.io.IOException;\n+import org.apache.velocity.app.VelocityEngine;\n+import org.apache.velocity.exception.VelocityException;\n+import org.apache.velocity.runtime.RuntimeConstants;\n+import org.springframework.beans.factory.FactoryBean;\n+import org.springframework.beans.factory.InitializingBean;\n+import org.springframework.core.io.DefaultResourceLoader;\n+import org.springframework.core.io.ResourceLoader;\n+\n+/**\n+ * Similar to Spring's equivalent, does not implement {@link org.springframework.context.ResourceLoaderAware} thus\n+ * allowing custom injection.\n+ *\n+ * @see org.springframework.ui.velocity.VelocityEngineFactoryBean\n+ */\n+public class VelocityEngineFactoryBean implements FactoryBean<VelocityEngine>, InitializingBean {\n+\n+    private ResourceLoader resourceLoader = new DefaultResourceLoader();\n+\n+    private VelocityEngine velocityEngine;\n+\n+    public ResourceLoader getResourceLoader() {\n+        return resourceLoader;\n+    }\n+\n+    public void setResourceLoader(final ResourceLoader resourceLoader) {\n+        this.resourceLoader = resourceLoader;\n+    }\n+\n+    private void createVelocityEngine() throws IOException, VelocityException {\n+        velocityEngine = new VelocityEngine();\n+\n+        velocityEngine.setProperty(\n+                RuntimeConstants.RESOURCE_LOADER, SpringVelocityResourceLoader.NAME);\n+        velocityEngine.setProperty(\n+                SpringVelocityResourceLoader.SPRING_RESOURCE_LOADER_CLASS,\n+                SpringVelocityResourceLoader.class.getName());\n+        velocityEngine.setProperty(\n+                SpringVelocityResourceLoader.SPRING_RESOURCE_LOADER_CACHE, \"true\");\n+        velocityEngine.setApplicationAttribute(\n+                SpringVelocityResourceLoader.SPRING_RESOURCE_LOADER, getResourceLoader());\n+\n+        velocityEngine.init();\n+    }\n+\n+    @Override\n+    public void afterPropertiesSet() throws IOException, VelocityException {\n+        createVelocityEngine();\n+    }\n+\n+    @Override\n+    public VelocityEngine getObject() {\n+        return this.velocityEngine;\n+    }\n+\n+    @Override\n+    public Class<? extends VelocityEngine> getObjectType() {\n+        return VelocityEngine.class;\n+    }\n+\n+    @Override\n+    public boolean isSingleton() {\n+        return true;\n+    }\n+\n+}"},{"sha":"9b12622c4fc2a1c52f0b647e05469b52a89de71d","filename":"core/src/main/resources/coreContext.xml","status":"modified","additions":16,"deletions":2,"changes":18,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/a02cf80afb42052020b63cae06fe4fbe19c1773f/core%2Fsrc%2Fmain%2Fresources%2FcoreContext.xml","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/a02cf80afb42052020b63cae06fe4fbe19c1773f/core%2Fsrc%2Fmain%2Fresources%2FcoreContext.xml","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fsrc%2Fmain%2Fresources%2FcoreContext.xml?ref=a02cf80afb42052020b63cae06fe4fbe19c1773f","patch":"@@ -96,8 +96,6 @@ under the License.\n   <bean id=\"propagationTaskExecutor\" class=\"org.apache.syncope.core.propagation.impl.PriorityPropagationTaskExecutor\"/>\n   <bean id=\"propagationReporter\" class=\"org.apache.syncope.core.propagation.impl.DefaultPropagationReporter\" scope=\"prototype\"/>\n \n-  <bean id=\"notificationManager\" class=\"org.apache.syncope.core.notification.NotificationManager\"/>\n-\n   <bean id=\"auditManager\" class=\"org.apache.syncope.core.audit.AuditManager\"/>\n   \n   <bean id=\"connIdBundleManager\" class=\"org.apache.syncope.core.util.ConnIdBundleManager\" scope=\"singleton\">\n@@ -108,6 +106,8 @@ under the License.\n \n   <bean id=\"syncUtilities\" class=\"org.apache.syncope.core.sync.SyncUtilities\"/>\n   \n+  <bean id=\"notificationManager\" class=\"org.apache.syncope.core.notification.NotificationManager\"/>\n+\n   <bean id=\"mailSender\" class=\"org.springframework.mail.javamail.JavaMailSenderImpl\">\n     <property name=\"defaultEncoding\" value=\"${smtpEncoding}\"/>\n     <property name=\"host\" value=\"${smtpHost}\"/>\n@@ -124,6 +124,20 @@ under the License.\n     </property>\n   </bean>\n \n+  <bean id=\"velocityResourceLoader\" class=\"org.apache.syncope.core.util.ResourceWithFallbackLoader\">\n+    <property name=\"primary\" value=\"file:${conf.directory}/\"/>\n+    <property name=\"fallback\" value=\"classpath:\"/>\n+  </bean>\n+  <bean id=\"velocityEngine\" class=\"org.apache.syncope.core.util.VelocityEngineFactoryBean\">\n+    <property name=\"resourceLoader\" ref=\"velocityResourceLoader\"/>\n+  </bean>\n+  <bean id=\"velocityToolManager\" class=\"org.apache.velocity.tools.ToolManager\">\n+    <!-- autoConfigure -->\n+    <constructor-arg index=\"0\" value=\"true\"/>\n+    <!-- include default velocity tools -->\n+    <constructor-arg index=\"1\" value=\"true\"/>\n+  </bean>\n+\n   <task:annotation-driven executor=\"connectorExecutor\"/>\n   <task:executor id=\"connectorExecutor\" pool-size=\"10\"/>\n   "},{"sha":"007b09bbc7fe300c3ba4aa659d1678c3be02c96c","filename":"core/src/main/resources/mailTemplates/optin.html.vm","status":"modified","additions":0,"deletions":1,"changes":1,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/a02cf80afb42052020b63cae06fe4fbe19c1773f/core%2Fsrc%2Fmain%2Fresources%2FmailTemplates%2Foptin.html.vm","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/a02cf80afb42052020b63cae06fe4fbe19c1773f/core%2Fsrc%2Fmain%2Fresources%2FmailTemplates%2Foptin.html.vm","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fsrc%2Fmain%2Fresources%2FmailTemplates%2Foptin.html.vm?ref=a02cf80afb42052020b63cae06fe4fbe19c1773f","patch":"@@ -15,7 +15,6 @@ software distributed under the License is distributed on an\n KIND, either express or implied.  See the License for the\n specific language governing permissions and limitations\n under the License.\n-\n -->\n <html>\n <body>"},{"sha":"b79b31765d863d6c1a2eb7deb6cd338b3d90c784","filename":"core/src/main/resources/mailTemplates/optin.txt.vm","status":"modified","additions":14,"deletions":9,"changes":23,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/a02cf80afb42052020b63cae06fe4fbe19c1773f/core%2Fsrc%2Fmain%2Fresources%2FmailTemplates%2Foptin.txt.vm","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/a02cf80afb42052020b63cae06fe4fbe19c1773f/core%2Fsrc%2Fmain%2Fresources%2FmailTemplates%2Foptin.txt.vm","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fsrc%2Fmain%2Fresources%2FmailTemplates%2Foptin.txt.vm?ref=a02cf80afb42052020b63cae06fe4fbe19c1773f","patch":"@@ -1,14 +1,19 @@\n-# Licensed under the Apache License, Version 2.0 (the \"License\");\n-# you may not use this file except in compliance with the License.\n-# You may obtain a copy of the License at\n+# Licensed to the Apache Software Foundation (ASF) under one\n+# or more contributor license agreements.  See the NOTICE file\n+# distributed with this work for additional information\n+# regarding copyright ownership.  The ASF licenses this file\n+# to you under the Apache License, Version 2.0 (the\n+# \"License\"); you may not use this file except in compliance\n+# with the License.  You may obtain a copy of the License at\n #\n-#       http://www.apache.org/licenses/LICENSE-2.0\n+#   http://www.apache.org/licenses/LICENSE-2.0\n #\n-# Unless required by applicable law or agreed to in writing, software\n-# distributed under the License is distributed on an \"AS IS\" BASIS,\n-# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n-# See the License for the specific language governing permissions and\n-# limitations under the License.\n+# Unless required by applicable law or agreed to in writing,\n+# software distributed under the License is distributed on an\n+# \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+# KIND, either express or implied.  See the License for the\n+# specific language governing permissions and limitations\n+# under the License.\n Hi $user.getAttrMap().get(\"firstname\").getValues().get(0) $user.getAttrMap().get(\"surname\").getValues().get(0), welcome to Syncope!\n \n Your username is $user.getUsername()."},{"sha":"e5367e51415809d8985076fb5e7e6f124ec9f431","filename":"core/src/main/resources/workflowContext.xml","status":"modified","additions":1,"deletions":16,"changes":17,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/a02cf80afb42052020b63cae06fe4fbe19c1773f/core%2Fsrc%2Fmain%2Fresources%2FworkflowContext.xml","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/a02cf80afb42052020b63cae06fe4fbe19c1773f/core%2Fsrc%2Fmain%2Fresources%2FworkflowContext.xml","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fsrc%2Fmain%2Fresources%2FworkflowContext.xml?ref=a02cf80afb42052020b63cae06fe4fbe19c1773f","patch":"@@ -78,20 +78,5 @@ under the License.\n   <bean id=\"formService\" factory-bean=\"processEngine\" factory-method=\"getFormService\"/>\n \n   <context:component-scan base-package=\"org.apache.syncope.core.workflow.user.activiti\"/>\n-  \n-  <bean id=\"velocityEngine\" class=\"org.springframework.ui.velocity.VelocityEngineFactoryBean\">\n-    <property name=\"velocityProperties\">\n-      <value>\n-        resource.loader=class\n-        class.resource.loader.class=org.apache.velocity.runtime.resource.loader.ClasspathResourceLoader\n-      </value>\n-    </property>\n-  </bean>\n-  \n-  <bean id=\"velocityToolManager\" class=\"org.apache.velocity.tools.ToolManager\">\n-    <!-- autoConfigure -->\n-    <constructor-arg index=\"0\" value=\"true\"/>\n-    <!-- include default velocity tools -->\n-    <constructor-arg index=\"1\" value=\"true\"/>\n-  </bean>\n+    \n </beans>"},{"sha":"4ca3e17398f4fcf8fd6c21efa5a0d030bc570786","filename":"core/src/test/resources/noopworkflow/workflowContext.xml","status":"modified","additions":0,"deletions":15,"changes":15,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/a02cf80afb42052020b63cae06fe4fbe19c1773f/core%2Fsrc%2Ftest%2Fresources%2Fnoopworkflow%2FworkflowContext.xml","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/a02cf80afb42052020b63cae06fe4fbe19c1773f/core%2Fsrc%2Ftest%2Fresources%2Fnoopworkflow%2FworkflowContext.xml","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fsrc%2Ftest%2Fresources%2Fnoopworkflow%2FworkflowContext.xml?ref=a02cf80afb42052020b63cae06fe4fbe19c1773f","patch":"@@ -29,19 +29,4 @@ under the License.\n   <bean id=\"uwfAdapter\" class=\"${uwfAdapter}\"/>\n   <bean id=\"rwfAdapter\" class=\"${rwfAdapter}\"/>\n \n-  <bean id=\"velocityEngine\" class=\"org.springframework.ui.velocity.VelocityEngineFactoryBean\">\n-    <property name=\"velocityProperties\">\n-      <value>\n-        resource.loader=class\n-        class.resource.loader.class=org.apache.velocity.runtime.resource.loader.ClasspathResourceLoader\n-      </value>\n-    </property>\n-  </bean>\n-  \n-  <bean id=\"velocityToolManager\" class=\"org.apache.velocity.tools.ToolManager\">\n-    <!-- autoConfigure -->\n-    <constructor-arg index=\"0\" value=\"true\"/>\n-    <!-- include default velocity tools -->\n-    <constructor-arg index=\"1\" value=\"true\"/>\n-  </bean>\n </beans>"},{"sha":"f7bb8b215d0282c32d6946fa2ad1d37a46f5878c","filename":"deb/core/pom.xml","status":"modified","additions":1,"deletions":0,"changes":1,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/a02cf80afb42052020b63cae06fe4fbe19c1773f/deb%2Fcore%2Fpom.xml","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/a02cf80afb42052020b63cae06fe4fbe19c1773f/deb%2Fcore%2Fpom.xml","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/deb%2Fcore%2Fpom.xml?ref=a02cf80afb42052020b63cae06fe4fbe19c1773f","patch":"@@ -57,6 +57,7 @@ under the License.\n         <includes>\n           <include>*.properties</include>\n           <include>*.xml</include>\n+          <include>mailTemplates/*.vm</include>\n         </includes>\n         <excludes>\n           <exclude>*Context*.xml</exclude>"}]}