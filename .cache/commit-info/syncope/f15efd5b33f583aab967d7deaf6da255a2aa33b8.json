{"sha":"f15efd5b33f583aab967d7deaf6da255a2aa33b8","node_id":"MDY6Q29tbWl0NjM2ODc5MDYyOmYxNWVmZDViMzNmNTgzYWFiOTY3ZDdkZWFmNmRhMjU1YTJhYTMzYjg=","commit":{"author":{"name":"Colm O hEigeartaigh","email":"coheigea@apache.org","date":"2017-08-30T12:08:50Z"},"committer":{"name":"Colm O hEigeartaigh","email":"coheigea@apache.org","date":"2017-08-30T12:08:50Z"},"message":"SYNCOPE-1198 - Make the signature algorithm configurable for SAML SSO","tree":{"sha":"63af35d6cde8bc8208c58a44de86ca87ace642a2","url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/git/trees/63af35d6cde8bc8208c58a44de86ca87ace642a2"},"url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/git/commits/f15efd5b33f583aab967d7deaf6da255a2aa33b8","comment_count":0,"verification":{"verified":false,"reason":"unsigned","signature":null,"payload":null}},"url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/f15efd5b33f583aab967d7deaf6da255a2aa33b8","html_url":"https://github.com/EnricoDAlessandro97UNI/syncope/commit/f15efd5b33f583aab967d7deaf6da255a2aa33b8","comments_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/f15efd5b33f583aab967d7deaf6da255a2aa33b8/comments","author":{"login":"coheigea","id":472162,"node_id":"MDQ6VXNlcjQ3MjE2Mg==","avatar_url":"https://avatars.githubusercontent.com/u/472162?v=4","gravatar_id":"","url":"https://api.github.com/users/coheigea","html_url":"https://github.com/coheigea","followers_url":"https://api.github.com/users/coheigea/followers","following_url":"https://api.github.com/users/coheigea/following{/other_user}","gists_url":"https://api.github.com/users/coheigea/gists{/gist_id}","starred_url":"https://api.github.com/users/coheigea/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/coheigea/subscriptions","organizations_url":"https://api.github.com/users/coheigea/orgs","repos_url":"https://api.github.com/users/coheigea/repos","events_url":"https://api.github.com/users/coheigea/events{/privacy}","received_events_url":"https://api.github.com/users/coheigea/received_events","type":"User","site_admin":false},"committer":{"login":"coheigea","id":472162,"node_id":"MDQ6VXNlcjQ3MjE2Mg==","avatar_url":"https://avatars.githubusercontent.com/u/472162?v=4","gravatar_id":"","url":"https://api.github.com/users/coheigea","html_url":"https://github.com/coheigea","followers_url":"https://api.github.com/users/coheigea/followers","following_url":"https://api.github.com/users/coheigea/following{/other_user}","gists_url":"https://api.github.com/users/coheigea/gists{/gist_id}","starred_url":"https://api.github.com/users/coheigea/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/coheigea/subscriptions","organizations_url":"https://api.github.com/users/coheigea/orgs","repos_url":"https://api.github.com/users/coheigea/repos","events_url":"https://api.github.com/users/coheigea/events{/privacy}","received_events_url":"https://api.github.com/users/coheigea/received_events","type":"User","site_admin":false},"parents":[{"sha":"43d3792fc8ce93565700579d94c83c05aeaebf8a","url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/43d3792fc8ce93565700579d94c83c05aeaebf8a","html_url":"https://github.com/EnricoDAlessandro97UNI/syncope/commit/43d3792fc8ce93565700579d94c83c05aeaebf8a"}],"stats":{"total":100,"additions":93,"deletions":7},"files":[{"sha":"315d239011da05989baea7169000c208d233f121","filename":"ext/saml2sp/common-lib/src/main/java/org/apache/syncope/common/lib/types/SignatureAlgorithm.java","status":"added","additions":59,"deletions":0,"changes":59,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/f15efd5b33f583aab967d7deaf6da255a2aa33b8/ext%2Fsaml2sp%2Fcommon-lib%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcommon%2Flib%2Ftypes%2FSignatureAlgorithm.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/f15efd5b33f583aab967d7deaf6da255a2aa33b8/ext%2Fsaml2sp%2Fcommon-lib%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcommon%2Flib%2Ftypes%2FSignatureAlgorithm.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/ext%2Fsaml2sp%2Fcommon-lib%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcommon%2Flib%2Ftypes%2FSignatureAlgorithm.java?ref=f15efd5b33f583aab967d7deaf6da255a2aa33b8","patch":"@@ -0,0 +1,59 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *   http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+package org.apache.syncope.common.lib.types;\n+\n+public enum SignatureAlgorithm {\n+\n+    RSA_SHA1(\"http://www.w3.org/2000/09/xmldsig#rsa-sha1\"),\n+    RSA_SHA224(\"http://www.w3.org/2001/04/xmldsig-more#rsa-sha224\"),\n+    RSA_SHA256(\"http://www.w3.org/2001/04/xmldsig-more#rsa-sha256\"),\n+    RSA_SHA384(\"http://www.w3.org/2001/04/xmldsig-more#rsa-sha384\"),\n+    RSA_SHA512(\"http://www.w3.org/2001/04/xmldsig-more#rsa-sha512\"),\n+\n+    RSA_SHA1_MGF1(\"http://www.w3.org/2007/05/xmldsig-more#sha1-rsa-MGF1\"),\n+    RSA_SHA224_MGF1(\"http://www.w3.org/2007/05/xmldsig-more#sha224-rsa-MGF1\"),\n+    RSA_SHA256_MGF1(\"http://www.w3.org/2007/05/xmldsig-more#sha256-rsa-MGF1\"),\n+    RSA_SHA384_MGF1(\"http://www.w3.org/2007/05/xmldsig-more#sha384-rsa-MGF1\"),\n+    RSA_SHA512_MGF1(\"http://www.w3.org/2007/05/xmldsig-more#sha512-rsa-MGF1\"),\n+\n+    EC_SHA1(\"http://www.w3.org/2001/04/xmldsig-more#ecdsa-sha1\"),\n+    EC_SHA224(\"http://www.w3.org/2001/04/xmldsig-more#ecdsa-sha224\"),\n+    EC_SHA256(\"http://www.w3.org/2001/04/xmldsig-more#ecdsa-sha256\"),\n+    EC_SHA384(\"http://www.w3.org/2001/04/xmldsig-more#ecdsa-sha384\"),\n+    EC_SHA512(\"http://www.w3.org/2001/04/xmldsig-more#ecdsa-sha512\"),\n+\n+    HMAC_SHA1(\"http://www.w3.org/2000/09/xmldsig#hmac-sha1\"),\n+    HMAC_SHA224(\"http://www.w3.org/2001/04/xmldsig-more#hmac-sha224\"),\n+    HMAC_SHA256(\"http://www.w3.org/2001/04/xmldsig-more#hmac-sha256\"),\n+    HMAC_SHA384(\"http://www.w3.org/2001/04/xmldsig-more#hmac-sha384\"),\n+    HMAC_SHA512(\"http://www.w3.org/2001/04/xmldsig-more#hmac-sha512\"),\n+\n+    DSA_SHA1(\"http://www.w3.org/2000/09/xmldsig#dsa-sha1\");\n+\n+    private final String algorithm;\n+\n+    SignatureAlgorithm(final String algorithm) {\n+        this.algorithm = algorithm;\n+    }\n+\n+    public String getAlgorithm() {\n+        return algorithm;\n+    }\n+\n+}"},{"sha":"308b95e004fed77aeb09bd1cb31ed29fdda21ee4","filename":"ext/saml2sp/logic/src/main/java/org/apache/syncope/core/logic/init/SAML2SPLoader.java","status":"modified","additions":7,"deletions":0,"changes":7,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/f15efd5b33f583aab967d7deaf6da255a2aa33b8/ext%2Fsaml2sp%2Flogic%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Flogic%2Finit%2FSAML2SPLoader.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/f15efd5b33f583aab967d7deaf6da255a2aa33b8/ext%2Fsaml2sp%2Flogic%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Flogic%2Finit%2FSAML2SPLoader.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/ext%2Fsaml2sp%2Flogic%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Flogic%2Finit%2FSAML2SPLoader.java?ref=f15efd5b33f583aab967d7deaf6da255a2aa33b8","patch":"@@ -71,6 +71,8 @@ private static <T> T assertNotNull(final T argument, final String name) {\n \n     private Credential credential;\n \n+    private String signatureAlgorithm;\n+\n     @Override\n     public Integer getPriority() {\n         return 1000;\n@@ -96,6 +98,7 @@ public void load() {\n         assertNotNull(keyPass, \"<keystore.keypass>\");\n         String certAlias = props.getProperty(\"sp.cert.alias\");\n         assertNotNull(certAlias, \"<sp.cert.alias>\");\n+        signatureAlgorithm = props.getProperty(\"signature.algorithm\");\n \n         LOG.debug(\"Attempting to load the provided keystore...\");\n         try {\n@@ -142,4 +145,8 @@ public Credential getCredential() {\n         return credential;\n     }\n \n+    public String getSignatureAlgorithm() {\n+        return signatureAlgorithm;\n+    }\n+\n }"},{"sha":"090009cd555c3c729d18a53444d2cac1be70add1","filename":"ext/saml2sp/logic/src/main/java/org/apache/syncope/core/logic/saml2/SAML2ReaderWriter.java","status":"modified","additions":25,"deletions":7,"changes":32,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/f15efd5b33f583aab967d7deaf6da255a2aa33b8/ext%2Fsaml2sp%2Flogic%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Flogic%2Fsaml2%2FSAML2ReaderWriter.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/f15efd5b33f583aab967d7deaf6da255a2aa33b8/ext%2Fsaml2sp%2Flogic%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Flogic%2Fsaml2%2FSAML2ReaderWriter.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/ext%2Fsaml2sp%2Flogic%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Flogic%2Fsaml2%2FSAML2ReaderWriter.java?ref=f15efd5b33f583aab967d7deaf6da255a2aa33b8","patch":"@@ -48,6 +48,7 @@\n import org.apache.cxf.staxutils.StaxUtils;\n import org.apache.syncope.common.lib.SSOConstants;\n import org.apache.syncope.common.lib.types.SAML2BindingType;\n+import org.apache.syncope.common.lib.types.SignatureAlgorithm;\n import org.apache.syncope.core.logic.init.SAML2SPLoader;\n import org.apache.wss4j.common.crypto.Merlin;\n import org.apache.wss4j.common.ext.WSSecurityException;\n@@ -99,14 +100,31 @@ public void init() {\n         keyInfoGeneratorFactory.setEmitEntityCertificate(true);\n         keyInfoGenerator = keyInfoGeneratorFactory.newInstance();\n \n-        sigAlgo = SignatureConstants.ALGO_ID_SIGNATURE_RSA_SHA1;\n-        String pubKeyAlgo = loader.getCredential().getPublicKey().getAlgorithm();\n-        if (pubKeyAlgo.equalsIgnoreCase(\"DSA\")) {\n-            sigAlgo = SignatureConstants.ALGO_ID_SIGNATURE_DSA_SHA1;\n-        } else if (pubKeyAlgo.equalsIgnoreCase(\"EC\")) {\n-            sigAlgo = SignatureConstants.ALGO_ID_SIGNATURE_ECDSA_SHA1;\n+        // Try to load a signature algorithm\n+        if (loader.getSignatureAlgorithm() != null) {\n+            SignatureAlgorithm loadedSignatureAlgorithm =\n+                SignatureAlgorithm.valueOf(loader.getSignatureAlgorithm());\n+            if (loadedSignatureAlgorithm != null) {\n+                sigAlgo = loadedSignatureAlgorithm.getAlgorithm();\n+                jceSigAlgo = JCEMapper.translateURItoJCEID(sigAlgo);\n+            }\n+            if (jceSigAlgo == null) {\n+                LOG.warn(\"Signature algorithm {} is not valid. Using default algorithm instead.\",\n+                         loader.getSignatureAlgorithm());\n+                sigAlgo = null;\n+            }\n+        }\n+\n+        if (sigAlgo == null) {\n+            sigAlgo = SignatureConstants.ALGO_ID_SIGNATURE_RSA_SHA1;\n+            String pubKeyAlgo = loader.getCredential().getPublicKey().getAlgorithm();\n+            if (pubKeyAlgo.equalsIgnoreCase(\"DSA\")) {\n+                sigAlgo = SignatureConstants.ALGO_ID_SIGNATURE_DSA_SHA1;\n+            } else if (pubKeyAlgo.equalsIgnoreCase(\"EC\")) {\n+                sigAlgo = SignatureConstants.ALGO_ID_SIGNATURE_ECDSA_SHA1;\n+            }\n+            jceSigAlgo = JCEMapper.translateURItoJCEID(sigAlgo);\n         }\n-        jceSigAlgo = JCEMapper.translateURItoJCEID(sigAlgo);\n \n         callbackHandler = new SAMLSPCallbackHandler(loader.getKeyPass());\n     }"},{"sha":"f64d6b02a4492936439c76ee3fac37a2ab5f2a9c","filename":"ext/saml2sp/logic/src/main/resources/saml2sp-logic.properties","status":"modified","additions":1,"deletions":0,"changes":1,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/f15efd5b33f583aab967d7deaf6da255a2aa33b8/ext%2Fsaml2sp%2Flogic%2Fsrc%2Fmain%2Fresources%2Fsaml2sp-logic.properties","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/f15efd5b33f583aab967d7deaf6da255a2aa33b8/ext%2Fsaml2sp%2Flogic%2Fsrc%2Fmain%2Fresources%2Fsaml2sp-logic.properties","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/ext%2Fsaml2sp%2Flogic%2Fsrc%2Fmain%2Fresources%2Fsaml2sp-logic.properties?ref=f15efd5b33f583aab967d7deaf6da255a2aa33b8","patch":"@@ -21,3 +21,4 @@ keystore.type=jks\n keystore.storepass=changeit\n keystore.keypass=changeit\n sp.cert.alias=sp\n+signature.algorithm=RSA_SHA1"},{"sha":"fc99f627c77202b6ce5c0d70b1e03e720df3e0fc","filename":"fit/core-reference/src/main/resources/all/saml2sp-logic.properties","status":"modified","additions":1,"deletions":0,"changes":1,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/f15efd5b33f583aab967d7deaf6da255a2aa33b8/fit%2Fcore-reference%2Fsrc%2Fmain%2Fresources%2Fall%2Fsaml2sp-logic.properties","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/f15efd5b33f583aab967d7deaf6da255a2aa33b8/fit%2Fcore-reference%2Fsrc%2Fmain%2Fresources%2Fall%2Fsaml2sp-logic.properties","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/fit%2Fcore-reference%2Fsrc%2Fmain%2Fresources%2Fall%2Fsaml2sp-logic.properties?ref=f15efd5b33f583aab967d7deaf6da255a2aa33b8","patch":"@@ -21,3 +21,4 @@ keystore.type=jks\n keystore.storepass=changeit\n keystore.keypass=changeit\n sp.cert.alias=sp\n+signature.algorithm=RSA_SHA1\n\\ No newline at end of file"}]}