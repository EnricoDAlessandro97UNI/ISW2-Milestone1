{"sha":"0910230d04aaf0ba69be675b29d5c1d2cd3390ba","node_id":"MDY6Q29tbWl0NjM2ODc5MDYyOjA5MTAyMzBkMDRhYWYwYmE2OWJlNjc1YjI5ZDVjMWQyY2QzMzkwYmE=","commit":{"author":{"name":"fmartelli","email":"fabio.martelli@gmail.com","date":"2016-08-10T12:59:18Z"},"committer":{"name":"fmartelli","email":"fabio.martelli@gmail.com","date":"2016-08-10T12:59:18Z"},"message":"[SYNCOPE-915] provides reload of topology node panel","tree":{"sha":"5b6c3fb52701eab2fe2a91bd7c7f53fe91a71ef3","url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/git/trees/5b6c3fb52701eab2fe2a91bd7c7f53fe91a71ef3"},"url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/git/commits/0910230d04aaf0ba69be675b29d5c1d2cd3390ba","comment_count":0,"verification":{"verified":false,"reason":"unsigned","signature":null,"payload":null}},"url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/0910230d04aaf0ba69be675b29d5c1d2cd3390ba","html_url":"https://github.com/EnricoDAlessandro97UNI/syncope/commit/0910230d04aaf0ba69be675b29d5c1d2cd3390ba","comments_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/0910230d04aaf0ba69be675b29d5c1d2cd3390ba/comments","author":{"login":"fmartelli","id":1791932,"node_id":"MDQ6VXNlcjE3OTE5MzI=","avatar_url":"https://avatars.githubusercontent.com/u/1791932?v=4","gravatar_id":"","url":"https://api.github.com/users/fmartelli","html_url":"https://github.com/fmartelli","followers_url":"https://api.github.com/users/fmartelli/followers","following_url":"https://api.github.com/users/fmartelli/following{/other_user}","gists_url":"https://api.github.com/users/fmartelli/gists{/gist_id}","starred_url":"https://api.github.com/users/fmartelli/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/fmartelli/subscriptions","organizations_url":"https://api.github.com/users/fmartelli/orgs","repos_url":"https://api.github.com/users/fmartelli/repos","events_url":"https://api.github.com/users/fmartelli/events{/privacy}","received_events_url":"https://api.github.com/users/fmartelli/received_events","type":"User","site_admin":false},"committer":{"login":"fmartelli","id":1791932,"node_id":"MDQ6VXNlcjE3OTE5MzI=","avatar_url":"https://avatars.githubusercontent.com/u/1791932?v=4","gravatar_id":"","url":"https://api.github.com/users/fmartelli","html_url":"https://github.com/fmartelli","followers_url":"https://api.github.com/users/fmartelli/followers","following_url":"https://api.github.com/users/fmartelli/following{/other_user}","gists_url":"https://api.github.com/users/fmartelli/gists{/gist_id}","starred_url":"https://api.github.com/users/fmartelli/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/fmartelli/subscriptions","organizations_url":"https://api.github.com/users/fmartelli/orgs","repos_url":"https://api.github.com/users/fmartelli/repos","events_url":"https://api.github.com/users/fmartelli/events{/privacy}","received_events_url":"https://api.github.com/users/fmartelli/received_events","type":"User","site_admin":false},"parents":[{"sha":"67bfe1ebbc21149dce7965406f2d6e6226e2a508","url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/67bfe1ebbc21149dce7965406f2d6e6226e2a508","html_url":"https://github.com/EnricoDAlessandro97UNI/syncope/commit/67bfe1ebbc21149dce7965406f2d6e6226e2a508"}],"stats":{"total":82,"additions":74,"deletions":8},"files":[{"sha":"95cc03b899b892a0fa4d0e1a391c99654386cc71","filename":"client/console/src/main/java/org/apache/syncope/client/console/topology/TopologyNode.java","status":"modified","additions":3,"deletions":3,"changes":6,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/0910230d04aaf0ba69be675b29d5c1d2cd3390ba/client%2Fconsole%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fclient%2Fconsole%2Ftopology%2FTopologyNode.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/0910230d04aaf0ba69be675b29d5c1d2cd3390ba/client%2Fconsole%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fclient%2Fconsole%2Ftopology%2FTopologyNode.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/client%2Fconsole%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fclient%2Fconsole%2Ftopology%2FTopologyNode.java?ref=0910230d04aaf0ba69be675b29d5c1d2cd3390ba","patch":"@@ -43,7 +43,7 @@ public enum Status {\n \n     private static final long serialVersionUID = -1506421230369224142L;\n \n-    private final Serializable key;\n+    private final String key;\n \n     private final String displayName;\n \n@@ -59,13 +59,13 @@ public enum Status {\n \n     private int y;\n \n-    public TopologyNode(final Serializable key, final String displayName, final Kind kind) {\n+    public TopologyNode(final String key, final String displayName, final Kind kind) {\n         this.key = key;\n         this.displayName = displayName;\n         this.kind = kind;\n     }\n \n-    public Serializable getKey() {\n+    public String getKey() {\n         return key;\n     }\n "},{"sha":"b563ccadee7463b02b2422efe3f815e7c85cd8b7","filename":"client/console/src/main/java/org/apache/syncope/client/console/topology/TopologyNodePanel.java","status":"modified","additions":34,"deletions":1,"changes":35,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/0910230d04aaf0ba69be675b29d5c1d2cd3390ba/client%2Fconsole%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fclient%2Fconsole%2Ftopology%2FTopologyNodePanel.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/0910230d04aaf0ba69be675b29d5c1d2cd3390ba/client%2Fconsole%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fclient%2Fconsole%2Ftopology%2FTopologyNodePanel.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/client%2Fconsole%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fclient%2Fconsole%2Ftopology%2FTopologyNodePanel.java?ref=0910230d04aaf0ba69be675b29d5c1d2cd3390ba","patch":"@@ -19,19 +19,28 @@\n package org.apache.syncope.client.console.topology;\n \n import org.apache.commons.lang3.StringUtils;\n+import org.apache.syncope.client.console.rest.ConnectorRestClient;\n+import org.apache.syncope.client.console.topology.TopologyNode.Kind;\n+import org.apache.syncope.client.console.topology.TopologyTogglePanel.UpdateEvent;\n import org.apache.wicket.AttributeModifier;\n import org.apache.wicket.Component;\n import org.apache.wicket.MarkupContainer;\n+import org.apache.wicket.ajax.AjaxRequestTarget;\n import org.apache.wicket.ajax.IAjaxIndicatorAware;\n import org.apache.wicket.behavior.AttributeAppender;\n import org.apache.wicket.behavior.Behavior;\n+import org.apache.wicket.event.IEvent;\n import org.apache.wicket.markup.html.basic.Label;\n import org.apache.wicket.markup.html.panel.Panel;\n \n public class TopologyNodePanel extends Panel implements IAjaxIndicatorAware {\n \n     private static final long serialVersionUID = -8775095410207013913L;\n \n+    private final Label label;\n+\n+    private final TopologyNode node;\n+\n     protected enum Status {\n         ACTIVE,\n         INACTIVE\n@@ -40,12 +49,15 @@ protected enum Status {\n \n     public TopologyNodePanel(final String id, final TopologyNode node) {\n         super(id);\n+        this.node = node;\n \n         final String resourceName = node.getDisplayName().length() > 14\n                 ? node.getDisplayName().subSequence(0, 10) + \"...\"\n                 : node.getDisplayName();\n \n-        add(new Label(\"label\", resourceName));\n+        label = new Label(\"label\", resourceName);\n+        label.setOutputMarkupId(true);\n+        add(label);\n \n         final String title;\n \n@@ -98,4 +110,25 @@ public final Component setMarkupId(final String markupId) {\n     public String getAjaxIndicatorMarkupId() {\n         return \"veil\";\n     }\n+\n+    @Override\n+    public void onEvent(final IEvent<?> event) {\n+        if (event.getPayload() instanceof UpdateEvent) {\n+            final UpdateEvent updateEvent = UpdateEvent.class.cast(event.getPayload());\n+            final String key = updateEvent.getKey();\n+            final AjaxRequestTarget target = updateEvent.getTarget();\n+\n+            if (node.getKind() == Kind.CONNECTOR && key.equalsIgnoreCase(node.getKey())) {\n+                String displayName = new ConnectorRestClient().read(key).getDisplayName();\n+\n+                final String resourceName = displayName.length() > 14\n+                        ? displayName.subSequence(0, 10) + \"...\"\n+                        : displayName;\n+\n+                label.setDefaultModelObject(resourceName);\n+                target.add(label);\n+            }\n+        }\n+    }\n+\n }"},{"sha":"6e6ca0769878f9d35742ef0ca87cb72e93cc3907","filename":"client/console/src/main/java/org/apache/syncope/client/console/topology/TopologyTogglePanel.java","status":"modified","additions":34,"deletions":1,"changes":35,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/0910230d04aaf0ba69be675b29d5c1d2cd3390ba/client%2Fconsole%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fclient%2Fconsole%2Ftopology%2FTopologyTogglePanel.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/0910230d04aaf0ba69be675b29d5c1d2cd3390ba/client%2Fconsole%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fclient%2Fconsole%2Ftopology%2FTopologyTogglePanel.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/client%2Fconsole%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fclient%2Fconsole%2Ftopology%2FTopologyTogglePanel.java?ref=0910230d04aaf0ba69be675b29d5c1d2cd3390ba","patch":"@@ -48,7 +48,9 @@\n import org.apache.wicket.ajax.AjaxRequestTarget;\n import org.apache.wicket.ajax.markup.html.AjaxLink;\n import org.apache.wicket.authroles.authorization.strategies.role.metadata.MetaDataRoleAuthorizationStrategy;\n+import org.apache.wicket.event.Broadcast;\n import org.apache.wicket.extensions.ajax.markup.html.IndicatingAjaxLink;\n+import org.apache.wicket.extensions.ajax.markup.html.modal.ModalWindow;\n import org.apache.wicket.markup.html.WebMarkupContainer;\n import org.apache.wicket.markup.html.panel.Fragment;\n import org.apache.wicket.model.CompoundPropertyModel;\n@@ -78,7 +80,6 @@ public TopologyTogglePanel(final String id, final PageReference pageRef) {\n \n         modal.size(Modal.Size.Large);\n         setFooterVisibility(false);\n-        setWindowClosedReloadCallback(modal);\n \n         propTaskModal = new BaseModal<>(\"outer\");\n         propTaskModal.size(Modal.Size.Large);\n@@ -112,6 +113,17 @@ protected void onConfigure() {\n     public void toggleWithContent(final AjaxRequestTarget target, final TopologyNode node) {\n         setHeader(target, node.getDisplayName());\n \n+        modal.setWindowClosedCallback(new ModalWindow.WindowClosedCallback() {\n+\n+            private static final long serialVersionUID = 8804221891699487139L;\n+\n+            @Override\n+            public void onClose(final AjaxRequestTarget target) {\n+                modal.show(false);\n+                send(pageRef.getPage(), Broadcast.DEPTH, new UpdateEvent(node.getKey(), target));\n+            }\n+        });\n+\n         switch (node.getKind()) {\n             case SYNCOPE:\n                 container.addOrReplace(getSyncopeFragment(pageRef));\n@@ -443,4 +455,25 @@ public void onClick(final AjaxRequestTarget target) {\n \n         return fragment;\n     }\n+\n+    public final class UpdateEvent {\n+\n+        private final AjaxRequestTarget target;\n+\n+        private final String key;\n+\n+        public UpdateEvent(final String key, final AjaxRequestTarget target) {\n+            this.target = target;\n+            this.key = key;\n+        }\n+\n+        public AjaxRequestTarget getTarget() {\n+            return target;\n+        }\n+\n+        public String getKey() {\n+            return key;\n+        }\n+\n+    }\n }"},{"sha":"a5a764219b23063d99e66d009d80669e415105b7","filename":"client/console/src/main/java/org/apache/syncope/client/console/wizards/resources/AbstractResourceWizardBuilder.java","status":"modified","additions":3,"deletions":3,"changes":6,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/0910230d04aaf0ba69be675b29d5c1d2cd3390ba/client%2Fconsole%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fclient%2Fconsole%2Fwizards%2Fresources%2FAbstractResourceWizardBuilder.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/0910230d04aaf0ba69be675b29d5c1d2cd3390ba/client%2Fconsole%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fclient%2Fconsole%2Fwizards%2Fresources%2FAbstractResourceWizardBuilder.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/client%2Fconsole%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fclient%2Fconsole%2Fwizards%2Fresources%2FAbstractResourceWizardBuilder.java?ref=0910230d04aaf0ba69be675b29d5c1d2cd3390ba","patch":"@@ -42,7 +42,7 @@ public static class CreateEvent extends ModalEvent {\n \n         private static final long serialVersionUID = -4488921035707289039L;\n \n-        private final Serializable key;\n+        private final String key;\n \n         private final String displayName;\n \n@@ -51,7 +51,7 @@ public static class CreateEvent extends ModalEvent {\n         private final TopologyNode.Kind kind;\n \n         public CreateEvent(\n-                final Serializable key,\n+                final String key,\n                 final String displayName,\n                 final TopologyNode.Kind kind,\n                 final Serializable parent,\n@@ -63,7 +63,7 @@ public CreateEvent(\n             this.parent = parent;\n         }\n \n-        public Serializable getKey() {\n+        public String getKey() {\n             return key;\n         }\n "}]}