{"sha":"6ce8f38cd243045048233edf15db9150e945fbdc","node_id":"MDY6Q29tbWl0NjM2ODc5MDYyOjZjZThmMzhjZDI0MzA0NTA0ODIzM2VkZjE1ZGI5MTUwZTk0NWZiZGM=","commit":{"author":{"name":"Unknown","email":"unknown@apache.org","date":"2011-08-24T09:57:38Z"},"committer":{"name":"Unknown","email":"unknown@apache.org","date":"2011-08-24T09:57:38Z"},"message":"(Fixes issue #144)\n\ngit-svn-id: https://svn.apache.org/repos/asf/incubator/syncope/trunk@1247092 13f79535-47bb-0310-9956-ffa450edef68","tree":{"sha":"98f48623bbd0b84436e06b160faa817576ec0a01","url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/git/trees/98f48623bbd0b84436e06b160faa817576ec0a01"},"url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/git/commits/6ce8f38cd243045048233edf15db9150e945fbdc","comment_count":0,"verification":{"verified":false,"reason":"unsigned","signature":null,"payload":null}},"url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/6ce8f38cd243045048233edf15db9150e945fbdc","html_url":"https://github.com/EnricoDAlessandro97UNI/syncope/commit/6ce8f38cd243045048233edf15db9150e945fbdc","comments_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/6ce8f38cd243045048233edf15db9150e945fbdc/comments","author":null,"committer":null,"parents":[{"sha":"0c4de521a8badef34fc38073a0193ed3f92e5f1c","url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/0c4de521a8badef34fc38073a0193ed3f92e5f1c","html_url":"https://github.com/EnricoDAlessandro97UNI/syncope/commit/0c4de521a8badef34fc38073a0193ed3f92e5f1c"}],"stats":{"total":50,"additions":36,"deletions":14},"files":[{"sha":"766e6f75071f7159796c787ee61bdab7461e4e0c","filename":"console/src/main/java/org/syncope/console/pages/ConnectorModalPage.java","status":"modified","additions":36,"deletions":14,"changes":50,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/6ce8f38cd243045048233edf15db9150e945fbdc/console%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fconsole%2Fpages%2FConnectorModalPage.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/6ce8f38cd243045048233edf15db9150e945fbdc/console%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fconsole%2Fpages%2FConnectorModalPage.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/console%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fconsole%2Fpages%2FConnectorModalPage.java?ref=6ce8f38cd243045048233edf15db9150e945fbdc","patch":"@@ -73,14 +73,7 @@ public ConnectorModalPage(final Connectors basePage,\n             final ConnInstanceTO connectorTO,\n             final boolean createFlag) {\n \n-        final IModel<List<ConnBundleTO>> bundles =\n-                new LoadableDetachableModel<List<ConnBundleTO>>() {\n-\n-                    @Override\n-                    protected List<ConnBundleTO> load() {\n-                        return restClient.getAllBundles();\n-                    }\n-                };\n+        super();\n \n         selectedCapabilities = new ArrayList(createFlag\n                 ? EnumSet.noneOf(ConnectorCapability.class)\n@@ -132,9 +125,35 @@ protected List<ConnConfProperty> load() {\n         version.setEnabled(false);\n         version.setOutputMarkupId(true);\n \n+\n+        final IModel<List<ConnBundleTO>> bundles =\n+                new LoadableDetachableModel<List<ConnBundleTO>>() {\n+\n+                    @Override\n+                    protected List<ConnBundleTO> load() {\n+                        return restClient.getAllBundles();\n+                    }\n+                };\n         final DropDownChoice<ConnBundleTO> bundle =\n                 new DropDownChoice<ConnBundleTO>(\"bundle\", bundles,\n-                new ChoiceRenderer<ConnBundleTO>(\"bundleName\", \"bundleName\"));\n+                new ChoiceRenderer<ConnBundleTO>() {\n+\n+                    @Override\n+                    public Object getDisplayValue(final ConnBundleTO object) {\n+                        return object.getBundleName() + \" \"\n+                                + object.getVersion();\n+                    }\n+\n+                    @Override\n+                    public String getIdValue(final ConnBundleTO object,\n+                            final int index) {\n+\n+                        // idValue must include version as well in order to cope\n+                        //with multiple version of the same bundle.\n+                        return object.getBundleName() + \"#\"\n+                                + object.getVersion();\n+                    }\n+                });\n         bundle.setModel(new IModel<ConnBundleTO>() {\n \n             @Override\n@@ -204,11 +223,14 @@ protected void populateItem(final ListItem<ConnConfProperty> item) {\n             protected void onSubmit(final AjaxRequestTarget target,\n                     final Form form) {\n \n-                ConnInstanceTO connector = (ConnInstanceTO) form.getDefaultModelObject();\n+                ConnInstanceTO connector =\n+                        (ConnInstanceTO) form.getDefaultModelObject();\n \n-                // Set the model object configuration's properties to\n-                // connectorPropertiesMap reference\n-                connector.setBundleName(bundle.getModelValue());\n+                // bundle.getModelValue() will call bundle.getChoiceRenderer.\n+                // getIdValue(), so we need to remove version number appended\n+                // above\n+                connector.setBundleName(bundle.getModelValue().substring(\n+                        0, bundle.getModelValue().lastIndexOf('#')));\n \n                 // Set the model object's capabilites to\n                 // capabilitiesPalette's converted Set\n@@ -279,7 +301,7 @@ protected List<ConnectorCapability> load() {\n                 new AjaxFormComponentUpdatingBehavior(\"onchange\") {\n \n                     @Override\n-                    protected void onUpdate(AjaxRequestTarget art) {\n+                    protected void onUpdate(final AjaxRequestTarget art) {\n                         if (resetToken.getModelObject()) {\n                             connectorTO.setSyncToken(null);\n                         }"}]}