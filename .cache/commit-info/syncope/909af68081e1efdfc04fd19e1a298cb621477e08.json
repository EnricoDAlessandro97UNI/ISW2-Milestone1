{"sha":"909af68081e1efdfc04fd19e1a298cb621477e08","node_id":"MDY6Q29tbWl0NjM2ODc5MDYyOjkwOWFmNjgwODFlMWVmZGZjMDRmZDE5ZTFhMjk4Y2I2MjE0NzdlMDg=","commit":{"author":{"name":"lorenzo","email":"lorenzo.dicola@tirasa.net","date":"2018-06-25T08:22:25Z"},"committer":{"name":"Francesco Chicchiricc√≤","email":"ilgrosso@apache.org","date":"2018-06-25T08:39:39Z"},"message":"SYNCOPE-1303: fix content migration from 1.2 to 2.0.9-SNAPSHOT - This closes #78","tree":{"sha":"dd9cb0c5ac0bf9d003da1743d79eef710e259eb4","url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/git/trees/dd9cb0c5ac0bf9d003da1743d79eef710e259eb4"},"url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/git/commits/909af68081e1efdfc04fd19e1a298cb621477e08","comment_count":0,"verification":{"verified":false,"reason":"unsigned","signature":null,"payload":null}},"url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/909af68081e1efdfc04fd19e1a298cb621477e08","html_url":"https://github.com/EnricoDAlessandro97UNI/syncope/commit/909af68081e1efdfc04fd19e1a298cb621477e08","comments_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/909af68081e1efdfc04fd19e1a298cb621477e08/comments","author":{"login":"loredicola","id":12647176,"node_id":"MDQ6VXNlcjEyNjQ3MTc2","avatar_url":"https://avatars.githubusercontent.com/u/12647176?v=4","gravatar_id":"","url":"https://api.github.com/users/loredicola","html_url":"https://github.com/loredicola","followers_url":"https://api.github.com/users/loredicola/followers","following_url":"https://api.github.com/users/loredicola/following{/other_user}","gists_url":"https://api.github.com/users/loredicola/gists{/gist_id}","starred_url":"https://api.github.com/users/loredicola/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/loredicola/subscriptions","organizations_url":"https://api.github.com/users/loredicola/orgs","repos_url":"https://api.github.com/users/loredicola/repos","events_url":"https://api.github.com/users/loredicola/events{/privacy}","received_events_url":"https://api.github.com/users/loredicola/received_events","type":"User","site_admin":false},"committer":{"login":"ilgrosso","id":1064664,"node_id":"MDQ6VXNlcjEwNjQ2NjQ=","avatar_url":"https://avatars.githubusercontent.com/u/1064664?v=4","gravatar_id":"","url":"https://api.github.com/users/ilgrosso","html_url":"https://github.com/ilgrosso","followers_url":"https://api.github.com/users/ilgrosso/followers","following_url":"https://api.github.com/users/ilgrosso/following{/other_user}","gists_url":"https://api.github.com/users/ilgrosso/gists{/gist_id}","starred_url":"https://api.github.com/users/ilgrosso/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ilgrosso/subscriptions","organizations_url":"https://api.github.com/users/ilgrosso/orgs","repos_url":"https://api.github.com/users/ilgrosso/repos","events_url":"https://api.github.com/users/ilgrosso/events{/privacy}","received_events_url":"https://api.github.com/users/ilgrosso/received_events","type":"User","site_admin":false},"parents":[{"sha":"d7d06bc088adebaae3fd7608a8c0ea3639916910","url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/d7d06bc088adebaae3fd7608a8c0ea3639916910","html_url":"https://github.com/EnricoDAlessandro97UNI/syncope/commit/d7d06bc088adebaae3fd7608a8c0ea3639916910"}],"stats":{"total":29,"additions":27,"deletions":2},"files":[{"sha":"8b4884d138f1ce1365cd3ab046f9e3b75b930abe","filename":"client/cli/src/main/java/org/apache/syncope/client/cli/commands/migrate/MigrateConf.java","status":"modified","additions":27,"deletions":2,"changes":29,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/909af68081e1efdfc04fd19e1a298cb621477e08/client%2Fcli%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fclient%2Fcli%2Fcommands%2Fmigrate%2FMigrateConf.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/909af68081e1efdfc04fd19e1a298cb621477e08/client%2Fcli%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fclient%2Fcli%2Fcommands%2Fmigrate%2FMigrateConf.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/client%2Fcli%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fclient%2Fcli%2Fcommands%2Fmigrate%2FMigrateConf.java?ref=909af68081e1efdfc04fd19e1a298cb621477e08","patch":"@@ -344,6 +344,15 @@ private static void exec(final String src, final String dst)\n                                 writer.writeAttribute(\"id\", lastUUID);\n                                 writer.writeAttribute(\n                                         \"description\", getAttributeValue(reader, \"description\"));\n+                                String specificationAttr = getAttributeValue(reader, \"specification\");\n+                                if (StringUtils.isNotBlank(specificationAttr)) {\n+                                    ObjectNode templateRead = (ObjectNode) OBJECT_MAPPER.readTree(specificationAttr);\n+                                    JsonNode conflictResolutionAction = templateRead.get(\"conflictResolutionAction\");\n+                                    ObjectNode templateWrite = OBJECT_MAPPER.createObjectNode();\n+                                    templateWrite.set(\"conflictResolutionAction\", conflictResolutionAction);\n+                                    writer.writeAttribute(\n+                                            \"specification\", OBJECT_MAPPER.writeValueAsString(templateWrite));\n+                                }\n                                 writer.writeEndElement();\n                                 break;\n \n@@ -668,8 +677,16 @@ private static void exec(final String src, final String dst)\n                                 String userTemplate = getAttributeValue(reader, \"userTemplate\");\n                                 if (StringUtils.isNotBlank(userTemplate)) {\n                                     ObjectNode template = (ObjectNode) OBJECT_MAPPER.readTree(userTemplate);\n-                                    JsonNode plainAttrs = template.remove(\"attrs\");\n+                                    JsonNode plainAttrs = template.remove(\"attributes\");\n                                     template.set(\"plainAttrs\", plainAttrs);\n+                                    template.remove(\"id\");\n+                                    template.set(\"key\", null);\n+                                    template.remove(\"readonly\");\n+                                    JsonNode derAttrs = template.remove(\"derivedAttributes\");\n+                                    template.set(\"derAttrs\", derAttrs);\n+                                    JsonNode virAttrs = template.remove(\"virtualAttributes\");\n+                                    template.set(\"virAttrs\", virAttrs);\n+                                    template.remove(\"propagationStatuses\");\n \n                                     writer.writeStartElement(\"AnyTemplatePullTask\");\n                                     writer.writeAttribute(\"id\", UUID.randomUUID().toString());\n@@ -681,8 +698,16 @@ private static void exec(final String src, final String dst)\n                                 String roleTemplate = getAttributeValue(reader, \"roleTemplate\");\n                                 if (StringUtils.isNotBlank(roleTemplate)) {\n                                     ObjectNode template = (ObjectNode) OBJECT_MAPPER.readTree(roleTemplate);\n-                                    JsonNode plainAttrs = template.remove(\"attrs\");\n+                                    JsonNode plainAttrs = template.remove(\"attributes\");\n                                     template.set(\"plainAttrs\", plainAttrs);\n+                                    template.remove(\"id\");\n+                                    template.set(\"key\", null);\n+                                    template.remove(\"readonly\");\n+                                    JsonNode derAttrs = template.remove(\"derivedAttributes\");\n+                                    template.set(\"derAttrs\", derAttrs);\n+                                    JsonNode virAttrs = template.remove(\"virtualAttributes\");\n+                                    template.set(\"virAttrs\", virAttrs);\n+                                    template.remove(\"propagationStatuses\");\n \n                                     writer.writeStartElement(\"AnyTemplatePullTask\");\n                                     writer.writeAttribute(\"id\", UUID.randomUUID().toString());"}]}