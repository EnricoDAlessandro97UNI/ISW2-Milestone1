{"sha":"022d2c5f7470c757efbe8fbb4b875f3edcbc953c","node_id":"MDY6Q29tbWl0NjM2ODc5MDYyOjAyMmQyYzVmNzQ3MGM3NTdlZmJlOGZiYjRiODc1ZjNlZGNiYzk1M2M=","commit":{"author":{"name":"Matteo Di Carlo","email":"matteo.dicarlo@tirasa.net","date":"2017-01-10T09:10:58Z"},"committer":{"name":"Matteo Di Carlo","email":"matteo.dicarlo@tirasa.net","date":"2017-01-12T11:08:57Z"},"message":"[SYNCOPE-773] resize job modals and add compose modal for reports","tree":{"sha":"2dc8b422cd9942789ffb9744e2d5d2f8efca011b","url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/git/trees/2dc8b422cd9942789ffb9744e2d5d2f8efca011b"},"url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/git/commits/022d2c5f7470c757efbe8fbb4b875f3edcbc953c","comment_count":0,"verification":{"verified":false,"reason":"unsigned","signature":null,"payload":null}},"url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/022d2c5f7470c757efbe8fbb4b875f3edcbc953c","html_url":"https://github.com/EnricoDAlessandro97UNI/syncope/commit/022d2c5f7470c757efbe8fbb4b875f3edcbc953c","comments_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/022d2c5f7470c757efbe8fbb4b875f3edcbc953c/comments","author":null,"committer":null,"parents":[{"sha":"3117b89d77cf51337c24fd22bbb24c669d750110","url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/3117b89d77cf51337c24fd22bbb24c669d750110","html_url":"https://github.com/EnricoDAlessandro97UNI/syncope/commit/3117b89d77cf51337c24fd22bbb24c669d750110"}],"stats":{"total":99,"additions":95,"deletions":4},"files":[{"sha":"7968fe5cdd06edd9c4e307126f295f92e513f195","filename":"client/console/src/main/java/org/apache/syncope/client/console/reports/ReportletDirectoryPanel.java","status":"modified","additions":1,"deletions":1,"changes":2,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/022d2c5f7470c757efbe8fbb4b875f3edcbc953c/client%2Fconsole%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fclient%2Fconsole%2Freports%2FReportletDirectoryPanel.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/022d2c5f7470c757efbe8fbb4b875f3edcbc953c/client%2Fconsole%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fclient%2Fconsole%2Freports%2FReportletDirectoryPanel.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/client%2Fconsole%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fclient%2Fconsole%2Freports%2FReportletDirectoryPanel.java?ref=022d2c5f7470c757efbe8fbb4b875f3edcbc953c","patch":"@@ -84,7 +84,7 @@ public class ReportletDirectoryPanel extends DirectoryPanel<\n \n     private final String report;\n \n-    protected ReportletDirectoryPanel(\n+    public ReportletDirectoryPanel(\n             final BaseModal<ReportTO> baseModal, final String report, final PageReference pageRef) {\n         super(BaseModal.CONTENT_ID, pageRef, false);\n "},{"sha":"400e0c79383fb3ac66094e2edc3a79db2d5cd708","filename":"client/console/src/main/java/org/apache/syncope/client/console/widgets/JobActionPanel.java","status":"modified","additions":60,"deletions":2,"changes":62,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/022d2c5f7470c757efbe8fbb4b875f3edcbc953c/client%2Fconsole%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fclient%2Fconsole%2Fwidgets%2FJobActionPanel.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/022d2c5f7470c757efbe8fbb4b875f3edcbc953c/client%2Fconsole%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fclient%2Fconsole%2Fwidgets%2FJobActionPanel.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/client%2Fconsole%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fclient%2Fconsole%2Fwidgets%2FJobActionPanel.java?ref=022d2c5f7470c757efbe8fbb4b875f3edcbc953c","patch":"@@ -18,12 +18,14 @@\n  */\n package org.apache.syncope.client.console.widgets;\n \n+import de.agilecoders.wicket.core.markup.html.bootstrap.dialog.Modal;\n import java.io.Serializable;\n import org.apache.commons.lang3.StringUtils;\n import org.apache.syncope.client.console.SyncopeConsoleSession;\n import org.apache.syncope.client.console.commons.Constants;\n import org.apache.syncope.client.console.pages.BasePage;\n import org.apache.syncope.client.console.reports.ReportWizardBuilder;\n+import org.apache.syncope.client.console.reports.ReportletDirectoryPanel;\n import org.apache.syncope.client.console.rest.ReportRestClient;\n import org.apache.syncope.client.console.rest.TaskRestClient;\n import org.apache.syncope.client.console.tasks.SchedTaskWizardBuilder;\n@@ -36,11 +38,13 @@\n import org.apache.syncope.common.lib.to.SchedTaskTO;\n import org.apache.syncope.common.lib.types.JobAction;\n import org.apache.syncope.common.lib.types.JobType;\n+import org.apache.syncope.common.lib.types.StandardEntitlement;\n import org.apache.syncope.common.rest.api.service.NotificationService;\n import org.apache.syncope.common.rest.api.service.ReportService;\n import org.apache.syncope.common.rest.api.service.TaskService;\n import org.apache.wicket.PageReference;\n import org.apache.wicket.ajax.AjaxRequestTarget;\n+import org.apache.wicket.authroles.authorization.strategies.role.metadata.MetaDataRoleAuthorizationStrategy;\n import org.apache.wicket.event.Broadcast;\n import org.apache.wicket.event.IEvent;\n import org.apache.wicket.markup.html.panel.Fragment;\n@@ -57,17 +61,23 @@ public class JobActionPanel extends WizardMgtPanel<Serializable> {\n \n     private final BaseModal<Serializable> jobModal;\n \n+    private final BaseModal<ReportTO> reportModal;\n+\n     public JobActionPanel(\n             final String id,\n             final JobTO jobTO,\n             final JobWidget widget,\n             final BaseModal<Serializable> jobModal,\n+            final BaseModal<ReportTO> reportModal,\n             final PageReference pageRef) {\n-\n         super(id, true);\n         this.jobModal = jobModal;\n+        this.reportModal = reportModal;\n         setOutputMarkupId(true);\n-        setWindowClosedReloadCallback(modal);\n+        setWindowClosedReloadCallback(jobModal);\n+        jobModal.size(Modal.Size.Large);\n+        setWindowClosedReloadCallback(reportModal);\n+        this.reportModal.size(Modal.Size.Large);\n \n         IndicatorAjaxLink<Void> link = new IndicatorAjaxLink<Void>(\"edit\") {\n \n@@ -121,6 +131,54 @@ public void onClick(final AjaxRequestTarget target) {\n         link.setVisible(!(null != jobTO.getType() && JobType.NOTIFICATION.equals(jobTO.getType())));\n         addInnerObject(link);\n \n+        IndicatorAjaxLink<Void> composeLink;\n+        composeLink =\n+                new IndicatorAjaxLink<Void>(\"compose\") {\n+\n+            private static final long serialVersionUID = -7978723352517770644L;\n+\n+            @Override\n+            public void onClick(final AjaxRequestTarget target) {\n+\n+                if (null != jobTO.getType()) {\n+                    switch (jobTO.getType()) {\n+\n+                        case NOTIFICATION:\n+                            break;\n+\n+                        case REPORT:\n+\n+                            final ReportTO reportTO = new ReportRestClient().read(jobTO.getRefKey());\n+\n+                            target.add(JobActionPanel.this.reportModal.setContent(\n+                                    new ReportletDirectoryPanel(reportModal, jobTO.getRefKey(), pageRef)));\n+\n+                            MetaDataRoleAuthorizationStrategy.authorize(\n+                                    reportModal.getForm(),\n+                                    ENABLE, StandardEntitlement.REPORT_UPDATE);\n+\n+                            reportModal.header(new StringResourceModel(\n+                                    \"reportlet.conf\", this, new Model<>(reportTO)\n+                            ));\n+\n+                            reportModal.show(true);\n+\n+                            break;\n+\n+                        case TASK:\n+                            break;\n+\n+                        default:\n+                            break;\n+                    }\n+                }\n+            }\n+        };\n+        composeLink.setOutputMarkupPlaceholderTag(true);\n+        composeLink.setVisible(!(null != jobTO.getType() && (JobType.TASK.equals(jobTO.getType())\n+                || JobType.NOTIFICATION.equals(jobTO.getType()))));\n+        addInnerObject(composeLink);\n+\n         Fragment controls;\n         if (jobTO.isRunning()) {\n             controls = new Fragment(\"controls\", \"runningFragment\", this);"},{"sha":"dcd1b2bc52740ce0cc0b3845b0d92ecdbf056b1e","filename":"client/console/src/main/java/org/apache/syncope/client/console/widgets/JobWidget.java","status":"modified","additions":27,"deletions":1,"changes":28,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/022d2c5f7470c757efbe8fbb4b875f3edcbc953c/client%2Fconsole%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fclient%2Fconsole%2Fwidgets%2FJobWidget.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/022d2c5f7470c757efbe8fbb4b875f3edcbc953c/client%2Fconsole%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fclient%2Fconsole%2Fwidgets%2FJobWidget.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/client%2Fconsole%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fclient%2Fconsole%2Fwidgets%2FJobWidget.java?ref=022d2c5f7470c757efbe8fbb4b875f3edcbc953c","patch":"@@ -18,6 +18,7 @@\n  */\n package org.apache.syncope.client.console.widgets;\n \n+import de.agilecoders.wicket.core.markup.html.bootstrap.dialog.Modal;\n import de.agilecoders.wicket.core.markup.html.bootstrap.tabs.AjaxBootstrapTabbedPanel;\n import java.io.Serializable;\n import java.util.ArrayList;\n@@ -41,6 +42,7 @@\n import org.apache.syncope.client.console.wizards.WizardMgtPanel;\n import org.apache.syncope.common.lib.to.ExecTO;\n import org.apache.syncope.common.lib.to.JobTO;\n+import org.apache.syncope.common.lib.to.ReportTO;\n import org.apache.syncope.common.lib.types.StandardEntitlement;\n import org.apache.syncope.common.rest.api.service.NotificationService;\n import org.apache.syncope.common.rest.api.service.ReportService;\n@@ -106,6 +108,17 @@ protected void onConfigure() {\n         }\n     };\n \n+    private final BaseModal<ReportTO> reportModal = new BaseModal<ReportTO>(\"reportModal\") {\n+\n+        private static final long serialVersionUID = 1L;\n+\n+        @Override\n+        protected void onConfigure() {\n+            super.onConfigure();\n+            setFooterVisible(true);\n+        }\n+    };\n+\n     private static List<JobTO> getAvailable(final SyncopeConsoleSession session) {\n         List<JobTO> available = new ArrayList<>();\n \n@@ -171,6 +184,19 @@ public void onClose(final AjaxRequestTarget target) {\n             }\n         });\n \n+        add(reportModal);\n+        reportModal.setWindowClosedCallback(new ModalWindow.WindowClosedCallback() {\n+\n+            private static final long serialVersionUID = 1L;\n+\n+            @Override\n+            public void onClose(final AjaxRequestTarget target) {\n+                reportModal.show(false);\n+            }\n+        });\n+\n+        reportModal.size(Modal.Size.Large);\n+\n         available = getAvailable(SyncopeConsoleSession.get());\n         recent = getRecent(SyncopeConsoleSession.get());\n \n@@ -296,7 +322,7 @@ public void populateItem(\n \n                     JobTO jobTO = rowModel.getObject();\n                     JobActionPanel panel = new JobActionPanel(componentId, jobTO, JobWidget.this, JobWidget.this.modal,\n-                            pageRef);\n+                            JobWidget.this.reportModal, pageRef);\n                     MetaDataRoleAuthorizationStrategy.authorize(panel, WebPage.ENABLE,\n                             String.format(\"%s,%s%s,%s\",\n                                     StandardEntitlement.TASK_EXECUTE,"},{"sha":"1ca771a164b726cc5ac7ec30ffea358d3cf2c511","filename":"client/console/src/main/resources/org/apache/syncope/client/console/widgets/JobActionPanel.html","status":"modified","additions":1,"deletions":0,"changes":1,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/022d2c5f7470c757efbe8fbb4b875f3edcbc953c/client%2Fconsole%2Fsrc%2Fmain%2Fresources%2Forg%2Fapache%2Fsyncope%2Fclient%2Fconsole%2Fwidgets%2FJobActionPanel.html","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/022d2c5f7470c757efbe8fbb4b875f3edcbc953c/client%2Fconsole%2Fsrc%2Fmain%2Fresources%2Forg%2Fapache%2Fsyncope%2Fclient%2Fconsole%2Fwidgets%2FJobActionPanel.html","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/client%2Fconsole%2Fsrc%2Fmain%2Fresources%2Forg%2Fapache%2Fsyncope%2Fclient%2Fconsole%2Fwidgets%2FJobActionPanel.html?ref=022d2c5f7470c757efbe8fbb4b875f3edcbc953c","patch":"@@ -29,5 +29,6 @@\n     </wicket:fragment>\n     <!--<div wicket:id=\"modal\"/>-->\n     <a href=\"#\" wicket:id=\"edit\" ><i id=\"actionLink\" class=\"glyphicon glyphicon-pencil\" alt=\"edit icon\" title=\"Edit\"></i></a> \n+    <a href=\"#\" wicket:id=\"compose\" ><i id=\"actionLink\" class=\"fa fa-puzzle-piece\" alt=\"compose icon\" title=\"Compose\"></i></a> \n   </wicket:extend>\n </html>"},{"sha":"a062133e82b49f7a465178a75ee72bfb8587a972","filename":"client/console/src/main/resources/org/apache/syncope/client/console/widgets/JobWidget.html","status":"modified","additions":1,"deletions":0,"changes":1,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/022d2c5f7470c757efbe8fbb4b875f3edcbc953c/client%2Fconsole%2Fsrc%2Fmain%2Fresources%2Forg%2Fapache%2Fsyncope%2Fclient%2Fconsole%2Fwidgets%2FJobWidget.html","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/022d2c5f7470c757efbe8fbb4b875f3edcbc953c/client%2Fconsole%2Fsrc%2Fmain%2Fresources%2Forg%2Fapache%2Fsyncope%2Fclient%2Fconsole%2Fwidgets%2FJobWidget.html","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/client%2Fconsole%2Fsrc%2Fmain%2Fresources%2Forg%2Fapache%2Fsyncope%2Fclient%2Fconsole%2Fwidgets%2FJobWidget.html?ref=022d2c5f7470c757efbe8fbb4b875f3edcbc953c","patch":"@@ -31,5 +31,6 @@ <h3 class=\"box-title\"><wicket:message key=\"jobs\"/></h3>\n     </div>\n     <div wicket:id=\"modal\"/>\n     <div wicket:id=\"detailModal\"/>\n+    <div wicket:id=\"reportModal\"/>\n   </wicket:panel>\n </html>\n\\ No newline at end of file"},{"sha":"55aa4418233a4ff2113baa4ff966e0a82791ad39","filename":"client/console/src/main/resources/org/apache/syncope/client/console/widgets/JobWidget.properties","status":"modified","additions":2,"deletions":0,"changes":2,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/022d2c5f7470c757efbe8fbb4b875f3edcbc953c/client%2Fconsole%2Fsrc%2Fmain%2Fresources%2Forg%2Fapache%2Fsyncope%2Fclient%2Fconsole%2Fwidgets%2FJobWidget.properties","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/022d2c5f7470c757efbe8fbb4b875f3edcbc953c/client%2Fconsole%2Fsrc%2Fmain%2Fresources%2Forg%2Fapache%2Fsyncope%2Fclient%2Fconsole%2Fwidgets%2FJobWidget.properties","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/client%2Fconsole%2Fsrc%2Fmain%2Fresources%2Forg%2Fapache%2Fsyncope%2Fclient%2Fconsole%2Fwidgets%2FJobWidget.properties?ref=022d2c5f7470c757efbe8fbb4b875f3edcbc953c","patch":"@@ -24,3 +24,5 @@ available=Available\n recent=Recent\n jobs=Jobs\n execution.view=Result status of execution '${key}'\n+reportlet.conf=Reportlet configuration for ${name}\n+"},{"sha":"f2666e441c6dfb308e808a68f638be32aa3f55bc","filename":"client/console/src/main/resources/org/apache/syncope/client/console/widgets/JobWidget_it.properties","status":"modified","additions":1,"deletions":0,"changes":1,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/022d2c5f7470c757efbe8fbb4b875f3edcbc953c/client%2Fconsole%2Fsrc%2Fmain%2Fresources%2Forg%2Fapache%2Fsyncope%2Fclient%2Fconsole%2Fwidgets%2FJobWidget_it.properties","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/022d2c5f7470c757efbe8fbb4b875f3edcbc953c/client%2Fconsole%2Fsrc%2Fmain%2Fresources%2Forg%2Fapache%2Fsyncope%2Fclient%2Fconsole%2Fwidgets%2FJobWidget_it.properties","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/client%2Fconsole%2Fsrc%2Fmain%2Fresources%2Forg%2Fapache%2Fsyncope%2Fclient%2Fconsole%2Fwidgets%2FJobWidget_it.properties?ref=022d2c5f7470c757efbe8fbb4b875f3edcbc953c","patch":"@@ -24,3 +24,4 @@ available=Disponibili\n recent=Recenti\n jobs=Job\n execution.view=Stato dell'esecuzione'${key}'\n+reportlet.conf=reportlet.conf=Configurazione reportlet per ${name}"},{"sha":"a90fcdddff131e5883843ea34dfad8aed34e2dd9","filename":"client/console/src/main/resources/org/apache/syncope/client/console/widgets/JobWidget_pt_BR.properties","status":"modified","additions":1,"deletions":0,"changes":1,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/022d2c5f7470c757efbe8fbb4b875f3edcbc953c/client%2Fconsole%2Fsrc%2Fmain%2Fresources%2Forg%2Fapache%2Fsyncope%2Fclient%2Fconsole%2Fwidgets%2FJobWidget_pt_BR.properties","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/022d2c5f7470c757efbe8fbb4b875f3edcbc953c/client%2Fconsole%2Fsrc%2Fmain%2Fresources%2Forg%2Fapache%2Fsyncope%2Fclient%2Fconsole%2Fwidgets%2FJobWidget_pt_BR.properties","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/client%2Fconsole%2Fsrc%2Fmain%2Fresources%2Forg%2Fapache%2Fsyncope%2Fclient%2Fconsole%2Fwidgets%2FJobWidget_pt_BR.properties?ref=022d2c5f7470c757efbe8fbb4b875f3edcbc953c","patch":"@@ -24,3 +24,4 @@ available=Dispon\\u00edvel\n recent=Recente\n jobs=Job\n execution.view=Status do resultado da execu\\u00e7\\u00e3o '${key}'\n+reportlet.conf=reportlet.conf=Reportlet configuration for ${name}"},{"sha":"a64afd7eedaef62f7381d77e0ef110cfa1a94494","filename":"client/console/src/main/resources/org/apache/syncope/client/console/widgets/JobWidget_ru.properties","status":"modified","additions":1,"deletions":0,"changes":1,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/022d2c5f7470c757efbe8fbb4b875f3edcbc953c/client%2Fconsole%2Fsrc%2Fmain%2Fresources%2Forg%2Fapache%2Fsyncope%2Fclient%2Fconsole%2Fwidgets%2FJobWidget_ru.properties","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/022d2c5f7470c757efbe8fbb4b875f3edcbc953c/client%2Fconsole%2Fsrc%2Fmain%2Fresources%2Forg%2Fapache%2Fsyncope%2Fclient%2Fconsole%2Fwidgets%2FJobWidget_ru.properties","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/client%2Fconsole%2Fsrc%2Fmain%2Fresources%2Forg%2Fapache%2Fsyncope%2Fclient%2Fconsole%2Fwidgets%2FJobWidget_ru.properties?ref=022d2c5f7470c757efbe8fbb4b875f3edcbc953c","patch":"@@ -34,3 +34,4 @@ recent=\\u041f\\u043e\\u0441\\u043b\\u0435\\u0434\\u043d\\u0438\\u0435 \\u0432\\u044b\\u043f\n # jobs=\\u00d0\\u0097\\u00d0\\u00b0\\u00d0\\u00b4\\u00d0\\u00b0\\u00d1\\u0087\\u00d0\\u00b8\n jobs=\\u0417\\u0430\\u0434\\u0430\\u0447\\u0438\n execution.view=\\u0421\\u0442\\u0430\\u0442\\u0443\\u0441 \\u0420\\u0435\\u0437\\u0443\\u043b\\u044c\\u0442\\u0430\\u0442 \\u0438\\u0441\\u043f\\u043e\\u043b\\u043d\\u0435\\u043d\\u0438\\u044f '${key}'\n+reportlet.conf=reportlet.conf=\\u041d\\u0430\\u0441\\u0442\\u0440\\u043e\\u0439\\u043a\\u0430 \\u043f\\u0430\\u043d\\u0435\\u043b\\u0438 \\u043e\\u0442\\u0447\\u0435\\u0442\\u0430 \\u0434\\u043b\\u044f ${name}"}]}