{"sha":"c2bbd0a860c3add02f4bb100ac68f5e11e5c3395","node_id":"MDY6Q29tbWl0NjM2ODc5MDYyOmMyYmJkMGE4NjBjM2FkZDAyZjRiYjEwMGFjNjhmNWUxMWU1YzMzOTU=","commit":{"author":{"name":"Andrea Patricelli","email":"andrea.patricelli@tirasa.net","date":"2015-10-30T16:14:11Z"},"committer":{"name":"Andrea Patricelli","email":"andrea.patricelli@tirasa.net","date":"2015-10-30T16:14:11Z"},"message":"anyTO update: plain attributes are deleted when values list is empty (if not incremental edit)","tree":{"sha":"aa1a34b1a433fe498cb814cd157949536def4bab","url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/git/trees/aa1a34b1a433fe498cb814cd157949536def4bab"},"url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/git/commits/c2bbd0a860c3add02f4bb100ac68f5e11e5c3395","comment_count":0,"verification":{"verified":false,"reason":"unsigned","signature":null,"payload":null}},"url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/c2bbd0a860c3add02f4bb100ac68f5e11e5c3395","html_url":"https://github.com/EnricoDAlessandro97UNI/syncope/commit/c2bbd0a860c3add02f4bb100ac68f5e11e5c3395","comments_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/c2bbd0a860c3add02f4bb100ac68f5e11e5c3395/comments","author":{"login":"andrea-patricelli","id":3763111,"node_id":"MDQ6VXNlcjM3NjMxMTE=","avatar_url":"https://avatars.githubusercontent.com/u/3763111?v=4","gravatar_id":"","url":"https://api.github.com/users/andrea-patricelli","html_url":"https://github.com/andrea-patricelli","followers_url":"https://api.github.com/users/andrea-patricelli/followers","following_url":"https://api.github.com/users/andrea-patricelli/following{/other_user}","gists_url":"https://api.github.com/users/andrea-patricelli/gists{/gist_id}","starred_url":"https://api.github.com/users/andrea-patricelli/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/andrea-patricelli/subscriptions","organizations_url":"https://api.github.com/users/andrea-patricelli/orgs","repos_url":"https://api.github.com/users/andrea-patricelli/repos","events_url":"https://api.github.com/users/andrea-patricelli/events{/privacy}","received_events_url":"https://api.github.com/users/andrea-patricelli/received_events","type":"User","site_admin":false},"committer":{"login":"andrea-patricelli","id":3763111,"node_id":"MDQ6VXNlcjM3NjMxMTE=","avatar_url":"https://avatars.githubusercontent.com/u/3763111?v=4","gravatar_id":"","url":"https://api.github.com/users/andrea-patricelli","html_url":"https://github.com/andrea-patricelli","followers_url":"https://api.github.com/users/andrea-patricelli/followers","following_url":"https://api.github.com/users/andrea-patricelli/following{/other_user}","gists_url":"https://api.github.com/users/andrea-patricelli/gists{/gist_id}","starred_url":"https://api.github.com/users/andrea-patricelli/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/andrea-patricelli/subscriptions","organizations_url":"https://api.github.com/users/andrea-patricelli/orgs","repos_url":"https://api.github.com/users/andrea-patricelli/repos","events_url":"https://api.github.com/users/andrea-patricelli/events{/privacy}","received_events_url":"https://api.github.com/users/andrea-patricelli/received_events","type":"User","site_admin":false},"parents":[{"sha":"24a9125914f66f31827dffe34351cfca20288eb8","url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/24a9125914f66f31827dffe34351cfca20288eb8","html_url":"https://github.com/EnricoDAlessandro97UNI/syncope/commit/24a9125914f66f31827dffe34351cfca20288eb8"}],"stats":{"total":21,"additions":18,"deletions":3},"files":[{"sha":"d2d6891ca0fbec78ada8f6056be1673971b2dfb7","filename":"common/lib/src/main/java/org/apache/syncope/common/lib/AnyOperations.java","status":"modified","additions":12,"deletions":3,"changes":15,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/c2bbd0a860c3add02f4bb100ac68f5e11e5c3395/common%2Flib%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcommon%2Flib%2FAnyOperations.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/c2bbd0a860c3add02f4bb100ac68f5e11e5c3395/common%2Flib%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcommon%2Flib%2FAnyOperations.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/common%2Flib%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcommon%2Flib%2FAnyOperations.java?ref=c2bbd0a860c3add02f4bb100ac68f5e11e5c3395","patch":"@@ -121,9 +121,18 @@ public void execute(final String schema) {\n         }\n \n         for (AttrTO attrTO : updatedAttrs.values()) {\n-            AttrPatch patch = new AttrPatch.Builder().operation(PatchOperation.ADD_REPLACE).attrTO(attrTO).build();\n-            if (!patch.isEmpty()) {\n-                result.getPlainAttrs().add(patch);\n+            if (attrTO.getValues().isEmpty()) {\n+                if (!incremental) {\n+                    result.getPlainAttrs().add(new AttrPatch.Builder().\n+                            operation(PatchOperation.DELETE).\n+                            attrTO(new AttrTO.Builder().schema(attrTO.getSchema()).build()).\n+                            build());\n+                }\n+            } else {\n+                AttrPatch patch = new AttrPatch.Builder().operation(PatchOperation.ADD_REPLACE).attrTO(attrTO).build();\n+                if (!patch.isEmpty()) {\n+                    result.getPlainAttrs().add(patch);\n+                }\n             }\n         }\n "},{"sha":"170ca918a8254e435dc174d95d44762b20e0034e","filename":"fit/core-reference/src/test/java/org/apache/syncope/fit/core/reference/GroupITCase.java","status":"modified","additions":6,"deletions":0,"changes":6,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/c2bbd0a860c3add02f4bb100ac68f5e11e5c3395/fit%2Fcore-reference%2Fsrc%2Ftest%2Fjava%2Forg%2Fapache%2Fsyncope%2Ffit%2Fcore%2Freference%2FGroupITCase.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/c2bbd0a860c3add02f4bb100ac68f5e11e5c3395/fit%2Fcore-reference%2Fsrc%2Ftest%2Fjava%2Forg%2Fapache%2Fsyncope%2Ffit%2Fcore%2Freference%2FGroupITCase.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/fit%2Fcore-reference%2Fsrc%2Ftest%2Fjava%2Forg%2Fapache%2Fsyncope%2Ffit%2Fcore%2Freference%2FGroupITCase.java?ref=c2bbd0a860c3add02f4bb100ac68f5e11e5c3395","patch":"@@ -222,6 +222,12 @@ public void update() {\n \n         assertEquals(modName, groupTO.getName());\n         assertEquals(2, groupTO.getPlainAttrs().size());\n+        \n+        groupTO.getPlainAttrMap().get(\"show\").getValues().clear();\n+        \n+        groupTO = groupService.update(groupTO).readEntity(new GenericType<ProvisioningResult<GroupTO>>(){}).getAny();\n+        \n+        assertFalse(groupTO.getPlainAttrMap().containsKey(\"show\"));\n     }\n \n     @Test"}]}