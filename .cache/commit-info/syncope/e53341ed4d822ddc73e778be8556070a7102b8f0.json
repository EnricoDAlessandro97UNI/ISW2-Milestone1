{"sha":"e53341ed4d822ddc73e778be8556070a7102b8f0","node_id":"C_kwDOJfYA1toAKGU1MzM0MWVkNGQ4MjJkZGM3M2U3NzhiZTg1NTYwNzBhNzEwMmI4ZjA","commit":{"author":{"name":"SamuelGaro","email":"72073457+SamuelGaro@users.noreply.github.com","date":"2022-06-21T12:30:06Z"},"committer":{"name":"GitHub","email":"noreply@github.com","date":"2022-06-21T12:30:06Z"},"message":"[SYNCOPE-1683] Show properties override during resource create in tabular topology (#354)","tree":{"sha":"e9ca9195e96908162f128b6c5bb2764f64450e3f","url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/git/trees/e9ca9195e96908162f128b6c5bb2764f64450e3f"},"url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/git/commits/e53341ed4d822ddc73e778be8556070a7102b8f0","comment_count":0,"verification":{"verified":true,"reason":"valid","signature":"-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJisbnOCRBK7hj4Ov3rIwAA0HoIAHtbQYzp1g4SWVeS09ei3+sM\nluWBBQcHbq+g1UQbAdYuqqXCZjczK9iWgKELmye2YD2blTUjtENPGjJGetC4y06N\n+L2mR/fIiiSz/6MwREWZeA01guMZ0Itq2PJJDJK5Lt4vMBZXtpVfBf6TkLOPxTRv\n3XrNNonF7wzwvZlD4y1UIUfoIkCfe0aNstvWajT8FDIe3HYK3/Nr7NI7VE71v5Z2\n5O4hKNyPP1jm5itOQF0wGWQZ/ADLLmCciu/N85Ds8+3Yr7260OFDzCl3vUViocvu\nDKaVRGtT1XyLf+4FD+W54RZ5dkbX7BIohgJwBTZcLsoiQY1KRaNMmbcEeWw9jfc=\n=jkT4\n-----END PGP SIGNATURE-----\n","payload":"tree e9ca9195e96908162f128b6c5bb2764f64450e3f\nparent a08e815f5d7dff88dade65521d28d55a12f52343\nauthor SamuelGaro <72073457+SamuelGaro@users.noreply.github.com> 1655814606 +0200\ncommitter GitHub <noreply@github.com> 1655814606 +0200\n\n[SYNCOPE-1683] Show properties override during resource create in tabular topology (#354)\n\n"}},"url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/e53341ed4d822ddc73e778be8556070a7102b8f0","html_url":"https://github.com/EnricoDAlessandro97UNI/syncope/commit/e53341ed4d822ddc73e778be8556070a7102b8f0","comments_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/e53341ed4d822ddc73e778be8556070a7102b8f0/comments","author":{"login":"SamuelGaro","id":72073457,"node_id":"MDQ6VXNlcjcyMDczNDU3","avatar_url":"https://avatars.githubusercontent.com/u/72073457?v=4","gravatar_id":"","url":"https://api.github.com/users/SamuelGaro","html_url":"https://github.com/SamuelGaro","followers_url":"https://api.github.com/users/SamuelGaro/followers","following_url":"https://api.github.com/users/SamuelGaro/following{/other_user}","gists_url":"https://api.github.com/users/SamuelGaro/gists{/gist_id}","starred_url":"https://api.github.com/users/SamuelGaro/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/SamuelGaro/subscriptions","organizations_url":"https://api.github.com/users/SamuelGaro/orgs","repos_url":"https://api.github.com/users/SamuelGaro/repos","events_url":"https://api.github.com/users/SamuelGaro/events{/privacy}","received_events_url":"https://api.github.com/users/SamuelGaro/received_events","type":"User","site_admin":false},"committer":{"login":"web-flow","id":19864447,"node_id":"MDQ6VXNlcjE5ODY0NDQ3","avatar_url":"https://avatars.githubusercontent.com/u/19864447?v=4","gravatar_id":"","url":"https://api.github.com/users/web-flow","html_url":"https://github.com/web-flow","followers_url":"https://api.github.com/users/web-flow/followers","following_url":"https://api.github.com/users/web-flow/following{/other_user}","gists_url":"https://api.github.com/users/web-flow/gists{/gist_id}","starred_url":"https://api.github.com/users/web-flow/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/web-flow/subscriptions","organizations_url":"https://api.github.com/users/web-flow/orgs","repos_url":"https://api.github.com/users/web-flow/repos","events_url":"https://api.github.com/users/web-flow/events{/privacy}","received_events_url":"https://api.github.com/users/web-flow/received_events","type":"User","site_admin":false},"parents":[{"sha":"a08e815f5d7dff88dade65521d28d55a12f52343","url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/a08e815f5d7dff88dade65521d28d55a12f52343","html_url":"https://github.com/EnricoDAlessandro97UNI/syncope/commit/a08e815f5d7dff88dade65521d28d55a12f52343"}],"stats":{"total":85,"additions":80,"deletions":5},"files":[{"sha":"e5ff14901e70731039e55f2becf8c2e644b52f9d","filename":"client/idm/console/src/main/java/org/apache/syncope/client/console/wizards/resources/AbstractConnConfPanel.java","status":"modified","additions":1,"deletions":1,"changes":2,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/e53341ed4d822ddc73e778be8556070a7102b8f0/client%2Fidm%2Fconsole%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fclient%2Fconsole%2Fwizards%2Fresources%2FAbstractConnConfPanel.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/e53341ed4d822ddc73e778be8556070a7102b8f0/client%2Fidm%2Fconsole%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fclient%2Fconsole%2Fwizards%2Fresources%2FAbstractConnConfPanel.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/client%2Fidm%2Fconsole%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fclient%2Fconsole%2Fwizards%2Fresources%2FAbstractConnConfPanel.java?ref=e53341ed4d822ddc73e778be8556070a7102b8f0","patch":"@@ -76,7 +76,7 @@ public void onSubmit(final AjaxRequestTarget target) {\n     }\n \n     protected void setConfPropertyListView(final IModel<List<ConnConfProperty>> model, final boolean withOverridable) {\n-        propertiesContainer.add(new ConnConfPropertyListView(\n+        propertiesContainer.addOrReplace(new ConnConfPropertyListView(\n                 \"connectorProperties\", model, withOverridable).setOutputMarkupId(true));\n     }\n "},{"sha":"f4e04df457ee0595e786beb6b272b8c2471834f4","filename":"client/idm/console/src/main/java/org/apache/syncope/client/console/wizards/resources/ResourceConnConfPanel.java","status":"modified","additions":9,"deletions":0,"changes":9,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/e53341ed4d822ddc73e778be8556070a7102b8f0/client%2Fidm%2Fconsole%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fclient%2Fconsole%2Fwizards%2Fresources%2FResourceConnConfPanel.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/e53341ed4d822ddc73e778be8556070a7102b8f0/client%2Fidm%2Fconsole%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fclient%2Fconsole%2Fwizards%2Fresources%2FResourceConnConfPanel.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/client%2Fidm%2Fconsole%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fclient%2Fconsole%2Fwizards%2Fresources%2FResourceConnConfPanel.java?ref=e53341ed4d822ddc73e778be8556070a7102b8f0","patch":"@@ -25,6 +25,7 @@\n import org.apache.syncope.client.console.rest.ConnectorRestClient;\n import org.apache.syncope.common.lib.to.ResourceTO;\n import org.apache.syncope.common.lib.types.ConnConfProperty;\n+import org.apache.wicket.ajax.markup.html.form.AjaxButton;\n import org.apache.wicket.model.LoadableDetachableModel;\n import org.apache.wicket.model.PropertyModel;\n \n@@ -107,4 +108,12 @@ protected final List<ConnConfProperty> getConnProperties(final ResourceTO resour\n \n         return props;\n     }\n+\n+    public LoadableDetachableModel<List<ConnConfProperty>> getModel() {\n+        return model;\n+    }\n+\n+    public AjaxButton getCheck() {\n+        return check;\n+    }\n }"},{"sha":"232cd05bd277a669e51b8a542caad8e726384dfc","filename":"client/idm/console/src/main/java/org/apache/syncope/client/console/wizards/resources/ResourceDetailsPanel.java","status":"modified","additions":7,"deletions":1,"changes":8,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/e53341ed4d822ddc73e778be8556070a7102b8f0/client%2Fidm%2Fconsole%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fclient%2Fconsole%2Fwizards%2Fresources%2FResourceDetailsPanel.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/e53341ed4d822ddc73e778be8556070a7102b8f0/client%2Fidm%2Fconsole%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fclient%2Fconsole%2Fwizards%2Fresources%2FResourceDetailsPanel.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/client%2Fidm%2Fconsole%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fclient%2Fconsole%2Fwizards%2Fresources%2FResourceDetailsPanel.java?ref=e53341ed4d822ddc73e778be8556070a7102b8f0","patch":"@@ -50,6 +50,8 @@ public class ResourceDetailsPanel extends WizardStep {\n \n     private static final long serialVersionUID = -7982691107029848579L;\n \n+    private AjaxDropDownChoicePanel<String> connector;\n+\n     private final IModel<List<String>> propagationActions = new LoadableDetachableModel<>() {\n \n         private static final long serialVersionUID = 5275935387613157437L;\n@@ -151,7 +153,7 @@ public ResourceDetailsPanel(final ResourceTO resourceTO, final boolean createFla\n                     new Model<>(resourceTO.getConnectorDisplayName()),\n                     false).addRequiredLabel().setEnabled(false));\n         } else {\n-            final AjaxDropDownChoicePanel<String> connector = new AjaxDropDownChoicePanel<>(\n+            connector = new AjaxDropDownChoicePanel<>(\n                     \"connector\",\n                     new ResourceModel(\"connector\", \"connector\").getObject(),\n                     new PropertyModel<>(resourceTO, \"connector\"), false);\n@@ -186,4 +188,8 @@ public String getObject(final String id, final IModel<? extends List<? extends S\n             container.add(connector);\n         }\n     }\n+\n+    public AjaxDropDownChoicePanel<String> getConnector() {\n+        return connector;\n+    }\n }"},{"sha":"1fd264204d983e1a2723efcc51f337bd76aeae2c","filename":"client/idm/console/src/main/java/org/apache/syncope/client/console/wizards/resources/ResourceWizardBuilder.java","status":"modified","additions":63,"deletions":3,"changes":66,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/e53341ed4d822ddc73e778be8556070a7102b8f0/client%2Fidm%2Fconsole%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fclient%2Fconsole%2Fwizards%2Fresources%2FResourceWizardBuilder.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/e53341ed4d822ddc73e778be8556070a7102b8f0/client%2Fidm%2Fconsole%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fclient%2Fconsole%2Fwizards%2Fresources%2FResourceWizardBuilder.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/client%2Fidm%2Fconsole%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fclient%2Fconsole%2Fwizards%2Fresources%2FResourceWizardBuilder.java?ref=e53341ed4d822ddc73e778be8556070a7102b8f0","patch":"@@ -19,17 +19,24 @@\n package org.apache.syncope.client.console.wizards.resources;\n \n import java.io.Serializable;\n+import java.util.ArrayList;\n import java.util.Collections;\n+import java.util.List;\n import org.apache.commons.lang3.tuple.Pair;\n import org.apache.syncope.client.console.rest.ConnectorRestClient;\n import org.apache.syncope.client.console.rest.ResourceRestClient;\n import org.apache.syncope.client.console.topology.TopologyNode;\n+import org.apache.syncope.client.ui.commons.Constants;\n+import org.apache.syncope.client.ui.commons.ajax.form.IndicatorAjaxFormComponentUpdatingBehavior;\n import org.apache.syncope.client.ui.commons.wizards.AjaxWizard;\n import org.apache.syncope.common.lib.to.ResourceTO;\n+import org.apache.syncope.common.lib.types.ConnConfProperty;\n import org.apache.wicket.PageReference;\n import org.apache.wicket.ajax.AjaxRequestTarget;\n import org.apache.wicket.extensions.wizard.WizardModel;\n import org.apache.wicket.markup.ComponentTag;\n+import org.apache.wicket.model.LoadableDetachableModel;\n+import org.apache.wicket.model.PropertyModel;\n \n /**\n  * Resource wizard builder.\n@@ -53,8 +60,9 @@ public AjaxWizard<Serializable> build(final String id, final AjaxWizard.Mode mod\n     @Override\n     protected WizardModel buildModelSteps(final Serializable modelObject, final WizardModel wizardModel) {\n         ResourceTO resourceTO = ResourceTO.class.cast(modelObject);\n-        wizardModel.add(new ResourceDetailsPanel(resourceTO, createFlag));\n-        wizardModel.add(new ResourceConnConfPanel(resourceTO, createFlag) {\n+        ResourceDetailsPanel resourceDetailsPanel = new ResourceDetailsPanel(resourceTO, createFlag);\n+\n+        ResourceConnConfPanel resourceConnConfPanel = new ResourceConnConfPanel(resourceTO, createFlag) {\n \n             private static final long serialVersionUID = -1128269449868933504L;\n \n@@ -68,7 +76,59 @@ protected void onComponentTag(final ComponentTag tag) {\n                 tag.append(\"class\", \"scrollable-tab-content\", \" \");\n             }\n \n-        });\n+        };\n+\n+        if (createFlag && resourceDetailsPanel.getConnector() != null) {\n+            resourceDetailsPanel.getConnector().getField().add(\n+                new IndicatorAjaxFormComponentUpdatingBehavior(Constants.ON_CHANGE) {\n+\n+                    private static final long serialVersionUID = 4600298808455564695L;\n+\n+                    @Override\n+                    protected void onUpdate(final AjaxRequestTarget target) {\n+                        resourceTO.setConnector(resourceDetailsPanel.getConnector().getModelObject());\n+\n+                        LoadableDetachableModel<List<ConnConfProperty>> model =\n+                                new LoadableDetachableModel<>() {\n+\n+                                    private static final long serialVersionUID = -2965284931860212687L;\n+\n+                                    @Override\n+                                    protected List<ConnConfProperty> load() {\n+                                        List<ConnConfProperty> confOverride =\n+                                                resourceConnConfPanel.getConnProperties(resourceTO);\n+                                        resourceTO.getConfOverride().clear();\n+                                        resourceTO.getConfOverride().addAll(confOverride);\n+\n+                                        return new PropertyModel<List<ConnConfProperty>>(modelObject, \"confOverride\") {\n+\n+                                            private static final long serialVersionUID = -7809699384012595307L;\n+\n+                                            @Override\n+                                            public List<ConnConfProperty> getObject() {\n+                                                List<ConnConfProperty> res = new ArrayList<>(super.getObject());\n+\n+                                                // re-order properties\n+                                                Collections.sort(res, (left, right) -> {\n+                                                    if (left == null) {\n+                                                        return -1;\n+                                                    } else {\n+                                                        return left.compareTo(right);\n+                                                    }\n+                                                });\n+\n+                                                return res;\n+                                            }\n+                                        }.getObject();\n+                                    }\n+                                };\n+                        resourceConnConfPanel.setConfPropertyListView(model, true);\n+                        target.add(resourceConnConfPanel.getCheck().setVisible(true).setEnabled(true));\n+                    }\n+                });\n+        }\n+        wizardModel.add(resourceDetailsPanel);\n+        wizardModel.add(resourceConnConfPanel);\n         if (resourceTO.getConnector() != null) {\n             wizardModel.add(new ResourceConnCapabilitiesPanel(\n                     resourceTO, ConnectorRestClient.read(resourceTO.getConnector()).getCapabilities()));"}]}