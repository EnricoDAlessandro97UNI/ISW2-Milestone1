{"sha":"4d294a3386b5a79accf0fd527f196a65e556f511","node_id":"MDY6Q29tbWl0NjM2ODc5MDYyOjRkMjk0YTMzODZiNWE3OWFjY2YwZmQ1MjdmMTk2YTY1ZTU1NmY1MTE=","commit":{"author":{"name":"Fabio Martelli","email":"fmartelli@apache.org","date":"2013-01-17T17:18:54Z"},"committer":{"name":"Fabio Martelli","email":"fmartelli@apache.org","date":"2013-01-17T17:18:54Z"},"message":"SYNCOPE-266 merged\n\ngit-svn-id: https://svn.apache.org/repos/asf/syncope/trunk@1434790 13f79535-47bb-0310-9956-ffa450edef68","tree":{"sha":"798eda6878055583338f3340c911ac371789eb8b","url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/git/trees/798eda6878055583338f3340c911ac371789eb8b"},"url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/git/commits/4d294a3386b5a79accf0fd527f196a65e556f511","comment_count":0,"verification":{"verified":false,"reason":"unsigned","signature":null,"payload":null}},"url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/4d294a3386b5a79accf0fd527f196a65e556f511","html_url":"https://github.com/EnricoDAlessandro97UNI/syncope/commit/4d294a3386b5a79accf0fd527f196a65e556f511","comments_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/4d294a3386b5a79accf0fd527f196a65e556f511/comments","author":{"login":"fmartelli","id":1791932,"node_id":"MDQ6VXNlcjE3OTE5MzI=","avatar_url":"https://avatars.githubusercontent.com/u/1791932?v=4","gravatar_id":"","url":"https://api.github.com/users/fmartelli","html_url":"https://github.com/fmartelli","followers_url":"https://api.github.com/users/fmartelli/followers","following_url":"https://api.github.com/users/fmartelli/following{/other_user}","gists_url":"https://api.github.com/users/fmartelli/gists{/gist_id}","starred_url":"https://api.github.com/users/fmartelli/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/fmartelli/subscriptions","organizations_url":"https://api.github.com/users/fmartelli/orgs","repos_url":"https://api.github.com/users/fmartelli/repos","events_url":"https://api.github.com/users/fmartelli/events{/privacy}","received_events_url":"https://api.github.com/users/fmartelli/received_events","type":"User","site_admin":false},"committer":{"login":"fmartelli","id":1791932,"node_id":"MDQ6VXNlcjE3OTE5MzI=","avatar_url":"https://avatars.githubusercontent.com/u/1791932?v=4","gravatar_id":"","url":"https://api.github.com/users/fmartelli","html_url":"https://github.com/fmartelli","followers_url":"https://api.github.com/users/fmartelli/followers","following_url":"https://api.github.com/users/fmartelli/following{/other_user}","gists_url":"https://api.github.com/users/fmartelli/gists{/gist_id}","starred_url":"https://api.github.com/users/fmartelli/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/fmartelli/subscriptions","organizations_url":"https://api.github.com/users/fmartelli/orgs","repos_url":"https://api.github.com/users/fmartelli/repos","events_url":"https://api.github.com/users/fmartelli/events{/privacy}","received_events_url":"https://api.github.com/users/fmartelli/received_events","type":"User","site_admin":false},"parents":[{"sha":"df2bce86d30e2dbe02584c0aaca7b85156d25e5f","url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/df2bce86d30e2dbe02584c0aaca7b85156d25e5f","html_url":"https://github.com/EnricoDAlessandro97UNI/syncope/commit/df2bce86d30e2dbe02584c0aaca7b85156d25e5f"}],"stats":{"total":42,"additions":35,"deletions":7},"files":[{"sha":"9448d73895039156b02a3136e6fbe269b84ed776","filename":"core/src/main/java/org/apache/syncope/core/rest/data/UserDataBinder.java","status":"modified","additions":17,"deletions":7,"changes":24,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/4d294a3386b5a79accf0fd527f196a65e556f511/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Frest%2Fdata%2FUserDataBinder.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/4d294a3386b5a79accf0fd527f196a65e556f511/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Frest%2Fdata%2FUserDataBinder.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Frest%2Fdata%2FUserDataBinder.java?ref=4d294a3386b5a79accf0fd527f196a65e556f511","patch":"@@ -45,6 +45,7 @@\n import org.apache.syncope.core.rest.controller.UnauthorizedRoleException;\n import org.apache.syncope.core.util.AttributableUtil;\n import org.apache.syncope.core.util.EntitlementUtil;\n+import org.apache.syncope.core.util.MappingUtil;\n import org.apache.syncope.core.util.NotFoundException;\n import org.apache.syncope.core.util.PasswordEncoder;\n import org.apache.syncope.types.AttributableType;\n@@ -382,15 +383,24 @@ public PropagationByResource update(final SyncopeUser user, final UserMod userMo\n         }\n \n         // now, let's see if there are new resource subscriptions without providing password\n-        Set<String> updatedResources = user.getResourceNames();\n-        updatedResources.removeAll(currentResources);\n-        if (!updatedResources.isEmpty() && StringUtils.isBlank(userMod.getPassword())) {\n+        if (StringUtils.isBlank(userMod.getPassword())) {\n+            Set<String> updatedResources = user.getResourceNames();\n+            updatedResources.removeAll(currentResources);\n \n-            SyncopeClientException sce = new SyncopeClientException(SyncopeClientExceptionType.RequiredValuesMissing);\n-            sce.addElement(\"password cannot be empty \" + \"when subscribing to new resources\");\n-            scce.addException(sce);\n+            for (String res : updatedResources) {\n+                final ExternalResource extRes = resourceDAO.find(res);\n \n-            throw scce;\n+                if (extRes != null && extRes.getUmapping() != null && !MappingUtil.getMatchingMappingItems(\n+                        extRes.getUmapping().getItems(), \"password\", IntMappingType.Password).isEmpty()) {\n+\n+                    SyncopeClientException sce =\n+                            new SyncopeClientException(SyncopeClientExceptionType.RequiredValuesMissing);\n+                    sce.addElement(\"password cannot be empty \" + \"when subscribing to new resources\");\n+                    scce.addException(sce);\n+\n+                    throw scce;\n+                }\n+            }\n         }\n \n         propByRes.addAll(ResourceOperation.DELETE, toBeDeprovisioned);"},{"sha":"c87e24f068c751df55c5688c2edf7172275a1fe7","filename":"core/src/test/java/org/apache/syncope/core/rest/UserTestITCase.java","status":"modified","additions":18,"deletions":0,"changes":18,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/4d294a3386b5a79accf0fd527f196a65e556f511/core%2Fsrc%2Ftest%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Frest%2FUserTestITCase.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/4d294a3386b5a79accf0fd527f196a65e556f511/core%2Fsrc%2Ftest%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Frest%2FUserTestITCase.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fsrc%2Ftest%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Frest%2FUserTestITCase.java?ref=4d294a3386b5a79accf0fd527f196a65e556f511","patch":"@@ -1832,4 +1832,22 @@ public void issueSYNCOPE267() {\n         assertEquals(1, userTO.getVirtualAttributes().size());\n         assertEquals(\"virtualvalue\", userTO.getVirtualAttributes().get(0).getValues().get(0));\n     }\n+\n+    @Test\n+    public void issueSYNCOPE266() {\n+        UserTO userTO = getSampleTO(\"syncope266@apache.org\");\n+        userTO.getResources().clear();\n+\n+        userTO = userService.create(userTO);\n+        assertNotNull(userTO);\n+\n+        UserMod userMod = new UserMod();\n+        userMod.setId(userTO.getId());\n+\n+        // this resource has not a mapping for Password\n+        userMod.addResourceToBeAdded(\"ws-target-resource-update\");\n+\n+        userTO = userService.update(userTO.getId(), userMod);\n+        assertNotNull(userTO);\n+    }\n }"}]}