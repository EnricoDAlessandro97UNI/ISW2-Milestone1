{"sha":"36bec3875cbeefbe63654baca858b164e02135d9","node_id":"MDY6Q29tbWl0NjM2ODc5MDYyOjM2YmVjMzg3NWNiZWVmYmU2MzY1NGJhY2E4NThiMTY0ZTAyMTM1ZDk=","commit":{"author":{"name":"Guido Wimmel","email":"gwimmel@apache.org","date":"2015-05-12T14:44:39Z"},"committer":{"name":"Guido Wimmel","email":"gwimmel@apache.org","date":"2015-05-12T14:44:39Z"},"message":"[SYNCOPE-667] simplification of admin roles filter query used in search","tree":{"sha":"65da2fcf8ba2c7e12c8b027304d8a84bad1749e7","url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/git/trees/65da2fcf8ba2c7e12c8b027304d8a84bad1749e7"},"url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/git/commits/36bec3875cbeefbe63654baca858b164e02135d9","comment_count":0,"verification":{"verified":false,"reason":"unsigned","signature":null,"payload":null}},"url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/36bec3875cbeefbe63654baca858b164e02135d9","html_url":"https://github.com/EnricoDAlessandro97UNI/syncope/commit/36bec3875cbeefbe63654baca858b164e02135d9","comments_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/36bec3875cbeefbe63654baca858b164e02135d9/comments","author":null,"committer":null,"parents":[{"sha":"2f2e67fdcc5bfe3bc3fd43200eb151788ee19095","url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/2f2e67fdcc5bfe3bc3fd43200eb151788ee19095","html_url":"https://github.com/EnricoDAlessandro97UNI/syncope/commit/2f2e67fdcc5bfe3bc3fd43200eb151788ee19095"}],"stats":{"total":10,"additions":5,"deletions":5},"files":[{"sha":"5550690f863a3a23f30769cca25df1264a86c5de","filename":"core/src/main/java/org/apache/syncope/core/persistence/dao/impl/SubjectSearchDAOImpl.java","status":"modified","additions":2,"deletions":4,"changes":6,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/36bec3875cbeefbe63654baca858b164e02135d9/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fpersistence%2Fdao%2Fimpl%2FSubjectSearchDAOImpl.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/36bec3875cbeefbe63654baca858b164e02135d9/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fpersistence%2Fdao%2Fimpl%2FSubjectSearchDAOImpl.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fpersistence%2Fdao%2Fimpl%2FSubjectSearchDAOImpl.java?ref=36bec3875cbeefbe63654baca858b164e02135d9","patch":"@@ -72,9 +72,7 @@ private String getAdminRolesFilter(final Set<Long> adminRoles, final SubjectType\n         final StringBuilder adminRolesFilter = new StringBuilder();\n \n         if (type == SubjectType.USER) {\n-            adminRolesFilter.append(\"SELECT syncopeUser_id AS subject_id FROM Membership M1 WHERE syncopeRole_id IN (\").\n-                    append(\"SELECT syncopeRole_id FROM Membership M2 WHERE M2.syncopeUser_id=M1.syncopeUser_id \").\n-                    append(\"AND syncopeRole_id NOT IN (\");\n+            adminRolesFilter.append(\"SELECT syncopeUser_id AS subject_id FROM Membership WHERE syncopeRole_id NOT IN (\");\n         }\n \n         adminRolesFilter.append(\"SELECT id AS \").\n@@ -94,7 +92,7 @@ private String getAdminRolesFilter(final Set<Long> adminRoles, final SubjectType\n         }\n \n         if (type == SubjectType.USER) {\n-            adminRolesFilter.append(\"))\");\n+            adminRolesFilter.append(\")\");\n         }\n \n         return adminRolesFilter.toString();"},{"sha":"f715c69adc02dfc52912c6489616a52124a235da","filename":"core/src/test/java/org/apache/syncope/core/rest/AuthenticationTestITCase.java","status":"modified","additions":3,"deletions":1,"changes":4,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/36bec3875cbeefbe63654baca858b164e02135d9/core%2Fsrc%2Ftest%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Frest%2FAuthenticationTestITCase.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/36bec3875cbeefbe63654baca858b164e02135d9/core%2Fsrc%2Ftest%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Frest%2FAuthenticationTestITCase.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fsrc%2Ftest%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Frest%2FAuthenticationTestITCase.java?ref=36bec3875cbeefbe63654baca858b164e02135d9","patch":"@@ -214,14 +214,16 @@ public void testUserSearch() {\n                 getService(UserService.class);\n \n         PagedResult<UserTO> matchedUsers = userService2.search(\n-                SyncopeClient.getUserSearchConditionBuilder().isNotNull(\"loginDate\").query());\n+                SyncopeClient.getUserSearchConditionBuilder().isNotNull(\"id\").query());\n         assertNotNull(matchedUsers);\n         assertFalse(matchedUsers.getResult().isEmpty());\n         Set<Long> userIds = new HashSet<Long>(matchedUsers.getResult().size());\n         for (UserTO user : matchedUsers.getResult()) {\n             userIds.add(user.getId());\n         }\n         assertTrue(userIds.contains(1L));\n+        assertFalse(userIds.contains(2L));\n+        assertFalse(userIds.contains(5L));\n \n         UserService userService3 = clientFactory.create(\"verdi\", \"password\").getService(UserService.class);\n "}]}