{"sha":"58fa8e7bf50eab0c156b5a3cbda3a0a93c2e9d7d","node_id":"MDY6Q29tbWl0NjM2ODc5MDYyOjU4ZmE4ZTdiZjUwZWFiMGMxNTZiNWEzY2JkYTNhMGE5M2MyZTlkN2Q=","commit":{"author":{"name":"Francesco Chicchiriccò","email":"ilgrosso@apache.org","date":"2017-03-01T11:24:33Z"},"committer":{"name":"Francesco Chicchiriccò","email":"ilgrosso@apache.org","date":"2017-03-01T11:24:41Z"},"message":"[SYNCOPE-1040] Fix provided","tree":{"sha":"34a986ed87584873685d00f65181d530e2affb04","url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/git/trees/34a986ed87584873685d00f65181d530e2affb04"},"url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/git/commits/58fa8e7bf50eab0c156b5a3cbda3a0a93c2e9d7d","comment_count":0,"verification":{"verified":false,"reason":"unsigned","signature":null,"payload":null}},"url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/58fa8e7bf50eab0c156b5a3cbda3a0a93c2e9d7d","html_url":"https://github.com/EnricoDAlessandro97UNI/syncope/commit/58fa8e7bf50eab0c156b5a3cbda3a0a93c2e9d7d","comments_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/58fa8e7bf50eab0c156b5a3cbda3a0a93c2e9d7d/comments","author":{"login":"ilgrosso","id":1064664,"node_id":"MDQ6VXNlcjEwNjQ2NjQ=","avatar_url":"https://avatars.githubusercontent.com/u/1064664?v=4","gravatar_id":"","url":"https://api.github.com/users/ilgrosso","html_url":"https://github.com/ilgrosso","followers_url":"https://api.github.com/users/ilgrosso/followers","following_url":"https://api.github.com/users/ilgrosso/following{/other_user}","gists_url":"https://api.github.com/users/ilgrosso/gists{/gist_id}","starred_url":"https://api.github.com/users/ilgrosso/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ilgrosso/subscriptions","organizations_url":"https://api.github.com/users/ilgrosso/orgs","repos_url":"https://api.github.com/users/ilgrosso/repos","events_url":"https://api.github.com/users/ilgrosso/events{/privacy}","received_events_url":"https://api.github.com/users/ilgrosso/received_events","type":"User","site_admin":false},"committer":{"login":"ilgrosso","id":1064664,"node_id":"MDQ6VXNlcjEwNjQ2NjQ=","avatar_url":"https://avatars.githubusercontent.com/u/1064664?v=4","gravatar_id":"","url":"https://api.github.com/users/ilgrosso","html_url":"https://github.com/ilgrosso","followers_url":"https://api.github.com/users/ilgrosso/followers","following_url":"https://api.github.com/users/ilgrosso/following{/other_user}","gists_url":"https://api.github.com/users/ilgrosso/gists{/gist_id}","starred_url":"https://api.github.com/users/ilgrosso/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ilgrosso/subscriptions","organizations_url":"https://api.github.com/users/ilgrosso/orgs","repos_url":"https://api.github.com/users/ilgrosso/repos","events_url":"https://api.github.com/users/ilgrosso/events{/privacy}","received_events_url":"https://api.github.com/users/ilgrosso/received_events","type":"User","site_admin":false},"parents":[{"sha":"3be92ce3ca0bbb3696a6b62b748f50c835e59a25","url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/3be92ce3ca0bbb3696a6b62b748f50c835e59a25","html_url":"https://github.com/EnricoDAlessandro97UNI/syncope/commit/3be92ce3ca0bbb3696a6b62b748f50c835e59a25"}],"stats":{"total":27,"additions":24,"deletions":3},"files":[{"sha":"e31277d0171dd4396153c84a5d781009be4a1d4c","filename":"core/provisioning-api/src/main/java/org/apache/syncope/core/provisioning/api/DerAttrHandler.java","status":"modified","additions":2,"deletions":1,"changes":3,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/58fa8e7bf50eab0c156b5a3cbda3a0a93c2e9d7d/core%2Fprovisioning-api%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fprovisioning%2Fapi%2FDerAttrHandler.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/58fa8e7bf50eab0c156b5a3cbda3a0a93c2e9d7d/core%2Fprovisioning-api%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fprovisioning%2Fapi%2FDerAttrHandler.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fprovisioning-api%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fprovisioning%2Fapi%2FDerAttrHandler.java?ref=58fa8e7bf50eab0c156b5a3cbda3a0a93c2e9d7d","patch":"@@ -21,6 +21,7 @@\n import java.util.Map;\n import org.apache.syncope.core.persistence.api.entity.Any;\n import org.apache.syncope.core.persistence.api.entity.DerSchema;\n+import org.apache.syncope.core.persistence.api.entity.GroupableRelatable;\n import org.apache.syncope.core.persistence.api.entity.Membership;\n \n public interface DerAttrHandler {\n@@ -60,5 +61,5 @@ public interface DerAttrHandler {\n      * @param membership membership\n      * @return derived attribute values\n      */\n-    Map<DerSchema, String> getValues(final Any<?> any, final Membership<?> membership);\n+    Map<DerSchema, String> getValues(GroupableRelatable<?, ?, ?, ?, ?> any, Membership<?> membership);\n }"},{"sha":"42990d8e622430ac6545df92384a9625dd7d25ce","filename":"core/provisioning-java/src/main/java/org/apache/syncope/core/provisioning/java/DerAttrHandlerImpl.java","status":"modified","additions":22,"deletions":2,"changes":24,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/58fa8e7bf50eab0c156b5a3cbda3a0a93c2e9d7d/core%2Fprovisioning-java%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fprovisioning%2Fjava%2FDerAttrHandlerImpl.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/58fa8e7bf50eab0c156b5a3cbda3a0a93c2e9d7d/core%2Fprovisioning-java%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fprovisioning%2Fjava%2FDerAttrHandlerImpl.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fprovisioning-java%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fprovisioning%2Fjava%2FDerAttrHandlerImpl.java?ref=58fa8e7bf50eab0c156b5a3cbda3a0a93c2e9d7d","patch":"@@ -28,6 +28,7 @@\n import org.apache.syncope.core.persistence.api.entity.Any;\n import org.apache.syncope.core.persistence.api.entity.AnyUtilsFactory;\n import org.apache.syncope.core.persistence.api.entity.DerSchema;\n+import org.apache.syncope.core.persistence.api.entity.GroupableRelatable;\n import org.apache.syncope.core.persistence.api.entity.Membership;\n import org.apache.syncope.core.provisioning.api.DerAttrHandler;\n import org.slf4j.Logger;\n@@ -90,12 +91,31 @@ public Map<DerSchema, String> getValues(final Any<?> any) {\n                 anyUtilsFactory.getInstance(any).getAllowedSchemas(any, DerSchema.class).getForSelf());\n     }\n \n+    private Map<DerSchema, String> getValues(\n+            final GroupableRelatable<?, ?, ?, ?, ?> any, final Membership<?> membership, final Set<DerSchema> schemas) {\n+\n+        Map<DerSchema, String> result = new HashMap<>(schemas.size());\n+\n+        for (DerSchema schema : schemas) {\n+            JexlContext jexlContext = new MapContext();\n+            JexlUtils.addPlainAttrsToContext(any.getPlainAttrs(membership), jexlContext);\n+            JexlUtils.addFieldsToContext(any, jexlContext);\n+\n+            result.put(schema, JexlUtils.evaluate(schema.getExpression(), jexlContext));\n+        }\n+\n+        return result;\n+    }\n+\n     @Override\n-    public Map<DerSchema, String> getValues(final Any<?> any, final Membership<?> membership) {\n+    public Map<DerSchema, String> getValues(\n+            final GroupableRelatable<?, ?, ?, ?, ?> any, final Membership<?> membership) {\n+\n         return getValues(\n                 any,\n+                membership,\n                 anyUtilsFactory.getInstance(any).getAllowedSchemas(any, DerSchema.class).\n-                getForMembership(membership.getRightEnd()));\n+                        getForMembership(membership.getRightEnd()));\n     }\n \n }"}]}