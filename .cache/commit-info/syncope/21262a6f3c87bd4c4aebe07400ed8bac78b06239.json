{"sha":"21262a6f3c87bd4c4aebe07400ed8bac78b06239","node_id":"MDY6Q29tbWl0NjM2ODc5MDYyOjIxMjYyYTZmM2M4N2JkNGM0YWViZTA3NDAwZWQ4YmFjNzhiMDYyMzk=","commit":{"author":{"name":"Marco Di Sabatino Di Diodoro","email":"mdisabatino@apache.org","date":"2015-09-30T09:14:46Z"},"committer":{"name":"Marco Di Sabatino Di Diodoro","email":"mdisabatino@apache.org","date":"2015-09-30T09:14:46Z"},"message":"[SYNCOPE-156] Add confirm dialog","tree":{"sha":"603a1cfed9f4f04c3f0b5081dd77b09890ab3ae5","url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/git/trees/603a1cfed9f4f04c3f0b5081dd77b09890ab3ae5"},"url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/git/commits/21262a6f3c87bd4c4aebe07400ed8bac78b06239","comment_count":0,"verification":{"verified":false,"reason":"unsigned","signature":null,"payload":null}},"url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/21262a6f3c87bd4c4aebe07400ed8bac78b06239","html_url":"https://github.com/EnricoDAlessandro97UNI/syncope/commit/21262a6f3c87bd4c4aebe07400ed8bac78b06239","comments_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/21262a6f3c87bd4c4aebe07400ed8bac78b06239/comments","author":{"login":"mdisabatino","id":1792527,"node_id":"MDQ6VXNlcjE3OTI1Mjc=","avatar_url":"https://avatars.githubusercontent.com/u/1792527?v=4","gravatar_id":"","url":"https://api.github.com/users/mdisabatino","html_url":"https://github.com/mdisabatino","followers_url":"https://api.github.com/users/mdisabatino/followers","following_url":"https://api.github.com/users/mdisabatino/following{/other_user}","gists_url":"https://api.github.com/users/mdisabatino/gists{/gist_id}","starred_url":"https://api.github.com/users/mdisabatino/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mdisabatino/subscriptions","organizations_url":"https://api.github.com/users/mdisabatino/orgs","repos_url":"https://api.github.com/users/mdisabatino/repos","events_url":"https://api.github.com/users/mdisabatino/events{/privacy}","received_events_url":"https://api.github.com/users/mdisabatino/received_events","type":"User","site_admin":false},"committer":{"login":"mdisabatino","id":1792527,"node_id":"MDQ6VXNlcjE3OTI1Mjc=","avatar_url":"https://avatars.githubusercontent.com/u/1792527?v=4","gravatar_id":"","url":"https://api.github.com/users/mdisabatino","html_url":"https://github.com/mdisabatino","followers_url":"https://api.github.com/users/mdisabatino/followers","following_url":"https://api.github.com/users/mdisabatino/following{/other_user}","gists_url":"https://api.github.com/users/mdisabatino/gists{/gist_id}","starred_url":"https://api.github.com/users/mdisabatino/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mdisabatino/subscriptions","organizations_url":"https://api.github.com/users/mdisabatino/orgs","repos_url":"https://api.github.com/users/mdisabatino/repos","events_url":"https://api.github.com/users/mdisabatino/events{/privacy}","received_events_url":"https://api.github.com/users/mdisabatino/received_events","type":"User","site_admin":false},"parents":[{"sha":"af8f263bf4e8e8eabdc889c96d269b4184fd7813","url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/af8f263bf4e8e8eabdc889c96d269b4184fd7813","html_url":"https://github.com/EnricoDAlessandro97UNI/syncope/commit/af8f263bf4e8e8eabdc889c96d269b4184fd7813"}],"stats":{"total":127,"additions":97,"deletions":30},"files":[{"sha":"fb78280bd0b0d8007822aaaa7d2d46030fae60a3","filename":"client/console/pom.xml","status":"modified","additions":4,"deletions":0,"changes":4,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/21262a6f3c87bd4c4aebe07400ed8bac78b06239/client%2Fconsole%2Fpom.xml","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/21262a6f3c87bd4c4aebe07400ed8bac78b06239/client%2Fconsole%2Fpom.xml","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/client%2Fconsole%2Fpom.xml?ref=21262a6f3c87bd4c4aebe07400ed8bac78b06239","patch":"@@ -106,6 +106,10 @@ under the License.\n       <groupId>org.webjars</groupId>\n       <artifactId>ionicons</artifactId>\n     </dependency>\n+    <dependency>\n+      <groupId>org.webjars</groupId>\n+      <artifactId>bootbox</artifactId>\n+    </dependency>\n     <dependency>\n       <groupId>org.webjars</groupId>\n       <artifactId>highlightjs</artifactId>"},{"sha":"300db13da79fc7ccfb16c730954e91c94f75ffab","filename":"client/console/src/main/java/org/apache/syncope/client/console/pages/Realms.java","status":"modified","additions":7,"deletions":3,"changes":10,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/21262a6f3c87bd4c4aebe07400ed8bac78b06239/client%2Fconsole%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fclient%2Fconsole%2Fpages%2FRealms.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/21262a6f3c87bd4c4aebe07400ed8bac78b06239/client%2Fconsole%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fclient%2Fconsole%2Fpages%2FRealms.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/client%2Fconsole%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fclient%2Fconsole%2Fpages%2FRealms.java?ref=21262a6f3c87bd4c4aebe07400ed8bac78b06239","patch":"@@ -28,6 +28,7 @@\n import org.apache.syncope.client.console.panels.RealmSidebarPanel.ControlSidebarClick;\n import org.apache.syncope.client.console.rest.RealmRestClient;\n import org.apache.syncope.client.console.wicket.ajax.markup.html.ClearIndicatingAjaxLink;\n+import org.apache.syncope.client.console.wicket.markup.html.bootstrap.confirmation.ConfirmationModalBehavior;\n import org.apache.syncope.client.console.wicket.markup.html.bootstrap.dialog.BaseModal;\n import org.apache.syncope.common.lib.to.RealmTO;\n import org.apache.syncope.common.lib.types.Entitlement;\n@@ -119,12 +120,13 @@ private WebMarkupContainer updateRealmContent(final RealmTO realmTO) {\n \n     private void setupDeleteLink() {\n \n-        final AjaxLink<Void> deleteLink = new ClearIndicatingAjaxLink<Void>(\"deleteLink\", getPageReference()) {\n+        @SuppressWarnings(\"unchecked\")\n+        final AjaxLink<Void> deleteLink = new AjaxLink(\"deleteLink\", Model.of(\"deleteLink\")) {\n \n-            private static final long serialVersionUID = -7978723352517770644L;\n+            private static final long serialVersionUID = 3776750333491622263L;\n \n             @Override\n-            protected void onClickInternal(final AjaxRequestTarget target) {\n+            public void onClick(final AjaxRequestTarget target) {\n                 try {\n                     final RealmTO toBeDeleted = realmSidebarPanel.getCurrentRealm();\n \n@@ -147,6 +149,8 @@ protected void onClickInternal(final AjaxRequestTarget target) {\n             }\n         };\n \n+        deleteLink.add(new ConfirmationModalBehavior());\n+\n         if (SyncopeConsoleSession.get().owns(Entitlement.REALM_DELETE)) {\n             MetaDataRoleAuthorizationStrategy.authorize(deleteLink, ENABLE, Entitlement.REALM_DELETE);\n         }"},{"sha":"79967660afcb4d5998a531ed16da907bdae96a7e","filename":"client/console/src/main/java/org/apache/syncope/client/console/wicket/markup/html/bootstrap/confirmation/ConfirmationModalBehavior.java","status":"added","additions":70,"deletions":0,"changes":70,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/21262a6f3c87bd4c4aebe07400ed8bac78b06239/client%2Fconsole%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fclient%2Fconsole%2Fwicket%2Fmarkup%2Fhtml%2Fbootstrap%2Fconfirmation%2FConfirmationModalBehavior.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/21262a6f3c87bd4c4aebe07400ed8bac78b06239/client%2Fconsole%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fclient%2Fconsole%2Fwicket%2Fmarkup%2Fhtml%2Fbootstrap%2Fconfirmation%2FConfirmationModalBehavior.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/client%2Fconsole%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fclient%2Fconsole%2Fwicket%2Fmarkup%2Fhtml%2Fbootstrap%2Fconfirmation%2FConfirmationModalBehavior.java?ref=21262a6f3c87bd4c4aebe07400ed8bac78b06239","patch":"@@ -0,0 +1,70 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *   http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+package org.apache.syncope.client.console.wicket.markup.html.bootstrap.confirmation;\n+\n+import static de.agilecoders.wicket.jquery.JQuery.$;\n+\n+import de.agilecoders.wicket.jquery.function.JavaScriptInlineFunction;\n+import org.apache.wicket.Component;\n+import org.apache.wicket.behavior.Behavior;\n+import org.apache.wicket.markup.head.IHeaderResponse;\n+import org.apache.wicket.markup.head.JavaScriptHeaderItem;\n+import org.apache.wicket.model.ResourceModel;\n+\n+/**\n+ * A behavior that shows a modal with OK/Cancel buttons to confirm an action.\n+ *\n+ */\n+public class ConfirmationModalBehavior extends Behavior {\n+\n+    private static final long serialVersionUID = 1741536820040325586L;\n+\n+    private final String message;\n+\n+    public ConfirmationModalBehavior() {\n+        this(\"confirmDelete\");\n+    }\n+\n+    public ConfirmationModalBehavior(final String msg) {\n+        message = new ResourceModel(msg, \"Are you sure?\").getObject();\n+    }\n+\n+    @Override\n+    public void renderHead(final Component component, final IHeaderResponse response) {\n+        super.renderHead(component, response);\n+\n+        response.render(JavaScriptHeaderItem.forScript(\"var confirm = false;\", null));\n+        response.render($(component).on(\"click\",\n+                new JavaScriptInlineFunction(\"\"\n+                        + \"var element = $(this);\"\n+                        + \"evt.preventDefault();\"\n+                        + \"if(confirm == false){\"\n+                        + \"evt.stopImmediatePropagation();\"\n+                        + \"bootbox.confirm(\\\"\" + message + \"\\\", function(result){\"\n+                        + \"if(result == true){\"\n+                        + \"confirm = true;\"\n+                        + \"element.click();\"\n+                        + \"}\"\n+                        + \"else{confirm = false;}\"\n+                        + \"return true;\"\n+                        + \"})} \"\n+                        + \"else {confirm = false;};\"\n+                )).asDomReadyScript());\n+    }\n+}"},{"sha":"8ad55f6d8a348ebec25c0a461b083cb72a1e73de","filename":"client/console/src/main/java/org/apache/syncope/client/console/wicket/markup/html/form/ActionLinksPanel.java","status":"modified","additions":0,"deletions":1,"changes":1,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/21262a6f3c87bd4c4aebe07400ed8bac78b06239/client%2Fconsole%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fclient%2Fconsole%2Fwicket%2Fmarkup%2Fhtml%2Fform%2FActionLinksPanel.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/21262a6f3c87bd4c4aebe07400ed8bac78b06239/client%2Fconsole%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fclient%2Fconsole%2Fwicket%2Fmarkup%2Fhtml%2Fform%2FActionLinksPanel.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/client%2Fconsole%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fclient%2Fconsole%2Fwicket%2Fmarkup%2Fhtml%2Fform%2FActionLinksPanel.java?ref=21262a6f3c87bd4c4aebe07400ed8bac78b06239","patch":"@@ -25,7 +25,6 @@\n import org.apache.commons.lang3.StringUtils;\n import org.apache.commons.lang3.tuple.Triple;\n import org.apache.syncope.client.console.wicket.ajax.markup.html.ClearIndicatingAjaxLink;\n-import org.apache.syncope.client.console.wicket.ajax.markup.html.IndicatingOnConfirmAjaxLink;\n import org.apache.wicket.PageReference;\n import org.apache.wicket.ajax.AjaxRequestTarget;\n import org.apache.wicket.authroles.authorization.strategies.role.metadata.MetaDataRoleAuthorizationStrategy;"},{"sha":"4aea243103aa459b2e0dec72da719c55c4c79a81","filename":"client/console/src/main/java/org/apache/syncope/client/console/wicket/markup/html/form/IndicatingOnConfirmAjaxLink.java","status":"modified","additions":4,"deletions":22,"changes":26,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/21262a6f3c87bd4c4aebe07400ed8bac78b06239/client%2Fconsole%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fclient%2Fconsole%2Fwicket%2Fmarkup%2Fhtml%2Fform%2FIndicatingOnConfirmAjaxLink.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/21262a6f3c87bd4c4aebe07400ed8bac78b06239/client%2Fconsole%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fclient%2Fconsole%2Fwicket%2Fmarkup%2Fhtml%2Fform%2FIndicatingOnConfirmAjaxLink.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/client%2Fconsole%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fclient%2Fconsole%2Fwicket%2Fmarkup%2Fhtml%2Fform%2FIndicatingOnConfirmAjaxLink.java?ref=21262a6f3c87bd4c4aebe07400ed8bac78b06239","patch":"@@ -16,12 +16,11 @@\n  * specific language governing permissions and limitations\n  * under the License.\n  */\n-package org.apache.syncope.client.console.wicket.ajax.markup.html;\n+package org.apache.syncope.client.console.wicket.markup.html.form;\n \n-import org.apache.wicket.Component;\n+import org.apache.syncope.client.console.wicket.ajax.markup.html.ClearIndicatingAjaxLink;\n+import org.apache.syncope.client.console.wicket.markup.html.bootstrap.confirmation.ConfirmationModalBehavior;\n import org.apache.wicket.PageReference;\n-import org.apache.wicket.ajax.attributes.AjaxCallListener;\n-import org.apache.wicket.ajax.attributes.AjaxRequestAttributes;\n \n public abstract class IndicatingOnConfirmAjaxLink<T> extends ClearIndicatingAjaxLink<T> {\n \n@@ -36,23 +35,6 @@ public IndicatingOnConfirmAjaxLink(final String id, final PageReference pageRef)\n     public IndicatingOnConfirmAjaxLink(final String id, final PageReference pageRef, final String msg) {\n         super(id, pageRef);\n         this.msg = msg;\n-    }\n-\n-    @Override\n-    protected void updateAjaxAttributes(final AjaxRequestAttributes attributes) {\n-        super.updateAjaxAttributes(attributes);\n-\n-        final AjaxCallListener ajaxCallListener = new AjaxCallListener() {\n-\n-            private static final long serialVersionUID = 7160235486520935153L;\n-\n-            @Override\n-            public CharSequence getPrecondition(final Component component) {\n-                return \"if (!confirm('\"\n-                        + getString(IndicatingOnConfirmAjaxLink.this.msg)\n-                        + \"')) {return false;} else {return true;}\";\n-            }\n-        };\n-        attributes.getAjaxCallListeners().add(ajaxCallListener);\n+        this.add(new ConfirmationModalBehavior(msg));\n     }\n }"},{"sha":"e74af55532027306d87e738fd2e39ba9847314ce","filename":"client/console/src/main/resources/org/apache/syncope/client/console/pages/BasePage.html","status":"modified","additions":2,"deletions":0,"changes":2,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/21262a6f3c87bd4c4aebe07400ed8bac78b06239/client%2Fconsole%2Fsrc%2Fmain%2Fresources%2Forg%2Fapache%2Fsyncope%2Fclient%2Fconsole%2Fpages%2FBasePage.html","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/21262a6f3c87bd4c4aebe07400ed8bac78b06239/client%2Fconsole%2Fsrc%2Fmain%2Fresources%2Forg%2Fapache%2Fsyncope%2Fclient%2Fconsole%2Fpages%2FBasePage.html","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/client%2Fconsole%2Fsrc%2Fmain%2Fresources%2Forg%2Fapache%2Fsyncope%2Fclient%2Fconsole%2Fpages%2FBasePage.html?ref=21262a6f3c87bd4c4aebe07400ed8bac78b06239","patch":"@@ -32,6 +32,8 @@\n     <link href=\"css/AdminLTE_skins/skin-green.css\" rel=\"stylesheet\" type=\"text/css\" />\n     <link href=\"css/syncopeConsole.css\" rel=\"stylesheet\" type=\"text/css\" />\n     <link href=\"css/fieldstyle.css\" rel=\"stylesheet\" type=\"text/css\" />\n+    \n+    <script type=\"text/javascript\" src=\"webjars/bootbox/${bootbox.version}/bootbox.js\"></script>\n \n     <script type=\"text/javascript\">\n       var notificationShownTimes = 0;"},{"sha":"47c136e07849e1d199fb395d3cef8eab682fa735","filename":"client/console/src/main/resources/org/apache/syncope/client/console/pages/Realms.html","status":"modified","additions":4,"deletions":4,"changes":8,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/21262a6f3c87bd4c4aebe07400ed8bac78b06239/client%2Fconsole%2Fsrc%2Fmain%2Fresources%2Forg%2Fapache%2Fsyncope%2Fclient%2Fconsole%2Fpages%2FRealms.html","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/21262a6f3c87bd4c4aebe07400ed8bac78b06239/client%2Fconsole%2Fsrc%2Fmain%2Fresources%2Forg%2Fapache%2Fsyncope%2Fclient%2Fconsole%2Fpages%2FRealms.html","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/client%2Fconsole%2Fsrc%2Fmain%2Fresources%2Forg%2Fapache%2Fsyncope%2Fclient%2Fconsole%2Fpages%2FRealms.html?ref=21262a6f3c87bd4c4aebe07400ed8bac78b06239","patch":"@@ -29,19 +29,19 @@ <h3 class=\"box-title\">\n             <div class=\"box-tools pull-right\">\n               <ul class=\"nav navbar-nav actions\">\n                 <li>\n-                  <a href=\"#\" wicket:id=\"editLink\">\n+                  <a wicket:id=\"editLink\">\n                     <i class=\"fa fa-pencil-square-o\"></i>\n                   </a>                  \n                 </li>\n                 <li>\n-                  <a href=\"#\" wicket:id=\"createLink\">\n+                  <a wicket:id=\"createLink\">\n                     <i class=\"fa fa-plus\"></i>\n                   </a>                  \n                 </li>\n                 <li>\n-                  <a href=\"#\" wicket:id=\"deleteLink\">\n+                  <a wicket:id=\"deleteLink\" data-bb=\"confirm\">\n                     <i class=\"fa fa-minus\"></i>\n-                  </a>                  \n+                  </a>\n                 </li>\n               </ul>\n             </div><!-- /.box-tools -->"},{"sha":"495ce108363940b64622dcbaeec556edc8b3fb70","filename":"pom.xml","status":"modified","additions":6,"deletions":0,"changes":6,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/21262a6f3c87bd4c4aebe07400ed8bac78b06239/pom.xml","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/21262a6f3c87bd4c4aebe07400ed8bac78b06239/pom.xml","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/pom.xml?ref=21262a6f3c87bd4c4aebe07400ed8bac78b06239","patch":"@@ -377,6 +377,7 @@ under the License.\n     <bootstrap.version>3.3.5</bootstrap.version>\n \n     <wicket-bootstrap.version>0.10.4-SNAPSHOT</wicket-bootstrap.version>\n+    <bootbox.version>4.4.0</bootbox.version>\n \n     <font-awesome.version>4.4.0</font-awesome.version>\n     <ionicons.version>2.0.1</ionicons.version>\n@@ -951,6 +952,11 @@ under the License.\n         <artifactId>font-awesome</artifactId>\n         <version>${font-awesome.version}</version>\n       </dependency>\n+      <dependency>\n+        <groupId>org.webjars</groupId>\n+        <artifactId>bootbox</artifactId>\n+        <version>${bootbox.version}</version>\n+      </dependency>\n       <dependency>\n         <groupId>org.webjars</groupId>\n         <artifactId>ionicons</artifactId>"}]}