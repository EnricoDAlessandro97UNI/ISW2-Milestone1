{"sha":"6bc1f6b45e830e814303b0b7f06f603c8f719991","node_id":"MDY6Q29tbWl0NjM2ODc5MDYyOjZiYzFmNmI0NWU4MzBlODE0MzAzYjBiN2YwNmY2MDNjOGY3MTk5OTE=","commit":{"author":{"name":"Unknown","email":"unknown@apache.org","date":"2011-02-15T11:00:36Z"},"committer":{"name":"Unknown","email":"unknown@apache.org","date":"2011-02-15T11:00:36Z"},"message":"Property managing root roles\n\ngit-svn-id: https://svn.apache.org/repos/asf/incubator/syncope/trunk@1246790 13f79535-47bb-0310-9956-ffa450edef68","tree":{"sha":"58e027cdbbc906d7c9f826b5f18df2c85d7b19db","url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/git/trees/58e027cdbbc906d7c9f826b5f18df2c85d7b19db"},"url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/git/commits/6bc1f6b45e830e814303b0b7f06f603c8f719991","comment_count":0,"verification":{"verified":false,"reason":"unsigned","signature":null,"payload":null}},"url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/6bc1f6b45e830e814303b0b7f06f603c8f719991","html_url":"https://github.com/EnricoDAlessandro97UNI/syncope/commit/6bc1f6b45e830e814303b0b7f06f603c8f719991","comments_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/6bc1f6b45e830e814303b0b7f06f603c8f719991/comments","author":null,"committer":null,"parents":[{"sha":"ecfe53f621707cd7a3f660b39c6cc694c764227a","url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/ecfe53f621707cd7a3f660b39c6cc694c764227a","html_url":"https://github.com/EnricoDAlessandro97UNI/syncope/commit/ecfe53f621707cd7a3f660b39c6cc694c764227a"}],"stats":{"total":136,"additions":76,"deletions":60},"files":[{"sha":"0abe2bbd8ccdcf77c437ccc36e81a8ae65882e57","filename":"console/src/main/java/org/syncope/console/commons/RoleTreeBuilder.java","status":"modified","additions":17,"deletions":5,"changes":22,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/6bc1f6b45e830e814303b0b7f06f603c8f719991/console%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fconsole%2Fcommons%2FRoleTreeBuilder.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/6bc1f6b45e830e814303b0b7f06f603c8f719991/console%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fconsole%2Fcommons%2FRoleTreeBuilder.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/console%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fconsole%2Fcommons%2FRoleTreeBuilder.java?ref=6bc1f6b45e830e814303b0b7f06f603c8f719991","patch":"@@ -64,12 +64,8 @@ public TreeModel build() {\n     }\n \n     public TreeModel build(final List<RoleTO> roles) {\n-        RoleTO fakerootTO = new RoleTO();\n-        fakerootTO.setId(0);\n-        fakerootTO.setName(\"\");\n-        fakerootTO.setParent(-1);\n         DefaultMutableTreeNode fakeroot =\n-                new DefaultMutableTreeNode(fakerootTO);\n+                new DefaultMutableTreeNode(new FakerootTO());\n \n         populateSubtree(fakeroot, roles);\n \n@@ -90,4 +86,20 @@ public int compare(final RoleTO r1, final RoleTO r2) {\n             return 1;\n         }\n     }\n+\n+    private static class FakerootTO extends RoleTO {\n+\n+        public FakerootTO() {\n+            super();\n+\n+            setId(0);\n+            setName(\"\");\n+            setParent(-1);\n+        }\n+\n+        @Override\n+        public String getDisplayName() {\n+            return \"\";\n+        }\n+    }\n }"},{"sha":"7cdf04cb5d11c86e3b5ce25a0ae57bb3e2beb5ae","filename":"console/src/main/java/org/syncope/console/pages/RoleModalPage.java","status":"modified","additions":5,"deletions":4,"changes":9,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/6bc1f6b45e830e814303b0b7f06f603c8f719991/console%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fconsole%2Fpages%2FRoleModalPage.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/6bc1f6b45e830e814303b0b7f06f603c8f719991/console%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fconsole%2Fpages%2FRoleModalPage.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/console%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fconsole%2Fpages%2FRoleModalPage.java?ref=6bc1f6b45e830e814303b0b7f06f603c8f719991","patch":"@@ -109,7 +109,8 @@ public RoleModalPage(final BasePage basePage, final ModalWindow window,\n \n         final Form form = new Form(\"RoleForm\");\n \n-        add(new Label(\"displayName\", roleTO.getDisplayName()));\n+        add(new Label(\"displayName\",\n+                roleTO.getId() != 0 ? roleTO.getDisplayName() : \"\"));\n \n         form.setModel(new CompoundPropertyModel(roleTO));\n \n@@ -487,10 +488,10 @@ public void cloneOldRoleTO(RoleTO roleTO) {\n         oldRole = new RoleTO();\n \n         oldRole.setId(roleTO.getId());\n-        oldRole.setName(new String(roleTO.getName()));\n-        oldRole.setParent(new Long(roleTO.getParent()));\n+        oldRole.setName(roleTO.getName());\n+        oldRole.setParent(roleTO.getParent());\n \n-        List<AttributeTO> attributes = new ArrayList<AttributeTO>();\n+        final List<AttributeTO> attributes = new ArrayList<AttributeTO>();\n \n         AttributeTO attributeTO;\n         List<String> values;"},{"sha":"c44ab8e071ffa62b160541e255a17bab4f26cd5d","filename":"console/src/main/java/org/syncope/console/wicket/markup/html/tree/NodeEditablePanel.java","status":"modified","additions":27,"deletions":28,"changes":55,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/6bc1f6b45e830e814303b0b7f06f603c8f719991/console%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fconsole%2Fwicket%2Fmarkup%2Fhtml%2Ftree%2FNodeEditablePanel.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/6bc1f6b45e830e814303b0b7f06f603c8f719991/console%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fconsole%2Fwicket%2Fmarkup%2Fhtml%2Ftree%2FNodeEditablePanel.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/console%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fconsole%2Fwicket%2Fmarkup%2Fhtml%2Ftree%2FNodeEditablePanel.java?ref=6bc1f6b45e830e814303b0b7f06f603c8f719991","patch":"@@ -60,38 +60,37 @@ public NodeEditablePanel(String id, final Long idRole, IModel inputModel,\n \n         super(id);\n \n-        if (idRole == -1) {\n-            fragment = new Fragment(\"menuPanel\", \"frag2\", this);\n-        } else {\n-            fragment = new Fragment(\"menuPanel\", \"frag1\", this);\n-\n-            AjaxLink createRoleLink = new IndicatingAjaxLink(\"createRoleLink\") {\n-\n-                @Override\n-                public void onClick(final AjaxRequestTarget target) {\n-                    window.setPageCreator(new ModalWindow.PageCreator() {\n-\n-                        @Override\n-                        public Page createPage() {\n-                            RoleTO roleTO = new RoleTO();\n-                            roleTO.setParent(idRole);\n-                            RoleModalPage form = new RoleModalPage(basePage,\n-                                    window, roleTO, true);\n-                            return form;\n-                        }\n-                    });\n+        fragment = new Fragment(\"menuPanel\",\n+                idRole == 0 ? \"fakerootFrag\" : \"roleFrag\", this);\n+\n+        AjaxLink createRoleLink = new IndicatingAjaxLink(\"createRoleLink\") {\n+\n+            @Override\n+            public void onClick(final AjaxRequestTarget target) {\n+                window.setPageCreator(new ModalWindow.PageCreator() {\n+\n+                    @Override\n+                    public Page createPage() {\n+                        RoleTO roleTO = new RoleTO();\n+                        roleTO.setParent(idRole);\n+                        RoleModalPage form = new RoleModalPage(basePage,\n+                                window, roleTO, true);\n+                        return form;\n+                    }\n+                });\n \n-                    window.show(target);\n-                }\n-            };\n+                window.show(target);\n+            }\n+        };\n \n-            String allowedCreateRoles = xmlRolesReader.getAllAllowedRoles(\n-                    \"Roles\", \"create\");\n-            MetaDataRoleAuthorizationStrategy.authorize(createRoleLink, ENABLE,\n-                    allowedCreateRoles);\n+        String allowedCreateRoles = xmlRolesReader.getAllAllowedRoles(\n+                \"Roles\", \"create\");\n+        MetaDataRoleAuthorizationStrategy.authorize(createRoleLink, ENABLE,\n+                allowedCreateRoles);\n \n-            fragment.add(createRoleLink);\n+        fragment.add(createRoleLink);\n \n+        if (idRole != 0) {\n             AjaxLink updateRoleLink = new IndicatingAjaxLink(\"updateRoleLink\") {\n \n                 @Override"},{"sha":"dc6d73da280270e61f8b1d99911f2272c9f23d75","filename":"console/src/main/resources/org/syncope/console/wicket/markup/html/tree/NodeEditablePanel.html","status":"modified","additions":7,"deletions":5,"changes":12,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/6bc1f6b45e830e814303b0b7f06f603c8f719991/console%2Fsrc%2Fmain%2Fresources%2Forg%2Fsyncope%2Fconsole%2Fwicket%2Fmarkup%2Fhtml%2Ftree%2FNodeEditablePanel.html","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/6bc1f6b45e830e814303b0b7f06f603c8f719991/console%2Fsrc%2Fmain%2Fresources%2Forg%2Fsyncope%2Fconsole%2Fwicket%2Fmarkup%2Fhtml%2Ftree%2FNodeEditablePanel.html","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/console%2Fsrc%2Fmain%2Fresources%2Forg%2Fsyncope%2Fconsole%2Fwicket%2Fmarkup%2Fhtml%2Ftree%2FNodeEditablePanel.html?ref=6bc1f6b45e830e814303b0b7f06f603c8f719991","patch":"@@ -14,8 +14,8 @@\n -->\n <wicket:panel>\n     <span wicket:id=\"menuPanel\"/>\n-    \n-    <wicket:fragment wicket:id=\"frag1\">\n+\n+    <wicket:fragment wicket:id=\"roleFrag\">\n         <a  wicket:id=\"createRoleLink\">\n             <wicket:message key=\"create_role\"/>&nbsp;\n         </a>\n@@ -27,8 +27,10 @@\n         </a>\n     </wicket:fragment>\n \n-    <wicket:fragment wicket:id=\"frag2\">\n-\n+    <wicket:fragment wicket:id=\"fakerootFrag\">\n+        <a  wicket:id=\"createRoleLink\">\n+            <wicket:message key=\"create_role\"/>&nbsp;\n+        </a>\n     </wicket:fragment>\n-    \n+\n </wicket:panel>\n\\ No newline at end of file"},{"sha":"7511b67707405cf62b0d4ac1c5a20543606d44ba","filename":"core/src/main/java/org/syncope/core/rest/controller/RoleController.java","status":"modified","additions":10,"deletions":10,"changes":20,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/6bc1f6b45e830e814303b0b7f06f603c8f719991/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fcore%2Frest%2Fcontroller%2FRoleController.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/6bc1f6b45e830e814303b0b7f06f603c8f719991/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fcore%2Frest%2Fcontroller%2FRoleController.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fcore%2Frest%2Fcontroller%2FRoleController.java?ref=6bc1f6b45e830e814303b0b7f06f603c8f719991","patch":"@@ -37,7 +37,7 @@\n public class RoleController extends AbstractController {\n \n     @Autowired\n-    private RoleDAO syncopeRoleDAO;\n+    private RoleDAO roleDAO;\n \n     @Autowired\n     private RoleDataBinder roleDataBinder;\n@@ -59,7 +59,7 @@ public RoleTO create(HttpServletResponse response,\n \n             throw e;\n         }\n-        role = syncopeRoleDAO.save(role);\n+        role = roleDAO.save(role);\n \n         response.setStatus(HttpServletResponse.SC_CREATED);\n         return roleDataBinder.getRoleTO(role);\n@@ -71,21 +71,21 @@ public RoleTO create(HttpServletResponse response,\n     public void delete(@PathVariable(\"roleId\") Long roleId)\n             throws NotFoundException {\n \n-        SyncopeRole role = syncopeRoleDAO.find(roleId);\n+        SyncopeRole role = roleDAO.find(roleId);\n         if (role == null) {\n             LOG.error(\"Could not find role '\" + roleId + \"'\");\n \n             throw new NotFoundException(\"Role \" + String.valueOf(roleId));\n         }\n \n-        syncopeRoleDAO.delete(roleId);\n+        roleDAO.delete(roleId);\n     }\n \n     @PreAuthorize(\"hasRole('ROLE_LIST')\")\n     @RequestMapping(method = RequestMethod.GET,\n     value = \"/list\")\n     public List<RoleTO> list() {\n-        List<SyncopeRole> roles = syncopeRoleDAO.findAll();\n+        List<SyncopeRole> roles = roleDAO.findAll();\n         List<RoleTO> roleTOs = new ArrayList<RoleTO>(roles.size());\n         for (SyncopeRole role : roles) {\n             roleTOs.add(roleDataBinder.getRoleTO(role));\n@@ -100,7 +100,7 @@ public List<RoleTO> list() {\n     public RoleTO parent(@PathVariable(\"roleId\") Long roleId)\n             throws NotFoundException {\n \n-        SyncopeRole role = syncopeRoleDAO.find(roleId);\n+        SyncopeRole role = roleDAO.find(roleId);\n         if (role == null) {\n             LOG.error(\"Could not find role '\" + roleId + \"'\");\n \n@@ -116,7 +116,7 @@ public RoleTO parent(@PathVariable(\"roleId\") Long roleId)\n     value = \"/children/{roleId}\")\n     public List<RoleTO> children(@PathVariable(\"roleId\") Long roleId) {\n \n-        List<SyncopeRole> roles = syncopeRoleDAO.findChildren(roleId);\n+        List<SyncopeRole> roles = roleDAO.findChildren(roleId);\n         List<RoleTO> roleTOs = new ArrayList<RoleTO>(roles.size());\n         for (SyncopeRole role : roles) {\n             roleTOs.add(roleDataBinder.getRoleTO(role));\n@@ -131,7 +131,7 @@ public List<RoleTO> children(@PathVariable(\"roleId\") Long roleId) {\n     public RoleTO read(@PathVariable(\"roleId\") Long roleId)\n             throws NotFoundException {\n \n-        SyncopeRole role = syncopeRoleDAO.find(roleId);\n+        SyncopeRole role = roleDAO.find(roleId);\n         if (role == null) {\n             LOG.error(\"Could not find role '\" + roleId + \"'\");\n \n@@ -149,7 +149,7 @@ public RoleTO update(@RequestBody RoleMod roleMod)\n \n         LOG.debug(\"Role update called with parameter {}\", roleMod);\n \n-        SyncopeRole role = syncopeRoleDAO.find(roleMod.getId());\n+        SyncopeRole role = roleDAO.find(roleMod.getId());\n         if (role == null) {\n             LOG.error(\"Could not find role '\" + roleMod.getId() + \"'\");\n \n@@ -158,7 +158,7 @@ public RoleTO update(@RequestBody RoleMod roleMod)\n         }\n \n         roleDataBinder.update(role, roleMod);\n-        role = syncopeRoleDAO.save(role);\n+        role = roleDAO.save(role);\n \n         return roleDataBinder.getRoleTO(role);\n     }"},{"sha":"484074ea303fbc1f761afe52dbfb64bd0bf23a6d","filename":"core/src/main/java/org/syncope/core/rest/data/RoleDataBinder.java","status":"modified","additions":10,"deletions":8,"changes":18,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/6bc1f6b45e830e814303b0b7f06f603c8f719991/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fcore%2Frest%2Fdata%2FRoleDataBinder.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/6bc1f6b45e830e814303b0b7f06f603c8f719991/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fcore%2Frest%2Fdata%2FRoleDataBinder.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fcore%2Frest%2Fdata%2FRoleDataBinder.java?ref=6bc1f6b45e830e814303b0b7f06f603c8f719991","patch":"@@ -58,15 +58,17 @@ public SyncopeRole create(final RoleTO roleTO)\n             role.setName(roleTO.getName());\n         }\n         Long parentRoleId = null;\n-        SyncopeRole parentRole = roleDAO.find(roleTO.getParent());\n-        if (parentRole == null) {\n-            LOG.error(\"Could not find role with id \" + roleTO.getParent());\n+        if (roleTO.getParent() != 0) {\n+            SyncopeRole parentRole = roleDAO.find(roleTO.getParent());\n+            if (parentRole == null) {\n+                LOG.error(\"Could not find role with id \" + roleTO.getParent());\n \n-            invalidRoles.addElement(String.valueOf(roleTO.getParent()));\n-            scce.addException(invalidRoles);\n-        } else {\n-            role.setParent(parentRole);\n-            parentRoleId = role.getParent().getId();\n+                invalidRoles.addElement(String.valueOf(roleTO.getParent()));\n+                scce.addException(invalidRoles);\n+            } else {\n+                role.setParent(parentRole);\n+                parentRoleId = role.getParent().getId();\n+            }\n         }\n \n         SyncopeRole otherRole = roleDAO.find("}]}