{"sha":"95b56b8099933f1cf2f0145a33261d7cd10cc1ae","node_id":"MDY6Q29tbWl0NjM2ODc5MDYyOjk1YjU2YjgwOTk5MzNmMWNmMmYwMTQ1YTMzMjYxZDdjZDEwY2MxYWU=","commit":{"author":{"name":"Francesco Chicchiriccò","email":"ilgrosso@apache.org","date":"2021-02-05T11:37:29Z"},"committer":{"name":"Francesco Chicchiriccò","email":"ilgrosso@apache.org","date":"2021-02-05T11:39:58Z"},"message":"[SYNCOPE-1616] Create SinglePullJobDelegate / SinglePushJobDelegate / StreamPullJobDelegate / StreamPushJobDelegate upon request","tree":{"sha":"2ef4e2cce284c6d9fa7ebeb6a1be5a6d48decc28","url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/git/trees/2ef4e2cce284c6d9fa7ebeb6a1be5a6d48decc28"},"url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/git/commits/95b56b8099933f1cf2f0145a33261d7cd10cc1ae","comment_count":0,"verification":{"verified":false,"reason":"unsigned","signature":null,"payload":null}},"url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/95b56b8099933f1cf2f0145a33261d7cd10cc1ae","html_url":"https://github.com/EnricoDAlessandro97UNI/syncope/commit/95b56b8099933f1cf2f0145a33261d7cd10cc1ae","comments_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/95b56b8099933f1cf2f0145a33261d7cd10cc1ae/comments","author":{"login":"ilgrosso","id":1064664,"node_id":"MDQ6VXNlcjEwNjQ2NjQ=","avatar_url":"https://avatars.githubusercontent.com/u/1064664?v=4","gravatar_id":"","url":"https://api.github.com/users/ilgrosso","html_url":"https://github.com/ilgrosso","followers_url":"https://api.github.com/users/ilgrosso/followers","following_url":"https://api.github.com/users/ilgrosso/following{/other_user}","gists_url":"https://api.github.com/users/ilgrosso/gists{/gist_id}","starred_url":"https://api.github.com/users/ilgrosso/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ilgrosso/subscriptions","organizations_url":"https://api.github.com/users/ilgrosso/orgs","repos_url":"https://api.github.com/users/ilgrosso/repos","events_url":"https://api.github.com/users/ilgrosso/events{/privacy}","received_events_url":"https://api.github.com/users/ilgrosso/received_events","type":"User","site_admin":false},"committer":{"login":"ilgrosso","id":1064664,"node_id":"MDQ6VXNlcjEwNjQ2NjQ=","avatar_url":"https://avatars.githubusercontent.com/u/1064664?v=4","gravatar_id":"","url":"https://api.github.com/users/ilgrosso","html_url":"https://github.com/ilgrosso","followers_url":"https://api.github.com/users/ilgrosso/followers","following_url":"https://api.github.com/users/ilgrosso/following{/other_user}","gists_url":"https://api.github.com/users/ilgrosso/gists{/gist_id}","starred_url":"https://api.github.com/users/ilgrosso/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ilgrosso/subscriptions","organizations_url":"https://api.github.com/users/ilgrosso/orgs","repos_url":"https://api.github.com/users/ilgrosso/repos","events_url":"https://api.github.com/users/ilgrosso/events{/privacy}","received_events_url":"https://api.github.com/users/ilgrosso/received_events","type":"User","site_admin":false},"parents":[{"sha":"4681c65c52214cdfe70c1a1456887ed7b0d58a0f","url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/4681c65c52214cdfe70c1a1456887ed7b0d58a0f","html_url":"https://github.com/EnricoDAlessandro97UNI/syncope/commit/4681c65c52214cdfe70c1a1456887ed7b0d58a0f"}],"stats":{"total":99,"additions":61,"deletions":38},"files":[{"sha":"8d39b68140823a0ac905595934f885604e9136a6","filename":"core/idm/logic/src/main/java/org/apache/syncope/core/logic/ReconciliationLogic.java","status":"modified","additions":31,"deletions":22,"changes":53,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/95b56b8099933f1cf2f0145a33261d7cd10cc1ae/core%2Fidm%2Flogic%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Flogic%2FReconciliationLogic.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/95b56b8099933f1cf2f0145a33261d7cd10cc1ae/core%2Fidm%2Flogic%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Flogic%2FReconciliationLogic.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fidm%2Flogic%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Flogic%2FReconciliationLogic.java?ref=95b56b8099933f1cf2f0145a33261d7cd10cc1ae","patch":"@@ -73,19 +73,24 @@\n import org.apache.syncope.core.provisioning.api.pushpull.ConstantReconFilterBuilder;\n import org.apache.syncope.core.provisioning.api.pushpull.KeyValueReconFilterBuilder;\n import org.apache.syncope.core.provisioning.api.pushpull.ReconFilterBuilder;\n-import org.apache.syncope.core.provisioning.java.pushpull.stream.CSVStreamConnector;\n import org.apache.syncope.core.provisioning.api.pushpull.SyncopeSinglePullExecutor;\n+import org.apache.syncope.core.provisioning.java.pushpull.stream.CSVStreamConnector;\n import org.apache.syncope.core.provisioning.api.pushpull.SyncopeSinglePushExecutor;\n import org.apache.syncope.core.provisioning.api.pushpull.stream.SyncopeStreamPullExecutor;\n-import org.apache.syncope.core.provisioning.api.pushpull.stream.SyncopeStreamPushExecutor;\n-import org.apache.syncope.core.provisioning.api.utils.RealmUtils;\n import org.apache.syncope.core.provisioning.java.pushpull.InboundMatcher;\n import org.apache.syncope.core.provisioning.java.pushpull.OutboundMatcher;\n import org.apache.syncope.core.provisioning.java.utils.ConnObjectUtils;\n import org.apache.syncope.core.provisioning.java.utils.MappingUtils;\n-import org.apache.syncope.core.spring.security.AuthContextUtils;\n import org.identityconnectors.framework.common.objects.Attribute;\n import org.identityconnectors.framework.common.objects.ConnectorObject;\n+import org.apache.syncope.core.provisioning.api.pushpull.stream.SyncopeStreamPushExecutor;\n+import org.apache.syncope.core.provisioning.api.utils.RealmUtils;\n+import org.apache.syncope.core.provisioning.java.pushpull.SinglePullJobDelegate;\n+import org.apache.syncope.core.provisioning.java.pushpull.SinglePushJobDelegate;\n+import org.apache.syncope.core.provisioning.java.pushpull.stream.StreamPullJobDelegate;\n+import org.apache.syncope.core.provisioning.java.pushpull.stream.StreamPushJobDelegate;\n+import org.apache.syncope.core.spring.ApplicationContextProvider;\n+import org.apache.syncope.core.spring.security.AuthContextUtils;\n import org.identityconnectors.framework.common.objects.OperationOptions;\n import org.identityconnectors.framework.common.objects.SearchResult;\n import org.identityconnectors.framework.common.objects.SyncDeltaBuilder;\n@@ -98,6 +103,7 @@\n import org.springframework.beans.factory.annotation.Autowired;\n import org.springframework.security.access.prepost.PreAuthorize;\n import org.springframework.stereotype.Component;\n+import org.springframework.beans.factory.support.AbstractBeanDefinition;\n \n @Component\n public class ReconciliationLogic extends AbstractTransactionalLogic<EntityTO> {\n@@ -141,18 +147,6 @@ public class ReconciliationLogic extends AbstractTransactionalLogic<EntityTO> {\n     @Autowired\n     private ConnectorFactory connFactory;\n \n-    @Autowired\n-    private SyncopeSinglePullExecutor singlePullExecutor;\n-\n-    @Autowired\n-    private SyncopeSinglePushExecutor singlePushExecutor;\n-\n-    @Autowired\n-    private SyncopeStreamPushExecutor streamPushExecutor;\n-\n-    @Autowired\n-    private SyncopeStreamPullExecutor streamPullExecutor;\n-\n     private Provision getProvision(final String anyTypeKey, final String resourceKey) {\n         AnyType anyType = anyTypeDAO.find(anyTypeKey);\n         if (anyType == null) {\n@@ -335,6 +329,11 @@ public ReconStatus status(\n         return status;\n     }\n \n+    private SyncopeSinglePushExecutor singlePushExecutor() {\n+        return (SyncopeSinglePushExecutor) ApplicationContextProvider.getBeanFactory().\n+                createBean(SinglePushJobDelegate.class, AbstractBeanDefinition.AUTOWIRE_BY_NAME, false);\n+    }\n+\n     @PreAuthorize(\"hasRole('\" + IdRepoEntitlement.TASK_EXECUTE + \"')\")\n     public List<ProvisioningReport> push(\n             final String anyTypeKey,\n@@ -347,7 +346,7 @@ public List<ProvisioningReport> push(\n         SyncopeClientException sce = SyncopeClientException.build(ClientExceptionType.Reconciliation);\n         List<ProvisioningReport> results = new ArrayList<>();\n         try {\n-            results.addAll(singlePushExecutor.push(\n+            results.addAll(singlePushExecutor().push(\n                     provision,\n                     connFactory.getConnector(provision.getResource()),\n                     getAny(provision, anyKey),\n@@ -385,7 +384,7 @@ public List<ProvisioningReport> push(\n             inboundMatcher.match(syncDeltaBuilder.build(), provision).stream().findFirst().ifPresent(match -> {\n                 try {\n                     if (match.getMatchTarget() == MatchType.ANY) {\n-                        results.addAll(singlePushExecutor.push(\n+                        results.addAll(singlePushExecutor().push(\n                                 provision,\n                                 connFactory.getConnector(provision.getResource()),\n                                 match.getAny(),\n@@ -394,7 +393,7 @@ public List<ProvisioningReport> push(\n                             sce.getElements().add(results.get(0).getMessage());\n                         }\n                     } else {\n-                        ProvisioningReport result = singlePushExecutor.push(\n+                        ProvisioningReport result = singlePushExecutor().push(\n                                 provision,\n                                 connFactory.getConnector(provision.getResource()),\n                                 match.getLinkedAccount(),\n@@ -431,7 +430,11 @@ private List<ProvisioningReport> pull(\n         SyncopeClientException sce = SyncopeClientException.build(ClientExceptionType.Reconciliation);\n         List<ProvisioningReport> results = new ArrayList<>();\n         try {\n-            results.addAll(singlePullExecutor.pull(\n+            SyncopeSinglePullExecutor executor =\n+                    (SyncopeSinglePullExecutor) ApplicationContextProvider.getBeanFactory().\n+                            createBean(SinglePullJobDelegate.class, AbstractBeanDefinition.AUTOWIRE_BY_NAME, false);\n+\n+            results.addAll(executor.pull(\n                     provision,\n                     connFactory.getConnector(provision.getResource()),\n                     reconFilterBuilder,\n@@ -605,7 +608,10 @@ public List<ProvisioningReport> push(\n                 os,\n                 columns.toArray(new String[columns.size()]))) {\n \n-            return streamPushExecutor.push(\n+            SyncopeStreamPushExecutor executor =\n+                    (SyncopeStreamPushExecutor) ApplicationContextProvider.getBeanFactory().\n+                            createBean(StreamPushJobDelegate.class, AbstractBeanDefinition.AUTOWIRE_BY_NAME, false);\n+            return executor.push(\n                     anyType,\n                     matching,\n                     columns,\n@@ -651,7 +657,10 @@ public List<ProvisioningReport> pull(final CSVPullSpec spec, final InputStream c\n                 throw new NotFoundException(\"Key column '\" + spec.getKeyColumn() + \"'\");\n             }\n \n-            return streamPullExecutor.pull(anyType,\n+            SyncopeStreamPullExecutor executor =\n+                    (SyncopeStreamPullExecutor) ApplicationContextProvider.getBeanFactory().\n+                            createBean(StreamPullJobDelegate.class, AbstractBeanDefinition.AUTOWIRE_BY_NAME, false);\n+            return executor.pull(anyType,\n                     spec.getKeyColumn(),\n                     columns,\n                     spec.getConflictResolutionAction(),"},{"sha":"0b89fad3380c6e777bee21490fa760f9a60d137a","filename":"core/provisioning-java/src/main/java/org/apache/syncope/core/provisioning/java/pushpull/SinglePullJobDelegate.java","status":"modified","additions":0,"deletions":2,"changes":2,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/95b56b8099933f1cf2f0145a33261d7cd10cc1ae/core%2Fprovisioning-java%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fprovisioning%2Fjava%2Fpushpull%2FSinglePullJobDelegate.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/95b56b8099933f1cf2f0145a33261d7cd10cc1ae/core%2Fprovisioning-java%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fprovisioning%2Fjava%2Fpushpull%2FSinglePullJobDelegate.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fprovisioning-java%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fprovisioning%2Fjava%2Fpushpull%2FSinglePullJobDelegate.java?ref=95b56b8099933f1cf2f0145a33261d7cd10cc1ae","patch":"@@ -52,9 +52,7 @@\n import org.apache.syncope.core.spring.ImplementationManager;\n import org.quartz.JobExecutionException;\n import org.springframework.beans.factory.annotation.Autowired;\n-import org.springframework.stereotype.Component;\n \n-@Component\n public class SinglePullJobDelegate extends PullJobDelegate implements SyncopeSinglePullExecutor {\n \n     @Autowired"},{"sha":"8a7f00db7cf43aaf0406e3ef9fde889a3835248d","filename":"core/provisioning-java/src/main/java/org/apache/syncope/core/provisioning/java/pushpull/SinglePushJobDelegate.java","status":"modified","additions":0,"deletions":2,"changes":2,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/95b56b8099933f1cf2f0145a33261d7cd10cc1ae/core%2Fprovisioning-java%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fprovisioning%2Fjava%2Fpushpull%2FSinglePushJobDelegate.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/95b56b8099933f1cf2f0145a33261d7cd10cc1ae/core%2Fprovisioning-java%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fprovisioning%2Fjava%2Fpushpull%2FSinglePushJobDelegate.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fprovisioning-java%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fprovisioning%2Fjava%2Fpushpull%2FSinglePushJobDelegate.java?ref=95b56b8099933f1cf2f0145a33261d7cd10cc1ae","patch":"@@ -41,9 +41,7 @@\n import org.apache.syncope.core.spring.ImplementationManager;\n import org.quartz.JobExecutionException;\n import org.springframework.beans.factory.annotation.Autowired;\n-import org.springframework.stereotype.Component;\n \n-@Component\n public class SinglePushJobDelegate extends PushJobDelegate implements SyncopeSinglePushExecutor {\n \n     @Autowired"},{"sha":"54e89fb1febb43c242281e3230307492996e1301","filename":"core/provisioning-java/src/main/java/org/apache/syncope/core/provisioning/java/pushpull/stream/StreamPullJobDelegate.java","status":"modified","additions":0,"deletions":2,"changes":2,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/95b56b8099933f1cf2f0145a33261d7cd10cc1ae/core%2Fprovisioning-java%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fprovisioning%2Fjava%2Fpushpull%2Fstream%2FStreamPullJobDelegate.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/95b56b8099933f1cf2f0145a33261d7cd10cc1ae/core%2Fprovisioning-java%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fprovisioning%2Fjava%2Fpushpull%2Fstream%2FStreamPullJobDelegate.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fprovisioning-java%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fprovisioning%2Fjava%2Fpushpull%2Fstream%2FStreamPullJobDelegate.java?ref=95b56b8099933f1cf2f0145a33261d7cd10cc1ae","patch":"@@ -53,14 +53,12 @@\n import org.apache.syncope.core.spring.ImplementationManager;\n import org.quartz.JobExecutionException;\n import org.springframework.beans.factory.annotation.Autowired;\n-import org.springframework.stereotype.Component;\n import org.apache.syncope.core.provisioning.api.pushpull.stream.SyncopeStreamPullExecutor;\n import org.apache.syncope.core.provisioning.java.pushpull.PullJobDelegate;\n import org.apache.syncope.core.provisioning.java.utils.MappingUtils;\n import org.apache.syncope.core.spring.security.SecureRandomUtils;\n import org.identityconnectors.framework.common.objects.ObjectClass;\n \n-@Component\n public class StreamPullJobDelegate extends PullJobDelegate implements SyncopeStreamPullExecutor {\n \n     @Autowired"},{"sha":"79fa6e4ec94ee877c6de63d2b8b7e4a4c31b7662","filename":"core/provisioning-java/src/main/java/org/apache/syncope/core/provisioning/java/pushpull/stream/StreamPushJobDelegate.java","status":"modified","additions":0,"deletions":2,"changes":2,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/95b56b8099933f1cf2f0145a33261d7cd10cc1ae/core%2Fprovisioning-java%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fprovisioning%2Fjava%2Fpushpull%2Fstream%2FStreamPushJobDelegate.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/95b56b8099933f1cf2f0145a33261d7cd10cc1ae/core%2Fprovisioning-java%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fprovisioning%2Fjava%2Fpushpull%2Fstream%2FStreamPushJobDelegate.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fprovisioning-java%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fprovisioning%2Fjava%2Fpushpull%2Fstream%2FStreamPushJobDelegate.java?ref=95b56b8099933f1cf2f0145a33261d7cd10cc1ae","patch":"@@ -50,9 +50,7 @@\n import org.quartz.JobExecutionException;\n import org.springframework.beans.factory.annotation.Autowired;\n import org.springframework.beans.factory.support.AbstractBeanDefinition;\n-import org.springframework.stereotype.Component;\n \n-@Component\n public class StreamPushJobDelegate extends PushJobDelegate implements SyncopeStreamPushExecutor {\n \n     @Autowired"},{"sha":"a47bb75ec85c88ad039cf9168e31f33d3caee650","filename":"core/provisioning-java/src/test/java/org/apache/syncope/core/provisioning/java/pushpull/stream/StreamPullJobDelegateTest.java","status":"modified","additions":15,"deletions":4,"changes":19,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/95b56b8099933f1cf2f0145a33261d7cd10cc1ae/core%2Fprovisioning-java%2Fsrc%2Ftest%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fprovisioning%2Fjava%2Fpushpull%2Fstream%2FStreamPullJobDelegateTest.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/95b56b8099933f1cf2f0145a33261d7cd10cc1ae/core%2Fprovisioning-java%2Fsrc%2Ftest%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fprovisioning%2Fjava%2Fpushpull%2Fstream%2FStreamPullJobDelegateTest.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fprovisioning-java%2Fsrc%2Ftest%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fprovisioning%2Fjava%2Fpushpull%2Fstream%2FStreamPullJobDelegateTest.java?ref=95b56b8099933f1cf2f0145a33261d7cd10cc1ae","patch":"@@ -40,24 +40,35 @@\n import org.apache.syncope.common.rest.api.beans.CSVPullSpec;\n import org.apache.syncope.core.provisioning.api.pushpull.stream.SyncopeStreamPullExecutor;\n import org.apache.syncope.core.provisioning.java.AbstractTest;\n+import org.apache.syncope.core.spring.ApplicationContextProvider;\n import org.apache.syncope.core.spring.security.AuthContextUtils;\n import org.junit.jupiter.api.Test;\n import org.quartz.JobExecutionException;\n import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.beans.factory.support.AbstractBeanDefinition;\n import org.springframework.transaction.annotation.Transactional;\n \n @Transactional(\"Master\")\n public class StreamPullJobDelegateTest extends AbstractTest {\n \n-    @Autowired\n-    private SyncopeStreamPullExecutor streamPullExecutor;\n-\n     @Autowired\n     private AnyTypeDAO anyTypeDAO;\n \n     @Autowired\n     private UserDAO userDAO;\n \n+    private SyncopeStreamPullExecutor executor;\n+\n+    private SyncopeStreamPullExecutor executor() {\n+        synchronized (this) {\n+            if (executor == null) {\n+                executor = (SyncopeStreamPullExecutor) ApplicationContextProvider.getBeanFactory().\n+                        createBean(StreamPullJobDelegate.class, AbstractBeanDefinition.AUTOWIRE_BY_NAME, false);\n+            }\n+        }\n+        return executor;\n+    }\n+\n     @Test\n     public void pull() throws JobExecutionException, IOException {\n         List<String> columns = List.of(\n@@ -96,7 +107,7 @@ public void pull() throws JobExecutionException, IOException {\n                 List<String> csvColumns = connector.getColumns(new CSVPullSpec());\n                 assertEquals(columns, csvColumns);\n \n-                return streamPullExecutor.pull(\n+                return executor().pull(\n                         anyTypeDAO.findUser(),\n                         \"username\",\n                         columns,"},{"sha":"e1274608dd83ff5bf0f98f964f8a94babbc29276","filename":"core/provisioning-java/src/test/java/org/apache/syncope/core/provisioning/java/pushpull/stream/StreamPushJobDelegateTest.java","status":"modified","additions":15,"deletions":4,"changes":19,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/95b56b8099933f1cf2f0145a33261d7cd10cc1ae/core%2Fprovisioning-java%2Fsrc%2Ftest%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fprovisioning%2Fjava%2Fpushpull%2Fstream%2FStreamPushJobDelegateTest.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/95b56b8099933f1cf2f0145a33261d7cd10cc1ae/core%2Fprovisioning-java%2Fsrc%2Ftest%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fprovisioning%2Fjava%2Fpushpull%2Fstream%2FStreamPushJobDelegateTest.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fprovisioning-java%2Fsrc%2Ftest%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fprovisioning%2Fjava%2Fpushpull%2Fstream%2FStreamPushJobDelegateTest.java?ref=95b56b8099933f1cf2f0145a33261d7cd10cc1ae","patch":"@@ -40,23 +40,34 @@\n import org.apache.syncope.core.persistence.api.dao.UserDAO;\n import org.apache.syncope.core.provisioning.api.pushpull.stream.SyncopeStreamPushExecutor;\n import org.apache.syncope.core.provisioning.java.AbstractTest;\n+import org.apache.syncope.core.spring.ApplicationContextProvider;\n import org.apache.syncope.core.spring.security.AuthContextUtils;\n import org.junit.jupiter.api.Test;\n import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.beans.factory.support.AbstractBeanDefinition;\n import org.springframework.transaction.annotation.Transactional;\n \n @Transactional(\"Master\")\n public class StreamPushJobDelegateTest extends AbstractTest {\n \n-    @Autowired\n-    private SyncopeStreamPushExecutor streamPushExecutor;\n-\n     @Autowired\n     private AnyTypeDAO anyTypeDAO;\n \n     @Autowired\n     private UserDAO userDAO;\n \n+    private SyncopeStreamPushExecutor executor;\n+\n+    private SyncopeStreamPushExecutor executor() {\n+        synchronized (this) {\n+            if (executor == null) {\n+                executor = (SyncopeStreamPushExecutor) ApplicationContextProvider.getBeanFactory().\n+                        createBean(StreamPushJobDelegate.class, AbstractBeanDefinition.AUTOWIRE_BY_NAME, false);\n+            }\n+        }\n+        return executor;\n+    }\n+\n     @Test\n     public void push() throws IOException {\n         PipedInputStream in = new PipedInputStream();\n@@ -74,7 +85,7 @@ public void push() throws IOException {\n                     null,\n                     os)) {\n \n-                return streamPushExecutor.push(\n+                return executor().push(\n                         anyTypeDAO.findUser(),\n                         userDAO.findAll(1, 100),\n                         List.of(\"username\", \"firstname\", \"surname\", \"email\", \"status\", \"loginDate\"),"}]}