{"sha":"16246411e8a8eccf1c424f4e0944ed763fbd0b05","node_id":"MDY6Q29tbWl0NjM2ODc5MDYyOjE2MjQ2NDExZThhOGVjY2YxYzQyNGY0ZTA5NDRlZDc2M2ZiZDBiMDU=","commit":{"author":{"name":"Andrea Patricelli","email":"andreapatricelli@apache.org","date":"2020-04-15T15:02:38Z"},"committer":{"name":"Francesco Chicchiricc√≤","email":"ilgrosso@apache.org","date":"2020-04-15T15:58:16Z"},"message":"[SYNCOPE-1500] init destionation realm for reconciliation and pull tasks","tree":{"sha":"9d5057d1d1abd0e3dd82048923b9c0201cfa97e8","url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/git/trees/9d5057d1d1abd0e3dd82048923b9c0201cfa97e8"},"url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/git/commits/16246411e8a8eccf1c424f4e0944ed763fbd0b05","comment_count":0,"verification":{"verified":false,"reason":"unsigned","signature":null,"payload":null}},"url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/16246411e8a8eccf1c424f4e0944ed763fbd0b05","html_url":"https://github.com/EnricoDAlessandro97UNI/syncope/commit/16246411e8a8eccf1c424f4e0944ed763fbd0b05","comments_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/16246411e8a8eccf1c424f4e0944ed763fbd0b05/comments","author":{"login":"andrea-patricelli","id":3763111,"node_id":"MDQ6VXNlcjM3NjMxMTE=","avatar_url":"https://avatars.githubusercontent.com/u/3763111?v=4","gravatar_id":"","url":"https://api.github.com/users/andrea-patricelli","html_url":"https://github.com/andrea-patricelli","followers_url":"https://api.github.com/users/andrea-patricelli/followers","following_url":"https://api.github.com/users/andrea-patricelli/following{/other_user}","gists_url":"https://api.github.com/users/andrea-patricelli/gists{/gist_id}","starred_url":"https://api.github.com/users/andrea-patricelli/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/andrea-patricelli/subscriptions","organizations_url":"https://api.github.com/users/andrea-patricelli/orgs","repos_url":"https://api.github.com/users/andrea-patricelli/repos","events_url":"https://api.github.com/users/andrea-patricelli/events{/privacy}","received_events_url":"https://api.github.com/users/andrea-patricelli/received_events","type":"User","site_admin":false},"committer":{"login":"ilgrosso","id":1064664,"node_id":"MDQ6VXNlcjEwNjQ2NjQ=","avatar_url":"https://avatars.githubusercontent.com/u/1064664?v=4","gravatar_id":"","url":"https://api.github.com/users/ilgrosso","html_url":"https://github.com/ilgrosso","followers_url":"https://api.github.com/users/ilgrosso/followers","following_url":"https://api.github.com/users/ilgrosso/following{/other_user}","gists_url":"https://api.github.com/users/ilgrosso/gists{/gist_id}","starred_url":"https://api.github.com/users/ilgrosso/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ilgrosso/subscriptions","organizations_url":"https://api.github.com/users/ilgrosso/orgs","repos_url":"https://api.github.com/users/ilgrosso/repos","events_url":"https://api.github.com/users/ilgrosso/events{/privacy}","received_events_url":"https://api.github.com/users/ilgrosso/received_events","type":"User","site_admin":false},"parents":[{"sha":"837f942cd430756edf25b294d6c0fcdfd1b2bae9","url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/837f942cd430756edf25b294d6c0fcdfd1b2bae9","html_url":"https://github.com/EnricoDAlessandro97UNI/syncope/commit/837f942cd430756edf25b294d6c0fcdfd1b2bae9"}],"stats":{"total":65,"additions":46,"deletions":19},"files":[{"sha":"831291a2ac069730d4896f600e514394321d02f4","filename":"client/idm/console/src/main/java/org/apache/syncope/client/console/panels/ConnObjectListViewPanel.java","status":"modified","additions":14,"deletions":13,"changes":27,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/16246411e8a8eccf1c424f4e0944ed763fbd0b05/client%2Fidm%2Fconsole%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fclient%2Fconsole%2Fpanels%2FConnObjectListViewPanel.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/16246411e8a8eccf1c424f4e0944ed763fbd0b05/client%2Fidm%2Fconsole%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fclient%2Fconsole%2Fpanels%2FConnObjectListViewPanel.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/client%2Fidm%2Fconsole%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fclient%2Fconsole%2Fpanels%2FConnObjectListViewPanel.java?ref=16246411e8a8eccf1c424f4e0944ed763fbd0b05","patch":"@@ -23,7 +23,6 @@\n import de.agilecoders.wicket.core.markup.html.bootstrap.components.TooltipConfig;\n import java.io.Serializable;\n import java.util.ArrayList;\n-import java.util.Collections;\n import java.util.List;\n import java.util.Optional;\n import org.apache.commons.lang3.StringUtils;\n@@ -104,18 +103,17 @@ protected ConnObjectListViewPanel(\n         final Model<Integer> model = Model.of(-1);\n         final StringResourceModel res = new StringResourceModel(\"search.result\", this, new Model<>(anyType));\n \n-        final Accordion accordion = new Accordion(\"accordionPanel\",\n-                Collections.<ITab>singletonList(new AbstractTab(res) {\n+        final Accordion accordion = new Accordion(\"accordionPanel\", List.of(new AbstractTab(res) {\n \n-                    private static final long serialVersionUID = 1037272333056449377L;\n+            private static final long serialVersionUID = 1037272333056449377L;\n \n-                    @Override\n-                    public WebMarkupContainer getPanel(final String panelId) {\n-                        searchPanel = getSearchPanel(panelId, anyType);\n-                        return searchPanel;\n-                    }\n+            @Override\n+            public WebMarkupContainer getPanel(final String panelId) {\n+                searchPanel = getSearchPanel(panelId, anyType);\n+                return searchPanel;\n+            }\n \n-                }), model) {\n+        }), model) {\n \n             private static final long serialVersionUID = 6581261306163L;\n \n@@ -217,15 +215,17 @@ public void onClick(final AjaxRequestTarget target, final ConnObjectTO modelObje\n                 @Override\n                 public void onClick(final AjaxRequestTarget target, final ConnObjectTO modelObject) {\n                     String connObjectKeyValue = modelObject.getAttr(ConnIdSpecialName.UID).get().getValues().get(0);\n-                    String anyKey = ReconciliationRestClient.status(new ReconQuery.Builder(anyType, resource.getKey()).\n-                            connObjectKeyValue(connObjectKeyValue).build()).getAnyKey();\n+                    ReconStatus status = ReconciliationRestClient.status(\n+                            new ReconQuery.Builder(anyType, resource.getKey()).\n+                                    connObjectKeyValue(connObjectKeyValue).build());\n \n                     pullConnObject(\n                             connObjectKeyValue,\n                             target,\n                             resource.getKey(),\n                             anyType,\n-                            StringUtils.isNotBlank(anyKey),\n+                            status.getRealm(),\n+                            StringUtils.isNotBlank(status.getAnyKey()),\n                             pageRef);\n                 }\n             }, ActionLink.ActionType.RECONCILIATION_PULL, IdRepoEntitlement.TASK_EXECUTE);\n@@ -276,6 +276,7 @@ protected abstract void pullConnObject(\n             AjaxRequestTarget target,\n             String resource,\n             String anyType,\n+            String realm,\n             boolean isOnSyncope,\n             PageReference pageRef);\n "},{"sha":"47350fbdf55407007cf86ed74e737400208fdbb9","filename":"client/idm/console/src/main/java/org/apache/syncope/client/console/panels/ConnObjects.java","status":"modified","additions":4,"deletions":1,"changes":5,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/16246411e8a8eccf1c424f4e0944ed763fbd0b05/client%2Fidm%2Fconsole%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fclient%2Fconsole%2Fpanels%2FConnObjects.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/16246411e8a8eccf1c424f4e0944ed763fbd0b05/client%2Fidm%2Fconsole%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fclient%2Fconsole%2Fpanels%2FConnObjects.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/client%2Fidm%2Fconsole%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fclient%2Fconsole%2Fpanels%2FConnObjects.java?ref=16246411e8a8eccf1c424f4e0944ed763fbd0b05","patch":"@@ -132,15 +132,18 @@ protected void pullConnObject(\n                 final AjaxRequestTarget target,\n                 final String resource,\n                 final String anyType,\n+                final String realm,\n                 final boolean isOnSyncope,\n                 final PageReference pageRef) {\n             anyTypes.setEnabled(false);\n             target.add(anyTypes);\n \n+            final PullTaskTO pullTaskTO = new PullTaskTO();\n+            pullTaskTO.setDestinationRealm(realm);\n             connObjects.next(\"PULL \" + resource,\n                     new ReconTaskPanel(\n                             resource,\n-                            new PullTaskTO(),\n+                            pullTaskTO,\n                             anyType,\n                             null,\n                             connObjectKeyValue,"},{"sha":"14e6cf4b659042fd7dc9b0a4ae314e2b1337cfd5","filename":"client/idm/console/src/main/java/org/apache/syncope/client/console/status/ReconTaskPanel.java","status":"modified","additions":7,"deletions":4,"changes":11,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/16246411e8a8eccf1c424f4e0944ed763fbd0b05/client%2Fidm%2Fconsole%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fclient%2Fconsole%2Fstatus%2FReconTaskPanel.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/16246411e8a8eccf1c424f4e0944ed763fbd0b05/client%2Fidm%2Fconsole%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fclient%2Fconsole%2Fstatus%2FReconTaskPanel.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/client%2Fidm%2Fconsole%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fclient%2Fconsole%2Fstatus%2FReconTaskPanel.java?ref=16246411e8a8eccf1c424f4e0944ed763fbd0b05","patch":"@@ -22,6 +22,7 @@\n import java.util.Iterator;\n import java.util.List;\n import java.util.stream.Collectors;\n+import org.apache.commons.lang3.StringUtils;\n import org.apache.syncope.client.console.SyncopeConsoleSession;\n import org.apache.syncope.client.ui.commons.Constants;\n import org.apache.syncope.client.console.commons.RealmsUtils;\n@@ -135,14 +136,16 @@ protected Iterator<String> getChoices(final String input) {\n                 }\n             };\n \n-            form.add(realm);\n             realm.addRequiredLabel();\n             realm.setOutputMarkupId(true);\n-\n-            if (isOnSyncope) {\n+            // add a default destination realm if missing in the task\n+            if (StringUtils.isBlank(PullTaskTO.class.cast(taskTO).getDestinationRealm())) {\n                 realm.getField().setModelObject(SyncopeConstants.ROOT_REALM);\n-                realm.setVisible(false);\n             }\n+            if (isOnSyncope) {\n+                realm.setEnabled(false);\n+            }\n+            form.add(realm);\n         }\n \n         AjaxPalettePanel<String> actions = new AjaxPalettePanel.Builder<String>()."},{"sha":"4885cee3d0e5d60cb7a2b04f51ff5e01086629fe","filename":"client/idrepo/console/src/main/java/org/apache/syncope/client/console/tasks/SchedTaskDirectoryPanel.java","status":"modified","additions":1,"deletions":1,"changes":2,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/16246411e8a8eccf1c424f4e0944ed763fbd0b05/client%2Fidrepo%2Fconsole%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fclient%2Fconsole%2Ftasks%2FSchedTaskDirectoryPanel.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/16246411e8a8eccf1c424f4e0944ed763fbd0b05/client%2Fidrepo%2Fconsole%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fclient%2Fconsole%2Ftasks%2FSchedTaskDirectoryPanel.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/client%2Fidrepo%2Fconsole%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fclient%2Fconsole%2Ftasks%2FSchedTaskDirectoryPanel.java?ref=16246411e8a8eccf1c424f4e0944ed763fbd0b05","patch":"@@ -103,7 +103,7 @@ protected SchedTaskDirectoryPanel(\n         try {\n             schedTaskTO = reference.getDeclaredConstructor().newInstance();\n         } catch (Exception e) {\n-            LOG.error(\"Falure instantiating task\", e);\n+            LOG.error(\"Failure instantiating task\", e);\n         }\n \n         this.addNewItemPanelBuilder(new SchedTaskWizardBuilder<>(taskType, schedTaskTO, pageRef), true);"},{"sha":"60b127365ef14566db7438733cbe7c278b88f22e","filename":"client/idrepo/console/src/main/java/org/apache/syncope/client/console/tasks/SchedTaskWizardBuilder.java","status":"modified","additions":6,"deletions":0,"changes":6,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/16246411e8a8eccf1c424f4e0944ed763fbd0b05/client%2Fidrepo%2Fconsole%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fclient%2Fconsole%2Ftasks%2FSchedTaskWizardBuilder.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/16246411e8a8eccf1c424f4e0944ed763fbd0b05/client%2Fidrepo%2Fconsole%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fclient%2Fconsole%2Ftasks%2FSchedTaskWizardBuilder.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/client%2Fidrepo%2Fconsole%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fclient%2Fconsole%2Ftasks%2FSchedTaskWizardBuilder.java?ref=16246411e8a8eccf1c424f4e0944ed763fbd0b05","patch":"@@ -23,6 +23,7 @@\n import java.util.List;\n import java.util.stream.Collectors;\n import org.apache.syncope.client.console.SyncopeWebApplication;\n+import org.apache.commons.lang3.StringUtils;\n import org.apache.syncope.client.console.commons.RealmsUtils;\n import org.apache.syncope.client.ui.commons.Constants;\n import org.apache.syncope.client.console.rest.RealmRestClient;\n@@ -34,6 +35,7 @@\n import org.apache.syncope.client.console.wicket.markup.html.form.AjaxSearchFieldPanel;\n import org.apache.syncope.client.console.wizards.BaseAjaxWizardBuilder;\n import org.apache.syncope.client.ui.commons.markup.html.form.AjaxTextFieldPanel;\n+import org.apache.syncope.common.lib.SyncopeConstants;\n import org.apache.syncope.common.lib.to.ProvisioningTaskTO;\n import org.apache.syncope.common.lib.to.SchedTaskTO;\n import org.apache.syncope.common.lib.to.PullTaskTO;\n@@ -206,6 +208,10 @@ protected Iterator<String> getChoices(final String input) {\n \n             if (taskTO instanceof PullTaskTO) {\n                 destinationRealm.addRequiredLabel();\n+                if (StringUtils.isBlank(PullTaskTO.class.cast(taskTO).getDestinationRealm())) {\n+                    // add a default destination realm if missing in the task\n+                    destinationRealm.setModelObject(SyncopeConstants.ROOT_REALM);\n+                }\n             }\n             pullTaskSpecifics.add(destinationRealm);\n "},{"sha":"a78f4b2afa8171638fc457ff6ec77227fcfa1cea","filename":"common/idm/lib/src/main/java/org/apache/syncope/common/lib/to/ReconStatus.java","status":"modified","additions":11,"deletions":0,"changes":11,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/16246411e8a8eccf1c424f4e0944ed763fbd0b05/common%2Fidm%2Flib%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcommon%2Flib%2Fto%2FReconStatus.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/16246411e8a8eccf1c424f4e0944ed763fbd0b05/common%2Fidm%2Flib%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcommon%2Flib%2Fto%2FReconStatus.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/common%2Fidm%2Flib%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcommon%2Flib%2Fto%2FReconStatus.java?ref=16246411e8a8eccf1c424f4e0944ed763fbd0b05","patch":"@@ -38,6 +38,8 @@ public class ReconStatus implements Serializable {\n \n     private String anyKey;\n \n+    private String realm;\n+\n     private MatchType matchType;\n \n     private ConnObjectTO onSyncope;\n@@ -62,6 +64,15 @@ public void setAnyKey(final String anyKey) {\n         this.anyKey = anyKey;\n     }\n \n+    @Schema(accessMode = Schema.AccessMode.READ_ONLY)\n+    public String getRealm() {\n+        return realm;\n+    }\n+\n+    public void setRealm(final String realm) {\n+        this.realm = realm;\n+    }\n+\n     @Schema(accessMode = Schema.AccessMode.READ_ONLY)\n     public MatchType getMatchType() {\n         return matchType;"},{"sha":"8c8c23ec994f2ea455f47078fef834e8ed9ec790","filename":"core/idm/logic/src/main/java/org/apache/syncope/core/logic/ReconciliationLogic.java","status":"modified","additions":3,"deletions":0,"changes":3,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/16246411e8a8eccf1c424f4e0944ed763fbd0b05/core%2Fidm%2Flogic%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Flogic%2FReconciliationLogic.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/16246411e8a8eccf1c424f4e0944ed763fbd0b05/core%2Fidm%2Flogic%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Flogic%2FReconciliationLogic.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fidm%2Flogic%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Flogic%2FReconciliationLogic.java?ref=16246411e8a8eccf1c424f4e0944ed763fbd0b05","patch":"@@ -225,11 +225,13 @@ public ReconStatus status(final ReconQuery query) {\n                             status.setMatchType(MatchType.ANY);\n                             status.setAnyTypeKind(match.getAny().getType().getKind());\n                             status.setAnyKey(match.getAny().getKey());\n+                            status.setRealm(match.getAny().getRealm().getFullPath());\n                             status.setOnSyncope(getOnSyncope(match.getAny(), connObjectKeyItem, provision));\n                         } else if (match.getLinkedAccount() != null) {\n                             status.setMatchType(MatchType.LINKED_ACCOUNT);\n                             status.setAnyTypeKind(AnyTypeKind.USER);\n                             status.setAnyKey(match.getLinkedAccount().getOwner().getKey());\n+                            status.setRealm(match.getAny().getRealm().getFullPath());\n                             status.setOnSyncope(getOnSyncope(match.getLinkedAccount(), connObjectKeyItem, provision));\n                         }\n                     });\n@@ -254,6 +256,7 @@ public ReconStatus status(final ReconQuery query) {\n             status.setMatchType(MatchType.ANY);\n             status.setAnyTypeKind(any.getType().getKind());\n             status.setAnyKey(any.getKey());\n+            status.setRealm(any.getRealm().getFullPath());\n             status.setOnSyncope(getOnSyncope(any, connObjectKeyItem, provision));\n \n             List<ConnectorObject> connObjs = outboundMatcher.match("}]}