{"sha":"49dc1198c9944da6d4f9510fc21f44fc180a96ad","node_id":"MDY6Q29tbWl0NjM2ODc5MDYyOjQ5ZGMxMTk4Yzk5NDRkYTZkNGY5NTEwZmMyMWY0NGZjMTgwYTk2YWQ=","commit":{"author":{"name":"Francesco Chicchiriccò","email":"ilgrosso@apache.org","date":"2013-01-07T17:19:13Z"},"committer":{"name":"Francesco Chicchiriccò","email":"ilgrosso@apache.org","date":"2013-01-07T17:19:13Z"},"message":"[SYNCOPE-263] Merge from 1_0_X\n\ngit-svn-id: https://svn.apache.org/repos/asf/syncope/trunk@1429908 13f79535-47bb-0310-9956-ffa450edef68","tree":{"sha":"fda67d23bf55c9afb9af9d39264e56f3f7b3d2cf","url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/git/trees/fda67d23bf55c9afb9af9d39264e56f3f7b3d2cf"},"url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/git/commits/49dc1198c9944da6d4f9510fc21f44fc180a96ad","comment_count":0,"verification":{"verified":false,"reason":"unsigned","signature":null,"payload":null}},"url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/49dc1198c9944da6d4f9510fc21f44fc180a96ad","html_url":"https://github.com/EnricoDAlessandro97UNI/syncope/commit/49dc1198c9944da6d4f9510fc21f44fc180a96ad","comments_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/49dc1198c9944da6d4f9510fc21f44fc180a96ad/comments","author":{"login":"ilgrosso","id":1064664,"node_id":"MDQ6VXNlcjEwNjQ2NjQ=","avatar_url":"https://avatars.githubusercontent.com/u/1064664?v=4","gravatar_id":"","url":"https://api.github.com/users/ilgrosso","html_url":"https://github.com/ilgrosso","followers_url":"https://api.github.com/users/ilgrosso/followers","following_url":"https://api.github.com/users/ilgrosso/following{/other_user}","gists_url":"https://api.github.com/users/ilgrosso/gists{/gist_id}","starred_url":"https://api.github.com/users/ilgrosso/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ilgrosso/subscriptions","organizations_url":"https://api.github.com/users/ilgrosso/orgs","repos_url":"https://api.github.com/users/ilgrosso/repos","events_url":"https://api.github.com/users/ilgrosso/events{/privacy}","received_events_url":"https://api.github.com/users/ilgrosso/received_events","type":"User","site_admin":false},"committer":{"login":"ilgrosso","id":1064664,"node_id":"MDQ6VXNlcjEwNjQ2NjQ=","avatar_url":"https://avatars.githubusercontent.com/u/1064664?v=4","gravatar_id":"","url":"https://api.github.com/users/ilgrosso","html_url":"https://github.com/ilgrosso","followers_url":"https://api.github.com/users/ilgrosso/followers","following_url":"https://api.github.com/users/ilgrosso/following{/other_user}","gists_url":"https://api.github.com/users/ilgrosso/gists{/gist_id}","starred_url":"https://api.github.com/users/ilgrosso/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ilgrosso/subscriptions","organizations_url":"https://api.github.com/users/ilgrosso/orgs","repos_url":"https://api.github.com/users/ilgrosso/repos","events_url":"https://api.github.com/users/ilgrosso/events{/privacy}","received_events_url":"https://api.github.com/users/ilgrosso/received_events","type":"User","site_admin":false},"parents":[{"sha":"c050cfe4cc6c4123517bc0fbcbc4eaf4a195f5ac","url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/c050cfe4cc6c4123517bc0fbcbc4eaf4a195f5ac","html_url":"https://github.com/EnricoDAlessandro97UNI/syncope/commit/c050cfe4cc6c4123517bc0fbcbc4eaf4a195f5ac"}],"stats":{"total":53,"additions":45,"deletions":8},"files":[{"sha":"4890ebed2595f05a764e2d435a22f411629c8c5c","filename":"core/src/main/java/org/apache/syncope/core/notification/NotificationJob.java","status":"modified","additions":13,"deletions":7,"changes":20,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/49dc1198c9944da6d4f9510fc21f44fc180a96ad/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fnotification%2FNotificationJob.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/49dc1198c9944da6d4f9510fc21f44fc180a96ad/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fnotification%2FNotificationJob.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fnotification%2FNotificationJob.java?ref=49dc1198c9944da6d4f9510fc21f44fc180a96ad","patch":"@@ -24,7 +24,6 @@\n import javax.mail.internet.MimeMessage;\n import org.apache.commons.lang.StringUtils;\n import org.apache.syncope.core.audit.AuditManager;\n-import org.apache.syncope.core.notification.NotificationManager;\n import org.apache.syncope.core.persistence.beans.NotificationTask;\n import org.apache.syncope.core.persistence.beans.TaskExec;\n import org.apache.syncope.core.persistence.dao.ConfDAO;\n@@ -116,21 +115,28 @@ public TaskExec executeSingle(final NotificationTask task) {\n                 || StringUtils.isBlank(task.getSubject()) || task.getRecipients().isEmpty()\n                 || StringUtils.isBlank(task.getHtmlBody()) || StringUtils.isBlank(task.getTextBody())) {\n \n-            String message = \"Could not fetch all required information for \" + \"sending e-mails:\\n\" + smtpHost + \":\"\n-                    + smtpPort + \"\\n\" + task.getRecipients() + \"\\n\" + task.getSender() + \"\\n\" + task.getSubject()\n-                    + \"\\n\" + task.getHtmlBody() + \"\\n\" + task.getTextBody();\n+            String message = \"Could not fetch all required information for sending e-mails:\\n\"\n+                    + smtpHost + \":\" + smtpPort + \"\\n\"\n+                    + task.getRecipients() + \"\\n\"\n+                    + task.getSender() + \"\\n\"\n+                    + task.getSubject() + \"\\n\"\n+                    + task.getHtmlBody() + \"\\n\"\n+                    + task.getTextBody();\n             LOG.error(message);\n \n             execution.setStatus(Status.NOT_SENT.name());\n \n             if (task.getTraceLevel().ordinal() >= TraceLevel.FAILURES.ordinal()) {\n-\n                 execution.setMessage(message);\n             }\n         } else {\n             if (LOG.isDebugEnabled()) {\n-                LOG.debug(\"About to send e-mails:\\n\" + smtpHost + \":\" + smtpPort + \"\\n\" + task.getRecipients() + \"\\n\"\n-                        + task.getSender() + \"\\n\" + task.getSubject() + \"\\n\" + task.getHtmlBody() + \"\\n\"\n+                LOG.debug(\"About to send e-mails:\\n\"\n+                        + smtpHost + \":\" + smtpPort + \"\\n\"\n+                        + task.getRecipients() + \"\\n\"\n+                        + task.getSender() + \"\\n\"\n+                        + task.getSubject() + \"\\n\"\n+                        + task.getHtmlBody() + \"\\n\"\n                         + task.getTextBody() + \"\\n\");\n             }\n "},{"sha":"1214114540f8958346b9ff4f7178f74dae4ab75e","filename":"core/src/main/java/org/apache/syncope/core/notification/NotificationManager.java","status":"modified","additions":6,"deletions":1,"changes":7,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/49dc1198c9944da6d4f9510fc21f44fc180a96ad/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fnotification%2FNotificationManager.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/49dc1198c9944da6d4f9510fc21f44fc180a96ad/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fnotification%2FNotificationManager.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fnotification%2FNotificationManager.java?ref=49dc1198c9944da6d4f9510fc21f44fc180a96ad","patch":"@@ -24,7 +24,6 @@\n import java.util.List;\n import java.util.Map;\n import java.util.Set;\n-\n import org.apache.syncope.core.connid.ConnObjectUtil;\n import org.apache.syncope.core.persistence.beans.AbstractAttributable;\n import org.apache.syncope.core.persistence.beans.Notification;\n@@ -160,6 +159,8 @@ private NotificationTask getNotificationTask(final Notification notification, fi\n         final Map<String, Object> model = new HashMap<String, Object>();\n         model.put(\"user\", userDataBinder.getUserTO(user));\n         model.put(\"syncopeConf\", this.findAllSyncopeConfs());\n+        model.put(\"recipients\", recipientEmails);\n+        model.put(\"events\", notification.getEvents());\n \n         String htmlBody;\n         String textBody;\n@@ -219,18 +220,22 @@ private String getRecipientEmail(\n             case Username:\n                 email = user.getUsername();\n                 break;\n+\n             case UserSchema:\n                 UAttr attr = user.getAttribute(recipientAttrName);\n                 email = attr == null || attr.getValuesAsStrings().isEmpty() ? null : attr.getValuesAsStrings().get(0);\n                 break;\n+\n             case UserVirtualSchema:\n                 UVirAttr virAttr = user.getVirtualAttribute(recipientAttrName);\n                 email = virAttr == null || virAttr.getValues().isEmpty() ? null : virAttr.getValues().get(0);\n                 break;\n+\n             case UserDerivedSchema:\n                 UDerAttr derAttr = user.getDerivedAttribute(recipientAttrName);\n                 email = derAttr == null ? null : derAttr.getValue(user.getAttributes());\n                 break;\n+\n             default:\n                 email = null;\n         }"},{"sha":"411cbb1838461ea1c197ba404b7f50ca900d19c2","filename":"core/src/main/resources/mailTemplates/optin.html.vm","status":"modified","additions":16,"deletions":0,"changes":16,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/49dc1198c9944da6d4f9510fc21f44fc180a96ad/core%2Fsrc%2Fmain%2Fresources%2FmailTemplates%2Foptin.html.vm","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/49dc1198c9944da6d4f9510fc21f44fc180a96ad/core%2Fsrc%2Fmain%2Fresources%2FmailTemplates%2Foptin.html.vm","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fsrc%2Fmain%2Fresources%2FmailTemplates%2Foptin.html.vm?ref=49dc1198c9944da6d4f9510fc21f44fc180a96ad","patch":"@@ -26,6 +26,22 @@ under the License.\n    Your email address is $user.getAttributeMap().get(\"email\").getValues().get(0).\n </p>\n \n+<p>\n+    This message was sent to the following recipients:\n+<ul>\n+#foreach($recipient in $recipients)\n+  <li>$recipient</i>\n+#end\n+</ul>\n+\n+becase one of the following events occurred:\n+<ul>\n+#foreach($event in $events)\n+  <li>$event</i>\n+#end\n+</ul>\n+</p>\n+\n #if(!$user.getMemberships().isEmpty())\n You have been provided with the following roles:\n <ul>"},{"sha":"d158cdb21a5ec91da9a5fd79942dcd2474ef07a6","filename":"core/src/main/resources/mailTemplates/optin.txt.vm","status":"modified","additions":10,"deletions":0,"changes":10,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/49dc1198c9944da6d4f9510fc21f44fc180a96ad/core%2Fsrc%2Fmain%2Fresources%2FmailTemplates%2Foptin.txt.vm","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/49dc1198c9944da6d4f9510fc21f44fc180a96ad/core%2Fsrc%2Fmain%2Fresources%2FmailTemplates%2Foptin.txt.vm","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fsrc%2Fmain%2Fresources%2FmailTemplates%2Foptin.txt.vm?ref=49dc1198c9944da6d4f9510fc21f44fc180a96ad","patch":"@@ -14,6 +14,16 @@ Hi $user.getAttributeMap().get(\"firstname\").getValues().get(0) $user.getAttribut\n Your username is $user.getUsername().\n Your email address is $user.getAttributeMap().get(\"email\").getValues().get(0).\n \n+This message was sent to the following recipients:\n+#foreach($recipient in $recipients)\n+   * $recipient\n+#end\n+\n+becase one of the following events occurred:\n+#foreach($event in $events)\n+  * $event\n+#end\n+\n #if(!$user.getMemberships().isEmpty())\n You have been provided with the following roles:\n #foreach($membership in $user.getMemberships())"}]}