{"sha":"d1aece968c383f3d7f23fcea2c57efa4b0fa490d","node_id":"MDY6Q29tbWl0NjM2ODc5MDYyOmQxYWVjZTk2OGMzODNmM2Q3ZjIzZmNlYTJjNTdlZmE0YjBmYTQ5MGQ=","commit":{"author":{"name":"Unknown","email":"unknown@apache.org","date":"2010-11-12T14:14:11Z"},"committer":{"name":"Unknown","email":"unknown@apache.org","date":"2010-11-12T14:14:11Z"},"message":"Fix on User's membership update\n\ngit-svn-id: https://svn.apache.org/repos/asf/incubator/syncope/trunk@1246631 13f79535-47bb-0310-9956-ffa450edef68","tree":{"sha":"908bf00e95ba215d5f05013c3386b8e7bebaaa6a","url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/git/trees/908bf00e95ba215d5f05013c3386b8e7bebaaa6a"},"url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/git/commits/d1aece968c383f3d7f23fcea2c57efa4b0fa490d","comment_count":0,"verification":{"verified":false,"reason":"unsigned","signature":null,"payload":null}},"url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/d1aece968c383f3d7f23fcea2c57efa4b0fa490d","html_url":"https://github.com/EnricoDAlessandro97UNI/syncope/commit/d1aece968c383f3d7f23fcea2c57efa4b0fa490d","comments_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/d1aece968c383f3d7f23fcea2c57efa4b0fa490d/comments","author":null,"committer":null,"parents":[{"sha":"7d3bef84084a81174fb40e0aae1ff3bccbc10831","url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/7d3bef84084a81174fb40e0aae1ff3bccbc10831","html_url":"https://github.com/EnricoDAlessandro97UNI/syncope/commit/7d3bef84084a81174fb40e0aae1ff3bccbc10831"}],"stats":{"total":39,"additions":27,"deletions":12},"files":[{"sha":"05d23dc21cf8877316fe46cf6cd8afe4bd0ca132","filename":"console/src/main/java/org/syncope/console/pages/MembershipModalPage.java","status":"modified","additions":10,"deletions":2,"changes":12,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/d1aece968c383f3d7f23fcea2c57efa4b0fa490d/console%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fconsole%2Fpages%2FMembershipModalPage.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/d1aece968c383f3d7f23fcea2c57efa4b0fa490d/console%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fconsole%2Fpages%2FMembershipModalPage.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/console%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fconsole%2Fpages%2FMembershipModalPage.java?ref=d1aece968c383f3d7f23fcea2c57efa4b0fa490d","patch":"@@ -1,5 +1,3 @@\n-package org.syncope.console.pages;\n-\n /*\n  *  Licensed under the Apache License, Version 2.0 (the \"License\");\n  *  you may not use this file except in compliance with the License.\n@@ -14,6 +12,7 @@\n  *  limitations under the License.\n  *  under the License.\n  */\n+package org.syncope.console.pages;\n \n import java.io.Serializable;\n import java.text.DateFormat;\n@@ -290,6 +289,8 @@ public void setupSchemaWrappers(boolean create, MembershipTO membershipTO) {\n \n         List<SchemaTO> schemas = schemaRestClient.getAllMemberhipSchemas();\n \n+        boolean found = false;\n+\n         if(create) {\n             for (SchemaTO schema : schemas) {\n                 schemaWrapper = new SchemaWrapper(schema);\n@@ -303,8 +304,15 @@ public void setupSchemaWrappers(boolean create, MembershipTO membershipTO) {\n                         schemaWrapper = new SchemaWrapper(schema);\n                         schemaWrapper.setValues(attribute.getValues());\n                         schemaWrappers.add(schemaWrapper);\n+                        found = true;\n                     }\n                 }\n+           if (!found) {\n+                schemaWrapper = new SchemaWrapper(schema);\n+                schemaWrappers.add(schemaWrapper);\n+            } else {\n+                found = false;\n+            }\n             }\n         }\n     }"},{"sha":"cc46dd484429a61f4ec1d3b53eda8f4c2bd9a66c","filename":"console/src/main/java/org/syncope/console/pages/UserModalPage.java","status":"modified","additions":17,"deletions":10,"changes":27,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/d1aece968c383f3d7f23fcea2c57efa4b0fa490d/console%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fconsole%2Fpages%2FUserModalPage.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/d1aece968c383f3d7f23fcea2c57efa4b0fa490d/console%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fconsole%2Fpages%2FUserModalPage.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/console%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fconsole%2Fpages%2FUserModalPage.java?ref=d1aece968c383f3d7f23fcea2c57efa4b0fa490d","patch":"@@ -781,7 +781,8 @@ public void searchAndUpdateAttribute(AttributeTO attributeTO) {\n         }\n     }\n \n-    if (!found & !changed && !attributeTO.isReadonly() && attributeTO.getValues() != null) {\n+    if (!found & !changed && !attributeTO.isReadonly() &&\n+            attributeTO.getValues() != null) {\n \n         if(attributeTO.getValues().iterator().next() != null ){\n             attributeMod.setValuesToBeAdded(attributeTO.getValues());\n@@ -803,9 +804,8 @@ public void searchAndUpdateAttribute(AttributeTO attributeTO) {\n public void searchAndAddResource(String resource) {\n     boolean found = false;\n \n-    /*Check if the current resource was existent before the update and in this case\n-      just ignore it\n-     */\n+    /* Check if the current resource was existent before the update and in this\n+     case just ignore it */\n     for (String oldResource : oldUser.getResources()) {\n         if (resource.equals(oldResource)) {\n             found = true;\n@@ -829,9 +829,8 @@ public void searchAndAddResource(String resource) {\n public void searchAndDropResource(String resource, UserTO userTO) {\n     boolean found = false;\n \n-    /*Check if the current resource was existent before the update and in this case\n-      just ignore it\n-     */\n+    /*Check if the current resource was existent before the update and in this \n+     case just ignore it */\n     for (String newResource : userTO.getResources()) {\n         if (resource.equals(newResource)) {\n             found = true;\n@@ -851,6 +850,7 @@ public void searchAndDropResource(String resource, UserTO userTO) {\n  */\n public void searchAndUpdateMembership(MembershipTO newMembership) {\n     boolean found = false;\n+    boolean attrFound = false;\n \n     MembershipMod membershipMod = new MembershipMod();\n     membershipMod.setRole(newMembership.getRoleId());\n@@ -861,8 +861,8 @@ public void searchAndUpdateMembership(MembershipTO newMembership) {\n     for (MembershipTO oldMembership : oldUser.getMemberships()) {\n         if (newMembership.getRoleId() == oldMembership.getRoleId()) {\n \n-            for (AttributeTO oldAttribute : oldMembership.getAttributes()) {\n-                for (AttributeTO newAttribute : newMembership.getAttributes()) {\n+            for (AttributeTO newAttribute : newMembership.getAttributes()) {\n+                for (AttributeTO oldAttribute : oldMembership.getAttributes()) {\n \n                     if(oldAttribute.getSchema().equals(newAttribute.getSchema())) {\n \n@@ -873,10 +873,17 @@ public void searchAndUpdateMembership(MembershipTO newMembership) {\n \n                         membershipMod.addAttributeToBeUpdated(attributeMod);\n                         //membershipMod.addAttributeToBeRemoved(oldAttribute.getSchema());\n+                        attrFound = true;\n                         break;\n                     }\n-\n                 }\n+                if(!attrFound) {\n+                    attributeMod = new AttributeMod();\n+                    attributeMod.setSchema(newAttribute.getSchema());\n+                    attributeMod.setValuesToBeAdded(newAttribute.getValues());\n+                    membershipMod.addAttributeToBeUpdated(attributeMod);\n+                }\n+                attrFound = false;\n             }\n \n             if(userMod == null)"}]}