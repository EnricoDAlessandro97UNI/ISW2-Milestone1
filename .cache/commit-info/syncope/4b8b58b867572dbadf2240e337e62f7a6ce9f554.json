{"sha":"4b8b58b867572dbadf2240e337e62f7a6ce9f554","node_id":"MDY6Q29tbWl0NjM2ODc5MDYyOjRiOGI1OGI4Njc1NzJkYmFkZjIyNDBlMzM3ZTYyZjdhNmNlOWY1NTQ=","commit":{"author":{"name":"Marco Di Sabatino Di Diodoro","email":"mdisabatino@apache.org","date":"2015-02-18T13:56:53Z"},"committer":{"name":"Marco Di Sabatino Di Diodoro","email":"mdisabatino@apache.org","date":"2015-02-18T13:56:53Z"},"message":"[SYNCOPE-644] Merge from 1_2_X","tree":{"sha":"b8ea7298022640ce6ee342bf839fe65c2ba34682","url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/git/trees/b8ea7298022640ce6ee342bf839fe65c2ba34682"},"url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/git/commits/4b8b58b867572dbadf2240e337e62f7a6ce9f554","comment_count":0,"verification":{"verified":false,"reason":"unsigned","signature":null,"payload":null}},"url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/4b8b58b867572dbadf2240e337e62f7a6ce9f554","html_url":"https://github.com/EnricoDAlessandro97UNI/syncope/commit/4b8b58b867572dbadf2240e337e62f7a6ce9f554","comments_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/4b8b58b867572dbadf2240e337e62f7a6ce9f554/comments","author":{"login":"mdisabatino","id":1792527,"node_id":"MDQ6VXNlcjE3OTI1Mjc=","avatar_url":"https://avatars.githubusercontent.com/u/1792527?v=4","gravatar_id":"","url":"https://api.github.com/users/mdisabatino","html_url":"https://github.com/mdisabatino","followers_url":"https://api.github.com/users/mdisabatino/followers","following_url":"https://api.github.com/users/mdisabatino/following{/other_user}","gists_url":"https://api.github.com/users/mdisabatino/gists{/gist_id}","starred_url":"https://api.github.com/users/mdisabatino/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mdisabatino/subscriptions","organizations_url":"https://api.github.com/users/mdisabatino/orgs","repos_url":"https://api.github.com/users/mdisabatino/repos","events_url":"https://api.github.com/users/mdisabatino/events{/privacy}","received_events_url":"https://api.github.com/users/mdisabatino/received_events","type":"User","site_admin":false},"committer":{"login":"mdisabatino","id":1792527,"node_id":"MDQ6VXNlcjE3OTI1Mjc=","avatar_url":"https://avatars.githubusercontent.com/u/1792527?v=4","gravatar_id":"","url":"https://api.github.com/users/mdisabatino","html_url":"https://github.com/mdisabatino","followers_url":"https://api.github.com/users/mdisabatino/followers","following_url":"https://api.github.com/users/mdisabatino/following{/other_user}","gists_url":"https://api.github.com/users/mdisabatino/gists{/gist_id}","starred_url":"https://api.github.com/users/mdisabatino/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mdisabatino/subscriptions","organizations_url":"https://api.github.com/users/mdisabatino/orgs","repos_url":"https://api.github.com/users/mdisabatino/repos","events_url":"https://api.github.com/users/mdisabatino/events{/privacy}","received_events_url":"https://api.github.com/users/mdisabatino/received_events","type":"User","site_admin":false},"parents":[{"sha":"c981971c97e06bbdbb83584585650b34eebe5f36","url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/c981971c97e06bbdbb83584585650b34eebe5f36","html_url":"https://github.com/EnricoDAlessandro97UNI/syncope/commit/c981971c97e06bbdbb83584585650b34eebe5f36"},{"sha":"2f7fc8993042ee816eb5d24fbb29d7ab7de7091a","url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/2f7fc8993042ee816eb5d24fbb29d7ab7de7091a","html_url":"https://github.com/EnricoDAlessandro97UNI/syncope/commit/2f7fc8993042ee816eb5d24fbb29d7ab7de7091a"}],"stats":{"total":16,"additions":11,"deletions":5},"files":[{"sha":"1a3bf13d46f34503768aba8329ef252bdc262cb6","filename":"core/provisioning-java/src/main/java/org/apache/syncope/core/provisioning/java/sync/SyncUtilities.java","status":"modified","additions":11,"deletions":5,"changes":16,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/4b8b58b867572dbadf2240e337e62f7a6ce9f554/core%2Fprovisioning-java%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fprovisioning%2Fjava%2Fsync%2FSyncUtilities.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/4b8b58b867572dbadf2240e337e62f7a6ce9f554/core%2Fprovisioning-java%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fprovisioning%2Fjava%2Fsync%2FSyncUtilities.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fprovisioning-java%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fprovisioning%2Fjava%2Fsync%2FSyncUtilities.java?ref=4b8b58b867572dbadf2240e337e62f7a6ce9f554","patch":"@@ -34,6 +34,7 @@\n import org.apache.syncope.core.persistence.api.dao.PlainSchemaDAO;\n import org.apache.syncope.core.persistence.api.dao.PolicyDAO;\n import org.apache.syncope.core.persistence.api.dao.RoleDAO;\n+import org.apache.syncope.core.persistence.api.dao.SubjectDAO;\n import org.apache.syncope.core.persistence.api.dao.SubjectSearchDAO;\n import org.apache.syncope.core.persistence.api.dao.UserDAO;\n import org.apache.syncope.core.persistence.api.dao.search.AttributeCond;\n@@ -156,6 +157,10 @@ public Long findMatchingAttributableKey(\n         return result;\n     }\n \n+    private SubjectDAO<?, ?, ?> getSubjectDAO(final MappingItem accountIdItem) {\n+        return AttributableType.USER == accountIdItem.getIntMappingType().getAttributableType() ? userDAO : roleDAO;\n+    }\n+\n     private List<Long> findByAccountIdItem(\n             final String uid, final ExternalResource resource, final AttributableUtil attrUtil) {\n         final List<Long> result = new ArrayList<>();\n@@ -178,17 +183,18 @@ private List<Long> findByAccountIdItem(\n                     }\n                 }\n \n-                List<? extends Subject<UPlainAttr, UDerAttr, UVirAttr>> users =\n-                        userDAO.findByAttrValue(accountIdItem.getIntAttrName(), value, attrUtil);\n-                for (Subject<UPlainAttr, UDerAttr, UVirAttr> subject : users) {\n+                List<? extends Subject<?, ?, ?>> subjects =\n+                        getSubjectDAO(accountIdItem).findByAttrValue(accountIdItem.getIntAttrName(), value, attrUtil);\n+                for (Subject<?, ?, ?> subject : subjects) {\n                     result.add(subject.getKey());\n                 }\n                 break;\n \n             case UserDerivedSchema:\n             case RoleDerivedSchema:\n-                users = userDAO.findByDerAttrValue(accountIdItem.getIntAttrName(), uid, attrUtil);\n-                for (Subject<UPlainAttr, UDerAttr, UVirAttr> subject : users) {\n+                subjects = getSubjectDAO(accountIdItem).\n+                        findByDerAttrValue(accountIdItem.getIntAttrName(), uid, attrUtil);\n+                for (Subject<?, ?, ?> subject : subjects) {\n                     result.add(subject.getKey());\n                 }\n                 break;"}]}