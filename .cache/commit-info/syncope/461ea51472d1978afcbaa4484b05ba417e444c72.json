{"sha":"461ea51472d1978afcbaa4484b05ba417e444c72","node_id":"MDY6Q29tbWl0NjM2ODc5MDYyOjQ2MWVhNTE0NzJkMTk3OGFmY2JhYTQ0ODRiMDViYTQxN2U0NDRjNzI=","commit":{"author":{"name":"Francesco Chicchiriccò","email":"ilgrosso@apache.org","date":"2012-05-22T10:05:15Z"},"committer":{"name":"Francesco Chicchiriccò","email":"ilgrosso@apache.org","date":"2012-05-22T10:05:15Z"},"message":"Tuning the commented steps for double opt-in\n\ngit-svn-id: https://svn.apache.org/repos/asf/incubator/syncope/trunk@1341382 13f79535-47bb-0310-9956-ffa450edef68","tree":{"sha":"e8043efa67c518a36d88c844ca565403e3dfbf6d","url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/git/trees/e8043efa67c518a36d88c844ca565403e3dfbf6d"},"url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/git/commits/461ea51472d1978afcbaa4484b05ba417e444c72","comment_count":0,"verification":{"verified":false,"reason":"unsigned","signature":null,"payload":null}},"url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/461ea51472d1978afcbaa4484b05ba417e444c72","html_url":"https://github.com/EnricoDAlessandro97UNI/syncope/commit/461ea51472d1978afcbaa4484b05ba417e444c72","comments_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/461ea51472d1978afcbaa4484b05ba417e444c72/comments","author":{"login":"ilgrosso","id":1064664,"node_id":"MDQ6VXNlcjEwNjQ2NjQ=","avatar_url":"https://avatars.githubusercontent.com/u/1064664?v=4","gravatar_id":"","url":"https://api.github.com/users/ilgrosso","html_url":"https://github.com/ilgrosso","followers_url":"https://api.github.com/users/ilgrosso/followers","following_url":"https://api.github.com/users/ilgrosso/following{/other_user}","gists_url":"https://api.github.com/users/ilgrosso/gists{/gist_id}","starred_url":"https://api.github.com/users/ilgrosso/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ilgrosso/subscriptions","organizations_url":"https://api.github.com/users/ilgrosso/orgs","repos_url":"https://api.github.com/users/ilgrosso/repos","events_url":"https://api.github.com/users/ilgrosso/events{/privacy}","received_events_url":"https://api.github.com/users/ilgrosso/received_events","type":"User","site_admin":false},"committer":{"login":"ilgrosso","id":1064664,"node_id":"MDQ6VXNlcjEwNjQ2NjQ=","avatar_url":"https://avatars.githubusercontent.com/u/1064664?v=4","gravatar_id":"","url":"https://api.github.com/users/ilgrosso","html_url":"https://github.com/ilgrosso","followers_url":"https://api.github.com/users/ilgrosso/followers","following_url":"https://api.github.com/users/ilgrosso/following{/other_user}","gists_url":"https://api.github.com/users/ilgrosso/gists{/gist_id}","starred_url":"https://api.github.com/users/ilgrosso/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ilgrosso/subscriptions","organizations_url":"https://api.github.com/users/ilgrosso/orgs","repos_url":"https://api.github.com/users/ilgrosso/repos","events_url":"https://api.github.com/users/ilgrosso/events{/privacy}","received_events_url":"https://api.github.com/users/ilgrosso/received_events","type":"User","site_admin":false},"parents":[{"sha":"2484ac088c57c420e2aae65c6ef93833fcfb3eb5","url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/2484ac088c57c420e2aae65c6ef93833fcfb3eb5","html_url":"https://github.com/EnricoDAlessandro97UNI/syncope/commit/2484ac088c57c420e2aae65c6ef93833fcfb3eb5"}],"stats":{"total":82,"additions":39,"deletions":43},"files":[{"sha":"eba768b5612293693b3f95509800111a42c55344","filename":"core/src/main/resources/userWorkflow.bpmn20.xml","status":"modified","additions":39,"deletions":43,"changes":82,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/461ea51472d1978afcbaa4484b05ba417e444c72/core%2Fsrc%2Fmain%2Fresources%2FuserWorkflow.bpmn20.xml","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/461ea51472d1978afcbaa4484b05ba417e444c72/core%2Fsrc%2Fmain%2Fresources%2FuserWorkflow.bpmn20.xml","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fsrc%2Fmain%2Fresources%2FuserWorkflow.bpmn20.xml?ref=461ea51472d1978afcbaa4484b05ba417e444c72","patch":"@@ -16,24 +16,23 @@ software distributed under the License is distributed on an\n KIND, either express or implied.  See the License for the\n specific language governing permissions and limitations\n under the License.\n-\n -->\n <definitions id=\"definitions\"\n              targetNamespace=\"http://activiti.org/bpmn20\" \n+             xmlns=\"http://www.omg.org/spec/BPMN/20100524/MODEL\"\n+             xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n              xmlns:activiti=\"http://activiti.org/bpmn\"\n              xmlns:bpmndi=\"http://www.omg.org/spec/BPMN/20100524/DI\" \n              xmlns:omgdc=\"http://www.omg.org/spec/DD/20100524/DC\"\n              xmlns:omgdi=\"http://www.omg.org/spec/DD/20100524/DI\" \n-             xmlns=\"http://www.omg.org/spec/BPMN/20100524/MODEL\"\n-             xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n              xsi:schemaLocation=\"http://www.omg.org/spec/BPMN/20100524/MODEL \n                                  http://www.omg.org/spec/BPMN/2.0/20100501/BPMN20.xsd\">\n   \n   <process id=\"userWorkflow\" name=\"User Workflow\">\n   \n     <startEvent id=\"theStart\"/>\n     \n-        <!-- Create an user -->\n+    <!-- Create an user -->\n     <sequenceFlow id=\"flow1\" sourceRef=\"theStart\" targetRef=\"create\"/>\n       \n     <serviceTask id=\"create\" name=\"Create\" activiti:class=\"org.apache.syncope.core.workflow.activiti.Create\"/>\n@@ -59,14 +58,14 @@ under the License.\n     <sequenceFlow id=\"flow3\" sourceRef=\"createApproval\" targetRef=\"createApprovalGW\"/>\n         \n     <exclusiveGateway id=\"createApprovalGW\"/>\n-    <sequenceFlow id=\"createApproval2Activate\" sourceRef=\"createApprovalGW\" targetRef=\"enableGW\">\n+    <sequenceFlow id=\"createApprovalGW2EnableGW\" sourceRef=\"createApprovalGW\" targetRef=\"enableGW\">\n       <conditionExpression xsi:type=\"tFormalExpression\">${approve}</conditionExpression>\n     </sequenceFlow>\n     <sequenceFlow id=\"createApproval2Reject\" sourceRef=\"createApprovalGW\" targetRef=\"reject\">\n       <conditionExpression xsi:type=\"tFormalExpression\">${!approve}</conditionExpression>\n     </sequenceFlow>\n         \n-        <!-- activate user if suspension is not required -->\n+    <!-- activate user if suspension is not required -->\n     <exclusiveGateway id=\"enableGW\"/>\n     <sequenceFlow id=\"createApprovalGW2Activate\" sourceRef=\"enableGW\" targetRef=\"activate\">\n       <conditionExpression xsi:type=\"tFormalExpression\">${enabled==null}</conditionExpression>\n@@ -78,43 +77,40 @@ under the License.\n       <conditionExpression xsi:type=\"tFormalExpression\">${!enabled}</conditionExpression>\n     </sequenceFlow>\n         \n-        <!-- Comment the following two lines, uncomment the lines below and change\n-             createApproval2Activate.targetRef to \"generateToken\" in order to enable opt-in. -->\n+    <!-- Comment the following two lines, uncomment the lines below and change\n+         createApprovalGW2Activate.targetRef to \"generateToken\" in order to enable opt-in. -->\n     <serviceTask id=\"activate\" name=\"Activate\" activiti:class=\"org.apache.syncope.core.workflow.activiti.AutoActivate\"/>\n-\n     <sequenceFlow id=\"flow4\" sourceRef=\"activate\" targetRef=\"active\"/>\n \n-        <!-- Uncomment the following lines and comment the above line in order to enable opt-in.        \n-        <serviceTask id=\"generateToken\" name=\"Generate token\" activiti:class=\"org.apache.syncope.core.workflow.activiti.GenerateToken\"/>\n+    <!--<serviceTask id=\"generateToken\" name=\"Generate token\" activiti:class=\"org.apache.syncope.core.workflow.activiti.GenerateToken\"/>\n         \n-        <sequenceFlow id=\"flowN+1\" sourceRef=\"generateToken\" targetRef=\"Created\"/>\n-\n-        <userTask id=\"created\" name=\"Created\"/>\n-\n-        <sequenceFlow id=\"flowN+2\" sourceRef=\"created\" targetRef=\"createdGw\"/>\n-\n-        <exclusiveGateway id=\"createdGw\"/>\n-        <sequenceFlow id=\"created2Activate\" sourceRef=\"createdGw\" targetRef=\"activate\">\n-            <conditionExpression xsi:type=\"tFormalExpression\">\n-                <![CDATA[${task == 'activate' && syncopeUser.checkToken(token)}]]>\n-            </conditionExpression>\n-        </sequenceFlow>  \n-        <sequenceFlow id=\"created2Created\" sourceRef=\"createdGw\" targetRef=\"created\">\n-            <conditionExpression xsi:type=\"tFormalExpression\">\n-                <![CDATA[${task == 'activate' && !syncopeUser.checkToken(token)}]]>\n-            </conditionExpression>\n-        </sequenceFlow>  \n-        <sequenceFlow id=\"created2Delete\" sourceRef=\"createdGw\" targetRef=\"delete\">\n-            <conditionExpression xsi:type=\"tFormalExpression\">${task == 'delete'}</conditionExpression>\n-        </sequenceFlow>\n+    <sequenceFlow id=\"flow5\" sourceRef=\"generateToken\" targetRef=\"createdGw\"/>\n+\n+    <userTask id=\"created\" name=\"Created\"/>\n+\n+    <sequenceFlow id=\"flow6\" sourceRef=\"created\" targetRef=\"createdGw\"/>\n+\n+    NOTE: this gateway makes sense when the token to be checked (i.e. the 'token' variable below) is provided as input\n+    from external to this workflow instance (a link provided in an notification e-mail, for example)\n+    <exclusiveGateway id=\"createdGw\"/>\n+    <sequenceFlow id=\"created2Activate\" sourceRef=\"createdGw\" targetRef=\"activate\">\n+      <conditionExpression xsi:type=\"tFormalExpression\">\n+        <![CDATA[${syncopeUser.checkToken(token)}]]>\n+      </conditionExpression>\n+    </sequenceFlow>  \n+    <sequenceFlow id=\"created2Created\" sourceRef=\"createdGw\" targetRef=\"created\">\n+      <conditionExpression xsi:type=\"tFormalExpression\">\n+        <![CDATA[${!syncopeUser.checkToken(token)}]]>\n+      </conditionExpression>\n+    </sequenceFlow>\n         \n-        <scriptTask id=\"activate\" name=\"Activate\" scriptFormat=\"juel\">\n-            <script>\n-            syncopeUser.removeToken()    \n-            </script>\n-        </scriptTask>\n+    <scriptTask id=\"activate\" name=\"Activate\" scriptFormat=\"juel\">\n+      <script>\n+        syncopeUser.removeToken()    \n+      </script>\n+    </scriptTask>\n \n-        <sequenceFlow id=\"flowN+3\" sourceRef=\"activate\" targetRef=\"active\"/>-->\n+    <sequenceFlow id=\"flow62\" sourceRef=\"activate\" targetRef=\"active\"/>-->\n \n     <userTask id=\"active\" name=\"Active\"/>\n         \n@@ -131,12 +127,12 @@ under the License.\n       <conditionExpression xsi:type=\"tFormalExpression\">${task == 'delete'}</conditionExpression>\n     </sequenceFlow>\n \n-        <!-- Update an active user -->\n+    <!-- Update an active user -->\n     <serviceTask id=\"update\" name=\"Update\" activiti:class=\"org.apache.syncope.core.workflow.activiti.Update\"/>\n \n     <sequenceFlow id=\"flow8\" sourceRef=\"update\" targetRef=\"active\"/>\n \n-        <!-- Suspend an active user -->\n+    <!-- Suspend an active user -->\n     <serviceTask id=\"suspend\" name=\"Suspend\" activiti:class=\"org.apache.syncope.core.workflow.activiti.Suspend\"/>\n \n     <sequenceFlow id=\"flow9\" sourceRef=\"suspend\" targetRef=\"suspended\"/>\n@@ -153,14 +149,14 @@ under the License.\n       <conditionExpression xsi:type=\"tFormalExpression\">${task == 'delete'}</conditionExpression>\n     </sequenceFlow>\n \n-        <!-- Reactivate a suspended user -->\n+    <!-- Reactivate a suspended user -->\n     <serviceTask id=\"reactivate\" name =\"Reactivate\" activiti:class=\"org.apache.syncope.core.workflow.activiti.Reactivate\"/>\n \n     <sequenceFlow id=\"flow11\" sourceRef=\"reactivate\" targetRef=\"active\"/>\n         \n-        <!-- Reject an user -->\n+    <!-- Reject an user -->\n     <scriptTask id=\"reject\" name=\"Reject\" scriptFormat=\"groovy\">\n-            <!-- Do something with rejectReason -->\n+      <!-- Do something with rejectReason -->\n       <script>\n         def scriptVar = rejectReason\n       </script>\n@@ -172,7 +168,7 @@ under the License.\n         \n     <sequenceFlow id=\"flow13\" sourceRef=\"rejected\" targetRef=\"delete\"/>\n \n-        <!-- Delete an user (created, active or suspended) -->\n+    <!-- Delete an user (created, active or suspended) -->\n     <serviceTask id=\"delete\" name=\"Delete\" activiti:class=\"org.apache.syncope.core.workflow.activiti.Delete\"/>\n \n     <sequenceFlow id=\"flow99\" sourceRef=\"delete\" targetRef=\"theEnd\"/>"}]}