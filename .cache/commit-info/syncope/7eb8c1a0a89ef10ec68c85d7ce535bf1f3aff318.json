{"sha":"7eb8c1a0a89ef10ec68c85d7ce535bf1f3aff318","node_id":"MDY6Q29tbWl0NjM2ODc5MDYyOjdlYjhjMWEwYTg5ZWYxMGVjNjhjODVkN2NlNTM1YmYxZjNhZmYzMTg=","commit":{"author":{"name":"Francesco Chicchiriccò","email":"ilgrosso@apache.org","date":"2017-12-06T10:46:46Z"},"committer":{"name":"Francesco Chicchiriccò","email":"ilgrosso@apache.org","date":"2017-12-06T11:06:25Z"},"message":"Aligning custom SpringBeanJobFactory with latest Spring","tree":{"sha":"bae97dc3c1b4c26b791b5b87b59cab796363047d","url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/git/trees/bae97dc3c1b4c26b791b5b87b59cab796363047d"},"url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/git/commits/7eb8c1a0a89ef10ec68c85d7ce535bf1f3aff318","comment_count":0,"verification":{"verified":false,"reason":"unsigned","signature":null,"payload":null}},"url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/7eb8c1a0a89ef10ec68c85d7ce535bf1f3aff318","html_url":"https://github.com/EnricoDAlessandro97UNI/syncope/commit/7eb8c1a0a89ef10ec68c85d7ce535bf1f3aff318","comments_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/7eb8c1a0a89ef10ec68c85d7ce535bf1f3aff318/comments","author":{"login":"ilgrosso","id":1064664,"node_id":"MDQ6VXNlcjEwNjQ2NjQ=","avatar_url":"https://avatars.githubusercontent.com/u/1064664?v=4","gravatar_id":"","url":"https://api.github.com/users/ilgrosso","html_url":"https://github.com/ilgrosso","followers_url":"https://api.github.com/users/ilgrosso/followers","following_url":"https://api.github.com/users/ilgrosso/following{/other_user}","gists_url":"https://api.github.com/users/ilgrosso/gists{/gist_id}","starred_url":"https://api.github.com/users/ilgrosso/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ilgrosso/subscriptions","organizations_url":"https://api.github.com/users/ilgrosso/orgs","repos_url":"https://api.github.com/users/ilgrosso/repos","events_url":"https://api.github.com/users/ilgrosso/events{/privacy}","received_events_url":"https://api.github.com/users/ilgrosso/received_events","type":"User","site_admin":false},"committer":{"login":"ilgrosso","id":1064664,"node_id":"MDQ6VXNlcjEwNjQ2NjQ=","avatar_url":"https://avatars.githubusercontent.com/u/1064664?v=4","gravatar_id":"","url":"https://api.github.com/users/ilgrosso","html_url":"https://github.com/ilgrosso","followers_url":"https://api.github.com/users/ilgrosso/followers","following_url":"https://api.github.com/users/ilgrosso/following{/other_user}","gists_url":"https://api.github.com/users/ilgrosso/gists{/gist_id}","starred_url":"https://api.github.com/users/ilgrosso/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ilgrosso/subscriptions","organizations_url":"https://api.github.com/users/ilgrosso/orgs","repos_url":"https://api.github.com/users/ilgrosso/repos","events_url":"https://api.github.com/users/ilgrosso/events{/privacy}","received_events_url":"https://api.github.com/users/ilgrosso/received_events","type":"User","site_admin":false},"parents":[{"sha":"068e696967fdfb81ba1c025dd5fd8b2a01835960","url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/068e696967fdfb81ba1c025dd5fd8b2a01835960","html_url":"https://github.com/EnricoDAlessandro97UNI/syncope/commit/068e696967fdfb81ba1c025dd5fd8b2a01835960"}],"stats":{"total":35,"additions":21,"deletions":14},"files":[{"sha":"109c9c2759779aec3baa7aad6841da4766c75cad","filename":"core/provisioning-java/src/main/java/org/apache/syncope/core/provisioning/java/job/AutowiringSpringBeanJobFactory.java","status":"renamed","additions":20,"deletions":13,"changes":33,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/7eb8c1a0a89ef10ec68c85d7ce535bf1f3aff318/core%2Fprovisioning-java%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fprovisioning%2Fjava%2Fjob%2FAutowiringSpringBeanJobFactory.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/7eb8c1a0a89ef10ec68c85d7ce535bf1f3aff318/core%2Fprovisioning-java%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fprovisioning%2Fjava%2Fjob%2FAutowiringSpringBeanJobFactory.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fprovisioning-java%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fprovisioning%2Fjava%2Fjob%2FAutowiringSpringBeanJobFactory.java?ref=7eb8c1a0a89ef10ec68c85d7ce535bf1f3aff318","patch":"@@ -23,19 +23,28 @@\n import org.springframework.beans.BeanWrapper;\n import org.springframework.beans.MutablePropertyValues;\n import org.springframework.beans.PropertyAccessorFactory;\n+import org.springframework.beans.factory.config.AutowireCapableBeanFactory;\n import org.springframework.context.ApplicationContext;\n-import org.springframework.context.ConfigurableApplicationContext;\n+import org.springframework.context.ApplicationContextAware;\n+import org.springframework.scheduling.quartz.SpringBeanJobFactory;\n \n /**\n  * An implementation of SpringBeanJobFactory that retrieves the bean from the Spring context so that autowiring and\n  * transactions work.\n  */\n-public class SpringBeanJobFactory extends org.springframework.scheduling.quartz.SpringBeanJobFactory {\n+public class AutowiringSpringBeanJobFactory extends SpringBeanJobFactory implements ApplicationContextAware {\n+\n+    private transient AutowireCapableBeanFactory beanFactory;\n \n     private String[] ignoredUnknownProperties;\n \n     private SchedulerContext schedulerContext;\n \n+    @Override\n+    public void setApplicationContext(final ApplicationContext context) {\n+        beanFactory = context.getAutowireCapableBeanFactory();\n+    }\n+\n     @Override\n     public void setIgnoredUnknownProperties(final String... ignoredUnknownProperties) {\n         String[] defensiveCopy = ignoredUnknownProperties.clone();\n@@ -51,26 +60,24 @@ public void setSchedulerContext(final SchedulerContext schedulerContext) {\n \n     @Override\n     protected Object createJobInstance(final TriggerFiredBundle bundle) throws Exception {\n-        ApplicationContext ctx = ((ConfigurableApplicationContext) schedulerContext.get(\"applicationContext\"));\n-\n-        Object job = ctx.getBean(bundle.getJobDetail().getKey().getName());\n-        BeanWrapper wrapper = PropertyAccessorFactory.forBeanPropertyAccess(job);\n-        if (isEligibleForPropertyPopulation(wrapper.getWrappedInstance())) {\n-            final MutablePropertyValues pvs = new MutablePropertyValues();\n+        Object job = beanFactory.getBean(bundle.getJobDetail().getKey().getName());\n+        if (isEligibleForPropertyPopulation(job)) {\n+            BeanWrapper bw = PropertyAccessorFactory.forBeanPropertyAccess(job);\n+            MutablePropertyValues pvs = new MutablePropertyValues();\n             if (this.schedulerContext != null) {\n                 pvs.addPropertyValues(this.schedulerContext);\n             }\n             pvs.addPropertyValues(bundle.getJobDetail().getJobDataMap());\n             pvs.addPropertyValues(bundle.getTrigger().getJobDataMap());\n-            if (this.ignoredUnknownProperties == null) {\n-                wrapper.setPropertyValues(pvs, true);\n-            } else {\n+            if (this.ignoredUnknownProperties != null) {\n                 for (String propName : this.ignoredUnknownProperties) {\n-                    if (pvs.contains(propName) && !wrapper.isWritableProperty(propName)) {\n+                    if (pvs.contains(propName) && !bw.isWritableProperty(propName)) {\n                         pvs.removePropertyValue(propName);\n                     }\n                 }\n-                wrapper.setPropertyValues(pvs);\n+                bw.setPropertyValues(pvs);\n+            } else {\n+                bw.setPropertyValues(pvs, true);\n             }\n         }\n         return job;","previous_filename":"core/provisioning-java/src/main/java/org/apache/syncope/core/provisioning/java/job/SpringBeanJobFactory.java"},{"sha":"c049c6f72b43d40935e90e8e1772c7362123cd89","filename":"core/provisioning-java/src/main/resources/provisioningContext.xml","status":"modified","additions":1,"deletions":1,"changes":2,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/7eb8c1a0a89ef10ec68c85d7ce535bf1f3aff318/core%2Fprovisioning-java%2Fsrc%2Fmain%2Fresources%2FprovisioningContext.xml","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/7eb8c1a0a89ef10ec68c85d7ce535bf1f3aff318/core%2Fprovisioning-java%2Fsrc%2Fmain%2Fresources%2FprovisioningContext.xml","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fprovisioning-java%2Fsrc%2Fmain%2Fresources%2FprovisioningContext.xml?ref=7eb8c1a0a89ef10ec68c85d7ce535bf1f3aff318","patch":"@@ -74,7 +74,7 @@ under the License.\n     <property name=\"dataSource\" ref=\"MasterDataSource\"/>\n     <property name=\"transactionManager\" ref=\"MasterTransactionManager\"/>\n     <property name=\"jobFactory\">\n-      <bean class=\"org.apache.syncope.core.provisioning.java.job.SpringBeanJobFactory\"/>\n+      <bean class=\"org.apache.syncope.core.provisioning.java.job.AutowiringSpringBeanJobFactory\"/>\n     </property>\n     <property name=\"quartzProperties\">\n       <props>"}]}