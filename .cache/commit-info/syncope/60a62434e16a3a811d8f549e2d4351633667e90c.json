{"sha":"60a62434e16a3a811d8f549e2d4351633667e90c","node_id":"MDY6Q29tbWl0NjM2ODc5MDYyOjYwYTYyNDM0ZTE2YTNhODExZDhmNTQ5ZTJkNDM1MTYzMzY2N2U5MGM=","commit":{"author":{"name":"Francesco Chicchiriccò","email":"ilgrosso@apache.org","date":"2015-01-26T16:51:45Z"},"committer":{"name":"Francesco Chicchiriccò","email":"ilgrosso@apache.org","date":"2015-01-26T16:51:45Z"},"message":"[SYNCOPE-630] Removing unused ResourceService#list(Long) and QueryResourceInfoComparator","tree":{"sha":"74291e17259951d234bd608ecb8c42b484b68e98","url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/git/trees/74291e17259951d234bd608ecb8c42b484b68e98"},"url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/git/commits/60a62434e16a3a811d8f549e2d4351633667e90c","comment_count":0,"verification":{"verified":false,"reason":"unsigned","signature":null,"payload":null}},"url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/60a62434e16a3a811d8f549e2d4351633667e90c","html_url":"https://github.com/EnricoDAlessandro97UNI/syncope/commit/60a62434e16a3a811d8f549e2d4351633667e90c","comments_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/60a62434e16a3a811d8f549e2d4351633667e90c/comments","author":{"login":"ilgrosso","id":1064664,"node_id":"MDQ6VXNlcjEwNjQ2NjQ=","avatar_url":"https://avatars.githubusercontent.com/u/1064664?v=4","gravatar_id":"","url":"https://api.github.com/users/ilgrosso","html_url":"https://github.com/ilgrosso","followers_url":"https://api.github.com/users/ilgrosso/followers","following_url":"https://api.github.com/users/ilgrosso/following{/other_user}","gists_url":"https://api.github.com/users/ilgrosso/gists{/gist_id}","starred_url":"https://api.github.com/users/ilgrosso/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ilgrosso/subscriptions","organizations_url":"https://api.github.com/users/ilgrosso/orgs","repos_url":"https://api.github.com/users/ilgrosso/repos","events_url":"https://api.github.com/users/ilgrosso/events{/privacy}","received_events_url":"https://api.github.com/users/ilgrosso/received_events","type":"User","site_admin":false},"committer":{"login":"ilgrosso","id":1064664,"node_id":"MDQ6VXNlcjEwNjQ2NjQ=","avatar_url":"https://avatars.githubusercontent.com/u/1064664?v=4","gravatar_id":"","url":"https://api.github.com/users/ilgrosso","html_url":"https://github.com/ilgrosso","followers_url":"https://api.github.com/users/ilgrosso/followers","following_url":"https://api.github.com/users/ilgrosso/following{/other_user}","gists_url":"https://api.github.com/users/ilgrosso/gists{/gist_id}","starred_url":"https://api.github.com/users/ilgrosso/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ilgrosso/subscriptions","organizations_url":"https://api.github.com/users/ilgrosso/orgs","repos_url":"https://api.github.com/users/ilgrosso/repos","events_url":"https://api.github.com/users/ilgrosso/events{/privacy}","received_events_url":"https://api.github.com/users/ilgrosso/received_events","type":"User","site_admin":false},"parents":[{"sha":"4bdf7d781d106177d282254a06affe0916961f38","url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/4bdf7d781d106177d282254a06affe0916961f38","html_url":"https://github.com/EnricoDAlessandro97UNI/syncope/commit/4bdf7d781d106177d282254a06affe0916961f38"}],"stats":{"total":190,"additions":22,"deletions":168},"files":[{"sha":"dae4622e907487bfb00bec113e6ef49670257dbf","filename":"common/src/main/java/org/apache/syncope/common/services/ResourceService.java","status":"modified","additions":0,"deletions":11,"changes":11,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/60a62434e16a3a811d8f549e2d4351633667e90c/common%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcommon%2Fservices%2FResourceService.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/60a62434e16a3a811d8f549e2d4351633667e90c/common%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcommon%2Fservices%2FResourceService.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/common%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcommon%2Fservices%2FResourceService.java?ref=60a62434e16a3a811d8f549e2d4351633667e90c","patch":"@@ -23,7 +23,6 @@\n import javax.ws.rs.Consumes;\n import javax.ws.rs.DELETE;\n import javax.ws.rs.GET;\n-import javax.ws.rs.MatrixParam;\n import javax.ws.rs.POST;\n import javax.ws.rs.PUT;\n import javax.ws.rs.Path;\n@@ -93,16 +92,6 @@ ConnObjectTO getConnectorObject(@NotNull @PathParam(\"resourceName\") String resou\n     @Produces({ MediaType.APPLICATION_XML, MediaType.APPLICATION_JSON })\n     List<ResourceTO> list();\n \n-    /**\n-     * Returns a list of resources using matching connector instance id.\n-     *\n-     * @param connInstanceId Connector id to filter for resources\n-     * @return resources using matching connector instance id\n-     */\n-    @GET\n-    @Produces({ MediaType.APPLICATION_XML, MediaType.APPLICATION_JSON })\n-    List<ResourceTO> list(@NotNull @MatrixParam(\"connectorId\") Long connInstanceId);\n-\n     /**\n      * Creates a new resource.\n      *"},{"sha":"d3dc9d7614f1d0447f9e954459adb0a3f656611e","filename":"core/src/main/java/org/apache/syncope/core/rest/controller/ResourceController.java","status":"modified","additions":2,"deletions":15,"changes":17,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/60a62434e16a3a811d8f549e2d4351633667e90c/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Frest%2Fcontroller%2FResourceController.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/60a62434e16a3a811d8f549e2d4351633667e90c/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Frest%2Fcontroller%2FResourceController.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Frest%2Fcontroller%2FResourceController.java?ref=60a62434e16a3a811d8f549e2d4351633667e90c","patch":"@@ -38,7 +38,6 @@\n import org.apache.syncope.core.persistence.beans.AbstractSubject;\n import org.apache.syncope.core.persistence.beans.ConnInstance;\n import org.apache.syncope.core.persistence.beans.ExternalResource;\n-import org.apache.syncope.core.persistence.dao.ConnInstanceDAO;\n import org.apache.syncope.core.persistence.dao.NotFoundException;\n import org.apache.syncope.core.persistence.dao.ResourceDAO;\n import org.apache.syncope.core.persistence.dao.RoleDAO;\n@@ -65,9 +64,6 @@ public class ResourceController extends AbstractTransactionalController<Resource\n     @Autowired\n     private ResourceDAO resourceDAO;\n \n-    @Autowired\n-    private ConnInstanceDAO connInstanceDAO;\n-\n     @Autowired\n     private UserDAO userDAO;\n \n@@ -171,17 +167,8 @@ public Set<String> getPropagationActionsClasses() {\n \n     @PreAuthorize(\"isAuthenticated()\")\n     @Transactional(readOnly = true)\n-    public List<ResourceTO> list(final Long connInstanceId) {\n-        List<ExternalResource> resources;\n-\n-        if (connInstanceId == null) {\n-            resources = resourceDAO.findAll();\n-        } else {\n-            ConnInstance connInstance = connInstanceDAO.find(connInstanceId);\n-            resources = connInstance.getResources();\n-        }\n-\n-        return binder.getResourceTOs(resources);\n+    public List<ResourceTO> list() {\n+        return binder.getResourceTOs(resourceDAO.findAll());\n     }\n \n     @PreAuthorize(\"hasRole('RESOURCE_GETCONNECTOROBJECT')\")"},{"sha":"bcc015df44d7202cc7281dcc0502341d6d99fe47","filename":"core/src/main/java/org/apache/syncope/core/rest/utils/QueryResourceInfoComparator.java","status":"removed","additions":0,"deletions":114,"changes":114,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/4bdf7d781d106177d282254a06affe0916961f38/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Frest%2Futils%2FQueryResourceInfoComparator.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/4bdf7d781d106177d282254a06affe0916961f38/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Frest%2Futils%2FQueryResourceInfoComparator.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Frest%2Futils%2FQueryResourceInfoComparator.java?ref=4bdf7d781d106177d282254a06affe0916961f38","patch":"@@ -1,114 +0,0 @@\n-/*\n- * Licensed to the Apache Software Foundation (ASF) under one\n- * or more contributor license agreements.  See the NOTICE file\n- * distributed with this work for additional information\n- * regarding copyright ownership.  The ASF licenses this file\n- * to you under the Apache License, Version 2.0 (the\n- * \"License\"); you may not use this file except in compliance\n- * with the License.  You may obtain a copy of the License at\n- *\n- *   http://www.apache.org/licenses/LICENSE-2.0\n- *\n- * Unless required by applicable law or agreed to in writing,\n- * software distributed under the License is distributed on an\n- * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n- * KIND, either express or implied.  See the License for the\n- * specific language governing permissions and limitations\n- * under the License.\n- */\n-package org.apache.syncope.core.rest.utils;\n-\n-import java.util.List;\n-import java.util.Map;\n-\n-import org.apache.cxf.jaxrs.ext.ResourceComparator;\n-import org.apache.cxf.jaxrs.model.ClassResourceInfo;\n-import org.apache.cxf.jaxrs.model.OperationResourceInfo;\n-import org.apache.cxf.jaxrs.model.OperationResourceInfoComparator;\n-import org.apache.cxf.jaxrs.model.Parameter;\n-import org.apache.cxf.jaxrs.utils.JAXRSUtils;\n-import org.apache.cxf.message.Message;\n-\n-public class QueryResourceInfoComparator extends OperationResourceInfoComparator implements ResourceComparator {\n-\n-    public QueryResourceInfoComparator() {\n-        super(null, null);\n-    }\n-\n-    @Override\n-    public int compare(final ClassResourceInfo cri1, final ClassResourceInfo cri2, final Message message) {\n-        // Leave Class selection to CXF\n-        return 0;\n-    }\n-\n-    @Override\n-    public int compare(final OperationResourceInfo oper1, final OperationResourceInfo oper2, final Message message) {\n-        // Check if CXF can make a decision\n-        int cxfResult = super.compare(oper1, oper2);\n-        if (cxfResult != 0) {\n-            return cxfResult;\n-        }\n-\n-        int op1Counter = getMatchingRate(oper1, message);\n-        int op2Counter = getMatchingRate(oper2, message);\n-\n-        return op1Counter == op2Counter\n-                ? 0\n-                : op1Counter < op2Counter\n-                ? 1\n-                : -1;\n-    }\n-\n-    /**\n-     * This method calculates a number indicating a good or bad match between values provided within the request and\n-     * expected method parameters. A higher number means a better match.\n-     *\n-     * @param operation The operation to be rated, based on contained parameterInfo values.\n-     * @param message A message containing query and header values from user request\n-     * @return A positive or negative number, indicating a good match between query and method\n-     */\n-    protected int getMatchingRate(final OperationResourceInfo operation, final Message message) {\n-        List<Parameter> params = operation.getParameters();\n-        if (params == null || params.isEmpty()) {\n-            return 0;\n-        }\n-\n-        // Get Request QueryParams\n-        String query = (String) message.get(Message.QUERY_STRING);\n-        String path = (String) message.get(Message.REQUEST_URI);\n-        Map<String, List<String>> qParams = JAXRSUtils.getStructuredParams(query, \"&\", true, false);\n-        Map<String, List<String>> mParams = JAXRSUtils.getMatrixParams(path, true);\n-        // Get Request Headers\n-        Map<?, ?> qHeader = (java.util.Map<?, ?>) message.get(Message.PROTOCOL_HEADERS);\n-\n-        int rate = 0;\n-        for (Parameter p : params) {\n-            switch (p.getType()) {\n-                case QUERY:\n-                    if (qParams.containsKey(p.getName())) {\n-                        rate += 2;\n-                    } else if (p.getDefaultValue() == null) {\n-                        rate -= 1;\n-                    }\n-                    break;\n-                case MATRIX:\n-                    if (mParams.containsKey(p.getName())) {\n-                        rate += 2;\n-                    } else if (p.getDefaultValue() == null) {\n-                        rate -= 1;\n-                    }\n-                    break;\n-                case HEADER:\n-                    if (qHeader.containsKey(p.getName())) {\n-                        rate += 2;\n-                    } else if (p.getDefaultValue() == null) {\n-                        rate -= 1;\n-                    }\n-                    break;\n-                default:\n-                    break;\n-            }\n-        }\n-        return rate;\n-    }\n-}"},{"sha":"dda5561e8450ab28988bdc986372cec938130e14","filename":"core/src/main/java/org/apache/syncope/core/services/ResourceServiceImpl.java","status":"modified","additions":1,"deletions":6,"changes":7,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/60a62434e16a3a811d8f549e2d4351633667e90c/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fservices%2FResourceServiceImpl.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/60a62434e16a3a811d8f549e2d4351633667e90c/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fservices%2FResourceServiceImpl.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fservices%2FResourceServiceImpl.java?ref=60a62434e16a3a811d8f549e2d4351633667e90c","patch":"@@ -86,12 +86,7 @@ public List<PropagationActionClass> getPropagationActionsClasses() {\n \n     @Override\n     public List<ResourceTO> list() {\n-        return controller.list(null);\n-    }\n-\n-    @Override\n-    public List<ResourceTO> list(final Long connInstanceId) {\n-        return controller.list(connInstanceId);\n+        return controller.list();\n     }\n \n     @Override"},{"sha":"7b6fe3003a17d73ab5992c5869f215534c285fce","filename":"core/src/main/resources/restContext.xml","status":"modified","additions":0,"deletions":3,"changes":3,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/60a62434e16a3a811d8f549e2d4351633667e90c/core%2Fsrc%2Fmain%2Fresources%2FrestContext.xml","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/60a62434e16a3a811d8f549e2d4351633667e90c/core%2Fsrc%2Fmain%2Fresources%2FrestContext.xml","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fsrc%2Fmain%2Fresources%2FrestContext.xml?ref=60a62434e16a3a811d8f549e2d4351633667e90c","patch":"@@ -100,9 +100,6 @@ under the License.\n   <jaxrs:server id=\"restContainer\" address=\"/\" \n                 basePackages=\"org.apache.syncope.common.services, org.apache.syncope.core.services\" \n                 staticSubresourceResolution=\"true\">\n-    <jaxrs:resourceComparator>\n-      <bean id=\"queryResourceInfoComparator\" class=\"org.apache.syncope.core.rest.utils.QueryResourceInfoComparator\"/>\n-    </jaxrs:resourceComparator>\n     <jaxrs:properties> \n       <entry key=\"search.lax.property.match\" value=\"true\"/> \n     </jaxrs:properties> "},{"sha":"fc4e8302898a1b46b1dbb6b4c9f5a928b60ac7e8","filename":"core/src/test/java/org/apache/syncope/core/rest/ConnectorTestITCase.java","status":"modified","additions":18,"deletions":7,"changes":25,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/60a62434e16a3a811d8f549e2d4351633667e90c/core%2Fsrc%2Ftest%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Frest%2FConnectorTestITCase.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/60a62434e16a3a811d8f549e2d4351633667e90c/core%2Fsrc%2Ftest%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Frest%2FConnectorTestITCase.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fsrc%2Ftest%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Frest%2FConnectorTestITCase.java?ref=60a62434e16a3a811d8f549e2d4351633667e90c","patch":"@@ -27,6 +27,7 @@\n \n import java.io.IOException;\n import java.io.InputStream;\n+import java.util.ArrayList;\n import java.util.EnumSet;\n import java.util.HashSet;\n import java.util.Iterator;\n@@ -265,6 +266,18 @@ public void update() {\n         assertEquals(Integer.valueOf(20), actual.getConnRequestTimeout());\n     }\n \n+    private List<ResourceTO> filter(final List<ResourceTO> input, final Long connectorId) {\n+        List<ResourceTO> result = new ArrayList<ResourceTO>();\n+\n+        for (ResourceTO resource : input) {\n+            if (connectorId.equals(resource.getConnectorId())) {\n+                result.add(resource);\n+            }\n+        }\n+\n+        return result;\n+    }\n+\n     @Test\n     public void issueSYNCOPE10() {\n         // ----------------------------------\n@@ -276,8 +289,7 @@ public void issueSYNCOPE10() {\n         assertNotNull(connInstanceTO);\n \n         // check for resource\n-        List<ResourceTO> resources = resourceService.list(Long.valueOf(103));\n-\n+        List<ResourceTO> resources = filter(resourceService.list(), 103L);\n         assertEquals(4, resources.size());\n \n         // Retrieve a resource TO template.\n@@ -317,8 +329,7 @@ public void issueSYNCOPE10() {\n \n         assertNotNull(resourceTO);\n \n-        resources = resourceService.list(connId);\n-\n+        resources = filter(resourceService.list(), connId);\n         assertEquals(1, resources.size());\n         // ----------------------------------\n \n@@ -709,13 +720,13 @@ public void bulkAction() {\n \n     @Test\n     public void issueSYNCOPE605() {\n-        \n+\n         ConnInstanceTO connectorInstanceTO = connectorService.read(103L);\n         assertTrue(connectorInstanceTO.getCapabilities().isEmpty());\n-        \n+\n         connectorInstanceTO.getCapabilities().add(ConnectorCapability.SEARCH);\n         connectorService.update(connectorInstanceTO.getId(), connectorInstanceTO);\n-        \n+\n         ConnInstanceTO updatedCapabilities = connectorService.read(connectorInstanceTO.getId());\n         assertNotNull(updatedCapabilities.getCapabilities());\n         assertTrue(updatedCapabilities.getCapabilities().size() == 1);"},{"sha":"de4435b3a43fe72713aa7baaaca26aa0279b7fdf","filename":"core/src/test/java/org/apache/syncope/core/rest/ResourceTestITCase.java","status":"modified","additions":1,"deletions":12,"changes":13,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/60a62434e16a3a811d8f549e2d4351633667e90c/core%2Fsrc%2Ftest%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Frest%2FResourceTestITCase.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/60a62434e16a3a811d8f549e2d4351633667e90c/core%2Fsrc%2Ftest%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Frest%2FResourceTestITCase.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fsrc%2Ftest%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Frest%2FResourceTestITCase.java?ref=60a62434e16a3a811d8f549e2d4351633667e90c","patch":"@@ -405,17 +405,6 @@ public void list() {\n         }\n     }\n \n-    @Test\n-    public void listByType() {\n-        List<ResourceTO> actuals = resourceService.list(105L);\n-        assertNotNull(actuals);\n-\n-        for (ResourceTO resourceTO : actuals) {\n-            assertNotNull(resourceTO);\n-            assertEquals(105L, resourceTO.getConnectorId().longValue());\n-        }\n-    }\n-\n     @Test\n     public void read() {\n         ResourceTO actual = resourceService.read(RESOURCE_NAME_TESTDB);\n@@ -507,7 +496,7 @@ public void issueSYNCOPE368() {\n         item.setExtAttrName(\"cn\");\n         item.setPurpose(MappingPurpose.BOTH);\n         mapping.setAccountIdItem(item);\n-            \n+\n         item = new MappingItemTO();\n         item.setIntMappingType(IntMappingType.RoleOwnerSchema);\n         item.setExtAttrName(\"owner\");"}]}