{"sha":"d930f0253713ef6700a33d663f6ddaf053d20e2e","node_id":"MDY6Q29tbWl0NjM2ODc5MDYyOmQ5MzBmMDI1MzcxM2VmNjcwMGEzM2Q2NjNmNmRkYWYwNTNkMjBlMmU=","commit":{"author":{"name":"Unknown","email":"unknown@apache.org","date":"2012-02-02T15:07:51Z"},"committer":{"name":"Unknown","email":"unknown@apache.org","date":"2012-02-02T15:07:51Z"},"message":"Fixes issue 281\n\ngit-svn-id: https://svn.apache.org/repos/asf/incubator/syncope/trunk@1247390 13f79535-47bb-0310-9956-ffa450edef68","tree":{"sha":"df5437e8755e2f3a3bd048af0ab815f67ecf171d","url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/git/trees/df5437e8755e2f3a3bd048af0ab815f67ecf171d"},"url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/git/commits/d930f0253713ef6700a33d663f6ddaf053d20e2e","comment_count":0,"verification":{"verified":false,"reason":"unsigned","signature":null,"payload":null}},"url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/d930f0253713ef6700a33d663f6ddaf053d20e2e","html_url":"https://github.com/EnricoDAlessandro97UNI/syncope/commit/d930f0253713ef6700a33d663f6ddaf053d20e2e","comments_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/d930f0253713ef6700a33d663f6ddaf053d20e2e/comments","author":null,"committer":null,"parents":[{"sha":"3b29a11d186cc30e95d7a13fc4926838e2230420","url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/3b29a11d186cc30e95d7a13fc4926838e2230420","html_url":"https://github.com/EnricoDAlessandro97UNI/syncope/commit/3b29a11d186cc30e95d7a13fc4926838e2230420"}],"stats":{"total":105,"additions":67,"deletions":38},"files":[{"sha":"1c7bf2cfc6baac21479e625300d51d9196261e05","filename":"console/src/main/webapp/css/style.css","status":"modified","additions":1,"deletions":1,"changes":2,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/d930f0253713ef6700a33d663f6ddaf053d20e2e/console%2Fsrc%2Fmain%2Fwebapp%2Fcss%2Fstyle.css","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/d930f0253713ef6700a33d663f6ddaf053d20e2e/console%2Fsrc%2Fmain%2Fwebapp%2Fcss%2Fstyle.css","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/console%2Fsrc%2Fmain%2Fwebapp%2Fcss%2Fstyle.css?ref=d930f0253713ef6700a33d663f6ddaf053d20e2e","patch":"@@ -334,7 +334,7 @@ em img {\n }\n \n th.action{\n-    width: 100px;\n+    width: 110px;\n }\n \n td.action{"},{"sha":"910b148c39666fb193fb66666721051844350255","filename":"console/src/main/webapp/img/actions/dryrun.png","status":"modified","additions":0,"deletions":0,"changes":0,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/d930f0253713ef6700a33d663f6ddaf053d20e2e/console%2Fsrc%2Fmain%2Fwebapp%2Fimg%2Factions%2Fdryrun.png","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/d930f0253713ef6700a33d663f6ddaf053d20e2e/console%2Fsrc%2Fmain%2Fwebapp%2Fimg%2Factions%2Fdryrun.png","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/console%2Fsrc%2Fmain%2Fwebapp%2Fimg%2Factions%2Fdryrun.png?ref=d930f0253713ef6700a33d663f6ddaf053d20e2e"},{"sha":"8b0ec81eb14686369b4160bedaed2d31b257a00d","filename":"console/src/main/webapp/img/actions/execute.png","status":"modified","additions":0,"deletions":0,"changes":0,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/d930f0253713ef6700a33d663f6ddaf053d20e2e/console%2Fsrc%2Fmain%2Fwebapp%2Fimg%2Factions%2Fexecute.png","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/d930f0253713ef6700a33d663f6ddaf053d20e2e/console%2Fsrc%2Fmain%2Fwebapp%2Fimg%2Factions%2Fexecute.png","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/console%2Fsrc%2Fmain%2Fwebapp%2Fimg%2Factions%2Fexecute.png?ref=d930f0253713ef6700a33d663f6ddaf053d20e2e"},{"sha":"0849539be684ac6560a2a08223cdb570bc5066ec","filename":"console/src/test/java/org/syncope/console/UserTestITCase.java","status":"modified","additions":2,"deletions":2,"changes":4,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/d930f0253713ef6700a33d663f6ddaf053d20e2e/console%2Fsrc%2Ftest%2Fjava%2Forg%2Fsyncope%2Fconsole%2FUserTestITCase.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/d930f0253713ef6700a33d663f6ddaf053d20e2e/console%2Fsrc%2Ftest%2Fjava%2Forg%2Fsyncope%2Fconsole%2FUserTestITCase.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/console%2Fsrc%2Ftest%2Fjava%2Forg%2Fsyncope%2Fconsole%2FUserTestITCase.java?ref=d930f0253713ef6700a33d663f6ddaf053d20e2e","patch":"@@ -85,7 +85,7 @@ public void search() {\n         selenium.click(\"name=search\");\n \n         selenium.waitForCondition(\"selenium.isElementPresent(\"\n-                + \"\\\"//*[@id='users-contain']//*[span=2]\\\");\",\n+                + \"\\\"//*[@id='users-contain']//*[span=1]\\\");\",\n                 \"30000\");\n     }\n \n@@ -97,7 +97,7 @@ public void delete() {\n                 \"selenium.isElementPresent(\\\"//div[@id='tabs']\\\");\", \"30000\");\n \n         selenium.click(\n-                \"//*[@id=\\\"users-contain\\\"]//*[span=1]/../td[4]/span/span[8]/a\");\n+                \"//*[@id=\\\"users-contain\\\"]//*[span=4]/../td[4]/span/span[8]/a\");\n \n         assertTrue(selenium.getConfirmation().matches(\n                 \"^Do you really want to delete the selected item[\\\\s\\\\S]$\"));"},{"sha":"ad67da80dc9f8b90ca392f1719899c7e160703cb","filename":"core/src/main/java/org/syncope/core/propagation/PropagationManager.java","status":"modified","additions":31,"deletions":27,"changes":58,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/d930f0253713ef6700a33d663f6ddaf053d20e2e/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fcore%2Fpropagation%2FPropagationManager.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/d930f0253713ef6700a33d663f6ddaf053d20e2e/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fcore%2Fpropagation%2FPropagationManager.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fcore%2Fpropagation%2FPropagationManager.java?ref=d930f0253713ef6700a33d663f6ddaf053d20e2e","patch":"@@ -172,8 +172,8 @@ public List<PropagationTask> getCreateTaskIds(\n      * result from workflow.\n      * @param password to be set.\n      * @param vAttrs virtual attributes to be set.\n-     * @param syncResourceNames external resources performing sync, hence\n-     * not to be considered for propagation.\n+     * @param syncResourceNames external resources performing sync, hence not to\n+     * be considered for propagation.\n      * @return list of propagation tasks.\n      * @throws NotFoundException if userId is not found.\n      */\n@@ -204,14 +204,14 @@ public List<PropagationTask> getCreateTaskIds(\n     }\n \n     /**\n-     * Performs update on each resource associated to the user excluding the \n+     * Performs update on each resource associated to the user excluding the\n      * specified into 'resourceNames' parameter.\n      *\n      * @param user to be propagated.\n      * @param enable wether user must be enabled or not.\n-     * @param syncResourceNames external resource names not to be considered \n-     * for propagation. Use this during sync and disable/enable actions limited\n-     * to the external resources only.\n+     * @param syncResourceNames external resource names not to be considered for\n+     * propagation. Use this during sync and disable/enable actions limited to\n+     * the external resources only.\n      * @return list of propagation tasks\n      * @throws NotFoundException if userId is not found\n      */\n@@ -282,9 +282,9 @@ public List<PropagationTask> getUpdateTaskIds(\n      * @param vAttrsToBeRemoved virtual attributes to be removed\n      * @param vAttrsToBeUpdated virtual attributes to be added\n      * @param enable wether user must be enabled or not\n-     * @param syncResourceNames external resource names not to be considered \n-     * for propagation. Use this during sync and disable/enable actions limited\n-     * to the external resources only.\n+     * @param syncResourceNames external resource names not to be considered for\n+     * propagation. Use this during sync and disable/enable actions limited to\n+     * the external resources only.\n      * @return list of propagation tasks\n      * @throws NotFoundException if userId is not found\n      */\n@@ -347,11 +347,10 @@ private List<PropagationTask> getUpdateTaskIds(\n     }\n \n     /**\n-     * Perform delete on each resource associated to the user.\n-     * It is possible to ask for a mandatory provisioning for some resources\n-     * specifying a set of resource names.\n-     * Exceptions won't be ignored and the process will be stopped if the\n-     * creation fails onto a mandatory resource.\n+     * Perform delete on each resource associated to the user. It is possible to\n+     * ask for a mandatory provisioning for some resources specifying a set of\n+     * resource names. Exceptions won't be ignored and the process will be\n+     * stopped if the creation fails onto a mandatory resource.\n      *\n      * @param userId to be deleted\n      * @return list of propagation tasks\n@@ -364,11 +363,10 @@ public List<PropagationTask> getDeleteTaskIds(final Long userId)\n     }\n \n     /**\n-     * Perform delete on each resource associated to the user.\n-     * It is possible to ask for a mandatory provisioning for some resources\n-     * specifying a set of resource names.\n-     * Exceptions won't be ignored and the process will be stopped if the\n-     * creation fails onto a mandatory resource.\n+     * Perform delete on each resource associated to the user. It is possible to\n+     * ask for a mandatory provisioning for some resources specifying a set of\n+     * resource names. Exceptions won't be ignored and the process will be\n+     * stopped if the creation fails onto a mandatory resource.\n      *\n      * @param userId to be deleted\n      * @param syncResourceName name of external resource performing sync, hence\n@@ -424,7 +422,7 @@ private Class getIntMappingTypeClass(\n \n     /**\n      * Prepare an attribute for sending to a connector instance.\n-     * \n+     *\n      * @param mapping schema mapping for the given attribute\n      * @param user given user\n      * @param password clear-text password\n@@ -640,7 +638,8 @@ private Map.Entry<String, Set<Attribute>> prepareAttributes(\n                         values.addAll(preparedAttribute.getValue().getValue());\n \n                         attributes.add(AttributeBuilder.build(\n-                                preparedAttribute.getValue().getName(), values));\n+                                preparedAttribute.getValue().getName(),\n+                                values));\n                     } else {\n                         attributes.add(preparedAttribute.getValue());\n                     }\n@@ -653,9 +652,12 @@ private Map.Entry<String, Set<Attribute>> prepareAttributes(\n         }\n \n         if (!StringUtils.hasText(accountId)) {\n-            throw new IllegalArgumentException(\n-                    \"Missing accountId specification for \"\n-                    + resource.getName());\n+            // LOG error but avoid to throw exception: leave it to the \n+            //external resource\n+\n+            LOG.error(\n+                    \"Failure preparing attributes for '{}': missing accountId\",\n+                    resource.getName());\n         }\n \n         // Evaluate AccountLink expression\n@@ -717,17 +719,19 @@ protected List<PropagationTask> provision(\n             }\n \n             for (ExternalResource resource : resourcesByPriority) {\n-                Map.Entry<String, Set<Attribute>> preparedAttrs =\n-                        prepareAttributes(user, password, enable, resource);\n \n                 PropagationTask task = new PropagationTask();\n                 task.setResource(resource);\n                 task.setSyncopeUser(user);\n                 task.setPropagationOperation(operation);\n                 task.setPropagationMode(resource.getPropagationMode());\n-                task.setAccountId(preparedAttrs.getKey());\n                 task.setOldAccountId(\n                         propByRes.getOldAccountId(resource.getName()));\n+\n+                Map.Entry<String, Set<Attribute>> preparedAttrs =\n+                        prepareAttributes(user, password, enable, resource);\n+\n+                task.setAccountId(preparedAttrs.getKey());\n                 task.setAttributes(preparedAttrs.getValue());\n \n                 tasks.add(task);"},{"sha":"59bdf2685f9380487cce102d399757a066822a10","filename":"core/src/test/java/org/syncope/core/rest/UserTestITCase.java","status":"modified","additions":31,"deletions":6,"changes":37,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/d930f0253713ef6700a33d663f6ddaf053d20e2e/core%2Fsrc%2Ftest%2Fjava%2Forg%2Fsyncope%2Fcore%2Frest%2FUserTestITCase.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/d930f0253713ef6700a33d663f6ddaf053d20e2e/core%2Fsrc%2Ftest%2Fjava%2Forg%2Fsyncope%2Fcore%2Frest%2FUserTestITCase.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fsrc%2Ftest%2Fjava%2Forg%2Fsyncope%2Fcore%2Frest%2FUserTestITCase.java?ref=d930f0253713ef6700a33d663f6ddaf053d20e2e","patch":"@@ -1569,18 +1569,43 @@ public final void issue280() {\n                 BASE_URL + \"user/update\", userMod, UserTO.class);\n         assertNotNull(userTO);\n \n-        final Map<String, PropagationTaskExecStatus> propStatusMap =\n+        final Map<String, PropagationTaskExecStatus> statuses =\n                 userTO.getPropagationStatusMap();\n \n-        assertNotNull(propStatusMap);\n-        assertEquals(1, propStatusMap.size());\n-        assertEquals(1, propStatusMap.size());\n+        assertNotNull(statuses);\n+        assertEquals(1, statuses.size());\n \n         final PropagationTaskExecStatus exec =\n-                propStatusMap.values().iterator().next();\n+                statuses.values().iterator().next();\n \n         assertNotNull(exec);\n-        assertEquals(\"resource-testdb\", propStatusMap.keySet().iterator().next());\n+        assertEquals(\"resource-testdb\", statuses.keySet().iterator().next());\n         assertTrue(exec.isSuccessful());\n     }\n+\n+    @Test\n+    public final void issue281() {\n+        UserTO userTO = getSampleTO(\"issue281@syncope-idm.org\");\n+        userTO.getResources().clear();\n+        userTO.getMemberships().clear();\n+        userTO.getDerivedAttributes().clear();\n+        userTO.addResource(\"resource-csv\");\n+\n+        userTO = restTemplate.postForObject(\n+                BASE_URL + \"user/create\", userTO, UserTO.class);\n+        assertNotNull(userTO);\n+\n+        final Map<String, PropagationTaskExecStatus> statuses =\n+                userTO.getPropagationStatusMap();\n+\n+        assertNotNull(statuses);\n+        assertEquals(1, statuses.size());\n+\n+        final PropagationTaskExecStatus exec =\n+                statuses.values().iterator().next();\n+\n+        assertNotNull(exec);\n+        assertEquals(\"resource-csv\", statuses.keySet().iterator().next());\n+        assertFalse(exec.isSuccessful());\n+    }\n }"},{"sha":"db7ba0ba90b3ee54dcf5fa612f1c9e01e7a81399","filename":"parent/pom.xml","status":"modified","additions":2,"deletions":2,"changes":4,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/d930f0253713ef6700a33d663f6ddaf053d20e2e/parent%2Fpom.xml","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/d930f0253713ef6700a33d663f6ddaf053d20e2e/parent%2Fpom.xml","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/parent%2Fpom.xml?ref=d930f0253713ef6700a33d663f6ddaf053d20e2e","patch":"@@ -131,8 +131,8 @@\n         \n         <connid.version>1.3.1</connid.version>\n         <connid.soap.version>1.2</connid.soap.version>\n-        <connid.db.table.version>2.1.2-SNAPSHOT</connid.db.table.version>\n-        <connid.csvdir.version>0.2-SNAPSHOT</connid.csvdir.version>\n+        <connid.db.table.version>2.1.2</connid.db.table.version>\n+        <connid.csvdir.version>0.2</connid.csvdir.version>\n         <connid.ldap.version>1.3</connid.ldap.version>\n \n         <commons-jexl.version>2.1.1</commons-jexl.version>"}]}