{"sha":"e83c7c738f7bafa28305a5279f9098c86071607c","node_id":"MDY6Q29tbWl0NjM2ODc5MDYyOmU4M2M3YzczOGY3YmFmYTI4MzA1YTUyNzlmOTA5OGM4NjA3MTYwN2M=","commit":{"author":{"name":"Unknown","email":"unknown@apache.org","date":"2011-01-12T09:30:29Z"},"committer":{"name":"Unknown","email":"unknown@apache.org","date":"2011-01-12T09:30:29Z"},"message":"Improvements\n\ngit-svn-id: https://svn.apache.org/repos/asf/incubator/syncope/trunk@1246724 13f79535-47bb-0310-9956-ffa450edef68","tree":{"sha":"a7b5c3eee1e527a54fa95f1c0fc222444a902087","url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/git/trees/a7b5c3eee1e527a54fa95f1c0fc222444a902087"},"url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/git/commits/e83c7c738f7bafa28305a5279f9098c86071607c","comment_count":0,"verification":{"verified":false,"reason":"unsigned","signature":null,"payload":null}},"url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/e83c7c738f7bafa28305a5279f9098c86071607c","html_url":"https://github.com/EnricoDAlessandro97UNI/syncope/commit/e83c7c738f7bafa28305a5279f9098c86071607c","comments_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/e83c7c738f7bafa28305a5279f9098c86071607c/comments","author":null,"committer":null,"parents":[{"sha":"6394bcac5147d9e609846e3823b4c7f71e8abe9d","url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/6394bcac5147d9e609846e3823b4c7f71e8abe9d","html_url":"https://github.com/EnricoDAlessandro97UNI/syncope/commit/6394bcac5147d9e609846e3823b4c7f71e8abe9d"}],"stats":{"total":108,"additions":86,"deletions":22},"files":[{"sha":"28b0355fa008fdf3d30c8885004b64a5027d839b","filename":"core/src/main/java/org/syncope/core/persistence/beans/membership/Membership.java","status":"modified","additions":0,"deletions":3,"changes":3,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/e83c7c738f7bafa28305a5279f9098c86071607c/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fcore%2Fpersistence%2Fbeans%2Fmembership%2FMembership.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/e83c7c738f7bafa28305a5279f9098c86071607c/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fcore%2Fpersistence%2Fbeans%2Fmembership%2FMembership.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fcore%2Fpersistence%2Fbeans%2Fmembership%2FMembership.java?ref=e83c7c738f7bafa28305a5279f9098c86071607c","patch":"@@ -20,8 +20,6 @@\n import java.util.Set;\n import javax.persistence.CascadeType;\n import javax.persistence.Entity;\n-import javax.persistence.GeneratedValue;\n-import javax.persistence.GenerationType;\n import javax.persistence.Id;\n import javax.persistence.ManyToOne;\n import javax.persistence.OneToMany;\n@@ -44,7 +42,6 @@\n public class Membership extends AbstractAttributable {\n \n     @Id\n-    @GeneratedValue(strategy = GenerationType.AUTO)\n     private Long id;\n \n     @ManyToOne"},{"sha":"2eb356b5547820050d8d2e829a902ef91fe31958","filename":"core/src/main/java/org/syncope/core/persistence/dao/SyncopeUserDAO.java","status":"modified","additions":3,"deletions":1,"changes":4,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/e83c7c738f7bafa28305a5279f9098c86071607c/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fcore%2Fpersistence%2Fdao%2FSyncopeUserDAO.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/e83c7c738f7bafa28305a5279f9098c86071607c/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fcore%2Fpersistence%2Fdao%2FSyncopeUserDAO.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fcore%2Fpersistence%2Fdao%2FSyncopeUserDAO.java?ref=e83c7c738f7bafa28305a5279f9098c86071607c","patch":"@@ -27,7 +27,9 @@ public interface SyncopeUserDAO extends DAO {\n \n     SyncopeUser findByWorkflowId(Long workflowId);\n \n-    List<SyncopeUser> findByAttributeValue(UAttrValue attributeValue);\n+    List<SyncopeUser> findByAttrValue(UAttrValue attrValue);\n+\n+    List<SyncopeUser> findByAttrUniqueValue(UAttrValue attrUniqueValue);\n \n     List<SyncopeUser> findAll();\n "},{"sha":"163a77c182ca9ce8297b1caec893fda5df618a79","filename":"core/src/main/java/org/syncope/core/persistence/dao/impl/SyncopeUserDAOImpl.java","status":"modified","additions":59,"deletions":14,"changes":73,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/e83c7c738f7bafa28305a5279f9098c86071607c/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fcore%2Fpersistence%2Fdao%2Fimpl%2FSyncopeUserDAOImpl.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/e83c7c738f7bafa28305a5279f9098c86071607c/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fcore%2Fpersistence%2Fdao%2Fimpl%2FSyncopeUserDAOImpl.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fcore%2Fpersistence%2Fdao%2Fimpl%2FSyncopeUserDAOImpl.java?ref=e83c7c738f7bafa28305a5279f9098c86071607c","patch":"@@ -14,6 +14,7 @@\n  */\n package org.syncope.core.persistence.dao.impl;\n \n+import java.util.ArrayList;\n import java.util.Collections;\n import java.util.List;\n import javax.persistence.NoResultException;\n@@ -33,6 +34,7 @@\n import org.syncope.core.persistence.beans.AbstractAttrValue;\n import org.syncope.core.persistence.beans.membership.Membership;\n import org.syncope.core.persistence.beans.user.SyncopeUser;\n+import org.syncope.core.persistence.beans.user.UAttrUniqueValue;\n import org.syncope.core.persistence.beans.user.UAttrValue;\n import org.syncope.core.persistence.beans.user.USchema;\n import org.syncope.core.persistence.dao.SchemaDAO;\n@@ -74,17 +76,15 @@ public SyncopeUser findByWorkflowId(final Long workflowId) {\n     }\n \n     @Override\n-    public List<SyncopeUser> findByAttributeValue(\n-            final UAttrValue attrValue) {\n+    public List<SyncopeUser> findByAttrValue(final UAttrValue attrValue) {\n \n-        StringBuilder queryHead1 = new StringBuilder(\"SELECT u\").append(\n-                \" FROM SyncopeUser u, UAttr ua, UAttrValue e\");\n-        StringBuilder queryHead2 = new StringBuilder(\" SELECT u\").append(\n-                \" FROM SyncopeUser u, UAttr ua, UAttrUniqueValue e\");\n+        StringBuilder queryHead1 = new StringBuilder(\n+                \"SELECT e FROM \" + UAttrValue.class.getName() + \" e\");\n+        StringBuilder queryHead2 = new StringBuilder(\n+                \"SELECT e FROM \" + UAttrUniqueValue.class.getName() + \" e\");\n \n         StringBuilder whereCondition = new StringBuilder().append(\n-                \" WHERE e.attribute = ua AND ua.owner = u\").\n-                append(\" AND ((e.stringValue IS NOT NULL\").\n+                \" WHERE (e.stringValue IS NOT NULL\").\n                 append(\" AND e.stringValue = :stringValue)\").\n                 append(\" OR (e.booleanValue IS NOT NULL\").\n                 append(\" AND e.booleanValue = :booleanValue)\").\n@@ -93,8 +93,7 @@ public List<SyncopeUser> findByAttributeValue(\n                 append(\" OR (e.longValue IS NOT NULL\").\n                 append(\" AND e.longValue = :longValue)\").\n                 append(\" OR (e.doubleValue IS NOT NULL\").\n-                append(\" AND e.doubleValue = :doubleValue))\").\n-                append(\" ORDER BY u.id\");\n+                append(\" AND e.doubleValue = :doubleValue)\");\n \n         Query query = entityManager.createQuery(\n                 queryHead1.append(whereCondition).toString());\n@@ -107,7 +106,7 @@ public List<SyncopeUser> findByAttributeValue(\n         query.setParameter(\"longValue\", attrValue.getLongValue());\n         query.setParameter(\"doubleValue\", attrValue.getDoubleValue());\n \n-        List<SyncopeUser> result1 = query.getResultList();\n+        List<UAttrValue> result1 = query.getResultList();\n \n         query = entityManager.createQuery(\n                 queryHead2.append(whereCondition).toString());\n@@ -120,10 +119,56 @@ public List<SyncopeUser> findByAttributeValue(\n         query.setParameter(\"longValue\", attrValue.getLongValue());\n         query.setParameter(\"doubleValue\", attrValue.getDoubleValue());\n \n-        List<SyncopeUser> result2 = query.getResultList();\n-        result2.addAll(result1);\n+        List<UAttrUniqueValue> result2 = query.getResultList();\n \n-        return result2;\n+        List<SyncopeUser> result = new ArrayList<SyncopeUser>();\n+        for (UAttrValue value : (List<UAttrValue>) result1) {\n+\n+            result.add((SyncopeUser) value.getAttribute().getOwner());\n+        }\n+        for (UAttrUniqueValue value : (List<UAttrUniqueValue>) result2) {\n+\n+            result.add((SyncopeUser) value.getAttribute().getOwner());\n+        }\n+\n+        return result;\n+    }\n+\n+    @Override\n+    public List<SyncopeUser> findByAttrUniqueValue(\n+            final UAttrValue attrUniqueValue) {\n+\n+        Query query = entityManager.createQuery(\n+                \"SELECT e FROM \" + UAttrUniqueValue.class.getSimpleName() + \" e\"\n+                + \" WHERE (e.stringValue IS NOT NULL\"\n+                + \" AND e.stringValue = :stringValue)\"\n+                + \" OR (e.booleanValue IS NOT NULL\"\n+                + \" AND e.booleanValue = :booleanValue)\"\n+                + \" OR (e.dateValue IS NOT NULL\"\n+                + \" AND e.dateValue = :dateValue)\"\n+                + \" OR (e.longValue IS NOT NULL\"\n+                + \" AND e.longValue = :longValue)\"\n+                + \" OR (e.doubleValue IS NOT NULL\"\n+                + \" AND e.doubleValue = :doubleValue)\");\n+\n+        query.setParameter(\"stringValue\", attrUniqueValue.getStringValue());\n+        query.setParameter(\"booleanValue\",\n+                attrUniqueValue.getBooleanValue() == null\n+                ? null\n+                : attrUniqueValue.getBooleanAsInteger(attrUniqueValue.\n+                getBooleanValue()));\n+        query.setParameter(\"dateValue\", attrUniqueValue.getDateValue());\n+        query.setParameter(\"longValue\", attrUniqueValue.getLongValue());\n+        query.setParameter(\"doubleValue\", attrUniqueValue.getDoubleValue());\n+\n+        List<SyncopeUser> result = new ArrayList<SyncopeUser>();\n+        for (UAttrUniqueValue value :\n+                (List<UAttrUniqueValue>) query.getResultList()) {\n+\n+            result.add((SyncopeUser) value.getAttribute().getOwner());\n+        }\n+\n+        return result;\n     }\n \n     @Override"},{"sha":"c71e7cf2ac749ed7bd7c9854046f2da0b5d408e9","filename":"core/src/main/resources/META-INF/orm.xml","status":"modified","additions":10,"deletions":1,"changes":11,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/e83c7c738f7bafa28305a5279f9098c86071607c/core%2Fsrc%2Fmain%2Fresources%2FMETA-INF%2Form.xml","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/e83c7c738f7bafa28305a5279f9098c86071607c/core%2Fsrc%2Fmain%2Fresources%2FMETA-INF%2Form.xml","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fsrc%2Fmain%2Fresources%2FMETA-INF%2Form.xml?ref=e83c7c738f7bafa28305a5279f9098c86071607c","patch":"@@ -39,7 +39,16 @@\n             </id>\n         </attributes>\n     </entity>\n-    \n+\n+    <entity class=\"org.syncope.core.persistence.beans.membership.Membership\">\n+        <attributes>\n+            <id name=\"id\">\n+                <generated-value generator=\"SEQ_Membership\" strategy=\"TABLE\"/>\n+                <table-generator name=\"SEQ_Membership\" pk-column-value=\"SEQ_Membership\" initial-value=\"10\"/>\n+            </id>\n+        </attributes>\n+    </entity>\n+\n     <entity class=\"org.syncope.core.persistence.beans.SchemaMapping\">\n         <attributes>\n             <id name=\"id\">"},{"sha":"161416902a96d6c8ff4f0515e29b7ae82c5681b3","filename":"core/src/main/resources/META-INF/orm.xml.oracle","status":"modified","additions":10,"deletions":1,"changes":11,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/e83c7c738f7bafa28305a5279f9098c86071607c/core%2Fsrc%2Fmain%2Fresources%2FMETA-INF%2Form.xml.oracle","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/e83c7c738f7bafa28305a5279f9098c86071607c/core%2Fsrc%2Fmain%2Fresources%2FMETA-INF%2Form.xml.oracle","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fsrc%2Fmain%2Fresources%2FMETA-INF%2Form.xml.oracle?ref=e83c7c738f7bafa28305a5279f9098c86071607c","patch":"@@ -39,7 +39,16 @@\n             </id>\n         </attributes>\n     </entity>\n-    \n+\n+    <entity class=\"org.syncope.core.persistence.beans.membership.Membership\">\n+        <attributes>\n+            <id name=\"id\">\n+                <generated-value generator=\"SEQ_Membership\" strategy=\"TABLE\"/>\n+                <table-generator name=\"SEQ_Membership\" pk-column-value=\"SEQ_Membership\" initial-value=\"10\"/>\n+            </id>\n+        </attributes>\n+    </entity>\n+\n     <entity class=\"org.syncope.core.persistence.beans.SchemaMapping\">\n         <attributes>\n             <id name=\"id\">"},{"sha":"0d87b7e2c27cfa2c66cd6ca94dee88fbd0105b66","filename":"core/src/main/resources/content.xml","status":"modified","additions":1,"deletions":0,"changes":1,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/e83c7c738f7bafa28305a5279f9098c86071607c/core%2Fsrc%2Fmain%2Fresources%2Fcontent.xml","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/e83c7c738f7bafa28305a5279f9098c86071607c/core%2Fsrc%2Fmain%2Fresources%2Fcontent.xml","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fsrc%2Fmain%2Fresources%2Fcontent.xml?ref=e83c7c738f7bafa28305a5279f9098c86071607c","patch":"@@ -19,6 +19,7 @@\n     starting value for SyncopeUser.id is 1000 -->\n     <hibernate_sequences sequence_name=\"SEQ_SyncopeUser\" sequence_next_hi_value=\"10\"/>\n     <hibernate_sequences sequence_name=\"SEQ_SyncopeRole\" sequence_next_hi_value=\"10\"/>\n+    <hibernate_sequences sequence_name=\"SEQ_Membership\" sequence_next_hi_value=\"10\"/>\n     <hibernate_sequences sequence_name=\"SEQ_SchemaMapping\" sequence_next_hi_value=\"10\"/>\n     <hibernate_sequences sequence_name=\"SEQ_ConnectorInstance\" sequence_next_hi_value=\"10\"/>\n     <hibernate_sequences sequence_name=\"SEQ_UAttr\" sequence_next_hi_value=\"1000\"/>"},{"sha":"4c58a80d35827b84adf5db2a5569e5348f48cc5e","filename":"core/src/test/java/org/syncope/core/persistence/dao/UserTest.java","status":"modified","additions":2,"deletions":2,"changes":4,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/e83c7c738f7bafa28305a5279f9098c86071607c/core%2Fsrc%2Ftest%2Fjava%2Forg%2Fsyncope%2Fcore%2Fpersistence%2Fdao%2FUserTest.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/e83c7c738f7bafa28305a5279f9098c86071607c/core%2Fsrc%2Ftest%2Fjava%2Forg%2Fsyncope%2Fcore%2Fpersistence%2Fdao%2FUserTest.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fsrc%2Ftest%2Fjava%2Forg%2Fsyncope%2Fcore%2Fpersistence%2Fdao%2FUserTest.java?ref=e83c7c738f7bafa28305a5279f9098c86071607c","patch":"@@ -72,7 +72,7 @@ public final void findByAttributeValue() {\n         final UAttrValue usernameValue = new UAttrValue();\n         usernameValue.setStringValue(\"chicchiricco\");\n \n-        final List<SyncopeUser> list = syncopeUserDAO.findByAttributeValue(\n+        final List<SyncopeUser> list = syncopeUserDAO.findByAttrValue(\n                 usernameValue);\n         assertEquals(\"did not get expected number of users \", 1, list.size());\n     }\n@@ -82,7 +82,7 @@ public final void findByAttributeBooleanValue() {\n         final UAttrValue coolValue = new UAttrValue();\n         coolValue.setBooleanValue(true);\n \n-        final List<SyncopeUser> list = syncopeUserDAO.findByAttributeValue(\n+        final List<SyncopeUser> list = syncopeUserDAO.findByAttrValue(\n                 coolValue);\n         assertEquals(\"did not get expected number of users \", 1, list.size());\n     }"},{"sha":"625ca6c1982e696c8e93ccbe547b1efde93ee1fb","filename":"core/src/test/resources/content.xml","status":"modified","additions":1,"deletions":0,"changes":1,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/e83c7c738f7bafa28305a5279f9098c86071607c/core%2Fsrc%2Ftest%2Fresources%2Fcontent.xml","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/e83c7c738f7bafa28305a5279f9098c86071607c/core%2Fsrc%2Ftest%2Fresources%2Fcontent.xml","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fsrc%2Ftest%2Fresources%2Fcontent.xml?ref=e83c7c738f7bafa28305a5279f9098c86071607c","patch":"@@ -19,6 +19,7 @@\n     starting value for SyncopeUser.id is 1000 -->\n     <hibernate_sequences sequence_name=\"SEQ_SyncopeUser\" sequence_next_hi_value=\"10\"/>\n     <hibernate_sequences sequence_name=\"SEQ_SyncopeRole\" sequence_next_hi_value=\"10\"/>\n+    <hibernate_sequences sequence_name=\"SEQ_Membership\" sequence_next_hi_value=\"10\"/>\n     <hibernate_sequences sequence_name=\"SEQ_SchemaMapping\" sequence_next_hi_value=\"10\"/>\n     <hibernate_sequences sequence_name=\"SEQ_ConnectorInstance\" sequence_next_hi_value=\"10\"/>\n     <hibernate_sequences sequence_name=\"SEQ_UAttr\" sequence_next_hi_value=\"1000\"/>"}]}