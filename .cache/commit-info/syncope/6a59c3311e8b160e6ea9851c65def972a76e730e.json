{"sha":"6a59c3311e8b160e6ea9851c65def972a76e730e","node_id":"MDY6Q29tbWl0NjM2ODc5MDYyOjZhNTljMzMxMWU4YjE2MGU2ZWE5ODUxYzY1ZGVmOTcyYTc2ZTczMGU=","commit":{"author":{"name":"Matteo Di Carlo","email":"matteo.dicarlo@tirasa.net","date":"2016-11-18T11:56:12Z"},"committer":{"name":"Matteo Di Carlo","email":"matteo.dicarlo@tirasa.net","date":"2016-11-18T11:57:16Z"},"message":"[SYNCOPE-970] restore default language settings on logout and page refresh","tree":{"sha":"f0c0487e37c7a6dd8768d6484587b7781d216bce","url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/git/trees/f0c0487e37c7a6dd8768d6484587b7781d216bce"},"url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/git/commits/6a59c3311e8b160e6ea9851c65def972a76e730e","comment_count":0,"verification":{"verified":false,"reason":"unsigned","signature":null,"payload":null}},"url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/6a59c3311e8b160e6ea9851c65def972a76e730e","html_url":"https://github.com/EnricoDAlessandro97UNI/syncope/commit/6a59c3311e8b160e6ea9851c65def972a76e730e","comments_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/6a59c3311e8b160e6ea9851c65def972a76e730e/comments","author":null,"committer":null,"parents":[{"sha":"86b836b2a5502f0b9277354c3b1f4b4449c05632","url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/86b836b2a5502f0b9277354c3b1f4b4449c05632","html_url":"https://github.com/EnricoDAlessandro97UNI/syncope/commit/86b836b2a5502f0b9277354c3b1f4b4449c05632"}],"stats":{"total":96,"additions":39,"deletions":57},"files":[{"sha":"30f155b658813107e1ff7e92140b90ec4afc7e26","filename":"client/enduser/src/main/resources/META-INF/resources/app/index.html","status":"modified","additions":0,"deletions":1,"changes":1,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/6a59c3311e8b160e6ea9851c65def972a76e730e/client%2Fenduser%2Fsrc%2Fmain%2Fresources%2FMETA-INF%2Fresources%2Fapp%2Findex.html","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/6a59c3311e8b160e6ea9851c65def972a76e730e/client%2Fenduser%2Fsrc%2Fmain%2Fresources%2FMETA-INF%2Fresources%2Fapp%2Findex.html","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/client%2Fenduser%2Fsrc%2Fmain%2Fresources%2FMETA-INF%2Fresources%2Fapp%2Findex.html?ref=6a59c3311e8b160e6ea9851c65def972a76e730e","patch":"@@ -98,7 +98,6 @@\n   <script src=\"js/controllers/HomeController.js\"></script>\n   <script src=\"js/controllers/LoginController.js\"></script>\n   <script src=\"js/controllers/UserController.js\"></script>\n-  <script src=\"js/controllers/TailController.js\"></script>\n   <!--directives-->\n   <script src=\"js/directives/dynamicPlainAttribute.js\"></script>\n   <script src=\"js/directives/dynamicDerivedAttribute.js\"></script>"},{"sha":"efdf8ed112cb63678d846cd22bb5ce5b5a5309ee","filename":"client/enduser/src/main/resources/META-INF/resources/app/js/app.js","status":"modified","additions":2,"deletions":2,"changes":4,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/6a59c3311e8b160e6ea9851c65def972a76e730e/client%2Fenduser%2Fsrc%2Fmain%2Fresources%2FMETA-INF%2Fresources%2Fapp%2Fjs%2Fapp.js","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/6a59c3311e8b160e6ea9851c65def972a76e730e/client%2Fenduser%2Fsrc%2Fmain%2Fresources%2FMETA-INF%2Fresources%2Fapp%2Fjs%2Fapp.js","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/client%2Fenduser%2Fsrc%2Fmain%2Fresources%2FMETA-INF%2Fresources%2Fapp%2Fjs%2Fapp.js?ref=6a59c3311e8b160e6ea9851c65def972a76e730e","patch":"@@ -53,8 +53,8 @@ app.config(['$stateProvider', '$urlRouterProvider', '$httpProvider', '$translate\n     $translateProvider.useLoader('$translatePartialLoader', {\n       urlTemplate: 'languages/{lang}/{part}.json'\n     })\n-            .preferredLanguage('en')\n-            .useCookieStorage();\n+            .preferredLanguage('en');\n+//            .useCookieStorage();\n \n     // route configuration\n     $stateProvider"},{"sha":"af0bfdb7b3981084d76039b802b1e69edc6974f5","filename":"client/enduser/src/main/resources/META-INF/resources/app/js/controllers/LoginController.js","status":"modified","additions":4,"deletions":15,"changes":19,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/6a59c3311e8b160e6ea9851c65def972a76e730e/client%2Fenduser%2Fsrc%2Fmain%2Fresources%2FMETA-INF%2Fresources%2Fapp%2Fjs%2Fcontrollers%2FLoginController.js","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/6a59c3311e8b160e6ea9851c65def972a76e730e/client%2Fenduser%2Fsrc%2Fmain%2Fresources%2FMETA-INF%2Fresources%2Fapp%2Fjs%2Fcontrollers%2FLoginController.js","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/client%2Fenduser%2Fsrc%2Fmain%2Fresources%2FMETA-INF%2Fresources%2Fapp%2Fjs%2Fcontrollers%2FLoginController.js?ref=6a59c3311e8b160e6ea9851c65def972a76e730e","patch":"@@ -18,25 +18,16 @@\n  */\n \n 'use strict';\n-angular.module(\"login\").controller(\"LoginController\", ['$scope', '$http', '$location',\n-  'AuthService', '$translate', '$translatePartialLoader', function ($scope, $http,\n-          $location, AuthService, $translate) {\n+angular.module(\"login\").controller(\"LoginController\", ['$scope', '$http', '$location', 'AuthService',\n+  function ($scope, $http, $location, AuthService) {\n \n     $scope.credentials = {\n       username: '',\n       password: '',\n       errorMessage: ''\n     };\n-    $scope.languages = {\n-      availableLanguages: [\n-        {id: '1', name: 'Italiano', code: 'it'},\n-        {id: '2', name: 'English', code: 'en'},\n-        {id: '3', name: 'Deutsch', code: 'de'}\n-      ],\n-      selectedLanguage: {id: '2', name: 'English', code: 'en'}\n-    };\n-    $scope.login = function (credentials) {\n \n+    $scope.login = function (credentials) {\n       AuthService.login($scope.credentials).then(function (user) {\n         console.info(\"Login success for: \", user);\n         // reset error message\n@@ -55,6 +46,7 @@ angular.module(\"login\").controller(\"LoginController\", ['$scope', '$http', '$loca\n         $scope.showError($scope.credentials.errorMessage, $scope.notification);\n       });\n     };\n+    \n     $scope.logout = function () {\n       AuthService.logout().then(function (response) {\n         console.info(\"Logout successfully\");\n@@ -91,7 +83,4 @@ angular.module(\"login\").controller(\"LoginController\", ['$scope', '$http', '$loca\n         console.debug(\"schemaAPI response: \", data);\n       });\n     };\n-    $scope.switchLanguage = function () {\n-      $translate.use($scope.languages.selectedLanguage.code);\n-    };\n   }]);"},{"sha":"fe880a325b07c481ecd6c0c5cabbadd18e9dc95f","filename":"client/enduser/src/main/resources/META-INF/resources/app/js/controllers/TailController.js","status":"removed","additions":0,"deletions":29,"changes":29,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/86b836b2a5502f0b9277354c3b1f4b4449c05632/client%2Fenduser%2Fsrc%2Fmain%2Fresources%2FMETA-INF%2Fresources%2Fapp%2Fjs%2Fcontrollers%2FTailController.js","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/86b836b2a5502f0b9277354c3b1f4b4449c05632/client%2Fenduser%2Fsrc%2Fmain%2Fresources%2FMETA-INF%2Fresources%2Fapp%2Fjs%2Fcontrollers%2FTailController.js","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/client%2Fenduser%2Fsrc%2Fmain%2Fresources%2FMETA-INF%2Fresources%2Fapp%2Fjs%2Fcontrollers%2FTailController.js?ref=86b836b2a5502f0b9277354c3b1f4b4449c05632","patch":"@@ -1,29 +0,0 @@\n-/* \n- * Licensed to the Apache Software Foundation (ASF) under one\n- * or more contributor license agreements.  See the NOTICE file\n- * distributed with this work for additional information\n- * regarding copyright ownership.  The ASF licenses this file\n- * to you under the Apache License, Version 2.0 (the\n- * \"License\"); you may not use this file except in compliance\n- * with the License.  You may obtain a copy of the License at\n- *\n- *   http://www.apache.org/licenses/LICENSE-2.0\n- *\n- * Unless required by applicable law or agreed to in writing,\n- * software distributed under the License is distributed on an\n- * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n- * KIND, either express or implied.  See the License for the\n- * specific language governing permissions and limitations\n- * under the License.\n- */\n-\n-'use strict';\n-\n-angular.module(\"self\")\n-        .controller(\"TailController\", ['$scope', '$rootScope', '$location',\n-                function ($scope, $rootScope, $location) {\n-                  $scope.redirect = function () {\n-                    $location.path('/self');\n-                    $rootScope.endReached = false;\n-                  };\n-                }]);"},{"sha":"45f038b54084260d7ccf7ef115e257b071ba10ba","filename":"client/enduser/src/main/resources/META-INF/resources/app/js/controllers/UserController.js","status":"modified","additions":28,"deletions":5,"changes":33,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/6a59c3311e8b160e6ea9851c65def972a76e730e/client%2Fenduser%2Fsrc%2Fmain%2Fresources%2FMETA-INF%2Fresources%2Fapp%2Fjs%2Fcontrollers%2FUserController.js","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/6a59c3311e8b160e6ea9851c65def972a76e730e/client%2Fenduser%2Fsrc%2Fmain%2Fresources%2FMETA-INF%2Fresources%2Fapp%2Fjs%2Fcontrollers%2FUserController.js","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/client%2Fenduser%2Fsrc%2Fmain%2Fresources%2FMETA-INF%2Fresources%2Fapp%2Fjs%2Fcontrollers%2FUserController.js?ref=6a59c3311e8b160e6ea9851c65def972a76e730e","patch":"@@ -23,9 +23,9 @@\n \n angular.module(\"self\").controller(\"UserController\", ['$scope', '$rootScope', '$location', '$compile', \"$state\",\n   'AuthService', 'UserSelfService', 'SchemaService', 'RealmService', 'ResourceService', 'SecurityQuestionService',\n-  'GroupService', 'AnyService', 'UserUtil', 'GenericUtil', \"ValidationExecutor\",\n+  'GroupService', 'AnyService', 'UserUtil', 'GenericUtil', 'ValidationExecutor', '$translate',\n   function ($scope, $rootScope, $location, $compile, $state, AuthService, UserSelfService, SchemaService, RealmService,\n-          ResourceService, SecurityQuestionService, GroupService, AnyService, UserUtil, GenericUtil, ValidationExecutor) {\n+          ResourceService, SecurityQuestionService, GroupService, AnyService, UserUtil, GenericUtil, ValidationExecutor, $translate) {\n \n     $scope.user = {};\n     $scope.confirmPassword = {\n@@ -244,11 +244,11 @@ angular.module(\"self\").controller(\"UserController\", ['$scope', '$rootScope', '$l\n           $scope.user = UserUtil.getUnwrappedUser(response);\n           $scope.user.password = undefined;\n \n-          \n+\n           $scope.initialSecurityQuestion = $scope.user.securityQuestion;\n           // initialize already assigned resources\n           $scope.dynamicForm.selectedResources = $scope.user.resources;\n- \n+\n           // initialize already assigned groups -- keeping the same structure of groups       \n           for (var index in $scope.user.memberships) {\n             $scope.dynamicForm.selectedGroups.push(\n@@ -267,7 +267,7 @@ angular.module(\"self\").controller(\"UserController\", ['$scope', '$rootScope', '$l\n             $scope.$emit(\"groupAdded\", $scope.user.memberships[index].groupName);\n           }\n           if ($scope.user.mustChangePassword) {\n-            $location.path('/mustchangepassword')\n+            $location.path('/mustchangepassword');\n           } else {\n             initProperties();\n           }\n@@ -439,6 +439,7 @@ angular.module(\"self\").controller(\"UserController\", ['$scope', '$rootScope', '$l\n           console.info(\"User \" + $scope.user.username);\n           $rootScope.currentUser = $scope.user.username;\n           $rootScope.currentOp = \"PASSWORD_UPDATED\";\n+          $translate.use($scope.languages.selectedLanguage.code);\n           $state.go('success');\n         }, function (response) {\n           var errorMessage;\n@@ -467,6 +468,7 @@ angular.module(\"self\").controller(\"UserController\", ['$scope', '$rootScope', '$l\n           if (user && user.password && token) {\n             UserSelfService.confirmPasswordReset({\"newPassword\": user.password, \"token\": token}).then(function (data) {\n               $scope.showSuccess(data, $scope.notification);\n+              $translate.use($scope.languages.selectedLanguage.code);\n               $location.path('/self');\n             }, function (response) {\n               var errorMessage;\n@@ -510,9 +512,23 @@ angular.module(\"self\").controller(\"UserController\", ['$scope', '$rootScope', '$l\n       }\n     };\n \n+    $scope.languages = {\n+      availableLanguages: [\n+        {id: '1', name: 'Italiano', code: 'it'},\n+        {id: '2', name: 'English', code: 'en'},\n+        {id: '3', name: 'Deutsch', code: 'de'}\n+      ],\n+      selectedLanguage: {id: '2', name: 'English', code: 'en'}\n+    };\n+\n+    $scope.switchLanguage = function () {\n+      $translate.use($scope.languages.selectedLanguage.code);\n+    };\n+\n     $scope.logout = function (message) {\n       AuthService.logout().then(function (response) {\n         console.info(\"Logout successfully\");\n+        $translate.use($scope.languages.selectedLanguage.code);\n         $rootScope.endReached = false;\n         $location.path('/self');\n         if (message) {\n@@ -523,6 +539,13 @@ angular.module(\"self\").controller(\"UserController\", ['$scope', '$rootScope', '$l\n       });\n     };\n \n+    $scope.redirect = function () {\n+      console.log(\"$scope.languages.selectedLanguage.code\", $scope.languages.selectedLanguage.code);\n+      $translate.use($scope.languages.selectedLanguage.code);\n+      $location.path('/self');\n+      $rootScope.endReached = false;\n+    };\n+\n     $scope.finish = function (message) {\n       console.info(\"finish\");\n       if ($scope.createMode) {"},{"sha":"aee0509a0fe9272184ef4098550aea142c602169","filename":"client/enduser/src/main/resources/META-INF/resources/app/views/editUser.html","status":"modified","additions":1,"deletions":1,"changes":2,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/6a59c3311e8b160e6ea9851c65def972a76e730e/client%2Fenduser%2Fsrc%2Fmain%2Fresources%2FMETA-INF%2Fresources%2Fapp%2Fviews%2FeditUser.html","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/6a59c3311e8b160e6ea9851c65def972a76e730e/client%2Fenduser%2Fsrc%2Fmain%2Fresources%2FMETA-INF%2Fresources%2Fapp%2Fviews%2FeditUser.html","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/client%2Fenduser%2Fsrc%2Fmain%2Fresources%2FMETA-INF%2Fresources%2Fapp%2Fviews%2FeditUser.html?ref=6a59c3311e8b160e6ea9851c65def972a76e730e","patch":"@@ -31,7 +31,7 @@\n           <div class=\"row\">\n             <div growl reference=\"2\" inline=\"true\"></div>              \n             <div id=\"status-buttons\" class=\"btn-group btn-breadcrumb\">\n-              <a href=\"#/self\" class=\"btn btn-default\" ng-show=\"createMode\"><i class=\"glyphicon glyphicon-home\"></i></a>\n+              <a href=\"#/self\" class=\"btn btn-default\" ng-show=\"createMode\" ng-click=\"logout()\"><i class=\"glyphicon glyphicon-home\"></i></a>\n               <a id=\"logout\" class=\"btn btn-default\" ng-show=\"!createMode\" ng-click=\"logout()\"><i class=\"glyphicon glyphicon-off\"style=\"color:red\"></i></a>\n               <!--add class breadcrumb-disabled-link to buttons to prevent click-->              \n               <a ng-repeat=\"(key, value) in wizard\" ui-sref-active=\"active\" ui-sref=\".{{key}}\" class=\"btn btn-default\" "},{"sha":"6c0f8e1f3b3eb18298af7ec5856b4e9810ae7a56","filename":"client/enduser/src/main/resources/META-INF/resources/app/views/passwordreset.html","status":"modified","additions":2,"deletions":2,"changes":4,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/6a59c3311e8b160e6ea9851c65def972a76e730e/client%2Fenduser%2Fsrc%2Fmain%2Fresources%2FMETA-INF%2Fresources%2Fapp%2Fviews%2Fpasswordreset.html","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/6a59c3311e8b160e6ea9851c65def972a76e730e/client%2Fenduser%2Fsrc%2Fmain%2Fresources%2FMETA-INF%2Fresources%2Fapp%2Fviews%2Fpasswordreset.html","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/client%2Fenduser%2Fsrc%2Fmain%2Fresources%2FMETA-INF%2Fresources%2Fapp%2Fviews%2Fpasswordreset.html?ref=6a59c3311e8b160e6ea9851c65def972a76e730e","patch":"@@ -29,7 +29,7 @@\n \n           <div class=\"row\">            \n             <div id=\"status-buttons\" class=\"btn-group btn-breadcrumb\">\n-              <a href=\"#/self\" class=\"btn btn-default\"><i class=\"glyphicon glyphicon-home\"></i></a>\n+              <a href=\"#/self\" class=\"btn btn-default\" ng-click=\"logout()\"><i class=\"glyphicon glyphicon-home\"></i></a>\n               <!--add class breadcrumb-disabled-link to buttons to prevent click-->\n               <a ui-sref-active=\"active\" class=\"btn btn-default\">{{'USERDETAILS'| translate}}</a>\n             </div>\n@@ -63,7 +63,7 @@\n               </div>\n               <button id=\"resetpassword\" type=\"submit\" class=\"btn btn-default pull-right\">{{'SUBMIT'| translate}}</button>\n               <div class=\"pull-left\">\n-                <a id=\"cancel\" href=\"#/self\" class=\"btn btn-danger\">{{'CANCEL'| translate}}</a>\n+                <a id=\"cancel\" href=\"#/self\" class=\"btn btn-danger\" ng-click=\"logout()\">{{'CANCEL'| translate}}</a>\n               </div>\n             </div>\n           </div>"},{"sha":"eeb9266b2f936672f85e19d30c6ddd451d508c79","filename":"client/enduser/src/main/resources/META-INF/resources/app/views/self.html","status":"modified","additions":1,"deletions":1,"changes":2,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/6a59c3311e8b160e6ea9851c65def972a76e730e/client%2Fenduser%2Fsrc%2Fmain%2Fresources%2FMETA-INF%2Fresources%2Fapp%2Fviews%2Fself.html","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/6a59c3311e8b160e6ea9851c65def972a76e730e/client%2Fenduser%2Fsrc%2Fmain%2Fresources%2FMETA-INF%2Fresources%2Fapp%2Fviews%2Fself.html","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/client%2Fenduser%2Fsrc%2Fmain%2Fresources%2FMETA-INF%2Fresources%2Fapp%2Fviews%2Fself.html?ref=6a59c3311e8b160e6ea9851c65def972a76e730e","patch":"@@ -41,7 +41,7 @@\n                   <input type=\"password\" class=\"form-control\" id=\"login-password\" placeholder=\"{{'PASSWORD_PLACEHOLDER'| translate}}\" \n                          ng-required ng-model=\"credentials.password\">\n                 </div>\n-                <div class=\"form-group\">\n+                <div class=\"form-group\" ng-controller=\"UserController\">\n                   <select  ng-change=\"switchLanguage()\" id=\"language\" style=\"width: 100%\" class=\"btn dropdown-toggle btn-default\" \n                            ng-options=\"language.name for language in languages.availableLanguages track by language.id\" \n                            ng-model=\"languages.selectedLanguage\"></select>"},{"sha":"1be0c9a93de8d9c8d3649a11bb296ee511266dac","filename":"client/enduser/src/main/resources/META-INF/resources/app/views/success.html","status":"modified","additions":1,"deletions":1,"changes":2,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/6a59c3311e8b160e6ea9851c65def972a76e730e/client%2Fenduser%2Fsrc%2Fmain%2Fresources%2FMETA-INF%2Fresources%2Fapp%2Fviews%2Fsuccess.html","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/6a59c3311e8b160e6ea9851c65def972a76e730e/client%2Fenduser%2Fsrc%2Fmain%2Fresources%2FMETA-INF%2Fresources%2Fapp%2Fviews%2Fsuccess.html","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/client%2Fenduser%2Fsrc%2Fmain%2Fresources%2FMETA-INF%2Fresources%2Fapp%2Fviews%2Fsuccess.html?ref=6a59c3311e8b160e6ea9851c65def972a76e730e","patch":"@@ -20,7 +20,7 @@\n <div ng-cloak class=\"container\">\n   <div class=\"login-container\" style=\"box-sizing: border-box; \">\n     <div id=\"form-container\" class=\"col-md-6 col-md-offset-3\" style=\"box-sizing: border-box; background-color: #F7F7F7;\">\n-      <div ng-controller=\"TailController\">\n+      <div ng-controller=\"UserController\">\n         <div class=\"page-header\" style=\"text-align: left; font-weight: 700;\">          \n           <span>{{'USER'| translate}} <b> {{currentUser}}</b> {{currentOp| translate}}</span>\n         </div>"}]}