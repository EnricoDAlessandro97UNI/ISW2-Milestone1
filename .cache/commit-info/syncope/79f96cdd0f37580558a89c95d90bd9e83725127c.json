{"sha":"79f96cdd0f37580558a89c95d90bd9e83725127c","node_id":"MDY6Q29tbWl0NjM2ODc5MDYyOjc5Zjk2Y2RkMGYzNzU4MDU1OGE4OWM5NWQ5MGJkOWU4MzcyNTEyN2M=","commit":{"author":{"name":"Francesco Chicchiriccò","email":"ilgrosso@apache.org","date":"2017-09-27T10:43:04Z"},"committer":{"name":"Francesco Chicchiriccò","email":"ilgrosso@apache.org","date":"2017-09-27T10:52:44Z"},"message":"[SYNCOPE-1212] On PropagationTask execution","tree":{"sha":"d330651365dbbe99a5daec83d9ee7476b0a891c0","url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/git/trees/d330651365dbbe99a5daec83d9ee7476b0a891c0"},"url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/git/commits/79f96cdd0f37580558a89c95d90bd9e83725127c","comment_count":0,"verification":{"verified":false,"reason":"unsigned","signature":null,"payload":null}},"url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/79f96cdd0f37580558a89c95d90bd9e83725127c","html_url":"https://github.com/EnricoDAlessandro97UNI/syncope/commit/79f96cdd0f37580558a89c95d90bd9e83725127c","comments_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/79f96cdd0f37580558a89c95d90bd9e83725127c/comments","author":{"login":"ilgrosso","id":1064664,"node_id":"MDQ6VXNlcjEwNjQ2NjQ=","avatar_url":"https://avatars.githubusercontent.com/u/1064664?v=4","gravatar_id":"","url":"https://api.github.com/users/ilgrosso","html_url":"https://github.com/ilgrosso","followers_url":"https://api.github.com/users/ilgrosso/followers","following_url":"https://api.github.com/users/ilgrosso/following{/other_user}","gists_url":"https://api.github.com/users/ilgrosso/gists{/gist_id}","starred_url":"https://api.github.com/users/ilgrosso/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ilgrosso/subscriptions","organizations_url":"https://api.github.com/users/ilgrosso/orgs","repos_url":"https://api.github.com/users/ilgrosso/repos","events_url":"https://api.github.com/users/ilgrosso/events{/privacy}","received_events_url":"https://api.github.com/users/ilgrosso/received_events","type":"User","site_admin":false},"committer":{"login":"ilgrosso","id":1064664,"node_id":"MDQ6VXNlcjEwNjQ2NjQ=","avatar_url":"https://avatars.githubusercontent.com/u/1064664?v=4","gravatar_id":"","url":"https://api.github.com/users/ilgrosso","html_url":"https://github.com/ilgrosso","followers_url":"https://api.github.com/users/ilgrosso/followers","following_url":"https://api.github.com/users/ilgrosso/following{/other_user}","gists_url":"https://api.github.com/users/ilgrosso/gists{/gist_id}","starred_url":"https://api.github.com/users/ilgrosso/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ilgrosso/subscriptions","organizations_url":"https://api.github.com/users/ilgrosso/orgs","repos_url":"https://api.github.com/users/ilgrosso/repos","events_url":"https://api.github.com/users/ilgrosso/events{/privacy}","received_events_url":"https://api.github.com/users/ilgrosso/received_events","type":"User","site_admin":false},"parents":[{"sha":"678bff96de895026a31640c5ae0557cd281504fa","url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/678bff96de895026a31640c5ae0557cd281504fa","html_url":"https://github.com/EnricoDAlessandro97UNI/syncope/commit/678bff96de895026a31640c5ae0557cd281504fa"}],"stats":{"total":39,"additions":19,"deletions":20},"files":[{"sha":"8e6485fe40e2c796a2138f740326d80562ce9793","filename":"core/persistence-jpa/src/main/java/org/apache/syncope/core/persistence/jpa/dao/JPAExternalResourceDAO.java","status":"modified","additions":9,"deletions":9,"changes":18,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/79f96cdd0f37580558a89c95d90bd9e83725127c/core%2Fpersistence-jpa%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fpersistence%2Fjpa%2Fdao%2FJPAExternalResourceDAO.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/79f96cdd0f37580558a89c95d90bd9e83725127c/core%2Fpersistence-jpa%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fpersistence%2Fjpa%2Fdao%2FJPAExternalResourceDAO.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fpersistence-jpa%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fpersistence%2Fjpa%2Fdao%2FJPAExternalResourceDAO.java?ref=79f96cdd0f37580558a89c95d90bd9e83725127c","patch":"@@ -293,15 +293,15 @@ public void delete(final String name) {\n         policyDAO().findByResource(resource).\n                 forEach(policy -> policy.getResources().remove(resource));\n \n-        resource.getProvisions().stream().map(provision -> {\n-            provision.getMapping().getItems().forEach(item -> item.setMapping(null));\n-            return provision;\n-        }).map(provision -> {\n-            provision.getMapping().getItems().clear();\n-            provision.setMapping(null);\n-            provision.setResource(null);\n-            return provision;\n-        }).forEachOrdered(provision -> virSchemaDAO().findByProvision(provision).\n+        resource.getProvisions().stream().\n+                filter(provision -> provision.getMapping() != null).\n+                peek(provision -> provision.getMapping().getItems().forEach(item -> item.setMapping(null))).\n+                peek(provision -> {\n+                    provision.getMapping().getItems().clear();\n+                    provision.setMapping(null);\n+                    provision.setResource(null);\n+                }).\n+                forEachOrdered(provision -> virSchemaDAO().findByProvision(provision).\n                 forEach(schema -> virSchemaDAO().delete(schema.getKey())));\n \n         externalResourceHistoryConfDAO().deleteByEntity(resource);"},{"sha":"8283df0e689d610b91a82ea0f19cc69beb63d1ae","filename":"core/persistence-jpa/src/main/java/org/apache/syncope/core/persistence/jpa/entity/resource/JPAExternalResource.java","status":"modified","additions":0,"deletions":1,"changes":1,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/79f96cdd0f37580558a89c95d90bd9e83725127c/core%2Fpersistence-jpa%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fpersistence%2Fjpa%2Fentity%2Fresource%2FJPAExternalResource.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/79f96cdd0f37580558a89c95d90bd9e83725127c/core%2Fpersistence-jpa%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fpersistence%2Fjpa%2Fentity%2Fresource%2FJPAExternalResource.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fpersistence-jpa%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fpersistence%2Fjpa%2Fentity%2Fresource%2FJPAExternalResource.java?ref=79f96cdd0f37580558a89c95d90bd9e83725127c","patch":"@@ -89,7 +89,6 @@ public class JPAExternalResource extends AbstractProvidedKeyEntity implements Ex\n      * The resource type is identified by the associated connector.\n      */\n     @ManyToOne(fetch = FetchType.EAGER, cascade = { CascadeType.MERGE })\n-    @NotNull\n     private JPAConnInstance connector;\n \n     @OneToMany(cascade = CascadeType.ALL, orphanRemoval = true, fetch = FetchType.LAZY, mappedBy = \"resource\")"},{"sha":"e13864ef1545bb7cceb8a42707d08960d4bae998","filename":"core/provisioning-java/src/main/java/org/apache/syncope/core/provisioning/java/propagation/DefaultPropagationTaskCallable.java","status":"renamed","additions":9,"deletions":9,"changes":18,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/79f96cdd0f37580558a89c95d90bd9e83725127c/core%2Fprovisioning-java%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fprovisioning%2Fjava%2Fpropagation%2FDefaultPropagationTaskCallable.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/79f96cdd0f37580558a89c95d90bd9e83725127c/core%2Fprovisioning-java%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fprovisioning%2Fjava%2Fpropagation%2FDefaultPropagationTaskCallable.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fprovisioning-java%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fprovisioning%2Fjava%2Fpropagation%2FDefaultPropagationTaskCallable.java?ref=79f96cdd0f37580558a89c95d90bd9e83725127c","patch":"@@ -36,23 +36,23 @@\n import org.springframework.transaction.annotation.Transactional;\n \n @Transactional(rollbackFor = { Throwable.class })\n-public class PropagationTaskCallableImpl implements PropagationTaskCallable {\n+public class DefaultPropagationTaskCallable implements PropagationTaskCallable {\n \n-    private static final Logger LOG = LoggerFactory.getLogger(PropagationTaskCallable.class);\n+    protected static final Logger LOG = LoggerFactory.getLogger(PropagationTaskCallable.class);\n \n-    private final String domain;\n+    protected final String domain;\n \n-    private final String username;\n+    protected final String username;\n \n-    private final Collection<? extends GrantedAuthority> authorities;\n+    protected final Collection<? extends GrantedAuthority> authorities;\n \n-    private AbstractPropagationTaskExecutor executor;\n+    protected AbstractPropagationTaskExecutor executor;\n \n-    private PropagationTask task;\n+    protected PropagationTask task;\n \n-    private PropagationReporter reporter;\n+    protected PropagationReporter reporter;\n \n-    public PropagationTaskCallableImpl() {\n+    public DefaultPropagationTaskCallable() {\n         SecurityContext ctx = SecurityContextHolder.getContext();\n         domain = AuthContextUtils.getDomain();\n         username = ctx.getAuthentication().getName();","previous_filename":"core/provisioning-java/src/main/java/org/apache/syncope/core/provisioning/java/propagation/PropagationTaskCallableImpl.java"},{"sha":"c7f9ee5fb9f525a15daf640850a9caa8a996b4aa","filename":"core/provisioning-java/src/main/java/org/apache/syncope/core/provisioning/java/propagation/PriorityPropagationTaskExecutor.java","status":"modified","additions":1,"deletions":1,"changes":2,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/79f96cdd0f37580558a89c95d90bd9e83725127c/core%2Fprovisioning-java%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fprovisioning%2Fjava%2Fpropagation%2FPriorityPropagationTaskExecutor.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/79f96cdd0f37580558a89c95d90bd9e83725127c/core%2Fprovisioning-java%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fprovisioning%2Fjava%2Fpropagation%2FPriorityPropagationTaskExecutor.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fprovisioning-java%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fprovisioning%2Fjava%2Fpropagation%2FPriorityPropagationTaskExecutor.java?ref=79f96cdd0f37580558a89c95d90bd9e83725127c","patch":"@@ -68,7 +68,7 @@ protected PropagationTaskCallable newPropagationTaskCallable(\n             final PropagationTask task, final PropagationReporter reporter) {\n \n         PropagationTaskCallable callable = (PropagationTaskCallable) ApplicationContextProvider.getBeanFactory().\n-                createBean(PropagationTaskCallableImpl.class, AbstractBeanDefinition.AUTOWIRE_BY_TYPE, false);\n+                createBean(DefaultPropagationTaskCallable.class, AbstractBeanDefinition.AUTOWIRE_BY_TYPE, false);\n         callable.setExecutor(this);\n         callable.setTask(task);\n         callable.setReporter(reporter);"}]}