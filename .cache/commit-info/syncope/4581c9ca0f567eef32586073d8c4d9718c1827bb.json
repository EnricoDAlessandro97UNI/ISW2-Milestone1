{"sha":"4581c9ca0f567eef32586073d8c4d9718c1827bb","node_id":"C_kwDOJfYA1toAKDQ1ODFjOWNhMGY1NjdlZWYzMjU4NjA3M2Q4YzRkOTcxOGMxODI3YmI","commit":{"author":{"name":"SamuelGaro","email":"72073457+SamuelGaro@users.noreply.github.com","date":"2022-02-24T17:05:39Z"},"committer":{"name":"GitHub","email":"noreply@github.com","date":"2022-02-24T17:05:39Z"},"message":"[SYNCOPE-1664] JSONB: Inconsistent search query when is used a pull correlation rule (#317)","tree":{"sha":"35961b843b1229a1da447c79359c1c6e21b353ec","url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/git/trees/35961b843b1229a1da447c79359c1c6e21b353ec"},"url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/git/commits/4581c9ca0f567eef32586073d8c4d9718c1827bb","comment_count":0,"verification":{"verified":true,"reason":"valid","signature":"-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJiF7rkCRBK7hj4Ov3rIwAAj10IAHDW1i4DoTbQ/Yb+nhUDM7ui\nB5mxn8Zo077Y+jJEJusfDuy3shJI3CylgoBaqQacgoFKd9xS9Jtp8cQPn6NiV7uD\nAsYF4OXC8KB0FMbW80yBGrNZ/6nGtXUMH75ihFrFaAzEKgI8yIRNVtlIor4lkyyU\n8SaDhoUyiZLZ3yePkLAwp2OiZGCYsaOPKp090jmqXvVMdyehE65x6acwJsCHxlpS\n25EcQ4TXne9gq8UJnjsKn9Qeo6hQTNG3rtCsBZ5mMujDrK8Ea1hcxZw//NcFPws4\nqO2KCYP7CDnUztHM3R/51c7ZYmgFIe4GJOoA2aXWOAhIK5r5iRyE/B85ZGovPVQ=\n=jqax\n-----END PGP SIGNATURE-----\n","payload":"tree 35961b843b1229a1da447c79359c1c6e21b353ec\nparent f550fe30631fd72aace3222b1730699415cb4d8d\nauthor SamuelGaro <72073457+SamuelGaro@users.noreply.github.com> 1645722339 +0100\ncommitter GitHub <noreply@github.com> 1645722339 +0100\n\n[SYNCOPE-1664] JSONB: Inconsistent search query when is used a pull correlation rule (#317)\n\n"}},"url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/4581c9ca0f567eef32586073d8c4d9718c1827bb","html_url":"https://github.com/EnricoDAlessandro97UNI/syncope/commit/4581c9ca0f567eef32586073d8c4d9718c1827bb","comments_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/4581c9ca0f567eef32586073d8c4d9718c1827bb/comments","author":{"login":"SamuelGaro","id":72073457,"node_id":"MDQ6VXNlcjcyMDczNDU3","avatar_url":"https://avatars.githubusercontent.com/u/72073457?v=4","gravatar_id":"","url":"https://api.github.com/users/SamuelGaro","html_url":"https://github.com/SamuelGaro","followers_url":"https://api.github.com/users/SamuelGaro/followers","following_url":"https://api.github.com/users/SamuelGaro/following{/other_user}","gists_url":"https://api.github.com/users/SamuelGaro/gists{/gist_id}","starred_url":"https://api.github.com/users/SamuelGaro/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/SamuelGaro/subscriptions","organizations_url":"https://api.github.com/users/SamuelGaro/orgs","repos_url":"https://api.github.com/users/SamuelGaro/repos","events_url":"https://api.github.com/users/SamuelGaro/events{/privacy}","received_events_url":"https://api.github.com/users/SamuelGaro/received_events","type":"User","site_admin":false},"committer":{"login":"web-flow","id":19864447,"node_id":"MDQ6VXNlcjE5ODY0NDQ3","avatar_url":"https://avatars.githubusercontent.com/u/19864447?v=4","gravatar_id":"","url":"https://api.github.com/users/web-flow","html_url":"https://github.com/web-flow","followers_url":"https://api.github.com/users/web-flow/followers","following_url":"https://api.github.com/users/web-flow/following{/other_user}","gists_url":"https://api.github.com/users/web-flow/gists{/gist_id}","starred_url":"https://api.github.com/users/web-flow/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/web-flow/subscriptions","organizations_url":"https://api.github.com/users/web-flow/orgs","repos_url":"https://api.github.com/users/web-flow/repos","events_url":"https://api.github.com/users/web-flow/events{/privacy}","received_events_url":"https://api.github.com/users/web-flow/received_events","type":"User","site_admin":false},"parents":[{"sha":"f550fe30631fd72aace3222b1730699415cb4d8d","url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/f550fe30631fd72aace3222b1730699415cb4d8d","html_url":"https://github.com/EnricoDAlessandro97UNI/syncope/commit/f550fe30631fd72aace3222b1730699415cb4d8d"}],"stats":{"total":4,"additions":3,"deletions":1},"files":[{"sha":"b8a009e7fed3268a99f0d6749ce290fcc4539374","filename":"core/persistence-jpa-json/src/main/java/org/apache/syncope/core/persistence/jpa/dao/PGJPAJSONAnySearchDAO.java","status":"modified","additions":3,"deletions":1,"changes":4,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/4581c9ca0f567eef32586073d8c4d9718c1827bb/core%2Fpersistence-jpa-json%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fpersistence%2Fjpa%2Fdao%2FPGJPAJSONAnySearchDAO.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/4581c9ca0f567eef32586073d8c4d9718c1827bb/core%2Fpersistence-jpa-json%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fpersistence%2Fjpa%2Fdao%2FPGJPAJSONAnySearchDAO.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fpersistence-jpa-json%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fpersistence%2Fjpa%2Fdao%2FPGJPAJSONAnySearchDAO.java?ref=4581c9ca0f567eef32586073d8c4d9718c1827bb","patch":"@@ -200,8 +200,10 @@ protected void fillAttrQuery(\n                 case EQ:\n                     query.append(\"jsonb_path_exists(\").append(schema.getKey()).append(\", '$[*] ? \").\n                             append(\"(@.\").append(key);\n-                    if (isStr) {\n+                    if (StringUtils.containsAny(value, POSTGRESQL_REGEX_CHARS) || lower) {\n                         query.append(\" like_regex \\\"\").append(escapeForLikeRegex(value).replace(\"'\", \"''\")).append('\"');\n+                    } else if (isStr) {\n+                        query.append(\" == \\\"\").append(value.replace(\"'\", \"''\")).append('\"');\n                     } else {\n                         query.append(\" == \").append(value);\n                     }"}]}