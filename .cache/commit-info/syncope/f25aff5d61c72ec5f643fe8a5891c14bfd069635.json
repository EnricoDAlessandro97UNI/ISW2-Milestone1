{"sha":"f25aff5d61c72ec5f643fe8a5891c14bfd069635","node_id":"MDY6Q29tbWl0NjM2ODc5MDYyOmYyNWFmZjVkNjFjNzJlYzVmNjQzZmU4YTU4OTFjMTRiZmQwNjk2MzU=","commit":{"author":{"name":"Marco Di Sabatino Di Diodoro","email":"mdisabatino@apache.org","date":"2014-05-16T14:56:51Z"},"committer":{"name":"Marco Di Sabatino Di Diodoro","email":"mdisabatino@apache.org","date":"2014-05-16T14:56:51Z"},"message":"[SYNCOPE-444] Improved handling of notification recipients\n\ngit-svn-id: https://svn.apache.org/repos/asf/syncope/trunk@1595224 13f79535-47bb-0310-9956-ffa450edef68","tree":{"sha":"79c499825a14ae5ef98057b7a315e16f991e6a68","url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/git/trees/79c499825a14ae5ef98057b7a315e16f991e6a68"},"url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/git/commits/f25aff5d61c72ec5f643fe8a5891c14bfd069635","comment_count":0,"verification":{"verified":false,"reason":"unsigned","signature":null,"payload":null}},"url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/f25aff5d61c72ec5f643fe8a5891c14bfd069635","html_url":"https://github.com/EnricoDAlessandro97UNI/syncope/commit/f25aff5d61c72ec5f643fe8a5891c14bfd069635","comments_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/f25aff5d61c72ec5f643fe8a5891c14bfd069635/comments","author":{"login":"mdisabatino","id":1792527,"node_id":"MDQ6VXNlcjE3OTI1Mjc=","avatar_url":"https://avatars.githubusercontent.com/u/1792527?v=4","gravatar_id":"","url":"https://api.github.com/users/mdisabatino","html_url":"https://github.com/mdisabatino","followers_url":"https://api.github.com/users/mdisabatino/followers","following_url":"https://api.github.com/users/mdisabatino/following{/other_user}","gists_url":"https://api.github.com/users/mdisabatino/gists{/gist_id}","starred_url":"https://api.github.com/users/mdisabatino/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mdisabatino/subscriptions","organizations_url":"https://api.github.com/users/mdisabatino/orgs","repos_url":"https://api.github.com/users/mdisabatino/repos","events_url":"https://api.github.com/users/mdisabatino/events{/privacy}","received_events_url":"https://api.github.com/users/mdisabatino/received_events","type":"User","site_admin":false},"committer":{"login":"mdisabatino","id":1792527,"node_id":"MDQ6VXNlcjE3OTI1Mjc=","avatar_url":"https://avatars.githubusercontent.com/u/1792527?v=4","gravatar_id":"","url":"https://api.github.com/users/mdisabatino","html_url":"https://github.com/mdisabatino","followers_url":"https://api.github.com/users/mdisabatino/followers","following_url":"https://api.github.com/users/mdisabatino/following{/other_user}","gists_url":"https://api.github.com/users/mdisabatino/gists{/gist_id}","starred_url":"https://api.github.com/users/mdisabatino/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mdisabatino/subscriptions","organizations_url":"https://api.github.com/users/mdisabatino/orgs","repos_url":"https://api.github.com/users/mdisabatino/repos","events_url":"https://api.github.com/users/mdisabatino/events{/privacy}","received_events_url":"https://api.github.com/users/mdisabatino/received_events","type":"User","site_admin":false},"parents":[{"sha":"c58b3c763994d40dd5464a3aa5af369393017028","url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/c58b3c763994d40dd5464a3aa5af369393017028","html_url":"https://github.com/EnricoDAlessandro97UNI/syncope/commit/c58b3c763994d40dd5464a3aa5af369393017028"}],"stats":{"total":127,"additions":95,"deletions":32},"files":[{"sha":"446ec2fe1b866c4e75dd070557ca01f3875fd02a","filename":"console/src/main/java/org/apache/syncope/console/pages/NotificationModalPage.java","status":"modified","additions":64,"deletions":19,"changes":83,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/f25aff5d61c72ec5f643fe8a5891c14bfd069635/console%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fconsole%2Fpages%2FNotificationModalPage.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/f25aff5d61c72ec5f643fe8a5891c14bfd069635/console%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fconsole%2Fpages%2FNotificationModalPage.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/console%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fconsole%2Fpages%2FNotificationModalPage.java?ref=f25aff5d61c72ec5f643fe8a5891c14bfd069635","patch":"@@ -172,44 +172,60 @@ protected String[] getChangeRoles() {\n \n         form.add(recipientsContainer);\n \n+        final AjaxCheckBoxPanel checkStaticRecipients = new AjaxCheckBoxPanel(\"checkStaticRecipients\",\n+                \"recipients\", new Model<Boolean>(!notificationTO.getStaticRecipients().isEmpty()));\n+        form.add(checkStaticRecipients);\n+\n+        if (createFlag) {\n+            checkStaticRecipients.getField().setDefaultModelObject(Boolean.FALSE);\n+        }\n+\n         final AjaxTextFieldPanel staticRecipientsFieldPanel\n                 = new AjaxTextFieldPanel(\"panel\", \"staticRecipients\", new Model<String>(null));\n         staticRecipientsFieldPanel.addValidator(EmailAddressValidator.getInstance());\n+        staticRecipientsFieldPanel.setRequired(checkStaticRecipients.getModelObject());\n \n         if (notificationTO.getStaticRecipients().isEmpty()) {\n             notificationTO.getStaticRecipients().add(null);\n         }\n-        \n+\n         final MultiFieldPanel staticRecipients = new MultiFieldPanel(\"staticRecipients\",\n                 new PropertyModel<List<String>>(notificationTO, \"staticRecipients\"), staticRecipientsFieldPanel);\n-\n+        staticRecipients.setEnabled(checkStaticRecipients.getModelObject());\n         form.add(staticRecipients);\n \n-        final AjaxCheckBoxPanel selfAsRecipient = new AjaxCheckBoxPanel(\"selfAsRecipient\",\n-                getString(\"selfAsRecipient\"), new PropertyModel<Boolean>(notificationTO, \"selfAsRecipient\"));\n-        form.add(selfAsRecipient);\n+        final AjaxCheckBoxPanel checkRecipients\n+                = new AjaxCheckBoxPanel(\"checkRecipients\", \"checkRecipients\",\n+                        new Model<Boolean>(notificationTO.getRecipients() == null ? false : true));\n+        recipientsContainer.add(checkRecipients);\n \n         if (createFlag) {\n-            selfAsRecipient.getField().setDefaultModelObject(Boolean.TRUE);\n+            checkRecipients.getField().setDefaultModelObject(Boolean.TRUE);\n         }\n \n-        final AjaxCheckBoxPanel checkRecipients =\n-                new AjaxCheckBoxPanel(\"checkRecipients\", \"checkRecipients\",\n-                        new Model<Boolean>(notificationTO.getRecipients() == null ? false : true));\n-        recipientsContainer.add(checkRecipients);\n-\n-        final UserSearchPanel recipients =\n-                new UserSearchPanel.Builder(\"recipients\").fiql(notificationTO.getRecipients()).build();\n-        recipientsContainer.add(recipients);\n+        final UserSearchPanel recipients\n+                = new UserSearchPanel.Builder(\"recipients\").fiql(notificationTO.getRecipients()).build();\n+        \n         recipients.setEnabled(checkRecipients.getModelObject());\n+        recipientsContainer.add(recipients);\n \n+        final AjaxCheckBoxPanel selfAsRecipient = new AjaxCheckBoxPanel(\"selfAsRecipient\",\n+                getString(\"selfAsRecipient\"), new PropertyModel<Boolean>(notificationTO, \"selfAsRecipient\"));\n+        form.add(selfAsRecipient);\n+\n+        if (createFlag) {\n+            selfAsRecipient.getField().setDefaultModelObject(Boolean.FALSE);\n+        }\n+ \n         selfAsRecipient.getField().add(new AjaxFormComponentUpdatingBehavior(Constants.ON_CHANGE) {\n \n             private static final long serialVersionUID = -1107858522700306810L;\n \n             @Override\n             protected void onUpdate(final AjaxRequestTarget target) {\n-                if (!Boolean.valueOf(selfAsRecipient.getField().getValue())) {\n+                if (!selfAsRecipient.getModelObject()\n+                        && !checkRecipients.getModelObject()\n+                        && !checkStaticRecipients.getModelObject()) {\n                     checkRecipients.getField().setDefaultModelObject(Boolean.TRUE);\n                     target.add(checkRecipients);\n                     recipients.setEnabled(checkRecipients.getModelObject());\n@@ -225,16 +241,45 @@ protected void onUpdate(final AjaxRequestTarget target) {\n \n             @Override\n             protected void onUpdate(final AjaxRequestTarget target) {\n-                if (!checkRecipients.getModelObject()) {\n-                    selfAsRecipient.getField().setDefaultModelObject(Boolean.TRUE);\n-                    target.add(selfAsRecipient);\n+                if (!checkRecipients.getModelObject()\n+                        && !selfAsRecipient.getModelObject()\n+                        && !checkStaticRecipients.getModelObject()) {\n+                    checkStaticRecipients.getField().setDefaultModelObject(Boolean.TRUE);\n+                    target.add(checkStaticRecipients);\n+                    staticRecipients.setEnabled(Boolean.TRUE);\n+                    target.add(staticRecipients);\n+                    staticRecipientsFieldPanel.setRequired(Boolean.TRUE);\n+                    target.add(staticRecipientsFieldPanel);\n                 }\n                 recipients.setEnabled(checkRecipients.getModelObject());\n                 target.add(recipients);\n                 target.add(recipientsContainer);\n             }\n         });\n \n+        checkStaticRecipients.getField().add(new AjaxFormComponentUpdatingBehavior(Constants.ON_CHANGE) {\n+\n+            private static final long serialVersionUID = -1107858522700306810L;\n+\n+            @Override\n+            protected void onUpdate(final AjaxRequestTarget target) {\n+                if (!checkStaticRecipients.getModelObject()\n+                        && !selfAsRecipient.getModelObject()\n+                        && !checkRecipients.getModelObject()) {\n+                    checkRecipients.getField().setDefaultModelObject(Boolean.TRUE);\n+                    checkRecipients.setEnabled(Boolean.TRUE);\n+                    target.add(checkRecipients);\n+                }\n+                staticRecipients.setEnabled(checkStaticRecipients.getModelObject());\n+                staticRecipientsFieldPanel.setRequired(checkStaticRecipients.getModelObject());\n+                recipients.setEnabled(checkRecipients.getModelObject());\n+                target.add(staticRecipientsFieldPanel);\n+                target.add(staticRecipients);\n+                target.add(recipients);\n+                target.add(recipientsContainer);\n+            }\n+        });\n+\n         AjaxButton submit = new IndicatingAjaxButton(APPLY, new Model<String>(getString(SUBMIT))) {\n \n             private static final long serialVersionUID = -958724007591692537L;\n@@ -244,7 +289,7 @@ protected void onSubmit(final AjaxRequestTarget target, final Form<?> form) {\n                 notificationTO.setAbout(checkAbout.getModelObject() ? null : about.buildFIQL());\n                 notificationTO.setRecipients(checkRecipients.getModelObject() ? recipients.buildFIQL() : null);\n                 notificationTO.getStaticRecipients().removeAll(Collections.singleton(null));\n-                \n+\n                 try {\n                     if (createFlag) {\n                         restClient.createNotification(notificationTO);"},{"sha":"333519bbe65c4e97351aaa862fec0783ee7ea770","filename":"console/src/main/resources/org/apache/syncope/console/pages/NotificationModalPage.html","status":"modified","additions":19,"deletions":9,"changes":28,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/f25aff5d61c72ec5f643fe8a5891c14bfd069635/console%2Fsrc%2Fmain%2Fresources%2Forg%2Fapache%2Fsyncope%2Fconsole%2Fpages%2FNotificationModalPage.html","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/f25aff5d61c72ec5f643fe8a5891c14bfd069635/console%2Fsrc%2Fmain%2Fresources%2Forg%2Fapache%2Fsyncope%2Fconsole%2Fpages%2FNotificationModalPage.html","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/console%2Fsrc%2Fmain%2Fresources%2Forg%2Fapache%2Fsyncope%2Fconsole%2Fpages%2FNotificationModalPage.html?ref=f25aff5d61c72ec5f643fe8a5891c14bfd069635","patch":"@@ -146,21 +146,15 @@\n \n           <div id=\"recipients\">\n             <div class=\"tablerow alt\">\n-              <div class=\"tablecolumn_label medium_fixedsize\">\n+              <div class=\"tablecolumn_label medium_dynamicsize\">\n+                <span wicket:id=\"checkStaticRecipients\">[checkStaticRecipients]</span>\n                 <label for=\"recipients\"><wicket:message key=\"recipients\"/></label>\n               </div>\n               <div class=\"tablecolumn_field medium_dynamicsize\">\n                 <span wicket:id=\"staticRecipients\">[staticRecipients]</span>\n               </div>\n             </div>\n-           \t<div class=\"tablerow\" style=\"width: auto; display: block;\">\n-           \t  <div class=\"tablecolumn_field\" style=\"width: auto; padding-right: 5px;\">\n-                <span wicket:id=\"selfAsRecipient\">[selfAsRecipient]</span>\n-              </div>\n-           \t  <div class=\"tablecolumn_label\" style=\"width: auto;\">\n-                <label for=\"selfAsRecipient\"><wicket:message key=\"selfAsRecipient\"/></label>\n-              </div>\n-            </div>\n+\n             <span wicket:id=\"recipientsContainer\">\n               <div class=\"tablerow\" style=\"width: auto;\">\n                 <div class=\"tablecolumn_field\" style=\"width: auto; padding-right: 5px;\">\n@@ -172,6 +166,22 @@\n               </div>\n               <span wicket:id=\"recipients\"/>\n             </span>\n+            <div id=\"userFilter\">\n+              <div id=\"title\">\n+                <label for=\"userNotifications\"><wicket:message key=\"userNotifications\"/></label>\n+              </div>\n+              <div id=\"warning\">\n+                <label for=\"userNotificationsWarning\"><wicket:message key=\"userNotificationsWarning\"/></label>\n+              </div>\n+              <div class=\"tablerow\" style=\"width: auto;\">\n+                <div class=\"tablecolumn_field\" style=\"width: auto; padding-right: 5px;\">\n+                  <span wicket:id=\"selfAsRecipient\">[selfAsRecipient]</span>\n+                </div>\n+                <div class=\"tablecolumn_label\" style=\"width: auto;\">\n+                  <label for=\"selfAsRecipient\"><wicket:message key=\"selfAsRecipient\"/></label>\n+                </div>\n+              </div>\n+            </div>\n           </div>\n         </div>\n "},{"sha":"767db0bd1776b1dfcfdcdf40d83465632f44bda9","filename":"console/src/main/resources/org/apache/syncope/console/pages/NotificationModalPage.properties","status":"modified","additions":2,"deletions":0,"changes":2,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/f25aff5d61c72ec5f643fe8a5891c14bfd069635/console%2Fsrc%2Fmain%2Fresources%2Forg%2Fapache%2Fsyncope%2Fconsole%2Fpages%2FNotificationModalPage.properties","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/f25aff5d61c72ec5f643fe8a5891c14bfd069635/console%2Fsrc%2Fmain%2Fresources%2Forg%2Fapache%2Fsyncope%2Fconsole%2Fpages%2FNotificationModalPage.properties","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/console%2Fsrc%2Fmain%2Fresources%2Forg%2Fapache%2Fsyncope%2Fconsole%2Fpages%2FNotificationModalPage.properties?ref=f25aff5d61c72ec5f643fe8a5891c14bfd069635","patch":"@@ -31,3 +31,5 @@ checkRecipients=Search recipients\n checkAbout=All\n userFilter=User filter\n userFilterWarning=Do not use this filter unless events are not targeted at users\n+userNotifications=User notifications\n+userNotificationsWarning=Do not select this checkbox unless events are not targeted at users"},{"sha":"7bb30c239943dccbded29e546c3a24071f61433a","filename":"console/src/main/resources/org/apache/syncope/console/pages/NotificationModalPage_it.properties","status":"modified","additions":4,"deletions":2,"changes":6,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/f25aff5d61c72ec5f643fe8a5891c14bfd069635/console%2Fsrc%2Fmain%2Fresources%2Forg%2Fapache%2Fsyncope%2Fconsole%2Fpages%2FNotificationModalPage_it.properties","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/f25aff5d61c72ec5f643fe8a5891c14bfd069635/console%2Fsrc%2Fmain%2Fresources%2Forg%2Fapache%2Fsyncope%2Fconsole%2Fpages%2FNotificationModalPage_it.properties","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/console%2Fsrc%2Fmain%2Fresources%2Forg%2Fapache%2Fsyncope%2Fconsole%2Fpages%2FNotificationModalPage_it.properties?ref=f25aff5d61c72ec5f643fe8a5891c14bfd069635","patch":"@@ -26,8 +26,10 @@ events=Eventi\n recipients=Destinatari\n selfAsRecipient=Includi i soggetti\n recipientAttrType=Tipo attributo e-mail destinatari\n-recipientAttrName=Shcema attributo e-mail destinatari\n+recipientAttrName=Schema attributo e-mail destinatari\n checkRecipients=Cerca i destinatari\n checkAbout=Tutto\n userFilter=Filtro utenti\n-userFilterWarning=Non usare questo filtro se gli eventi catturati non riguardano espressamente utenti\n\\ No newline at end of file\n+userFilterWarning=Non usare questo filtro se gli eventi catturati non riguardano espressamente utenti\n+userNotifications=Notifiche utente\n+userNotificationsWarning=Non selezionare questa checkbox se gli eventi catturati non riguardano espressamente utenti"},{"sha":"10b33199818d5c792d55337af5877573d2e16534","filename":"console/src/main/resources/org/apache/syncope/console/pages/NotificationModalPage_pt_BR.properties","status":"modified","additions":3,"deletions":1,"changes":4,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/f25aff5d61c72ec5f643fe8a5891c14bfd069635/console%2Fsrc%2Fmain%2Fresources%2Forg%2Fapache%2Fsyncope%2Fconsole%2Fpages%2FNotificationModalPage_pt_BR.properties","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/f25aff5d61c72ec5f643fe8a5891c14bfd069635/console%2Fsrc%2Fmain%2Fresources%2Forg%2Fapache%2Fsyncope%2Fconsole%2Fpages%2FNotificationModalPage_pt_BR.properties","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/console%2Fsrc%2Fmain%2Fresources%2Forg%2Fapache%2Fsyncope%2Fconsole%2Fpages%2FNotificationModalPage_pt_BR.properties?ref=f25aff5d61c72ec5f643fe8a5891c14bfd069635","patch":"@@ -30,4 +30,6 @@ recipientAttrName=Destinat\\u00e1rios de e-mail para atributos de esquema\n checkRecipients=Buscar Destinat\\u00e1rios\n checkAbout=Todos\n userFilter=User filter\n-userFilterWarning=Do not use this filter unless events are not targeted at users\n\\ No newline at end of file\n+userFilterWarning=N\\u00e3o use este filtro n\\u00e3o ser que os eventos n\\u00e3o s\\u00e3o direcionados a usu\\u00e1rios\n+userNotifications=Notifica\\u00e7\\u00f5es do usu\\u00e1rio\n+userNotificationsWarning=N\\u00e3o selecione esta op\\u00e7\\u00e3o a menos que os eventos n\\u00e3o s\\u00e3o direcionados a usu\\u00e1rios\n\\ No newline at end of file"},{"sha":"c89f86979c5b0d01e0f00b651465a6db7b3a28fa","filename":"console/src/test/java/org/apache/syncope/console/ConfigurationTestITCase.java","status":"modified","additions":3,"deletions":1,"changes":4,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/f25aff5d61c72ec5f643fe8a5891c14bfd069635/console%2Fsrc%2Ftest%2Fjava%2Forg%2Fapache%2Fsyncope%2Fconsole%2FConfigurationTestITCase.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/f25aff5d61c72ec5f643fe8a5891c14bfd069635/console%2Fsrc%2Ftest%2Fjava%2Forg%2Fapache%2Fsyncope%2Fconsole%2FConfigurationTestITCase.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/console%2Fsrc%2Ftest%2Fjava%2Forg%2Fapache%2Fsyncope%2Fconsole%2FConfigurationTestITCase.java?ref=f25aff5d61c72ec5f643fe8a5891c14bfd069635","patch":"@@ -168,7 +168,7 @@ public void createNotification() {\n                 + \"//select[@name='eventSelection:categoryContainer:category:dropDownChoiceField']\"\n                 + \"/option[text()='role']\\\");\",\n                 \"30000\");\n-\n+        \n         selenium.select(\n                 \"//select[@name='eventSelection:categoryContainer:category:dropDownChoiceField']\",\n                 \"label=role\");\n@@ -189,6 +189,8 @@ public void createNotification() {\n         selenium.click(\"//div[@class='eventSelectionWidzard']/div[2]/div[3]/span/div/input\");\n \n         selenium.click(\"//div[2]/form/div[3]/ul/li[4]/a/span\");\n+        \n+        selenium.click(\"//div[2]/form/div[3]/div[4]/div/div/span/input\");\n \n         selenium.type(\n                 \"name=staticRecipients:multiValueContainer:view:0:panel:textField\", \"syncope445@syncope.apache.org\");"}]}