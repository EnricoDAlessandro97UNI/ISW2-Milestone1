{"sha":"d534289c3a5621219cc5c975b2410fe28971c703","node_id":"MDY6Q29tbWl0NjM2ODc5MDYyOmQ1MzQyODljM2E1NjIxMjE5Y2M1Yzk3NWIyNDEwZmUyODk3MWM3MDM=","commit":{"author":{"name":"Massimiliano Perrone","email":"massi@apache.org","date":"2014-07-04T13:01:31Z"},"committer":{"name":"Massimiliano Perrone","email":"massi@apache.org","date":"2014-07-04T13:01:31Z"},"message":"Some changes for windows env #SYNCOPE-526\n\ngit-svn-id: https://svn.apache.org/repos/asf/syncope/trunk@1607847 13f79535-47bb-0310-9956-ffa450edef68","tree":{"sha":"efde22abd504c776fa53ac633a14cdfa304a57c1","url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/git/trees/efde22abd504c776fa53ac633a14cdfa304a57c1"},"url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/git/commits/d534289c3a5621219cc5c975b2410fe28971c703","comment_count":0,"verification":{"verified":false,"reason":"unsigned","signature":null,"payload":null}},"url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/d534289c3a5621219cc5c975b2410fe28971c703","html_url":"https://github.com/EnricoDAlessandro97UNI/syncope/commit/d534289c3a5621219cc5c975b2410fe28971c703","comments_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/d534289c3a5621219cc5c975b2410fe28971c703/comments","author":null,"committer":null,"parents":[{"sha":"e423c48443922da70a2d6e58b10a77777556197a","url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/e423c48443922da70a2d6e58b10a77777556197a","html_url":"https://github.com/EnricoDAlessandro97UNI/syncope/commit/e423c48443922da70a2d6e58b10a77777556197a"}],"stats":{"total":104,"additions":72,"deletions":32},"files":[{"sha":"630a4a68e7e3e3ea45ac0d6f7b03bb31548f3c60","filename":"installer/src/main/java/org/apache/syncope/installer/containers/Tomcat.java","status":"modified","additions":3,"deletions":5,"changes":8,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/d534289c3a5621219cc5c975b2410fe28971c703/installer%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Finstaller%2Fcontainers%2FTomcat.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/d534289c3a5621219cc5c975b2410fe28971c703/installer%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Finstaller%2Fcontainers%2FTomcat.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/installer%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Finstaller%2Fcontainers%2FTomcat.java?ref=d534289c3a5621219cc5c975b2410fe28971c703","patch":"@@ -20,6 +20,7 @@\n \n import java.io.UnsupportedEncodingException;\n import java.net.URLEncoder;\n+import org.apache.syncope.installer.utilities.Commands;\n import org.apache.syncope.installer.utilities.HttpUtils;\n \n public class Tomcat {\n@@ -42,19 +43,16 @@ public class Tomcat {\n \n     private final HttpUtils httpUtils;\n \n-    private final boolean isWin;\n-\n     public Tomcat(final boolean tomcatSsl, final String tomcatHost, final String tomcatPort,\n             final String installPath, final String artifactId, final String tomcatUser, final String tomcatPassword) {\n         this.installPath = installPath;\n         this.artifactId = artifactId;\n-        isWin = System.getProperty(\"os.name\").toLowerCase().contains(\"win\");\n         httpUtils = new HttpUtils(tomcatSsl, tomcatHost, tomcatPort, tomcatUser, tomcatPassword);\n     }\n \n     public boolean deployCore() {\n         int status;\n-        if (isWin) {\n+        if (Commands.IS_WIN) {\n             status = httpUtils.getWithBasicAuth(pathEncoded(WIN_DEPLOY_SYNCOPE_CORE_QUERY));\n         } else {\n             status = httpUtils.getWithBasicAuth(path(UNIX_DEPLOY_SYNCOPE_CORE_QUERY));\n@@ -65,7 +63,7 @@ public boolean deployCore() {\n \n     public boolean deployConsole() {\n         int status;\n-        if (isWin) {\n+        if (Commands.IS_WIN) {\n             status = httpUtils.getWithBasicAuth(pathEncoded(WIN_DEPLOY_SYNCOPE_CONSOLE_QUERY));\n         } else {\n             status = httpUtils.getWithBasicAuth(path(UNIX_DEPLOY_SYNCOPE_CONSOLE_QUERY));"},{"sha":"b9956f897aba99c5368f96c31eb070b224b2c50d","filename":"installer/src/main/java/org/apache/syncope/installer/processes/AbstractProcess.java","status":"modified","additions":4,"deletions":5,"changes":9,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/d534289c3a5621219cc5c975b2410fe28971c703/installer%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Finstaller%2Fprocesses%2FAbstractProcess.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/d534289c3a5621219cc5c975b2410fe28971c703/installer%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Finstaller%2Fprocesses%2FAbstractProcess.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/installer%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Finstaller%2Fprocesses%2FAbstractProcess.java?ref=d534289c3a5621219cc5c975b2410fe28971c703","patch":"@@ -31,12 +31,11 @@ public abstract class AbstractProcess {\n \n     protected void exec(final String cmd, final AbstractUIProcessHandler handler, final String path) {\n         try {\n-            final Process process;\n-            if (path == null || path.isEmpty()) {\n-                process = Runtime.getRuntime().exec(cmd);\n-            } else {\n-                process = Runtime.getRuntime().exec(cmd, null, new File(path));\n+            final ProcessBuilder builder = new ProcessBuilder(cmd.split(\" \"));\n+            if (path != null && !path.isEmpty()) {\n+                builder.directory(new File(path));\n             }\n+            final Process process = builder.start();\n             readResponse(process.getInputStream(), handler);\n         } catch (IOException ex) {\n         }"},{"sha":"a57dc21c783ee5ba984146e75205095c0af9b117","filename":"installer/src/main/java/org/apache/syncope/installer/processes/ArchetypeProcess.java","status":"modified","additions":6,"deletions":8,"changes":14,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/d534289c3a5621219cc5c975b2410fe28971c703/installer%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Finstaller%2Fprocesses%2FArchetypeProcess.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/d534289c3a5621219cc5c975b2410fe28971c703/installer%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Finstaller%2Fprocesses%2FArchetypeProcess.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/installer%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Finstaller%2Fprocesses%2FArchetypeProcess.java?ref=d534289c3a5621219cc5c975b2410fe28971c703","patch":"@@ -39,19 +39,17 @@ public void run(final AbstractUIProcessHandler handler, final String[] args) {\n         final String syncopeAdminPassword = args[9];\n \n         if (!new File(installPath).exists()) {\n-            exec(String.format(Commands.createDirectory, installPath), handler, null);\n+            exec(Commands.createDirectory(installPath), handler, null);\n         }\n-\n-        exec(String.format(Commands.createArchetypeCommand,\n-                mavenDir, syncopeVersion, groupId, artifactId, secretKey, anonymousKey), handler, installPath);\n+        exec(Commands.createArchetype(mavenDir, syncopeVersion, groupId, artifactId, secretKey, anonymousKey),\n+                handler, installPath);\n         writeToFile(new File(installPath + \"/\" + artifactId + Pom.PATH), Pom.FILE);\n \n-        exec(String.format(Commands.createDirectory, logsDirectory), handler, null);\n+        exec(Commands.createDirectory(logsDirectory), handler, null);\n \n-        exec(String.format(Commands.createDirectory, bundlesDirectory), handler, null);\n+        exec(Commands.createDirectory(bundlesDirectory), handler, null);\n \n-        exec(String.format(\n-                Commands.compileCommand, mavenDir, logsDirectory, bundlesDirectory),\n+        exec(Commands.compileArchetype(mavenDir, logsDirectory, bundlesDirectory),\n                 handler, installPath + \"/\" + artifactId);\n     }\n "},{"sha":"c645de49c17e5a3fe79e165f9d0277186d4e27c5","filename":"installer/src/main/java/org/apache/syncope/installer/processes/ContainerProcess.java","status":"modified","additions":1,"deletions":2,"changes":3,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/d534289c3a5621219cc5c975b2410fe28971c703/installer%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Finstaller%2Fprocesses%2FContainerProcess.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/d534289c3a5621219cc5c975b2410fe28971c703/installer%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Finstaller%2Fprocesses%2FContainerProcess.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/installer%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Finstaller%2Fprocesses%2FContainerProcess.java?ref=d534289c3a5621219cc5c975b2410fe28971c703","patch":"@@ -107,8 +107,7 @@ public void run(final AbstractUIProcessHandler handler, final String[] args) {\n             }\n         }\n \n-        exec(String.format(\n-                Commands.compileCommand, mavenDir, logsDirectory, bundlesDirectory),\n+        exec(Commands.compileArchetype(mavenDir, logsDirectory, bundlesDirectory),\n                 handler, installPath + \"/\" + artifactId);\n \n         switch (selectedContainer) {"},{"sha":"ae8d4ebc8fb14201dc60971420db2846e7f42e5b","filename":"installer/src/main/java/org/apache/syncope/installer/processes/PersistenceProcess.java","status":"modified","additions":1,"deletions":1,"changes":2,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/d534289c3a5621219cc5c975b2410fe28971c703/installer%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Finstaller%2Fprocesses%2FPersistenceProcess.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/d534289c3a5621219cc5c975b2410fe28971c703/installer%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Finstaller%2Fprocesses%2FPersistenceProcess.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/installer%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Finstaller%2Fprocesses%2FPersistenceProcess.java?ref=d534289c3a5621219cc5c975b2410fe28971c703","patch":"@@ -89,7 +89,7 @@ public void run(final AbstractUIProcessHandler handler, final String[] args) {\n     }\n \n     private void writeOrmFile(final AbstractUIProcessHandler handler, final String content) {\n-        exec(String.format(Commands.createDirectory, installPath + \"/\" + artifactId + OrmXml.PATH_DIR), handler, null);\n+        exec(Commands.createDirectory(installPath + \"/\" + artifactId + OrmXml.PATH_DIR), handler, null);\n         final File orm = new File(installPath + \"/\" + artifactId + OrmXml.PATH_COMPLETE);\n         writeToFile(orm, content);\n     }"},{"sha":"464bb6e2716766dc2ea8b5b9c3ecc71ed0ab2272","filename":"installer/src/main/java/org/apache/syncope/installer/utilities/Commands.java","status":"modified","additions":43,"deletions":6,"changes":49,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/d534289c3a5621219cc5c975b2410fe28971c703/installer%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Finstaller%2Futilities%2FCommands.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/d534289c3a5621219cc5c975b2410fe28971c703/installer%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Finstaller%2Futilities%2FCommands.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/installer%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Finstaller%2Futilities%2FCommands.java?ref=d534289c3a5621219cc5c975b2410fe28971c703","patch":"@@ -19,17 +19,54 @@\n package org.apache.syncope.installer.utilities;\n \n public class Commands {\n-    \n-    public static final String createArchetypeCommand\n-            = \"%s/bin/mvn archetype:generate \"\n+\n+    public static String createArchetype(final String mavenDir, final String syncopeVersion, final String groupId,\n+            final String artifactId, final String secretKey, final String anonymousKey) {\n+        final StringBuilder commandBuilder = new StringBuilder();\n+        if (IS_WIN) {\n+            commandBuilder.append(\"cmd /c \").append(String.format(WIN_MAVEN, mavenDir));\n+        } else {\n+            commandBuilder.append(String.format(UNIX_MAVEN, mavenDir));\n+        }\n+        return commandBuilder.append(String.format(\n+                CREATE_ARCHETYPE_COMMAND, syncopeVersion, groupId, artifactId, secretKey, anonymousKey))\n+                .toString();\n+\n+    }\n+\n+    private static final String UNIX_MAVEN = \"%s/bin/mvn \";\n+\n+    private static final String WIN_MAVEN = \"%s\\\\bin\\\\mvn \";\n+\n+    private static final String CREATE_ARCHETYPE_COMMAND = \"archetype:generate \"\n             + \"-DarchetypeGroupId=org.apache.syncope \"\n             + \"-DarchetypeArtifactId=syncope-archetype \"\n-            + \"-DarchetypeRepository=http://repo1.maven.org/maven2 \"\n+            + \"-DarchetypeRepository=http://repository.apache.org/content/repositories/snapshots \"\n             + \"-DarchetypeVersion=%s \"\n             + \"-DgroupId=%s -DartifactId=%s -DsecretKey=%s -DanonymousKey=%s -DinteractiveMode=false\";\n \n-    public static final String compileCommand = \"%s/bin/mvn clean package -Dlog.directory=%s -Dbundles.directory=%s \";\n+    public static String compileArchetype(\n+            final String mavenDir, final String logsDirectory, final String bundlesDirectory) {\n+        final StringBuilder commandBuilder = new StringBuilder();\n+        if (IS_WIN) {\n+            commandBuilder.append(\"cmd /c \").append(String.format(WIN_MAVEN, mavenDir));;\n+        } else {\n+            commandBuilder.append(String.format(UNIX_MAVEN, mavenDir));;\n+        }\n+        return commandBuilder.append(String.format(\n+                COMPILE_ARCHETYPE, logsDirectory, bundlesDirectory))\n+                .toString();\n+    }\n+\n+    private static final String COMPILE_ARCHETYPE\n+            = \"clean package -Dlog.directory=%s -Dbundles.directory=%s \";\n+\n+    public static String createDirectory(final String directory) {\n+        return String.format(CREATE_DIRECTORY, directory);\n+    }\n+\n+    private static final String CREATE_DIRECTORY = \"mkdir -p %s\";\n \n-    public static final String createDirectory = \"mkdir -p %s\";\n+    public static final boolean IS_WIN = System.getProperty(\"os.name\").toLowerCase().contains(\"win\");\n \n }"},{"sha":"4fe3363e01ab979a2e0f97ec29d1b161f23c9337","filename":"installer/src/main/java/org/apache/syncope/installer/validators/ArchetypeValidator.java","status":"modified","additions":9,"deletions":0,"changes":9,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/d534289c3a5621219cc5c975b2410fe28971c703/installer%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Finstaller%2Fvalidators%2FArchetypeValidator.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/d534289c3a5621219cc5c975b2410fe28971c703/installer%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Finstaller%2Fvalidators%2FArchetypeValidator.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/installer%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Finstaller%2Fvalidators%2FArchetypeValidator.java?ref=d534289c3a5621219cc5c975b2410fe28971c703","patch":"@@ -19,6 +19,7 @@\n package org.apache.syncope.installer.validators;\n \n import com.izforge.izpack.api.data.InstallData;\n+import java.io.File;\n \n public class ArchetypeValidator extends AbstractValidator {\n \n@@ -27,6 +28,7 @@ public class ArchetypeValidator extends AbstractValidator {\n     @Override\n     public Status validateData(final InstallData installData) {\n \n+        final String mavenDir = installData.getVariable(\"mvn.directory\");\n         final String mavenGroupId = installData.getVariable(\"mvn.groupid\");\n         final String mavenArtifactId = installData.getVariable(\"mvn.artifactid\");\n         final String mavenSecretKey = installData.getVariable(\"mvn.secretkey\");\n@@ -36,6 +38,13 @@ public Status validateData(final InstallData installData) {\n \n         boolean verified = true;\n         error = new StringBuilder(\"Required fields:\\n\");\n+        if (isEmpty(mavenDir)) {\n+            error.append(\"Maven home directory\\n\");\n+            verified = false;\n+        } else if (!new File(mavenDir + \"/bin/mvn\").exists()){\n+            error.append(\"Maven home directory not valid, check it please...\\n\");\n+            verified = false;\n+        }\n         if (isEmpty(mavenGroupId)) {\n             error.append(\"GroupID\\n\");\n             verified = false;"},{"sha":"2df328dec06b41b37bb4c2aae07744abacc994a6","filename":"installer/src/main/resources/izpack/install.xml","status":"modified","additions":1,"deletions":1,"changes":2,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/d534289c3a5621219cc5c975b2410fe28971c703/installer%2Fsrc%2Fmain%2Fresources%2Fizpack%2Finstall.xml","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/d534289c3a5621219cc5c975b2410fe28971c703/installer%2Fsrc%2Fmain%2Fresources%2Fizpack%2Finstall.xml","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/installer%2Fsrc%2Fmain%2Fresources%2Fizpack%2Finstall.xml?ref=d534289c3a5621219cc5c975b2410fe28971c703","patch":"@@ -69,7 +69,7 @@ under the License.\n     <variable name=\"WELCOME_TEXT\" value=\"Apache Syncope Installer\"/>\n     <variable name=\"WELCOME_VERSION\" value=\"${appversion}\"/>\n     <variable name=\"TargetPanel.dir.unix\" value=\"/tmp/syncope\"/>\n-    <variable name=\"TargetPanel.dir.windows\" value=\"c:\\\\syncope\"/>\n+    <variable name=\"TargetPanel.dir.windows\" value=\"C:\\Program Files\"/>\n   </variables>\n   \n   <dynamicvariables>"},{"sha":"60c316ff2e5fa6c33a29ada3e9314c2a1d945147","filename":"installer/src/main/resources/izpack/userInputSpec.xml","status":"modified","additions":4,"deletions":4,"changes":8,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/d534289c3a5621219cc5c975b2410fe28971c703/installer%2Fsrc%2Fmain%2Fresources%2Fizpack%2FuserInputSpec.xml","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/d534289c3a5621219cc5c975b2410fe28971c703/installer%2Fsrc%2Fmain%2Fresources%2Fizpack%2FuserInputSpec.xml","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/installer%2Fsrc%2Fmain%2Fresources%2Fizpack%2FuserInputSpec.xml?ref=d534289c3a5621219cc5c975b2410fe28971c703","patch":"@@ -44,12 +44,12 @@ under the License.\n       <spec id=\"mvn.anonymous.key.id\" size=\"20\" set=\"123456789asdfghj\"/>\n     </field>\n     <field type=\"space\"/>\n-    <field type=\"text\" variable=\"mvn.log.directory\">\n-      <spec id=\"archetype.mvn.log.directory\" size=\"20\" set=\"${TargetPanel.dir.unix}/log\"/>\n+    <field type=\"dir\" variable=\"mvn.log.directory\">\n+      <spec id=\"archetype.mvn.log.directory\" size=\"20\" set=\"\"/>\n     </field>\n     <field type=\"space\"/>\n-    <field type=\"text\" variable=\"mvn.bundle.directory\">\n-      <spec id=\"archetype.mvn.bundle.directory\" size=\"20\" set=\"${TargetPanel.dir.unix}/bundles\"/>\n+    <field type=\"dir\" variable=\"mvn.bundle.directory\">\n+      <spec id=\"archetype.mvn.bundle.directory\" size=\"20\" set=\"\"/>\n     </field>\n     <field type=\"space\"/>\n     <field type=\"text\" variable=\"mvn.syncope.version\">"}]}