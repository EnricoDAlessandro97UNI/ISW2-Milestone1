{"sha":"44d678579e6ee50cbc4f937bb8773af089e81dc0","node_id":"MDY6Q29tbWl0NjM2ODc5MDYyOjQ0ZDY3ODU3OWU2ZWU1MGNiYzRmOTM3YmI4NzczYWYwODllODFkYzA=","commit":{"author":{"name":"Francesco Chicchiriccò","email":"ilgrosso@apache.org","date":"2020-08-21T10:02:58Z"},"committer":{"name":"Francesco Chicchiriccò","email":"ilgrosso@apache.org","date":"2020-08-21T10:22:24Z"},"message":"[SYNCOPE-1575] For suspend / reactivate, pass PropagationByResource instance from workflow execution back to ProvisioningManager","tree":{"sha":"85dc37e230c30ec142f1c50a1b8480d41393214f","url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/git/trees/85dc37e230c30ec142f1c50a1b8480d41393214f"},"url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/git/commits/44d678579e6ee50cbc4f937bb8773af089e81dc0","comment_count":0,"verification":{"verified":false,"reason":"unsigned","signature":null,"payload":null}},"url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/44d678579e6ee50cbc4f937bb8773af089e81dc0","html_url":"https://github.com/EnricoDAlessandro97UNI/syncope/commit/44d678579e6ee50cbc4f937bb8773af089e81dc0","comments_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/44d678579e6ee50cbc4f937bb8773af089e81dc0/comments","author":{"login":"ilgrosso","id":1064664,"node_id":"MDQ6VXNlcjEwNjQ2NjQ=","avatar_url":"https://avatars.githubusercontent.com/u/1064664?v=4","gravatar_id":"","url":"https://api.github.com/users/ilgrosso","html_url":"https://github.com/ilgrosso","followers_url":"https://api.github.com/users/ilgrosso/followers","following_url":"https://api.github.com/users/ilgrosso/following{/other_user}","gists_url":"https://api.github.com/users/ilgrosso/gists{/gist_id}","starred_url":"https://api.github.com/users/ilgrosso/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ilgrosso/subscriptions","organizations_url":"https://api.github.com/users/ilgrosso/orgs","repos_url":"https://api.github.com/users/ilgrosso/repos","events_url":"https://api.github.com/users/ilgrosso/events{/privacy}","received_events_url":"https://api.github.com/users/ilgrosso/received_events","type":"User","site_admin":false},"committer":{"login":"ilgrosso","id":1064664,"node_id":"MDQ6VXNlcjEwNjQ2NjQ=","avatar_url":"https://avatars.githubusercontent.com/u/1064664?v=4","gravatar_id":"","url":"https://api.github.com/users/ilgrosso","html_url":"https://github.com/ilgrosso","followers_url":"https://api.github.com/users/ilgrosso/followers","following_url":"https://api.github.com/users/ilgrosso/following{/other_user}","gists_url":"https://api.github.com/users/ilgrosso/gists{/gist_id}","starred_url":"https://api.github.com/users/ilgrosso/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ilgrosso/subscriptions","organizations_url":"https://api.github.com/users/ilgrosso/orgs","repos_url":"https://api.github.com/users/ilgrosso/repos","events_url":"https://api.github.com/users/ilgrosso/events{/privacy}","received_events_url":"https://api.github.com/users/ilgrosso/received_events","type":"User","site_admin":false},"parents":[{"sha":"662f9be0c83fe4dd65947fdd66b397b2a41679c6","url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/662f9be0c83fe4dd65947fdd66b397b2a41679c6","html_url":"https://github.com/EnricoDAlessandro97UNI/syncope/commit/662f9be0c83fe4dd65947fdd66b397b2a41679c6"}],"stats":{"total":28,"additions":26,"deletions":2},"files":[{"sha":"e8273453cac117f6811e2bbc4fe1bac9f39b7f74","filename":"ext/flowable/flowable-bpmn/src/main/java/org/apache/syncope/core/flowable/impl/FlowableUserWorkflowAdapter.java","status":"modified","additions":26,"deletions":2,"changes":28,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/44d678579e6ee50cbc4f937bb8773af089e81dc0/ext%2Fflowable%2Fflowable-bpmn%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fflowable%2Fimpl%2FFlowableUserWorkflowAdapter.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/44d678579e6ee50cbc4f937bb8773af089e81dc0/ext%2Fflowable%2Fflowable-bpmn%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fflowable%2Fimpl%2FFlowableUserWorkflowAdapter.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/ext%2Fflowable%2Fflowable-bpmn%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fflowable%2Fimpl%2FFlowableUserWorkflowAdapter.java?ref=44d678579e6ee50cbc4f937bb8773af089e81dc0","patch":"@@ -317,11 +317,23 @@ protected UserWorkflowResult<String> doSuspend(final User user, final String upd\n         FlowableRuntimeUtils.updateStatus(engine, procInstID, user);\n         User updated = userDAO.save(user);\n \n+        @SuppressWarnings(\"unchecked\")\n+        PropagationByResource<String> propByRes = engine.getRuntimeService().getVariable(\n+                procInstID, FlowableRuntimeUtils.PROP_BY_RESOURCE, PropagationByResource.class);\n+        engine.getRuntimeService().removeVariable(procInstID, FlowableRuntimeUtils.PROP_BY_RESOURCE);\n+\n+        @SuppressWarnings(\"unchecked\")\n+        PropagationByResource<Pair<String, String>> propByLinkedAccount = engine.getRuntimeService().getVariable(\n+                procInstID, FlowableRuntimeUtils.PROP_BY_LINKEDACCOUNT, PropagationByResource.class);\n+        engine.getRuntimeService().removeVariable(procInstID, FlowableRuntimeUtils.PROP_BY_LINKEDACCOUNT);\n+\n         engine.getRuntimeService().removeVariable(procInstID, FlowableRuntimeUtils.TASK);\n         engine.getRuntimeService().removeVariable(procInstID, FlowableRuntimeUtils.USER);\n         engine.getRuntimeService().removeVariable(procInstID, FlowableRuntimeUtils.WF_EXECUTOR);\n+        engine.getRuntimeService().removeVariable(procInstID, FlowableRuntimeUtils.PROP_BY_RESOURCE);\n+        engine.getRuntimeService().removeVariable(procInstID, FlowableRuntimeUtils.PROP_BY_LINKEDACCOUNT);\n \n-        return new UserWorkflowResult<>(updated.getKey(), null, null, performedTasks);\n+        return new UserWorkflowResult<>(updated.getKey(), propByRes, propByLinkedAccount, performedTasks);\n     }\n \n     @Override\n@@ -335,11 +347,23 @@ protected UserWorkflowResult<String> doReactivate(final User user, final String\n         FlowableRuntimeUtils.updateStatus(engine, procInstID, user);\n         User updated = userDAO.save(user);\n \n+        @SuppressWarnings(\"unchecked\")\n+        PropagationByResource<String> propByRes = engine.getRuntimeService().getVariable(\n+                procInstID, FlowableRuntimeUtils.PROP_BY_RESOURCE, PropagationByResource.class);\n+        engine.getRuntimeService().removeVariable(procInstID, FlowableRuntimeUtils.PROP_BY_RESOURCE);\n+\n+        @SuppressWarnings(\"unchecked\")\n+        PropagationByResource<Pair<String, String>> propByLinkedAccount = engine.getRuntimeService().getVariable(\n+                procInstID, FlowableRuntimeUtils.PROP_BY_LINKEDACCOUNT, PropagationByResource.class);\n+        engine.getRuntimeService().removeVariable(procInstID, FlowableRuntimeUtils.PROP_BY_LINKEDACCOUNT);\n+\n         engine.getRuntimeService().removeVariable(procInstID, FlowableRuntimeUtils.TASK);\n         engine.getRuntimeService().removeVariable(procInstID, FlowableRuntimeUtils.USER);\n         engine.getRuntimeService().removeVariable(procInstID, FlowableRuntimeUtils.WF_EXECUTOR);\n+        engine.getRuntimeService().removeVariable(procInstID, FlowableRuntimeUtils.PROP_BY_RESOURCE);\n+        engine.getRuntimeService().removeVariable(procInstID, FlowableRuntimeUtils.PROP_BY_LINKEDACCOUNT);\n \n-        return new UserWorkflowResult<>(updated.getKey(), null, null, performedTasks);\n+        return new UserWorkflowResult<>(updated.getKey(), propByRes, propByLinkedAccount, performedTasks);\n     }\n \n     @Override"}]}