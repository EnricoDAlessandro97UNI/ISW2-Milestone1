{"sha":"94055c24765cdc943d7c0070e5673d3a21f97b2a","node_id":"MDY6Q29tbWl0NjM2ODc5MDYyOjk0MDU1YzI0NzY1Y2RjOTQzZDdjMDA3MGU1NjczZDNhMjFmOTdiMmE=","commit":{"author":{"name":"Unknown","email":"unknown@apache.org","date":"2011-11-03T15:26:07Z"},"committer":{"name":"Unknown","email":"unknown@apache.org","date":"2011-11-03T15:26:07Z"},"message":"Fixes issue 200\n\n\ngit-svn-id: https://svn.apache.org/repos/asf/incubator/syncope/trunk@1247175 13f79535-47bb-0310-9956-ffa450edef68","tree":{"sha":"3ae28f59d7953e3c1e487329e862ee071f9bb55a","url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/git/trees/3ae28f59d7953e3c1e487329e862ee071f9bb55a"},"url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/git/commits/94055c24765cdc943d7c0070e5673d3a21f97b2a","comment_count":0,"verification":{"verified":false,"reason":"unsigned","signature":null,"payload":null}},"url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/94055c24765cdc943d7c0070e5673d3a21f97b2a","html_url":"https://github.com/EnricoDAlessandro97UNI/syncope/commit/94055c24765cdc943d7c0070e5673d3a21f97b2a","comments_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/94055c24765cdc943d7c0070e5673d3a21f97b2a/comments","author":null,"committer":null,"parents":[{"sha":"5c05746ce9613cdbbe32d402dbc7052ceae51470","url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/5c05746ce9613cdbbe32d402dbc7052ceae51470","html_url":"https://github.com/EnricoDAlessandro97UNI/syncope/commit/5c05746ce9613cdbbe32d402dbc7052ceae51470"}],"stats":{"total":239,"additions":131,"deletions":108},"files":[{"sha":"5961f448216fb17496910d2322a4e81ce6c14089","filename":"client/src/main/java/org/syncope/client/to/ConnInstanceTO.java","status":"modified","additions":0,"deletions":10,"changes":10,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/94055c24765cdc943d7c0070e5673d3a21f97b2a/client%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fclient%2Fto%2FConnInstanceTO.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/94055c24765cdc943d7c0070e5673d3a21f97b2a/client%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fclient%2Fto%2FConnInstanceTO.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/client%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fclient%2Fto%2FConnInstanceTO.java?ref=94055c24765cdc943d7c0070e5673d3a21f97b2a","patch":"@@ -38,8 +38,6 @@ public class ConnInstanceTO extends AbstractBaseBean {\n \n     private Set<ConnConfProperty> configuration;\n \n-    private String syncToken;\n-\n     private Set<ConnectorCapability> capabilities;\n \n     private String displayName;\n@@ -106,14 +104,6 @@ public void setConfiguration(Set<ConnConfProperty> configuration) {\n         }\n     }\n \n-    public String getSyncToken() {\n-        return syncToken;\n-    }\n-\n-    public void setSyncToken(String syncToken) {\n-        this.syncToken = syncToken;\n-    }\n-\n     public String getConnectorName() {\n         return connectorName;\n     }"},{"sha":"ee0e2310ec56990665b92abe81af7c5d412b5806","filename":"client/src/main/java/org/syncope/client/to/ResourceTO.java","status":"modified","additions":10,"deletions":0,"changes":10,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/94055c24765cdc943d7c0070e5673d3a21f97b2a/client%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fclient%2Fto%2FResourceTO.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/94055c24765cdc943d7c0070e5673d3a21f97b2a/client%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fclient%2Fto%2FResourceTO.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/client%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fclient%2Fto%2FResourceTO.java?ref=94055c24765cdc943d7c0070e5673d3a21f97b2a","patch":"@@ -70,6 +70,8 @@ public class ResourceTO extends AbstractBaseBean {\n \n     private Set<ConnConfProperty> connectorConfigurationProperties;\n \n+    private String syncToken;\n+\n     public ResourceTO() {\n         mappings = new ArrayList<SchemaMappingTO>();\n         connectorConfigurationProperties = new HashSet<ConnConfProperty>();\n@@ -210,4 +212,12 @@ public void setConnectorConfigurationProperties(\n         this.connectorConfigurationProperties =\n                 connectorConfigurationProperties;\n     }\n+\n+    public String getSyncToken() {\n+        return syncToken;\n+    }\n+\n+    public void setSyncToken(String syncToken) {\n+        this.syncToken = syncToken;\n+    }\n }"},{"sha":"75de0d62fd24e9244b3a871d417bc21e9820ce09","filename":"console/src/main/java/org/syncope/console/pages/ConnectorModalPage.java","status":"modified","additions":0,"deletions":18,"changes":18,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/94055c24765cdc943d7c0070e5673d3a21f97b2a/console%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fconsole%2Fpages%2FConnectorModalPage.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/94055c24765cdc943d7c0070e5673d3a21f97b2a/console%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fconsole%2Fpages%2FConnectorModalPage.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/console%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fconsole%2Fpages%2FConnectorModalPage.java?ref=94055c24765cdc943d7c0070e5673d3a21f97b2a","patch":"@@ -390,24 +390,6 @@ protected List<ConnectorCapability> load() {\n                 new PropertyModel(this, \"selectedCapabilities\"), capabilities);\n         connectorForm.add(capabilitiesPalette);\n \n-        final AjaxCheckBoxPanel resetToken = new AjaxCheckBoxPanel(\n-                \"resetToken\", getString(\"resetToken\"), new Model(null), false);\n-\n-        resetToken.getField().add(\n-                new AjaxFormComponentUpdatingBehavior(\"onchange\") {\n-\n-                    private static final long serialVersionUID =\n-                            -1107858522700306810L;\n-\n-                    @Override\n-                    protected void onUpdate(final AjaxRequestTarget art) {\n-                        if (resetToken.getModelObject()) {\n-                            connectorTO.setSyncToken(null);\n-                        }\n-                    }\n-                });\n-        connectorForm.add(resetToken);\n-\n         connectorForm.add(submit);\n \n         add(connectorForm);"},{"sha":"60445aaa7585782df136621c1d322d6d2d7f61f9","filename":"console/src/main/java/org/syncope/console/pages/ResourceModalPage.java","status":"modified","additions":18,"deletions":1,"changes":19,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/94055c24765cdc943d7c0070e5673d3a21f97b2a/console%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fconsole%2Fpages%2FResourceModalPage.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/94055c24765cdc943d7c0070e5673d3a21f97b2a/console%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fconsole%2Fpages%2FResourceModalPage.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/console%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fconsole%2Fpages%2FResourceModalPage.java?ref=94055c24765cdc943d7c0070e5673d3a21f97b2a","patch":"@@ -231,8 +231,25 @@ protected List<ConnConfProperty> load() {\n                 new PropertyModel(resourceTO, \"deleteTraceLevel\"),\n                 false);\n         deleteTraceLevel.setChoices(Arrays.asList(TraceLevel.values()));\n-        form.add(deleteTraceLevel);\n+        form.add(deleteTraceLevel);        \n \n+        final AjaxCheckBoxPanel resetToken = new AjaxCheckBoxPanel(\n+                \"resetToken\", getString(\"resetToken\"), new Model(null), false);\n+        resetToken.getField().add(\n+                new AjaxFormComponentUpdatingBehavior(\"onchange\") {\n+\n+                    private static final long serialVersionUID =\n+                            -1107858522700306810L;\n+\n+                    @Override\n+                    protected void onUpdate(final AjaxRequestTarget art) {\n+                        if (resetToken.getModelObject()) {\n+                            resourceTO.setSyncToken(null);\n+                        }\n+                    }\n+                });\n+        form.add(resetToken);\n+        \n         mappingContainer = new WebMarkupContainer(\"mappingContainer\");\n         mappingContainer.setOutputMarkupId(true);\n         form.add(mappingContainer);"},{"sha":"0149c32b87e90b82ff1763b0103255bd39f3b8d3","filename":"console/src/main/resources/org/syncope/console/pages/ConnectorModalPage.html","status":"modified","additions":0,"deletions":9,"changes":9,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/94055c24765cdc943d7c0070e5673d3a21f97b2a/console%2Fsrc%2Fmain%2Fresources%2Forg%2Fsyncope%2Fconsole%2Fpages%2FConnectorModalPage.html","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/94055c24765cdc943d7c0070e5673d3a21f97b2a/console%2Fsrc%2Fmain%2Fresources%2Forg%2Fsyncope%2Fconsole%2Fpages%2FConnectorModalPage.html","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/console%2Fsrc%2Fmain%2Fresources%2Forg%2Fsyncope%2Fconsole%2Fpages%2FConnectorModalPage.html?ref=94055c24765cdc943d7c0070e5673d3a21f97b2a","patch":"@@ -69,15 +69,6 @@\n                         </div>\n                     </div>\n \n-                    <div class=\"tablerow\">\n-                        <div class=\"tablecolumn_label medium_dynamicsize\">\n-                            <label for=\"resetToken\"><wicket:message key=\"resetToken\"/></label>\n-                        </div>\n-                        <div class=\"tablecolumn_field medium_dynamicsize\">\n-                            <span wicket:id=\"resetToken\">[resetToken]</span>\n-                        </div>\n-                    </div>\n-\n                     <span wicket:id=\"container\">\n                         <div class=\"tablerow\" wicket:id=\"connectorProperties\">\n                             <div class=\"tablecolumn_label medium_dynamicsize\">"},{"sha":"93716f75cdb2f3bdd555d7083b1d4be9b98e7e34","filename":"console/src/main/resources/org/syncope/console/pages/ConnectorModalPage.properties","status":"modified","additions":1,"deletions":2,"changes":3,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/94055c24765cdc943d7c0070e5673d3a21f97b2a/console%2Fsrc%2Fmain%2Fresources%2Forg%2Fsyncope%2Fconsole%2Fpages%2FConnectorModalPage.properties","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/94055c24765cdc943d7c0070e5673d3a21f97b2a/console%2Fsrc%2Fmain%2Fresources%2Forg%2Fsyncope%2Fconsole%2Fpages%2FConnectorModalPage.properties","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/console%2Fsrc%2Fmain%2Fresources%2Forg%2Fsyncope%2Fconsole%2Fpages%2FConnectorModalPage.properties?ref=94055c24765cdc943d7c0070e5673d3a21f97b2a","patch":"@@ -9,5 +9,4 @@ edit=Edit\n edit_attribute=Edit attribute\n serviceName=Service name\n endpoint=Endpoint\n-title=Connectors\n-resetToken=Reset Token\n+title=Connectors\n\\ No newline at end of file"},{"sha":"743b1a29e09f31d6fe1fa6018d3a3187d7601489","filename":"console/src/main/resources/org/syncope/console/pages/ConnectorModalPage_it.properties","status":"modified","additions":0,"deletions":1,"changes":1,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/94055c24765cdc943d7c0070e5673d3a21f97b2a/console%2Fsrc%2Fmain%2Fresources%2Forg%2Fsyncope%2Fconsole%2Fpages%2FConnectorModalPage_it.properties","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/94055c24765cdc943d7c0070e5673d3a21f97b2a/console%2Fsrc%2Fmain%2Fresources%2Forg%2Fsyncope%2Fconsole%2Fpages%2FConnectorModalPage_it.properties","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/console%2Fsrc%2Fmain%2Fresources%2Forg%2Fsyncope%2Fconsole%2Fpages%2FConnectorModalPage_it.properties?ref=94055c24765cdc943d7c0070e5673d3a21f97b2a","patch":"@@ -10,4 +10,3 @@ title=Connettori\n tab1=Generale\n tab2=Capabilities\n displayName=Nome visualizzato\n-resetToken=Reset Token"},{"sha":"9138e2884a488b5b79366a26367d46be0b3650c9","filename":"console/src/main/resources/org/syncope/console/pages/ResourceModalPage.html","status":"modified","additions":9,"deletions":0,"changes":9,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/94055c24765cdc943d7c0070e5673d3a21f97b2a/console%2Fsrc%2Fmain%2Fresources%2Forg%2Fsyncope%2Fconsole%2Fpages%2FResourceModalPage.html","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/94055c24765cdc943d7c0070e5673d3a21f97b2a/console%2Fsrc%2Fmain%2Fresources%2Forg%2Fsyncope%2Fconsole%2Fpages%2FResourceModalPage.html","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/console%2Fsrc%2Fmain%2Fresources%2Forg%2Fsyncope%2Fconsole%2Fpages%2FResourceModalPage.html?ref=94055c24765cdc943d7c0070e5673d3a21f97b2a","patch":"@@ -131,6 +131,15 @@\n                                 <span wicket:id=\"deleteTraceLevel\">[deleteTraceLevel]</span>\n                             </div>\n                         </div>\n+\n+                        <div class=\"tablerow\">\n+                            <div class=\"tablecolumn_label medium_fixedsize\">\n+                                <label for=\"resetToken\"><wicket:message key=\"resetToken\"/></label>\n+                            </div>\n+                            <div class=\"tablecolumn_field medium_dynamicsize\">\n+                                <span wicket:id=\"resetToken\">[resetToken]</span>\n+                            </div>\n+                        </div>\n                     </div>\n                     <script type=\"text/javascript\">\n                         $(function() {"},{"sha":"dd94800c7f85118ae4fcdd00473d0f9345a6e22c","filename":"console/src/main/resources/org/syncope/console/pages/ResourceModalPage.properties","status":"modified","additions":1,"deletions":0,"changes":1,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/94055c24765cdc943d7c0070e5673d3a21f97b2a/console%2Fsrc%2Fmain%2Fresources%2Forg%2Fsyncope%2Fconsole%2Fpages%2FResourceModalPage.properties","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/94055c24765cdc943d7c0070e5673d3a21f97b2a/console%2Fsrc%2Fmain%2Fresources%2Forg%2Fsyncope%2Fconsole%2Fpages%2FResourceModalPage.properties","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/console%2Fsrc%2Fmain%2Fresources%2Forg%2Fsyncope%2Fconsole%2Fpages%2FResourceModalPage.properties?ref=94055c24765cdc943d7c0070e5673d3a21f97b2a","patch":"@@ -32,3 +32,4 @@ updateTraceLevel=Update trace level\n deleteTraceLevel=Delete trace level\n propagationPriority=Propagation priority\n propagationPrimary=Propagation primary\n+resetToken=Reset Token\n\\ No newline at end of file"},{"sha":"d9a05ec6348b30f1297b474ff7449637454b8c27","filename":"console/src/main/resources/org/syncope/console/pages/ResourceModalPage_it.properties","status":"modified","additions":1,"deletions":0,"changes":1,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/94055c24765cdc943d7c0070e5673d3a21f97b2a/console%2Fsrc%2Fmain%2Fresources%2Forg%2Fsyncope%2Fconsole%2Fpages%2FResourceModalPage_it.properties","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/94055c24765cdc943d7c0070e5673d3a21f97b2a/console%2Fsrc%2Fmain%2Fresources%2Forg%2Fsyncope%2Fconsole%2Fpages%2FResourceModalPage_it.properties","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/console%2Fsrc%2Fmain%2Fresources%2Forg%2Fsyncope%2Fconsole%2Fpages%2FResourceModalPage_it.properties?ref=94055c24765cdc943d7c0070e5673d3a21f97b2a","patch":"@@ -33,3 +33,4 @@ updateTraceLevel=Livello di tracciamento degli aggiornamenti\n deleteTraceLevel=Livello di tracciamento delle cancellazioni\n propagationPriority=Priorit\\u00e0 in propagazione\n propagationPrimary=Primaria in propagazione\n+resetToken=Reset Token"},{"sha":"a4a76edc334e2590ebba4a9b804b3e5436d7619c","filename":"core/src/main/java/org/syncope/core/persistence/beans/ConnInstance.java","status":"modified","additions":0,"deletions":52,"changes":52,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/94055c24765cdc943d7c0070e5673d3a21f97b2a/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fcore%2Fpersistence%2Fbeans%2FConnInstance.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/94055c24765cdc943d7c0070e5673d3a21f97b2a/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fcore%2Fpersistence%2Fbeans%2FConnInstance.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fcore%2Fpersistence%2Fbeans%2FConnInstance.java?ref=94055c24765cdc943d7c0070e5673d3a21f97b2a","patch":"@@ -14,15 +14,12 @@\n  */\n package org.syncope.core.persistence.beans;\n \n-import java.net.URLDecoder;\n-import java.net.URLEncoder;\n import java.util.ArrayList;\n import java.util.Collections;\n import java.util.EnumSet;\n import java.util.HashSet;\n import java.util.List;\n import java.util.Set;\n-\n import javax.persistence.CascadeType;\n import javax.persistence.Column;\n import javax.persistence.ElementCollection;\n@@ -33,17 +30,11 @@\n import javax.persistence.Id;\n import javax.persistence.Lob;\n import javax.persistence.OneToMany;\n-\n import org.hibernate.annotations.Type;\n-import org.identityconnectors.framework.common.objects.SyncToken;\n-import org.springframework.context.ConfigurableApplicationContext;\n import org.syncope.core.persistence.util.XmlSerializer;\n-import org.syncope.core.util.ApplicationContextManager;\n import org.syncope.types.ConnConfProperty;\n import org.syncope.types.ConnectorCapability;\n \n-import com.thoughtworks.xstream.XStream;\n-\n @Entity\n public class ConnInstance extends AbstractBaseBean {\n \n@@ -92,10 +83,6 @@ public class ConnInstance extends AbstractBaseBean {\n \n     private String displayName;\n \n-    @Lob\n-    @Type(type = \"org.hibernate.type.StringClobType\")\n-    private String serializedSyncToken;\n-\n     /**\n      * Provisioning target resources associated to the connector.\n      * The connector can be considered the resource's type.\n@@ -129,7 +116,6 @@ public ConnInstance(final ConnInstance that) {\n             this.resources.addAll(that.resources);\n         }\n \n-        this.serializedSyncToken = that.serializedSyncToken;\n         this.version = that.version;\n         this.xmlConfiguration = that.xmlConfiguration;\n     }\n@@ -228,42 +214,4 @@ public void setCapabilities(final Set<ConnectorCapability> capabilities) {\n             this.capabilities.addAll(capabilities);\n         }\n     }\n-\n-    public String getSerializedSyncToken() {\n-        return serializedSyncToken;\n-    }\n-\n-    public void setSerializedSyncToken(final String serializedSyncToken) {\n-        this.serializedSyncToken = serializedSyncToken;\n-    }\n-\n-    public SyncToken getSyncToken() {\n-        SyncToken result = null;\n-\n-        if (serializedSyncToken != null) {\n-            ConfigurableApplicationContext context =\n-                    ApplicationContextManager.getApplicationContext();\n-            XStream xStream = context.getBean(XStream.class);\n-            try {\n-                result = (SyncToken) xStream.fromXML(\n-                        URLDecoder.decode(serializedSyncToken, \"UTF-8\"));\n-            } catch (Throwable t) {\n-                LOG.error(\"During attribute deserialization\", t);\n-            }\n-        }\n-\n-        return result;\n-    }\n-\n-    public void setSyncToken(final SyncToken syncToken) {\n-        ConfigurableApplicationContext context =\n-                ApplicationContextManager.getApplicationContext();\n-        XStream xStream = context.getBean(XStream.class);\n-        try {\n-            serializedSyncToken = URLEncoder.encode(\n-                    xStream.toXML(syncToken), \"UTF-8\");\n-        } catch (Throwable t) {\n-            LOG.error(\"During attribute serialization\", t);\n-        }\n-    }\n }"},{"sha":"1e8ff515c87b40ababd4b55fc01bb27feda71834","filename":"core/src/main/java/org/syncope/core/persistence/beans/ExternalResource.java","status":"modified","additions":51,"deletions":2,"changes":53,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/94055c24765cdc943d7c0070e5673d3a21f97b2a/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fcore%2Fpersistence%2Fbeans%2FExternalResource.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/94055c24765cdc943d7c0070e5673d3a21f97b2a/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fcore%2Fpersistence%2Fbeans%2FExternalResource.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fcore%2Fpersistence%2Fbeans%2FExternalResource.java?ref=94055c24765cdc943d7c0070e5673d3a21f97b2a","patch":"@@ -14,12 +14,13 @@\n  */\n package org.syncope.core.persistence.beans;\n \n+import java.net.URLDecoder;\n+import java.net.URLEncoder;\n import java.util.ArrayList;\n import java.util.Collections;\n import java.util.HashSet;\n import java.util.List;\n import java.util.Set;\n-\n import javax.persistence.Basic;\n import javax.persistence.Cacheable;\n import javax.persistence.CascadeType;\n@@ -36,17 +37,20 @@\n import javax.validation.Valid;\n import javax.validation.constraints.Max;\n import javax.validation.constraints.Min;\n-\n import org.apache.commons.lang.StringUtils;\n import org.hibernate.annotations.Type;\n+import org.identityconnectors.framework.common.objects.SyncToken;\n+import org.springframework.context.ConfigurableApplicationContext;\n import org.syncope.core.persistence.beans.role.SyncopeRole;\n import org.syncope.core.persistence.beans.user.SyncopeUser;\n import org.syncope.core.persistence.util.XmlSerializer;\n import org.syncope.core.persistence.validation.entity.ExternalResourceCheck;\n+import org.syncope.core.util.ApplicationContextManager;\n import org.syncope.types.ConnConfProperty;\n import org.syncope.types.PropagationMode;\n import org.syncope.types.IntMappingType;\n import org.syncope.types.TraceLevel;\n+import com.thoughtworks.xstream.XStream;\n \n /**\n  * A resource to which propagation occurs.\n@@ -152,6 +156,13 @@ public class ExternalResource extends AbstractBaseBean {\n     @Type(type = \"org.hibernate.type.StringClobType\")\n     private String xmlConfiguration;\n \n+    /**\n+     * SyncToken for calling ConnId's sync().\n+     */\n+    @Lob\n+    @Type(type = \"org.hibernate.type.StringClobType\")\n+    private String serializedSyncToken;\n+\n     /**\n      * Default constructor.\n      */\n@@ -384,4 +395,42 @@ public Set<ConnConfProperty> getConfiguration() {\n \n         return result;\n     }\n+\n+    public String getSerializedSyncToken() {\n+        return serializedSyncToken;\n+    }\n+\n+    public SyncToken getSyncToken() {\n+        SyncToken result = null;\n+\n+        if (serializedSyncToken != null) {\n+            ConfigurableApplicationContext context =\n+                    ApplicationContextManager.getApplicationContext();\n+            XStream xStream = context.getBean(XStream.class);\n+            try {\n+                result = (SyncToken) xStream.fromXML(\n+                        URLDecoder.decode(serializedSyncToken, \"UTF-8\"));\n+            } catch (Throwable t) {\n+                LOG.error(\"During attribute deserialization\", t);\n+            }\n+        }\n+\n+        return result;\n+    }\n+\n+    public void setSerializedSyncToken(final String serializedSyncToken) {\n+        this.serializedSyncToken = serializedSyncToken;\n+    }\n+\n+    public void setSyncToken(final SyncToken syncToken) {\n+        ConfigurableApplicationContext context =\n+                ApplicationContextManager.getApplicationContext();\n+        XStream xStream = context.getBean(XStream.class);\n+        try {\n+            serializedSyncToken = URLEncoder.encode(\n+                    xStream.toXML(syncToken), \"UTF-8\");\n+        } catch (Throwable t) {\n+            LOG.error(\"During attribute serialization\", t);\n+        }\n+    }\n }"},{"sha":"305985905df9154b7975dcaaa2617f4988f162db","filename":"core/src/main/java/org/syncope/core/rest/data/ConnInstanceDataBinder.java","status":"modified","additions":1,"deletions":8,"changes":9,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/94055c24765cdc943d7c0070e5673d3a21f97b2a/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fcore%2Frest%2Fdata%2FConnInstanceDataBinder.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/94055c24765cdc943d7c0070e5673d3a21f97b2a/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fcore%2Frest%2Fdata%2FConnInstanceDataBinder.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fcore%2Frest%2Fdata%2FConnInstanceDataBinder.java?ref=94055c24765cdc943d7c0070e5673d3a21f97b2a","patch":"@@ -36,7 +36,7 @@\n public class ConnInstanceDataBinder {\n \n     private static final String[] IGNORE_PROPERTIES = {\n-        \"id\", \"resources\", \"syncToken\"};\n+        \"id\", \"resources\"};\n \n     @Autowired\n     private ConnInstanceDAO connectorInstanceDAO;\n@@ -141,10 +141,6 @@ public ConnInstance updateConnInstance(\n         connInstance.setCapabilities(\n                 connInstanceTO.getCapabilities());\n \n-        if (connInstanceTO.getSyncToken() == null) {\n-            connInstance.setSerializedSyncToken(null);\n-        }\n-\n         if (!requiredValuesMissing.getElements().isEmpty()) {\n             compositeErrorException.addException(requiredValuesMissing);\n         }\n@@ -174,9 +170,6 @@ public ConnInstanceTO getConnInstanceTO(final ConnInstance connInstance)\n         BeanUtils.copyProperties(\n                 connInstance, connInstanceTO, IGNORE_PROPERTIES);\n \n-        connInstanceTO.setSyncToken(\n-                connInstance.getSerializedSyncToken());\n-\n         ConnConfPropSchema connConfPropSchema;\n         ConfigurationProperty configurationProperty;\n "},{"sha":"ed14dfe112a288ab96f183ecc5fa8c8773024497","filename":"core/src/main/java/org/syncope/core/rest/data/ResourceDataBinder.java","status":"modified","additions":7,"deletions":2,"changes":9,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/94055c24765cdc943d7c0070e5673d3a21f97b2a/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fcore%2Frest%2Fdata%2FResourceDataBinder.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/94055c24765cdc943d7c0070e5673d3a21f97b2a/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fcore%2Frest%2Fdata%2FResourceDataBinder.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fcore%2Frest%2Fdata%2FResourceDataBinder.java?ref=94055c24765cdc943d7c0070e5673d3a21f97b2a","patch":"@@ -18,7 +18,6 @@\n import java.util.Collection;\n import java.util.HashSet;\n import java.util.List;\n-\n import org.slf4j.Logger;\n import org.slf4j.LoggerFactory;\n import org.springframework.beans.BeanUtils;\n@@ -52,7 +51,7 @@ public class ResourceDataBinder {\n             ResourceDataBinder.class);\n \n     private static final String[] MAPPING_IGNORE_PROPERTIES = {\n-        \"id\", \"resource\"};\n+        \"id\", \"resource\", \"syncToken\"};\n \n     @Autowired\n     private ConnInstanceDAO connectorInstanceDAO;\n@@ -124,6 +123,10 @@ public ExternalResource getResource(final ExternalResource resource,\n         resource.setConnectorConfigurationProperties(\n                 new HashSet<ConnConfProperty>(\n                 resourceTO.getConnectorConfigurationProperties()));\n+        \n+        if (resourceTO.getSyncToken() == null) {\n+            resource.setSerializedSyncToken(null);\n+        }\n         return resource;\n     }\n \n@@ -189,6 +192,8 @@ public ResourceTO getResourceTO(ExternalResource resource) {\n \n         resourceTO.setConnectorConfigurationProperties(\n                 resource.getConfiguration());\n+        resourceTO.setSyncToken(resource.getSerializedSyncToken());\n+        \n         return resourceTO;\n     }\n "},{"sha":"c4dc15ba550006406bbd4449caf3632a0f3e3116","filename":"core/src/main/java/org/syncope/core/scheduling/SyncJob.java","status":"modified","additions":2,"deletions":3,"changes":5,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/94055c24765cdc943d7c0070e5673d3a21f97b2a/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fcore%2Fscheduling%2FSyncJob.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/94055c24765cdc943d7c0070e5673d3a21f97b2a/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fcore%2Fscheduling%2FSyncJob.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fcore%2Fscheduling%2FSyncJob.java?ref=94055c24765cdc943d7c0070e5673d3a21f97b2a","patch":"@@ -19,7 +19,6 @@\n import java.util.List;\n import java.util.Map;\n import java.util.Set;\n-\n import org.identityconnectors.common.security.GuardedByteArray;\n import org.identityconnectors.common.security.GuardedString;\n import org.identityconnectors.framework.common.objects.Attribute;\n@@ -372,7 +371,7 @@ protected String doExecute()\n         List<SyncDelta> deltas;\n         try {\n             deltas = connector.sync(\n-                    syncTask.getResource().getConnector().getSyncToken());\n+                    syncTask.getResource().getSyncToken());\n         } catch (Throwable t) {\n             throw new JobExecutionException(\"While syncing on connector\", t);\n         }\n@@ -514,7 +513,7 @@ protected String doExecute()\n         LOG.debug(\"Sync result: {}\", result);\n \n         try {\n-            syncTask.getResource().getConnector().setSyncToken(\n+            syncTask.getResource().setSyncToken(\n                     connector.getLatestSyncToken());\n             connInstanceDAO.save(syncTask.getResource().getConnector());\n         } catch (Throwable t) {"},{"sha":"47b0bbffa8a2d0ce5626f7fd960c31fcf1eeb692","filename":"core/src/test/java/org/syncope/core/rest/ResourceTestITCase.java","status":"modified","additions":19,"deletions":0,"changes":19,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/94055c24765cdc943d7c0070e5673d3a21f97b2a/core%2Fsrc%2Ftest%2Fjava%2Forg%2Fsyncope%2Fcore%2Frest%2FResourceTestITCase.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/94055c24765cdc943d7c0070e5673d3a21f97b2a/core%2Fsrc%2Ftest%2Fjava%2Forg%2Fsyncope%2Fcore%2Frest%2FResourceTestITCase.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fsrc%2Ftest%2Fjava%2Forg%2Fsyncope%2Fcore%2Frest%2FResourceTestITCase.java?ref=94055c24765cdc943d7c0070e5673d3a21f97b2a","patch":"@@ -346,6 +346,25 @@ public void deleteWithException() {\n         }\n     }\n \n+    @Test\n+    public void updateResetSyncToken() {\n+\t// pre condition: sync token is set\n+        String resourceName = \"ws-target-resource-update-resetsynctoken\";\n+\tResourceTO pre = restTemplate.getForObject(\n+                BASE_URL + \"/resource/read/{resourceName}.json\",\n+                ResourceTO.class, resourceName);\n+        assertNotNull(pre.getSyncToken());\n+        \n+        pre.setSyncToken(null);\n+        \n+        ResourceTO actual = restTemplate.postForObject(\n+                BASE_URL + \"resource/update.json\",\n+                pre, ResourceTO.class);\n+\n+        // check that the synctoken has been reset\n+        assertNull(actual.getSyncToken());\n+    }\n+    \n     @Test\n     public void delete() {\n         final String resourceName = \"ws-target-resource-delete\";"},{"sha":"e4054287ab1ad481027967b4309a3d044acbec98","filename":"core/src/test/resources/content.xml","status":"modified","additions":11,"deletions":0,"changes":11,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/94055c24765cdc943d7c0070e5673d3a21f97b2a/core%2Fsrc%2Ftest%2Fresources%2Fcontent.xml","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/94055c24765cdc943d7c0070e5673d3a21f97b2a/core%2Fsrc%2Ftest%2Fresources%2Fcontent.xml","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fsrc%2Ftest%2Fresources%2Fcontent.xml?ref=94055c24765cdc943d7c0070e5673d3a21f97b2a","patch":"@@ -262,6 +262,8 @@\n                       propagationPriority=\"0\" propagationPrimary=\"0\" createTraceLevel=\"ALL\" deleteTraceLevel=\"ALL\" updateTraceLevel=\"ALL\"/>\n     <ExternalResource name=\"resource-csv\" connector_id=\"104\" forceMandatoryConstraint=\"0\" propagationMode=\"ASYNC\"\n                       propagationPriority=\"0\" propagationPrimary=\"0\" createTraceLevel=\"ALL\" deleteTraceLevel=\"ALL\" updateTraceLevel=\"ALL\"/>\n+    <ExternalResource name=\"ws-target-resource-update-resetsynctoken\" connector_id=\"100\" forceMandatoryConstraint=\"1\" propagationMode=\"ASYNC\"\n+                      propagationPriority=\"0\" propagationPrimary=\"0\" createTraceLevel=\"ALL\" deleteTraceLevel=\"ALL\" updateTraceLevel=\"ALL\" serializedSyncToken=\"%3C%3Fxml+version%3D%221.0%22+encoding%3D%22UTF-8%22%3F%3E%3Cjava+version%3D%221.6.0_24%22+class%3D%22java.beans.XMLDecoder%22%3E%3C%2Fjava%3E\"/>\n                     \n     <SyncopeUser_ExternalResource users_id=\"3\" externalResources_name=\"ws-target-resource-delete\" />\n     <SyncopeRole_ExternalResource roles_id=\"3\" externalResources_name=\"ws-target-resource-list-mappings-1\" />\n@@ -394,6 +396,15 @@\n                    intAttrName=\"csvuserid\" intMappingType=\"UserDerivedSchema\" mandatoryCondition=\"true\"\n                    accountid=\"1\" password=\"0\"/>\n                    \n+    <SchemaMapping id=\"300\" extAttrName=\"userId\"\n+                   resource_name=\"ws-target-resource-update-resetsynctoken\"\n+                   intAttrName=\"userId\" intMappingType=\"UserSchema\" mandatoryCondition=\"false\"\n+                   accountid=\"1\" password=\"0\"/>\n+    <SchemaMapping id=\"301\" extAttrName=\"test3\"\n+                   resource_name=\"ws-target-resource-update-resetsynctoken\"\n+                   intAttrName=\"fullname\" intMappingType=\"UserSchema\" mandatoryCondition=\"false\"\n+                   accountid=\"0\" password=\"1\"/>\n+\n     <Task DTYPE=\"PropagationTask\" id=\"1\" propagationMode=\"ASYNC\" resourceOperationType=\"UPDATE\"\n                  resource_name=\"ws-target-resource-2\"\n                  xmlAttributes=\"%3Cset%3E%0A++%3Corg.identityconnectors.framework.common.objects.Name%3E%0A++++%3Cname%3E__NAME__%3C%2Fname%3E%0A++++%3Cvalue+class%3D%22java.util.Collections%24UnmodifiableRandomAccessList%22+resolves-to%3D%22java.util.Collections%24UnmodifiableList%22%3E%0A++++++%3Cc+class%3D%22list%22%3E%0A++++++++%3Cstring%3EuserId%3C%2Fstring%3E%0A++++++%3C%2Fc%3E%0A++++++%3Clist+reference%3D%22..%2Fc%22%2F%3E%0A++++%3C%2Fvalue%3E%0A++%3C%2Forg.identityconnectors.framework.common.objects.Name%3E%0A++%3Corg.identityconnectors.framework.common.objects.Attribute%3E%0A++++%3Cname%3E__PASSWORD__%3C%2Fname%3E%0A++++%3Cvalue+class%3D%22java.util.Collections%24UnmodifiableRandomAccessList%22+resolves-to%3D%22java.util.Collections%24UnmodifiableList%22%3E%0A++++++%3Cc+class%3D%22list%22%3E%0A++++++++%3Corg.identityconnectors.common.security.GuardedString%3E%0A++++++++++%3C__readOnly%3Efalse%3C%2F__readOnly%3E%0A++++++++++%3C__disposed%3Efalse%3C%2F__disposed%3E%0A++++++++++%3C__encryptedBytes%3EQTOgwEhIHqtAI%2FYlgDhYc37esEF8VLDMU2IY1ciltrg%3D%3C%2F__encryptedBytes%3E%0A++++++++++%3C__base64SHA1Hash%3EW5%2FrwtdCnI8gAnIUhKcahMEnMMc%3D%3C%2F__base64SHA1Hash%3E%0A++++++++%3C%2Forg.identityconnectors.common.security.GuardedString%3E%0A++++++%3C%2Fc%3E%0A++++++%3Clist+reference%3D%22..%2Fc%22%2F%3E%0A++++%3C%2Fvalue%3E%0A++%3C%2Forg.identityconnectors.framework.common.objects.Attribute%3E%0A++%3Corg.identityconnectors.framework.common.objects.Attribute%3E%0A++++%3Cname%3Etype%3C%2Fname%3E%0A++++%3Cvalue+class%3D%22java.util.Collections%24UnmodifiableRandomAccessList%22+resolves-to%3D%22java.util.Collections%24UnmodifiableList%22%3E%0A++++++%3Cc+class%3D%22list%22%3E%0A++++++++%3Cstring%3Etype%3C%2Fstring%3E%0A++++++%3C%2Fc%3E%0A++++++%3Clist+reference%3D%22..%2Fc%22%2F%3E%0A++++%3C%2Fvalue%3E%0A++%3C%2Forg.identityconnectors.framework.common.objects.Attribute%3E%0A++%3Corg.identityconnectors.framework.common.objects.Attribute%3E%0A++++%3Cname%3Efullname%3C%2Fname%3E%0A++++%3Cvalue+class%3D%22java.util.Collections%24UnmodifiableRandomAccessList%22+resolves-to%3D%22java.util.Collections%24UnmodifiableList%22%3E%0A++++++%3Cc+class%3D%22list%22%3E%0A++++++++%3Cstring%3Efullname%3C%2Fstring%3E%0A++++++%3C%2Fc%3E%0A++++++%3Clist+reference%3D%22..%2Fc%22%2F%3E%0A++++%3C%2Fvalue%3E%0A++%3C%2Forg.identityconnectors.framework.common.objects.Attribute%3E%0A%3C%2Fset%3E%0A\"/>"}]}