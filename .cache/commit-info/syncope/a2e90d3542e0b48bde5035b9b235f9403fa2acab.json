{"sha":"a2e90d3542e0b48bde5035b9b235f9403fa2acab","node_id":"MDY6Q29tbWl0NjM2ODc5MDYyOmEyZTkwZDM1NDJlMGI0OGJkZTUwMzViOWIyMzVmOTQwM2ZhMmFjYWI=","commit":{"author":{"name":"Unknown","email":"unknown@apache.org","date":"2011-02-07T17:13:32Z"},"committer":{"name":"Unknown","email":"unknown@apache.org","date":"2011-02-07T17:13:32Z"},"message":"(Fixes issue #71)\n\ngit-svn-id: https://svn.apache.org/repos/asf/incubator/syncope/trunk@1246768 13f79535-47bb-0310-9956-ffa450edef68","tree":{"sha":"c1a5efcb7e3ffb82b1c3b0ff133fcb5fb8fe0e8c","url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/git/trees/c1a5efcb7e3ffb82b1c3b0ff133fcb5fb8fe0e8c"},"url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/git/commits/a2e90d3542e0b48bde5035b9b235f9403fa2acab","comment_count":0,"verification":{"verified":false,"reason":"unsigned","signature":null,"payload":null}},"url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/a2e90d3542e0b48bde5035b9b235f9403fa2acab","html_url":"https://github.com/EnricoDAlessandro97UNI/syncope/commit/a2e90d3542e0b48bde5035b9b235f9403fa2acab","comments_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/a2e90d3542e0b48bde5035b9b235f9403fa2acab/comments","author":null,"committer":null,"parents":[{"sha":"436b05479e0b584fce1bd9ae7c7a8a10cf46c3a2","url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/436b05479e0b584fce1bd9ae7c7a8a10cf46c3a2","html_url":"https://github.com/EnricoDAlessandro97UNI/syncope/commit/436b05479e0b584fce1bd9ae7c7a8a10cf46c3a2"}],"stats":{"total":490,"additions":191,"deletions":299},"files":[{"sha":"bbdd55586434b81b542ae29452e379fde515dd96","filename":"core/pom.xml","status":"modified","additions":5,"deletions":5,"changes":10,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/a2e90d3542e0b48bde5035b9b235f9403fa2acab/core%2Fpom.xml","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/a2e90d3542e0b48bde5035b9b235f9403fa2acab/core%2Fpom.xml","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fpom.xml?ref=a2e90d3542e0b48bde5035b9b235f9403fa2acab","patch":"@@ -79,11 +79,6 @@\n             <artifactId>commons-lang</artifactId>\n         </dependency>\n \n-        <dependency>\n-            <groupId>org.apache.commons</groupId>\n-            <artifactId>commons-email</artifactId>\n-        </dependency>\n-\n         <dependency>\n             <groupId>commons-httpclient</groupId>\n             <artifactId>commons-httpclient</artifactId>\n@@ -167,6 +162,11 @@\n             <artifactId>aspectjweaver</artifactId>\n         </dependency>\n \n+        <dependency>\n+            <groupId>org.apache.velocity</groupId>\n+            <artifactId>velocity</artifactId>\n+        </dependency>\n+\n         <dependency>\n             <groupId>org.hibernate</groupId>\n             <artifactId>hibernate-entitymanager</artifactId>"},{"sha":"8b226685a9b4b540133cff308affdb26c984abcc","filename":"core/src/main/java/org/syncope/core/workflow/AbstractSendEmail.java","status":"added","additions":58,"deletions":0,"changes":58,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/a2e90d3542e0b48bde5035b9b235f9403fa2acab/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fcore%2Fworkflow%2FAbstractSendEmail.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/a2e90d3542e0b48bde5035b9b235f9403fa2acab/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fcore%2Fworkflow%2FAbstractSendEmail.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fcore%2Fworkflow%2FAbstractSendEmail.java?ref=a2e90d3542e0b48bde5035b9b235f9403fa2acab","patch":"@@ -0,0 +1,58 @@\n+/*\n+ *  Licensed under the Apache License, Version 2.0 (the \"License\");\n+ *  you may not use this file except in compliance with the License.\n+ *  You may obtain a copy of the License at\n+ *\n+ *       http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ *  Unless required by applicable law or agreed to in writing, software\n+ *  distributed under the License is distributed on an \"AS IS\" BASIS,\n+ *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ *  See the License for the specific language governing permissions and\n+ *  limitations under the License.\n+ *  under the License.\n+ */\n+package org.syncope.core.workflow;\n+\n+import com.opensymphony.workflow.FunctionProvider;\n+import javax.mail.internet.MimeMessage;\n+import org.springframework.mail.javamail.JavaMailSenderImpl;\n+import org.springframework.mail.javamail.MimeMessageHelper;\n+import org.syncope.core.persistence.dao.ConfDAO;\n+\n+public abstract class AbstractSendEmail extends OSWorkflowComponent\n+        implements FunctionProvider {\n+\n+    protected ConfDAO confDAO;\n+\n+    public AbstractSendEmail() {\n+        super();\n+\n+        confDAO = (ConfDAO) context.getBean(\"confDAOImpl\");\n+    }\n+\n+    protected void sendMail(final String smtpHost,\n+            final String to,\n+            final String from,\n+            final String subject,\n+            final String textBody,\n+            final String htmlBody) {\n+\n+        try {\n+            JavaMailSenderImpl sender = new JavaMailSenderImpl();\n+            sender.setHost(smtpHost);\n+\n+            MimeMessage message = sender.createMimeMessage();\n+            MimeMessageHelper helper = new MimeMessageHelper(message, true);\n+\n+            helper.setTo(to);\n+            helper.setFrom(from);\n+            helper.setSubject(subject);\n+            helper.setText(textBody, htmlBody);\n+\n+            sender.send(message);\n+        } catch (Throwable t) {\n+            LOG.error(\"Could not send e-mail\", t);\n+        }\n+    }\n+}"},{"sha":"481e1c037407b92a49ba9a105dedbf063d96a254","filename":"core/src/main/java/org/syncope/core/workflow/BaseSendEmail.java","status":"removed","additions":0,"deletions":99,"changes":99,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/436b05479e0b584fce1bd9ae7c7a8a10cf46c3a2/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fcore%2Fworkflow%2FBaseSendEmail.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/436b05479e0b584fce1bd9ae7c7a8a10cf46c3a2/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fcore%2Fworkflow%2FBaseSendEmail.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fcore%2Fworkflow%2FBaseSendEmail.java?ref=436b05479e0b584fce1bd9ae7c7a8a10cf46c3a2","patch":"@@ -1,99 +0,0 @@\n-/*\n- *  Licensed under the Apache License, Version 2.0 (the \"License\");\n- *  you may not use this file except in compliance with the License.\n- *  You may obtain a copy of the License at\n- *\n- *       http://www.apache.org/licenses/LICENSE-2.0\n- *\n- *  Unless required by applicable law or agreed to in writing, software\n- *  distributed under the License is distributed on an \"AS IS\" BASIS,\n- *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n- *  See the License for the specific language governing permissions and\n- *  limitations under the License.\n- *  under the License.\n- */\n-package org.syncope.core.workflow;\n-\n-import com.opensymphony.module.propertyset.PropertySet;\n-import com.opensymphony.workflow.FunctionProvider;\n-import com.opensymphony.workflow.WorkflowException;\n-import java.io.BufferedReader;\n-import java.io.InputStreamReader;\n-import java.net.URL;\n-import java.util.Map;\n-import org.apache.commons.mail.Email;\n-import org.apache.commons.mail.EmailException;\n-import org.apache.commons.mail.HtmlEmail;\n-import org.syncope.core.persistence.dao.MissingConfKeyException;\n-import org.syncope.core.persistence.dao.ConfDAO;\n-\n-public class BaseSendEmail extends OSWorkflowComponent\n-        implements FunctionProvider {\n-\n-    protected ConfDAO syncopeConfigurationDAO;\n-\n-    public BaseSendEmail() {\n-        syncopeConfigurationDAO = (ConfDAO) context.getBean(\"confDAOImpl\");\n-    }\n-\n-    protected String getEmailBody(String urlPrefix, String template,\n-            String urlSuffix, String fallback) {\n-\n-        String templateURL = urlPrefix + template + urlSuffix;\n-        if (LOG.isDebugEnabled()) {\n-            LOG.debug(\"Email template URL: \" + templateURL);\n-        }\n-\n-        StringBuilder templateContent = new StringBuilder();\n-        try {\n-            BufferedReader reader = new BufferedReader(\n-                    new InputStreamReader(new URL(templateURL).openStream()));\n-\n-            String data = null;\n-            while ((data = reader.readLine()) != null) {\n-                templateContent.append(data);\n-            }\n-\n-            reader.close();\n-        } catch (Exception e) {\n-            LOG.error(\"While reading mail template \" + template, e);\n-        }\n-\n-        return templateContent.length() == 0\n-                ? fallback : templateContent.toString();\n-    }\n-\n-    protected HtmlEmail getHtmlEmail(Map<String, Object> transientVars,\n-            Map<String, String> args, PropertySet ps)\n-            throws EmailException, WorkflowException {\n-\n-        HtmlEmail email = new HtmlEmail();\n-        try {\n-            email.setHostName(syncopeConfigurationDAO.find(\n-                    \"smtp.host\").getConfValue());\n-            email.setFrom(syncopeConfigurationDAO.find(\n-                    args.get(\"from\")).getConfValue());\n-            email.setSubject(syncopeConfigurationDAO.find(\n-                    args.get(\"subject\")).getConfValue());\n-        } catch (MissingConfKeyException e) {\n-            throw new WorkflowException(e);\n-        }\n-\n-        return email;\n-    }\n-\n-    @Override\n-    public void execute(Map transientVars, Map args, PropertySet ps)\n-            throws WorkflowException {\n-\n-        Email email = null;\n-        try {\n-            email = getHtmlEmail(transientVars, args, ps);\n-            if (email != null) {\n-                email.send();\n-            }\n-        } catch (EmailException e) {\n-            LOG.error(\"Could not send e-mail \" + email, e);\n-        }\n-    }\n-}"},{"sha":"d66f8de3444787ffbd398774ffe26ec7e1ac22b0","filename":"core/src/main/java/org/syncope/core/workflow/SendVelocityEmail.java","status":"added","additions":77,"deletions":0,"changes":77,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/a2e90d3542e0b48bde5035b9b235f9403fa2acab/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fcore%2Fworkflow%2FSendVelocityEmail.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/a2e90d3542e0b48bde5035b9b235f9403fa2acab/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fcore%2Fworkflow%2FSendVelocityEmail.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fcore%2Fworkflow%2FSendVelocityEmail.java?ref=a2e90d3542e0b48bde5035b9b235f9403fa2acab","patch":"@@ -0,0 +1,77 @@\n+/*\n+ *  Licensed under the Apache License, Version 2.0 (the \"License\");\n+ *  you may not use this file except in compliance with the License.\n+ *  You may obtain a copy of the License at\n+ *\n+ *       http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ *  Unless required by applicable law or agreed to in writing, software\n+ *  distributed under the License is distributed on an \"AS IS\" BASIS,\n+ *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ *  See the License for the specific language governing permissions and\n+ *  limitations under the License.\n+ *  under the License.\n+ */\n+package org.syncope.core.workflow;\n+\n+import com.opensymphony.module.propertyset.PropertySet;\n+import com.opensymphony.workflow.WorkflowException;\n+import java.util.HashMap;\n+import java.util.List;\n+import java.util.Map;\n+import org.apache.velocity.app.VelocityEngine;\n+import org.springframework.ui.velocity.VelocityEngineUtils;\n+import org.syncope.core.persistence.beans.AbstractAttr;\n+import org.syncope.core.persistence.beans.user.SyncopeUser;\n+import org.syncope.core.persistence.dao.MissingConfKeyException;\n+\n+public class SendVelocityEmail extends AbstractSendEmail {\n+\n+    @Override\n+    public void execute(final Map transientVars, final Map args,\n+            final PropertySet propertySet)\n+            throws WorkflowException {\n+\n+        final SyncopeUser user =\n+                (SyncopeUser) transientVars.get(Constants.SYNCOPE_USER);\n+\n+        VelocityEngine velocityEngine =\n+                (VelocityEngine) context.getBean(\"velocityEngine\");\n+\n+        final Map<String, Object> model = new HashMap<String, Object>();\n+        List<String> values;\n+        for (AbstractAttr attr : user.getAttributes()) {\n+            values = attr.getValuesAsStrings();\n+            model.put(attr.getSchema().getName(),\n+                    values.isEmpty()\n+                    ? \"\"\n+                    : (values.size() == 1\n+                    ? values.iterator().next() : values));\n+        }\n+\n+        String htmlBody =\n+                VelocityEngineUtils.mergeTemplateIntoString(velocityEngine,\n+                \"mailTemplates/optin.html.vm\",\n+                model);\n+        String textBody =\n+                VelocityEngineUtils.mergeTemplateIntoString(velocityEngine,\n+                \"mailTemplates/optin.html.vm\",\n+                model);\n+\n+        String smtpHost;\n+        try {\n+            smtpHost = confDAO.find(\"smtp.host\").getConfValue();\n+        } catch (MissingConfKeyException e) {\n+            LOG.error(\"While getting SMTP host\", e);\n+            smtpHost = \"\";\n+        }\n+\n+        super.sendMail(smtpHost,\n+                user.getAttribute(\"email\").getValuesAsStrings().\n+                iterator().next(),\n+                \"syncope@googlecode.com\",\n+                \"Welcome to Syncope\",\n+                textBody,\n+                htmlBody);\n+    }\n+}"},{"sha":"b04f581449a4a07b39f3daa8f2f19282f88b4b21","filename":"core/src/main/resources/logback.xml","status":"modified","additions":5,"deletions":0,"changes":5,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/a2e90d3542e0b48bde5035b9b235f9403fa2acab/core%2Fsrc%2Fmain%2Fresources%2Flogback.xml","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/a2e90d3542e0b48bde5035b9b235f9403fa2acab/core%2Fsrc%2Fmain%2Fresources%2Flogback.xml","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fsrc%2Fmain%2Fresources%2Flogback.xml?ref=a2e90d3542e0b48bde5035b9b235f9403fa2acab","patch":"@@ -155,6 +155,11 @@\n         <appender-ref ref=\"rest\"/>\n     </logger>\n \n+    <logger name=\"org.apache.velocity\" additivity=\"false\">\n+        <level value=\"INFO\"/>\n+        <appender-ref ref=\"rest\"/>\n+    </logger>\n+\n     <logger name=\"org.hibernate\" additivity=\"false\">\n         <level value=\"INFO\"/>\n         <appender-ref ref=\"persistence\"/>"},{"sha":"9519531af36f1e8b2325cd5f75d52f3dc45b4337","filename":"core/src/main/resources/mailTemplates/optin.html.vm","status":"added","additions":9,"deletions":0,"changes":9,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/a2e90d3542e0b48bde5035b9b235f9403fa2acab/core%2Fsrc%2Fmain%2Fresources%2FmailTemplates%2Foptin.html.vm","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/a2e90d3542e0b48bde5035b9b235f9403fa2acab/core%2Fsrc%2Fmain%2Fresources%2FmailTemplates%2Foptin.html.vm","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fsrc%2Fmain%2Fresources%2FmailTemplates%2Foptin.html.vm?ref=a2e90d3542e0b48bde5035b9b235f9403fa2acab","patch":"@@ -0,0 +1,9 @@\n+<html>\n+<body>\n+<h3>Hi ${firstname} ${surname}, welcome to Syncope!</h3>\n+\n+<div>\n+   Your email address is <a href=\"mailto:${email}\">${email}</a>.\n+</div>\n+</body>\n+</html>\n\\ No newline at end of file"},{"sha":"383f67ecdef77fc2196720d11855d263d711a8d9","filename":"core/src/main/resources/mailTemplates/optin.txt.vm","status":"added","additions":3,"deletions":0,"changes":3,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/a2e90d3542e0b48bde5035b9b235f9403fa2acab/core%2Fsrc%2Fmain%2Fresources%2FmailTemplates%2Foptin.txt.vm","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/a2e90d3542e0b48bde5035b9b235f9403fa2acab/core%2Fsrc%2Fmain%2Fresources%2FmailTemplates%2Foptin.txt.vm","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fsrc%2Fmain%2Fresources%2FmailTemplates%2Foptin.txt.vm?ref=a2e90d3542e0b48bde5035b9b235f9403fa2acab","patch":"@@ -0,0 +1,3 @@\n+Hi ${firstname} ${surname}, welcome to Syncope!\n+\n+Your email address is ${email}."},{"sha":"1afd756326eae43e465eaf5ffd24b4850bb234c4","filename":"core/src/main/resources/persistence.properties","status":"modified","additions":9,"deletions":9,"changes":18,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/a2e90d3542e0b48bde5035b9b235f9403fa2acab/core%2Fsrc%2Fmain%2Fresources%2Fpersistence.properties","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/a2e90d3542e0b48bde5035b9b235f9403fa2acab/core%2Fsrc%2Fmain%2Fresources%2Fpersistence.properties","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fsrc%2Fmain%2Fresources%2Fpersistence.properties?ref=a2e90d3542e0b48bde5035b9b235f9403fa2acab","patch":"@@ -9,14 +9,14 @@\n #  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n #  See the License for the specific language governing permissions and\n #  limitations under the License.\n-#hibernate.connection.driver_class=org.postgresql.Driver\n-hibernate.connection.driver_class=oracle.jdbc.driver.OracleDriver\n-#hibernate.connection.url=jdbc:postgresql://localhost:5432/syncope\n-hibernate.connection.url=jdbc:oracle:thin:@brandy:1521:orcl\n+hibernate.connection.driver_class=org.postgresql.Driver\n+#hibernate.connection.driver_class=oracle.jdbc.driver.OracleDriver\n+hibernate.connection.url=jdbc:postgresql://localhost:5432/syncope\n+#hibernate.connection.url=jdbc:oracle:thin:@brandy:1521:orcl\n hibernate.connection.username=syncope\n hibernate.connection.password=syncope\n-#hibernate.dialect=org.hibernate.dialect.PostgreSQLDialect\n-hibernate.dialect=org.hibernate.dialect.Oracle10gDialect\n-#dbUnitDataTypeFactory=org.dbunit.ext.postgresql.PostgresqlDataTypeFactory\n-dbUnitDataTypeFactory=org.dbunit.ext.oracle.Oracle10DataTypeFactory\n-database.schema=SYNCOPE\n+hibernate.dialect=org.hibernate.dialect.PostgreSQLDialect\n+#hibernate.dialect=org.hibernate.dialect.Oracle10gDialect\n+dbUnitDataTypeFactory=org.dbunit.ext.postgresql.PostgresqlDataTypeFactory\n+#dbUnitDataTypeFactory=org.dbunit.ext.oracle.Oracle10DataTypeFactory\n+#database.schema=SYNCOPE"},{"sha":"4a761f0b32529af71c8595b34134edabd760772e","filename":"core/src/main/resources/restContext.xml","status":"renamed","additions":0,"deletions":0,"changes":0,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/a2e90d3542e0b48bde5035b9b235f9403fa2acab/core%2Fsrc%2Fmain%2Fresources%2FrestContext.xml","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/a2e90d3542e0b48bde5035b9b235f9403fa2acab/core%2Fsrc%2Fmain%2Fresources%2FrestContext.xml","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fsrc%2Fmain%2Fresources%2FrestContext.xml?ref=a2e90d3542e0b48bde5035b9b235f9403fa2acab","previous_filename":"core/src/main/webapp/WEB-INF/syncope-core-rest-servlet.xml"},{"sha":"8946ba204ee4939fe40032c9fb98897373b18803","filename":"core/src/main/resources/userWorkflow.xml","status":"modified","additions":7,"deletions":1,"changes":8,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/a2e90d3542e0b48bde5035b9b235f9403fa2acab/core%2Fsrc%2Fmain%2Fresources%2FuserWorkflow.xml","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/a2e90d3542e0b48bde5035b9b235f9403fa2acab/core%2Fsrc%2Fmain%2Fresources%2FuserWorkflow.xml","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fsrc%2Fmain%2Fresources%2FuserWorkflow.xml?ref=a2e90d3542e0b48bde5035b9b235f9403fa2acab","patch":"@@ -26,7 +26,13 @@\n             <actions>\n                 <action name=\"create\" id=\"1001\">\n                     <results>\n-                        <unconditional-result old-status=\"creationRequest\" status=\"doubleOptIn\" step=\"2\"/>\n+                        <unconditional-result old-status=\"creationRequest\" status=\"doubleOptIn\" step=\"2\">\n+                            <post-functions>\n+                                <function type=\"class\">\n+                                    <arg name=\"class.name\">org.syncope.core.workflow.SendVelocityEmail</arg>\n+                                </function>\n+                            </post-functions>\n+                        </unconditional-result>\n                     </results>\n                 </action>\n             </actions>"},{"sha":"fe374b5a764df1042d8833b3b758929eea1fe097","filename":"core/src/main/resources/workflowContext.xml","status":"modified","additions":9,"deletions":0,"changes":9,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/a2e90d3542e0b48bde5035b9b235f9403fa2acab/core%2Fsrc%2Fmain%2Fresources%2FworkflowContext.xml","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/a2e90d3542e0b48bde5035b9b235f9403fa2acab/core%2Fsrc%2Fmain%2Fresources%2FworkflowContext.xml","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fsrc%2Fmain%2Fresources%2FworkflowContext.xml?ref=a2e90d3542e0b48bde5035b9b235f9403fa2acab","patch":"@@ -77,4 +77,13 @@\n         </property>\n     </bean>\n \n+    <bean id=\"velocityEngine\" class=\"org.springframework.ui.velocity.VelocityEngineFactoryBean\">\n+        <property name=\"velocityProperties\">\n+            <value>\n+          resource.loader=class\n+          class.resource.loader.class=org.apache.velocity.runtime.resource.loader.ClasspathResourceLoader\n+            </value>\n+        </property>\n+    </bean>\n+\n </beans>\n\\ No newline at end of file"},{"sha":"c91e8767f82bc4afc090a682e5e6ff5f7006486b","filename":"core/src/main/webapp/WEB-INF/web.xml","status":"modified","additions":1,"deletions":4,"changes":5,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/a2e90d3542e0b48bde5035b9b235f9403fa2acab/core%2Fsrc%2Fmain%2Fwebapp%2FWEB-INF%2Fweb.xml","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/a2e90d3542e0b48bde5035b9b235f9403fa2acab/core%2Fsrc%2Fmain%2Fwebapp%2FWEB-INF%2Fweb.xml","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fsrc%2Fmain%2Fwebapp%2FWEB-INF%2Fweb.xml?ref=a2e90d3542e0b48bde5035b9b235f9403fa2acab","patch":"@@ -40,10 +40,7 @@\n         <servlet-class>org.springframework.web.servlet.DispatcherServlet</servlet-class>\n         <init-param>\n             <param-name>contextConfigLocation</param-name>\n-            <param-value>\n-                /WEB-INF/syncope-core-rest-servlet.xml\n-                /WEB-INF/classes/*Context.xml\n-            </param-value>\n+            <param-value>classpath:*Context.xml</param-value>\n         </init-param>\n \n         <load-on-startup>1</load-on-startup>"},{"sha":"0ec5167650e33d27cdb2435e7ffdfc9a4c167b34","filename":"core/src/main/webapp/mailTemplates/generateToken.html.jsp","status":"removed","additions":0,"deletions":38,"changes":38,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/436b05479e0b584fce1bd9ae7c7a8a10cf46c3a2/core%2Fsrc%2Fmain%2Fwebapp%2FmailTemplates%2FgenerateToken.html.jsp","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/436b05479e0b584fce1bd9ae7c7a8a10cf46c3a2/core%2Fsrc%2Fmain%2Fwebapp%2FmailTemplates%2FgenerateToken.html.jsp","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fsrc%2Fmain%2Fwebapp%2FmailTemplates%2FgenerateToken.html.jsp?ref=436b05479e0b584fce1bd9ae7c7a8a10cf46c3a2","patch":"@@ -1,38 +0,0 @@\n-<%@ page language=\"java\" %>\n-<%@ taglib uri=\"http://java.sun.com/jsp/jstl/core\" prefix=\"c\" %>\n-<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n-<!DOCTYPE html PUBLIC \"-//W3C//DTD XHTML 1.0 Strict//EN\" \"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd\">\n-<!--\n-Licensed under the Apache License, Version 2.0 (the \"License\");\n-you may not use this file except in compliance with the License.\n-You may obtain a copy of the License at\n-\n-   http://www.apache.org/licenses/LICENSE-2.0\n-\n-Unless required by applicable law or agreed to in writing, software\n-distributed under the License is distributed on an \"AS IS\" BASIS,\n-WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n-See the License for the specific language governing permissions and\n-limitations under the License.\n-under the License.\n--->\n-<html xmlns=\"http://www.w3.org/1999/xhtml\">\n-    <head>\n-        <style type=\"text/css\">\n-            body {\n-                font: 12.0px Verdana;\n-                color: black; \n-                margin-top: 0px;\n-            }\n-        </style>\n-    </head>\n-    <body>\n-        <div id=\"confirmation\">\n-            Please, <a href=\"${param.confirmationLink}\">confirm</a> your request.\n-        </div>\n-\n-        <div id=\"greetings\">\n-            Best regards.\n-        </div>\n-    </body>\n-</html>"},{"sha":"d51ed83e3329e379c05b9cdb731a513f8d86e3b0","filename":"core/src/main/webapp/mailTemplates/generateToken.txt.jsp","status":"removed","additions":0,"deletions":18,"changes":18,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/436b05479e0b584fce1bd9ae7c7a8a10cf46c3a2/core%2Fsrc%2Fmain%2Fwebapp%2FmailTemplates%2FgenerateToken.txt.jsp","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/436b05479e0b584fce1bd9ae7c7a8a10cf46c3a2/core%2Fsrc%2Fmain%2Fwebapp%2FmailTemplates%2FgenerateToken.txt.jsp","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fsrc%2Fmain%2Fwebapp%2FmailTemplates%2FgenerateToken.txt.jsp?ref=436b05479e0b584fce1bd9ae7c7a8a10cf46c3a2","patch":"@@ -1,18 +0,0 @@\n-<!--\n-Licensed under the Apache License, Version 2.0 (the \"License\");\n-you may not use this file except in compliance with the License.\n-You may obtain a copy of the License at\n-\n-   http://www.apache.org/licenses/LICENSE-2.0\n-\n-Unless required by applicable law or agreed to in writing, software\n-distributed under the License is distributed on an \"AS IS\" BASIS,\n-WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n-See the License for the specific language governing permissions and\n-limitations under the License.\n-under the License.\n--->\n-<%@ page language=\"java\" contentType=\"text/plain\" %>\n-Please, confirm your request here: ${param.confirmationLink}.\n-\n-Best regards."},{"sha":"ce1b9e32929364a1577dd610f0113e722ad689d5","filename":"core/src/main/webapp/mailTemplates/registration.html.jsp","status":"removed","additions":0,"deletions":42,"changes":42,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/436b05479e0b584fce1bd9ae7c7a8a10cf46c3a2/core%2Fsrc%2Fmain%2Fwebapp%2FmailTemplates%2Fregistration.html.jsp","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/436b05479e0b584fce1bd9ae7c7a8a10cf46c3a2/core%2Fsrc%2Fmain%2Fwebapp%2FmailTemplates%2Fregistration.html.jsp","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fsrc%2Fmain%2Fwebapp%2FmailTemplates%2Fregistration.html.jsp?ref=436b05479e0b584fce1bd9ae7c7a8a10cf46c3a2","patch":"@@ -1,42 +0,0 @@\n-<%@ page language=\"java\" %>\n-<%@ taglib uri=\"http://java.sun.com/jsp/jstl/core\" prefix=\"c\" %>\n-<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n-<!DOCTYPE html PUBLIC \"-//W3C//DTD XHTML 1.0 Strict//EN\" \"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd\">\n-<!--\n-Licensed under the Apache License, Version 2.0 (the \"License\");\n-you may not use this file except in compliance with the License.\n-You may obtain a copy of the License at\n-\n-   http://www.apache.org/licenses/LICENSE-2.0\n-\n-Unless required by applicable law or agreed to in writing, software\n-distributed under the License is distributed on an \"AS IS\" BASIS,\n-WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n-See the License for the specific language governing permissions and\n-limitations under the License.\n-under the License.\n--->\n-<html xmlns=\"http://www.w3.org/1999/xhtml\">\n-    <head>\n-        <style type=\"text/css\">\n-            body {\n-                font: 12.0px Verdana;\n-                color: black; \n-                margin-top: 0px;\n-            }\n-        </style>\n-    </head>\n-    <body>\n-        <div id=\"welcome\">\n-            Welcome to <a href=\"http://syncope.googlecode.com\">Syncope</a>!\n-        </div>\n-\n-        <div id=\"confirmation\">\n-            Please, <a href=\"${param.confirmationLink}\">confirm</a> your registration.\n-        </div>\n-\n-        <div id=\"greetings\">\n-            Best regards.\n-        </div>\n-    </body>\n-</html>"},{"sha":"1531475bc6bd38e077b33b53fff9867391e96a24","filename":"core/src/main/webapp/mailTemplates/registration.txt.jsp","status":"removed","additions":0,"deletions":19,"changes":19,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/436b05479e0b584fce1bd9ae7c7a8a10cf46c3a2/core%2Fsrc%2Fmain%2Fwebapp%2FmailTemplates%2Fregistration.txt.jsp","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/436b05479e0b584fce1bd9ae7c7a8a10cf46c3a2/core%2Fsrc%2Fmain%2Fwebapp%2FmailTemplates%2Fregistration.txt.jsp","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fsrc%2Fmain%2Fwebapp%2FmailTemplates%2Fregistration.txt.jsp?ref=436b05479e0b584fce1bd9ae7c7a8a10cf46c3a2","patch":"@@ -1,19 +0,0 @@\n-<!--\n-Licensed under the Apache License, Version 2.0 (the \"License\");\n-you may not use this file except in compliance with the License.\n-You may obtain a copy of the License at\n-\n-   http://www.apache.org/licenses/LICENSE-2.0\n-\n-Unless required by applicable law or agreed to in writing, software\n-distributed under the License is distributed on an \"AS IS\" BASIS,\n-WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n-See the License for the specific language governing permissions and\n-limitations under the License.\n-under the License.\n--->\n-<%@ page language=\"java\" contentType=\"text/plain\" %>\n-Welcome to Syncope!\n-Please, confirm your registration here: ${param.confirmationLink}.\n-\n-Best regards."},{"sha":"6bc4753e7ba91a0f7ac06202f1beb4f66b7feb5b","filename":"core/src/main/webapp/mailTemplates/verifyToken.html.jsp","status":"removed","additions":0,"deletions":38,"changes":38,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/436b05479e0b584fce1bd9ae7c7a8a10cf46c3a2/core%2Fsrc%2Fmain%2Fwebapp%2FmailTemplates%2FverifyToken.html.jsp","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/436b05479e0b584fce1bd9ae7c7a8a10cf46c3a2/core%2Fsrc%2Fmain%2Fwebapp%2FmailTemplates%2FverifyToken.html.jsp","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fsrc%2Fmain%2Fwebapp%2FmailTemplates%2FverifyToken.html.jsp?ref=436b05479e0b584fce1bd9ae7c7a8a10cf46c3a2","patch":"@@ -1,38 +0,0 @@\n-<%@ page language=\"java\" %>\n-<%@ taglib uri=\"http://java.sun.com/jsp/jstl/core\" prefix=\"c\" %>\n-<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n-<!DOCTYPE html PUBLIC \"-//W3C//DTD XHTML 1.0 Strict//EN\" \"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd\">\n-<!--\n-Licensed under the Apache License, Version 2.0 (the \"License\");\n-you may not use this file except in compliance with the License.\n-You may obtain a copy of the License at\n-\n-   http://www.apache.org/licenses/LICENSE-2.0\n-\n-Unless required by applicable law or agreed to in writing, software\n-distributed under the License is distributed on an \"AS IS\" BASIS,\n-WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n-See the License for the specific language governing permissions and\n-limitations under the License.\n-under the License.\n--->\n-<html xmlns=\"http://www.w3.org/1999/xhtml\">\n-    <head>\n-        <style type=\"text/css\">\n-            body {\n-                font: 12.0px Verdana;\n-                color: black; \n-                margin-top: 0px;\n-            }\n-        </style>\n-    </head>\n-    <body>\n-        <div id=\"confirmation\">\n-            Your confirmation has been successfully performed.\n-        </div>\n-\n-        <div id=\"greetings\">\n-            Best regards.\n-        </div>\n-    </body>\n-</html>"},{"sha":"28a840b66099a4b4001efe777499627d9f666b1e","filename":"core/src/main/webapp/mailTemplates/verifyToken.txt.jsp","status":"removed","additions":0,"deletions":18,"changes":18,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/436b05479e0b584fce1bd9ae7c7a8a10cf46c3a2/core%2Fsrc%2Fmain%2Fwebapp%2FmailTemplates%2FverifyToken.txt.jsp","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/436b05479e0b584fce1bd9ae7c7a8a10cf46c3a2/core%2Fsrc%2Fmain%2Fwebapp%2FmailTemplates%2FverifyToken.txt.jsp","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fsrc%2Fmain%2Fwebapp%2FmailTemplates%2FverifyToken.txt.jsp?ref=436b05479e0b584fce1bd9ae7c7a8a10cf46c3a2","patch":"@@ -1,18 +0,0 @@\n-<!--\n-Licensed under the Apache License, Version 2.0 (the \"License\");\n-you may not use this file except in compliance with the License.\n-You may obtain a copy of the License at\n-\n-   http://www.apache.org/licenses/LICENSE-2.0\n-\n-Unless required by applicable law or agreed to in writing, software\n-distributed under the License is distributed on an \"AS IS\" BASIS,\n-WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n-See the License for the specific language governing permissions and\n-limitations under the License.\n-under the License.\n--->\n-<%@ page language=\"java\" contentType=\"text/plain\" %>\n-Your confirmation has been successfully performed.\n-\n-Best regards."},{"sha":"8efcc716144283d875c5d8364fdab099dbdf28e6","filename":"core/src/test/java/org/syncope/core/rest/AbstractTest.java","status":"modified","additions":1,"deletions":1,"changes":2,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/a2e90d3542e0b48bde5035b9b235f9403fa2acab/core%2Fsrc%2Ftest%2Fjava%2Forg%2Fsyncope%2Fcore%2Frest%2FAbstractTest.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/a2e90d3542e0b48bde5035b9b235f9403fa2acab/core%2Fsrc%2Ftest%2Fjava%2Forg%2Fsyncope%2Fcore%2Frest%2FAbstractTest.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fsrc%2Ftest%2Fjava%2Forg%2Fsyncope%2Fcore%2Frest%2FAbstractTest.java?ref=a2e90d3542e0b48bde5035b9b235f9403fa2acab","patch":"@@ -31,7 +31,7 @@\n     \"classpath:syncopeContext.xml\",\n     \"classpath:persistenceContext.xml\",\n     \"classpath:workflowContext.xml\",\n-    \"file:target/syncope/WEB-INF/syncope-core-rest-servlet.xml\"\n+    \"classpath:restContext.xml\"\n })\n public abstract class AbstractTest {\n "},{"sha":"47dede5a4823b2f74f910245893db8152f819986","filename":"pom.xml","status":"modified","additions":7,"deletions":7,"changes":14,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/a2e90d3542e0b48bde5035b9b235f9403fa2acab/pom.xml","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/a2e90d3542e0b48bde5035b9b235f9403fa2acab/pom.xml","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/pom.xml?ref=a2e90d3542e0b48bde5035b9b235f9403fa2acab","patch":"@@ -98,7 +98,6 @@\n \n         <commons-jexl.version>2.0.1</commons-jexl.version>\n         <commons-lang.version>2.5</commons-lang.version>\n-        <commons-email.version>1.2</commons-email.version>\n         <commons-httpclient.version>3.1</commons-httpclient.version>\n \n         <osworkflow.version>2.8.0</osworkflow.version>\n@@ -111,6 +110,7 @@\n         <jackson.version>1.5.3</jackson.version>\n         <xstream.version>1.3.1</xstream.version>\n         <aspectj.version>1.6.9</aspectj.version>\n+        <velocity.version>1.7</velocity.version>\n \n         <hibernate.version>3.4.0.GA</hibernate.version>\n         <hibernate-validator.version>4.0.2.GA</hibernate-validator.version>\n@@ -173,12 +173,6 @@\n                 <version>${commons-lang.version}</version>\n             </dependency>\n \n-            <dependency>\n-                <groupId>org.apache.commons</groupId>\n-                <artifactId>commons-email</artifactId>\n-                <version>${commons-email.version}</version>\n-            </dependency>\n-\n             <dependency>\n                 <groupId>commons-httpclient</groupId>\n                 <artifactId>commons-httpclient</artifactId>\n@@ -228,6 +222,12 @@\n                 <version>${dbunit.version}</version>\n             </dependency>\n \n+            <dependency>\n+                <groupId>org.apache.velocity</groupId>\n+                <artifactId>velocity</artifactId>\n+                <version>${velocity.version}</version>\n+            </dependency>\n+\n             <!-- Spring -->\n             <dependency>\n                 <groupId>org.springframework</groupId>"}]}