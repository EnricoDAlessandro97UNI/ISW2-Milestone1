{"sha":"68b64f84e54bc84dc2a05d34b64dcbda3434fff9","node_id":"MDY6Q29tbWl0NjM2ODc5MDYyOjY4YjY0Zjg0ZTU0YmM4NGRjMmEwNWQzNGI2NGRjYmRhMzQzNGZmZjk=","commit":{"author":{"name":"Francesco Chicchiriccò","email":"ilgrosso@apache.org","date":"2019-11-07T15:51:46Z"},"committer":{"name":"Francesco Chicchiriccò","email":"ilgrosso@apache.org","date":"2019-11-07T16:07:27Z"},"message":"[SYNCOPE-1509] Using Language Tag Filtering","tree":{"sha":"ab9aa5ce18c5032bf2f79470f239d25e4b8d5c24","url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/git/trees/ab9aa5ce18c5032bf2f79470f239d25e4b8d5c24"},"url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/git/commits/68b64f84e54bc84dc2a05d34b64dcbda3434fff9","comment_count":0,"verification":{"verified":false,"reason":"unsigned","signature":null,"payload":null}},"url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/68b64f84e54bc84dc2a05d34b64dcbda3434fff9","html_url":"https://github.com/EnricoDAlessandro97UNI/syncope/commit/68b64f84e54bc84dc2a05d34b64dcbda3434fff9","comments_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/68b64f84e54bc84dc2a05d34b64dcbda3434fff9/comments","author":{"login":"ilgrosso","id":1064664,"node_id":"MDQ6VXNlcjEwNjQ2NjQ=","avatar_url":"https://avatars.githubusercontent.com/u/1064664?v=4","gravatar_id":"","url":"https://api.github.com/users/ilgrosso","html_url":"https://github.com/ilgrosso","followers_url":"https://api.github.com/users/ilgrosso/followers","following_url":"https://api.github.com/users/ilgrosso/following{/other_user}","gists_url":"https://api.github.com/users/ilgrosso/gists{/gist_id}","starred_url":"https://api.github.com/users/ilgrosso/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ilgrosso/subscriptions","organizations_url":"https://api.github.com/users/ilgrosso/orgs","repos_url":"https://api.github.com/users/ilgrosso/repos","events_url":"https://api.github.com/users/ilgrosso/events{/privacy}","received_events_url":"https://api.github.com/users/ilgrosso/received_events","type":"User","site_admin":false},"committer":{"login":"ilgrosso","id":1064664,"node_id":"MDQ6VXNlcjEwNjQ2NjQ=","avatar_url":"https://avatars.githubusercontent.com/u/1064664?v=4","gravatar_id":"","url":"https://api.github.com/users/ilgrosso","html_url":"https://github.com/ilgrosso","followers_url":"https://api.github.com/users/ilgrosso/followers","following_url":"https://api.github.com/users/ilgrosso/following{/other_user}","gists_url":"https://api.github.com/users/ilgrosso/gists{/gist_id}","starred_url":"https://api.github.com/users/ilgrosso/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ilgrosso/subscriptions","organizations_url":"https://api.github.com/users/ilgrosso/orgs","repos_url":"https://api.github.com/users/ilgrosso/repos","events_url":"https://api.github.com/users/ilgrosso/events{/privacy}","received_events_url":"https://api.github.com/users/ilgrosso/received_events","type":"User","site_admin":false},"parents":[{"sha":"d605b6d6dc4c656086f56bd27b38642fb4fbda63","url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/d605b6d6dc4c656086f56bd27b38642fb4fbda63","html_url":"https://github.com/EnricoDAlessandro97UNI/syncope/commit/d605b6d6dc4c656086f56bd27b38642fb4fbda63"}],"stats":{"total":28,"additions":25,"deletions":3},"files":[{"sha":"40057415ce2265495317acd419ff798d572cbbcf","filename":"client/idrepo/common-ui/src/main/java/org/apache/syncope/client/ui/commons/BaseLogin.java","status":"modified","additions":22,"deletions":3,"changes":25,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/68b64f84e54bc84dc2a05d34b64dcbda3434fff9/client%2Fidrepo%2Fcommon-ui%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fclient%2Fui%2Fcommons%2FBaseLogin.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/68b64f84e54bc84dc2a05d34b64dcbda3434fff9/client%2Fidrepo%2Fcommon-ui%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fclient%2Fui%2Fcommons%2FBaseLogin.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/client%2Fidrepo%2Fcommon-ui%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fclient%2Fui%2Fcommons%2FBaseLogin.java?ref=68b64f84e54bc84dc2a05d34b64dcbda3434fff9","patch":"@@ -22,13 +22,15 @@\n import de.agilecoders.wicket.extensions.markup.html.bootstrap.form.select.BootstrapSelect;\n import java.security.AccessControlException;\n import java.util.ArrayList;\n+import java.util.Collections;\n import java.util.List;\n import java.util.Locale;\n import java.util.stream.Collectors;\n-import org.apache.commons.lang3.StringUtils;\n import org.apache.syncope.client.ui.commons.panels.NotificationPanel;\n import org.apache.syncope.common.keymaster.client.api.DomainOps;\n import org.apache.syncope.common.keymaster.client.api.model.Domain;\n+import javax.ws.rs.core.HttpHeaders;\n+import org.apache.commons.lang3.StringUtils;\n import org.apache.syncope.common.lib.SyncopeConstants;\n import org.apache.wicket.ajax.AjaxRequestTarget;\n import org.apache.wicket.ajax.form.AjaxFormComponentUpdatingBehavior;\n@@ -47,6 +49,8 @@\n import org.apache.wicket.model.IModel;\n import org.apache.wicket.model.LoadableDetachableModel;\n import org.apache.wicket.model.Model;\n+import org.apache.wicket.protocol.http.servlet.ServletWebRequest;\n+import org.apache.wicket.request.cycle.RequestCycle;\n import org.apache.wicket.request.mapper.parameter.PageParameters;\n import org.apache.wicket.spring.injection.annot.SpringBean;\n import org.slf4j.Logger;\n@@ -255,8 +259,23 @@ public void detach() {\n                 }\n             });\n \n-            // set default value to English\n-            getModel().setObject(Locale.ENGLISH);\n+            // set default language selection\n+            List<Locale> filtered = Collections.emptyList();\n+\n+            String acceptLanguage = ((ServletWebRequest) RequestCycle.get().getRequest()).\n+                    getHeader(HttpHeaders.ACCEPT_LANGUAGE);\n+            if (StringUtils.isNotBlank(acceptLanguage)) {\n+                try {\n+                    filtered = Locale.filter(Locale.LanguageRange.parse(acceptLanguage), getSupportedLocales());\n+                } catch (Exception e) {\n+                    LOG.debug(\"Could not parse {} HTTP header value '{}'\",\n+                            HttpHeaders.ACCEPT_LANGUAGE, acceptLanguage, e);\n+                }\n+            }\n+\n+            getModel().setObject(filtered.isEmpty()\n+                    ? Locale.ENGLISH\n+                    : filtered.get(0));\n         }\n     }\n }"},{"sha":"d4e0b33ef4a82f9a4263a52dc570fc77b564a40b","filename":"fit/core-reference/src/test/java/org/apache/syncope/fit/console/AbstractConsoleITCase.java","status":"modified","additions":3,"deletions":0,"changes":3,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/68b64f84e54bc84dc2a05d34b64dcbda3434fff9/fit%2Fcore-reference%2Fsrc%2Ftest%2Fjava%2Forg%2Fapache%2Fsyncope%2Ffit%2Fconsole%2FAbstractConsoleITCase.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/68b64f84e54bc84dc2a05d34b64dcbda3434fff9/fit%2Fcore-reference%2Fsrc%2Ftest%2Fjava%2Forg%2Fapache%2Fsyncope%2Ffit%2Fconsole%2FAbstractConsoleITCase.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/fit%2Fcore-reference%2Fsrc%2Ftest%2Fjava%2Forg%2Fapache%2Fsyncope%2Ffit%2Fconsole%2FAbstractConsoleITCase.java?ref=68b64f84e54bc84dc2a05d34b64dcbda3434fff9","patch":"@@ -29,6 +29,7 @@\n import org.apache.syncope.client.console.SyncopeIdRepoConsoleContext;\n import org.apache.syncope.client.console.SyncopeWebApplication;\n import org.apache.syncope.client.console.commons.PreviewUtils;\n+import java.util.Locale;\n import org.apache.syncope.client.console.pages.Login;\n import org.apache.syncope.client.lib.SyncopeClientFactoryBean;\n import org.apache.syncope.common.keymaster.client.self.SelfKeymasterClientContext;\n@@ -79,6 +80,8 @@ public PreviewUtils previewUtils() {\n \n     @BeforeAll\n     public static void setUp() {\n+        Locale.setDefault(Locale.ENGLISH);\n+\n         synchronized (LOG) {\n             if (UTILITY_UI == null) {\n                 AnnotationConfigApplicationContext ctx = new AnnotationConfigApplicationContext();"}]}