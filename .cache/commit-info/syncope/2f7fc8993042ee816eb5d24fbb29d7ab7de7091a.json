{"sha":"2f7fc8993042ee816eb5d24fbb29d7ab7de7091a","node_id":"MDY6Q29tbWl0NjM2ODc5MDYyOjJmN2ZjODk5MzA0MmVlODE2ZWI1ZDI0ZmJiMjlkN2FiN2RlNzA5MWE=","commit":{"author":{"name":"Marco Di Sabatino Di Diodoro","email":"mdisabatino@apache.org","date":"2015-02-18T13:09:48Z"},"committer":{"name":"Marco Di Sabatino Di Diodoro","email":"mdisabatino@apache.org","date":"2015-02-18T13:09:48Z"},"message":"[SYNCOPE-644] Fix Role Sync with RoleSchema as accountId","tree":{"sha":"19e6259ef7a12f33201563e0dfc9e63eee82f2d3","url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/git/trees/19e6259ef7a12f33201563e0dfc9e63eee82f2d3"},"url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/git/commits/2f7fc8993042ee816eb5d24fbb29d7ab7de7091a","comment_count":0,"verification":{"verified":false,"reason":"unsigned","signature":null,"payload":null}},"url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/2f7fc8993042ee816eb5d24fbb29d7ab7de7091a","html_url":"https://github.com/EnricoDAlessandro97UNI/syncope/commit/2f7fc8993042ee816eb5d24fbb29d7ab7de7091a","comments_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/2f7fc8993042ee816eb5d24fbb29d7ab7de7091a/comments","author":{"login":"mdisabatino","id":1792527,"node_id":"MDQ6VXNlcjE3OTI1Mjc=","avatar_url":"https://avatars.githubusercontent.com/u/1792527?v=4","gravatar_id":"","url":"https://api.github.com/users/mdisabatino","html_url":"https://github.com/mdisabatino","followers_url":"https://api.github.com/users/mdisabatino/followers","following_url":"https://api.github.com/users/mdisabatino/following{/other_user}","gists_url":"https://api.github.com/users/mdisabatino/gists{/gist_id}","starred_url":"https://api.github.com/users/mdisabatino/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mdisabatino/subscriptions","organizations_url":"https://api.github.com/users/mdisabatino/orgs","repos_url":"https://api.github.com/users/mdisabatino/repos","events_url":"https://api.github.com/users/mdisabatino/events{/privacy}","received_events_url":"https://api.github.com/users/mdisabatino/received_events","type":"User","site_admin":false},"committer":{"login":"mdisabatino","id":1792527,"node_id":"MDQ6VXNlcjE3OTI1Mjc=","avatar_url":"https://avatars.githubusercontent.com/u/1792527?v=4","gravatar_id":"","url":"https://api.github.com/users/mdisabatino","html_url":"https://github.com/mdisabatino","followers_url":"https://api.github.com/users/mdisabatino/followers","following_url":"https://api.github.com/users/mdisabatino/following{/other_user}","gists_url":"https://api.github.com/users/mdisabatino/gists{/gist_id}","starred_url":"https://api.github.com/users/mdisabatino/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mdisabatino/subscriptions","organizations_url":"https://api.github.com/users/mdisabatino/orgs","repos_url":"https://api.github.com/users/mdisabatino/repos","events_url":"https://api.github.com/users/mdisabatino/events{/privacy}","received_events_url":"https://api.github.com/users/mdisabatino/received_events","type":"User","site_admin":false},"parents":[{"sha":"742b4eca76a321b3ee3cde0032b7e501d17be26e","url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/742b4eca76a321b3ee3cde0032b7e501d17be26e","html_url":"https://github.com/EnricoDAlessandro97UNI/syncope/commit/742b4eca76a321b3ee3cde0032b7e501d17be26e"}],"stats":{"total":11,"additions":9,"deletions":2},"files":[{"sha":"94dea9a26fb22c593bb6af23b49249f36cf1b004","filename":"core/src/main/java/org/apache/syncope/core/sync/SyncUtilities.java","status":"modified","additions":9,"deletions":2,"changes":11,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/2f7fc8993042ee816eb5d24fbb29d7ab7de7091a/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fsync%2FSyncUtilities.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/2f7fc8993042ee816eb5d24fbb29d7ab7de7091a/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fsync%2FSyncUtilities.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fsync%2FSyncUtilities.java?ref=2f7fc8993042ee816eb5d24fbb29d7ab7de7091a","patch":"@@ -23,6 +23,7 @@\n import java.util.HashMap;\n import java.util.List;\n import java.util.Map;\n+import org.apache.syncope.common.types.AttributableType;\n import org.apache.syncope.common.types.MappingPurpose;\n import org.apache.syncope.common.types.SubjectType;\n import org.apache.syncope.common.types.SyncPolicySpec;\n@@ -39,6 +40,7 @@\n import org.apache.syncope.core.persistence.dao.PolicyDAO;\n import org.apache.syncope.core.persistence.dao.RoleDAO;\n import org.apache.syncope.core.persistence.dao.SchemaDAO;\n+import org.apache.syncope.core.persistence.dao.SubjectDAO;\n import org.apache.syncope.core.persistence.dao.SubjectSearchDAO;\n import org.apache.syncope.core.persistence.dao.UserDAO;\n import org.apache.syncope.core.persistence.dao.search.AttributeCond;\n@@ -168,15 +170,16 @@ public List<Long> findByAccountIdItem(\n                 }\n \n                 List<AbstractSubject> subjects =\n-                        userDAO.findByAttrValue(accountIdItem.getIntAttrName(), value, attrUtil);\n+                        getSubjectDAO(accountIdItem).findByAttrValue(accountIdItem.getIntAttrName(), value, attrUtil);\n                 for (AbstractSubject subject : subjects) {\n                     result.add(subject.getId());\n                 }\n                 break;\n \n             case UserDerivedSchema:\n             case RoleDerivedSchema:\n-                subjects = userDAO.findByDerAttrValue(accountIdItem.getIntAttrName(), uid, attrUtil);\n+                subjects = getSubjectDAO(accountIdItem).\n+                        findByDerAttrValue(accountIdItem.getIntAttrName(), uid, attrUtil);\n                 for (AbstractSubject subject : subjects) {\n                     result.add(subject.getId());\n                 }\n@@ -352,4 +355,8 @@ public Boolean readEnabled(final ConnectorObject connectorObject, final Abstract\n \n         return enabled;\n     }\n+\n+    private SubjectDAO getSubjectDAO(final AbstractMappingItem accountIdItem) {\n+        return AttributableType.USER == accountIdItem.getIntMappingType().getAttributableType() ? userDAO : roleDAO;\n+    }\n }"}]}