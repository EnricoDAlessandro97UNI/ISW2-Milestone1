{"sha":"9218c90f9153d536936c57051114b07347449821","node_id":"MDY6Q29tbWl0NjM2ODc5MDYyOjkyMThjOTBmOTE1M2Q1MzY5MzZjNTcwNTExMTRiMDczNDc0NDk4MjE=","commit":{"author":{"name":"Misagh Moayyed","email":"mm1844@gmail.com","date":"2020-03-09T13:07:19Z"},"committer":{"name":"Francesco Chicchiricc√≤","email":"ilgrosso@apache.org","date":"2020-03-17T06:42:19Z"},"message":"[SYNCOPE-1545] move config to configuration class, add support for restful registry with entity-mapping, add support for config validation","tree":{"sha":"b69303d45c7939d7431a35be77a3adfb7fb2d3b6","url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/git/trees/b69303d45c7939d7431a35be77a3adfb7fb2d3b6"},"url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/git/commits/9218c90f9153d536936c57051114b07347449821","comment_count":0,"verification":{"verified":false,"reason":"unsigned","signature":null,"payload":null}},"url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/9218c90f9153d536936c57051114b07347449821","html_url":"https://github.com/EnricoDAlessandro97UNI/syncope/commit/9218c90f9153d536936c57051114b07347449821","comments_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/9218c90f9153d536936c57051114b07347449821/comments","author":{"login":"mmoayyed","id":1205228,"node_id":"MDQ6VXNlcjEyMDUyMjg=","avatar_url":"https://avatars.githubusercontent.com/u/1205228?v=4","gravatar_id":"","url":"https://api.github.com/users/mmoayyed","html_url":"https://github.com/mmoayyed","followers_url":"https://api.github.com/users/mmoayyed/followers","following_url":"https://api.github.com/users/mmoayyed/following{/other_user}","gists_url":"https://api.github.com/users/mmoayyed/gists{/gist_id}","starred_url":"https://api.github.com/users/mmoayyed/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mmoayyed/subscriptions","organizations_url":"https://api.github.com/users/mmoayyed/orgs","repos_url":"https://api.github.com/users/mmoayyed/repos","events_url":"https://api.github.com/users/mmoayyed/events{/privacy}","received_events_url":"https://api.github.com/users/mmoayyed/received_events","type":"User","site_admin":false},"committer":{"login":"ilgrosso","id":1064664,"node_id":"MDQ6VXNlcjEwNjQ2NjQ=","avatar_url":"https://avatars.githubusercontent.com/u/1064664?v=4","gravatar_id":"","url":"https://api.github.com/users/ilgrosso","html_url":"https://github.com/ilgrosso","followers_url":"https://api.github.com/users/ilgrosso/followers","following_url":"https://api.github.com/users/ilgrosso/following{/other_user}","gists_url":"https://api.github.com/users/ilgrosso/gists{/gist_id}","starred_url":"https://api.github.com/users/ilgrosso/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ilgrosso/subscriptions","organizations_url":"https://api.github.com/users/ilgrosso/orgs","repos_url":"https://api.github.com/users/ilgrosso/repos","events_url":"https://api.github.com/users/ilgrosso/events{/privacy}","received_events_url":"https://api.github.com/users/ilgrosso/received_events","type":"User","site_admin":false},"parents":[{"sha":"129544844e25b982e17290ab34ddc4992b304e4a","url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/129544844e25b982e17290ab34ddc4992b304e4a","html_url":"https://github.com/EnricoDAlessandro97UNI/syncope/commit/129544844e25b982e17290ab34ddc4992b304e4a"}],"stats":{"total":94,"additions":79,"deletions":15},"files":[{"sha":"09d2fa292f818f5bcde05937e1c68db978f070c8","filename":"wa/pom.xml","status":"modified","additions":4,"deletions":0,"changes":4,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/9218c90f9153d536936c57051114b07347449821/wa%2Fpom.xml","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/9218c90f9153d536936c57051114b07347449821/wa%2Fpom.xml","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/wa%2Fpom.xml?ref=9218c90f9153d536936c57051114b07347449821","patch":"@@ -163,6 +163,10 @@ under the License.\n       <groupId>org.apereo.cas</groupId>\n       <artifactId>cas-server-support-consent-webflow</artifactId>\n     </dependency>\n+    <dependency>\n+      <groupId>org.apereo.cas</groupId>\n+      <artifactId>cas-server-support-rest-service-registry</artifactId>\n+    </dependency>\n     <dependency>\n       <groupId>org.apereo.cas</groupId>\n       <artifactId>cas-server-webapp-config</artifactId>"},{"sha":"dac26bb91605921b342e5d7e82da0ad04df20a8f","filename":"wa/src/main/java/org/apache/syncope/wa/SyncopeWAApplication.java","status":"modified","additions":9,"deletions":15,"changes":24,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/9218c90f9153d536936c57051114b07347449821/wa%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fwa%2FSyncopeWAApplication.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/9218c90f9153d536936c57051114b07347449821/wa%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fwa%2FSyncopeWAApplication.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/wa%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fwa%2FSyncopeWAApplication.java?ref=9218c90f9153d536936c57051114b07347449821","patch":"@@ -18,13 +18,12 @@\n  */\n package org.apache.syncope.wa;\n \n-import org.apache.commons.lang.StringUtils;\n-import org.apache.syncope.common.keymaster.client.api.model.NetworkService;\n-import org.apache.syncope.common.keymaster.client.api.startstop.KeymasterStart;\n-import org.apache.syncope.common.keymaster.client.api.startstop.KeymasterStop;\n import org.apereo.cas.configuration.CasConfigurationProperties;\n+import org.apereo.cas.configuration.CasConfigurationPropertiesValidator;\n import org.apereo.cas.util.AsciiArtUtils;\n import org.apereo.cas.util.DateTimeUtils;\n+\n+import org.apache.commons.lang.StringUtils;\n import org.slf4j.Logger;\n import org.slf4j.LoggerFactory;\n import org.springframework.boot.autoconfigure.SpringBootApplication;\n@@ -44,7 +43,6 @@\n import org.springframework.boot.context.event.ApplicationReadyEvent;\n import org.springframework.boot.context.properties.EnableConfigurationProperties;\n import org.springframework.boot.web.servlet.support.SpringBootServletInitializer;\n-import org.springframework.context.annotation.Bean;\n import org.springframework.context.annotation.EnableAspectJAutoProxy;\n import org.springframework.context.annotation.PropertySource;\n import org.springframework.context.event.EventListener;\n@@ -88,17 +86,13 @@ public static void main(final String[] args) {\n      */\n     @EventListener\n     public void handleApplicationReadyEvent(final ApplicationReadyEvent event) {\n+        if (!Boolean.getBoolean(\"SKIP_CONFIG_VALIDATION\")) {\n+            CasConfigurationPropertiesValidator validator =\n+                new CasConfigurationPropertiesValidator(event.getApplicationContext());\n+            validator.validate();\n+        }\n+\n         AsciiArtUtils.printAsciiArtReady(LOG, StringUtils.EMPTY);\n         LOG.info(\"Ready to process requests @ [{}]\", DateTimeUtils.zonedDateTimeOf(event.getTimestamp()));\n     }\n-\n-    @Bean\n-    public KeymasterStart keymasterStart() {\n-        return new KeymasterStart(NetworkService.Type.WA);\n-    }\n-\n-    @Bean\n-    public KeymasterStop keymasterStop() {\n-        return new KeymasterStop(NetworkService.Type.WA);\n-    }\n }"},{"sha":"2107f510227bef42a919f87f785f7bb711edd7fc","filename":"wa/src/main/java/org/apache/syncope/wa/config/SyncopeWAConfiguration.java","status":"added","additions":49,"deletions":0,"changes":49,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/9218c90f9153d536936c57051114b07347449821/wa%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fwa%2Fconfig%2FSyncopeWAConfiguration.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/9218c90f9153d536936c57051114b07347449821/wa%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fwa%2Fconfig%2FSyncopeWAConfiguration.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/wa%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fwa%2Fconfig%2FSyncopeWAConfiguration.java?ref=9218c90f9153d536936c57051114b07347449821","patch":"@@ -0,0 +1,49 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *    http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ *\n+ */\n+\n+package org.apache.syncope.wa.config;\n+\n+import org.apereo.cas.services.DefaultRegisteredServiceEntityMapper;\n+import org.apereo.cas.services.RegisteredServiceEntityMapper;\n+\n+import org.apache.syncope.common.keymaster.client.api.model.NetworkService;\n+import org.apache.syncope.common.keymaster.client.api.startstop.KeymasterStart;\n+import org.apache.syncope.common.keymaster.client.api.startstop.KeymasterStop;\n+import org.springframework.boot.autoconfigure.condition.ConditionalOnProperty;\n+import org.springframework.context.annotation.Bean;\n+import org.springframework.context.annotation.Configuration;\n+\n+@Configuration(proxyBeanMethods = false)\n+public class SyncopeWAConfiguration {\n+    @Bean\n+    @ConditionalOnProperty(name = \"cas.serviceRegistry.rest.url\")\n+    public RegisteredServiceEntityMapper registeredServiceEntityMapper() {\n+        return new DefaultRegisteredServiceEntityMapper();\n+    }\n+\n+    @Bean\n+    public KeymasterStart keymasterStart() {\n+        return new KeymasterStart(NetworkService.Type.WA);\n+    }\n+\n+    @Bean\n+    public KeymasterStop keymasterStop() {\n+        return new KeymasterStop(NetworkService.Type.WA);\n+    }\n+}"},{"sha":"db54cd03b491af0a85e465a72df2c1fe178f1e7c","filename":"wa/src/main/resources/META-INF/spring.factories","status":"added","additions":17,"deletions":0,"changes":17,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/9218c90f9153d536936c57051114b07347449821/wa%2Fsrc%2Fmain%2Fresources%2FMETA-INF%2Fspring.factories","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/9218c90f9153d536936c57051114b07347449821/wa%2Fsrc%2Fmain%2Fresources%2FMETA-INF%2Fspring.factories","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/wa%2Fsrc%2Fmain%2Fresources%2FMETA-INF%2Fspring.factories?ref=9218c90f9153d536936c57051114b07347449821","patch":"@@ -0,0 +1,17 @@\n+# Licensed to the Apache Software Foundation (ASF) under one\n+# or more contributor license agreements.  See the NOTICE file\n+# distributed with this work for additional information\n+# regarding copyright ownership.  The ASF licenses this file\n+# to you under the Apache License, Version 2.0 (the\n+# \"License\"); you may not use this file except in compliance\n+# with the License.  You may obtain a copy of the License at\n+#\n+#   http://www.apache.org/licenses/LICENSE-2.0\n+#\n+# Unless required by applicable law or agreed to in writing,\n+# software distributed under the License is distributed on an\n+# \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+# KIND, either express or implied.  See the License for the\n+# specific language governing permissions and limitations\n+# under the License.\n+org.springframework.boot.autoconfigure.EnableAutoConfiguration=org.apache.syncope.wa.config.SyncopeWAConfiguration"}]}