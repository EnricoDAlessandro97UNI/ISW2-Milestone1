{"sha":"ebcd3034d62fbdb5dc1a8754d9f588b89bef363e","node_id":"MDY6Q29tbWl0NjM2ODc5MDYyOmViY2QzMDM0ZDYyZmJkYjVkYzFhODc1NGQ5ZjU4OGI4OWJlZjM2M2U=","commit":{"author":{"name":"Massimiliano Perrone","email":"massi@apache.org","date":"2014-10-01T12:02:24Z"},"committer":{"name":"Massimiliano Perrone","email":"massi@apache.org","date":"2014-10-01T12:02:24Z"},"message":"Added Maven logs #SYNCOPE-143\n\ngit-svn-id: https://svn.apache.org/repos/asf/syncope/branches/1_2_X@1628682 13f79535-47bb-0310-9956-ffa450edef68","tree":{"sha":"4f9775376e5bbbcad610a8ad19a4459f6ac62ca6","url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/git/trees/4f9775376e5bbbcad610a8ad19a4459f6ac62ca6"},"url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/git/commits/ebcd3034d62fbdb5dc1a8754d9f588b89bef363e","comment_count":0,"verification":{"verified":false,"reason":"unsigned","signature":null,"payload":null}},"url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/ebcd3034d62fbdb5dc1a8754d9f588b89bef363e","html_url":"https://github.com/EnricoDAlessandro97UNI/syncope/commit/ebcd3034d62fbdb5dc1a8754d9f588b89bef363e","comments_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/ebcd3034d62fbdb5dc1a8754d9f588b89bef363e/comments","author":null,"committer":null,"parents":[{"sha":"4e444cd4b1238656f75d34bcf7a375a9a0491858","url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/4e444cd4b1238656f75d34bcf7a375a9a0491858","html_url":"https://github.com/EnricoDAlessandro97UNI/syncope/commit/4e444cd4b1238656f75d34bcf7a375a9a0491858"}],"stats":{"total":33,"additions":27,"deletions":6},"files":[{"sha":"c96f1eea89359badd6b96360ff9aee9d1e7d6900","filename":"installer/src/main/java/org/apache/syncope/installer/processes/ArchetypeProcess.java","status":"modified","additions":3,"deletions":0,"changes":3,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/ebcd3034d62fbdb5dc1a8754d9f588b89bef363e/installer%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Finstaller%2Fprocesses%2FArchetypeProcess.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/ebcd3034d62fbdb5dc1a8754d9f588b89bef363e/installer%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Finstaller%2Fprocesses%2FArchetypeProcess.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/installer%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Finstaller%2Fprocesses%2FArchetypeProcess.java?ref=ebcd3034d62fbdb5dc1a8754d9f588b89bef363e","patch":"@@ -92,6 +92,9 @@ public void run(final AbstractUIProcessHandler handler, final String[] args) {\n             InstallLog.getInstance().error(messageError.append(ex.getMessage() == null ? \"\" : ex.getMessage()).\n                     toString());\n         }\n+        handler.logOutput(\"########################## IMPORTANT ##########################\", true);\n+        handler.logOutput(\"See \" + InstallLog.getInstance().getFileAbsolutePath() + \" for the maven logs\", true);\n+        handler.logOutput(\"########################## IMPORTANT ##########################\", true);\n         mavenUtils.archetypeGenerate(\n                 syncopeVersion, groupId, artifactId, secretKey, anonymousKey, installPath, customMavenProxySettings);\n "},{"sha":"91c03df88e819042001c6c95f2636d39e1030a4c","filename":"installer/src/main/java/org/apache/syncope/installer/utilities/InstallLog.java","status":"modified","additions":8,"deletions":1,"changes":9,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/ebcd3034d62fbdb5dc1a8754d9f588b89bef363e/installer%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Finstaller%2Futilities%2FInstallLog.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/ebcd3034d62fbdb5dc1a8754d9f588b89bef363e/installer%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Finstaller%2Futilities%2FInstallLog.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/installer%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Finstaller%2Futilities%2FInstallLog.java?ref=ebcd3034d62fbdb5dc1a8754d9f588b89bef363e","patch":"@@ -30,8 +30,11 @@ public class InstallLog {\n \n     private final FileSystemUtils fileSystemUtils;\n \n+    private final String fileAbsolutePath;\n+\n     private InstallLog(final String installPath, final AbstractUIProcessHandler handler) {\n-        log = new File(installPath + \"/install.log\");\n+        fileAbsolutePath = installPath + \"/install.log\";\n+        log = new File(fileAbsolutePath);\n         fileSystemUtils = new FileSystemUtils(handler);\n     }\n \n@@ -56,6 +59,10 @@ public void info(final String msg) {\n         writeToFile(\"Info\", msg);\n     }\n \n+    public String getFileAbsolutePath() {\n+        return fileAbsolutePath;\n+    }\n+\n     private void writeToFile(final String what, final String msg) {\n         fileSystemUtils.appendToFile(log, new Date() + \" | \" + what + \": \" + msg);\n     }"},{"sha":"1531b6386b0862e46e06c472bff56f162251a86f","filename":"installer/src/main/java/org/apache/syncope/installer/utilities/MavenUtils.java","status":"modified","additions":16,"deletions":5,"changes":21,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/ebcd3034d62fbdb5dc1a8754d9f588b89bef363e/installer%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Finstaller%2Futilities%2FMavenUtils.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/ebcd3034d62fbdb5dc1a8754d9f588b89bef363e/installer%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Finstaller%2Futilities%2FMavenUtils.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/installer%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Finstaller%2Futilities%2FMavenUtils.java?ref=ebcd3034d62fbdb5dc1a8754d9f588b89bef363e","patch":"@@ -20,8 +20,10 @@\n \n import com.izforge.izpack.panels.process.AbstractUIProcessHandler;\n import java.io.File;\n+import java.io.FileNotFoundException;\n import java.io.FileOutputStream;\n import java.io.IOException;\n+import java.io.PrintStream;\n import java.util.ArrayList;\n import java.util.Collections;\n import java.util.List;\n@@ -37,6 +39,8 @@\n import org.apache.maven.shared.invoker.InvocationResult;\n import org.apache.maven.shared.invoker.Invoker;\n import org.apache.maven.shared.invoker.MavenInvocationException;\n+import org.apache.maven.shared.invoker.PrintStreamHandler;\n+import org.apache.maven.shared.invoker.PrintStreamLogger;\n import org.w3c.dom.Document;\n import org.w3c.dom.Element;\n import org.xml.sax.SAXException;\n@@ -61,8 +65,8 @@ public void archetypeGenerate(final String archetypeVersion, final String groupI\n         final InvocationRequest request = new DefaultInvocationRequest();\n         request.setGoals(Collections.singletonList(\"archetype:generate\"));\n         request.setInteractive(false);\n-        final Properties properties =\n-                archetypeProperties(archetypeVersion, groupId, artifactId, secretKey, anonymousKey);\n+        final Properties properties\n+                = archetypeProperties(archetypeVersion, groupId, artifactId, secretKey, anonymousKey);\n         request.setProperties(properties);\n         if (customSettingsFile != null && FileUtils.sizeOf(customSettingsFile) > 0) {\n             request.setUserSettingsFile(customSettingsFile);\n@@ -99,7 +103,7 @@ public void mvnCleanPackage(final String path, final File customSettingsFile) {\n         logToFile(request.getGoals(), new Properties());\n         invoke(request, path);\n     }\n-    \n+\n     public void mvnCleanPackageWithProperties(final String path, final String confDirectory,\n             final String logDirectory, final String bundlesDirectory, final File customSettingsFile) {\n         final InvocationRequest request = new DefaultInvocationRequest();\n@@ -153,14 +157,21 @@ private Properties packageProperties(final String confDirectory, final String lo\n     private InvocationResult invoke(final InvocationRequest request, final String path) {\n         InvocationResult result = null;\n         final Invoker invoker = new DefaultInvoker();\n-        invoker.setOutputHandler(null);\n-        invoker.setWorkingDirectory(new File(path));\n         try {\n+            invoker.setLogger( new PrintStreamLogger(\n+                    new PrintStream(InstallLog.getInstance().getFileAbsolutePath()), 1000));\n+            invoker.setOutputHandler(new PrintStreamHandler(\n+                    new PrintStream(InstallLog.getInstance().getFileAbsolutePath()), true));\n+            invoker.setWorkingDirectory(new File(path));\n             result = invoker.execute(request);\n         } catch (MavenInvocationException ex) {\n             final String messageError = \"Maven exception: \" + ex.getMessage();\n             handler.emitError(messageError, messageError);\n             InstallLog.getInstance().info(messageError);\n+        } catch (FileNotFoundException ex) {\n+            final String messageError = \"Maven exception: \" + ex.getMessage();\n+            handler.emitError(messageError, messageError);\n+            InstallLog.getInstance().info(messageError);\n         }\n         return result;\n     }"}]}