{"sha":"366395b124c96fb618864311ce6f455acbf7afbe","node_id":"MDY6Q29tbWl0NjM2ODc5MDYyOjM2NjM5NWIxMjRjOTZmYjYxODg2NDMxMWNlNmY0NTVhY2JmN2FmYmU=","commit":{"author":{"name":"Francesco Chicchiriccò","email":"ilgrosso@apache.org","date":"2014-10-30T16:20:53Z"},"committer":{"name":"Francesco Chicchiriccò","email":"ilgrosso@apache.org","date":"2014-10-30T16:20:53Z"},"message":"Merge branch '1_2_X'","tree":{"sha":"2d668f597fecb2330538ed9b34637a0306c4d4ee","url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/git/trees/2d668f597fecb2330538ed9b34637a0306c4d4ee"},"url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/git/commits/366395b124c96fb618864311ce6f455acbf7afbe","comment_count":0,"verification":{"verified":false,"reason":"unsigned","signature":null,"payload":null}},"url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/366395b124c96fb618864311ce6f455acbf7afbe","html_url":"https://github.com/EnricoDAlessandro97UNI/syncope/commit/366395b124c96fb618864311ce6f455acbf7afbe","comments_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/366395b124c96fb618864311ce6f455acbf7afbe/comments","author":{"login":"ilgrosso","id":1064664,"node_id":"MDQ6VXNlcjEwNjQ2NjQ=","avatar_url":"https://avatars.githubusercontent.com/u/1064664?v=4","gravatar_id":"","url":"https://api.github.com/users/ilgrosso","html_url":"https://github.com/ilgrosso","followers_url":"https://api.github.com/users/ilgrosso/followers","following_url":"https://api.github.com/users/ilgrosso/following{/other_user}","gists_url":"https://api.github.com/users/ilgrosso/gists{/gist_id}","starred_url":"https://api.github.com/users/ilgrosso/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ilgrosso/subscriptions","organizations_url":"https://api.github.com/users/ilgrosso/orgs","repos_url":"https://api.github.com/users/ilgrosso/repos","events_url":"https://api.github.com/users/ilgrosso/events{/privacy}","received_events_url":"https://api.github.com/users/ilgrosso/received_events","type":"User","site_admin":false},"committer":{"login":"ilgrosso","id":1064664,"node_id":"MDQ6VXNlcjEwNjQ2NjQ=","avatar_url":"https://avatars.githubusercontent.com/u/1064664?v=4","gravatar_id":"","url":"https://api.github.com/users/ilgrosso","html_url":"https://github.com/ilgrosso","followers_url":"https://api.github.com/users/ilgrosso/followers","following_url":"https://api.github.com/users/ilgrosso/following{/other_user}","gists_url":"https://api.github.com/users/ilgrosso/gists{/gist_id}","starred_url":"https://api.github.com/users/ilgrosso/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ilgrosso/subscriptions","organizations_url":"https://api.github.com/users/ilgrosso/orgs","repos_url":"https://api.github.com/users/ilgrosso/repos","events_url":"https://api.github.com/users/ilgrosso/events{/privacy}","received_events_url":"https://api.github.com/users/ilgrosso/received_events","type":"User","site_admin":false},"parents":[{"sha":"7530ea211bfc12397300ff76e401a755ccd03d6a","url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/7530ea211bfc12397300ff76e401a755ccd03d6a","html_url":"https://github.com/EnricoDAlessandro97UNI/syncope/commit/7530ea211bfc12397300ff76e401a755ccd03d6a"},{"sha":"f44df5bfdf83112b5ecfa033a3710495e03df151","url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/f44df5bfdf83112b5ecfa033a3710495e03df151","html_url":"https://github.com/EnricoDAlessandro97UNI/syncope/commit/f44df5bfdf83112b5ecfa033a3710495e03df151"}],"stats":{"total":55,"additions":50,"deletions":5},"files":[{"sha":"1f4e45b15ca7edba5ea4d0de37d7cc2b7824450f","filename":"common/src/main/java/org/apache/syncope/common/services/RoleService.java","status":"modified","additions":14,"deletions":0,"changes":14,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/366395b124c96fb618864311ce6f455acbf7afbe/common%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcommon%2Fservices%2FRoleService.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/366395b124c96fb618864311ce6f455acbf7afbe/common%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcommon%2Fservices%2FRoleService.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/common%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcommon%2Fservices%2FRoleService.java?ref=366395b124c96fb618864311ce6f455acbf7afbe","patch":"@@ -37,6 +37,8 @@\n import org.apache.cxf.jaxrs.model.wadl.DocTarget;\n import org.apache.syncope.common.reqres.PagedResult;\n import org.apache.syncope.common.mod.RoleMod;\n+import org.apache.syncope.common.reqres.BulkAction;\n+import org.apache.syncope.common.reqres.BulkActionResult;\n import org.apache.syncope.common.to.RoleTO;\n import org.apache.syncope.common.types.ResourceAssociationActionType;\n import org.apache.syncope.common.types.ResourceDeassociationActionType;\n@@ -296,4 +298,16 @@ Response bulkDeassociation(@NotNull @PathParam(\"roleId\") Long roleId,\n     Response bulkAssociation(@NotNull @PathParam(\"roleId\") Long roleId,\n             @NotNull @PathParam(\"type\") ResourceAssociationActionType type,\n             @NotNull List<ResourceName> resourceNames);\n+\n+    /**\n+     * Executes the provided bulk action.\n+     *\n+     * @param bulkAction list of role ids against which the bulk action will be performed.\n+     * @return Bulk action result\n+     */\n+    @POST\n+    @Path(\"bulk\")\n+    @Produces({ MediaType.APPLICATION_XML, MediaType.APPLICATION_JSON })\n+    @Consumes({ MediaType.APPLICATION_XML, MediaType.APPLICATION_JSON })\n+    BulkActionResult bulk(@NotNull BulkAction bulkAction);\n }"},{"sha":"f76570cbd985ef1d976580f5cfb26060f4ccd53f","filename":"console/src/main/java/org/apache/syncope/console/pages/BulkActionModalPage.java","status":"modified","additions":5,"deletions":1,"changes":6,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/366395b124c96fb618864311ce6f455acbf7afbe/console%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fconsole%2Fpages%2FBulkActionModalPage.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/366395b124c96fb618864311ce6f455acbf7afbe/console%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fconsole%2Fpages%2FBulkActionModalPage.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/console%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fconsole%2Fpages%2FBulkActionModalPage.java?ref=366395b124c96fb618864311ce6f455acbf7afbe","patch":"@@ -25,6 +25,7 @@\n import java.util.List;\n import org.apache.syncope.common.reqres.BulkAction;\n import org.apache.syncope.common.reqres.BulkActionResult;\n+import org.apache.syncope.console.commons.Constants;\n import org.apache.syncope.console.rest.BaseRestClient;\n import org.apache.syncope.console.wicket.ajax.markup.html.ClearIndicatingAjaxButton;\n import org.apache.syncope.console.wicket.markup.html.form.ActionLink;\n@@ -83,6 +84,7 @@ public IModel<T> model(final T object) {\n                 dataProvider,\n                 Integer.MAX_VALUE).setVisible(items != null && !items.isEmpty()));\n \n+        @SuppressWarnings(\"rawtypes\")\n         final ActionLinksPanel actionPanel = new ActionLinksPanel(\"actions\", new Model(), getPageReference());\n         add(actionPanel);\n \n@@ -128,7 +130,9 @@ public void onClick(final AjaxRequestTarget target) {\n \n                         setResponsePage(new BulkActionResultModalPage<T, S>(window, items, columns, res, idFieldName));\n                     } catch (Exception e) {\n-                        LOG.error(\"Operation {} not supported\", bulkAction.getOperation(), e);\n+                        error(getString(Constants.ERROR)\n+                                + \": Operation \" + bulkAction.getOperation() + \" not supported\");\n+                        feedbackPanel.refresh(target);\n                     }\n \n                 }"},{"sha":"e5a7587401b1fe99e8ce5e1ffe7590d8a7a3a623","filename":"console/src/main/java/org/apache/syncope/console/rest/RoleRestClient.java","status":"modified","additions":1,"deletions":1,"changes":2,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/366395b124c96fb618864311ce6f455acbf7afbe/console%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fconsole%2Frest%2FRoleRestClient.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/366395b124c96fb618864311ce6f455acbf7afbe/console%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fconsole%2Frest%2FRoleRestClient.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/console%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fconsole%2Frest%2FRoleRestClient.java?ref=366395b124c96fb618864311ce6f455acbf7afbe","patch":"@@ -108,7 +108,7 @@ public RoleTO delete(final String etag, final Long id) {\n \n     @Override\n     public BulkActionResult bulkAction(final BulkAction action) {\n-        return getService(RoleRestClient.class).bulkAction(action);\n+        return getService(RoleService.class).bulk(action);\n     }\n \n     public void unlink(final String etag, final long roleId, final List<StatusBean> statuses) {"},{"sha":"71723b4e7f918484bd1e1755a2ae2938d01f1896","filename":"core/src/main/java/org/apache/syncope/core/rest/controller/RoleController.java","status":"modified","additions":24,"deletions":3,"changes":27,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/366395b124c96fb618864311ce6f455acbf7afbe/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Frest%2Fcontroller%2FRoleController.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/366395b124c96fb618864311ce6f455acbf7afbe/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Frest%2Fcontroller%2FRoleController.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Frest%2Fcontroller%2FRoleController.java?ref=366395b124c96fb618864311ce6f455acbf7afbe","patch":"@@ -18,6 +18,8 @@\n  */\n package org.apache.syncope.core.rest.controller;\n \n+import static org.apache.syncope.core.rest.controller.AbstractController.LOG;\n+\n import java.lang.reflect.Method;\n import java.util.ArrayList;\n import java.util.Collection;\n@@ -32,6 +34,8 @@\n import org.apache.syncope.common.to.RoleTO;\n import org.apache.syncope.common.types.ClientExceptionType;\n import org.apache.syncope.common.SyncopeClientException;\n+import org.apache.syncope.common.reqres.BulkAction;\n+import org.apache.syncope.common.reqres.BulkActionResult;\n import org.apache.syncope.common.types.SubjectType;\n import org.apache.syncope.core.persistence.beans.PropagationTask;\n import org.apache.syncope.core.persistence.beans.role.SyncopeRole;\n@@ -344,6 +348,26 @@ public RoleTO delete(final Long roleId) {\n         return roleTO;\n     }\n \n+    @PreAuthorize(\"(hasRole('ROLE_DELETE') and #bulkAction.operation == #bulkAction.operation.DELETE)\")\n+    public BulkActionResult bulk(final BulkAction bulkAction) {\n+        BulkActionResult res = new BulkActionResult();\n+\n+        if (bulkAction.getOperation() == BulkAction.Type.DELETE) {\n+            for (String roleId : bulkAction.getTargets()) {\n+                try {\n+                    res.add(delete(Long.valueOf(roleId)).getId(), BulkActionResult.Status.SUCCESS);\n+                } catch (Exception e) {\n+                    LOG.error(\"Error performing delete for role {}\", roleId, e);\n+                    res.add(roleId, BulkActionResult.Status.FAILURE);\n+                }\n+            }\n+        } else {\n+            LOG.warn(\"Unsupported bulk action: {}\", bulkAction.getOperation());\n+        }\n+\n+        return res;\n+    }\n+\n     @PreAuthorize(\"hasRole('ROLE_UPDATE')\")\n     @Transactional(rollbackFor = { Throwable.class })\n     @Override\n@@ -426,9 +450,6 @@ public RoleTO provision(\n         return original;\n     }\n \n-    /**\n-     * {@inheritDoc}\n-     */\n     @Override\n     protected RoleTO resolveReference(final Method method, final Object... args) throws UnresolvedReferenceException {\n         Long id = null;"},{"sha":"91466a51adeaf926b21639eeda296b5d8ae0159f","filename":"core/src/main/java/org/apache/syncope/core/services/RoleServiceImpl.java","status":"modified","additions":6,"deletions":0,"changes":6,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/366395b124c96fb618864311ce6f455acbf7afbe/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fservices%2FRoleServiceImpl.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/366395b124c96fb618864311ce6f455acbf7afbe/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fservices%2FRoleServiceImpl.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fservices%2FRoleServiceImpl.java?ref=366395b124c96fb618864311ce6f455acbf7afbe","patch":"@@ -22,6 +22,7 @@\n \n import javax.ws.rs.core.Response;\n import org.apache.syncope.common.mod.RoleMod;\n+import org.apache.syncope.common.reqres.BulkAction;\n import org.apache.syncope.common.reqres.BulkActionResult;\n import org.apache.syncope.common.services.RoleService;\n import org.apache.syncope.common.reqres.PagedResult;\n@@ -219,4 +220,9 @@ public Response bulkAssociation(\n \n         return modificationResponse(res);\n     }\n+\n+    @Override\n+    public BulkActionResult bulk(final BulkAction bulkAction) {\n+        return controller.bulk(bulkAction);\n+    }\n }"}]}