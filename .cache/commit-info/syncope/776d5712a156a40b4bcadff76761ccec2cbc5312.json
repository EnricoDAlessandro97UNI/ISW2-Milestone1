{"sha":"776d5712a156a40b4bcadff76761ccec2cbc5312","node_id":"MDY6Q29tbWl0NjM2ODc5MDYyOjc3NmQ1NzEyYTE1NmE0MGI0YmNhZGZmNzY3NjFjY2VjMmNiYzUzMTI=","commit":{"author":{"name":"Unknown","email":"unknown@apache.org","date":"2011-11-14T17:00:14Z"},"committer":{"name":"Unknown","email":"unknown@apache.org","date":"2011-11-14T17:00:14Z"},"message":"Fixes issue 75\n\ngit-svn-id: https://svn.apache.org/repos/asf/incubator/syncope/trunk@1247195 13f79535-47bb-0310-9956-ffa450edef68","tree":{"sha":"75e87cb1b46d5dd4973f9caec519c70fa28bad82","url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/git/trees/75e87cb1b46d5dd4973f9caec519c70fa28bad82"},"url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/git/commits/776d5712a156a40b4bcadff76761ccec2cbc5312","comment_count":0,"verification":{"verified":false,"reason":"unsigned","signature":null,"payload":null}},"url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/776d5712a156a40b4bcadff76761ccec2cbc5312","html_url":"https://github.com/EnricoDAlessandro97UNI/syncope/commit/776d5712a156a40b4bcadff76761ccec2cbc5312","comments_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/776d5712a156a40b4bcadff76761ccec2cbc5312/comments","author":null,"committer":null,"parents":[{"sha":"bdb5abc39cf36afc87beded34032e683be206888","url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/bdb5abc39cf36afc87beded34032e683be206888","html_url":"https://github.com/EnricoDAlessandro97UNI/syncope/commit/bdb5abc39cf36afc87beded34032e683be206888"}],"stats":{"total":3190,"additions":1695,"deletions":1495},"files":[{"sha":"91c6131ab3ae566ebea427686dbdcb2fc1575a83","filename":"client/src/main/java/org/syncope/client/mod/AbstractAttributableMod.java","status":"modified","additions":59,"deletions":30,"changes":89,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/776d5712a156a40b4bcadff76761ccec2cbc5312/client%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fclient%2Fmod%2FAbstractAttributableMod.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/776d5712a156a40b4bcadff76761ccec2cbc5312/client%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fclient%2Fmod%2FAbstractAttributableMod.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/client%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fclient%2Fmod%2FAbstractAttributableMod.java?ref=776d5712a156a40b4bcadff76761ccec2cbc5312","patch":"@@ -32,7 +32,7 @@ public abstract class AbstractAttributableMod extends AbstractBaseBean {\n \n     protected Set<String> derivedAttributesToBeRemoved;\n \n-    protected Set<String> virtualAttributesToBeAdded;\n+    protected Set<AttributeMod> virtualAttributesToBeUpdated;\n \n     protected Set<String> virtualAttributesToBeRemoved;\n \n@@ -47,12 +47,20 @@ public AbstractAttributableMod() {\n         attributesToBeRemoved = new HashSet<String>();\n         derivedAttributesToBeAdded = new HashSet<String>();\n         derivedAttributesToBeRemoved = new HashSet<String>();\n-        virtualAttributesToBeAdded = new HashSet<String>();\n+        virtualAttributesToBeUpdated = new HashSet<AttributeMod>();\n         virtualAttributesToBeRemoved = new HashSet<String>();\n         resourcesToBeAdded = new HashSet<String>();\n         resourcesToBeRemoved = new HashSet<String>();\n     }\n \n+    public long getId() {\n+        return id;\n+    }\n+\n+    public void setId(long id) {\n+        this.id = id;\n+    }\n+\n     public boolean addAttributeToBeRemoved(String attribute) {\n         return attributesToBeRemoved.add(attribute);\n     }\n@@ -91,10 +99,6 @@ public boolean addDerivedAttributeToBeAdded(String derivedAttribute) {\n         return derivedAttributesToBeAdded.add(derivedAttribute);\n     }\n \n-    public boolean addVirtualAttributeToBeAdded(String virtualAttribute) {\n-        return virtualAttributesToBeAdded.add(virtualAttribute);\n-    }\n-\n     public boolean removeDerivedAttributeToBeAdded(String derivedAttribute) {\n         return derivedAttributesToBeAdded.remove(derivedAttribute);\n     }\n@@ -113,10 +117,6 @@ public boolean addDerivedAttributeToBeRemoved(String derivedAttribute) {\n         return derivedAttributesToBeRemoved.add(derivedAttribute);\n     }\n \n-    public boolean addVirtualAttributeToBeRemoved(String virtualAttribute) {\n-        return virtualAttributesToBeRemoved.add(virtualAttribute);\n-    }\n-\n     public boolean removeDerivedAttributeToBeRemoved(String derivedAttribute) {\n         return derivedAttributesToBeRemoved.remove(derivedAttribute);\n     }\n@@ -131,12 +131,48 @@ public void setDerivedAttributesToBeRemoved(\n         this.derivedAttributesToBeRemoved = derivedAttributesToBeRemoved;\n     }\n \n-    public long getId() {\n-        return id;\n+    public Set<String> getVirtualAttributesToBeRemoved() {\n+        return virtualAttributesToBeRemoved;\n     }\n \n-    public void setId(long id) {\n-        this.id = id;\n+    public boolean addVirtualAttributeToBeRemoved(\n+            String virtualAttributeToBeRemoved) {\n+\n+        return virtualAttributesToBeRemoved.add(virtualAttributeToBeRemoved);\n+    }\n+\n+    public boolean removeVirtualAttributeToBeRemoved(\n+            String virtualAttributeToBeRemoved) {\n+\n+        return virtualAttributesToBeRemoved.remove(virtualAttributeToBeRemoved);\n+    }\n+\n+    public void setVirtualAttributesToBeRemoved(\n+            Set<String> virtualAttributesToBeRemoved) {\n+\n+        this.virtualAttributesToBeRemoved = virtualAttributesToBeRemoved;\n+    }\n+\n+    public boolean addVirtualAttributeToBeUpdated(\n+            AttributeMod virtualAttributeToBeUpdated) {\n+\n+        return virtualAttributesToBeUpdated.add(virtualAttributeToBeUpdated);\n+    }\n+\n+    public boolean removeVirtualAttributeToBeUpdated(\n+            AttributeMod virtualAttributeToBeUpdated) {\n+\n+        return virtualAttributesToBeUpdated.remove(virtualAttributeToBeUpdated);\n+    }\n+\n+    public Set<AttributeMod> getVirtualAttributesToBeUpdated() {\n+        return virtualAttributesToBeUpdated;\n+    }\n+\n+    public void setVirtualAttributesToBeUpdated(\n+            Set<AttributeMod> virtualAttributesToBeUpdated) {\n+\n+        this.virtualAttributesToBeUpdated = virtualAttributesToBeUpdated;\n     }\n \n     public boolean addResourceToBeAdded(String resource) {\n@@ -171,21 +207,14 @@ public void setResourcesToBeRemoved(Set<String> resourcesToBeRemoved) {\n         this.resourcesToBeRemoved = resourcesToBeRemoved;\n     }\n \n-    public Set<String> getVirtualAttributesToBeAdded() {\n-        return virtualAttributesToBeAdded;\n-    }\n-\n-    public void setVirtualAttributesToBeAdded(\n-            Set<String> virtualAttributesToBeAdded) {\n-        this.virtualAttributesToBeAdded = virtualAttributesToBeAdded;\n-    }\n-\n-    public Set<String> getVirtualAttributesToBeRemoved() {\n-        return virtualAttributesToBeRemoved;\n-    }\n-\n-    public void setVirtualAttributesToBeRemoved(\n-            Set<String> virtualAttributesToBeRemoved) {\n-        this.virtualAttributesToBeRemoved = virtualAttributesToBeRemoved;\n+    public boolean isEmpty() {\n+        return attributesToBeUpdated.isEmpty()\n+                && attributesToBeUpdated.isEmpty()\n+                && derivedAttributesToBeAdded.isEmpty()\n+                && derivedAttributesToBeRemoved.isEmpty()\n+                && virtualAttributesToBeUpdated.isEmpty()\n+                && virtualAttributesToBeRemoved.isEmpty()\n+                && resourcesToBeAdded.isEmpty()\n+                && resourcesToBeRemoved.isEmpty();\n     }\n }"},{"sha":"da145175a053325287c0a643ef8f7e380aefeb4f","filename":"client/src/main/java/org/syncope/client/mod/AttributeMod.java","status":"modified","additions":7,"deletions":0,"changes":7,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/776d5712a156a40b4bcadff76761ccec2cbc5312/client%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fclient%2Fmod%2FAttributeMod.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/776d5712a156a40b4bcadff76761ccec2cbc5312/client%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fclient%2Fmod%2FAttributeMod.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/client%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fclient%2Fmod%2FAttributeMod.java?ref=776d5712a156a40b4bcadff76761ccec2cbc5312","patch":"@@ -16,6 +16,7 @@\n \n import java.util.ArrayList;\n import java.util.List;\n+import org.codehaus.jackson.annotate.JsonIgnore;\n import org.syncope.client.AbstractBaseBean;\n \n public class AttributeMod extends AbstractBaseBean {\n@@ -74,4 +75,10 @@ public List<String> getValuesToBeRemoved() {\n     public void setValuesToBeRemoved(List<String> valuesToBeRemoved) {\n         this.valuesToBeRemoved = valuesToBeRemoved;\n     }\n+\n+    @JsonIgnore\n+    public boolean isEmpty() {\n+        return valuesToBeAdded.isEmpty()\n+                && valuesToBeRemoved.isEmpty();\n+    }\n }"},{"sha":"6a8131ebf24774bc9d6866d70c229ca537967b9e","filename":"client/src/main/java/org/syncope/client/mod/MembershipMod.java","status":"modified","additions":8,"deletions":0,"changes":8,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/776d5712a156a40b4bcadff76761ccec2cbc5312/client%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fclient%2Fmod%2FMembershipMod.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/776d5712a156a40b4bcadff76761ccec2cbc5312/client%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fclient%2Fmod%2FMembershipMod.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/client%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fclient%2Fmod%2FMembershipMod.java?ref=776d5712a156a40b4bcadff76761ccec2cbc5312","patch":"@@ -16,6 +16,7 @@\n \n import java.util.Collections;\n import java.util.Set;\n+import org.codehaus.jackson.annotate.JsonIgnore;\n \n public class MembershipMod extends AbstractAttributableMod {\n \n@@ -68,4 +69,11 @@ public void setResourcesToBeAdded(Set<String> resourcesToBeAdded) {\n     @Override\n     public void setResourcesToBeRemoved(Set<String> resourcesToBeRemoved) {\n     }\n+\n+    @JsonIgnore\n+    @Override\n+    public boolean isEmpty() {\n+        return super.isEmpty()\n+                && role == 0;\n+    }\n }"},{"sha":"7742196be1ed0a95aaedce68c0f42088dc9542cc","filename":"client/src/main/java/org/syncope/client/mod/ReferenceMod.java","status":"modified","additions":1,"deletions":1,"changes":2,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/776d5712a156a40b4bcadff76761ccec2cbc5312/client%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fclient%2Fmod%2FReferenceMod.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/776d5712a156a40b4bcadff76761ccec2cbc5312/client%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fclient%2Fmod%2FReferenceMod.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/client%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fclient%2Fmod%2FReferenceMod.java?ref=776d5712a156a40b4bcadff76761ccec2cbc5312","patch":"@@ -19,7 +19,7 @@\n /**\n  * This class is used to specify the willing to modify an external reference id.\n  * Use 'null' ReferenceMod to keep the current reference id; use a ReferenceMod\n- * with a null id to try to reset the reference id; use a RefernceMod with a\n+ * with a null id to try to reset the reference id; use a ReferenceMod with a\n  * not null id to specify a new reference id.\n  */\n public class ReferenceMod extends AbstractBaseBean {"},{"sha":"9d3351e5310720dcdc6a9eb79702c09cb5b85355","filename":"client/src/main/java/org/syncope/client/mod/RoleMod.java","status":"modified","additions":16,"deletions":0,"changes":16,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/776d5712a156a40b4bcadff76761ccec2cbc5312/client%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fclient%2Fmod%2FRoleMod.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/776d5712a156a40b4bcadff76761ccec2cbc5312/client%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fclient%2Fmod%2FRoleMod.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/client%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fclient%2Fmod%2FRoleMod.java?ref=776d5712a156a40b4bcadff76761ccec2cbc5312","patch":"@@ -16,6 +16,7 @@\n \n import java.util.ArrayList;\n import java.util.List;\n+import org.codehaus.jackson.annotate.JsonIgnore;\n \n public class RoleMod extends AbstractAttributableMod {\n \n@@ -130,4 +131,19 @@ public Boolean getInheritAccountPolicy() {\n     public void setInheritAccountPolicy(final Boolean inheritAccountPolicy) {\n         this.inheritAccountPolicy = inheritAccountPolicy;\n     }\n+\n+    @JsonIgnore\n+    @Override\n+    public boolean isEmpty() {\n+        return super.isEmpty()\n+                && name == null\n+                && inheritAccountPolicy == null\n+                && inheritPasswordPolicy == null\n+                && inheritAttributes == null\n+                && inheritDerivedAttributes == null\n+                && inheritVirtualAttributes == null\n+                && accountPolicy == null\n+                && passwordPolicy == null\n+                && entitlements.isEmpty();\n+    }\n }"},{"sha":"7648c58663e2111ff950a229015890bc861c71e0","filename":"client/src/main/java/org/syncope/client/mod/UserMod.java","status":"modified","additions":11,"deletions":0,"changes":11,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/776d5712a156a40b4bcadff76761ccec2cbc5312/client%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fclient%2Fmod%2FUserMod.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/776d5712a156a40b4bcadff76761ccec2cbc5312/client%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fclient%2Fmod%2FUserMod.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/client%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fclient%2Fmod%2FUserMod.java?ref=776d5712a156a40b4bcadff76761ccec2cbc5312","patch":"@@ -16,6 +16,7 @@\n \n import java.util.HashSet;\n import java.util.Set;\n+import org.codehaus.jackson.annotate.JsonIgnore;\n \n public class UserMod extends AbstractAttributableMod {\n \n@@ -83,4 +84,14 @@ public Set<Long> getMembershipsToBeRemoved() {\n     public void setMembershipsToBeRemoved(Set<Long> membershipsToBeRemoved) {\n         this.membershipsToBeRemoved = membershipsToBeRemoved;\n     }\n+\n+    @JsonIgnore\n+    @Override\n+    public boolean isEmpty() {\n+        return super.isEmpty()\n+                && password == null\n+                && username == null\n+                && membershipsToBeAddeded.isEmpty()\n+                && membershipsToBeRemoved.isEmpty();\n+    }\n }"},{"sha":"aec01c4ec65eb54790e57973b570ff0922d2da20","filename":"client/src/main/java/org/syncope/client/to/AbstractAttributableTO.java","status":"modified","additions":12,"deletions":12,"changes":24,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/776d5712a156a40b4bcadff76761ccec2cbc5312/client%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fclient%2Fto%2FAbstractAttributableTO.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/776d5712a156a40b4bcadff76761ccec2cbc5312/client%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fclient%2Fto%2FAbstractAttributableTO.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/client%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fclient%2Fto%2FAbstractAttributableTO.java?ref=776d5712a156a40b4bcadff76761ccec2cbc5312","patch":"@@ -71,33 +71,33 @@ public void setAttributes(final List<AttributeTO> attributes) {\n     }\n \n     @JsonIgnore\n-    public Map<String, List<String>> getAttributeMap() {\n-        Map<String, List<String>> result =\n-                new HashMap<String, List<String>>(attributes.size());\n+    public Map<String, AttributeTO> getAttributeMap() {\n+        Map<String, AttributeTO> result =\n+                new HashMap<String, AttributeTO>(attributes.size());\n         for (AttributeTO attributeTO : attributes) {\n-            result.put(attributeTO.getSchema(), attributeTO.getValues());\n+            result.put(attributeTO.getSchema(), attributeTO);\n         }\n \n         return result;\n     }\n \n     @JsonIgnore\n-    public Map<String, List<String>> getDerivedAttributeMap() {\n-        Map<String, List<String>> result =\n-                new HashMap<String, List<String>>(derivedAttributes.size());\n+    public Map<String, AttributeTO> getDerivedAttributeMap() {\n+        Map<String, AttributeTO> result =\n+                new HashMap<String, AttributeTO>(derivedAttributes.size());\n         for (AttributeTO attributeTO : derivedAttributes) {\n-            result.put(attributeTO.getSchema(), attributeTO.getValues());\n+            result.put(attributeTO.getSchema(), attributeTO);\n         }\n \n         return result;\n     }\n \n     @JsonIgnore\n-    public Map<String, List<String>> getVirtualAttributeMap() {\n-        Map<String, List<String>> result =\n-                new HashMap<String, List<String>>(virtualAttributes.size());\n+    public Map<String, AttributeTO> getVirtualAttributeMap() {\n+        Map<String, AttributeTO> result =\n+                new HashMap<String, AttributeTO>(virtualAttributes.size());\n         for (AttributeTO attributeTO : virtualAttributes) {\n-            result.put(attributeTO.getSchema(), attributeTO.getValues());\n+            result.put(attributeTO.getSchema(), attributeTO);\n         }\n \n         return result;"},{"sha":"11e07c99a9ba916883907dd66498b5e515391446","filename":"client/src/main/java/org/syncope/client/to/AttributeTO.java","status":"modified","additions":4,"deletions":3,"changes":7,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/776d5712a156a40b4bcadff76761ccec2cbc5312/client%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fclient%2Fto%2FAttributeTO.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/776d5712a156a40b4bcadff76761ccec2cbc5312/client%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fclient%2Fto%2FAttributeTO.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/client%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fclient%2Fto%2FAttributeTO.java?ref=776d5712a156a40b4bcadff76761ccec2cbc5312","patch":"@@ -18,19 +18,20 @@\n import java.util.List;\n import org.syncope.client.AbstractBaseBean;\n \n-/**\n- * Transfer Object for attributes.\n- */\n public class AttributeTO extends AbstractBaseBean {\n \n+    private static final long serialVersionUID = 4941691338796323623L;\n+\n     /**\n      * Name of the schema that this attribute is referring to.\n      */\n     private String schema;\n+\n     /**\n      * Set of (string) values of this attribute.\n      */\n     private List<String> values;\n+\n     /**\n      * Wether this attribute is read-only or not.\n      */"},{"sha":"c8ba1a490959d825651ae5522708ae94f19f0ecb","filename":"client/src/main/java/org/syncope/client/to/UserRequestTO.java","status":"modified","additions":10,"deletions":0,"changes":10,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/776d5712a156a40b4bcadff76761ccec2cbc5312/client%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fclient%2Fto%2FUserRequestTO.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/776d5712a156a40b4bcadff76761ccec2cbc5312/client%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fclient%2Fto%2FUserRequestTO.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/client%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fclient%2Fto%2FUserRequestTO.java?ref=776d5712a156a40b4bcadff76761ccec2cbc5312","patch":"@@ -21,6 +21,8 @@ public class UserRequestTO extends AbstractBaseBean {\n \n     private static final long serialVersionUID = 1228351243795629329L;\n \n+    private long id;\n+\n     private UserTO userTO;\n \n     private UserMod userMod;\n@@ -29,6 +31,14 @@ public class UserRequestTO extends AbstractBaseBean {\n \n     private UserRequestType type;\n \n+    public long getId() {\n+        return id;\n+    }\n+\n+    public void setId(long id) {\n+        this.id = id;\n+    }\n+\n     public UserRequestType getType() {\n         return type;\n     }"},{"sha":"85a58a6da8619899b186ab1347a3b9e3250caeda","filename":"client/src/main/java/org/syncope/client/to/UserTO.java","status":"modified","additions":15,"deletions":0,"changes":15,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/776d5712a156a40b4bcadff76761ccec2cbc5312/client%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fclient%2Fto%2FUserTO.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/776d5712a156a40b4bcadff76761ccec2cbc5312/client%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fclient%2Fto%2FUserTO.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/client%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fclient%2Fto%2FUserTO.java?ref=776d5712a156a40b4bcadff76761ccec2cbc5312","patch":"@@ -17,9 +17,12 @@\n import java.lang.reflect.Field;\n import java.util.ArrayList;\n import java.util.Date;\n+import java.util.HashMap;\n import java.util.List;\n+import java.util.Map;\n import org.apache.commons.lang.builder.ReflectionToStringBuilder;\n import org.apache.commons.lang.builder.ToStringStyle;\n+import org.codehaus.jackson.annotate.JsonIgnore;\n \n public class UserTO extends AbstractAttributableTO {\n \n@@ -75,6 +78,18 @@ public void setMemberships(List<MembershipTO> memberships) {\n         this.memberships = memberships;\n     }\n \n+    @JsonIgnore\n+    public Map<Long, MembershipTO> getMembershipMap() {\n+        Map<Long, MembershipTO> result = new HashMap<Long, MembershipTO>(\n+                getMemberships().size());\n+\n+        for (MembershipTO membership : getMemberships()) {\n+            result.put(membership.getRoleId(), membership);\n+        }\n+\n+        return result;\n+    }\n+\n     public String getStatus() {\n         return status;\n     }"},{"sha":"a9ed0e6f0f9ed85270e5e66dd97fd144ad6fc382","filename":"client/src/main/java/org/syncope/client/util/AttributableOperations.java","status":"added","additions":353,"deletions":0,"changes":353,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/776d5712a156a40b4bcadff76761ccec2cbc5312/client%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fclient%2Futil%2FAttributableOperations.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/776d5712a156a40b4bcadff76761ccec2cbc5312/client%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fclient%2Futil%2FAttributableOperations.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/client%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fclient%2Futil%2FAttributableOperations.java?ref=776d5712a156a40b4bcadff76761ccec2cbc5312","patch":"@@ -0,0 +1,353 @@\n+/*\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.syncope.client.util;\n+\n+import java.util.ArrayList;\n+import java.util.Collections;\n+import java.util.HashSet;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.Set;\n+import org.apache.commons.lang.SerializationUtils;\n+import org.syncope.client.mod.AbstractAttributableMod;\n+import org.syncope.client.mod.AttributeMod;\n+import org.syncope.client.mod.MembershipMod;\n+import org.syncope.client.mod.ReferenceMod;\n+import org.syncope.client.mod.RoleMod;\n+import org.syncope.client.mod.UserMod;\n+import org.syncope.client.to.AbstractAttributableTO;\n+import org.syncope.client.to.AttributeTO;\n+import org.syncope.client.to.MembershipTO;\n+import org.syncope.client.to.RoleTO;\n+import org.syncope.client.to.UserTO;\n+\n+/**\n+ * Utility class for manipulating classes extending AbstractAttributableTO \n+ * and AbstractAttributableMod.\n+ * @see AbstractAttributableTO\n+ * @see AbstractAttributableMod\n+ */\n+public final class AttributableOperations {\n+\n+    public static <T extends AbstractAttributableTO> T clone(final T original) {\n+        return (T) SerializationUtils.clone(original);\n+    }\n+\n+    private static void populate(final Map<String, AttributeTO> updatedAttrs,\n+            final Map<String, AttributeTO> originalAttrs,\n+            final AbstractAttributableMod result) {\n+\n+        for (Map.Entry<String, AttributeTO> entry : updatedAttrs.entrySet()) {\n+            AttributeMod attrMod = new AttributeMod();\n+            attrMod.setSchema(entry.getKey());\n+\n+            Set<String> updatedValues = new HashSet<String>(\n+                    entry.getValue().getValues());\n+            Set<String> originalValues =\n+                    originalAttrs.containsKey(entry.getKey())\n+                    ? new HashSet<String>(\n+                    originalAttrs.get(entry.getKey()).getValues())\n+                    : Collections.EMPTY_SET;\n+\n+            updatedValues.removeAll(originalValues);\n+            // avoid unwanted inputs\n+            updatedValues.remove(\"\");\n+            if (!entry.getValue().isReadonly()) {\n+                attrMod.setValuesToBeAdded(\n+                        new ArrayList<String>(updatedValues));\n+            }\n+\n+            originalValues.removeAll(entry.getValue().getValues());\n+            attrMod.setValuesToBeRemoved(new ArrayList<String>(originalValues));\n+\n+            if (!attrMod.isEmpty()) {\n+                result.addAttributeToBeUpdated(attrMod);\n+            }\n+        }\n+    }\n+\n+    private static void diff(\n+            final AbstractAttributableTO updated,\n+            final AbstractAttributableTO original,\n+            final AbstractAttributableMod result) {\n+\n+        // 1. check same id\n+        if (updated.getId() != original.getId()) {\n+            throw new IllegalArgumentException(\n+                    \"AttributableTO's id must be the same\");\n+        }\n+        result.setId(updated.getId());\n+\n+        // 2. attributes\n+        Map<String, AttributeTO> updatedAttrs = updated.getAttributeMap();\n+        Map<String, AttributeTO> originalAttrs = original.getAttributeMap();\n+\n+        Set<String> originalAttrNames =\n+                new HashSet<String>(originalAttrs.keySet());\n+        originalAttrNames.removeAll(updatedAttrs.keySet());\n+        result.setAttributesToBeRemoved(originalAttrNames);\n+\n+        populate(updatedAttrs, originalAttrs, result);\n+\n+        // 3. derived attributes\n+        updatedAttrs = updated.getDerivedAttributeMap();\n+        originalAttrs = original.getDerivedAttributeMap();\n+\n+        originalAttrNames = new HashSet<String>(originalAttrs.keySet());\n+        originalAttrNames.removeAll(updatedAttrs.keySet());\n+        result.setDerivedAttributesToBeRemoved(originalAttrNames);\n+\n+        Set<String> updatedAttrNames =\n+                new HashSet<String>(updatedAttrs.keySet());\n+        updatedAttrNames.removeAll(originalAttrs.keySet());\n+        result.setDerivedAttributesToBeAdded(updatedAttrNames);\n+\n+        // 4. virtual attributes\n+        updatedAttrs = updated.getVirtualAttributeMap();\n+        originalAttrs = original.getVirtualAttributeMap();\n+\n+        originalAttrNames = new HashSet<String>(originalAttrs.keySet());\n+        originalAttrNames.removeAll(updatedAttrs.keySet());\n+        result.setVirtualAttributesToBeRemoved(originalAttrNames);\n+\n+        populate(updatedAttrs, originalAttrs, result);\n+\n+        // 5. resources\n+        Set<String> updatedRes = new HashSet<String>(updated.getResources());\n+        Set<String> originalRes = new HashSet<String>(original.getResources());\n+\n+        updatedRes.removeAll(originalRes);\n+        result.setResourcesToBeAdded(updatedRes);\n+\n+        originalRes.removeAll(updated.getResources());\n+        result.setResourcesToBeRemoved(originalRes);\n+    }\n+\n+    /**\n+     * Calculate modifications needed by first in order to be equal to second.\n+     * @param updated updated UserTO\n+     * @param original original UserTO\n+     * @return UserMod containing differences\n+     */\n+    public static UserMod diff(final UserTO updated, final UserTO original) {\n+        UserMod result = new UserMod();\n+\n+        diff(updated, original, result);\n+\n+        // 1. password\n+        if (original.getPassword() != null\n+                && !original.getPassword().equals(updated.getPassword())) {\n+\n+            result.setPassword(updated.getPassword());\n+        }\n+\n+        // 2. username\n+        if (original.getUsername() != null\n+                && !original.getUsername().equals(updated.getUsername())) {\n+\n+            result.setUsername(updated.getUsername());\n+        }\n+\n+        // 3. memberships\n+        Map<Long, MembershipTO> updatedMembs = updated.getMembershipMap();\n+        Map<Long, MembershipTO> originalMembs = original.getMembershipMap();\n+\n+        for (Map.Entry<Long, MembershipTO> entry : updatedMembs.entrySet()) {\n+            MembershipMod membMod = new MembershipMod();\n+            membMod.setRole(entry.getValue().getRoleId());\n+\n+            if (originalMembs.containsKey(entry.getKey())) {\n+                diff(entry.getValue(), originalMembs.get(entry.getKey()),\n+                        membMod);\n+            } else {\n+                for (AttributeTO attr :\n+                        entry.getValue().getAttributes()) {\n+\n+                    AttributeMod attrMod = new AttributeMod();\n+                    attrMod.setSchema(attr.getSchema());\n+                    attrMod.setValuesToBeAdded(attr.getValues());\n+\n+                    if (!attrMod.isEmpty()) {\n+                        membMod.addAttributeToBeUpdated(attrMod);\n+                    }\n+                }\n+                for (AttributeTO attr :\n+                        entry.getValue().getDerivedAttributes()) {\n+\n+                    membMod.addDerivedAttributeToBeAdded(attr.getSchema());\n+                }\n+                for (AttributeTO attr :\n+                        entry.getValue().getVirtualAttributes()) {\n+\n+                    AttributeMod attrMod = new AttributeMod();\n+                    attrMod.setSchema(attr.getSchema());\n+                    attrMod.setValuesToBeAdded(attr.getValues());\n+\n+                    if (!attrMod.isEmpty()) {\n+                        membMod.addVirtualAttributeToBeUpdated(attrMod);\n+                    }\n+                }\n+                membMod.setResourcesToBeAdded(entry.getValue().getResources());\n+            }\n+\n+            if (!membMod.isEmpty()) {\n+                result.addMembershipToBeAdded(membMod);\n+            }\n+        }\n+\n+        Set<Long> originalRoles = new HashSet<Long>(originalMembs.keySet());\n+        originalRoles.removeAll(updatedMembs.keySet());\n+        for (Long roleId : originalRoles) {\n+            result.addMembershipToBeRemoved(originalMembs.get(roleId).getId());\n+        }\n+\n+        return result;\n+    }\n+\n+    /**\n+     * Calculate modifications needed by first in order to be equal to second.\n+     * @param updated updated RoleTO\n+     * @param original original RoleTO\n+     * @return RoleMod containing differences\n+     */\n+    public static RoleMod diff(final RoleTO updated, final RoleTO original) {\n+        RoleMod result = new RoleMod();\n+\n+        diff(updated, original, result);\n+\n+        // 1. inheritance\n+        result.setInheritAccountPolicy(updated.isInheritAccountPolicy());\n+        result.setInheritPasswordPolicy(updated.isInheritPasswordPolicy());\n+        result.setInheritAttributes(updated.isInheritAttributes());\n+        result.setInheritDerivedAttributes(\n+                updated.isInheritDerivedAttributes());\n+        result.setInheritVirtualAttributes(\n+                updated.isInheritVirtualAttributes());\n+\n+        // 2. policies\n+        ReferenceMod refAccountPolicy = new ReferenceMod();\n+        refAccountPolicy.setId(updated.getAccountPolicy());\n+        result.setAccountPolicy(refAccountPolicy);\n+\n+        ReferenceMod refPasswordPolicy = new ReferenceMod();\n+        refPasswordPolicy.setId(updated.getPasswordPolicy());\n+        result.setPasswordPolicy(refPasswordPolicy);\n+\n+        // 3. name\n+        if (!original.getName().equals(updated.getName())) {\n+            result.setName(updated.getName());\n+        }\n+\n+        // 4. entitlements\n+        Set<String> updatedEnts = new HashSet<String>(\n+                updated.getEntitlements());\n+        Set<String> originalEnts = new HashSet<String>(\n+                original.getEntitlements());\n+        if (!updatedEnts.equals(originalEnts)) {\n+            result.setEntitlements(updated.getEntitlements());\n+        }\n+\n+        return result;\n+    }\n+\n+    private static List<AttributeTO> getUpdateValues(\n+            final Map<String, AttributeTO> attrs,\n+            final Set<String> attrsToBeRemoved,\n+            final Set<AttributeMod> attrsToBeUpdated) {\n+\n+        for (String attrName : attrsToBeRemoved) {\n+            attrs.remove(attrName);\n+        }\n+        for (AttributeMod attrMod : attrsToBeUpdated) {\n+            if (attrs.containsKey(attrMod.getSchema())) {\n+                AttributeTO attrTO = attrs.get(attrMod.getSchema());\n+                attrTO.getValues().removeAll(attrMod.getValuesToBeRemoved());\n+                attrTO.getValues().addAll(attrMod.getValuesToBeAdded());\n+            } else {\n+                AttributeTO attrTO = new AttributeTO();\n+                attrTO.setSchema(attrMod.getSchema());\n+                attrTO.setValues(attrMod.getValuesToBeAdded());\n+\n+                attrs.put(attrMod.getSchema(), attrTO);\n+            }\n+        }\n+\n+        return new ArrayList(attrs.values());\n+    }\n+\n+    private static <T extends AbstractAttributableTO, K extends AbstractAttributableMod> void apply(\n+            final T to, final K mod, final T result) {\n+\n+        // 1. check same id\n+        if (to.getId() != mod.getId()) {\n+            throw new IllegalArgumentException(\n+                    \"AttributableTO and AttributableMod ids must be the same\");\n+        }\n+\n+        // 2. attributes\n+        result.setAttributes(getUpdateValues(to.getAttributeMap(),\n+                mod.getAttributesToBeRemoved(),\n+                mod.getAttributesToBeUpdated()));\n+\n+        // 3. derived attributes\n+        Map<String, AttributeTO> attrs = to.getDerivedAttributeMap();\n+        for (String attrName : mod.getDerivedAttributesToBeRemoved()) {\n+            attrs.remove(attrName);\n+        }\n+        for (String attrName : mod.getDerivedAttributesToBeAdded()) {\n+            AttributeTO attrTO = new AttributeTO();\n+            attrTO.setSchema(attrName);\n+\n+            attrs.put(attrName, attrTO);\n+        }\n+        result.setDerivedAttributes(new ArrayList(attrs.values()));\n+\n+        // 4. virtual attributes\n+        result.setVirtualAttributes(\n+                getUpdateValues(to.getVirtualAttributeMap(),\n+                mod.getVirtualAttributesToBeRemoved(),\n+                mod.getVirtualAttributesToBeUpdated()));\n+\n+        // 5. resources\n+        result.getResources().removeAll(mod.getResourcesToBeRemoved());\n+        result.getResources().addAll(mod.getResourcesToBeAdded());\n+    }\n+\n+    public static UserTO apply(final UserTO userTO, final UserMod userMod) {\n+        UserTO result = clone(userTO);\n+\n+        apply(userTO, userMod, result);\n+\n+        // 1. password\n+        result.setPassword(userMod.getPassword());\n+\n+        // 2. username\n+        if (userMod.getUsername() != null) {\n+            result.setUsername(userMod.getUsername());\n+        }\n+        // 3. memberships\n+        Map<Long, MembershipTO> membs = result.getMembershipMap();\n+        for (Long membId : userMod.getMembershipsToBeRemoved()) {\n+            result.removeMembership(membs.get(membId));\n+        }\n+        for (MembershipMod membMod : userMod.getMembershipsToBeAdded()) {\n+            MembershipTO membTO = new MembershipTO();\n+            membTO.setRoleId(membMod.getRole());\n+\n+            apply(membTO, membMod, membTO);\n+        }\n+\n+        return result;\n+    }\n+}"},{"sha":"22aa0e502a7f44965f824d704fcb307b7ccf886e","filename":"console/src/main/java/org/syncope/console/SyncopeApplication.java","status":"modified","additions":8,"deletions":35,"changes":43,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/776d5712a156a40b4bcadff76761ccec2cbc5312/console%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fconsole%2FSyncopeApplication.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/776d5712a156a40b4bcadff76761ccec2cbc5312/console%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fconsole%2FSyncopeApplication.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/console%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fconsole%2FSyncopeApplication.java?ref=776d5712a156a40b4bcadff76761ccec2cbc5312","patch":"@@ -64,26 +64,6 @@ protected void init() {\n \n         getMarkupSettings().setStripWicketTags(true);\n \n-        // setup authorizations\n-        MetaDataRoleAuthorizationStrategy.authorize(Schema.class,\n-                \"SCHEMA_LIST\");\n-        MetaDataRoleAuthorizationStrategy.authorize(Roles.class,\n-                \"ROLE_LIST\");\n-        MetaDataRoleAuthorizationStrategy.authorize(Resources.class,\n-                \"CONNECTOR_LIST\");\n-        MetaDataRoleAuthorizationStrategy.authorize(Resources.class,\n-                \"RESOURCE_LIST\");\n-        MetaDataRoleAuthorizationStrategy.authorize(Users.class,\n-                \"USER_LIST\");\n-        MetaDataRoleAuthorizationStrategy.authorize(Report.class,\n-                \"REPORT_LIST\");\n-        MetaDataRoleAuthorizationStrategy.authorize(Tasks.class,\n-                \"TASK_LIST\");\n-        MetaDataRoleAuthorizationStrategy.authorize(Configuration.class,\n-                \"CONFIGURATION_LIST\");\n-        MetaDataRoleAuthorizationStrategy.authorize(Todo.class,\n-                \"WORKFLOW_FORM_LIST\");\n-\n         getRequestCycleListeners().add(new SyncopeRequestCycleListener());\n     }\n \n@@ -95,10 +75,8 @@ public void setupNavigationPane(final WebPage page,\n \n         BookmarkablePageLink schemaLink =\n                 new BookmarkablePageLink(\"schema\", Schema.class);\n-        String allowedSchemaRoles =\n-                xmlRolesReader.getAllAllowedRoles(\"Schema\", \"list\");\n-        MetaDataRoleAuthorizationStrategy.authorize(\n-                schemaLink, WebPage.ENABLE, allowedSchemaRoles);\n+        MetaDataRoleAuthorizationStrategy.authorizeAll(\n+                schemaLink, WebPage.ENABLE);\n         page.add(schemaLink);\n \n         BookmarkablePageLink usersLink =\n@@ -111,26 +89,21 @@ public void setupNavigationPane(final WebPage page,\n \n         BookmarkablePageLink rolesLink =\n                 new BookmarkablePageLink(\"roles\", Roles.class);\n-        String allowedRoleRoles =\n-                xmlRolesReader.getAllAllowedRoles(\"Roles\", \"list\");\n-        MetaDataRoleAuthorizationStrategy.authorize(\n-                rolesLink, WebPage.ENABLE, allowedRoleRoles);\n+        MetaDataRoleAuthorizationStrategy.authorizeAll(\n+                rolesLink, WebPage.ENABLE);\n         page.add(rolesLink);\n \n         BookmarkablePageLink resourcesLink =\n                 new BookmarkablePageLink(\"resources\", Resources.class);\n-        String allowedResourcesRoles =\n-                xmlRolesReader.getAllAllowedRoles(\"Resources\", \"list\");\n-        MetaDataRoleAuthorizationStrategy.authorize(\n-                resourcesLink, WebPage.ENABLE, allowedResourcesRoles);\n+        MetaDataRoleAuthorizationStrategy.authorizeAll(\n+                resourcesLink, WebPage.ENABLE);\n         page.add(resourcesLink);\n \n         BookmarkablePageLink todoLink =\n                 new BookmarkablePageLink(\"todo\", Todo.class);\n-        String allowedTodoRoles =\n-                xmlRolesReader.getAllAllowedRoles(\"Todo\", \"list\");\n         MetaDataRoleAuthorizationStrategy.authorize(\n-                todoLink, WebPage.ENABLE, allowedTodoRoles);\n+                todoLink, WebPage.ENABLE,\n+                xmlRolesReader.getAllAllowedRoles(\"Approval\", \"list\"));\n         page.add(todoLink);\n \n         BookmarkablePageLink reportLink ="},{"sha":"3f3a3e06ce10fa414dc18582f5b2f9142b83c8a7","filename":"console/src/main/java/org/syncope/console/SyncopeRequestCycleListener.java","status":"modified","additions":10,"deletions":0,"changes":10,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/776d5712a156a40b4bcadff76761ccec2cbc5312/console%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fconsole%2FSyncopeRequestCycleListener.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/776d5712a156a40b4bcadff76761ccec2cbc5312/console%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fconsole%2FSyncopeRequestCycleListener.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/console%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fconsole%2FSyncopeRequestCycleListener.java?ref=776d5712a156a40b4bcadff76761ccec2cbc5312","patch":"@@ -24,19 +24,29 @@\n import org.apache.wicket.request.cycle.RequestCycle;\n import org.apache.wicket.request.handler.ComponentRenderingRequestHandler;\n import org.apache.wicket.request.mapper.parameter.PageParameters;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n import org.springframework.web.client.HttpClientErrorException;\n import org.springframework.web.client.RestClientException;\n import org.syncope.console.pages.ErrorPage;\n \n public class SyncopeRequestCycleListener extends AbstractRequestCycleListener {\n \n+    /**\n+     * Logger.\n+     */\n+    private static final Logger LOG = LoggerFactory.getLogger(\n+            SyncopeRequestCycleListener.class);\n+\n     /**\n      * {@inheritDoc}\n      */\n     @Override\n     public IRequestHandler onException(final RequestCycle cycle,\n             final Exception e) {\n \n+        LOG.error(\"Exception found\", e);\n+\n         final Page errorPage;\n         PageParameters errorParameters = new PageParameters();\n         errorParameters.add(\"errorTitle\","},{"sha":"599d768745fec5f16694666ba995b99e21c55ccc","filename":"console/src/main/java/org/syncope/console/SyncopeSession.java","status":"modified","additions":7,"deletions":1,"changes":8,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/776d5712a156a40b4bcadff76761ccec2cbc5312/console%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fconsole%2FSyncopeSession.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/776d5712a156a40b4bcadff76761ccec2cbc5312/console%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fconsole%2FSyncopeSession.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/console%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fconsole%2FSyncopeSession.java?ref=776d5712a156a40b4bcadff76761ccec2cbc5312","patch":"@@ -27,6 +27,8 @@\n  */\n public class SyncopeSession extends WebSession {\n \n+    private static final long serialVersionUID = 7743446298924805872L;\n+\n     private String userId;\n \n     private String coreVersion;\n@@ -61,8 +63,12 @@ public void setEntitlements(final String[] entitlements) {\n         roles = new Roles(entitlements);\n     }\n \n+    public Roles getEntitlements() {\n+        return roles;\n+    }\n+\n     public boolean isAuthenticated() {\n-        return !roles.isEmpty();\n+        return getUserId() != null;\n     }\n \n     public boolean hasAnyRole(final Roles roles) {"},{"sha":"dca471e6adc16f353eb47a3418f23fef574ba9c7","filename":"console/src/main/java/org/syncope/console/commons/Constants.java","status":"modified","additions":8,"deletions":5,"changes":13,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/776d5712a156a40b4bcadff76761ccec2cbc5312/console%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fconsole%2Fcommons%2FConstants.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/776d5712a156a40b4bcadff76761ccec2cbc5312/console%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fconsole%2Fcommons%2FConstants.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/console%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fconsole%2Fcommons%2FConstants.java?ref=776d5712a156a40b4bcadff76761ccec2cbc5312","patch":"@@ -21,13 +21,13 @@ public final class Constants {\n \n     public static final String PREF_USERS_ATTRIBUTES_VIEW =\n             \"users.attributes.view\";\n-    \n+\n     public static final String PREF_USERS_DERIVED_ATTRIBUTES_VIEW =\n             \"users.derived.attributes.view\";\n-    \n+\n     public static final String PREF_USERS_VIRTUAL_ATTRIBUTES_VIEW =\n             \"users.virtual.attributes.view\";\n-    \n+\n     public static final String PREFS_COOKIE_NAME = \"syncopeConsolePrefs\";\n \n     public static final String PREF_USER_SCHEMA_PAGINATOR_ROWS =\n@@ -84,8 +84,11 @@ public final class Constants {\n     public static final String PREF_SYNC_TASKS_PAGINATOR_ROWS =\n             \"synctasks.paginator.rows\";\n \n-    public static final String PREF_TODO_PAGINATOR_ROWS =\n-            \"todo.paginator.rows\";\n+    public static final String PREF_APPROVAL_PAGINATOR_ROWS =\n+            \"approval.paginator.rows\";\n+\n+    public static final String PREF_USER_REQUEST_PAGINATOR_ROWS =\n+            \"userRequest.paginator.rows\";\n \n     public static final String PAGEPARAM_CREATE = \"CREATE\";\n "},{"sha":"dbd2f0e5dd64102454ab575b3af960a9892bc4de","filename":"console/src/main/java/org/syncope/console/commons/RoleTreeBuilder.java","status":"modified","additions":8,"deletions":4,"changes":12,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/776d5712a156a40b4bcadff76761ccec2cbc5312/console%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fconsole%2Fcommons%2FRoleTreeBuilder.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/776d5712a156a40b4bcadff76761ccec2cbc5312/console%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fconsole%2Fcommons%2FRoleTreeBuilder.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/console%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fconsole%2Fcommons%2FRoleTreeBuilder.java?ref=776d5712a156a40b4bcadff76761ccec2cbc5312","patch":"@@ -14,6 +14,7 @@\n  */\n package org.syncope.console.commons;\n \n+import java.io.Serializable;\n import java.util.ArrayList;\n import java.util.Collections;\n import java.util.Comparator;\n@@ -65,14 +66,17 @@ public TreeModel build() {\n \n     public TreeModel build(final List<RoleTO> roles) {\n         DefaultMutableTreeNode fakeroot =\n-                new DefaultMutableTreeNode(new FakerootTO());\n+                new DefaultMutableTreeNode(new FakeRootRoleTO());\n \n         populateSubtree(fakeroot, roles);\n \n         return new DefaultTreeModel(fakeroot);\n     }\n \n-    private class RoleTOComparator implements Comparator<RoleTO> {\n+    private static class RoleTOComparator\n+            implements Comparator<RoleTO>, Serializable {\n+\n+        private static final long serialVersionUID = 7085057398406518811L;\n \n         @Override\n         public int compare(final RoleTO r1, final RoleTO r2) {\n@@ -87,11 +91,11 @@ public int compare(final RoleTO r1, final RoleTO r2) {\n         }\n     }\n \n-    private static class FakerootTO extends RoleTO {\n+    private static class FakeRootRoleTO extends RoleTO {\n \n         private static final long serialVersionUID = 4839183625773925488L;\n \n-        public FakerootTO() {\n+        public FakeRootRoleTO() {\n             super();\n \n             setId(0);"},{"sha":"36c7195d567d473bbc4202605cf2b3155ae87293","filename":"console/src/main/java/org/syncope/console/commons/SchemaModalPageFactory.java","status":"renamed","additions":6,"deletions":1,"changes":7,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/776d5712a156a40b4bcadff76761ccec2cbc5312/console%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fconsole%2Fcommons%2FSchemaModalPageFactory.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/776d5712a156a40b4bcadff76761ccec2cbc5312/console%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fconsole%2Fcommons%2FSchemaModalPageFactory.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/console%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fconsole%2Fcommons%2FSchemaModalPageFactory.java?ref=776d5712a156a40b4bcadff76761ccec2cbc5312","patch":"@@ -14,13 +14,18 @@\n  * See the License for the specific language governing permissions and\n  * limitations under the License.\n  */\n-package org.syncope.console;\n+package org.syncope.console.commons;\n \n import org.apache.wicket.spring.injection.annot.SpringBean;\n import org.syncope.console.pages.AbstractSchemaModalPage;\n+import org.syncope.console.pages.AbstractSchemaModalPage;\n+import org.syncope.console.pages.BaseModalPage;\n import org.syncope.console.pages.BaseModalPage;\n import org.syncope.console.pages.DerivedSchemaModalPage;\n+import org.syncope.console.pages.DerivedSchemaModalPage;\n import org.syncope.console.pages.SchemaModalPage;\n+import org.syncope.console.pages.SchemaModalPage;\n+import org.syncope.console.pages.VirtualSchemaModalPage;\n import org.syncope.console.pages.VirtualSchemaModalPage;\n import org.syncope.console.rest.SchemaRestClient;\n ","previous_filename":"console/src/main/java/org/syncope/console/SchemaModalPageFactory.java"},{"sha":"9698d1db735111343d28ea8b0c0ab820bf98293b","filename":"console/src/main/java/org/syncope/console/commons/SortableUserProviderComparator.java","status":"modified","additions":5,"deletions":3,"changes":8,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/776d5712a156a40b4bcadff76761ccec2cbc5312/console%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fconsole%2Fcommons%2FSortableUserProviderComparator.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/776d5712a156a40b4bcadff76761ccec2cbc5312/console%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fconsole%2Fcommons%2FSortableUserProviderComparator.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/console%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fconsole%2Fcommons%2FSortableUserProviderComparator.java?ref=776d5712a156a40b4bcadff76761ccec2cbc5312","patch":"@@ -20,6 +20,7 @@\n import java.util.Set;\n import org.apache.wicket.extensions.markup.html.repeater.util.SortableDataProvider;\n import org.apache.wicket.model.AbstractReadOnlyModel;\n+import org.syncope.client.to.AttributeTO;\n import org.syncope.client.to.UserTO;\n \n public class SortableUserProviderComparator\n@@ -52,9 +53,9 @@ public int compare(final UserTO o1, final UserTO o2) {\n \n     private class AttrModel extends AbstractReadOnlyModel<Comparable> {\n \n-        private final Map<String, List<String>> attrMap;\n+        private final Map<String, AttributeTO> attrMap;\n \n-        public AttrModel(final Map<String, List<String>> attrMap) {\n+        public AttrModel(final Map<String, AttributeTO> attrMap) {\n             super();\n \n             this.attrMap = attrMap;\n@@ -64,7 +65,8 @@ public AttrModel(final Map<String, List<String>> attrMap) {\n         public Comparable getObject() {\n             Comparable result = null;\n \n-            List<String> values = attrMap.get(provider.getSort().getProperty());\n+            List<String> values = attrMap.get(\n+                    provider.getSort().getProperty()).getValues();\n             if (values != null && !values.isEmpty()) {\n                 result = values.iterator().next();\n             }"},{"sha":"08d1542fc71165afdefe66587ef0199ccb95aed7","filename":"console/src/main/java/org/syncope/console/commons/UserDataProvider.java","status":"modified","additions":3,"deletions":1,"changes":4,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/776d5712a156a40b4bcadff76761ccec2cbc5312/console%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fconsole%2Fcommons%2FUserDataProvider.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/776d5712a156a40b4bcadff76761ccec2cbc5312/console%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fconsole%2Fcommons%2FUserDataProvider.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/console%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fconsole%2Fcommons%2FUserDataProvider.java?ref=776d5712a156a40b4bcadff76761ccec2cbc5312","patch":"@@ -26,11 +26,13 @@\n \n public class UserDataProvider extends SortableDataProvider<UserTO> {\n \n+    private static final long serialVersionUID = 6267494272884913376L;\n+\n     private SortableUserProviderComparator comparator;\n \n     private NodeCond filter = null;\n \n-    final private int rows;\n+    private final int rows;\n \n     private boolean filtered = false;\n "},{"sha":"bf4490a71acb07376b547ff826239f792ddb534a","filename":"console/src/main/java/org/syncope/console/pages/ApprovalModalPage.java","status":"renamed","additions":6,"deletions":6,"changes":12,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/776d5712a156a40b4bcadff76761ccec2cbc5312/console%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fconsole%2Fpages%2FApprovalModalPage.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/776d5712a156a40b4bcadff76761ccec2cbc5312/console%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fconsole%2Fpages%2FApprovalModalPage.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/console%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fconsole%2Fpages%2FApprovalModalPage.java?ref=776d5712a156a40b4bcadff76761ccec2cbc5312","patch":"@@ -40,21 +40,21 @@\n import org.syncope.client.to.WorkflowFormTO;\n import org.syncope.client.validation.SyncopeClientCompositeErrorException;\n import org.syncope.console.commons.MapChoiceRenderer;\n-import org.syncope.console.rest.TodoRestClient;\n+import org.syncope.console.rest.ApprovalRestClient;\n import org.syncope.console.wicket.markup.html.form.AjaxDropDownChoicePanel;\n import org.syncope.console.wicket.markup.html.form.AjaxNumberFieldPanel;\n import org.syncope.console.wicket.markup.html.form.AjaxTextFieldPanel;\n import org.syncope.console.wicket.markup.html.form.DateTimeFieldPanel;\n import org.syncope.console.wicket.markup.html.form.FieldPanel;\n \n-public class TodoModalPage extends BaseModalPage {\n+public class ApprovalModalPage extends BaseModalPage {\n \n     private static final long serialVersionUID = -8847854414429745216L;\n \n     @SpringBean\n-    private TodoRestClient restClient;\n+    private ApprovalRestClient restClient;\n \n-    public TodoModalPage(final PageReference callerPageRef,\n+    public ApprovalModalPage(final PageReference callerPageRef,\n             final ModalWindow window, final WorkflowFormTO formTO) {\n \n         super();\n@@ -205,7 +205,7 @@ protected void onSubmit(final AjaxRequestTarget target,\n                 try {\n                     restClient.submitForm(formTO);\n \n-                    ((Todo) callerPageRef.getPage()).setOperationResult(true);\n+                    ((Todo) callerPageRef.getPage()).setModalResult(true);\n                     window.close(target);\n                 } catch (SyncopeClientCompositeErrorException e) {\n                     error(getString(\"error\") + \":\" + e.getMessage());\n@@ -227,7 +227,7 @@ protected void onError(final AjaxRequestTarget target,\n         form.add(submit);\n \n         MetaDataRoleAuthorizationStrategy.authorize(form, ENABLE,\n-                xmlRolesReader.getAllAllowedRoles(\"Todo\", \"submit\"));\n+                xmlRolesReader.getAllAllowedRoles(\"Approval\", \"submit\"));\n \n         add(form);\n     }","previous_filename":"console/src/main/java/org/syncope/console/pages/TodoModalPage.java"},{"sha":"30f411bb50de8dfece4f51bad06b8205f98cfba6","filename":"console/src/main/java/org/syncope/console/pages/BaseModalPage.java","status":"modified","additions":0,"deletions":11,"changes":11,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/776d5712a156a40b4bcadff76761ccec2cbc5312/console%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fconsole%2Fpages%2FBaseModalPage.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/776d5712a156a40b4bcadff76761ccec2cbc5312/console%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fconsole%2Fpages%2FBaseModalPage.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/console%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fconsole%2Fpages%2FBaseModalPage.java?ref=776d5712a156a40b4bcadff76761ccec2cbc5312","patch":"@@ -19,7 +19,6 @@\n import org.apache.wicket.spring.injection.annot.SpringBean;\n import org.slf4j.Logger;\n import org.slf4j.LoggerFactory;\n-import org.syncope.client.AbstractBaseBean;\n import org.syncope.console.commons.XMLRolesReader;\n \n /**\n@@ -40,19 +39,9 @@ public class BaseModalPage extends WebPage {\n \n     protected FeedbackPanel feedbackPanel;\n \n-    private AbstractBaseBean bean;\n-\n     public BaseModalPage() {\n         feedbackPanel = new FeedbackPanel(\"feedback\");\n         feedbackPanel.setOutputMarkupId(true);\n         add(feedbackPanel);\n     }\n-\n-    public AbstractBaseBean getBean() {\n-        return bean;\n-    }\n-\n-    public void setBean(final AbstractBaseBean bean) {\n-        this.bean = bean;\n-    }\n }"},{"sha":"51cd430716e835b27bd9ceb88bf5a3a20dcd862a","filename":"console/src/main/java/org/syncope/console/pages/BasePage.java","status":"modified","additions":114,"deletions":5,"changes":119,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/776d5712a156a40b4bcadff76761ccec2cbc5312/console%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fconsole%2Fpages%2FBasePage.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/776d5712a156a40b4bcadff76761ccec2cbc5312/console%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fconsole%2Fpages%2FBasePage.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/console%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fconsole%2Fpages%2FBasePage.java?ref=776d5712a156a40b4bcadff76761ccec2cbc5312","patch":"@@ -15,17 +15,31 @@\n package org.syncope.console.pages;\n \n import org.apache.wicket.Component;\n+import org.apache.wicket.Page;\n+import org.apache.wicket.ajax.AjaxRequestTarget;\n import org.apache.wicket.ajax.IAjaxIndicatorAware;\n+import org.apache.wicket.ajax.markup.html.AjaxLink;\n import org.apache.wicket.behavior.Behavior;\n+import org.apache.wicket.extensions.ajax.markup.html.IndicatingAjaxLink;\n+import org.apache.wicket.extensions.ajax.markup.html.modal.ModalWindow;\n import org.apache.wicket.markup.ComponentTag;\n+import org.apache.wicket.markup.html.WebMarkupContainer;\n import org.apache.wicket.markup.html.WebPage;\n+import org.apache.wicket.markup.html.basic.Label;\n import org.apache.wicket.markup.html.panel.FeedbackPanel;\n+import org.apache.wicket.markup.html.panel.Fragment;\n+import org.apache.wicket.markup.html.panel.Panel;\n+import org.apache.wicket.model.ResourceModel;\n import org.apache.wicket.request.mapper.parameter.PageParameters;\n import org.apache.wicket.spring.injection.annot.SpringBean;\n import org.slf4j.Logger;\n import org.slf4j.LoggerFactory;\n+import org.syncope.client.to.UserTO;\n import org.syncope.console.SyncopeApplication;\n+import org.syncope.console.SyncopeSession;\n import org.syncope.console.commons.XMLRolesReader;\n+import org.syncope.console.rest.UserRequestRestClient;\n+import org.syncope.console.wicket.markup.html.form.LinkPanel;\n \n /**\n  * Syncope Wicket base-page.\n@@ -37,15 +51,24 @@ public class BasePage extends WebPage implements IAjaxIndicatorAware {\n      */\n     protected static final Logger LOG = LoggerFactory.getLogger(\n             BasePage.class);\n+\n     private static final long serialVersionUID = 1571997737305598502L;\n-    \n+\n+    private final static int EDIT_PROFILE_WIN_HEIGHT = 550;\n+\n+    private final static int EDIT_PROFILE_WIN_WIDTH = 800;\n+\n+    @SpringBean\n+    private UserRequestRestClient profileRestClient;\n+\n     @SpringBean\n     protected XMLRolesReader xmlRolesReader;\n-    \n+\n     @SpringBean(name = \"version\")\n     private String version;\n-    \n+\n     protected FeedbackPanel feedbackPanel;\n+\n     /**\n      * Response flag set by the Modal Window after the operation is completed.\n      */\n@@ -82,6 +105,9 @@ private void pageSetup() {\n         if (kindIcon != null) {\n             kindIcon.add(new Behavior() {\n \n+                private static final long serialVersionUID =\n+                        1469628524240283489L;\n+\n                 @Override\n                 public void onComponentTag(final Component component,\n                         final ComponentTag tag) {\n@@ -91,6 +117,63 @@ public void onComponentTag(final Component component,\n             });\n             add(kindIcon);\n         }\n+\n+        // Modal window for editing user profile\n+        final ModalWindow editProfileModalWin =\n+                new ModalWindow(\"editProfileModal\");\n+        editProfileModalWin.setCssClassName(ModalWindow.CSS_CLASS_GRAY);\n+        editProfileModalWin.setInitialHeight(EDIT_PROFILE_WIN_HEIGHT);\n+        editProfileModalWin.setInitialWidth(EDIT_PROFILE_WIN_WIDTH);\n+        editProfileModalWin.setCookieName(\"edit-profile-modal\");\n+        add(editProfileModalWin);\n+\n+        add(new Label(\"username\", SyncopeSession.get().getUserId()));\n+\n+        Fragment editProfileFrag;\n+        if (\"admin\".equals(SyncopeSession.get().getUserId())) {\n+            editProfileFrag =\n+                    new Fragment(\"editProfile\", \"adminEmptyFrag\", this);\n+        } else {\n+            final UserTO userTO = SyncopeSession.get().isAuthenticated()\n+                    ? profileRestClient.readProfile()\n+                    : new UserTO();\n+\n+            editProfileFrag =\n+                    new Fragment(\"editProfile\", \"editProfileFrag\", this);\n+\n+            AjaxLink editProfileLink =\n+                    new IndicatingAjaxLink(\"link\") {\n+\n+                        private static final long serialVersionUID =\n+                                -7978723352517770644L;\n+\n+                        @Override\n+                        public void onClick(final AjaxRequestTarget target) {\n+                            editProfileModalWin.setPageCreator(\n+                                    new ModalWindow.PageCreator() {\n+\n+                                        @Override\n+                                        public Page createPage() {\n+                                            return new UserModalPage(\n+                                                    BasePage.this.\n+                                                    getPageReference(),\n+                                                    editProfileModalWin,\n+                                                    userTO, true);\n+                                        }\n+                                    });\n+\n+                            editProfileModalWin.show(target);\n+                        }\n+                    };\n+            editProfileLink.add(\n+                    new Label(\"linkTitle\", getString(\"editProfile\")));\n+\n+            Panel panel = new LinkPanel(\"editProfile\",\n+                    new ResourceModel(\"editProfile\"));\n+            panel.add(editProfileLink);\n+            editProfileFrag.add(panel);\n+        }\n+        add(editProfileFrag);\n     }\n \n     @Override\n@@ -106,7 +189,33 @@ public boolean isModalResult() {\n         return modalResult;\n     }\n \n-    public void setModalResult(boolean modalResult) {\n-        this.modalResult = modalResult;\n+    public void setModalResult(final boolean operationResult) {\n+        this.modalResult = operationResult;\n+    }\n+\n+    /**\n+     * Set a WindowClosedCallback for a ModalWindow instance.\n+     * @param window window\n+     * @param container container\n+     */\n+    protected void setWindowClosedCallback(final ModalWindow window,\n+            final WebMarkupContainer container) {\n+\n+        window.setWindowClosedCallback(\n+                new ModalWindow.WindowClosedCallback() {\n+\n+                    private static final long serialVersionUID =\n+                            8804221891699487139L;\n+\n+                    @Override\n+                    public void onClose(final AjaxRequestTarget target) {\n+                        target.add(container);\n+                        if (isModalResult()) {\n+                            info(getString(\"operation_succeded\"));\n+                            target.add(feedbackPanel);\n+                            setModalResult(false);\n+                        }\n+                    }\n+                });\n     }\n }"},{"sha":"c0db57129e311094eddbf6c9ac3026be795d77c6","filename":"console/src/main/java/org/syncope/console/pages/Configuration.java","status":"modified","additions":0,"deletions":40,"changes":40,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/776d5712a156a40b4bcadff76761ccec2cbc5312/console%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fconsole%2Fpages%2FConfiguration.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/776d5712a156a40b4bcadff76761ccec2cbc5312/console%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fconsole%2Fpages%2FConfiguration.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/console%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fconsole%2Fpages%2FConfiguration.java?ref=776d5712a156a40b4bcadff76761ccec2cbc5312","patch":"@@ -115,12 +115,6 @@ public class Configuration extends BasePage {\n \n     private WebMarkupContainer notificationContainer;\n \n-    /**\n-     * Response flag set by the Modal Window after the operation\n-     * is completed.\n-     */\n-    private boolean operationResult = false;\n-\n     private int confPaginatorRows;\n \n     private int notificationPaginatorRows;\n@@ -626,40 +620,6 @@ protected void onUpdate(final AjaxRequestTarget target) {\n         add(notificationPaginatorForm);\n     }\n \n-    /**\n-     * Set a WindowClosedCallback for a ModalWindow instance.\n-     * @param window\n-     * @param container\n-     */\n-    private void setWindowClosedCallback(final ModalWindow window,\n-            final WebMarkupContainer container) {\n-\n-        window.setWindowClosedCallback(\n-                new ModalWindow.WindowClosedCallback() {\n-\n-                    private static final long serialVersionUID =\n-                            8804221891699487139L;\n-\n-                    @Override\n-                    public void onClose(final AjaxRequestTarget target) {\n-                        target.add(container);\n-                        if (operationResult) {\n-                            info(getString(\"operation_succeded\"));\n-                            target.add(feedbackPanel);\n-                            operationResult = false;\n-                        }\n-                    }\n-                });\n-    }\n-\n-    public boolean isOperationResult() {\n-        return operationResult;\n-    }\n-\n-    public void setOperationResult(final boolean operationResult) {\n-        this.operationResult = operationResult;\n-    }\n-\n     private class SyncopeConfProvider\n             extends SortableDataProvider<ConfigurationTO> {\n "},{"sha":"e74ae4130597397a9a1388d75641eda0151f82d1","filename":"console/src/main/java/org/syncope/console/pages/ConfigurationModalPage.java","status":"modified","additions":1,"deletions":1,"changes":2,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/776d5712a156a40b4bcadff76761ccec2cbc5312/console%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fconsole%2Fpages%2FConfigurationModalPage.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/776d5712a156a40b4bcadff76761ccec2cbc5312/console%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fconsole%2Fpages%2FConfigurationModalPage.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/console%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fconsole%2Fpages%2FConfigurationModalPage.java?ref=776d5712a156a40b4bcadff76761ccec2cbc5312","patch":"@@ -102,7 +102,7 @@ protected void onSubmit(final AjaxRequestTarget target,\n                 if (res) {\n                     Configuration callerPage =\n                             (Configuration) callPageRef.getPage();\n-                    callerPage.setOperationResult(true);\n+                    callerPage.setModalResult(true);\n \n                     window.close(target);\n                 }"},{"sha":"ec4b78061af590a65be1d51d04bb89669fd2087f","filename":"console/src/main/java/org/syncope/console/pages/ConnectorModalPage.java","status":"modified","additions":2,"deletions":2,"changes":4,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/776d5712a156a40b4bcadff76761ccec2cbc5312/console%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fconsole%2Fpages%2FConnectorModalPage.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/776d5712a156a40b4bcadff76761ccec2cbc5312/console%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fconsole%2Fpages%2FConnectorModalPage.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/console%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fconsole%2Fpages%2FConnectorModalPage.java?ref=776d5712a156a40b4bcadff76761ccec2cbc5312","patch":"@@ -342,12 +342,12 @@ protected void onSubmit(final AjaxRequestTarget target,\n                         restClient.update(connector);\n                     }\n \n-                    ((Resources) callerPageRef.getPage()).setOperationResult(\n+                    ((Resources) callerPageRef.getPage()).setModalResult(\n                             true);\n                     window.close(target);\n                 } catch (SyncopeClientCompositeErrorException e) {\n                     error(getString(\"error\") + \":\" + e.getMessage());\n-                    ((Resources) callerPageRef.getPage()).setOperationResult(\n+                    ((Resources) callerPageRef.getPage()).setModalResult(\n                             false);\n                     LOG.error(\"While creating or updating connector \"\n                             + connector);"},{"sha":"d0f5e85f855399830a429c3638b486958d5987d7","filename":"console/src/main/java/org/syncope/console/pages/DerivedSchemaModalPage.java","status":"modified","additions":1,"deletions":1,"changes":2,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/776d5712a156a40b4bcadff76761ccec2cbc5312/console%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fconsole%2Fpages%2FDerivedSchemaModalPage.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/776d5712a156a40b4bcadff76761ccec2cbc5312/console%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fconsole%2Fpages%2FDerivedSchemaModalPage.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/console%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fconsole%2Fpages%2FDerivedSchemaModalPage.java?ref=776d5712a156a40b4bcadff76761ccec2cbc5312","patch":"@@ -83,7 +83,7 @@ protected void onSubmit(AjaxRequestTarget target, Form form) {\n                 }\n \n                 Schema callerPage = (Schema) callerPageRef.getPage();\n-                callerPage.setOperationResult(true);\n+                callerPage.setModalResult(true);\n \n                 window.close(target);\n             }"},{"sha":"d1e8437cff28278a34fecc5c8854551f80bc2276","filename":"console/src/main/java/org/syncope/console/pages/ErrorPage.java","status":"modified","additions":2,"deletions":0,"changes":2,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/776d5712a156a40b4bcadff76761ccec2cbc5312/console%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fconsole%2Fpages%2FErrorPage.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/776d5712a156a40b4bcadff76761ccec2cbc5312/console%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fconsole%2Fpages%2FErrorPage.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/console%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fconsole%2Fpages%2FErrorPage.java?ref=776d5712a156a40b4bcadff76761ccec2cbc5312","patch":"@@ -24,6 +24,8 @@\n  */\n public class ErrorPage extends BasePage {\n \n+    private static final long serialVersionUID = -390761262038796657L;\n+\n     public ErrorPage(final PageParameters parameters) {\n         super(parameters);\n "},{"sha":"6761354f0f2b02e29fbeb27f582ecb6c099653ca","filename":"console/src/main/java/org/syncope/console/pages/Login.java","status":"modified","additions":82,"deletions":14,"changes":96,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/776d5712a156a40b4bcadff76761ccec2cbc5312/console%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fconsole%2Fpages%2FLogin.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/776d5712a156a40b4bcadff76761ccec2cbc5312/console%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fconsole%2Fpages%2FLogin.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/console%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fconsole%2Fpages%2FLogin.java?ref=776d5712a156a40b4bcadff76761ccec2cbc5312","patch":"@@ -23,24 +23,35 @@\n import org.apache.commons.httpclient.UsernamePasswordCredentials;\n import org.apache.commons.httpclient.auth.AuthScope;\n import org.apache.commons.httpclient.methods.GetMethod;\n+import org.apache.wicket.Page;\n+import org.apache.wicket.ajax.AjaxRequestTarget;\n+import org.apache.wicket.ajax.markup.html.AjaxLink;\n+import org.apache.wicket.extensions.ajax.markup.html.IndicatingAjaxLink;\n+import org.apache.wicket.extensions.ajax.markup.html.modal.ModalWindow;\n import org.apache.wicket.markup.html.WebPage;\n+import org.apache.wicket.markup.html.basic.Label;\n import org.apache.wicket.markup.html.form.Button;\n import org.apache.wicket.markup.html.form.ChoiceRenderer;\n import org.apache.wicket.markup.html.form.DropDownChoice;\n import org.apache.wicket.markup.html.form.Form;\n import org.apache.wicket.markup.html.form.PasswordTextField;\n import org.apache.wicket.markup.html.form.TextField;\n import org.apache.wicket.markup.html.panel.FeedbackPanel;\n+import org.apache.wicket.markup.html.panel.Fragment;\n+import org.apache.wicket.markup.html.panel.Panel;\n import org.apache.wicket.model.IModel;\n import org.apache.wicket.model.Model;\n+import org.apache.wicket.model.ResourceModel;\n import org.apache.wicket.request.mapper.parameter.PageParameters;\n import org.apache.wicket.spring.injection.annot.SpringBean;\n import org.slf4j.Logger;\n import org.slf4j.LoggerFactory;\n import org.springframework.http.client.CommonsClientHttpRequestFactory;\n import org.springframework.web.client.RestTemplate;\n+import org.syncope.client.to.UserTO;\n import org.syncope.client.validation.SyncopeClientCompositeErrorException;\n import org.syncope.console.SyncopeSession;\n+import org.syncope.console.wicket.markup.html.form.LinkPanel;\n \n /**\n  * Syncope Login page.\n@@ -55,6 +66,10 @@ public class Login extends WebPage {\n \n     private static final long serialVersionUID = -3744389270366566218L;\n \n+    private final static int SELF_REG_WIN_HEIGHT = 550;\n+\n+    private final static int SELF_REG_WIN_WIDTH = 800;\n+\n     @SpringBean\n     private RestTemplate restTemplate;\n \n@@ -93,25 +108,21 @@ public Login(final PageParameters parameters) {\n         Button submitButton = new Button(\"submit\", new Model(\n                 getString(\"submit\"))) {\n \n+            private static final long serialVersionUID = 429178684321093953L;\n+\n             @Override\n             public void onSubmit() {\n                 String[] entitlements = authenticate(\n                         userIdField.getRawInput(),\n                         passwordField.getRawInput());\n \n-                if (entitlements == null || entitlements.length == 0) {\n-                    LOG.error(\"No entitlements found for \"\n-                            + userIdField.getRawInput());\n-                    getSession().error(getString(\"login-error\"));\n-                } else {\n-                    SyncopeSession.get().setUserId(\n-                            userIdField.getRawInput());\n-                    SyncopeSession.get().setEntitlements(\n-                            entitlements);\n-                    SyncopeSession.get().setCoreVersion(getCoreVersion());\n-\n-                    setResponsePage(WelcomePage.class, parameters);\n-                }\n+                SyncopeSession.get().setUserId(\n+                        userIdField.getRawInput());\n+                SyncopeSession.get().setEntitlements(\n+                        entitlements);\n+                SyncopeSession.get().setCoreVersion(getCoreVersion());\n+\n+                setResponsePage(WelcomePage.class, parameters);\n             }\n         };\n \n@@ -120,6 +131,59 @@ public void onSubmit() {\n \n         add(form);\n         add(new FeedbackPanel(\"feedback\"));\n+\n+        // Modal window for self registration\n+        final ModalWindow editProfileModalWin =\n+                new ModalWindow(\"selfRegModal\");\n+        editProfileModalWin.setCssClassName(ModalWindow.CSS_CLASS_GRAY);\n+        editProfileModalWin.setInitialHeight(SELF_REG_WIN_HEIGHT);\n+        editProfileModalWin.setInitialWidth(SELF_REG_WIN_WIDTH);\n+        editProfileModalWin.setCookieName(\"self-reg-modal\");\n+        add(editProfileModalWin);\n+\n+        Fragment selfRegFrag;\n+        if (restTemplate.getForObject(\n+                baseURL + \"user/request/create/allowed\",\n+                Boolean.class)) {\n+\n+            selfRegFrag =\n+                    new Fragment(\"selfRegistration\", \"selfRegAllowed\", this);\n+\n+            AjaxLink selfRegLink =\n+                    new IndicatingAjaxLink(\"link\") {\n+\n+                        private static final long serialVersionUID =\n+                                -7978723352517770644L;\n+\n+                        @Override\n+                        public void onClick(final AjaxRequestTarget target) {\n+                            editProfileModalWin.setPageCreator(\n+                                    new ModalWindow.PageCreator() {\n+\n+                                        @Override\n+                                        public Page createPage() {\n+                                            return new UserModalPage(\n+                                                    Login.this.getPageReference(),\n+                                                    editProfileModalWin,\n+                                                    new UserTO(), true);\n+                                        }\n+                                    });\n+\n+                            editProfileModalWin.show(target);\n+                        }\n+                    };\n+            selfRegLink.add(\n+                    new Label(\"linkTitle\", getString(\"selfRegistration\")));\n+\n+            Panel panel = new LinkPanel(\"selfRegistration\",\n+                    new ResourceModel(\"selfRegistration\"));\n+            panel.add(selfRegLink);\n+            selfRegFrag.add(panel);\n+        } else {\n+            selfRegFrag =\n+                    new Fragment(\"selfRegistration\", \"selfRegNotAllowed\", this);\n+        }\n+        add(selfRegFrag);\n     }\n \n     private String[] authenticate(final String userId, final String password) {\n@@ -161,8 +225,12 @@ private String getCoreVersion() {\n      */\n     private class LocaleDropDown extends DropDownChoice<Locale> {\n \n+        private static final long serialVersionUID = 2349382679992357202L;\n+\n         private class LocaleRenderer extends ChoiceRenderer<Locale> {\n \n+            private static final long serialVersionUID = -3657529581555164741L;\n+\n             @Override\n             public String getDisplayValue(final Locale locale) {\n                 return locale.getDisplayName(getLocale());\n@@ -192,7 +260,7 @@ public void detach() {\n                 }\n             });\n \n-            //Set default value to English\n+            // set default value to English\n             getModel().setObject(Locale.ENGLISH);\n         }\n "},{"sha":"8e4e090454f34a75b0fc9001d6a0ca09ebc81c1a","filename":"console/src/main/java/org/syncope/console/pages/MembershipModalPage.java","status":"modified","additions":6,"deletions":7,"changes":13,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/776d5712a156a40b4bcadff76761ccec2cbc5312/console%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fconsole%2Fpages%2FMembershipModalPage.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/776d5712a156a40b4bcadff76761ccec2cbc5312/console%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fconsole%2Fpages%2FMembershipModalPage.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/console%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fconsole%2Fpages%2FMembershipModalPage.java?ref=776d5712a156a40b4bcadff76761ccec2cbc5312","patch":"@@ -23,7 +23,6 @@\n import org.apache.wicket.markup.html.form.Form;\n import org.apache.wicket.model.CompoundPropertyModel;\n import org.apache.wicket.model.ResourceModel;\n-import org.syncope.client.AbstractBaseBean;\n import org.syncope.client.to.MembershipTO;\n import org.syncope.client.to.UserTO;\n import org.syncope.console.pages.panels.DerivedAttributesPanel;\n@@ -45,8 +44,8 @@ public MembershipModalPage(\n \n         final Form form = new Form(\"MembershipForm\");\n \n-        final AbstractBaseBean bean =\n-                ((BaseModalPage) pageRef.getPage()).getBean();\n+        final UserTO userTO =\n+                ((UserModalPage) pageRef.getPage()).getUserTO();\n \n         form.setModel(new CompoundPropertyModel(membershipTO));\n \n@@ -58,10 +57,10 @@ public MembershipModalPage(\n             protected void onSubmit(\n                     final AjaxRequestTarget target, final Form form) {\n \n-                ((UserTO) bean).removeMembership(membershipTO);\n-                ((UserTO) bean).addMembership(membershipTO);\n+                userTO.removeMembership(membershipTO);\n+                userTO.addMembership(membershipTO);\n \n-                ((BaseModalPage) pageRef.getPage()).setBean(bean);\n+                ((UserModalPage) pageRef.getPage()).setUserTO(userTO);\n \n                 window.close(target);\n             }\n@@ -76,7 +75,7 @@ protected void onError(\n \n         String allowedRoles = null;\n \n-        if (((UserTO) bean).getId() == 0) {\n+        if (((UserTO) userTO).getId() == 0) {\n             allowedRoles = xmlRolesReader.getAllAllowedRoles(\"Users\", \"create\");\n         } else {\n             allowedRoles = xmlRolesReader.getAllAllowedRoles(\"Users\", \"update\");"},{"sha":"ef85cdd2ac47c85ea7756c3504c8b3372aeb45e7","filename":"console/src/main/java/org/syncope/console/pages/NotificationModalPage.java","status":"modified","additions":1,"deletions":1,"changes":2,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/776d5712a156a40b4bcadff76761ccec2cbc5312/console%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fconsole%2Fpages%2FNotificationModalPage.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/776d5712a156a40b4bcadff76761ccec2cbc5312/console%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fconsole%2Fpages%2FNotificationModalPage.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/console%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fconsole%2Fpages%2FNotificationModalPage.java?ref=776d5712a156a40b4bcadff76761ccec2cbc5312","patch":"@@ -126,7 +126,7 @@ protected void onSubmit(final AjaxRequestTarget target,\n \n                     Configuration callerPage =\n                             (Configuration) callPageRef.getPage();\n-                    callerPage.setOperationResult(true);\n+                    callerPage.setModalResult(true);\n \n                     window.close(target);\n                 } catch (SyncopeClientCompositeErrorException scee) {"},{"sha":"5c8fb4da25a8012d258b1d8d48d2f3ffde6d7085","filename":"console/src/main/java/org/syncope/console/pages/ResourceModalPage.java","status":"modified","additions":1,"deletions":1,"changes":2,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/776d5712a156a40b4bcadff76761ccec2cbc5312/console%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fconsole%2Fpages%2FResourceModalPage.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/776d5712a156a40b4bcadff76761ccec2cbc5312/console%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fconsole%2Fpages%2FResourceModalPage.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/console%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fconsole%2Fpages%2FResourceModalPage.java?ref=776d5712a156a40b4bcadff76761ccec2cbc5312","patch":"@@ -688,7 +688,7 @@ protected void onSubmit(final AjaxRequestTarget target,\n                             restClient.update(resourceTO);\n                         }\n \n-                        ((Resources) callPageRef.getPage()).setOperationResult(\n+                        ((Resources) callPageRef.getPage()).setModalResult(\n                                 true);\n                         window.close(target);\n                     } catch (SyncopeClientCompositeErrorException e) {"},{"sha":"2adf0ad957e822fd671d64cc02841a9f193cb7b1","filename":"console/src/main/java/org/syncope/console/pages/Resources.java","status":"modified","additions":0,"deletions":36,"changes":36,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/776d5712a156a40b4bcadff76761ccec2cbc5312/console%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fconsole%2Fpages%2FResources.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/776d5712a156a40b4bcadff76761ccec2cbc5312/console%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fconsole%2Fpages%2FResources.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/console%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fconsole%2Fpages%2FResources.java?ref=776d5712a156a40b4bcadff76761ccec2cbc5312","patch":"@@ -86,12 +86,6 @@ public class Resources extends BasePage {\n \n     private WebMarkupContainer connectorContainer;\n \n-    /*\n-    Response flag set by the Modal Window after the operation is completed:\n-    TRUE if the operation succedes, FALSE otherwise\n-     */\n-    private boolean operationResult = false;\n-\n     private int resourcePaginatorRows;\n \n     private int connectorPaginatorRows;\n@@ -505,36 +499,6 @@ protected void onUpdate(AjaxRequestTarget target) {\n         add(paginatorForm);\n     }\n \n-    /**\n-     * Set a WindowClosedCallback for a ModalWindow instance.\n-     * @param window\n-     * @param container\n-     */\n-    private void setWindowClosedCallback(ModalWindow window,\n-            final WebMarkupContainer container) {\n-\n-        window.setWindowClosedCallback(\n-                new ModalWindow.WindowClosedCallback() {\n-\n-                    private static final long serialVersionUID =\n-                            8804221891699487139L;\n-\n-                    @Override\n-                    public void onClose(AjaxRequestTarget target) {\n-                        target.add(container);\n-                        if (operationResult) {\n-                            info(getString(\"operation_succeded\"));\n-                            target.add(feedbackPanel);\n-                            operationResult = false;\n-                        }\n-                    }\n-                });\n-    }\n-\n-    public void setOperationResult(boolean result) {\n-        operationResult = result;\n-    }\n-\n     /**\n      * Check if the delete action is forbidden.\n      *"},{"sha":"1f2ebfde1782653d86eb337106b6a68190b0674b","filename":"console/src/main/java/org/syncope/console/pages/RoleModalPage.java","status":"modified","additions":17,"deletions":318,"changes":335,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/776d5712a156a40b4bcadff76761ccec2cbc5312/console%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fconsole%2Fpages%2FRoleModalPage.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/776d5712a156a40b4bcadff76761ccec2cbc5312/console%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fconsole%2Fpages%2FRoleModalPage.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/console%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fconsole%2Fpages%2FRoleModalPage.java?ref=776d5712a156a40b4bcadff76761ccec2cbc5312","patch":"@@ -29,12 +29,9 @@\n import org.apache.wicket.model.CompoundPropertyModel;\n import org.apache.wicket.model.ResourceModel;\n import org.apache.wicket.spring.injection.annot.SpringBean;\n-import org.syncope.client.mod.AttributeMod;\n-import org.syncope.client.mod.ReferenceMod;\n import org.syncope.client.mod.RoleMod;\n-import org.syncope.client.to.AttributeTO;\n import org.syncope.client.to.RoleTO;\n-import org.syncope.console.rest.EntitlementRestClient;\n+import org.syncope.client.util.AttributableOperations;\n import org.syncope.console.rest.RoleRestClient;\n import org.syncope.console.pages.panels.RoleAttributesPanel;\n \n@@ -44,33 +41,20 @@\n public class RoleModalPage extends BaseModalPage {\n \n     private static final long serialVersionUID = -1732493223434085205L;\n-    \n+\n     @SpringBean\n     private RoleRestClient roleRestClient;\n-    \n-    @SpringBean\n-    private EntitlementRestClient entitlementRestClient;\n-    \n-    private RoleTO oldRole;\n-    \n-    private RoleMod roleMod;\n \n-    /**\n-     * Constructor.\n-     *\n-     * @param callerPageRef\n-     * @param window\n-     * @param roleTO\n-     * @param createFlag\n-     */\n+    private RoleTO originalRoleTO;\n+\n     public RoleModalPage(final PageReference callerPageRef,\n-            final ModalWindow window, final RoleTO roleTO,\n-            final boolean createFlag) {\n+            final ModalWindow window, final RoleTO roleTO) {\n \n         super();\n \n+        final boolean createFlag = roleTO.getId() == 0;\n         if (!createFlag) {\n-            cloneOldRoleTO(roleTO);\n+            originalRoleTO = AttributableOperations.clone(roleTO);\n         }\n \n         final Form form = new Form(\"RoleForm\");\n@@ -95,30 +79,26 @@ protected void onSubmit(final AjaxRequestTarget target,\n                     final Form form) {\n \n                 final RoleTO roleTO = (RoleTO) form.getDefaultModelObject();\n-\n                 try {\n-\n                     final List<String> entitlementList =\n                             new ArrayList<String>(\n                             attributesPanel.getEntitlementsPalette().\n-                            getModelCollection().size());\n-                    for (String entitlement :\n-                            attributesPanel.getEntitlementsPalette().\n-                            getModelCollection()) {\n-\n-                        entitlementList.add(entitlement);\n-                    }\n+                            getModelCollection());\n                     roleTO.setEntitlements(entitlementList);\n \n                     if (createFlag) {\n                         roleRestClient.createRole(roleTO);\n                     } else {\n-                        setupRoleMod(roleTO);\n-                        if (roleMod != null) {\n+                        RoleMod roleMod = AttributableOperations.diff(\n+                                roleTO, originalRoleTO);\n+\n+                        // update role just if it is changed\n+                        if (!roleMod.isEmpty()) {\n                             roleRestClient.updateRole(roleMod);\n                         }\n                     }\n                     ((Roles) callerPageRef.getPage()).setModalResult(true);\n+\n                     window.close(target);\n                 } catch (Exception e) {\n                     error(getString(\"error\") + \":\" + e.getMessage());\n@@ -134,295 +114,14 @@ protected void onError(final AjaxRequestTarget target,\n             }\n         };\n \n-        String allowedRoles;\n-\n-        if (createFlag) {\n-            allowedRoles = xmlRolesReader.getAllAllowedRoles(\"Roles\", \"create\");\n-        } else {\n-            allowedRoles = xmlRolesReader.getAllAllowedRoles(\"Roles\", \"update\");\n-        }\n-\n+        String allowedRoles = createFlag\n+                ? xmlRolesReader.getAllAllowedRoles(\"Roles\", \"create\")\n+                : xmlRolesReader.getAllAllowedRoles(\"Roles\", \"update\");\n         MetaDataRoleAuthorizationStrategy.authorize(\n                 submit, ENABLE, allowedRoles);\n \n         form.add(submit);\n \n         add(form);\n     }\n-\n-    /**\n-     * Create a copy of old RoleTO\n-     * @param roleTO\n-     */\n-    private void cloneOldRoleTO(RoleTO roleTO) {\n-        oldRole = new RoleTO();\n-\n-        oldRole.setId(roleTO.getId());\n-        oldRole.setName(roleTO.getName());\n-        oldRole.setParent(roleTO.getParent());\n-\n-        List<AttributeTO> attributes = new ArrayList<AttributeTO>();\n-\n-        AttributeTO attributeTO;\n-\n-        for (AttributeTO attribute : roleTO.getAttributes()) {\n-            attributeTO = new AttributeTO();\n-            attributeTO.setReadonly(attribute.isReadonly());\n-            attributeTO.setSchema(attribute.getSchema());\n-\n-            for (String value : attribute.getValues()) {\n-                attributeTO.addValue(value);\n-            }\n-\n-            attributes.add(attributeTO);\n-        }\n-\n-        oldRole.setAttributes(attributes);\n-\n-        attributes = new ArrayList<AttributeTO>();\n-\n-        for (AttributeTO attribute : roleTO.getDerivedAttributes()) {\n-            attributeTO = new AttributeTO();\n-            attributeTO.setReadonly(attribute.isReadonly());\n-            attributeTO.setSchema(attribute.getSchema());\n-            attributes.add(attributeTO);\n-        }\n-\n-        oldRole.setDerivedAttributes(attributes);\n-\n-        attributes = new ArrayList<AttributeTO>();\n-\n-        for (AttributeTO attribute : roleTO.getVirtualAttributes()) {\n-            attributeTO = new AttributeTO();\n-            attributeTO.setReadonly(attribute.isReadonly());\n-            attributeTO.setSchema(attribute.getSchema());\n-            attributes.add(attributeTO);\n-        }\n-\n-        oldRole.setVirtualAttributes(attributes);\n-\n-        for (String resource : roleTO.getResources()) {\n-            oldRole.addResource(resource);\n-        }\n-\n-        List<String> entList = new ArrayList<String>();\n-\n-        for (String entitlement : roleTO.getEntitlements()) {\n-            entList.add(entitlement);\n-        }\n-\n-        oldRole.setEntitlements(entList);\n-    }\n-\n-    private void setupRoleMod(final RoleTO roleTO) {\n-        roleMod = new RoleMod();\n-\n-        roleMod.setInheritAttributes(\n-                roleTO.isInheritAttributes());\n-\n-        roleMod.setInheritDerivedAttributes(\n-                roleTO.isInheritDerivedAttributes());\n-\n-        roleMod.setInheritVirtualAttributes(\n-                roleTO.isInheritVirtualAttributes());\n-\n-        roleMod.setInheritAccountPolicy(\n-                roleTO.isInheritAccountPolicy());\n-\n-        final ReferenceMod refAccountPolicy = new ReferenceMod();\n-        refAccountPolicy.setId(roleTO.getAccountPolicy());\n-\n-        roleMod.setAccountPolicy(refAccountPolicy);\n-\n-        roleMod.setInheritPasswordPolicy(\n-                roleTO.isInheritPasswordPolicy());\n-\n-        final ReferenceMod refPasswordPolicy = new ReferenceMod();\n-        refPasswordPolicy.setId(roleTO.getPasswordPolicy());\n-\n-        roleMod.setPasswordPolicy(refPasswordPolicy);\n-\n-        //1.Check if the role's name has been changed\n-        if (!oldRole.getName().equals(roleTO.getName())) {\n-            roleMod.setName(roleTO.getName());\n-        }\n-\n-        //2.Update roles's schema derived attributes\n-        final List<AttributeTO> newDerivedAttributes =\n-                roleTO.getDerivedAttributes();\n-\n-        final List<AttributeTO> oldDerivedAttributes =\n-                oldRole.getDerivedAttributes();\n-\n-        for (AttributeTO oldDerivedAttribute : oldDerivedAttributes) {\n-            roleMod.addDerivedAttributeToBeRemoved(\n-                    oldDerivedAttribute.getSchema());\n-        }\n-\n-        for (AttributeTO newDerivedAttribute : newDerivedAttributes) {\n-            roleMod.addDerivedAttributeToBeAdded(\n-                    newDerivedAttribute.getSchema());\n-        }\n-\n-        //4.Update roles's schema virtual attributes\n-        final List<AttributeTO> newVirtualAttributes =\n-                roleTO.getVirtualAttributes();\n-\n-        final List<AttributeTO> oldVirtualAttributes =\n-                oldRole.getVirtualAttributes();\n-\n-        for (AttributeTO oldVirtualAttribute : oldVirtualAttributes) {\n-            roleMod.addVirtualAttributeToBeRemoved(\n-                    oldVirtualAttribute.getSchema());\n-        }\n-\n-        for (AttributeTO newVirtualAttribute : newVirtualAttributes) {\n-            roleMod.addVirtualAttributeToBeAdded(\n-                    newVirtualAttribute.getSchema());\n-        }\n-\n-        //4.Search and update role's attributes\n-        for (AttributeTO attributeTO : roleTO.getAttributes()) {\n-            searchAndUpdateAttribute(attributeTO);\n-        }\n-\n-        //5.Search and update role's resources\n-        for (String resource : roleTO.getResources()) {\n-            searchAndAddResource(resource);\n-        }\n-\n-        for (String resource : oldRole.getResources()) {\n-            searchAndDropResource(resource, roleTO);\n-        }\n-\n-        //6.Check if entitlements' list has been changed\n-        if (!oldRole.getEntitlements().equals(roleTO.getEntitlements())) {\n-            roleMod.setEntitlements(roleTO.getEntitlements());\n-        }\n-\n-        if (roleMod != null) {\n-            roleMod.setId(oldRole.getId());\n-\n-            if (!oldRole.getEntitlements().equals(roleTO.getEntitlements())) {\n-\n-                LOG.debug(\"OLD ROLE ENT LIST: {}\", oldRole.getEntitlements());\n-\n-                LOG.debug(\"ROLE ENT LIST: {}\", roleTO.getEntitlements());\n-\n-                roleMod.setEntitlements(roleTO.getEntitlements());\n-            } else {\n-                roleMod.setEntitlements(oldRole.getEntitlements());\n-            }\n-        }\n-    }\n-\n-    /**\n-     * Search for a resource and add that one to the RoleMod object if\n-     * it doesn't exist.\n-     * @param resource, new resource added\n-     */\n-    private void searchAndAddResource(String resource) {\n-        boolean found = false;\n-\n-        /*\n-        Check if the current resource was existent before the update and\n-        in this case just ignore it\n-         */\n-        for (String oldResource : oldRole.getResources()) {\n-            if (resource.equals(oldResource)) {\n-                found = true;\n-            }\n-\n-        }\n-\n-        if (!found) {\n-            if (roleMod == null) {\n-                roleMod = new RoleMod();\n-            }\n-\n-            roleMod.addResourceToBeAdded(resource);\n-        }\n-    }\n-\n-    /**\n-     * Search for a resource and drop that one from the RoleMod object if\n-     * it doesn't exist anymore.\n-     * @param resource\n-     * @param roleTO\n-     */\n-    private void searchAndDropResource(final String resource,\n-            final RoleTO roleTO) {\n-\n-        boolean found = false;\n-\n-        /* Check if the current resource was existent before the update\n-        and in this case just ignore it */\n-        for (String newResource : roleTO.getResources()) {\n-            if (resource.equals(newResource)) {\n-                found = true;\n-            }\n-        }\n-\n-        if (!found) {\n-            if (roleMod == null) {\n-                roleMod = new RoleMod();\n-            }\n-            roleMod.addResourceToBeRemoved(resource);\n-        }\n-    }\n-\n-    private void searchAndUpdateAttribute(AttributeTO attributeTO) {\n-        boolean found = false;\n-        boolean changed = false;\n-\n-        AttributeMod attributeMod = new AttributeMod();\n-        attributeMod.setSchema(attributeTO.getSchema());\n-\n-        for (AttributeTO oldAttribute : oldRole.getAttributes()) {\n-            if (attributeTO.getSchema().equals(oldAttribute.getSchema())) {\n-\n-                if (attributeTO.getSchema().equals(oldAttribute.getSchema())\n-                        && !attributeTO.equals(oldAttribute)\n-                        && !oldAttribute.isReadonly()) {\n-\n-                    if (attributeTO.getValues().size() > 1) {\n-                        attributeMod.setValuesToBeAdded(\n-                                attributeTO.getValues());\n-                    } else {\n-                        attributeMod.addValueToBeAdded(\n-                                attributeTO.getValues().iterator().next());\n-                    }\n-\n-                    if (roleMod == null) {\n-                        roleMod = new RoleMod();\n-                    }\n-\n-                    roleMod.addAttributeToBeRemoved(\n-                            oldAttribute.getSchema());\n-                    roleMod.addAttributeToBeUpdated(attributeMod);\n-\n-                    changed = true;\n-                    break;\n-                }\n-                found = true;\n-            }\n-        }\n-\n-        if (!found && !changed && !attributeTO.isReadonly()\n-                && attributeTO.getValues() != null) {\n-\n-            if (attributeTO.getValues() != null\n-                    && !attributeTO.getValues().isEmpty()) {\n-\n-                attributeMod.setValuesToBeAdded(attributeTO.getValues());\n-\n-                if (roleMod == null) {\n-                    roleMod = new RoleMod();\n-                }\n-                roleMod.addAttributeToBeUpdated(attributeMod);\n-            } else {\n-                attributeMod = null;\n-            }\n-        }\n-    }\n }"},{"sha":"5d01430277cfdaa03185b30d1d116e05ba79fffa","filename":"console/src/main/java/org/syncope/console/pages/Schema.java","status":"modified","additions":1,"deletions":29,"changes":30,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/776d5712a156a40b4bcadff76761ccec2cbc5312/console%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fconsole%2Fpages%2FSchema.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/776d5712a156a40b4bcadff76761ccec2cbc5312/console%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fconsole%2Fpages%2FSchema.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/console%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fconsole%2Fpages%2FSchema.java?ref=776d5712a156a40b4bcadff76761ccec2cbc5312","patch":"@@ -14,6 +14,7 @@\n  */\n package org.syncope.console.pages;\n \n+import org.syncope.console.commons.SchemaModalPageFactory;\n import java.util.ArrayList;\n import java.util.Collections;\n import java.util.Iterator;\n@@ -46,7 +47,6 @@\n import org.syncope.client.to.DerivedSchemaTO;\n import org.syncope.client.to.SchemaTO;\n import org.syncope.client.to.VirtualSchemaTO;\n-import org.syncope.console.SchemaModalPageFactory;\n import org.syncope.console.commons.Constants;\n import org.syncope.console.commons.PreferenceManager;\n import org.syncope.console.commons.SelectChoiceRenderer;\n@@ -737,34 +737,6 @@ public Schema(PageParameters parameters) {\n                 allowedCreateRoles));\n     }\n \n-    /**\n-     * Set a WindowClosedCallback for a ModalWindow instance.\n-     * @param window\n-     * @param container\n-     */\n-    private void setWindowClosedCallback(final ModalWindow window,\n-            final WebMarkupContainer container) {\n-\n-        window.setWindowClosedCallback(new ModalWindow.WindowClosedCallback() {\n-\n-            private static final long serialVersionUID = 8804221891699487139L;\n-\n-            @Override\n-            public void onClose(final AjaxRequestTarget target) {\n-                target.add(container);\n-                if (operationResult) {\n-                    info(getString(\"operation_succeded\"));\n-                    target.add(feedbackPanel);\n-                    operationResult = false;\n-                }\n-            }\n-        });\n-    }\n-\n-    public void setOperationResult(boolean operationResult) {\n-        this.operationResult = operationResult;\n-    }\n-\n     private class SchemaProvider extends SortableDataProvider<SchemaTO> {\n \n         private static final long serialVersionUID = 712816496206559637L;"},{"sha":"95d3414e17400f283c3b017998157e1de4f686cd","filename":"console/src/main/java/org/syncope/console/pages/SchemaModalPage.java","status":"modified","additions":1,"deletions":1,"changes":2,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/776d5712a156a40b4bcadff76761ccec2cbc5312/console%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fconsole%2Fpages%2FSchemaModalPage.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/776d5712a156a40b4bcadff76761ccec2cbc5312/console%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fconsole%2Fpages%2FSchemaModalPage.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/console%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fconsole%2Fpages%2FSchemaModalPage.java?ref=776d5712a156a40b4bcadff76761ccec2cbc5312","patch":"@@ -214,7 +214,7 @@ protected void onSubmit(final AjaxRequestTarget target,\n                 }\n \n                 Schema callerPage = (Schema) callerPageRef.getPage();\n-                callerPage.setOperationResult(true);\n+                callerPage.setModalResult(true);\n \n                 window.close(target);\n             }"},{"sha":"81d945a7d35d07ba9bc58a24eb9b6731dbefecea","filename":"console/src/main/java/org/syncope/console/pages/Todo.java","status":"modified","additions":317,"deletions":78,"changes":395,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/776d5712a156a40b4bcadff76761ccec2cbc5312/console%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fconsole%2Fpages%2FTodo.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/776d5712a156a40b4bcadff76761ccec2cbc5312/console%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fconsole%2Fpages%2FTodo.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/console%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fconsole%2Fpages%2FTodo.java?ref=776d5712a156a40b4bcadff76761ccec2cbc5312","patch":"@@ -45,52 +45,73 @@\n import org.apache.wicket.model.ResourceModel;\n import org.apache.wicket.request.mapper.parameter.PageParameters;\n import org.apache.wicket.spring.injection.annot.SpringBean;\n-import org.springframework.web.client.RestClientException;\n+import org.syncope.client.to.UserRequestTO;\n import org.syncope.client.to.WorkflowFormTO;\n import org.syncope.client.validation.SyncopeClientCompositeErrorException;\n import org.syncope.console.SyncopeSession;\n import org.syncope.console.commons.Constants;\n import org.syncope.console.commons.PreferenceManager;\n import org.syncope.console.commons.SortableDataProviderComparator;\n-import org.syncope.console.rest.TodoRestClient;\n+import org.syncope.console.rest.ApprovalRestClient;\n+import org.syncope.console.rest.UserRequestRestClient;\n+import org.syncope.console.rest.UserRestClient;\n+import org.syncope.console.wicket.ajax.markup.html.IndicatingDeleteOnConfirmAjaxLink;\n import org.syncope.console.wicket.markup.html.form.LinkPanel;\n import org.syncope.console.wicket.extensions.markup.html.repeater.data.table.DatePropertyColumn;\n+import org.syncope.console.wicket.markup.html.form.DeleteLinkPanel;\n+import org.syncope.types.UserRequestType;\n \n public class Todo extends BasePage {\n \n     private static final long serialVersionUID = -7122136682275797903L;\n \n     @SpringBean\n-    private TodoRestClient restClient;\n+    private ApprovalRestClient approvalRestClient;\n \n-    private final ModalWindow editTodoWin;\n+    @SpringBean\n+    private UserRestClient userRestClient;\n+\n+    @SpringBean\n+    private UserRequestRestClient userRequestRestClient;\n+\n+    private final ModalWindow editApprovalWin;\n+\n+    private final ModalWindow editUserRequestWin;\n \n-    private static final int WIN_HEIGHT = 400;\n+    private static final int APPROVAL_WIN_HEIGHT = 400;\n \n-    private static final int WIN_WIDTH = 600;\n+    private static final int APPROVAL_WIN_WIDTH = 600;\n+\n+    private final static int USER_REQUEST_WIN_HEIGHT = 550;\n+\n+    private final static int USER_REQUESTL_WIN_WIDTH = 800;\n \n     @SpringBean\n     private PreferenceManager prefMan;\n \n-    private WebMarkupContainer container;\n+    private WebMarkupContainer approvalContainer;\n \n-    /**\n-     * Response flag set by the Modal Window after the operation\n-     * is completed.\n-     */\n-    private boolean operationResult = false;\n+    private WebMarkupContainer userRequestContainer;\n \n-    private int paginatorRows;\n+    private int approvalPaginatorRows;\n+\n+    private int userRequestPaginatorRows;\n \n     public Todo(final PageParameters parameters) {\n         super(parameters);\n \n-        container = new WebMarkupContainer(\"todoContainer\");\n+        add(editApprovalWin = new ModalWindow(\"editApprovalWin\"));\n+        add(editUserRequestWin = new ModalWindow(\"editUserRequestWin\"));\n+\n+        setupApproval();\n+        setupUserRequest();\n+    }\n \n-        add(editTodoWin = new ModalWindow(\"editTodoWin\"));\n+    private void setupApproval() {\n+        approvalContainer = new WebMarkupContainer(\"approvalContainer\");\n \n-        paginatorRows = prefMan.getPaginatorRows(getRequest(),\n-                Constants.PREF_TODO_PAGINATOR_ROWS);\n+        approvalPaginatorRows = prefMan.getPaginatorRows(getRequest(),\n+                Constants.PREF_APPROVAL_PAGINATOR_ROWS);\n \n         List<IColumn> columns = new ArrayList<IColumn>();\n         columns.add(new PropertyColumn(new ResourceModel(\"taskId\"),\n@@ -125,13 +146,13 @@ public void populateItem(\n                     @Override\n                     public void onClick(final AjaxRequestTarget target) {\n                         try {\n-                            restClient.claimForm(formTO.getTaskId());\n+                            approvalRestClient.claimForm(formTO.getTaskId());\n                             info(getString(\"operation_succeded\"));\n                         } catch (SyncopeClientCompositeErrorException scee) {\n                             error(getString(\"error\") + \":\" + scee.getMessage());\n                         }\n                         target.add(feedbackPanel);\n-                        target.add(container);\n+                        target.add(approvalContainer);\n                     }\n                 };\n \n@@ -141,7 +162,7 @@ public void onClick(final AjaxRequestTarget target) {\n                 panel.add(claimLink);\n \n                 MetaDataRoleAuthorizationStrategy.authorize(panel, ENABLE,\n-                        xmlRolesReader.getAllAllowedRoles(\"Todo\", \"claim\"));\n+                        xmlRolesReader.getAllAllowedRoles(\"Approval\", \"claim\"));\n \n                 cellItem.add(panel);\n             }\n@@ -169,18 +190,18 @@ public void populateItem(\n \n                         @Override\n                         public void onClick(final AjaxRequestTarget target) {\n-                            editTodoWin.setPageCreator(\n+                            editApprovalWin.setPageCreator(\n                                     new ModalWindow.PageCreator() {\n \n                                         @Override\n                                         public Page createPage() {\n-                                            return new TodoModalPage(\n+                                            return new ApprovalModalPage(\n                                                     Todo.this.getPageReference(),\n-                                                    editTodoWin, formTO);\n+                                                    editApprovalWin, formTO);\n                                         }\n                                     });\n \n-                            editTodoWin.show(target);\n+                            editApprovalWin.show(target);\n                         }\n                     };\n                     manageLink.add(new Label(\"linkTitle\", getString(\"manage\")));\n@@ -189,7 +210,8 @@ public Page createPage() {\n                     panel.add(manageLink);\n \n                     MetaDataRoleAuthorizationStrategy.authorize(panel, ENABLE,\n-                            xmlRolesReader.getAllAllowedRoles(\"Todo\", \"read\"));\n+                            xmlRolesReader.getAllAllowedRoles(\n+                            \"Approval\", \"read\"));\n \n                 } else {\n                     panel = new EmptyPanel(componentId);\n@@ -198,19 +220,19 @@ public Page createPage() {\n             }\n         });\n \n-        final AjaxFallbackDefaultDataTable todoTable =\n-                new AjaxFallbackDefaultDataTable(\"todoTable\", columns,\n-                new WorkflowFormProvider(), paginatorRows);\n+        final AjaxFallbackDefaultDataTable approvalTable =\n+                new AjaxFallbackDefaultDataTable(\"approvalTable\", columns,\n+                new ApprovalProvider(), approvalPaginatorRows);\n \n-        container.add(todoTable);\n-        container.setOutputMarkupId(true);\n+        approvalContainer.add(approvalTable);\n+        approvalContainer.setOutputMarkupId(true);\n \n-        add(container);\n+        add(approvalContainer);\n \n-        Form paginatorForm = new Form(\"paginatorForm\");\n+        Form approvalPaginatorForm = new Form(\"approvalPaginatorForm\");\n \n         final DropDownChoice rowsChooser = new DropDownChoice(\"rowsChooser\",\n-                new PropertyModel(this, \"paginatorRows\"),\n+                new PropertyModel(this, \"approvalPaginatorRows\"),\n                 prefMan.getPaginatorChoices());\n \n         rowsChooser.add(new AjaxFormComponentUpdatingBehavior(\"onchange\") {\n@@ -221,67 +243,210 @@ public Page createPage() {\n             protected void onUpdate(final AjaxRequestTarget target) {\n                 prefMan.set(getRequest(),\n                         getResponse(),\n-                        Constants.PREF_TODO_PAGINATOR_ROWS,\n-                        String.valueOf(paginatorRows));\n-                todoTable.setItemsPerPage(paginatorRows);\n+                        Constants.PREF_APPROVAL_PAGINATOR_ROWS,\n+                        String.valueOf(approvalPaginatorRows));\n+                approvalTable.setItemsPerPage(approvalPaginatorRows);\n \n-                target.add(container);\n+                target.add(approvalContainer);\n             }\n         });\n \n-        paginatorForm.add(rowsChooser);\n-        add(paginatorForm);\n+        approvalPaginatorForm.add(rowsChooser);\n+        add(approvalPaginatorForm);\n \n-        editTodoWin.setCssClassName(ModalWindow.CSS_CLASS_GRAY);\n-        editTodoWin.setInitialHeight(WIN_HEIGHT);\n-        editTodoWin.setInitialWidth(WIN_WIDTH);\n-        editTodoWin.setCookieName(\"edit-todo-modal\");\n+        editApprovalWin.setCssClassName(ModalWindow.CSS_CLASS_GRAY);\n+        editApprovalWin.setInitialHeight(APPROVAL_WIN_HEIGHT);\n+        editApprovalWin.setInitialWidth(APPROVAL_WIN_WIDTH);\n+        editApprovalWin.setCookieName(\"edit-approval-modal\");\n \n-        setWindowClosedCallback(editTodoWin, container);\n+        setWindowClosedCallback(editApprovalWin, approvalContainer);\n     }\n \n-    /**\n-     * Set a WindowClosedCallback for a ModalWindow instance.\n-     * @param window\n-     * @param container\n-     */\n-    private void setWindowClosedCallback(final ModalWindow window,\n-            final WebMarkupContainer container) {\n+    private void setupUserRequest() {\n+        userRequestContainer = new WebMarkupContainer(\"userRequestContainer\");\n \n-        window.setWindowClosedCallback(\n-                new ModalWindow.WindowClosedCallback() {\n+        userRequestPaginatorRows = prefMan.getPaginatorRows(getRequest(),\n+                Constants.PREF_USER_REQUEST_PAGINATOR_ROWS);\n+\n+        List<IColumn> columns = new ArrayList<IColumn>();\n+        columns.add(new PropertyColumn(new ResourceModel(\"id\"),\n+                \"id\", \"id\"));\n+        columns.add(new PropertyColumn(new ResourceModel(\"type\"),\n+                \"type\", \"type\"));\n+        columns.add(new UserRequestColumn(\"user\"));\n+        columns.add(new AbstractColumn<UserRequestTO>(\n+                new ResourceModel(\"manage\")) {\n+\n+            private static final long serialVersionUID = 2054811145491901166L;\n+\n+            @Override\n+            public void populateItem(\n+                    final Item<ICellPopulator<UserRequestTO>> cellItem,\n+                    final String componentId,\n+                    final IModel<UserRequestTO> model) {\n+\n+                AjaxLink manageLink = new IndicatingAjaxLink(\"link\") {\n \n                     private static final long serialVersionUID =\n-                            8804221891699487139L;\n+                            -7978723352517770644L;\n \n                     @Override\n-                    public void onClose(final AjaxRequestTarget target) {\n-                        target.add(container);\n-                        if (operationResult) {\n-                            info(getString(\"operation_succeded\"));\n-                            target.add(feedbackPanel);\n-                            operationResult = false;\n+                    public void onClick(final AjaxRequestTarget target) {\n+                        editUserRequestWin.setPageCreator(\n+                                new ModalWindow.PageCreator() {\n+\n+                                    @Override\n+                                    public Page createPage() {\n+                                        return new UserModalPage(\n+                                                Todo.this.getPageReference(),\n+                                                editUserRequestWin,\n+                                                model.getObject());\n+                                    }\n+                                });\n+\n+                        editUserRequestWin.show(target);\n+                    }\n+                };\n+\n+                AjaxLink deleteLink = new IndicatingDeleteOnConfirmAjaxLink(\n+                        \"link\") {\n+\n+                    private static final long serialVersionUID =\n+                            -7978723352517770644L;\n+\n+                    @Override\n+                    public void onClick(final AjaxRequestTarget target) {\n+                        try {\n+                            userRestClient.delete(\n+                                    model.getObject().getUserId());\n+                            userRequestRestClient.delete(\n+                                    model.getObject().getId());\n+                        } catch (SyncopeClientCompositeErrorException e) {\n+                            LOG.error(\"While deleting an user\", e);\n+                            error(e.getMessage());\n+                            return;\n+                        }\n+\n+                        info(getString(\"operation_succeded\"));\n+                        target.add(feedbackPanel);\n+\n+                        target.add(userRequestContainer);\n+                    }\n+                };\n+                MetaDataRoleAuthorizationStrategy.authorize(deleteLink, ENABLE,\n+                        xmlRolesReader.getAllAllowedRoles(\"Users\", \"delete\"));\n+\n+                AjaxLink link = model.getObject().getType()\n+                        == UserRequestType.DELETE ? deleteLink : manageLink;\n+                link.add(new Label(\"linkTitle\", getString(\"manage\")));\n+\n+                Panel panel = new LinkPanel(componentId);\n+                panel.add(link);\n+\n+                MetaDataRoleAuthorizationStrategy.authorize(panel, ENABLE,\n+                        xmlRolesReader.getAllAllowedRoles(\n+                        \"UserRequest\", \"read\"));\n+\n+                cellItem.add(panel);\n+            }\n+        });\n+        columns.add(new AbstractColumn<UserRequestTO>(\n+                new ResourceModel(\"delete\")) {\n+\n+            private static final long serialVersionUID = 2054811145491901166L;\n+\n+            @Override\n+            public void populateItem(\n+                    final Item<ICellPopulator<UserRequestTO>> cellItem,\n+                    final String componentId,\n+                    final IModel<UserRequestTO> model) {\n+\n+                final UserRequestTO request = model.getObject();\n+\n+                AjaxLink deleteLink = new IndicatingDeleteOnConfirmAjaxLink(\n+                        \"deleteLink\") {\n+\n+                    private static final long serialVersionUID =\n+                            -7978723352517770644L;\n+\n+                    @Override\n+                    public void onClick(final AjaxRequestTarget target) {\n+                        try {\n+                            userRequestRestClient.delete(request.getId());\n+                        } catch (SyncopeClientCompositeErrorException e) {\n+                            LOG.error(\"While deleting an user request\", e);\n+                            error(e.getMessage());\n+                            return;\n                         }\n+\n+                        info(getString(\"operation_succeded\"));\n+                        target.add(feedbackPanel);\n+\n+                        target.add(userRequestContainer);\n                     }\n-                });\n-    }\n+                };\n \n-    public boolean isOperationResult() {\n-        return operationResult;\n-    }\n+                DeleteLinkPanel panel = new DeleteLinkPanel(componentId, model);\n+                panel.add(deleteLink);\n \n-    public void setOperationResult(final boolean operationResult) {\n-        this.operationResult = operationResult;\n+                MetaDataRoleAuthorizationStrategy.authorize(panel, ENABLE,\n+                        xmlRolesReader.getAllAllowedRoles(\n+                        \"UserRequest\", \"delete\"));\n+\n+                cellItem.add(panel);\n+            }\n+        });\n+\n+        final AjaxFallbackDefaultDataTable userRequestTable =\n+                new AjaxFallbackDefaultDataTable(\"userRequestTable\", columns,\n+                new UserRequestProvider(), userRequestPaginatorRows);\n+\n+        userRequestContainer.add(userRequestTable);\n+        userRequestContainer.setOutputMarkupId(true);\n+\n+        add(userRequestContainer);\n+\n+        Form userRequestPaginatorForm = new Form(\"userRequestPaginatorForm\");\n+\n+        final DropDownChoice rowsChooser = new DropDownChoice(\"rowsChooser\",\n+                new PropertyModel(this, \"userRequestPaginatorRows\"),\n+                prefMan.getPaginatorChoices());\n+\n+        rowsChooser.add(new AjaxFormComponentUpdatingBehavior(\"onchange\") {\n+\n+            private static final long serialVersionUID = -1107858522700306810L;\n+\n+            @Override\n+            protected void onUpdate(final AjaxRequestTarget target) {\n+                prefMan.set(getRequest(),\n+                        getResponse(),\n+                        Constants.PREF_USER_REQUEST_PAGINATOR_ROWS,\n+                        String.valueOf(userRequestPaginatorRows));\n+                userRequestTable.setItemsPerPage(userRequestPaginatorRows);\n+\n+                target.add(userRequestContainer);\n+            }\n+        });\n+\n+        userRequestPaginatorForm.add(rowsChooser);\n+        add(userRequestPaginatorForm);\n+\n+        editUserRequestWin.setCssClassName(ModalWindow.CSS_CLASS_GRAY);\n+        editUserRequestWin.setInitialHeight(USER_REQUEST_WIN_HEIGHT);\n+        editUserRequestWin.setInitialWidth(USER_REQUESTL_WIN_WIDTH);\n+        editUserRequestWin.setCookieName(\"edit-userRequest-modal\");\n+\n+        setWindowClosedCallback(editUserRequestWin, userRequestContainer);\n     }\n \n-    private class WorkflowFormProvider\n+    private class ApprovalProvider\n             extends SortableDataProvider<WorkflowFormTO> {\n \n         private static final long serialVersionUID = -2311716167583335852L;\n \n         private SortableDataProviderComparator<WorkflowFormTO> comparator;\n \n-        public WorkflowFormProvider() {\n+        public ApprovalProvider() {\n             //Default sorting\n             setSort(\"key\", SortOrder.ASCENDING);\n             comparator =\n@@ -292,7 +457,7 @@ public WorkflowFormProvider() {\n         public Iterator<WorkflowFormTO> iterator(final int first,\n                 final int count) {\n \n-            List<WorkflowFormTO> list = getAllForms();\n+            List<WorkflowFormTO> list = approvalRestClient.getForms();\n \n             Collections.sort(list, comparator);\n \n@@ -301,7 +466,7 @@ public Iterator<WorkflowFormTO> iterator(final int first,\n \n         @Override\n         public int size() {\n-            return getAllForms().size();\n+            return approvalRestClient.getForms().size();\n         }\n \n         @Override\n@@ -319,16 +484,90 @@ public WorkflowFormTO getObject() {\n                 }\n             };\n         }\n+    }\n \n-        private List<WorkflowFormTO> getAllForms() {\n-            List<WorkflowFormTO> list = null;\n+    private class UserRequestProvider\n+            extends SortableDataProvider<UserRequestTO> {\n \n-            try {\n-                list = restClient.getForms();\n-            } catch (RestClientException rce) {\n-                throw rce;\n+        private static final long serialVersionUID = -2311716167583335852L;\n+\n+        private SortableDataProviderComparator<UserRequestTO> comparator;\n+\n+        public UserRequestProvider() {\n+            //Default sorting\n+            setSort(\"id\", SortOrder.ASCENDING);\n+            comparator =\n+                    new SortableDataProviderComparator<UserRequestTO>(this);\n+        }\n+\n+        @Override\n+        public Iterator<UserRequestTO> iterator(final int first,\n+                final int count) {\n+\n+            List<UserRequestTO> list = userRequestRestClient.list();\n+\n+            Collections.sort(list, comparator);\n+\n+            return list.subList(first, first + count).iterator();\n+        }\n+\n+        @Override\n+        public int size() {\n+            return userRequestRestClient.list().size();\n+        }\n+\n+        @Override\n+        public IModel<UserRequestTO> model(\n+                final UserRequestTO userRequestTO) {\n+\n+            return new AbstractReadOnlyModel<UserRequestTO>() {\n+\n+                private static final long serialVersionUID =\n+                        -2566070996511906708L;\n+\n+                @Override\n+                public UserRequestTO getObject() {\n+                    return userRequestTO;\n+                }\n+            };\n+        }\n+    }\n+\n+    private class UserRequestColumn extends AbstractColumn<UserRequestTO> {\n+\n+        private static final long serialVersionUID = 8077865338230121496L;\n+\n+        public UserRequestColumn(final String name) {\n+            super(new ResourceModel(name, name), name);\n+        }\n+\n+        @Override\n+        public void populateItem(\n+                final Item<ICellPopulator<UserRequestTO>> cellItem,\n+                final String componentId, final IModel<UserRequestTO> rowModel) {\n+\n+            String label = \"\";\n+            switch (rowModel.getObject().getType()) {\n+                case CREATE:\n+                    label = rowModel.getObject().getUserTO().getUsername();\n+                    if (label == null) {\n+                        label = getString(\"new_user\");\n+                    }\n+                    break;\n+\n+                case UPDATE:\n+                    label = String.valueOf(\n+                            rowModel.getObject().getUserMod().getId());\n+                    break;\n+\n+                case DELETE:\n+                    label = String.valueOf(rowModel.getObject().getUserId());\n+                    break;\n+\n+                default:\n             }\n-            return list;\n+\n+            cellItem.add(new Label(componentId, label));\n         }\n     }\n }"},{"sha":"f8f6ad100a73b297e43dfe81e1f6e9efbd0bb6e5","filename":"console/src/main/java/org/syncope/console/pages/UserModalPage.java","status":"modified","additions":111,"deletions":404,"changes":515,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/776d5712a156a40b4bcadff76761ccec2cbc5312/console%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fconsole%2Fpages%2FUserModalPage.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/776d5712a156a40b4bcadff76761ccec2cbc5312/console%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fconsole%2Fpages%2FUserModalPage.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/console%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fconsole%2Fpages%2FUserModalPage.java?ref=776d5712a156a40b4bcadff76761ccec2cbc5312","patch":"@@ -16,10 +16,6 @@\n  */\n package org.syncope.console.pages;\n \n-import java.util.ArrayList;\n-import java.util.HashSet;\n-import java.util.List;\n-import java.util.Set;\n import org.apache.wicket.PageReference;\n import org.apache.wicket.ajax.AjaxRequestTarget;\n import org.apache.wicket.ajax.markup.html.form.AjaxButton;\n@@ -31,19 +27,18 @@\n import org.apache.wicket.model.CompoundPropertyModel;\n import org.apache.wicket.model.ResourceModel;\n import org.apache.wicket.spring.injection.annot.SpringBean;\n-import org.syncope.client.mod.AttributeMod;\n-import org.syncope.client.mod.MembershipMod;\n import org.syncope.client.mod.UserMod;\n-import org.syncope.client.to.AttributeTO;\n-import org.syncope.client.to.MembershipTO;\n+import org.syncope.client.to.UserRequestTO;\n import org.syncope.client.to.UserTO;\n+import org.syncope.client.util.AttributableOperations;\n import org.syncope.client.validation.SyncopeClientCompositeErrorException;\n import org.syncope.console.pages.panels.AttributesPanel;\n import org.syncope.console.pages.panels.DerivedAttributesPanel;\n import org.syncope.console.pages.panels.ResourcesPanel;\n import org.syncope.console.pages.panels.RolesPanel;\n import org.syncope.console.pages.panels.UserDetailsPanel;\n import org.syncope.console.pages.panels.VirtualAttributesPanel;\n+import org.syncope.console.rest.UserRequestRestClient;\n import org.syncope.console.rest.UserRestClient;\n \n /**\n@@ -54,24 +49,85 @@ public class UserModalPage extends BaseModalPage {\n     private static final long serialVersionUID = 5002005009737457667L;\n \n     @SpringBean\n-    private UserRestClient userRestClient;\n+    private UserRestClient restClient;\n \n-    private UserTO oldUser;\n+    @SpringBean\n+    private UserRequestRestClient requestRestClient;\n+\n+    private final PageReference callerPageRef;\n+\n+    private final ModalWindow window;\n+\n+    private UserRequestTO userRequestTO;\n+\n+    private UserTO userTO;\n+\n+    private boolean self = false;\n \n-    private UserMod userMod;\n+    private UserTO initialUserTO;\n \n     public UserModalPage(final PageReference callerPageRef,\n-            final ModalWindow window, final UserTO userTO) {\n+            final ModalWindow window,\n+            final UserRequestTO userRequestTO) {\n \n         super();\n \n-        setBean(userTO);\n+        this.callerPageRef = callerPageRef;\n+        this.window = window;\n+        this.userRequestTO = userRequestTO;\n+\n+        setupModalPage();\n+    }\n+\n+    public UserModalPage(final PageReference callerPageRef,\n+            final ModalWindow window, final UserTO userTO,\n+            final boolean self) {\n+\n+        super();\n+\n+        this.callerPageRef = callerPageRef;\n+        this.window = window;\n+        this.userTO = userTO;\n+        this.self = self;\n+\n+        setupModalPage();\n+    }\n+\n+    public UserTO getUserTO() {\n+        return userTO;\n+    }\n+\n+    public void setUserTO(final UserTO userTO) {\n+        this.userTO = userTO;\n+    }\n+\n+    private void setupModalPage() {\n+        if (userRequestTO != null) {\n+            switch (userRequestTO.getType()) {\n+                case CREATE:\n+                    userTO = userRequestTO.getUserTO();\n+                    break;\n+\n+                case UPDATE:\n+                    initialUserTO = restClient.read(\n+                            userRequestTO.getUserMod().getId());\n+                    userTO = AttributableOperations.apply(\n+                            initialUserTO, userRequestTO.getUserMod());\n+                    break;\n+\n+                case DELETE:\n+                default:\n+            }\n+        }\n \n-        if (userTO.getId() > 0) {\n-            cloneOldUserTO(userTO);\n+        if (initialUserTO == null && userTO.getId() > 0) {\n+            initialUserTO = AttributableOperations.clone(userTO);\n         }\n \n-        add(new Label(\"id\", String.valueOf(userTO.getId())));\n+        add(new Label(\"id\", userTO.getId() == 0\n+                ? \"\" : userTO.getUsername()));\n+        add(new Label(\"new\", userTO.getId() == 0\n+                ? getString(\"new\") : \"\"));\n \n         final Form form = new Form(\"UserForm\");\n \n@@ -80,7 +136,8 @@ public UserModalPage(final PageReference callerPageRef,\n         //--------------------------------\n         // User details\n         //--------------------------------\n-        form.add(new UserDetailsPanel(\"details\", userTO, form));\n+        form.add(new UserDetailsPanel(\"details\", userTO, form,\n+                userRequestTO == null));\n         //--------------------------------\n \n         //--------------------------------\n@@ -122,22 +179,39 @@ public UserModalPage(final PageReference callerPageRef,\n             protected void onSubmit(final AjaxRequestTarget target,\n                     final Form form) {\n \n-                final UserTO userTO = (UserTO) form.getModelObject();\n-\n+                final UserTO updatedUserTO = (UserTO) form.getModelObject();\n                 try {\n-\n-                    if (userTO.getId() == 0) {\n-                        userRestClient.create(userTO);\n+                    if (updatedUserTO.getId() == 0) {\n+                        if (self) {\n+                            requestRestClient.requestCreate(updatedUserTO);\n+                        } else {\n+                            restClient.create(updatedUserTO);\n+                            if (userRequestTO != null) {\n+                                requestRestClient.delete(userRequestTO.getId());\n+                            }\n+                        }\n                     } else {\n-                        setupUserMod(userTO);\n-\n-                        //Update user just if it is changed\n-                        if (userMod != null) {\n-                            userRestClient.update(userMod);\n+                        UserMod userMod = AttributableOperations.diff(\n+                                updatedUserTO, initialUserTO);\n+\n+                        // update user just if it is changed\n+                        if (!userMod.isEmpty()) {\n+                            if (self) {\n+                                requestRestClient.requestUpdate(userMod);\n+                            } else {\n+                                restClient.update(userMod);\n+                                if (userRequestTO != null) {\n+                                    requestRestClient.delete(\n+                                            userRequestTO.getId());\n+                                }\n+                            }\n                         }\n                     }\n \n-                    ((BasePage) callerPageRef.getPage()).setModalResult(true);\n+                    if (callerPageRef.getPage() instanceof BasePage) {\n+                        ((BasePage) callerPageRef.getPage()).setModalResult(\n+                                true);\n+                    }\n \n                     window.close(target);\n                 } catch (SyncopeClientCompositeErrorException e) {\n@@ -148,390 +222,23 @@ protected void onSubmit(final AjaxRequestTarget target,\n             }\n \n             @Override\n-            protected void onError(AjaxRequestTarget target, Form form) {\n+            protected void onError(final AjaxRequestTarget target,\n+                    final Form form) {\n+\n                 target.add(feedbackPanel);\n             }\n         };\n \n-        String allowedRoles = null;\n-\n-        if (userTO.getId() == 0) {\n-            allowedRoles = xmlRolesReader.getAllAllowedRoles(\"Users\", \"create\");\n-        } else {\n-            allowedRoles = xmlRolesReader.getAllAllowedRoles(\"Users\", \"update\");\n+        if (!self) {\n+            String allowedRoles = userTO.getId() == 0\n+                    ? xmlRolesReader.getAllAllowedRoles(\"Users\", \"create\")\n+                    : xmlRolesReader.getAllAllowedRoles(\"Users\", \"update\");\n+            MetaDataRoleAuthorizationStrategy.authorize(\n+                    submit, RENDER, allowedRoles);\n         }\n \n-        MetaDataRoleAuthorizationStrategy.authorize(\n-                submit, RENDER, allowedRoles);\n-\n         form.add(submit);\n \n         add(form);\n     }\n-\n-    /**\n-     * Create a copy of old userTO object.\n-     * @param userTO the original TO\n-     */\n-    private void cloneOldUserTO(final UserTO userTO) {\n-        oldUser = new UserTO();\n-\n-        oldUser.setId(userTO.getId());\n-        oldUser.setPassword(userTO.getPassword());\n-\n-        List<AttributeTO> attributes = new ArrayList<AttributeTO>();\n-\n-        AttributeTO attributeTO;\n-        for (AttributeTO attribute : userTO.getAttributes()) {\n-            attributeTO = new AttributeTO();\n-            attributeTO.setReadonly(attribute.isReadonly());\n-\n-            attributeTO.setSchema(attribute.getSchema());\n-\n-            for (String value : attribute.getValues()) {\n-                attributeTO.addValue(value);\n-            }\n-\n-            attributes.add(attributeTO);\n-        }\n-\n-        oldUser.setAttributes(attributes);\n-\n-        attributes = new ArrayList<AttributeTO>();\n-\n-        for (AttributeTO attribute : userTO.getDerivedAttributes()) {\n-            attributeTO = new AttributeTO();\n-            attributeTO.setReadonly(attribute.isReadonly());\n-            attributeTO.setSchema(attribute.getSchema());\n-            attributes.add(attributeTO);\n-        }\n-\n-        oldUser.setDerivedAttributes(attributes);\n-\n-        attributes = new ArrayList<AttributeTO>();\n-\n-        for (AttributeTO attribute : userTO.getVirtualAttributes()) {\n-            attributeTO = new AttributeTO();\n-            attributeTO.setReadonly(attribute.isReadonly());\n-            attributeTO.setSchema(attribute.getSchema());\n-            attributes.add(attributeTO);\n-        }\n-\n-        oldUser.setVirtualAttributes(attributes);\n-\n-        for (String resource : userTO.getResources()) {\n-            oldUser.addResource(resource);\n-        }\n-\n-        MembershipTO membership;\n-\n-        for (MembershipTO membershipTO : userTO.getMemberships()) {\n-            membership = new MembershipTO();\n-            membership.setId(membershipTO.getId());\n-            membership.setRoleId(membershipTO.getRoleId());\n-            membership.setAttributes(membershipTO.getAttributes());\n-            membership.setVirtualAttributes(\n-                    membershipTO.getVirtualAttributes());\n-            membership.setDerivedAttributes(\n-                    membershipTO.getDerivedAttributes());\n-            oldUser.addMembership(membership);\n-        }\n-    }\n-\n-    /**\n-     * Updates the modified user object.\n-     * @param userTO\n-     */\n-    private void setupUserMod(final UserTO userTO) {\n-\n-        userMod = new UserMod();\n-\n-        //1.Check if the password has been changed and update it\n-        if (oldUser.getPassword() != null\n-                && !oldUser.getPassword().equals(userTO.getPassword())) {\n-            userMod.setPassword(userTO.getPassword());\n-        }\n-\n-        //2.Update user's schema derived attributes\n-        final List<AttributeTO> newDerivedAttributes =\n-                userTO.getDerivedAttributes();\n-\n-        final List<AttributeTO> oldDerivedAttributes =\n-                oldUser.getDerivedAttributes();\n-\n-        for (AttributeTO oldDerivedAttribute : oldDerivedAttributes) {\n-            userMod.addDerivedAttributeToBeRemoved(\n-                    oldDerivedAttribute.getSchema());\n-        }\n-\n-        for (AttributeTO newDerivedAttribute : newDerivedAttributes) {\n-            userMod.addDerivedAttributeToBeAdded(\n-                    newDerivedAttribute.getSchema());\n-        }\n-\n-        //3.Update user's schema virtual attributes\n-        final List<AttributeTO> newVirtualAttributes =\n-                userTO.getVirtualAttributes();\n-\n-        final List<AttributeTO> oldVirtualAttributes =\n-                oldUser.getVirtualAttributes();\n-\n-        for (AttributeTO oldVirtualAttribute : oldVirtualAttributes) {\n-            userMod.addVirtualAttributeToBeRemoved(\n-                    oldVirtualAttribute.getSchema());\n-        }\n-\n-        for (AttributeTO newVirtualAttribute : newVirtualAttributes) {\n-            userMod.addVirtualAttributeToBeAdded(\n-                    newVirtualAttribute.getSchema());\n-        }\n-\n-        //4.Update user's schema attributes\n-        for (AttributeTO attributeTO : userTO.getAttributes()) {\n-            searchAndUpdateAttribute(attributeTO);\n-        }\n-\n-        //5.Update user's resources\n-        for (String resource : userTO.getResources()) {\n-            searchAndAddResource(resource);\n-        }\n-\n-\n-        for (String resource : oldUser.getResources()) {\n-            searchAndDropResource(resource, userTO);\n-        }\n-\n-        //6.Update user's memberships\n-        for (MembershipTO membership : userTO.getMemberships()) {\n-            searchAndUpdateMembership(membership);\n-        }\n-\n-        for (MembershipTO membership : oldUser.getMemberships()) {\n-            searchAndDropMembership(membership, userTO);\n-        }\n-\n-        if (userMod != null) {\n-            userMod.setId(oldUser.getId());\n-        }\n-    }\n-\n-    private void searchAndUpdateAttribute(AttributeTO attributeTO) {\n-        boolean found = false;\n-        boolean changed = false;\n-\n-        AttributeMod attributeMod = new AttributeMod();\n-        attributeMod.setSchema(attributeTO.getSchema());\n-\n-        for (AttributeTO oldAttribute : oldUser.getAttributes()) {\n-            if (attributeTO.getSchema().equals(oldAttribute.getSchema())) {\n-\n-                if (!attributeTO.equals(oldAttribute) && !oldAttribute.\n-                        isReadonly()) {\n-\n-                    if (attributeTO.getValues().size() > 1) {\n-                        attributeMod.setValuesToBeAdded(\n-                                attributeTO.getValues());\n-                    } else {\n-                        attributeMod.addValueToBeAdded(\n-                                attributeTO.getValues().iterator().next());\n-                    }\n-\n-                    if (userMod == null) {\n-                        userMod = new UserMod();\n-                    }\n-\n-                    userMod.addAttributeToBeRemoved(oldAttribute.getSchema());\n-                    userMod.addAttributeToBeUpdated(attributeMod);\n-\n-                    changed = true;\n-                    break;\n-                }\n-                found = true;\n-            }\n-        }\n-\n-        if (!found & !changed && !attributeTO.isReadonly()\n-                && attributeTO.getValues() != null) {\n-\n-            if (attributeTO.getValues().iterator().next() != null) {\n-                attributeMod.setValuesToBeAdded(attributeTO.getValues());\n-\n-                if (userMod == null) {\n-                    userMod = new UserMod();\n-                }\n-\n-                userMod.addAttributeToBeUpdated(attributeMod);\n-            } else {\n-                attributeMod = null;\n-            }\n-        }\n-    }\n-\n-    /**\n-     * Search for a resource and add that one to the UserMod object if\n-     * it doesn't exist.\n-     * @param resource new resource added\n-     */\n-    private void searchAndAddResource(final String resource) {\n-        boolean found = false;\n-\n-        /* Check if the current resource was existent before the update\n-        and in this        case just ignore it */\n-        for (String oldResource : oldUser.getResources()) {\n-            if (resource.equals(oldResource)) {\n-                found = true;\n-            }\n-        }\n-\n-        if (!found) {\n-            if (userMod == null) {\n-                userMod = new UserMod();\n-            }\n-\n-            userMod.addResourceToBeAdded(resource);\n-        }\n-    }\n-\n-    /**\n-     * Search for a resource and drop that one from the UserMod object if\n-     * it doesn't exist anymore.\n-     * @param resource\n-     * @param userTO\n-     */\n-    private void searchAndDropResource(String resource, UserTO userTO) {\n-        boolean found = false;\n-\n-        /*Check if the current resource was existing before the update\n-        and in this case just ignore it */\n-        for (String newResource : userTO.getResources()) {\n-            if (resource.equals(newResource)) {\n-                found = true;\n-            }\n-        }\n-\n-        if (!found) {\n-            if (userMod == null) {\n-                userMod = new UserMod();\n-            }\n-            userMod.addResourceToBeRemoved(resource);\n-        }\n-    }\n-\n-    /**\n-     * Update the Membership.\n-     * @param new membershipTO\n-     */\n-    private void searchAndUpdateMembership(MembershipTO membership) {\n-        boolean found = false;\n-        boolean attrFound = false;\n-\n-        MembershipMod membershipMod = new MembershipMod();\n-        membershipMod.setRole(membership.getRoleId());\n-\n-        AttributeMod attributeMod;\n-\n-        //1. If the membership exists update it\n-        for (MembershipTO oldMembership : oldUser.getMemberships()) {\n-            if (membership.getRoleId() == oldMembership.getRoleId()) {\n-\n-                for (AttributeTO newDerivedAttribute :\n-                        membership.getDerivedAttributes()) {\n-                    membershipMod.addDerivedAttributeToBeAdded(\n-                            newDerivedAttribute.getSchema());\n-                }\n-\n-                for (AttributeTO newVirtualAttribute :\n-                        membership.getVirtualAttributes()) {\n-                    membershipMod.addVirtualAttributeToBeAdded(\n-                            newVirtualAttribute.getSchema());\n-                }\n-\n-                for (AttributeTO newAttribute : membership.getAttributes()) {\n-                    for (AttributeTO oldAttribute :\n-                            oldMembership.getAttributes()) {\n-\n-                        if (oldAttribute.getSchema().equals(\n-                                newAttribute.getSchema())) {\n-\n-                            attributeMod = new AttributeMod();\n-                            attributeMod.setSchema(newAttribute.getSchema());\n-\n-                            attributeMod.setValuesToBeAdded(\n-                                    newAttribute.getValues());\n-\n-                            membershipMod.addAttributeToBeUpdated(attributeMod);\n-                            attrFound = true;\n-                            break;\n-                        }\n-                    }\n-                    if (!attrFound) {\n-                        attributeMod = new AttributeMod();\n-                        attributeMod.setSchema(newAttribute.getSchema());\n-                        attributeMod.setValuesToBeAdded(\n-                                newAttribute.getValues());\n-                        membershipMod.addAttributeToBeUpdated(attributeMod);\n-                    }\n-                    attrFound = false;\n-                }\n-\n-                if (userMod == null) {\n-                    userMod = new UserMod();\n-                }\n-\n-                userMod.addMembershipToBeRemoved(oldMembership.getId());\n-                userMod.addMembershipToBeAdded(membershipMod);\n-\n-                found = true;\n-                break;\n-            }\n-        }\n-\n-        //2.Otherwise, if it doesn't exist, create it from scratch\n-        if (!found) {\n-            Set<AttributeMod> attributes = new HashSet<AttributeMod>();\n-\n-            for (AttributeTO newAttribute : membership.getAttributes()) {\n-                attributeMod = new AttributeMod();\n-                attributeMod.setSchema(newAttribute.getSchema());\n-                attributeMod.setValuesToBeAdded(newAttribute.getValues());\n-\n-                attributes.add(attributeMod);\n-            }\n-\n-            membershipMod.setAttributesToBeUpdated(attributes);\n-\n-            if (userMod == null) {\n-                userMod = new UserMod();\n-            }\n-\n-            userMod.addMembershipToBeAdded(membershipMod);\n-        }\n-    }\n-\n-    /**\n-     * Drop membership not present anymore.\n-     * @param membershipTO\n-     * @param userTO\n-     */\n-    private void searchAndDropMembership(final MembershipTO oldMembership,\n-            final UserTO userTO) {\n-\n-        boolean found = false;\n-\n-        /*Check if the current resource was existent before the update and\n-        in this case just ignore it*/\n-        for (MembershipTO newMembership : userTO.getMemberships()) {\n-            if (newMembership.getId() == oldMembership.getId()) {\n-                found = true;\n-            }\n-        }\n-\n-        if (!found) {\n-            if (userMod == null) {\n-                userMod = new UserMod();\n-            }\n-\n-            userMod.addMembershipToBeRemoved(oldMembership.getId());\n-        }\n-    }\n }"},{"sha":"7fe4b6ada70f37a8e8cb3cdd6b92ee4347a05f56","filename":"console/src/main/java/org/syncope/console/pages/Users.java","status":"modified","additions":2,"deletions":12,"changes":14,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/776d5712a156a40b4bcadff76761ccec2cbc5312/console%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fconsole%2Fpages%2FUsers.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/776d5712a156a40b4bcadff76761ccec2cbc5312/console%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fconsole%2Fpages%2FUsers.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/console%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fconsole%2Fpages%2FUsers.java?ref=776d5712a156a40b4bcadff76761ccec2cbc5312","patch":"@@ -40,8 +40,6 @@ public class Users extends BasePage {\n \n     private final static int EDIT_MODAL_WIN_WIDTH = 800;\n \n-    protected boolean modalResult = false;\n-\n     public Users(final PageParameters parameters) {\n         super(parameters);\n \n@@ -77,7 +75,7 @@ public void onClick(final AjaxRequestTarget target) {\n                     public Page createPage() {\n                         return new UserModalPage(\n                                 Users.this.getPageReference(),\n-                                editModalWin, new UserTO());\n+                                editModalWin, new UserTO(), false);\n                     }\n                 });\n \n@@ -105,7 +103,7 @@ public Page createPage() {\n             protected void onSubmit(final AjaxRequestTarget target,\n                     final Form<?> form) {\n \n-                    final NodeCond searchCond = searchPanel.buildSearchCond();\n+                final NodeCond searchCond = searchPanel.buildSearchCond();\n                 LOG.debug(\"Node condition \" + searchCond);\n \n                 doSearch(target, searchCond, searchResult);\n@@ -135,14 +133,6 @@ private void doSearch(final AjaxRequestTarget target,\n         resultsetPanel.search(searchCond, target);\n     }\n \n-    public void setModalResult(final boolean modalResult) {\n-        this.modalResult = modalResult;\n-    }\n-\n-    public boolean isModalResult() {\n-        return modalResult;\n-    }\n-\n     private void setWindowClosedReloadCallback(final ModalWindow window) {\n         window.setWindowClosedCallback(new ModalWindow.WindowClosedCallback() {\n "},{"sha":"032c52aef272477d65c5c4b982ebbe39e510e856","filename":"console/src/main/java/org/syncope/console/pages/VirtualSchemaModalPage.java","status":"modified","additions":1,"deletions":1,"changes":2,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/776d5712a156a40b4bcadff76761ccec2cbc5312/console%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fconsole%2Fpages%2FVirtualSchemaModalPage.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/776d5712a156a40b4bcadff76761ccec2cbc5312/console%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fconsole%2Fpages%2FVirtualSchemaModalPage.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/console%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fconsole%2Fpages%2FVirtualSchemaModalPage.java?ref=776d5712a156a40b4bcadff76761ccec2cbc5312","patch":"@@ -79,7 +79,7 @@ protected void onSubmit(AjaxRequestTarget target, Form form) {\n                 }\n \n                 Schema callerPage = (Schema) callerPageRef.getPage();\n-                callerPage.setOperationResult(true);\n+                callerPage.setModalResult(true);\n \n                 window.close(target);\n             }"},{"sha":"f67a5841231a9f7f457c7cb5e5f524d867407eaa","filename":"console/src/main/java/org/syncope/console/pages/panels/AttributesPanel.java","status":"modified","additions":9,"deletions":11,"changes":20,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/776d5712a156a40b4bcadff76761ccec2cbc5312/console%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fconsole%2Fpages%2Fpanels%2FAttributesPanel.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/776d5712a156a40b4bcadff76761ccec2cbc5312/console%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fconsole%2Fpages%2Fpanels%2FAttributesPanel.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/console%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fconsole%2Fpages%2Fpanels%2FAttributesPanel.java?ref=776d5712a156a40b4bcadff76761ccec2cbc5312","patch":"@@ -106,7 +106,7 @@ protected Map<String, SchemaTO> load() {\n             private static final long serialVersionUID = 9101744072914090143L;\n \n             @Override\n-            protected void populateItem(ListItem item) {\n+            protected void populateItem(final ListItem item) {\n                 final AttributeTO attributeTO =\n                         (AttributeTO) item.getDefaultModelObject();\n \n@@ -144,28 +144,26 @@ private List<AttributeTO> initEntityData(\n \n         final List<AttributeTO> entityData = new ArrayList<AttributeTO>();\n \n-        final Map<String, List<String>> attributeMap =\n-                entityTO.getAttributeMap();\n-\n-        AttributeTO attributeTO;\n-        List<String> values;\n+        final Map<String, AttributeTO> attrMap = entityTO.getAttributeMap();\n \n         for (SchemaTO schema : schemas) {\n-            attributeTO = new AttributeTO();\n+            AttributeTO attributeTO = new AttributeTO();\n             attributeTO.setSchema(schema.getName());\n \n-            if (attributeMap.get(schema.getName()) == null\n-                    || attributeMap.get(schema.getName()).isEmpty()) {\n+            if (attrMap.get(schema.getName()) == null\n+                    || attrMap.get(schema.getName()).\n+                    getValues().isEmpty()) {\n \n-                values = new ArrayList<String>();\n+                List<String> values = new ArrayList<String>();\n                 values.add(\"\");\n                 attributeTO.setValues(values);\n \n                 // is important to set readonly only after valus setting\n                 attributeTO.setReadonly(schema.isReadonly());\n \n             } else {\n-                attributeTO.setValues(attributeMap.get(schema.getName()));\n+                attributeTO.setValues(\n+                        attrMap.get(schema.getName()).getValues());\n             }\n             entityData.add(attributeTO);\n         }"},{"sha":"106b0a6f561dac2372f470217b148b8befd0c271","filename":"console/src/main/java/org/syncope/console/pages/panels/ResultSetPanel.java","status":"modified","additions":2,"deletions":1,"changes":3,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/776d5712a156a40b4bcadff76761ccec2cbc5312/console%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fconsole%2Fpages%2Fpanels%2FResultSetPanel.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/776d5712a156a40b4bcadff76761ccec2cbc5312/console%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fconsole%2Fpages%2Fpanels%2FResultSetPanel.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/console%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fconsole%2Fpages%2Fpanels%2FResultSetPanel.java?ref=776d5712a156a40b4bcadff76761ccec2cbc5312","patch":"@@ -420,7 +420,8 @@ public Page createPage() {\n                                         return new UserModalPage(\n                                                 page.getPageReference(),\n                                                 editmodal,\n-                                                model.getObject());\n+                                                model.getObject(),\n+                                                false);\n                                     }\n                                 });\n "},{"sha":"067abdab634bbf83b0f47c782224ba8ab834364e","filename":"console/src/main/java/org/syncope/console/pages/panels/RoleSummaryPanel.java","status":"modified","additions":1,"deletions":16,"changes":17,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/776d5712a156a40b4bcadff76761ccec2cbc5312/console%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fconsole%2Fpages%2Fpanels%2FRoleSummaryPanel.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/776d5712a156a40b4bcadff76761ccec2cbc5312/console%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fconsole%2Fpages%2Fpanels%2FRoleSummaryPanel.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/console%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fconsole%2Fpages%2Fpanels%2FRoleSummaryPanel.java?ref=776d5712a156a40b4bcadff76761ccec2cbc5312","patch":"@@ -21,11 +21,7 @@\n import org.apache.wicket.markup.html.panel.Fragment;\n import org.apache.wicket.markup.html.panel.Panel;\n import org.apache.wicket.model.CompoundPropertyModel;\n-import org.apache.wicket.spring.injection.annot.SpringBean;\n-import org.slf4j.Logger;\n-import org.slf4j.LoggerFactory;\n import org.syncope.client.to.RoleTO;\n-import org.syncope.console.rest.UserRestClient;\n import org.syncope.console.wicket.markup.html.tree.TreeActionLinkPanel;\n \n public class RoleSummaryPanel extends Panel {\n@@ -34,12 +30,6 @@ public class RoleSummaryPanel extends Panel {\n \n     private RoleTO selectedNode;\n \n-    protected static final Logger LOG = LoggerFactory.getLogger(\n-            RoleSummaryPanel.class);\n-\n-    @SpringBean\n-    private UserRestClient userRestClient;\n-\n     private Fragment fragment;\n \n     private RoleTabPanel roleTabPanel;\n@@ -132,14 +122,9 @@ public static class TreeNodeClickUpdate {\n \n         private RoleTO selectedNode;\n \n-        /**\n-         * Constructor\n-         *\n-         * @param target\n-         * @param selectedId\n-         */\n         public TreeNodeClickUpdate(final AjaxRequestTarget target,\n                 final RoleTO selectedNode) {\n+\n             this.target = target;\n             this.selectedNode = selectedNode;\n         }"},{"sha":"4084de0ae4e4cd63be9ed9c44ade26e979ee7f6a","filename":"console/src/main/java/org/syncope/console/pages/panels/RoleTabPanel.java","status":"modified","additions":3,"deletions":1,"changes":4,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/776d5712a156a40b4bcadff76761ccec2cbc5312/console%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fconsole%2Fpages%2Fpanels%2FRoleTabPanel.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/776d5712a156a40b4bcadff76761ccec2cbc5312/console%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fconsole%2Fpages%2Fpanels%2FRoleTabPanel.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/console%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fconsole%2Fpages%2Fpanels%2FRoleTabPanel.java?ref=776d5712a156a40b4bcadff76761ccec2cbc5312","patch":"@@ -34,8 +34,10 @@\n public class RoleTabPanel extends Panel {\n \n     private static final long serialVersionUID = 859236186975983959L;\n+\n     @SpringBean\n     protected XMLRolesReader xmlRolesReader;\n+\n     private RoleTO roleTO;\n \n     public RoleTabPanel(final String id, final RoleTO roleTO,\n@@ -62,7 +64,7 @@ public RoleTabPanel(final String id, final RoleTO roleTO,\n                 new RoleAttributesPanel(\"attributesPanel\", form, roleTO);\n \n         attributesPanel.setEnabled(false);\n-        \n+\n         form.add(attributesPanel);\n \n         final WebMarkupContainer userListContainer ="},{"sha":"498041568703d8ca4a6efee79f85517b525e7935","filename":"console/src/main/java/org/syncope/console/pages/panels/RolesPanel.java","status":"modified","additions":7,"deletions":8,"changes":15,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/776d5712a156a40b4bcadff76761ccec2cbc5312/console%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fconsole%2Fpages%2Fpanels%2FRolesPanel.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/776d5712a156a40b4bcadff76761ccec2cbc5312/console%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fconsole%2Fpages%2Fpanels%2FRolesPanel.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/console%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fconsole%2Fpages%2Fpanels%2FRolesPanel.java?ref=776d5712a156a40b4bcadff76761ccec2cbc5312","patch":"@@ -33,7 +33,6 @@\n import org.apache.wicket.model.Model;\n import org.apache.wicket.model.PropertyModel;\n import org.apache.wicket.spring.injection.annot.SpringBean;\n-import org.syncope.client.AbstractBaseBean;\n import org.syncope.client.to.MembershipTO;\n import org.syncope.client.to.RoleTO;\n import org.syncope.client.to.UserTO;\n@@ -84,8 +83,8 @@ protected IModel getNodeTextModel(final IModel model) {\n             protected void onNodeLinkClicked(final Object node,\n                     final BaseTree tree, final AjaxRequestTarget target) {\n \n-                final RoleTO roleTO =\n-                        (RoleTO) ((DefaultMutableTreeNode) node).getUserObject();\n+                final RoleTO roleTO = (RoleTO) ((DefaultMutableTreeNode) node).\n+                        getUserObject();\n \n                 membershipWin.setPageCreator(new ModalWindow.PageCreator() {\n \n@@ -136,7 +135,7 @@ protected void populateItem(final ListItem item) {\n                             -7978723352517770644L;\n \n                     @Override\n-                    public void onClick(AjaxRequestTarget target) {\n+                    public void onClick(final AjaxRequestTarget target) {\n                         membershipWin.setPageCreator(\n                                 new ModalWindow.PageCreator() {\n \n@@ -206,11 +205,11 @@ private void setWindowClosedCallback(\n \n                     @Override\n                     public void onClose(final AjaxRequestTarget target) {\n+                        final UserTO userTO =\n+                                ((UserModalPage) getPage()).getUserTO();\n \n-                        final AbstractBaseBean bean =\n-                                ((UserModalPage) getPage()).getBean();\n-\n-                        userTO.setMemberships(((UserTO) bean).getMemberships());\n+                        RolesPanel.this.userTO.setMemberships(\n+                                userTO.getMemberships());\n                         target.add(container);\n                     }\n                 });"},{"sha":"219b35eff833b6aafa263463bb69cf195b4009d5","filename":"console/src/main/java/org/syncope/console/pages/panels/UserDetailsPanel.java","status":"modified","additions":6,"deletions":9,"changes":15,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/776d5712a156a40b4bcadff76761ccec2cbc5312/console%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fconsole%2Fpages%2Fpanels%2FUserDetailsPanel.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/776d5712a156a40b4bcadff76761ccec2cbc5312/console%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fconsole%2Fpages%2Fpanels%2FUserDetailsPanel.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/console%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fconsole%2Fpages%2Fpanels%2FUserDetailsPanel.java?ref=776d5712a156a40b4bcadff76761ccec2cbc5312","patch":"@@ -24,8 +24,6 @@\n import org.apache.wicket.markup.html.panel.Panel;\n import org.apache.wicket.model.Model;\n import org.apache.wicket.model.PropertyModel;\n-import org.slf4j.Logger;\n-import org.slf4j.LoggerFactory;\n import org.syncope.client.to.AbstractAttributableTO;\n import org.syncope.client.to.UserTO;\n import org.syncope.console.wicket.markup.html.form.AjaxNumberFieldPanel;\n@@ -35,16 +33,14 @@\n \n public class UserDetailsPanel extends Panel {\n \n-    /**\n-     * Logger.\n-     */\n-    protected static final Logger LOG =\n-            LoggerFactory.getLogger(UserDetailsPanel.class);\n+    private static final long serialVersionUID = 6592027822510220463L;\n \n     public <T extends AbstractAttributableTO> UserDetailsPanel(\n             final String id,\n             final UserTO userTO,\n-            final Form form) {\n+            final Form form,\n+            final boolean resetPassword) {\n+\n         super(id);\n \n         // ------------------------\n@@ -70,7 +66,8 @@ public <T extends AbstractAttributableTO> UserDetailsPanel(\n                 true);\n \n         password.setRequired(userTO.getId() == 0);\n-        ((PasswordTextField) password.getField()).setResetPassword(true);\n+        ((PasswordTextField) password.getField()).setResetPassword(\n+                resetPassword);\n         add(password);\n \n         final WebMarkupContainer mandatoryPassword ="},{"sha":"748d35c4ff445ce28ac83dd28c89fd791d832aba","filename":"console/src/main/java/org/syncope/console/rest/ApprovalRestClient.java","status":"renamed","additions":1,"deletions":1,"changes":2,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/776d5712a156a40b4bcadff76761ccec2cbc5312/console%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fconsole%2Frest%2FApprovalRestClient.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/776d5712a156a40b4bcadff76761ccec2cbc5312/console%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fconsole%2Frest%2FApprovalRestClient.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/console%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fconsole%2Frest%2FApprovalRestClient.java?ref=776d5712a156a40b4bcadff76761ccec2cbc5312","patch":"@@ -23,7 +23,7 @@\n  * Console client for invoking Rest Todo services.\n  */\n @Component\n-public class TodoRestClient extends AbstractBaseRestClient {\n+public class ApprovalRestClient extends AbstractBaseRestClient {\n \n     public List<WorkflowFormTO> getForms() {\n         return Arrays.asList(restTemplate.getForObject(","previous_filename":"console/src/main/java/org/syncope/console/rest/TodoRestClient.java"},{"sha":"a413b6ef9b13239dc8f4f62fb3b7aca60bb83d0d","filename":"console/src/main/java/org/syncope/console/rest/UserRequestRestClient.java","status":"added","additions":55,"deletions":0,"changes":55,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/776d5712a156a40b4bcadff76761ccec2cbc5312/console%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fconsole%2Frest%2FUserRequestRestClient.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/776d5712a156a40b4bcadff76761ccec2cbc5312/console%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fconsole%2Frest%2FUserRequestRestClient.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/console%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fconsole%2Frest%2FUserRequestRestClient.java?ref=776d5712a156a40b4bcadff76761ccec2cbc5312","patch":"@@ -0,0 +1,55 @@\n+/*\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.syncope.console.rest;\n+\n+import java.util.Arrays;\n+import java.util.List;\n+import org.springframework.stereotype.Component;\n+import org.syncope.client.mod.UserMod;\n+import org.syncope.client.to.UserRequestTO;\n+import org.syncope.client.to.UserTO;\n+\n+@Component\n+public class UserRequestRestClient extends AbstractBaseRestClient {\n+\n+    public UserTO readProfile() {\n+        return restTemplate.getForObject(\n+                baseURL + \"user/request/read/self\", UserTO.class);\n+    }\n+\n+    public List<UserRequestTO> list() {\n+        return Arrays.asList(restTemplate.getForObject(\n+                baseURL + \"user/request/list\", UserRequestTO[].class));\n+    }\n+\n+    public void delete(final Long requestId) {\n+        restTemplate.delete(baseURL + \"user/request/deleteRequest/{requestId}\",\n+                requestId);\n+    }\n+\n+    public UserRequestTO requestCreate(final UserTO userTO) {\n+        return restTemplate.postForObject(baseURL + \"user/request/create\",\n+                userTO, UserRequestTO.class);\n+    }\n+\n+    public UserRequestTO requestUpdate(final UserMod userMod) {\n+        return restTemplate.postForObject(baseURL + \"user/request/update\",\n+                userMod, UserRequestTO.class);\n+    }\n+\n+    public UserRequestTO requestDelete(final Long userId) {\n+        return restTemplate.postForObject(baseURL + \"user/request/delete/\",\n+                userId, UserRequestTO.class);\n+    }\n+}"},{"sha":"d1eee1630b113eddb6bff51c2599375bff463f32","filename":"console/src/main/java/org/syncope/console/rest/UserRestClient.java","status":"modified","additions":1,"deletions":1,"changes":2,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/776d5712a156a40b4bcadff76761ccec2cbc5312/console%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fconsole%2Frest%2FUserRestClient.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/776d5712a156a40b4bcadff76761ccec2cbc5312/console%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fconsole%2Frest%2FUserRestClient.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/console%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fconsole%2Frest%2FUserRestClient.java?ref=776d5712a156a40b4bcadff76761ccec2cbc5312","patch":"@@ -73,7 +73,7 @@ public void delete(Long id) {\n         restTemplate.delete(baseURL + \"user/delete/{userId}\", id);\n     }\n \n-    public UserTO read(String id) {\n+    public UserTO read(Long id) {\n         UserTO userTO = null;\n         try {\n             userTO = restTemplate.getForObject("},{"sha":"153150b1296b252cd17c86e6c999efa8b92a3797","filename":"console/src/main/java/org/syncope/console/wicket/extensions/markup/html/repeater/data/table/UserAttrColumn.java","status":"modified","additions":4,"deletions":3,"changes":7,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/776d5712a156a40b4bcadff76761ccec2cbc5312/console%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fconsole%2Fwicket%2Fextensions%2Fmarkup%2Fhtml%2Frepeater%2Fdata%2Ftable%2FUserAttrColumn.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/776d5712a156a40b4bcadff76761ccec2cbc5312/console%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fconsole%2Fwicket%2Fextensions%2Fmarkup%2Fhtml%2Frepeater%2Fdata%2Ftable%2FUserAttrColumn.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/console%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fconsole%2Fwicket%2Fextensions%2Fmarkup%2Fhtml%2Frepeater%2Fdata%2Ftable%2FUserAttrColumn.java?ref=776d5712a156a40b4bcadff76761ccec2cbc5312","patch":"@@ -31,6 +31,7 @@ public enum SchemaType {\n         schema,\n         virtualSchema,\n         derivedSchema;\n+\n     };\n \n     private final String name;\n@@ -57,15 +58,15 @@ public void populateItem(\n         switch (schemaType) {\n             case schema:\n                 values = rowModel.getObject().getAttributeMap().\n-                        get(name);\n+                        get(name).getValues();\n                 break;\n             case virtualSchema:\n                 values = rowModel.getObject().getVirtualAttributeMap().\n-                        get(name);\n+                        get(name).getValues();\n                 break;\n             case derivedSchema:\n                 values = rowModel.getObject().getDerivedAttributeMap().\n-                        get(name);\n+                        get(name).getValues();\n                 break;\n             default:\n                 values = null;"},{"sha":"40a010d854618b7a20662c49c883d90afc1a51fb","filename":"console/src/main/java/org/syncope/console/wicket/markup/html/tree/TreeActionLinkPanel.java","status":"modified","additions":6,"deletions":5,"changes":11,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/776d5712a156a40b4bcadff76761ccec2cbc5312/console%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fconsole%2Fwicket%2Fmarkup%2Fhtml%2Ftree%2FTreeActionLinkPanel.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/776d5712a156a40b4bcadff76761ccec2cbc5312/console%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fconsole%2Fwicket%2Fmarkup%2Fhtml%2Ftree%2FTreeActionLinkPanel.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/console%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fconsole%2Fwicket%2Fmarkup%2Fhtml%2Ftree%2FTreeActionLinkPanel.java?ref=776d5712a156a40b4bcadff76761ccec2cbc5312","patch":"@@ -56,11 +56,12 @@ public class TreeActionLinkPanel extends Panel {\n \n     private Fragment fragment;\n \n-    public TreeActionLinkPanel(String id, final long idRole, IModel inputModel,\n-            final ModalWindow window, final PageReference callerPageRef) {\n+    public TreeActionLinkPanel(final String id, final long idRole,\n+            final IModel inputModel, final ModalWindow window,\n+            final PageReference callerPageRef) {\n \n         super(id);\n-        \n+\n         fragment = new Fragment(\"menuPanel\",\n                 idRole == 0 ? \"fakerootFrag\" : \"roleFrag\", this);\n \n@@ -80,7 +81,7 @@ public Page createPage() {\n                         RoleTO roleTO = new RoleTO();\n                         roleTO.setParent(idRole);\n                         RoleModalPage form = new RoleModalPage(callerPageRef,\n-                                window, roleTO, true);\n+                                window, roleTO);\n                         return form;\n                     }\n                 });\n@@ -111,7 +112,7 @@ public Page createPage() {\n                             RoleTO roleTO = restClient.readRole(idRole);\n                             RoleModalPage form =\n                                     new RoleModalPage(callerPageRef, window,\n-                                    roleTO, false);\n+                                    roleTO);\n                             return form;\n                         }\n                     });"},{"sha":"d2cfbbc13f6adc2ea2bb80840866159976e4792c","filename":"console/src/main/resources/authorizations.xml","status":"modified","additions":13,"deletions":13,"changes":26,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/776d5712a156a40b4bcadff76761ccec2cbc5312/console%2Fsrc%2Fmain%2Fresources%2Fauthorizations.xml","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/776d5712a156a40b4bcadff76761ccec2cbc5312/console%2Fsrc%2Fmain%2Fresources%2Fauthorizations.xml","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/console%2Fsrc%2Fmain%2Fresources%2Fauthorizations.xml?ref=776d5712a156a40b4bcadff76761ccec2cbc5312","patch":"@@ -19,10 +19,6 @@ page@id= Schema|Users|Roles|Resources|Connectors|Report|Configuration|Task\n -->\n <auth>\n     <page id=\"Schema\">\n-        <action id=\"list\">\n-            <entitlement>SCHEMA_LIST</entitlement>\n-        </action>\n-\n         <action id=\"create\">\n             <entitlement>SCHEMA_CREATE</entitlement>\n         </action>\n@@ -67,10 +63,6 @@ page@id= Schema|Users|Roles|Resources|Connectors|Report|Configuration|Task\n     </page>\n \n     <page id=\"Roles\">\n-        <action id=\"list\">\n-            <entitlement>ROLE_LIST</entitlement>\n-        </action>\n-\n         <action id=\"create\">\n             <entitlement>ROLE_CREATE</entitlement>\n         </action>\n@@ -89,10 +81,6 @@ page@id= Schema|Users|Roles|Resources|Connectors|Report|Configuration|Task\n     </page>\n \n     <page id=\"Resources\">\n-        <action id=\"list\">\n-            <entitlement>RESOURCE_LIST</entitlement>\n-        </action>\n-\n         <action id=\"create\">\n             <entitlement>RESOURCE_CREATE</entitlement>\n         </action>\n@@ -142,7 +130,7 @@ page@id= Schema|Users|Roles|Resources|Connectors|Report|Configuration|Task\n \n     </page>\n \n-    <page id=\"Todo\">\n+    <page id=\"Approval\">\n         <action id=\"list\">\n             <entitlement>WORKFLOW_FORM_LIST</entitlement>\n         </action>\n@@ -157,6 +145,18 @@ page@id= Schema|Users|Roles|Resources|Connectors|Report|Configuration|Task\n         </action>\n     </page>\n     \n+    <page id=\"UserRequest\">\n+        <action id=\"list\">\n+            <entitlement>USER_REQUEST_LIST</entitlement>\n+        </action>\n+        <action id=\"read\">\n+            <entitlement>USER_REQUEST_READ</entitlement>\n+        </action>\n+        <action id=\"delete\">\n+            <entitlement>USER_REQUEST_DELETE</entitlement>\n+        </action>\n+    </page>\n+    \n     <page id=\"Configuration\">\n         <action id=\"list\">\n             <entitlement>CONFIGURATION_LIST</entitlement>"},{"sha":"163f8c5203074856aeaf453fc2a7399d988c55a9","filename":"console/src/main/resources/org/syncope/console/pages/ApprovalModalPage.html","status":"renamed","additions":0,"deletions":0,"changes":0,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/776d5712a156a40b4bcadff76761ccec2cbc5312/console%2Fsrc%2Fmain%2Fresources%2Forg%2Fsyncope%2Fconsole%2Fpages%2FApprovalModalPage.html","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/776d5712a156a40b4bcadff76761ccec2cbc5312/console%2Fsrc%2Fmain%2Fresources%2Forg%2Fsyncope%2Fconsole%2Fpages%2FApprovalModalPage.html","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/console%2Fsrc%2Fmain%2Fresources%2Forg%2Fsyncope%2Fconsole%2Fpages%2FApprovalModalPage.html?ref=776d5712a156a40b4bcadff76761ccec2cbc5312","previous_filename":"console/src/main/resources/org/syncope/console/pages/TodoModalPage.html"},{"sha":"f11cd896c40a3c23befcf28f85592e87d95f4680","filename":"console/src/main/resources/org/syncope/console/pages/ApprovalModalPage.properties","status":"renamed","additions":0,"deletions":0,"changes":0,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/776d5712a156a40b4bcadff76761ccec2cbc5312/console%2Fsrc%2Fmain%2Fresources%2Forg%2Fsyncope%2Fconsole%2Fpages%2FApprovalModalPage.properties","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/776d5712a156a40b4bcadff76761ccec2cbc5312/console%2Fsrc%2Fmain%2Fresources%2Forg%2Fsyncope%2Fconsole%2Fpages%2FApprovalModalPage.properties","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/console%2Fsrc%2Fmain%2Fresources%2Forg%2Fsyncope%2Fconsole%2Fpages%2FApprovalModalPage.properties?ref=776d5712a156a40b4bcadff76761ccec2cbc5312","previous_filename":"console/src/main/resources/org/syncope/console/pages/TodoModalPage.properties"},{"sha":"ab91c0fefc6b091658b972dbebe9947783b08cb4","filename":"console/src/main/resources/org/syncope/console/pages/ApprovalModalPage_it.properties","status":"renamed","additions":0,"deletions":0,"changes":0,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/776d5712a156a40b4bcadff76761ccec2cbc5312/console%2Fsrc%2Fmain%2Fresources%2Forg%2Fsyncope%2Fconsole%2Fpages%2FApprovalModalPage_it.properties","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/776d5712a156a40b4bcadff76761ccec2cbc5312/console%2Fsrc%2Fmain%2Fresources%2Forg%2Fsyncope%2Fconsole%2Fpages%2FApprovalModalPage_it.properties","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/console%2Fsrc%2Fmain%2Fresources%2Forg%2Fsyncope%2Fconsole%2Fpages%2FApprovalModalPage_it.properties?ref=776d5712a156a40b4bcadff76761ccec2cbc5312","previous_filename":"console/src/main/resources/org/syncope/console/pages/TodoModalPage_it.properties"},{"sha":"72ffe0c459af61cb2f18e0e2caa698f3276b14af","filename":"console/src/main/resources/org/syncope/console/pages/BaseModalPage_it.properties","status":"modified","additions":1,"deletions":1,"changes":2,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/776d5712a156a40b4bcadff76761ccec2cbc5312/console%2Fsrc%2Fmain%2Fresources%2Forg%2Fsyncope%2Fconsole%2Fpages%2FBaseModalPage_it.properties","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/776d5712a156a40b4bcadff76761ccec2cbc5312/console%2Fsrc%2Fmain%2Fresources%2Forg%2Fsyncope%2Fconsole%2Fpages%2FBaseModalPage_it.properties","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/console%2Fsrc%2Fmain%2Fresources%2Forg%2Fsyncope%2Fconsole%2Fpages%2FBaseModalPage_it.properties?ref=776d5712a156a40b4bcadff76761ccec2cbc5312","patch":"@@ -2,4 +2,4 @@ submit=Salva\n add=Aggiungi\n remove=Elimina\n error=Errore\n-generic_error=Si \\u00E8 verificato un errore durante l'operazione\n+generic_error=Si \\u00e8 verificato un errore durante l'operazione"},{"sha":"d282866432eb73df3981a9b5bbbfdc24259455f5","filename":"console/src/main/resources/org/syncope/console/pages/BasePage.html","status":"modified","additions":22,"deletions":6,"changes":28,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/776d5712a156a40b4bcadff76761ccec2cbc5312/console%2Fsrc%2Fmain%2Fresources%2Forg%2Fsyncope%2Fconsole%2Fpages%2FBasePage.html","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/776d5712a156a40b4bcadff76761ccec2cbc5312/console%2Fsrc%2Fmain%2Fresources%2Forg%2Fsyncope%2Fconsole%2Fpages%2FBasePage.html","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/console%2Fsrc%2Fmain%2Fresources%2Forg%2Fsyncope%2Fconsole%2Fpages%2FBasePage.html?ref=776d5712a156a40b4bcadff76761ccec2cbc5312","patch":"@@ -43,7 +43,7 @@\n                 $(\"#role\").tabs();\n                 $(\"#membership\").tabs();\n             });\n-\n+                \n             /** Add rollover effect to tables supporting Ajax events (live)*/\n             $('table.ui-widget.ui-widget-content.table-hover tbody tr')\n             .live('mouseover mouseout', function(event) {\n@@ -53,8 +53,14 @@\n                     $(this).removeClass('selectedRow');\n                 }\n             });\n+            \n+            $(document).ready(function() {\n+                $(\"#editProfile\").hide();\n+                $(\"#username\").click(function() {\n+                    $(\"#editProfile\").toggle();\n+                });\n+            });\n         </script>\n-\n     </head>\n     <body>\n         <div id=\"navigationPane\">\n@@ -113,12 +119,22 @@\n                             <wicket:message key=\"configuration\"/>\n                         </a></span>\n                 </li>\n-                <li style=\"float:right\">\n-                    <a href=\"#\" wicket:id=\"logout\"><img src=\"img/menu/notsel/logout.png\" alt=\"Logout\" width=\"80\" height=\"80\" /><br />\n-                        <wicket:message key=\"logout\"/>\n-                    </a>\n+                <li style=\"float:right;width:auto;text-align:right;\">\n+                    <a href=\"#\" wicket:id=\"logout\"><img src=\"img/menu/notsel/logout.png\" alt=\"Logout\" width=\"80\" height=\"80\" /><br /></a>\n+                    <div>\n+                        <span id=\"username\" wicket:id=\"username\" style=\"padding-right: 9px;cursor: pointer;\"/>\n+                        <span wicket:id=\"editProfile\"/>\n+\n+                        <wicket:fragment wicket:id=\"adminEmptyFrag\"/>\n+                        <wicket:fragment wicket:id=\"editProfileFrag\">\n+                            <br/>\n+                            <span id=\"editProfile\" wicket:id=\"editProfile\" \n+                                  style=\"cursor: pointer;background-color: #446633;padding-left: 9px;padding-right: 9px;\"/>\n+                        </wicket:fragment>\n+                    </div>\n                 </li>\n             </ul>\n+            <div wicket:id=\"editProfileModal\" ></div>\n         </div>\n \n         <div wicket:id=\"feedback\"/>"},{"sha":"6853d8356746f12a1aa684358e86d6242e7d7266","filename":"console/src/main/resources/org/syncope/console/pages/BasePage.properties","status":"modified","additions":1,"deletions":0,"changes":1,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/776d5712a156a40b4bcadff76761ccec2cbc5312/console%2Fsrc%2Fmain%2Fresources%2Forg%2Fsyncope%2Fconsole%2Fpages%2FBasePage.properties","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/776d5712a156a40b4bcadff76761ccec2cbc5312/console%2Fsrc%2Fmain%2Fresources%2Forg%2Fsyncope%2Fconsole%2Fpages%2FBasePage.properties","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/console%2Fsrc%2Fmain%2Fresources%2Forg%2Fsyncope%2Fconsole%2Fpages%2FBasePage.properties?ref=776d5712a156a40b4bcadff76761ccec2cbc5312","patch":"@@ -1,2 +1,3 @@\n displayRows=Rows to display:\n home=Home\n+editProfile=Edit profile"},{"sha":"e435ea2e785421ea303e4466919eed0a389c60ea","filename":"console/src/main/resources/org/syncope/console/pages/BasePage_it.properties","status":"modified","additions":1,"deletions":0,"changes":1,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/776d5712a156a40b4bcadff76761ccec2cbc5312/console%2Fsrc%2Fmain%2Fresources%2Forg%2Fsyncope%2Fconsole%2Fpages%2FBasePage_it.properties","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/776d5712a156a40b4bcadff76761ccec2cbc5312/console%2Fsrc%2Fmain%2Fresources%2Forg%2Fsyncope%2Fconsole%2Fpages%2FBasePage_it.properties","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/console%2Fsrc%2Fmain%2Fresources%2Forg%2Fsyncope%2Fconsole%2Fpages%2FBasePage_it.properties?ref=776d5712a156a40b4bcadff76761ccec2cbc5312","patch":"@@ -1,2 +1,3 @@\n displayRows=Righe per pagina:\n home=Home\n+editProfile=Modifica profile"},{"sha":"5f30e13689a22bf604422d211d19e0cd3a39dd83","filename":"console/src/main/resources/org/syncope/console/pages/Configuration_it.properties","status":"modified","additions":1,"deletions":1,"changes":2,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/776d5712a156a40b4bcadff76761ccec2cbc5312/console%2Fsrc%2Fmain%2Fresources%2Forg%2Fsyncope%2Fconsole%2Fpages%2FConfiguration_it.properties","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/776d5712a156a40b4bcadff76761ccec2cbc5312/console%2Fsrc%2Fmain%2Fresources%2Forg%2Fsyncope%2Fconsole%2Fpages%2FConfiguration_it.properties","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/console%2Fsrc%2Fmain%2Fresources%2Forg%2Fsyncope%2Fconsole%2Fpages%2FConfiguration_it.properties?ref=776d5712a156a40b4bcadff76761ccec2cbc5312","patch":"@@ -9,7 +9,7 @@ tab6=Workflow\n tab7=Log Core\n tab8=Log Console\n edit=Modifica\n-delete=Elimina\n+delete=Rimuovi\n create_configuration=Crea nuova configurazione\n db_export=Esportazione DB\n logger=Logger"},{"sha":"6e33d69041c5aa6fb39e58321f66ef26ad7d5861","filename":"console/src/main/resources/org/syncope/console/pages/DisplayAttributesModalPage_it.properties","status":"modified","additions":5,"deletions":5,"changes":10,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/776d5712a156a40b4bcadff76761ccec2cbc5312/console%2Fsrc%2Fmain%2Fresources%2Forg%2Fsyncope%2Fconsole%2Fpages%2FDisplayAttributesModalPage_it.properties","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/776d5712a156a40b4bcadff76761ccec2cbc5312/console%2Fsrc%2Fmain%2Fresources%2Forg%2Fsyncope%2Fconsole%2Fpages%2FDisplayAttributesModalPage_it.properties","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/console%2Fsrc%2Fmain%2Fresources%2Forg%2Fsyncope%2Fconsole%2Fpages%2FDisplayAttributesModalPage_it.properties?ref=776d5712a156a40b4bcadff76761ccec2cbc5312","patch":"@@ -4,15 +4,15 @@ schemas=Attributi utente\n derSchemas=Attributi derivati utente\n virSchemas=Attributi virtuali utente\n \n-firstname=Firstname\n-surname=Surname\n+firstname=Nome\n+surname=Cognome\n userId=User Id\n edit=Edit\n-delete=Delete\n+delete=Rimuovi\n id=Id\n status=Stato\n token=Token\n username=Username\n creationDate=Data Creazione\n-tokenValued=Valued\n-tokenNotValued=Not valuedF\n\\ No newline at end of file\n+tokenValued=Valorizzato\n+tokenNotValued=Non valorizzato"},{"sha":"9c585e7d591a7d2b4c5d5f4f26eb5a378eae85bf","filename":"console/src/main/resources/org/syncope/console/pages/Login.html","status":"modified","additions":10,"deletions":1,"changes":11,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/776d5712a156a40b4bcadff76761ccec2cbc5312/console%2Fsrc%2Fmain%2Fresources%2Forg%2Fsyncope%2Fconsole%2Fpages%2FLogin.html","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/776d5712a156a40b4bcadff76761ccec2cbc5312/console%2Fsrc%2Fmain%2Fresources%2Forg%2Fsyncope%2Fconsole%2Fpages%2FLogin.html","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/console%2Fsrc%2Fmain%2Fresources%2Forg%2Fsyncope%2Fconsole%2Fpages%2FLogin.html?ref=776d5712a156a40b4bcadff76761ccec2cbc5312","patch":"@@ -30,7 +30,7 @@\n             <!--h2><wicket:message key=\"title\"/></h2-->\n             <p>&nbsp;</p>\n             <div id=\"feedbackDiv\">\n-            <span wicket:id=\"feedback\">feedbackmessages will be put here</span>\n+                <span wicket:id=\"feedback\">feedbackmessages will be put here</span>\n             </div>\n             <form wicket:id=\"login\">\n                 <label for=\"userId\">\n@@ -48,6 +48,15 @@\n                 <br />\n                 <input type=\"submit\" wicket:id=\"submit\"/>\n             </form>\n+\n+            <span wicket:id=\"selfRegistration\"/>\n+\n+            <wicket:fragment wicket:id=\"selfRegNotAllowed\"/>\n+            <wicket:fragment wicket:id=\"selfRegAllowed\">\n+                <span wicket:id=\"selfRegistration\"/>\n+            </wicket:fragment>\n+\n+            <div wicket:id=\"selfRegModal\"></div>\n         </div>\n     </body>\n </html>\n\\ No newline at end of file"},{"sha":"dbc86479783e96b541af0a77eccc097dda04018e","filename":"console/src/main/resources/org/syncope/console/pages/Login.properties","status":"modified","additions":1,"deletions":0,"changes":1,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/776d5712a156a40b4bcadff76761ccec2cbc5312/console%2Fsrc%2Fmain%2Fresources%2Forg%2Fsyncope%2Fconsole%2Fpages%2FLogin.properties","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/776d5712a156a40b4bcadff76761ccec2cbc5312/console%2Fsrc%2Fmain%2Fresources%2Forg%2Fsyncope%2Fconsole%2Fpages%2FLogin.properties","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/console%2Fsrc%2Fmain%2Fresources%2Forg%2Fsyncope%2Fconsole%2Fpages%2FLogin.properties?ref=776d5712a156a40b4bcadff76761ccec2cbc5312","patch":"@@ -2,3 +2,4 @@ userId=User id\n password=Password\n submit=Login\n login-error=Wrong user id and/or password\n+selfRegistration=Self registration"},{"sha":"c86c3caf90ea64a4a1ad4e7b498bb740d7fb167f","filename":"console/src/main/resources/org/syncope/console/pages/Login_it.properties","status":"modified","additions":1,"deletions":0,"changes":1,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/776d5712a156a40b4bcadff76761ccec2cbc5312/console%2Fsrc%2Fmain%2Fresources%2Forg%2Fsyncope%2Fconsole%2Fpages%2FLogin_it.properties","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/776d5712a156a40b4bcadff76761ccec2cbc5312/console%2Fsrc%2Fmain%2Fresources%2Forg%2Fsyncope%2Fconsole%2Fpages%2FLogin_it.properties","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/console%2Fsrc%2Fmain%2Fresources%2Forg%2Fsyncope%2Fconsole%2Fpages%2FLogin_it.properties?ref=776d5712a156a40b4bcadff76761ccec2cbc5312","patch":"@@ -2,3 +2,4 @@ userId=Id utente\n password=Password\n submit=Login\n login-error=Id utente e/o password errate\n+selfRegistration=Registrati"},{"sha":"e322b1dc20df6306ceaee0fab9f86ffd9fd6c2b7","filename":"console/src/main/resources/org/syncope/console/pages/MembershipModalPage_it.properties","status":"modified","additions":1,"deletions":1,"changes":2,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/776d5712a156a40b4bcadff76761ccec2cbc5312/console%2Fsrc%2Fmain%2Fresources%2Forg%2Fsyncope%2Fconsole%2Fpages%2FMembershipModalPage_it.properties","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/776d5712a156a40b4bcadff76761ccec2cbc5312/console%2Fsrc%2Fmain%2Fresources%2Forg%2Fsyncope%2Fconsole%2Fpages%2FMembershipModalPage_it.properties","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/console%2Fsrc%2Fmain%2Fresources%2Forg%2Fsyncope%2Fconsole%2Fpages%2FMembershipModalPage_it.properties?ref=776d5712a156a40b4bcadff76761ccec2cbc5312","patch":"@@ -5,7 +5,7 @@ title=Ruoli\n add=+\n drop=-\n edit=Edit\n-delete=Delete\n+delete=Rimuovi\n derivedAttributes=Attributi derivati\n derivedAttributeToBeRemoved=Elimina\n derivedAttributeName=Nome"},{"sha":"681c48a2e37c0b796528a39887cfd1c78fd411da","filename":"console/src/main/resources/org/syncope/console/pages/NotificationTaskModalPage_it.properties","status":"modified","additions":1,"deletions":1,"changes":2,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/776d5712a156a40b4bcadff76761ccec2cbc5312/console%2Fsrc%2Fmain%2Fresources%2Forg%2Fsyncope%2Fconsole%2Fpages%2FNotificationTaskModalPage_it.properties","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/776d5712a156a40b4bcadff76761ccec2cbc5312/console%2Fsrc%2Fmain%2Fresources%2Forg%2Fsyncope%2Fconsole%2Fpages%2FNotificationTaskModalPage_it.properties","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/console%2Fsrc%2Fmain%2Fresources%2Forg%2Fsyncope%2Fconsole%2Fpages%2FNotificationTaskModalPage_it.properties?ref=776d5712a156a40b4bcadff76761ccec2cbc5312","patch":"@@ -7,7 +7,7 @@ endDate=Data di conclusione\n status=Stato\n message=Messaggio\n taskExecutions=Esecuzione del task\n-delete=Eliminazione\n+delete=Rimozione\n showMessage=Mostra\n sender=Mittente\n subject=Oggetto"},{"sha":"574b678a9ba44fcbbe50d745b56f66d6fbd0dec5","filename":"console/src/main/resources/org/syncope/console/pages/PropagationTaskModalPage_it.properties","status":"modified","additions":1,"deletions":1,"changes":2,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/776d5712a156a40b4bcadff76761ccec2cbc5312/console%2Fsrc%2Fmain%2Fresources%2Forg%2Fsyncope%2Fconsole%2Fpages%2FPropagationTaskModalPage_it.properties","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/776d5712a156a40b4bcadff76761ccec2cbc5312/console%2Fsrc%2Fmain%2Fresources%2Forg%2Fsyncope%2Fconsole%2Fpages%2FPropagationTaskModalPage_it.properties","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/console%2Fsrc%2Fmain%2Fresources%2Forg%2Fsyncope%2Fconsole%2Fpages%2FPropagationTaskModalPage_it.properties?ref=776d5712a156a40b4bcadff76761ccec2cbc5312","patch":"@@ -9,5 +9,5 @@ endDate=Data di conclusione\n status=Stato\n message=Messaggio\n taskExecutions=Esecuzione del task\n-delete=Eliminazione\n+delete=Rimozione\n showMessage=Mostra"},{"sha":"53706c733ab3463934d0568d485fee37e9c3646f","filename":"console/src/main/resources/org/syncope/console/pages/ResourceModalPage_it.properties","status":"modified","additions":1,"deletions":1,"changes":2,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/776d5712a156a40b4bcadff76761ccec2cbc5312/console%2Fsrc%2Fmain%2Fresources%2Forg%2Fsyncope%2Fconsole%2Fpages%2FResourceModalPage_it.properties","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/776d5712a156a40b4bcadff76761ccec2cbc5312/console%2Fsrc%2Fmain%2Fresources%2Forg%2Fsyncope%2Fconsole%2Fpages%2FResourceModalPage_it.properties","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/console%2Fsrc%2Fmain%2Fresources%2Forg%2Fsyncope%2Fconsole%2Fpages%2FResourceModalPage_it.properties?ref=776d5712a156a40b4bcadff76761ccec2cbc5312","patch":"@@ -19,7 +19,7 @@ mandatoryCondition=Condizione d'obbligatoriet\\u00e0\n password=Password\n mappingUserSchema=Mapping User Schema\n mappingRoleSchema=Mapping Role Schema\n-delete=Elimina\n+delete=Rimuovi\n intAttrNames=Attributi interni\n forceMandatoryConstraint=Forza mandatory constraint\n fieldName=Nome campo"},{"sha":"9ac4363fb33c04907911685cf29e47d02bcebe19","filename":"console/src/main/resources/org/syncope/console/pages/Resources_it.properties","status":"modified","additions":1,"deletions":1,"changes":2,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/776d5712a156a40b4bcadff76761ccec2cbc5312/console%2Fsrc%2Fmain%2Fresources%2Forg%2Fsyncope%2Fconsole%2Fpages%2FResources_it.properties","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/776d5712a156a40b4bcadff76761ccec2cbc5312/console%2Fsrc%2Fmain%2Fresources%2Forg%2Fsyncope%2Fconsole%2Fpages%2FResources_it.properties","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/console%2Fsrc%2Fmain%2Fresources%2Forg%2Fsyncope%2Fconsole%2Fpages%2FResources_it.properties?ref=776d5712a156a40b4bcadff76761ccec2cbc5312","patch":"@@ -1,7 +1,7 @@\n tab1=Risorse\n name=Nome\n edit=Modifica\n-delete=Elimina\n+delete=Rimuovi\n create-resource=Crea nuova risorsa\n propagationPriority=Priorit\\u00e0 in propagazione\n propagationPrimary=Primaria in propagazione"},{"sha":"6e49052a60b4bce69f6dc77475446244b94466c2","filename":"console/src/main/resources/org/syncope/console/pages/SchedTaskModalPage_it.properties","status":"modified","additions":1,"deletions":1,"changes":2,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/776d5712a156a40b4bcadff76761ccec2cbc5312/console%2Fsrc%2Fmain%2Fresources%2Forg%2Fsyncope%2Fconsole%2Fpages%2FSchedTaskModalPage_it.properties","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/776d5712a156a40b4bcadff76761ccec2cbc5312/console%2Fsrc%2Fmain%2Fresources%2Forg%2Fsyncope%2Fconsole%2Fpages%2FSchedTaskModalPage_it.properties","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/console%2Fsrc%2Fmain%2Fresources%2Forg%2Fsyncope%2Fconsole%2Fpages%2FSchedTaskModalPage_it.properties?ref=776d5712a156a40b4bcadff76761ccec2cbc5312","patch":"@@ -14,6 +14,6 @@ endDate=Data di conclusione\n status=Stato\n message=Messaggio\n taskExecutions=Esecuzione del task\n-delete=Eliminazione\n+delete=Rimozione\n showMessage=Mostra\n chooseForTemplate=Usa Un Template"},{"sha":"20342d74c80eeccedf69d8fd80c641efdc57f8c4","filename":"console/src/main/resources/org/syncope/console/pages/Schema_it.properties","status":"modified","additions":2,"deletions":2,"changes":4,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/776d5712a156a40b4bcadff76761ccec2cbc5312/console%2Fsrc%2Fmain%2Fresources%2Forg%2Fsyncope%2Fconsole%2Fpages%2FSchema_it.properties","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/776d5712a156a40b4bcadff76761ccec2cbc5312/console%2Fsrc%2Fmain%2Fresources%2Forg%2Fsyncope%2Fconsole%2Fpages%2FSchema_it.properties","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/console%2Fsrc%2Fmain%2Fresources%2Forg%2Fsyncope%2Fconsole%2Fpages%2FSchema_it.properties?ref=776d5712a156a40b4bcadff76761ccec2cbc5312","patch":"@@ -20,6 +20,6 @@ type=Tipo\n validatorClass=Validator class\n conversionPattern=Pattern di conversione\n edit=Modifica\n-delete=Elimina\n+delete=Rimuovi\n attributes=Attributi\n-expression=Expression\n\\ No newline at end of file\n+expression=Expression"},{"sha":"4ce3cb245744400474859e2e34a13a242ac01776","filename":"console/src/main/resources/org/syncope/console/pages/SyncTaskModalPage.properties","status":"modified","additions":1,"deletions":1,"changes":2,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/776d5712a156a40b4bcadff76761ccec2cbc5312/console%2Fsrc%2Fmain%2Fresources%2Forg%2Fsyncope%2Fconsole%2Fpages%2FSyncTaskModalPage.properties","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/776d5712a156a40b4bcadff76761ccec2cbc5312/console%2Fsrc%2Fmain%2Fresources%2Forg%2Fsyncope%2Fconsole%2Fpages%2FSyncTaskModalPage.properties","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/console%2Fsrc%2Fmain%2Fresources%2Forg%2Fsyncope%2Fconsole%2Fpages%2FSyncTaskModalPage.properties?ref=776d5712a156a40b4bcadff76761ccec2cbc5312","patch":"@@ -16,7 +16,7 @@ startDate=Start date\n endDate=End date\n status=Status\n message=Message\n-delete=Delete\n+delete=Rimuovi\n showMessage=Show\n chooseForTemplate=Use A Template\n creates=Create new identities"},{"sha":"599a0f857a7da439c8165264899bc77f6dc2ab67","filename":"console/src/main/resources/org/syncope/console/pages/SyncTaskModalPage_it.properties","status":"modified","additions":1,"deletions":1,"changes":2,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/776d5712a156a40b4bcadff76761ccec2cbc5312/console%2Fsrc%2Fmain%2Fresources%2Forg%2Fsyncope%2Fconsole%2Fpages%2FSyncTaskModalPage_it.properties","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/776d5712a156a40b4bcadff76761ccec2cbc5312/console%2Fsrc%2Fmain%2Fresources%2Forg%2Fsyncope%2Fconsole%2Fpages%2FSyncTaskModalPage_it.properties","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/console%2Fsrc%2Fmain%2Fresources%2Forg%2Fsyncope%2Fconsole%2Fpages%2FSyncTaskModalPage_it.properties?ref=776d5712a156a40b4bcadff76761ccec2cbc5312","patch":"@@ -16,7 +16,7 @@ startDate=Data di avvio\n endDate=Data di conclusione\n status=Stato\n message=Messaggio\n-delete=Eliminazione\n+delete=Rimozione\n showMessage=Mostra\n chooseForTemplate=Usa Un Template\n creates=Crea nuove identit\\u00e0"},{"sha":"2d76cd68e74ad121ec7493b5f43f190d4864699f","filename":"console/src/main/resources/org/syncope/console/pages/Todo.html","status":"modified","additions":25,"deletions":7,"changes":32,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/776d5712a156a40b4bcadff76761ccec2cbc5312/console%2Fsrc%2Fmain%2Fresources%2Forg%2Fsyncope%2Fconsole%2Fpages%2FTodo.html","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/776d5712a156a40b4bcadff76761ccec2cbc5312/console%2Fsrc%2Fmain%2Fresources%2Forg%2Fsyncope%2Fconsole%2Fpages%2FTodo.html","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/console%2Fsrc%2Fmain%2Fresources%2Forg%2Fsyncope%2Fconsole%2Fpages%2FTodo.html?ref=776d5712a156a40b4bcadff76761ccec2cbc5312","patch":"@@ -17,27 +17,45 @@\n \n     <div id=\"tabs\">\n         <ul>\n-            <li class=\"tabs-selected\">\n-                <a href=\"#tabs-1\"><span><wicket:message key=\"todo\"/></span></a>\n-            </li>\n+            <li class=\"tabs-selected\"><a href=\"#tabs-1\"><span><wicket:message key=\"approvals\"/></span></a></li>\n+            <li><a href=\"#tabs-2\"><span><wicket:message key=\"userRequests\"/></span></a></li>\n         </ul>\n         <div id=\"tabs-1\">\n \n             <div id=\"users-contain\" class=\"ui-widget\" style=\"width:inherit;\">\n-                <span wicket:id=\"todoContainer\">\n+                <span wicket:id=\"approvalContainer\">\n                     <table class=\"ui-widget ui-widget-content table-hover\"\n-                           wicket:id=\"todoTable\"/>\n+                           wicket:id=\"approvalTable\"/>\n                 </span>\n                 <span style=\"float:right\">\n-                    <form wicket:id=\"paginatorForm\" style=\"display:inline\">\n+                    <form wicket:id=\"approvalPaginatorForm\" style=\"display:inline\">\n                         <label><wicket:message key=\"displayRows\"/></label>\n                         <select class=\"text ui-widget-content ui-corner-all\"\n                                 wicket:id=\"rowsChooser\"/>\n                     </form>\n                 </span>\n             </div>\n \n-            <div wicket:id=\"editTodoWin\">[Show modal window for editing Todo]</div>\n+            <div wicket:id=\"editApprovalWin\">[Show modal window for editing approval]</div>\n+        </div>\n+\n+        <div id=\"tabs-2\">\n+\n+            <div id=\"users-contain\" class=\"ui-widget\">\n+                <span wicket:id=\"userRequestContainer\">\n+                    <table class=\"ui-widget ui-widget-content table-hover\"\n+                           wicket:id=\"userRequestTable\"/>\n+                </span>\n+                <span style=\"float:right\">\n+                    <form wicket:id=\"userRequestPaginatorForm\" style=\"display:inline\">\n+                        <label><wicket:message key=\"displayRows\"/></label>\n+                        <select class=\"text ui-widget-content ui-corner-all\"\n+                                wicket:id=\"rowsChooser\"/>\n+                    </form>\n+                </span>\n+            </div>\n+\n+            <div wicket:id=\"editUserRequestWin\">[Show modal window for editing user request]</div>\n         </div>\n     </div>\n </wicket:extend>\n\\ No newline at end of file"},{"sha":"4c32edd94a02420ab22efd6dcc3be0b6a8d41629","filename":"console/src/main/resources/org/syncope/console/pages/Todo.properties","status":"modified","additions":7,"deletions":0,"changes":7,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/776d5712a156a40b4bcadff76761ccec2cbc5312/console%2Fsrc%2Fmain%2Fresources%2Forg%2Fsyncope%2Fconsole%2Fpages%2FTodo.properties","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/776d5712a156a40b4bcadff76761ccec2cbc5312/console%2Fsrc%2Fmain%2Fresources%2Forg%2Fsyncope%2Fconsole%2Fpages%2FTodo.properties","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/console%2Fsrc%2Fmain%2Fresources%2Forg%2Fsyncope%2Fconsole%2Fpages%2FTodo.properties?ref=776d5712a156a40b4bcadff76761ccec2cbc5312","patch":"@@ -7,3 +7,10 @@ dueDate=Due date\n owner=Owner\n claim=Claim\n manage=Manage\n+approvals=Approval\n+userRequests=User requests\n+id=Id\n+delete=Delete\n+type=Type\n+user=User\n+new_user=New user"},{"sha":"09fd1f05fc909b0402efa9c43257b869b9b56522","filename":"console/src/main/resources/org/syncope/console/pages/Todo_it.properties","status":"modified","additions":7,"deletions":0,"changes":7,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/776d5712a156a40b4bcadff76761ccec2cbc5312/console%2Fsrc%2Fmain%2Fresources%2Forg%2Fsyncope%2Fconsole%2Fpages%2FTodo_it.properties","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/776d5712a156a40b4bcadff76761ccec2cbc5312/console%2Fsrc%2Fmain%2Fresources%2Forg%2Fsyncope%2Fconsole%2Fpages%2FTodo_it.properties","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/console%2Fsrc%2Fmain%2Fresources%2Forg%2Fsyncope%2Fconsole%2Fpages%2FTodo_it.properties?ref=776d5712a156a40b4bcadff76761ccec2cbc5312","patch":"@@ -7,3 +7,10 @@ dueDate=Scadenza\n owner=Esecutore\n claim=Richiedi\n manage=Gestisci\n+approvals=Approvazioni\n+userRequests=Richieste utente\n+id=Id\n+delete=Rimuovi\n+type=Tipo\n+user=Utente\n+new_user=Nuovo utente"},{"sha":"174e0234cb7be4a9f55832b7fd22de18cfd0d16e","filename":"console/src/main/resources/org/syncope/console/pages/UserModalPage.html","status":"modified","additions":1,"deletions":1,"changes":2,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/776d5712a156a40b4bcadff76761ccec2cbc5312/console%2Fsrc%2Fmain%2Fresources%2Forg%2Fsyncope%2Fconsole%2Fpages%2FUserModalPage.html","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/776d5712a156a40b4bcadff76761ccec2cbc5312/console%2Fsrc%2Fmain%2Fresources%2Forg%2Fsyncope%2Fconsole%2Fpages%2FUserModalPage.html","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/console%2Fsrc%2Fmain%2Fresources%2Forg%2Fsyncope%2Fconsole%2Fpages%2FUserModalPage.html?ref=776d5712a156a40b4bcadff76761ccec2cbc5312","patch":"@@ -56,7 +56,7 @@\n <wicket:extend>\n     <div style=\"margin:10px\">\n         <p class=\"ui-widget ui-corner-all ui-widget-header\">\n-        <wicket:message key=\"title\"/>&nbsp;<span wicket:id=\"id\"/>\n+            <span wicket:id=\"new\"/>&nbsp;<wicket:message key=\"title\"/>&nbsp;<span wicket:id=\"id\"/>\n         </p>\n \n         <form wicket:id=\"UserForm\">"},{"sha":"a908e3268e98f21d1324ff4850e07551f372ee99","filename":"console/src/main/resources/org/syncope/console/pages/UserModalPage.properties","status":"modified","additions":1,"deletions":0,"changes":1,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/776d5712a156a40b4bcadff76761ccec2cbc5312/console%2Fsrc%2Fmain%2Fresources%2Forg%2Fsyncope%2Fconsole%2Fpages%2FUserModalPage.properties","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/776d5712a156a40b4bcadff76761ccec2cbc5312/console%2Fsrc%2Fmain%2Fresources%2Forg%2Fsyncope%2Fconsole%2Fpages%2FUserModalPage.properties","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/console%2Fsrc%2Fmain%2Fresources%2Forg%2Fsyncope%2Fconsole%2Fpages%2FUserModalPage.properties?ref=776d5712a156a40b4bcadff76761ccec2cbc5312","patch":"@@ -30,3 +30,4 @@ virtualAttributeName=Name\n virtualAttributeValue=Virtual value\n \n addAttributeBtn=Add\n+new=New"},{"sha":"ef7efcf84d73db27beca9d1eef72fb81818923ba","filename":"console/src/main/resources/org/syncope/console/pages/UserModalPage_it.properties","status":"modified","additions":2,"deletions":1,"changes":3,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/776d5712a156a40b4bcadff76761ccec2cbc5312/console%2Fsrc%2Fmain%2Fresources%2Forg%2Fsyncope%2Fconsole%2Fpages%2FUserModalPage_it.properties","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/776d5712a156a40b4bcadff76761ccec2cbc5312/console%2Fsrc%2Fmain%2Fresources%2Forg%2Fsyncope%2Fconsole%2Fpages%2FUserModalPage_it.properties","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/console%2Fsrc%2Fmain%2Fresources%2Forg%2Fsyncope%2Fconsole%2Fpages%2FUserModalPage_it.properties?ref=776d5712a156a40b4bcadff76761ccec2cbc5312","patch":"@@ -17,7 +17,7 @@ updating_error=Errore generico durante l'aggiornamento\n column1=Ruoli\n column2=Azioni\n edit=Modifica\n-delete=Elimina\n+delete=Rimuovi\n \n derivedAttributes=Attributi derivati\n derivedAttributeToBeRemoved=Elimina\n@@ -31,3 +31,4 @@ virtualAttributeValue=Valore virtuale\n \n addAttributeBtn=Aggiungi\n \n+new=Nuovo"},{"sha":"a3215816cd13f3e473feef7aa7c65d1f3a950f77","filename":"console/src/main/resources/org/syncope/console/pages/panels/ResultSetPanel_it.properties","status":"modified","additions":3,"deletions":3,"changes":6,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/776d5712a156a40b4bcadff76761ccec2cbc5312/console%2Fsrc%2Fmain%2Fresources%2Forg%2Fsyncope%2Fconsole%2Fpages%2Fpanels%2FResultSetPanel_it.properties","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/776d5712a156a40b4bcadff76761ccec2cbc5312/console%2Fsrc%2Fmain%2Fresources%2Forg%2Fsyncope%2Fconsole%2Fpages%2Fpanels%2FResultSetPanel_it.properties","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/console%2Fsrc%2Fmain%2Fresources%2Forg%2Fsyncope%2Fconsole%2Fpages%2Fpanels%2FResultSetPanel_it.properties?ref=776d5712a156a40b4bcadff76761ccec2cbc5312","patch":"@@ -12,11 +12,11 @@\n \n displayRows=display rows\n \n-firstname=Firstname\n-surname=Surname\n+firstname=Nome\n+surname=Cognome\n userId=User Id\n edit=Edit\n-delete=Delete\n+delete=Rimuovi\n id=Id\n status=Stato\n token=Token"},{"sha":"ea49faa63eec3c1d8a22335ab28939529efdf2ba","filename":"console/src/main/resources/org/syncope/console/pages/panels/RoleAttributesPanel.html","status":"modified","additions":37,"deletions":100,"changes":137,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/776d5712a156a40b4bcadff76761ccec2cbc5312/console%2Fsrc%2Fmain%2Fresources%2Forg%2Fsyncope%2Fconsole%2Fpages%2Fpanels%2FRoleAttributesPanel.html","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/776d5712a156a40b4bcadff76761ccec2cbc5312/console%2Fsrc%2Fmain%2Fresources%2Forg%2Fsyncope%2Fconsole%2Fpages%2Fpanels%2FRoleAttributesPanel.html","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/console%2Fsrc%2Fmain%2Fresources%2Forg%2Fsyncope%2Fconsole%2Fpages%2Fpanels%2FRoleAttributesPanel.html?ref=776d5712a156a40b4bcadff76761ccec2cbc5312","patch":"@@ -15,112 +15,49 @@\n -->\n <wicket:panel>\n \n-        <div id=\"tabs-1\">\n-            <div id=\"formtable\">\n-                <div class=\"tablerow\">\n-                    <div class=\"tablecolumn_label short_dynamicsize\">\n-                        <wicket:message key=\"name\"/>\n-                    </div>\n-                    <div class=\"tablecolumn_field medium_dynamicsize\">\n-                        <span wicket:id=\"name\">[name]</span>\n-                    </div>\n+    <div id=\"tabs-1\">\n+        <div id=\"formtable\">\n+            <div class=\"tablerow\">\n+                <div class=\"tablecolumn_label short_dynamicsize\">\n+                    <wicket:message key=\"name\"/>\n                 </div>\n-\n-                <span wicket:id=\"attributes\">[role attributes]</span>\n-\n-                <div class=\"tablerow\">\n-                    <div class=\"tablecolumn_label short_dynamicsize\">\n-                        <label for=\"inheritAttributes\"><wicket:message key=\"inheritAttributes\"/></label>\n-                    </div>\n-                    <div class=\"tablecolumn_field medium_dynamicsize\">\n-                        <span wicket:id=\"inheritAttributes\">[inheritAttributes]</span>\n-                    </div>\n+                <div class=\"tablecolumn_field medium_dynamicsize\">\n+                    <span wicket:id=\"name\">[name]</span>\n                 </div>\n             </div>\n-        </div>\n-\n-        <div id=\"tabs-2\">\n-            <span wicket:id=\"derivedAttributes\">[role derived attributes]</span>\n-            <label for=\"inheritDerivedAttributes\"><wicket:message key=\"inheritDerivedAttributes\"/></label>\n-            <span wicket:id=\"inheritDerivedAttributes\">[inheritDerivedAttributes]</span>\n-        </div>\n-\n-        <div id=\"tabs-3\">\n-            <span wicket:id=\"virtualAttributes\">[role virtual attributes]</span>\n-            <label for=\"inheritVirtualAttributes\"><wicket:message key=\"inheritVirtualAttributes\"/></label>\n-            <span wicket:id=\"inheritVirtualAttributes\">[inheritVirtualAttributes]</span>\n-        </div>\n-\n-        <div id=\"tabs-4\">\n-            <span wicket:id=\"resources\">[resources]</span>\n-        </div>\n-        <div id=\"tabs-5\">\n-            <span wicket:id=\"entitlementsPalette\">[entitlements]</span>\n-        </div>\n-        <div id=\"tabs-6\">\n-            <span wicket:id=\"security\">[security]</span>\n-        </div>\n-</wicket:panel>\n-<!--\n-Copyright 2011 marco.\n-\n-Licensed under the Apache License, Version 2.0 (the \"License\");\n-you may not use this file except in compliance with the License.\n-You may obtain a copy of the License at\n-\n-     http://www.apache.org/licenses/LICENSE-2.0\n \n-Unless required by applicable law or agreed to in writing, software\n-distributed under the License is distributed on an \"AS IS\" BASIS,\n-WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n-See the License for the specific language governing permissions and\n-limitations under the License.\n--->\n-<wicket:panel>\n+            <span wicket:id=\"attributes\">[role attributes]</span>\n \n-        <div id=\"tabs-1\">\n-            <div id=\"formtable\">\n-                <div class=\"tablerow\">\n-                    <div class=\"tablecolumn_label short_dynamicsize\">\n-                        <wicket:message key=\"name\"/>\n-                    </div>\n-                    <div class=\"tablecolumn_field medium_dynamicsize\">\n-                        <span wicket:id=\"name\">[name]</span>\n-                    </div>\n+            <div class=\"tablerow\">\n+                <div class=\"tablecolumn_label short_dynamicsize\">\n+                    <label for=\"inheritAttributes\"><wicket:message key=\"inheritAttributes\"/></label>\n                 </div>\n-\n-                <span wicket:id=\"attributes\">[role attributes]</span>\n-\n-                <div class=\"tablerow\">\n-                    <div class=\"tablecolumn_label short_dynamicsize\">\n-                        <label for=\"inheritAttributes\"><wicket:message key=\"inheritAttributes\"/></label>\n-                    </div>\n-                    <div class=\"tablecolumn_field medium_dynamicsize\">\n-                        <span wicket:id=\"inheritAttributes\">[inheritAttributes]</span>\n-                    </div>\n+                <div class=\"tablecolumn_field medium_dynamicsize\">\n+                    <span wicket:id=\"inheritAttributes\">[inheritAttributes]</span>\n                 </div>\n             </div>\n         </div>\n-\n-        <div id=\"tabs-2\">\n-            <span wicket:id=\"derivedAttributes\">[role derived attributes]</span>\n-            <label for=\"inheritDerivedAttributes\"><wicket:message key=\"inheritDerivedAttributes\"/></label>\n-            <span wicket:id=\"inheritDerivedAttributes\">[inheritDerivedAttributes]</span>\n-        </div>\n-\n-        <div id=\"tabs-3\">\n-            <span wicket:id=\"virtualAttributes\">[role virtual attributes]</span>\n-            <label for=\"inheritVirtualAttributes\"><wicket:message key=\"inheritVirtualAttributes\"/></label>\n-            <span wicket:id=\"inheritVirtualAttributes\">[inheritVirtualAttributes]</span>\n-        </div>\n-\n-        <div id=\"tabs-4\">\n-            <span wicket:id=\"resources\">[resources]</span>\n-        </div>\n-        <div id=\"tabs-5\">\n-            <span wicket:id=\"entitlementsPalette\">[entitlements]</span>\n-        </div>\n-        <div id=\"tabs-6\">\n-            <span wicket:id=\"security\">[security]</span>\n-        </div>\n-</wicket:panel>\n\\ No newline at end of file\n+    </div>\n+\n+    <div id=\"tabs-2\">\n+        <span wicket:id=\"derivedAttributes\">[role derived attributes]</span>\n+        <label for=\"inheritDerivedAttributes\"><wicket:message key=\"inheritDerivedAttributes\"/></label>\n+        <span wicket:id=\"inheritDerivedAttributes\">[inheritDerivedAttributes]</span>\n+    </div>\n+\n+    <div id=\"tabs-3\">\n+        <span wicket:id=\"virtualAttributes\">[role virtual attributes]</span>\n+        <label for=\"inheritVirtualAttributes\"><wicket:message key=\"inheritVirtualAttributes\"/></label>\n+        <span wicket:id=\"inheritVirtualAttributes\">[inheritVirtualAttributes]</span>\n+    </div>\n+\n+    <div id=\"tabs-4\">\n+        <span wicket:id=\"resources\">[resources]</span>\n+    </div>\n+    <div id=\"tabs-5\">\n+        <span wicket:id=\"entitlementsPalette\">[entitlements]</span>\n+    </div>\n+    <div id=\"tabs-6\">\n+        <span wicket:id=\"security\">[security]</span>\n+    </div>\n+</wicket:panel>"},{"sha":"591a8839ccd8f1dba59a31d60c996cbb20bae339","filename":"console/src/main/resources/org/syncope/console/pages/panels/RoleSummaryPanel.html","status":"modified","additions":1,"deletions":37,"changes":38,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/776d5712a156a40b4bcadff76761ccec2cbc5312/console%2Fsrc%2Fmain%2Fresources%2Forg%2Fsyncope%2Fconsole%2Fpages%2Fpanels%2FRoleSummaryPanel.html","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/776d5712a156a40b4bcadff76761ccec2cbc5312/console%2Fsrc%2Fmain%2Fresources%2Forg%2Fsyncope%2Fconsole%2Fpages%2Fpanels%2FRoleSummaryPanel.html","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/console%2Fsrc%2Fmain%2Fresources%2Forg%2Fsyncope%2Fconsole%2Fpages%2Fpanels%2FRoleSummaryPanel.html?ref=776d5712a156a40b4bcadff76761ccec2cbc5312","patch":"@@ -31,40 +31,4 @@\n     <wicket:fragment wicket:id=\"fakerootFrag\">\n     </wicket:fragment>\n \n-</wicket:panel>\n-\n-<!--\n- Licensed under the Apache License, Version 2.0 (the \"License\");\n- you may not use this file except in compliance with the License.\n- You may obtain a copy of the License at\n-\n-      http://www.apache.org/licenses/LICENSE-2.0\n-\n- Unless required by applicable law or agreed to in writing, software\n- distributed under the License is distributed on an \"AS IS\" BASIS,\n- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n- See the License for the specific language governing permissions and\n- limitations under the License.\n- under the License.\n--->\n-<wicket:panel>\n-\n-    <span wicket:id=\"rolePanel\"/>\n-\n-    <wicket:fragment wicket:id=\"roleViewPanel\">\n-        <span wicket:id=\"nodeViewPanel\"></span>\n-    </wicket:fragment>\n-\n-    <wicket:fragment wicket:id=\"rootPanel\">\n-        <div style=\"float:left;width:60%\">\n-            <p style=\"height:15px\" class=\"ui-widget ui-corner-all ui-widget-header\">\n-                <span wicket:id=\"actionLink\"/>\n-            </p>\n-        </div>\n-    </wicket:fragment>\n-\n-    <wicket:fragment wicket:id=\"fakerootFrag\">\n-    </wicket:fragment>\n-\n-</wicket:panel>\n-\n+</wicket:panel>\n\\ No newline at end of file"},{"sha":"ef127c4228d380047f966156b8fdf68b7869a333","filename":"console/src/main/resources/org/syncope/console/pages/panels/RoleTabPanel.html","status":"modified","additions":2,"deletions":64,"changes":66,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/776d5712a156a40b4bcadff76761ccec2cbc5312/console%2Fsrc%2Fmain%2Fresources%2Forg%2Fsyncope%2Fconsole%2Fpages%2Fpanels%2FRoleTabPanel.html","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/776d5712a156a40b4bcadff76761ccec2cbc5312/console%2Fsrc%2Fmain%2Fresources%2Forg%2Fsyncope%2Fconsole%2Fpages%2Fpanels%2FRoleTabPanel.html","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/console%2Fsrc%2Fmain%2Fresources%2Forg%2Fsyncope%2Fconsole%2Fpages%2Fpanels%2FRoleTabPanel.html?ref=776d5712a156a40b4bcadff76761ccec2cbc5312","patch":"@@ -15,7 +15,7 @@\n <wicket:panel>\n     <div style=\"margin:10px;float:left;width:60%\">\n         <p class=\"ui-widget ui-corner-all ui-widget-header\">\n-        <wicket:message key=\"title\"/>&nbsp;\n+        <wicket:message key=\"title\"/>\n         <span wicket:id=\"displayName\"/>\n         <span wicket:id=\"actionLink\"/>\n         </p>\n@@ -57,66 +57,4 @@\n             });\n         </script>\n     </div>\n-</wicket:panel>\n-\n-<!--\n- Licensed under the Apache License, Version 2.0 (the \"License\");\n- you may not use this file except in compliance with the License.\n- You may obtain a copy of the License at\n-\n-      http://www.apache.org/licenses/LICENSE-2.0\n-\n- Unless required by applicable law or agreed to in writing, software\n- distributed under the License is distributed on an \"AS IS\" BASIS,\n- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n- See the License for the specific language governing permissions and\n- limitations under the License.\n- under the License.\n--->\n-<wicket:panel>\n-    <div style=\"margin:10px;float:left;width:60%\">\n-        <p class=\"ui-widget ui-corner-all ui-widget-header\">\n-        <wicket:message key=\"title\"/>&nbsp;\n-        <span wicket:id=\"displayName\"/>\n-        <span wicket:id=\"actionLink\"/>\n-        </p>\n-\n-        <form wicket:id=\"RoleForm\">\n-            <div id=\"tabs\">\n-                <ul>\n-                    <li><a href=\"#tabs-1\"><span><wicket:message key=\"tab1\"/></span></a></li>\n-                    <li><a href=\"#tabs-2\"><span><wicket:message key=\"tab2\"/></span></a></li>\n-                    <li><a href=\"#tabs-3\"><span><wicket:message key=\"tab3\"/></span></a></li>\n-                    <li><a href=\"#tabs-4\"><span><wicket:message key=\"tab4\"/></span></a></li>\n-                    <li><a href=\"#tabs-5\"><span><wicket:message key=\"tab5\"/></span></a></li>\n-                    <li><a href=\"#tabs-6\"><span><wicket:message key=\"tab6\"/></span></a></li>\n-                    <li><a href=\"#tabs-7\"><span><wicket:message key=\"tab7\"/></span></a></li>\n-                </ul>\n-                <div wicket:id=\"attributesPanel\">\n-                </div>\n-                <div id=\"tabs-7\">\n-                    <div wicket:id=\"userListContainer\">\n-                        <input type=\"button\" class=\"ui-button ui-widget ui-state-default ui-corner-all ui-button-text-only\"\n-                               wicket:id=\"search\"/>\n-                        <div id=\"users-contain\" class=\"ui-widget\" style=\"width:auto\">\n-                            <span wicket:id=\"userList\"> [userList] </span>\n-                        </div>\n-                        <script type=\"text/javascript\">\n-                            $(function() {\n-                                $('#formtable div.tablerow:even').addClass(\"alt\");\n-                                $(\"#tabs\").tabs();\n-                            });\n-                        </script>\n-                    </div>\n-                </div>\n-            </div>\n-        </form>\n-        <script type=\"text/javascript\">\n-            $(function() {\n-                $('#formtable div.tablerow:even').addClass(\"alt\");\n-                $(\"#tabs\").tabs();\n-            });\n-        </script>\n-    </div>\n-</wicket:panel>\n-\n+</wicket:panel>\n\\ No newline at end of file"},{"sha":"5720561ec440a0d0ec897ea66c4d177ad0169bcc","filename":"console/src/main/resources/org/syncope/console/pages/panels/RolesPanel_it.properties","status":"modified","additions":1,"deletions":1,"changes":2,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/776d5712a156a40b4bcadff76761ccec2cbc5312/console%2Fsrc%2Fmain%2Fresources%2Forg%2Fsyncope%2Fconsole%2Fpages%2Fpanels%2FRolesPanel_it.properties","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/776d5712a156a40b4bcadff76761ccec2cbc5312/console%2Fsrc%2Fmain%2Fresources%2Forg%2Fsyncope%2Fconsole%2Fpages%2Fpanels%2FRolesPanel_it.properties","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/console%2Fsrc%2Fmain%2Fresources%2Forg%2Fsyncope%2Fconsole%2Fpages%2Fpanels%2FRolesPanel_it.properties?ref=776d5712a156a40b4bcadff76761ccec2cbc5312","patch":"@@ -1,6 +1,6 @@\n id=Id Ruolo\n edit=Modifica\n-delete=Elimina\n+delete=Rimuovi\n name=Nome Ruolo\n \n membership_availability=Ruoli disponibili"},{"sha":"110b6ca0c3b15e76972fdd19bce37b222faef12d","filename":"console/src/main/resources/org/syncope/console/wicket/markup/html/tree/TreeRolePanel.html","status":"modified","additions":0,"deletions":22,"changes":22,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/776d5712a156a40b4bcadff76761ccec2cbc5312/console%2Fsrc%2Fmain%2Fresources%2Forg%2Fsyncope%2Fconsole%2Fwicket%2Fmarkup%2Fhtml%2Ftree%2FTreeRolePanel.html","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/776d5712a156a40b4bcadff76761ccec2cbc5312/console%2Fsrc%2Fmain%2Fresources%2Forg%2Fsyncope%2Fconsole%2Fwicket%2Fmarkup%2Fhtml%2Ftree%2FTreeRolePanel.html","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/console%2Fsrc%2Fmain%2Fresources%2Forg%2Fsyncope%2Fconsole%2Fwicket%2Fmarkup%2Fhtml%2Ftree%2FTreeRolePanel.html?ref=776d5712a156a40b4bcadff76761ccec2cbc5312","patch":"@@ -20,25 +20,3 @@\n         </div>\n     </wicket:panel>\n </html>\n-<!--\n- Licensed under the Apache License, Version 2.0 (the \"License\");\n- you may not use this file except in compliance with the License.\n- You may obtain a copy of the License at\n-\n-      http://www.apache.org/licenses/LICENSE-2.0\n-\n- Unless required by applicable law or agreed to in writing, software\n- distributed under the License is distributed on an \"AS IS\" BASIS,\n- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n- See the License for the specific language governing permissions and\n- limitations under the License.\n- under the License.\n--->\n-<html>\n-    <wicket:panel>\n-        <div class=\"roleTable\" wicket:id=\"treeContainer\">\n-            <div wicket:id=\"treeTable\"\n-                 style=\"width: 30%;display:block;margin:10px;float:left;\" class=\"role-tree\"/>\n-        </div>\n-    </wicket:panel>\n-</html>"},{"sha":"5fd8bf63e3d0381722ade8c16417d53991cecc08","filename":"console/src/main/webapp/WEB-INF/sun-web.xml","status":"removed","additions":0,"deletions":19,"changes":19,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/bdb5abc39cf36afc87beded34032e683be206888/console%2Fsrc%2Fmain%2Fwebapp%2FWEB-INF%2Fsun-web.xml","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/bdb5abc39cf36afc87beded34032e683be206888/console%2Fsrc%2Fmain%2Fwebapp%2FWEB-INF%2Fsun-web.xml","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/console%2Fsrc%2Fmain%2Fwebapp%2FWEB-INF%2Fsun-web.xml?ref=bdb5abc39cf36afc87beded34032e683be206888","patch":"@@ -1,19 +0,0 @@\n-<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n-<!--\n-  Licensed under the Apache License, Version 2.0 (the \"License\");\n-  you may not use this file except in compliance with the License.\n-  You may obtain a copy of the License at\n-\n-       http://www.apache.org/licenses/LICENSE-2.0\n-\n-  Unless required by applicable law or agreed to in writing, software\n-  distributed under the License is distributed on an \"AS IS\" BASIS,\n-  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n-  See the License for the specific language governing permissions and\n-  limitations under the License.\n--->\n-<!DOCTYPE sun-web-app PUBLIC \"-//Sun Microsystems, Inc.//DTD Application Server 9.0 Servlet 2.5//EN\" \"http://www.sun.com/software/appserver/dtds/sun-web-app_2_5-0.dtd\">\n-<sun-web-app error-url=\"\">\n-    <context-root>/syncope-console</context-root>\n-    <class-loader delegate=\"false\"/>\n-</sun-web-app>"},{"sha":"f5ab2eda2db01ed61b7d0f146790a8d586a311b8","filename":"console/src/test/java/org/syncope/console/EditProfileTestITCase.java","status":"added","additions":100,"deletions":0,"changes":100,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/776d5712a156a40b4bcadff76761ccec2cbc5312/console%2Fsrc%2Ftest%2Fjava%2Forg%2Fsyncope%2Fconsole%2FEditProfileTestITCase.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/776d5712a156a40b4bcadff76761ccec2cbc5312/console%2Fsrc%2Ftest%2Fjava%2Forg%2Fsyncope%2Fconsole%2FEditProfileTestITCase.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/console%2Fsrc%2Ftest%2Fjava%2Forg%2Fsyncope%2Fconsole%2FEditProfileTestITCase.java?ref=776d5712a156a40b4bcadff76761ccec2cbc5312","patch":"@@ -0,0 +1,100 @@\n+/*\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.syncope.console;\n+\n+import org.junit.Before;\n+import org.junit.Test;\n+\n+public class EditProfileTestITCase extends AbstractTest {\n+\n+    @Override\n+    @Before\n+    public void setUp()\n+            throws Exception {\n+\n+        super.setUp(BASE_URL, \"*firefox\");\n+    }\n+\n+    @Test\n+    public void selfRegistration() {\n+        selenium.setSpeed(\"1000\");\n+\n+        selenium.open(\"/syncope-console/\");\n+\n+        selenium.click(\"//div/span/span/a\");\n+\n+        for (int second = 0;; second++) {\n+            if (second >= 60) {\n+                fail(\"timeout\");\n+            }\n+            try {\n+                if (selenium.isElementPresent(\n+                        \"//span[contains(text(),'Attributes')]\")) {\n+                    break;\n+                }\n+            } catch (Exception e) {\n+            }\n+            try {\n+                Thread.sleep(1000);\n+            } catch (InterruptedException e) {\n+            }\n+        }\n+\n+        selenium.click(\"css=a.w_close\");\n+\n+        // only to have some \"Logout\" availabe for @After\n+        selenium.type(\"name=userId\", \"user1\");\n+        selenium.type(\"name=password\", \"password\");\n+        selenium.click(\"name=:submit\");\n+        selenium.waitForPageToLoad(\"30000\");\n+    }\n+\n+    @Test\n+    public void editUserProfile() {\n+        selenium.setSpeed(\"1000\");\n+\n+        selenium.open(\"/syncope-console/\");\n+        selenium.type(\"name=userId\", \"user1\");\n+        selenium.type(\"name=password\", \"password\");\n+        selenium.click(\"name=:submit\");\n+        selenium.waitForPageToLoad(\"30000\");\n+\n+        selenium.click(\"css=img[alt=\\\"Users\\\"]\");\n+        selenium.waitForPageToLoad(\"30000\");\n+\n+        selenium.click(\"id=username\");\n+        selenium.click(\"//span[@id='editProfile']/a\");\n+\n+        for (int second = 0;; second++) {\n+            if (second >= 60) {\n+                fail(\"timeout\");\n+            }\n+            try {\n+                if (selenium.isElementPresent(\n+                        \"//span[contains(text(),'Attributes')]\")) {\n+                    break;\n+                }\n+            } catch (Exception e) {\n+            }\n+            try {\n+                Thread.sleep(1000);\n+            } catch (InterruptedException e) {\n+            }\n+        }\n+\n+        assertTrue(selenium.isElementPresent(\"//input[@value='user1']\"));\n+\n+        selenium.click(\"css=a.w_close\");\n+    }\n+}"},{"sha":"34cee97df198a16a11177b780bb24b858d084f67","filename":"core/src/main/java/org/syncope/core/persistence/beans/AbstractVirAttr.java","status":"modified","additions":6,"deletions":12,"changes":18,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/776d5712a156a40b4bcadff76761ccec2cbc5312/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fcore%2Fpersistence%2Fbeans%2FAbstractVirAttr.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/776d5712a156a40b4bcadff76761ccec2cbc5312/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fcore%2Fpersistence%2Fbeans%2FAbstractVirAttr.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fcore%2Fpersistence%2Fbeans%2FAbstractVirAttr.java?ref=776d5712a156a40b4bcadff76761ccec2cbc5312","patch":"@@ -75,18 +75,13 @@ protected <T extends AbstractAttributable> List<Object> retrieveValues(\n \n         JexlUtil jexlUtil = context.getBean(JexlUtil.class);\n \n-        Set<String> attributeNames;\n-        ConnInstance connInstance;\n-        ConnectorFacadeProxy connector;\n-        Set<Attribute> attributes;\n-        String accountLink;\n-        String accountId = null;\n         for (ExternalResource resource : attributable.getExternalResources()) {\n             LOG.debug(\"Retrieving attribute mapped on {}\", resource);\n \n-            attributeNames = new HashSet<String>();\n+            Set<String> attributeNames = new HashSet<String>();\n \n-            accountLink = resource.getAccountLink();\n+            String accountLink = resource.getAccountLink();\n+            String accountId = null;\n \n             for (SchemaMapping mapping : resource.getMappings()) {\n                 if (LOG.isDebugEnabled()) {\n@@ -126,12 +121,11 @@ protected <T extends AbstractAttributable> List<Object> retrieveValues(\n             if (attributeNames != null && accountId != null) {\n                 LOG.debug(\"Get object attribute for entry {}\", accountId);\n \n-                connInstance = resource.getConnector();\n-\n-                connector = connInstanceLoader.getConnector(resource);\n+                ConnectorFacadeProxy connector =\n+                        connInstanceLoader.getConnector(resource);\n \n                 try {\n-                    attributes = connector.getObjectAttributes(\n+                    Set<Attribute> attributes = connector.getObjectAttributes(\n                             ObjectClass.ACCOUNT,\n                             new Uid(accountId),\n                             null,"},{"sha":"0b5924fffc1f1256ae82649093986cdefc2e2343","filename":"core/src/main/java/org/syncope/core/propagation/PropagationManager.java","status":"modified","additions":10,"deletions":9,"changes":19,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/776d5712a156a40b4bcadff76761ccec2cbc5312/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fcore%2Fpropagation%2FPropagationManager.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/776d5712a156a40b4bcadff76761ccec2cbc5312/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fcore%2Fpropagation%2FPropagationManager.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fcore%2Fpropagation%2FPropagationManager.java?ref=776d5712a156a40b4bcadff76761ccec2cbc5312","patch":"@@ -40,6 +40,7 @@\n import org.springframework.beans.factory.annotation.Autowired;\n import org.springframework.transaction.annotation.Transactional;\n import org.springframework.util.StringUtils;\n+import org.syncope.client.mod.AttributeMod;\n import org.syncope.client.to.AttributeTO;\n import org.syncope.core.init.ConnInstanceLoader;\n import org.syncope.core.persistence.beans.AbstractAttrValue;\n@@ -200,20 +201,20 @@ public List<PropagationTask> getCreateTaskIds(final Long userId,\n      * @param userId to be updated\n      * @param password to be updated\n      * @param vAttrsToBeRemoved virtual attributes to be removed\n-     * @param vAttrsToBeAdded virtual attributes to be added\n+     * @param vAttrsToBeUpdated virtual attributes to be added\n      * @param enable wether user must be enabled or not\n      * @param propByRes operations to perform on each resource\n      * @return list of propagation tasks\n      * @throws NotFoundException if userId is not found\n      */\n     public List<PropagationTask> getUpdateTaskIds(final Long userId,\n             final String password, final Set<String> vAttrsToBeRemoved,\n-            final Set<String> vAttrsToBeAdded, final Boolean enable,\n+            final Set<AttributeMod> vAttrsToBeUpdated, final Boolean enable,\n             final PropagationByResource propByRes)\n             throws NotFoundException {\n \n         return getUpdateTaskIds(userId, password, vAttrsToBeRemoved,\n-                vAttrsToBeAdded, enable, propByRes, null);\n+                vAttrsToBeUpdated, enable, propByRes, null);\n     }\n \n     /**\n@@ -222,7 +223,7 @@ public List<PropagationTask> getUpdateTaskIds(final Long userId,\n      * @param userId to be updated\n      * @param password to be updated\n      * @param vAttrsToBeRemoved virtual attributes to be removed\n-     * @param vAttrsToBeAdded virtual attributes to be added\n+     * @param vAttrsToBeUpdated virtual attributes to be added\n      * @param enable wether user must be enabled or not\n      * @param propByRes operations to perform on each resource\n      * @param syncResourceName name of external resource performing sync, hence\n@@ -232,7 +233,7 @@ public List<PropagationTask> getUpdateTaskIds(final Long userId,\n      */\n     public List<PropagationTask> getUpdateTaskIds(final Long userId,\n             final String password, final Set<String> vAttrsToBeRemoved,\n-            final Set<String> vAttrsToBeAdded, final Boolean enable,\n+            final Set<AttributeMod> vAttrsToBeUpdated, final Boolean enable,\n             final PropagationByResource propByRes,\n             final String syncResourceName)\n             throws NotFoundException {\n@@ -241,10 +242,10 @@ public List<PropagationTask> getUpdateTaskIds(final Long userId,\n \n         Set<String> vAttrsToRemove = vAttrsToBeRemoved == null\n                 ? Collections.EMPTY_SET : vAttrsToBeRemoved;\n-        Set<String> vAttrsToAdd = vAttrsToBeAdded == null\n-                ? Collections.EMPTY_SET : vAttrsToBeAdded;\n+        Set<AttributeMod> vAttrsToUpdate = vAttrsToBeUpdated == null\n+                ? Collections.EMPTY_SET : vAttrsToBeUpdated;\n         PropagationByResource localPropByRes = userDataBinder.fillVirtual(user,\n-                vAttrsToRemove, vAttrsToAdd, AttributableUtil.USER);\n+                vAttrsToRemove, vAttrsToUpdate, AttributableUtil.USER);\n \n         if (propByRes != null && !propByRes.isEmpty()) {\n             localPropByRes.merge(propByRes);\n@@ -350,7 +351,7 @@ private Class getIntMappingTypeClass(\n      */\n     private Map.Entry<String, Attribute> prepareAttribute(\n             final SchemaMapping mapping,\n-            final SyncopeUser user, \n+            final SyncopeUser user,\n             final String password)\n             throws ClassNotFoundException {\n "},{"sha":"1c3ba32cd54b6846da8d29adef7c89e638702671","filename":"core/src/main/java/org/syncope/core/rest/controller/DerivedSchemaController.java","status":"modified","additions":0,"deletions":1,"changes":1,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/776d5712a156a40b4bcadff76761ccec2cbc5312/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fcore%2Frest%2Fcontroller%2FDerivedSchemaController.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/776d5712a156a40b4bcadff76761ccec2cbc5312/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fcore%2Frest%2Fcontroller%2FDerivedSchemaController.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fcore%2Frest%2Fcontroller%2FDerivedSchemaController.java?ref=776d5712a156a40b4bcadff76761ccec2cbc5312","patch":"@@ -81,7 +81,6 @@ public void delete(HttpServletResponse response,\n         }\n     }\n \n-    @PreAuthorize(\"hasRole('SCHEMA_LIST')\")\n     @RequestMapping(method = RequestMethod.GET,\n     value = \"/{kind}/list\")\n     public List<DerivedSchemaTO> list(@PathVariable(\"kind\") final String kind) {"},{"sha":"e25bb46bbb5f19e48aa0b7a5a530a6177666bd2d","filename":"core/src/main/java/org/syncope/core/rest/controller/ResourceController.java","status":"modified","additions":0,"deletions":1,"changes":1,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/776d5712a156a40b4bcadff76761ccec2cbc5312/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fcore%2Frest%2Fcontroller%2FResourceController.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/776d5712a156a40b4bcadff76761ccec2cbc5312/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fcore%2Frest%2Fcontroller%2FResourceController.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fcore%2Frest%2Fcontroller%2FResourceController.java?ref=776d5712a156a40b4bcadff76761ccec2cbc5312","patch":"@@ -178,7 +178,6 @@ public ResourceTO read(final HttpServletResponse response,\n         return binder.getResourceTO(resource);\n     }\n \n-    @PreAuthorize(\"hasRole('RESOURCE_LIST')\")\n     @Transactional(readOnly = true)\n     @RequestMapping(method = RequestMethod.GET,\n     value = \"/list\")"},{"sha":"582f67d5a825f7d3d5a8f8cb04d344800495af35","filename":"core/src/main/java/org/syncope/core/rest/controller/RoleController.java","status":"modified","additions":1,"deletions":14,"changes":15,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/776d5712a156a40b4bcadff76761ccec2cbc5312/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fcore%2Frest%2Fcontroller%2FRoleController.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/776d5712a156a40b4bcadff76761ccec2cbc5312/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fcore%2Frest%2Fcontroller%2FRoleController.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fcore%2Frest%2Fcontroller%2FRoleController.java?ref=776d5712a156a40b4bcadff76761ccec2cbc5312","patch":"@@ -96,26 +96,13 @@ public void delete(@PathVariable(\"roleId\") Long roleId)\n         roleDAO.delete(roleId);\n     }\n \n-    @PreAuthorize(\"hasRole('ROLE_LIST')\")\n     @RequestMapping(method = RequestMethod.GET,\n     value = \"/list\")\n     public List<RoleTO> list() {\n-        Set<Long> allowedRoleIds = EntitlementUtil.getRoleIds(\n-                EntitlementUtil.getOwnedEntitlementNames());\n-\n         List<SyncopeRole> roles = roleDAO.findAll();\n         List<RoleTO> roleTOs = new ArrayList<RoleTO>();\n-        RoleTO roleTO;\n         for (SyncopeRole role : roles) {\n-            if (allowedRoleIds.contains(role.getId())) {\n-                roleTO = roleDataBinder.getRoleTO(role);\n-                if (roleTO.getParent() != 0\n-                        && !allowedRoleIds.contains(roleTO.getParent())) {\n-\n-                    roleTO.setParent(0);\n-                }\n-                roleTOs.add(roleTO);\n-            }\n+            roleTOs.add(roleDataBinder.getRoleTO(role));\n         }\n \n         return roleTOs;"},{"sha":"7e313cdc3175de7c7311aea0195eb59188488299","filename":"core/src/main/java/org/syncope/core/rest/controller/SchemaController.java","status":"modified","additions":0,"deletions":1,"changes":1,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/776d5712a156a40b4bcadff76761ccec2cbc5312/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fcore%2Frest%2Fcontroller%2FSchemaController.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/776d5712a156a40b4bcadff76761ccec2cbc5312/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fcore%2Frest%2Fcontroller%2FSchemaController.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fcore%2Frest%2Fcontroller%2FSchemaController.java?ref=776d5712a156a40b4bcadff76761ccec2cbc5312","patch":"@@ -77,7 +77,6 @@ public void delete(@PathVariable(\"kind\") final String kind,\n         }\n     }\n \n-    @PreAuthorize(\"hasRole('SCHEMA_LIST')\")\n     @RequestMapping(method = RequestMethod.GET,\n     value = \"/{kind}/list\")\n     public List<SchemaTO> list(@PathVariable(\"kind\") final String kind) {"},{"sha":"9b07515340dbabce97ba653a3d7479b271cb2a74","filename":"core/src/main/java/org/syncope/core/rest/controller/UserController.java","status":"modified","additions":2,"deletions":2,"changes":4,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/776d5712a156a40b4bcadff76761ccec2cbc5312/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fcore%2Frest%2Fcontroller%2FUserController.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/776d5712a156a40b4bcadff76761ccec2cbc5312/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fcore%2Frest%2Fcontroller%2FUserController.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fcore%2Frest%2Fcontroller%2FUserController.java?ref=776d5712a156a40b4bcadff76761ccec2cbc5312","patch":"@@ -104,7 +104,7 @@ public ModelAndView verifyPassword(@PathVariable(\"userId\") Long userId,\n                 equalsIgnoreCase(passwordUser.getPassword()));\n     }\n \n-    @PreAuthorize(\"hasRole('TASK_LIST')\")\n+    @PreAuthorize(\"hasRole('USER_LIST')\")\n     @RequestMapping(method = RequestMethod.GET,\n     value = \"/count\")\n     @Transactional(readOnly = true, rollbackFor = {Throwable.class})\n@@ -316,7 +316,7 @@ public UserTO update(@RequestBody final UserMod userMod)\n         List<PropagationTask> tasks = propagationManager.getUpdateTaskIds(\n                 updated.getResult().getKey(), userMod.getPassword(),\n                 userMod.getVirtualAttributesToBeRemoved(),\n-                userMod.getVirtualAttributesToBeAdded(),\n+                userMod.getVirtualAttributesToBeUpdated(),\n                 null, updated.getResult().getValue());\n         propagationManager.execute(tasks);\n "},{"sha":"94163a22f48776961e7f8e88954fcd046398f566","filename":"core/src/main/java/org/syncope/core/rest/controller/UserRequestController.java","status":"modified","additions":31,"deletions":4,"changes":35,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/776d5712a156a40b4bcadff76761ccec2cbc5312/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fcore%2Frest%2Fcontroller%2FUserRequestController.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/776d5712a156a40b4bcadff76761ccec2cbc5312/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fcore%2Frest%2Fcontroller%2FUserRequestController.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fcore%2Frest%2Fcontroller%2FUserRequestController.java?ref=776d5712a156a40b4bcadff76761ccec2cbc5312","patch":"@@ -27,6 +27,7 @@\n import org.springframework.web.bind.annotation.RequestBody;\n import org.springframework.web.bind.annotation.RequestMapping;\n import org.springframework.web.bind.annotation.RequestMethod;\n+import org.springframework.web.servlet.ModelAndView;\n import org.syncope.client.mod.UserMod;\n import org.syncope.client.to.UserRequestTO;\n import org.syncope.client.to.UserTO;\n@@ -43,7 +44,7 @@ public class UserRequestController {\n     /**\n      * Logger.\n      */\n-    protected static final Logger LOG =\n+    private static final Logger LOG =\n             LoggerFactory.getLogger(UserRequestController.class);\n \n     @Autowired\n@@ -55,14 +56,38 @@ public class UserRequestController {\n     @Autowired\n     private UserRequestDataBinder dataBinder;\n \n+    @PreAuthorize(\"isAuthenticated()\")\n+    @RequestMapping(method = RequestMethod.GET,\n+    value = \"/read/self\")\n+    @Transactional(readOnly = true)\n+    public UserTO read()\n+            throws NotFoundException {\n+\n+        return dataBinder.getAuthUserTO();\n+    }\n+\n+    private Boolean isCreateAllowedByConf() {\n+        SyncopeConf createRequestAllowed =\n+                confDAO.find(\"createRequest.allowed\", \"false\");\n+\n+        return Boolean.valueOf(createRequestAllowed.getValue());\n+    }\n+\n+    @RequestMapping(method = RequestMethod.GET,\n+    value = \"/create/allowed\")\n+    @Transactional(readOnly = true)\n+    public ModelAndView isCreateAllowed() {\n+\n+        return new ModelAndView().addObject(\n+                isCreateAllowedByConf());\n+    }\n+\n     @RequestMapping(method = RequestMethod.POST,\n     value = \"/create\")\n     public UserRequestTO create(@RequestBody final UserTO userTO)\n             throws UnauthorizedRoleException {\n \n-        SyncopeConf createRequestAllowed =\n-                confDAO.find(\"createRequest.allowed\", \"false\");\n-        if (!Boolean.valueOf(createRequestAllowed.getValue())) {\n+        if (!isCreateAllowedByConf()) {\n             LOG.error(\"Create requests are not allowed\");\n \n             throw new UnauthorizedRoleException(-1L);\n@@ -82,6 +107,7 @@ public UserRequestTO create(@RequestBody final UserTO userTO)\n         return dataBinder.getUserRequestTO(request);\n     }\n \n+    @PreAuthorize(\"isAuthenticated()\")\n     @RequestMapping(method = RequestMethod.POST,\n     value = \"/update\")\n     public UserRequestTO update(@RequestBody final UserMod userMod)\n@@ -101,6 +127,7 @@ public UserRequestTO update(@RequestBody final UserMod userMod)\n         return dataBinder.getUserRequestTO(request);\n     }\n \n+    @PreAuthorize(\"isAuthenticated()\")\n     @RequestMapping(method = RequestMethod.POST,\n     value = \"/delete\")\n     public UserRequestTO delete(@RequestBody final Long userId)"},{"sha":"87e0bb2c78407e28bd02d1aac8b8bd3efb64c859","filename":"core/src/main/java/org/syncope/core/rest/controller/VirtualSchemaController.java","status":"modified","additions":0,"deletions":1,"changes":1,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/776d5712a156a40b4bcadff76761ccec2cbc5312/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fcore%2Frest%2Fcontroller%2FVirtualSchemaController.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/776d5712a156a40b4bcadff76761ccec2cbc5312/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fcore%2Frest%2Fcontroller%2FVirtualSchemaController.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fcore%2Frest%2Fcontroller%2FVirtualSchemaController.java?ref=776d5712a156a40b4bcadff76761ccec2cbc5312","patch":"@@ -83,7 +83,6 @@ public void delete(HttpServletResponse response,\n         }\n     }\n \n-    @PreAuthorize(\"hasRole('SCHEMA_LIST')\")\n     @RequestMapping(method = RequestMethod.GET,\n     value = \"/{kind}/list\")\n     public List<VirtualSchemaTO> list(@PathVariable(\"kind\") final String kind) {"},{"sha":"55ae1a9d1225e01e018c8a11626d4d9a9d4c2a53","filename":"core/src/main/java/org/syncope/core/rest/data/AbstractAttributableDataBinder.java","status":"modified","additions":25,"deletions":15,"changes":40,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/776d5712a156a40b4bcadff76761ccec2cbc5312/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fcore%2Frest%2Fdata%2FAbstractAttributableDataBinder.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/776d5712a156a40b4bcadff76761ccec2cbc5312/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fcore%2Frest%2Fdata%2FAbstractAttributableDataBinder.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fcore%2Frest%2Fdata%2FAbstractAttributableDataBinder.java?ref=776d5712a156a40b4bcadff76761ccec2cbc5312","patch":"@@ -295,21 +295,19 @@ private SyncopeClientException checkMandatory(\n     public PropagationByResource fillVirtual(\n             final AbstractAttributable attributable,\n             final Set<String> vAttrsToBeRemoved,\n-            final Set<String> vAttrsToBeAdded,\n+            final Set<AttributeMod> vAttrsToBeUpdated,\n             final AttributableUtil attributableUtil) {\n \n         PropagationByResource propByRes = new PropagationByResource();\n \n-        AbstractVirSchema virtualSchema;\n-        AbstractVirAttr virtualAttribute;\n-\n         // 1. virtual attributes to be removed\n         for (String vAttrToBeRemoved : vAttrsToBeRemoved) {\n-            virtualSchema = getVirtualSchema(vAttrToBeRemoved,\n-                    attributableUtil.virtualSchemaClass());\n+            AbstractVirSchema virtualSchema = getVirtualSchema(\n+                    vAttrToBeRemoved, attributableUtil.virtualSchemaClass());\n \n             if (virtualSchema != null) {\n-                virtualAttribute = attributable.getVirtualAttribute(\n+                AbstractVirAttr virtualAttribute =\n+                        attributable.getVirtualAttribute(\n                         virtualSchema.getName());\n \n                 if (virtualAttribute == null) {\n@@ -345,9 +343,10 @@ public PropagationByResource fillVirtual(\n \n         LOG.debug(\"Virtual attributes to be removed:\\n{}\", propByRes);\n \n-        // 2. virtual attributes to be added\n-        for (String vAttrToBeAdded : vAttrsToBeAdded) {\n-            virtualSchema = getVirtualSchema(vAttrToBeAdded,\n+        // 2. virtual attributes to be updated\n+        for (AttributeMod vAttrToBeUpdated : vAttrsToBeUpdated) {\n+            AbstractVirSchema virtualSchema = getVirtualSchema(\n+                    vAttrToBeUpdated.getSchema(),\n                     attributableUtil.virtualSchemaClass());\n \n             if (virtualSchema != null) {\n@@ -365,10 +364,21 @@ public PropagationByResource fillVirtual(\n                     }\n                 }\n \n-                virtualAttribute = attributableUtil.newVirtualAttribute();\n-                virtualAttribute.setVirtualSchema(virtualSchema);\n-                virtualAttribute.setOwner(attributable);\n-                attributable.addVirtualAttribute(virtualAttribute);\n+                AbstractVirAttr virtualAttribute =\n+                        attributable.getVirtualAttribute(\n+                        virtualSchema.getName());\n+                if (virtualAttribute == null) {\n+                    virtualAttribute =\n+                            attributableUtil.newVirtualAttribute();\n+                    virtualAttribute.setVirtualSchema(virtualSchema);\n+                    virtualAttribute.setOwner(attributable);\n+\n+                    attributable.addVirtualAttribute(virtualAttribute);\n+                }\n+                virtualAttribute.getValues().removeAll(\n+                        vAttrToBeUpdated.getValuesToBeRemoved());\n+                virtualAttribute.getValues().addAll(\n+                        vAttrToBeUpdated.getValuesToBeAdded());\n             }\n         }\n \n@@ -667,7 +677,7 @@ protected PropagationByResource fill(\n         if (AttributableUtil.USER != attributableUtil) {\n             fillVirtual(attributable,\n                     attributableMod.getVirtualAttributesToBeRemoved(),\n-                    attributableMod.getVirtualAttributesToBeAdded(),\n+                    attributableMod.getVirtualAttributesToBeUpdated(),\n                     attributableUtil);\n         }\n "},{"sha":"de762a7633de74b803fcd63dac6af5279aeddfca","filename":"core/src/main/java/org/syncope/core/rest/data/UserDataBinder.java","status":"modified","additions":1,"deletions":1,"changes":2,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/776d5712a156a40b4bcadff76761ccec2cbc5312/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fcore%2Frest%2Fdata%2FUserDataBinder.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/776d5712a156a40b4bcadff76761ccec2cbc5312/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fcore%2Frest%2Fdata%2FUserDataBinder.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fcore%2Frest%2Fdata%2FUserDataBinder.java?ref=776d5712a156a40b4bcadff76761ccec2cbc5312","patch":"@@ -169,7 +169,7 @@ public PropagationByResource update(final SyncopeUser user,\n                 new SyncopeClientCompositeErrorException(\n                 HttpStatus.BAD_REQUEST);\n \n-        // when requesting to add user to new resources, either directly or \n+        // when requesting to add user to new resources, either directly or\n         // through role subscription, password is mandatory (issue 147)\n         // first, let's take current resources into account\n         Set<String> currentResources = user.getExternalResourceNames();"},{"sha":"95ca0dc1bac6a02c0924abe160e6b195bbfe058b","filename":"core/src/main/java/org/syncope/core/rest/data/UserRequestDataBinder.java","status":"modified","additions":14,"deletions":2,"changes":16,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/776d5712a156a40b4bcadff76761ccec2cbc5312/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fcore%2Frest%2Fdata%2FUserRequestDataBinder.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/776d5712a156a40b4bcadff76761ccec2cbc5312/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fcore%2Frest%2Fdata%2FUserRequestDataBinder.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fcore%2Frest%2Fdata%2FUserRequestDataBinder.java?ref=776d5712a156a40b4bcadff76761ccec2cbc5312","patch":"@@ -50,15 +50,27 @@ public SyncopeUser getUserFromId(final Long userId)\n             throw new NotFoundException(\"User \" + userId);\n         }\n \n-        if (!user.getUsername().equals(SecurityContextHolder.getContext().\n-                getAuthentication().getName())) {\n+        SyncopeUser authUser = userDAO.find(\n+                SecurityContextHolder.getContext().\n+                getAuthentication().getName());\n \n+        if (authUser == null || !authUser.equals(user)) {\n             throw new UnauthorizedRoleException(-1L);\n         }\n \n         return user;\n     }\n \n+    @Transactional(readOnly = true, rollbackFor = {Throwable.class})\n+    public UserTO getAuthUserTO()\n+            throws NotFoundException {\n+\n+        SyncopeUser authUser = userDAO.find(\n+                SecurityContextHolder.getContext().\n+                getAuthentication().getName());\n+        return userDataBinder.getUserTO(authUser.getId());\n+    }\n+\n     public UserRequestTO getUserRequestTO(final UserRequest request) {\n         UserRequestTO result = new UserRequestTO();\n         BeanUtils.copyProperties(request, result);"},{"sha":"350355bca3c15bf3590a4c1c4b87797dc5484f75","filename":"core/src/main/java/org/syncope/core/scheduling/SyncJob.java","status":"modified","additions":8,"deletions":1,"changes":9,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/776d5712a156a40b4bcadff76761ccec2cbc5312/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fcore%2Fscheduling%2FSyncJob.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/776d5712a156a40b4bcadff76761ccec2cbc5312/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fcore%2Fscheduling%2FSyncJob.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fcore%2Fscheduling%2FSyncJob.java?ref=776d5712a156a40b4bcadff76761ccec2cbc5312","patch":"@@ -310,8 +310,15 @@ private UserMod getUserMod(final SyncopeUser user, final ConnectorObject obj) {\n                     break;\n \n                 case UserVirtualSchema:\n-                    userMod.addVirtualAttributeToBeAdded(\n+                    userMod.addVirtualAttributeToBeRemoved(\n                             mapping.getIntAttrName());\n+\n+                    attributeMod = new AttributeMod();\n+                    attributeMod.setSchema(mapping.getIntAttrName());\n+                    for (Object value : values) {\n+                        attributeMod.addValueToBeAdded(value.toString());\n+                    }\n+                    userMod.addVirtualAttributeToBeUpdated(attributeMod);\n                     break;\n \n                 default:"},{"sha":"4c40b8d933efd1df5392aac1c0fd83241c65dea0","filename":"core/src/main/resources/content.xml","status":"modified","additions":0,"deletions":3,"changes":3,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/776d5712a156a40b4bcadff76761ccec2cbc5312/core%2Fsrc%2Fmain%2Fresources%2Fcontent.xml","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/776d5712a156a40b4bcadff76761ccec2cbc5312/core%2Fsrc%2Fmain%2Fresources%2Fcontent.xml","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fsrc%2Fmain%2Fresources%2Fcontent.xml?ref=776d5712a156a40b4bcadff76761ccec2cbc5312","patch":"@@ -39,7 +39,6 @@\n                       conversionPattern=\"yyyy-MM-dd'T'HH:mm:ss.SSSZ\"/>\n \n     <!-- Authentication and authorization -->\n-    <Entitlement name=\"SCHEMA_LIST\"/>\n     <Entitlement name=\"SCHEMA_CREATE\"/>\n     <Entitlement name=\"SCHEMA_READ\"/>\n     <Entitlement name=\"SCHEMA_UPDATE\"/>\n@@ -50,12 +49,10 @@\n     <Entitlement name=\"USER_UPDATE\"/>\n     <Entitlement name=\"USER_DELETE\"/>\n     <Entitlement name=\"USER_VIEW\"/>\n-    <Entitlement name=\"ROLE_LIST\"/>\n     <Entitlement name=\"ROLE_CREATE\"/>\n     <Entitlement name=\"ROLE_READ\"/>\n     <Entitlement name=\"ROLE_UPDATE\"/>\n     <Entitlement name=\"ROLE_DELETE\"/>\n-    <Entitlement name=\"RESOURCE_LIST\"/>\n     <Entitlement name=\"RESOURCE_CREATE\"/>\n     <Entitlement name=\"RESOURCE_READ\"/>\n     <Entitlement name=\"RESOURCE_UPDATE\"/>"},{"sha":"878b07f15ea7d119786a241008c192cef87f8548","filename":"core/src/test/java/org/syncope/core/persistence/dao/EntitlementTest.java","status":"modified","additions":2,"deletions":2,"changes":4,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/776d5712a156a40b4bcadff76761ccec2cbc5312/core%2Fsrc%2Ftest%2Fjava%2Forg%2Fsyncope%2Fcore%2Fpersistence%2Fdao%2FEntitlementTest.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/776d5712a156a40b4bcadff76761ccec2cbc5312/core%2Fsrc%2Ftest%2Fjava%2Forg%2Fsyncope%2Fcore%2Fpersistence%2Fdao%2FEntitlementTest.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fsrc%2Ftest%2Fjava%2Forg%2Fsyncope%2Fcore%2Fpersistence%2Fdao%2FEntitlementTest.java?ref=776d5712a156a40b4bcadff76761ccec2cbc5312","patch":"@@ -34,9 +34,9 @@ public class EntitlementTest extends AbstractTest {\n     @Test\n     public final void findAll() {\n         List<Entitlement> list = entitlementDAO.findAll();\n-        // 62 real entitlements + 9 role entitlements\n+        // 59 real entitlements + 9 role entitlements\n         assertEquals(\"did not get expected number of entitlements \",\n-                71, list.size());\n+                68, list.size());\n     }\n \n     @Test"},{"sha":"a07d567601ccd42a025378015c16b26195599152","filename":"core/src/test/java/org/syncope/core/rest/AuthenticationTestITCase.java","status":"modified","additions":1,"deletions":1,"changes":2,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/776d5712a156a40b4bcadff76761ccec2cbc5312/core%2Fsrc%2Ftest%2Fjava%2Forg%2Fsyncope%2Fcore%2Frest%2FAuthenticationTestITCase.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/776d5712a156a40b4bcadff76761ccec2cbc5312/core%2Fsrc%2Ftest%2Fjava%2Forg%2Fsyncope%2Fcore%2Frest%2FAuthenticationTestITCase.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fsrc%2Ftest%2Fjava%2Forg%2Fsyncope%2Fcore%2Frest%2FAuthenticationTestITCase.java?ref=776d5712a156a40b4bcadff76761ccec2cbc5312","patch":"@@ -64,7 +64,7 @@ public void testEntitlements() {\n         dbEnts.add(\"SCHEMA_READ\");\n         dbEnts.add(\"USER_READ\");\n         dbEnts.add(\"USER_LIST\");\n-        dbEnts.add(\"ROLE_LIST\");\n+        dbEnts.add(\"ROLE_READ\");\n         dbEnts.add(\"WORKFLOW_FORM_CLAIM\");\n         for (RoleTO roleTO : roleTOs) {\n             dbEnts.add(EntitlementUtil.getEntitlementName(roleTO.getId()));"},{"sha":"b2deb65e015fb27ea95ff027843f51f3714bdf98","filename":"core/src/test/java/org/syncope/core/rest/TaskTestITCase.java","status":"modified","additions":3,"deletions":3,"changes":6,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/776d5712a156a40b4bcadff76761ccec2cbc5312/core%2Fsrc%2Ftest%2Fjava%2Forg%2Fsyncope%2Fcore%2Frest%2FTaskTestITCase.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/776d5712a156a40b4bcadff76761ccec2cbc5312/core%2Fsrc%2Ftest%2Fjava%2Forg%2Fsyncope%2Fcore%2Frest%2FTaskTestITCase.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fsrc%2Ftest%2Fjava%2Forg%2Fsyncope%2Fcore%2Frest%2FTaskTestITCase.java?ref=776d5712a156a40b4bcadff76761ccec2cbc5312","patch":"@@ -261,11 +261,11 @@ public void sync() {\n         assertNotNull(userTO);\n         assertEquals(\"test9\", userTO.getUsername());\n         assertEquals(\"test9@syncope.org\",\n-                userTO.getAttributeMap().get(\"email\").get(0));\n+                userTO.getAttributeMap().get(\"email\").getValues().get(0));\n         assertEquals(\"test9@syncope.org\",\n-                userTO.getAttributeMap().get(\"userId\").get(0));\n+                userTO.getAttributeMap().get(\"userId\").getValues().get(0));\n         assertEquals(\"test9\",\n-                userTO.getAttributeMap().get(\"fullname\").get(0));\n+                userTO.getAttributeMap().get(\"fullname\").getValues().get(0));\n \n         Integer usersPost = restTemplate.getForObject(\n                 BASE_URL + \"user/count.json\", Integer.class);"},{"sha":"0aad0abc6b3c0013283393b72b21350b4000d7ae","filename":"core/src/test/java/org/syncope/core/rest/UserRequestTestITCase.java","status":"modified","additions":18,"deletions":0,"changes":18,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/776d5712a156a40b4bcadff76761ccec2cbc5312/core%2Fsrc%2Ftest%2Fjava%2Forg%2Fsyncope%2Fcore%2Frest%2FUserRequestTestITCase.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/776d5712a156a40b4bcadff76761ccec2cbc5312/core%2Fsrc%2Ftest%2Fjava%2Forg%2Fsyncope%2Fcore%2Frest%2FUserRequestTestITCase.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fsrc%2Ftest%2Fjava%2Forg%2Fsyncope%2Fcore%2Frest%2FUserRequestTestITCase.java?ref=776d5712a156a40b4bcadff76761ccec2cbc5312","patch":"@@ -35,6 +35,24 @@\n \n public class UserRequestTestITCase extends AbstractTest {\n \n+    @Test\n+    public void selfRead() {\n+        ((CommonsClientHttpRequestFactory) restTemplate.getRequestFactory()).\n+                getHttpClient().getState().setCredentials(AuthScope.ANY,\n+                new UsernamePasswordCredentials(\"user1\", \"password\"));\n+\n+        try {\n+            restTemplate.getForObject(\n+                    BASE_URL + \"user/read/{userId}.json\", UserTO.class, 1);\n+        } catch (HttpStatusCodeException e) {\n+            assertEquals(HttpStatus.UNAUTHORIZED, e.getStatusCode());\n+        }\n+\n+        UserTO userTO = restTemplate.getForObject(\n+                BASE_URL + \"user/request/read/self\", UserTO.class);\n+        assertEquals(\"user1\", userTO.getUsername());\n+    }\n+\n     @Test\n     public void create() {\n         // 1. set create request not allowed"},{"sha":"15b1d22ffac5b73e1b0eff1669ae038a58cb2157","filename":"core/src/test/java/org/syncope/core/rest/UserTestITCase.java","status":"modified","additions":6,"deletions":5,"changes":11,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/776d5712a156a40b4bcadff76761ccec2cbc5312/core%2Fsrc%2Ftest%2Fjava%2Forg%2Fsyncope%2Fcore%2Frest%2FUserTestITCase.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/776d5712a156a40b4bcadff76761ccec2cbc5312/core%2Fsrc%2Ftest%2Fjava%2Forg%2Fsyncope%2Fcore%2Frest%2FUserTestITCase.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fsrc%2Ftest%2Fjava%2Forg%2Fsyncope%2Fcore%2Frest%2FUserTestITCase.java?ref=776d5712a156a40b4bcadff76761ccec2cbc5312","patch":"@@ -513,12 +513,13 @@ public final void create() {\n         assertNotNull(newUserTO);\n \n         assertNotNull(newUserTO.getVirtualAttributeMap());\n-        assertNotNull(newUserTO.getVirtualAttributeMap().get(\"virtualdata\"));\n+        assertNotNull(newUserTO.getVirtualAttributeMap().get(\"virtualdata\").\n+                getValues());\n         assertFalse(newUserTO.getVirtualAttributeMap().get(\"virtualdata\").\n-                isEmpty());\n-        assertEquals(\n-                newUserTO.getVirtualAttributeMap().get(\"virtualdata\").get(0),\n-                \"virtualvalue\");\n+                getValues().isEmpty());\n+        assertEquals(\"virtualvalue\",\n+                newUserTO.getVirtualAttributeMap().get(\"virtualdata\").\n+                getValues().get(0));\n \n         // get the new task list\n         tasks = Arrays.asList("},{"sha":"2c9142c983b89f223de960d0e014d6a4f8d16caf","filename":"core/src/test/resources/content.xml","status":"modified","additions":1,"deletions":4,"changes":5,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/776d5712a156a40b4bcadff76761ccec2cbc5312/core%2Fsrc%2Ftest%2Fresources%2Fcontent.xml","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/776d5712a156a40b4bcadff76761ccec2cbc5312/core%2Fsrc%2Ftest%2Fresources%2Fcontent.xml","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fsrc%2Ftest%2Fresources%2Fcontent.xml?ref=776d5712a156a40b4bcadff76761ccec2cbc5312","patch":"@@ -436,7 +436,6 @@\n     <!-- Authentication and authorization -->\n     <Entitlement name=\"base\"/>\n     <Entitlement name=\"advanced\" description=\"Advanced entitlement\"/>\n-    <Entitlement name=\"SCHEMA_LIST\"/>\n     <Entitlement name=\"SCHEMA_CREATE\"/>\n     <Entitlement name=\"SCHEMA_READ\"/>\n     <Entitlement name=\"SCHEMA_UPDATE\"/>\n@@ -447,12 +446,10 @@\n     <Entitlement name=\"USER_UPDATE\"/>\n     <Entitlement name=\"USER_DELETE\"/>\n     <Entitlement name=\"USER_VIEW\"/>\n-    <Entitlement name=\"ROLE_LIST\"/>\n     <Entitlement name=\"ROLE_CREATE\"/>\n     <Entitlement name=\"ROLE_READ\"/>\n     <Entitlement name=\"ROLE_UPDATE\"/>\n     <Entitlement name=\"ROLE_DELETE\"/>\n-    <Entitlement name=\"RESOURCE_LIST\"/>\n     <Entitlement name=\"RESOURCE_CREATE\"/>\n     <Entitlement name=\"RESOURCE_READ\"/>\n     <Entitlement name=\"RESOURCE_UPDATE\"/>\n@@ -519,7 +516,7 @@\n     <SyncopeRole_Entitlement entitlements_name=\"WORKFLOW_FORM_CLAIM\" roles_id=\"7\"/>\n     <SyncopeRole_Entitlement entitlements_name=\"WORKFLOW_FORM_SUBMIT\" roles_id=\"7\"/>\n     <SyncopeRole_Entitlement entitlements_name=\"SCHEMA_READ\" roles_id=\"8\"/>\n-    <SyncopeRole_Entitlement entitlements_name=\"ROLE_LIST\" roles_id=\"8\"/>\n+    <SyncopeRole_Entitlement entitlements_name=\"ROLE_READ\" roles_id=\"8\"/>\n     <SyncopeRole_Entitlement entitlements_name=\"WORKFLOW_FORM_CLAIM\" roles_id=\"8\"/>\n     \n     <Notification id=\"100\" sender=\"test@syncope-idm.org\" subject=\"Test subject\" template=\"test\" selfAsRecipient=\"0\" traceLevel=\"ALL\""},{"sha":"0a6cff6bd2a8a33234c4870c1e598343b8d6e44e","filename":"pom.xml","status":"modified","additions":1,"deletions":1,"changes":2,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/776d5712a156a40b4bcadff76761ccec2cbc5312/pom.xml","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/776d5712a156a40b4bcadff76761ccec2cbc5312/pom.xml","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/pom.xml?ref=776d5712a156a40b4bcadff76761ccec2cbc5312","patch":"@@ -543,7 +543,7 @@\n                 <plugin>\n                     <groupId>org.codehaus.mojo</groupId>\n                     <artifactId>selenium-maven-plugin</artifactId>\n-                    <version>2.0</version>\n+                    <version>2.1</version>\n                 </plugin>\n                 <plugin>\n                     <groupId>org.apache.maven.plugins</groupId>"}]}