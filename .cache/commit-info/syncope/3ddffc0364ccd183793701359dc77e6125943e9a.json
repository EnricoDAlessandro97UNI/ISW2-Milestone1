{"sha":"3ddffc0364ccd183793701359dc77e6125943e9a","node_id":"MDY6Q29tbWl0NjM2ODc5MDYyOjNkZGZmYzAzNjRjY2QxODM3OTM3MDEzNTlkYzc3ZTYxMjU5NDNlOWE=","commit":{"author":{"name":"Francesco Chicchiriccò","email":"ilgrosso@apache.org","date":"2014-06-05T13:31:55Z"},"committer":{"name":"Francesco Chicchiriccò","email":"ilgrosso@apache.org","date":"2014-06-05T13:31:55Z"},"message":"[SYNCOPE-499] Merge from 1_1_X\n\ngit-svn-id: https://svn.apache.org/repos/asf/syncope/trunk@1600652 13f79535-47bb-0310-9956-ffa450edef68","tree":{"sha":"31aca723634342d800f9b94e2222b4c99b2d5722","url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/git/trees/31aca723634342d800f9b94e2222b4c99b2d5722"},"url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/git/commits/3ddffc0364ccd183793701359dc77e6125943e9a","comment_count":0,"verification":{"verified":false,"reason":"unsigned","signature":null,"payload":null}},"url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/3ddffc0364ccd183793701359dc77e6125943e9a","html_url":"https://github.com/EnricoDAlessandro97UNI/syncope/commit/3ddffc0364ccd183793701359dc77e6125943e9a","comments_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/3ddffc0364ccd183793701359dc77e6125943e9a/comments","author":{"login":"ilgrosso","id":1064664,"node_id":"MDQ6VXNlcjEwNjQ2NjQ=","avatar_url":"https://avatars.githubusercontent.com/u/1064664?v=4","gravatar_id":"","url":"https://api.github.com/users/ilgrosso","html_url":"https://github.com/ilgrosso","followers_url":"https://api.github.com/users/ilgrosso/followers","following_url":"https://api.github.com/users/ilgrosso/following{/other_user}","gists_url":"https://api.github.com/users/ilgrosso/gists{/gist_id}","starred_url":"https://api.github.com/users/ilgrosso/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ilgrosso/subscriptions","organizations_url":"https://api.github.com/users/ilgrosso/orgs","repos_url":"https://api.github.com/users/ilgrosso/repos","events_url":"https://api.github.com/users/ilgrosso/events{/privacy}","received_events_url":"https://api.github.com/users/ilgrosso/received_events","type":"User","site_admin":false},"committer":{"login":"ilgrosso","id":1064664,"node_id":"MDQ6VXNlcjEwNjQ2NjQ=","avatar_url":"https://avatars.githubusercontent.com/u/1064664?v=4","gravatar_id":"","url":"https://api.github.com/users/ilgrosso","html_url":"https://github.com/ilgrosso","followers_url":"https://api.github.com/users/ilgrosso/followers","following_url":"https://api.github.com/users/ilgrosso/following{/other_user}","gists_url":"https://api.github.com/users/ilgrosso/gists{/gist_id}","starred_url":"https://api.github.com/users/ilgrosso/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ilgrosso/subscriptions","organizations_url":"https://api.github.com/users/ilgrosso/orgs","repos_url":"https://api.github.com/users/ilgrosso/repos","events_url":"https://api.github.com/users/ilgrosso/events{/privacy}","received_events_url":"https://api.github.com/users/ilgrosso/received_events","type":"User","site_admin":false},"parents":[{"sha":"576509c4e5e40bc708bf5a439ac3ba59e45ac244","url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/576509c4e5e40bc708bf5a439ac3ba59e45ac244","html_url":"https://github.com/EnricoDAlessandro97UNI/syncope/commit/576509c4e5e40bc708bf5a439ac3ba59e45ac244"},{"sha":"435cf91cda4887ee8305ceaee9dfb3f85635ea9a","url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/435cf91cda4887ee8305ceaee9dfb3f85635ea9a","html_url":"https://github.com/EnricoDAlessandro97UNI/syncope/commit/435cf91cda4887ee8305ceaee9dfb3f85635ea9a"}],"stats":{"total":69,"additions":54,"deletions":15},"files":[{"sha":"f5c357889643e05eb485670de1093a0205ad3075","filename":"console/src/main/java/org/apache/syncope/console/pages/panels/RoleDetailsPanel.java","status":"modified","additions":29,"deletions":9,"changes":38,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/3ddffc0364ccd183793701359dc77e6125943e9a/console%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fconsole%2Fpages%2Fpanels%2FRoleDetailsPanel.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/3ddffc0364ccd183793701359dc77e6125943e9a/console%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fconsole%2Fpages%2Fpanels%2FRoleDetailsPanel.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/console%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fconsole%2Fpages%2Fpanels%2FRoleDetailsPanel.java?ref=3ddffc0364ccd183793701359dc77e6125943e9a","patch":"@@ -45,11 +45,18 @@\n import org.apache.wicket.model.IModel;\n import org.apache.wicket.model.PropertyModel;\n import org.apache.wicket.spring.injection.annot.SpringBean;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n \n public class RoleDetailsPanel extends Panel {\n \n     private static final long serialVersionUID = 855618618337931784L;\n \n+    /**\n+     * Logger.\n+     */\n+    protected static final Logger LOG = LoggerFactory.getLogger(RoleDetailsPanel.class);\n+\n     @SpringBean\n     private UserRestClient userRestClient;\n \n@@ -288,20 +295,30 @@ public Object getObject() {\n             switch (type) {\n                 case USER:\n                     if (roleTO.getUserOwner() != null) {\n-                        UserTO user = userRestClient.read(roleTO.getUserOwner());\n+                        UserTO user = null;\n+                        try {\n+                            user = userRestClient.read(roleTO.getUserOwner());\n+                        } catch (Exception e) {\n+                            LOG.warn(\"Could not find user with id {}, ignoring\", roleTO.getUserOwner(), e);\n+                        }\n                         if (user == null) {\n-                            object = String.valueOf(roleTO.getUserOwner());\n+                            roleTO.setUserOwner(null);\n                         } else {\n                             object = user.getId() + \" \" + user.getUsername();\n                         }\n                     }\n                     break;\n \n                 case ROLE:\n+                    RoleTO role = null;\n                     if (roleTO.getRoleOwner() != null) {\n-                        RoleTO role = roleRestClient.read(roleTO.getRoleOwner());\n+                        try {\n+                            role = roleRestClient.read(roleTO.getRoleOwner());\n+                        } catch (Exception e) {\n+                            LOG.warn(\"Could not find role with id {}, ignoring\", roleTO.getRoleOwner(), e);\n+                        }\n                         if (role == null) {\n-                            object = String.valueOf(roleTO.getRoleOwner());\n+                            roleTO.setRoleOwner(null);\n                         } else {\n                             object = role.getDisplayName();\n                         }\n@@ -351,9 +368,14 @@ public ParentModel(final RoleTO roleTO) {\n         public Object getObject() {\n             Object object = null;\n             if (roleTO.getParent() != 0) {\n-                RoleTO parent = roleRestClient.read(roleTO.getParent());\n+                RoleTO parent = null;\n+                try {\n+                    parent = roleRestClient.read(roleTO.getParent());\n+                } catch (Exception e) {\n+                    LOG.warn(\"Could not find role with id {}, ignoring\", roleTO.getParent(), e);\n+                }\n                 if (parent == null) {\n-                    object = String.valueOf(roleTO.getParent());\n+                    roleTO.setParent(0);\n                 } else {\n                     object = parent.getDisplayName();\n                 }\n@@ -363,9 +385,7 @@ public Object getObject() {\n \n         @Override\n         public void setObject(final Object object) {\n-            long parentId = (object instanceof Long)\n-                    ? ((Long) object).longValue() : 0;\n-            roleTO.setParent(parentId);\n+            roleTO.setParent((object instanceof Long) ? ((Long) object) : 0);\n         }\n \n         @Override"},{"sha":"ec9e26110b3b93089d466a49a0492d82f69001de","filename":"console/src/main/java/org/apache/syncope/console/pages/panels/RolePanel.java","status":"modified","additions":1,"deletions":2,"changes":3,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/3ddffc0364ccd183793701359dc77e6125943e9a/console%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fconsole%2Fpages%2Fpanels%2FRolePanel.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/3ddffc0364ccd183793701359dc77e6125943e9a/console%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fconsole%2Fpages%2Fpanels%2FRolePanel.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/console%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fconsole%2Fpages%2Fpanels%2FRolePanel.java?ref=3ddffc0364ccd183793701359dc77e6125943e9a","patch":"@@ -98,8 +98,7 @@ public RolePanel build() {\n     private RolePanel(final Builder builder) {\n         super(builder.id);\n \n-        this.add(new RoleDetailsPanel(\n-                \"details\", builder.roleTO, builder.mode == RoleModalPage.Mode.TEMPLATE));\n+        this.add(new RoleDetailsPanel(\"details\", builder.roleTO, builder.mode == RoleModalPage.Mode.TEMPLATE));\n \n         if (builder.pageReference == null || builder.roleTO.getId() == 0) {\n             this.add(new Label(\"statuspanel\", \"\"));"},{"sha":"4da24cb95e1eba8c50a057098d2a68ffca5a2eda","filename":"core/src/main/java/org/apache/syncope/core/connid/ConnObjectUtil.java","status":"modified","additions":22,"deletions":3,"changes":25,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/3ddffc0364ccd183793701359dc77e6125943e9a/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fconnid%2FConnObjectUtil.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/3ddffc0364ccd183793701359dc77e6125943e9a/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fconnid%2FConnObjectUtil.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fconnid%2FConnObjectUtil.java?ref=3ddffc0364ccd183793701359dc77e6125943e9a","patch":"@@ -52,6 +52,7 @@\n import org.apache.syncope.core.persistence.dao.PolicyDAO;\n import org.apache.syncope.core.persistence.dao.ResourceDAO;\n import org.apache.syncope.core.persistence.dao.RoleDAO;\n+import org.apache.syncope.core.persistence.dao.UserDAO;\n import org.apache.syncope.core.propagation.ConnectorFactory;\n import org.apache.syncope.core.propagation.Connector;\n import org.apache.syncope.core.rest.controller.UnauthorizedRoleException;\n@@ -95,6 +96,9 @@ public class ConnObjectUtil {\n     @Autowired\n     private PolicyDAO policyDAO;\n \n+    @Autowired\n+    private UserDAO userDAO;\n+\n     @Autowired\n     private RoleDAO roleDAO;\n \n@@ -379,10 +383,25 @@ private <T extends AbstractAttributableTO> T getAttributableTOFromConnObject(fin\n                     }\n                 }\n \n-                ((RoleTO) attributableTO).setParent(((RoleTO) template).getParent());\n+                if (((RoleTO) template).getParent() != 0) {\n+                    final SyncopeRole parentRole = roleDAO.find(((RoleTO) template).getParent());\n+                    if (parentRole != null) {\n+                        ((RoleTO) attributableTO).setParent(parentRole.getId());\n+                    }\n+                }\n \n-                ((RoleTO) attributableTO).setUserOwner(((RoleTO) template).getUserOwner());\n-                ((RoleTO) attributableTO).setRoleOwner(((RoleTO) template).getRoleOwner());\n+                if (((RoleTO) template).getUserOwner() != null) {\n+                    final SyncopeUser userOwner = userDAO.find(((RoleTO) template).getUserOwner());\n+                    if (userOwner != null) {\n+                        ((RoleTO) attributableTO).setUserOwner(userOwner.getId());\n+                    }\n+                }\n+                if (((RoleTO) template).getRoleOwner() != null) {\n+                    final SyncopeRole roleOwner = roleDAO.find(((RoleTO) template).getRoleOwner());\n+                    if (roleOwner != null) {\n+                        ((RoleTO) attributableTO).setRoleOwner(roleOwner.getId());\n+                    }\n+                }\n \n                 ((RoleTO) attributableTO).getEntitlements().addAll(((RoleTO) template).getEntitlements());\n "},{"sha":"d981b6d4ca2593036b4cb2c107e2fc06d7a09e66","filename":"core/src/main/java/org/apache/syncope/core/persistence/beans/SyncTask.java","status":"modified","additions":2,"deletions":1,"changes":3,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/3ddffc0364ccd183793701359dc77e6125943e9a/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fpersistence%2Fbeans%2FSyncTask.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/3ddffc0364ccd183793701359dc77e6125943e9a/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fpersistence%2Fbeans%2FSyncTask.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fpersistence%2Fbeans%2FSyncTask.java?ref=3ddffc0364ccd183793701359dc77e6125943e9a","patch":"@@ -25,6 +25,7 @@\n import javax.validation.constraints.Min;\n import org.apache.syncope.common.to.RoleTO;\n import org.apache.syncope.common.to.UserTO;\n+import org.apache.syncope.core.sync.impl.SyncJob;\n import org.apache.syncope.core.util.XMLSerializer;\n \n @Entity\n@@ -47,7 +48,7 @@ public class SyncTask extends AbstractSyncTask {\n      * Default constructor.\n      */\n     public SyncTask() {\n-        super(\"org.apache.syncope.core.sync.impl.SyncJob\");\n+        super(SyncJob.class.getName());\n     }\n \n     public UserTO getUserTemplate() {"}]}