{"sha":"1976aa9ed25fef6b3ffb5eab42c7f8241614f944","node_id":"MDY6Q29tbWl0NjM2ODc5MDYyOjE5NzZhYTllZDI1ZmVmNmIzZmZiNWVhYjQyYzdmODI0MTYxNGY5NDQ=","commit":{"author":{"name":"Francesco Chicchiriccò","email":"ilgrosso@apache.org","date":"2018-03-15T15:44:45Z"},"committer":{"name":"Francesco Chicchiriccò","email":"ilgrosso@apache.org","date":"2018-03-15T15:44:45Z"},"message":"Better views, then indexes and finally default content","tree":{"sha":"a24ad95f23a438bbc5942319510e9beab4064057","url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/git/trees/a24ad95f23a438bbc5942319510e9beab4064057"},"url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/git/commits/1976aa9ed25fef6b3ffb5eab42c7f8241614f944","comment_count":0,"verification":{"verified":false,"reason":"unsigned","signature":null,"payload":null}},"url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/1976aa9ed25fef6b3ffb5eab42c7f8241614f944","html_url":"https://github.com/EnricoDAlessandro97UNI/syncope/commit/1976aa9ed25fef6b3ffb5eab42c7f8241614f944","comments_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/1976aa9ed25fef6b3ffb5eab42c7f8241614f944/comments","author":{"login":"ilgrosso","id":1064664,"node_id":"MDQ6VXNlcjEwNjQ2NjQ=","avatar_url":"https://avatars.githubusercontent.com/u/1064664?v=4","gravatar_id":"","url":"https://api.github.com/users/ilgrosso","html_url":"https://github.com/ilgrosso","followers_url":"https://api.github.com/users/ilgrosso/followers","following_url":"https://api.github.com/users/ilgrosso/following{/other_user}","gists_url":"https://api.github.com/users/ilgrosso/gists{/gist_id}","starred_url":"https://api.github.com/users/ilgrosso/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ilgrosso/subscriptions","organizations_url":"https://api.github.com/users/ilgrosso/orgs","repos_url":"https://api.github.com/users/ilgrosso/repos","events_url":"https://api.github.com/users/ilgrosso/events{/privacy}","received_events_url":"https://api.github.com/users/ilgrosso/received_events","type":"User","site_admin":false},"committer":{"login":"ilgrosso","id":1064664,"node_id":"MDQ6VXNlcjEwNjQ2NjQ=","avatar_url":"https://avatars.githubusercontent.com/u/1064664?v=4","gravatar_id":"","url":"https://api.github.com/users/ilgrosso","html_url":"https://github.com/ilgrosso","followers_url":"https://api.github.com/users/ilgrosso/followers","following_url":"https://api.github.com/users/ilgrosso/following{/other_user}","gists_url":"https://api.github.com/users/ilgrosso/gists{/gist_id}","starred_url":"https://api.github.com/users/ilgrosso/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ilgrosso/subscriptions","organizations_url":"https://api.github.com/users/ilgrosso/orgs","repos_url":"https://api.github.com/users/ilgrosso/repos","events_url":"https://api.github.com/users/ilgrosso/events{/privacy}","received_events_url":"https://api.github.com/users/ilgrosso/received_events","type":"User","site_admin":false},"parents":[{"sha":"094f528b6e3aa883db869468c04f1abc5de5c75c","url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/094f528b6e3aa883db869468c04f1abc5de5c75c","html_url":"https://github.com/EnricoDAlessandro97UNI/syncope/commit/094f528b6e3aa883db869468c04f1abc5de5c75c"}],"stats":{"total":68,"additions":43,"deletions":25},"files":[{"sha":"38fd8df50eea734ea0b3456ff31db9553bd3031f","filename":"core/persistence-jpa/src/main/java/org/apache/syncope/core/persistence/jpa/content/XMLContentLoader.java","status":"modified","additions":5,"deletions":5,"changes":10,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/1976aa9ed25fef6b3ffb5eab42c7f8241614f944/core%2Fpersistence-jpa%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fpersistence%2Fjpa%2Fcontent%2FXMLContentLoader.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/1976aa9ed25fef6b3ffb5eab42c7f8241614f944/core%2Fpersistence-jpa%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fpersistence%2Fjpa%2Fcontent%2FXMLContentLoader.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fpersistence-jpa%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fpersistence%2Fjpa%2Fcontent%2FXMLContentLoader.java?ref=1976aa9ed25fef6b3ffb5eab42c7f8241614f944","patch":"@@ -75,6 +75,11 @@ public void load() {\n             } else {\n                 LOG.info(\"[{}] Empty database found, loading default content\", domain);\n \n+                try {\n+                    createViews(domain, datasource);\n+                } catch (IOException e) {\n+                    LOG.error(\"[{}] While creating views\", domain, e);\n+                }\n                 try {\n                     createIndexes(domain, datasource);\n                 } catch (IOException e) {\n@@ -87,11 +92,6 @@ public void load() {\n                 } catch (Exception e) {\n                     LOG.error(\"[{}] While loading default content\", domain, e);\n                 }\n-                try {\n-                    createViews(domain, datasource);\n-                } catch (IOException e) {\n-                    LOG.error(\"[{}] While creating views\", domain, e);\n-                }\n             }\n         });\n     }"},{"sha":"ab6be98640a00c6176b1e283a979836a6a8b290d","filename":"fit/core-reference/src/main/resources/sqlserver/views.xml","status":"modified","additions":38,"deletions":20,"changes":58,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/1976aa9ed25fef6b3ffb5eab42c7f8241614f944/fit%2Fcore-reference%2Fsrc%2Fmain%2Fresources%2Fsqlserver%2Fviews.xml","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/1976aa9ed25fef6b3ffb5eab42c7f8241614f944/fit%2Fcore-reference%2Fsrc%2Fmain%2Fresources%2Fsqlserver%2Fviews.xml","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/fit%2Fcore-reference%2Fsrc%2Fmain%2Fresources%2Fsqlserver%2Fviews.xml?ref=1976aa9ed25fef6b3ffb5eab42c7f8241614f944","patch":"@@ -19,8 +19,33 @@ under the License.\n -->\n <!DOCTYPE properties SYSTEM \"http://java.sun.com/dtd/properties.dtd\">\n <properties>\n-  <comment>Views</comment>\n   \n+  <entry key=\"UDynGroupMembers\">\n+    CREATE TABLE UDynGroupMembers(\n+    any_id CHAR(36),\n+    group_id CHAR(36),\n+    UNIQUE(any_id, group_id))\n+  </entry>\n+  <entry key=\"ADynGroupMembers\">\n+    CREATE TABLE ADynGroupMembers(\n+    anyType_id VARCHAR(255),\n+    any_id CHAR(36),\n+    group_id CHAR(36),\n+    UNIQUE(anyType_id, any_id, group_id))\n+  </entry>\n+  <entry key=\"DynRoleMembers\">\n+    CREATE TABLE DynRoleMembers(\n+    any_id CHAR(36),\n+    role_id VARCHAR(255),\n+    UNIQUE(any_id, role_id))\n+  </entry>\n+  <entry key=\"DynRealmMembers\">\n+    CREATE TABLE DynRealmMembers(\n+    any_id CHAR(36),\n+    dynRealm_id VARCHAR(255),\n+    UNIQUE(any_id, dynRealm_id))\n+  </entry>\n+\n   <!-- user -->\n   <entry key=\"user_search\">\n     CREATE VIEW user_search AS\n@@ -80,25 +105,25 @@ under the License.\n     FROM UMembership m, SyncopeGroup g\n     WHERE m.group_id = g.id\n   </entry>\n-  <entry key=\"user_search_udyngmemb\">\n-    CREATE VIEW user_search_udyngmemb AS\n-\n-    SELECT ds.user_id AS any_id, d.group_id AS group_id\n-    FROM UDynGroupMembership d, UDynGroupMembership_User ds\n-    WHERE d.id = ds.uDynGroupMembership_id\n-  </entry>\n   <entry key=\"user_search_role\">\n     CREATE VIEW user_search_role AS\n \n     SELECT ss.user_id AS any_id, ss.role_id AS role_id\n     FROM SyncopeUser_SyncopeRole ss\n   </entry>\n-  <entry key=\"user_search_dynrmemb\">\n-    CREATE VIEW user_search_dynrmemb AS\n+  <entry key=\"user_search_priv\">\n+    CREATE VIEW user_search_priv AS\n+\n+    SELECT ss.user_id AS any_id, sp.privilege_id AS privilege_id\n+    FROM SyncopeUser_SyncopeRole ss, SyncopeRole_Privilege sp\n+    WHERE ss.role_id = sp.role_id\n+  </entry>\n+  <entry key=\"user_search_dynpriv\">\n+    CREATE VIEW user_search_dynpriv AS\n \n-    SELECT ds.user_id AS any_id, d.role_id AS role_id\n-    FROM DynRoleMembership d, DynRoleMembership_User ds\n-    WHERE d.id = ds.dynRoleMembership_id\n+    SELECT any_id, privilege_id\n+    FROM DynRoleMembers drm, SyncopeRole_Privilege rp\n+    WHERE drm.role_id = rp.role_id\n   </entry>\n   <entry key=\"user_search_resource\">\n     CREATE VIEW user_search_resource AS\n@@ -173,13 +198,6 @@ under the License.\n     FROM AMembership m, SyncopeGroup g\n     WHERE m.group_id = g.id\n   </entry>\n-  <entry key=\"anyObject_search_adyngmemb\">\n-    CREATE VIEW anyObject_search_adyngmemb AS\n-\n-    SELECT ds.anyObject_id AS any_id, d.group_id AS group_id\n-    FROM ADynGroupMembership d, ADynGroupMembership_AnyObject ds\n-    WHERE d.id = ds.aDynGroupMembership_id\n-  </entry>\n   <entry key=\"anyObject_search_resource\">\n     CREATE VIEW anyObject_search_resource AS\n "}]}