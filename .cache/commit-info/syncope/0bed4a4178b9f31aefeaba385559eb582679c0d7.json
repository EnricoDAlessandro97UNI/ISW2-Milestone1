{"sha":"0bed4a4178b9f31aefeaba385559eb582679c0d7","node_id":"MDY6Q29tbWl0NjM2ODc5MDYyOjBiZWQ0YTQxNzhiOWYzMWFlZmVhYmEzODU1NTllYjU4MjY3OWMwZDc=","commit":{"author":{"name":"Unknown","email":"unknown@apache.org","date":"2011-11-22T17:27:15Z"},"committer":{"name":"Unknown","email":"unknown@apache.org","date":"2011-11-22T17:27:15Z"},"message":"Fixes issue 213\n\ngit-svn-id: https://svn.apache.org/repos/asf/incubator/syncope/trunk@1247210 13f79535-47bb-0310-9956-ffa450edef68","tree":{"sha":"f471703a1a707c469d508ede0151cdfa4ebc221f","url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/git/trees/f471703a1a707c469d508ede0151cdfa4ebc221f"},"url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/git/commits/0bed4a4178b9f31aefeaba385559eb582679c0d7","comment_count":0,"verification":{"verified":false,"reason":"unsigned","signature":null,"payload":null}},"url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/0bed4a4178b9f31aefeaba385559eb582679c0d7","html_url":"https://github.com/EnricoDAlessandro97UNI/syncope/commit/0bed4a4178b9f31aefeaba385559eb582679c0d7","comments_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/0bed4a4178b9f31aefeaba385559eb582679c0d7/comments","author":null,"committer":null,"parents":[{"sha":"5151df1fec6b1e46edf138974ee300083e9d24ac","url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/5151df1fec6b1e46edf138974ee300083e9d24ac","html_url":"https://github.com/EnricoDAlessandro97UNI/syncope/commit/5151df1fec6b1e46edf138974ee300083e9d24ac"}],"stats":{"total":308,"additions":183,"deletions":125},"files":[{"sha":"a4e943abd98604b9b458c39e75f93f503f66e4c1","filename":"build-tools/pom.xml","status":"modified","additions":2,"deletions":2,"changes":4,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/0bed4a4178b9f31aefeaba385559eb582679c0d7/build-tools%2Fpom.xml","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/0bed4a4178b9f31aefeaba385559eb582679c0d7/build-tools%2Fpom.xml","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/build-tools%2Fpom.xml?ref=0bed4a4178b9f31aefeaba385559eb582679c0d7","patch":"@@ -44,7 +44,7 @@\n             <plugin>\n                 <groupId>org.apache.maven.plugins</groupId>\n                 <artifactId>maven-checkstyle-plugin</artifactId>\n-                <version>2.7</version>\n+                <version>2.8</version>\n                 <configuration>\n                     <configLocation>org/syncope/checkstyle.xml</configLocation>\n                     <targetJdk>${targetJdk}</targetJdk>\n@@ -53,7 +53,7 @@\n             <plugin>\n                 <groupId>org.apache.maven.plugins</groupId>\n                 <artifactId>maven-pmd-plugin</artifactId>\n-                <version>2.5</version>\n+                <version>2.6</version>\n                 <configuration>\n                     <rulesets>\n                         <ruleset>org/syncope/pmd.xml</ruleset>"},{"sha":"47c46018ad3b82968a700fce5414a5bf4c203c44","filename":"client/pom.xml","status":"modified","additions":2,"deletions":2,"changes":4,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/0bed4a4178b9f31aefeaba385559eb582679c0d7/client%2Fpom.xml","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/0bed4a4178b9f31aefeaba385559eb582679c0d7/client%2Fpom.xml","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/client%2Fpom.xml?ref=0bed4a4178b9f31aefeaba385559eb582679c0d7","patch":"@@ -67,7 +67,7 @@\n             <plugin>\n                 <groupId>org.apache.maven.plugins</groupId>\n                 <artifactId>maven-checkstyle-plugin</artifactId>\n-                <version>2.7</version>\n+                <version>2.8</version>\n                 <configuration>\n                     <configLocation>org/syncope/checkstyle.xml</configLocation>\n                     <targetJdk>${targetJdk}</targetJdk>\n@@ -76,7 +76,7 @@\n             <plugin>\n                 <groupId>org.apache.maven.plugins</groupId>\n                 <artifactId>maven-pmd-plugin</artifactId>\n-                <version>2.5</version>\n+                <version>2.6</version>\n                 <configuration>\n                     <rulesets>\n                         <ruleset>org/syncope/pmd.xml</ruleset>"},{"sha":"0110a01357aa8774a09d5f0fffa40caeedde234c","filename":"console/pom.xml","status":"modified","additions":6,"deletions":6,"changes":12,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/0bed4a4178b9f31aefeaba385559eb582679c0d7/console%2Fpom.xml","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/0bed4a4178b9f31aefeaba385559eb582679c0d7/console%2Fpom.xml","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/console%2Fpom.xml?ref=0bed4a4178b9f31aefeaba385559eb582679c0d7","patch":"@@ -319,10 +319,10 @@\n                     </dependency>\n                 </dependencies>\n                 <configuration>\n-                    <driver>org.h2.Driver</driver>\n-                    <url>jdbc:h2:tcp://localhost:9092/testdb</url>\n-                    <username>sa</username>\n-                    <password />\n+                    <driver>${testDbResourceDriver}</driver>\n+                    <url>${testDbResourceURL}</url>\n+                    <username>${testDbResourceUsername}</username>\n+                    <password/>\n                     <srcFiles>\n                         <srcFile>${project.build.directory}/test-classes/testdb.sql</srcFile>\n                     </srcFiles>\n@@ -692,7 +692,7 @@\n             <plugin>\n                 <groupId>org.apache.maven.plugins</groupId>\n                 <artifactId>maven-checkstyle-plugin</artifactId>\n-                <version>2.7</version>\n+                <version>2.8</version>\n                 <configuration>\n                     <configLocation>org/syncope/checkstyle.xml</configLocation>\n                     <targetJdk>${targetJdk}</targetJdk>\n@@ -701,7 +701,7 @@\n             <plugin>\n                 <groupId>org.apache.maven.plugins</groupId>\n                 <artifactId>maven-pmd-plugin</artifactId>\n-                <version>2.5</version>\n+                <version>2.6</version>\n                 <configuration>\n                     <rulesets>\n                         <ruleset>org/syncope/pmd.xml</ruleset>"},{"sha":"46a4cbc936e299d53911fe36b1d84017e9a3bc4e","filename":"core/pom.xml","status":"modified","additions":7,"deletions":7,"changes":14,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/0bed4a4178b9f31aefeaba385559eb582679c0d7/core%2Fpom.xml","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/0bed4a4178b9f31aefeaba385559eb582679c0d7/core%2Fpom.xml","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fpom.xml?ref=0bed4a4178b9f31aefeaba385559eb582679c0d7","patch":"@@ -535,10 +535,10 @@\n                     </dependency>\n                 </dependencies>\n                 <configuration>\n-                    <driver>org.h2.Driver</driver>\n-                    <url>jdbc:h2:tcp://localhost:9092/testdb</url>\n-                    <username>sa</username>\n-                    <password />\n+                    <driver>${testDbResourceDriver}</driver>\n+                    <url>${testDbResourceURL}</url>\n+                    <username>${testDbResourceUsername}</username>\n+                    <password/>\n                     <srcFiles>\n                         <srcFile>${project.build.directory}/test-classes/testdb.sql</srcFile>\n                     </srcFiles>\n@@ -792,7 +792,7 @@\n         <profile>\n             <id>jrebel</id>\n             <properties>\n-                <maven.test.skip>true</maven.test.skip>\n+                <skipTests>true</skipTests>\n                 <javaagent>-javaagent:${env.REBEL_HOME}/jrebel.jar</javaagent>\n                 <waitForCheck>true</waitForCheck>\n             </properties>\n@@ -1135,7 +1135,7 @@\n             <plugin>\n                 <groupId>org.apache.maven.plugins</groupId>\n                 <artifactId>maven-checkstyle-plugin</artifactId>\n-                <version>2.7</version>\n+                <version>2.8</version>\n                 <configuration>\n                     <configLocation>org/syncope/checkstyle.xml</configLocation>\n                     <targetJdk>${targetJdk}</targetJdk>\n@@ -1144,7 +1144,7 @@\n             <plugin>\n                 <groupId>org.apache.maven.plugins</groupId>\n                 <artifactId>maven-pmd-plugin</artifactId>\n-                <version>2.5</version>\n+                <version>2.6</version>\n                 <configuration>\n                     <rulesets>\n                         <ruleset>org/syncope/pmd.xml</ruleset>"},{"sha":"2aafab7370102408c1f4bfcca3cfeca25fa7a17a","filename":"core/src/main/java/org/syncope/core/propagation/PropagationByResource.java","status":"modified","additions":36,"deletions":55,"changes":91,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/0bed4a4178b9f31aefeaba385559eb582679c0d7/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fcore%2Fpropagation%2FPropagationByResource.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/0bed4a4178b9f31aefeaba385559eb582679c0d7/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fcore%2Fpropagation%2FPropagationByResource.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fcore%2Fpropagation%2FPropagationByResource.java?ref=0bed4a4178b9f31aefeaba385559eb582679c0d7","patch":"@@ -20,7 +20,6 @@\n import java.util.HashSet;\n import java.util.Map;\n import java.util.Set;\n-import org.syncope.core.persistence.beans.ExternalResource;\n import org.syncope.types.PropagationOperation;\n \n /**\n@@ -68,111 +67,93 @@ public PropagationByResource() {\n      * on any resource for which an update is requested.\n      */\n     public final void purge() {\n-        for (String resource : toBeDeleted) {\n-            toBeCreated.remove(resource);\n-            toBeUpdated.remove(resource);\n-        }\n-        for (String resource : toBeUpdated) {\n-            toBeCreated.remove(resource);\n-        }\n+        toBeCreated.removeAll(toBeDeleted);\n+        toBeCreated.removeAll(toBeUpdated);\n+\n+        toBeUpdated.removeAll(toBeDeleted);\n     }\n \n     /**\n      * Add an element.\n      *\n      * @param type resource operation type\n-     * @param resource target resource\n+     * @param resourceName target resource\n      * @return wether the operation was succeful or not\n      */\n     public final boolean add(final PropagationOperation type,\n-            final ExternalResource resource) {\n-\n-        boolean result = false;\n+            final String resourceName) {\n \n+        Set<String> set;\n         switch (type) {\n             case CREATE:\n-                result = toBeCreated.add(resource.getName());\n+                set = toBeCreated;\n                 break;\n \n             case UPDATE:\n-                result = toBeUpdated.add(resource.getName());\n+                set = toBeUpdated;\n                 break;\n \n             case DELETE:\n-                result = toBeDeleted.add(resource.getName());\n-                break;\n-\n             default:\n+                set = toBeDeleted;\n+                break;\n         }\n \n-        return result;\n-    }\n-\n-    private boolean addAll(final Set<String> set,\n-            final Set<ExternalResource> resources) {\n-\n-        boolean result = true;\n-        for (ExternalResource resource : resources) {\n-            result &= set.add(resource.getName());\n-        }\n-\n-        return result;\n+        return set.add(resourceName);\n     }\n \n     /**\n      * Add some elements.\n      *\n      * @param type resource operation type\n-     * @param resources target resources\n+     * @param resourceNames target resources\n      * @return wether the operation was succeful or not\n      */\n     public boolean addAll(final PropagationOperation type,\n-            final Set<ExternalResource> resources) {\n-\n-        boolean result = false;\n+            final Set<String> resourceNames) {\n \n+        Set<String> set;\n         switch (type) {\n             case CREATE:\n-                result = addAll(toBeCreated, resources);\n+                set = toBeCreated;\n                 break;\n \n             case UPDATE:\n-                result = addAll(toBeUpdated, resources);\n+                set = toBeUpdated;\n                 break;\n \n             case DELETE:\n-                result = addAll(toBeDeleted, resources);\n-                break;\n-\n             default:\n+                set = toBeDeleted;\n+                break;\n         }\n \n-        return result;\n+        return set.addAll(resourceNames);\n     }\n \n     /**\n      * Remove an element.\n      *\n      * @param type resource operation type\n-     * @param resource target resource\n+     * @param resourceName target resource\n      * @return wether the operation was succeful or not\n      */\n     public final boolean remove(final PropagationOperation type,\n-            final ExternalResource resource) {\n+            final String resourceName) {\n \n         boolean result = false;\n \n         switch (type) {\n             case CREATE:\n-                result = toBeCreated.remove(resource);\n+                result = toBeCreated.remove(resourceName);\n                 break;\n \n             case UPDATE:\n-                result = toBeUpdated.remove(resource);\n+                result = toBeUpdated.remove(resourceName);\n                 break;\n \n             case DELETE:\n-                result = toBeDeleted.remove(resource);\n+                result = toBeDeleted.remove(resourceName);\n                 break;\n \n             default:\n@@ -213,26 +194,26 @@ public final Set<String> get(final PropagationOperation type) {\n      * Set resources for a given resource operation type.\n      *\n      * @param type resource operation type\n-     * @param resources to be set\n+     * @param resourceNames to be set\n      */\n     public final void set(final PropagationOperation type,\n-            final Set<ExternalResource> resources) {\n+            final Set<String> resourceNames) {\n \n         switch (type) {\n \n             case CREATE:\n                 toBeCreated.clear();\n-                addAll(toBeCreated, resources);\n+                toBeCreated.addAll(resourceNames);\n                 break;\n \n             case UPDATE:\n                 toBeUpdated.clear();\n-                addAll(toBeUpdated, resources);\n+                toBeUpdated.addAll(resourceNames);\n                 break;\n \n             case DELETE:\n                 toBeDeleted.clear();\n-                addAll(toBeDeleted, resources);\n+                toBeDeleted.addAll(resourceNames);\n                 break;\n \n             default:\n@@ -242,15 +223,15 @@ public final void set(final PropagationOperation type,\n     /**\n      * Merge another resource operation instance into this instance.\n      *\n-     * @param resourceOperations to be merged\n+     * @param propByRes to be merged\n      */\n-    public final void merge(final PropagationByResource resourceOperations) {\n+    public final void merge(final PropagationByResource propByRes) {\n         toBeCreated.addAll(\n-                resourceOperations.get(PropagationOperation.CREATE));\n+                propByRes.get(PropagationOperation.CREATE));\n         toBeUpdated.addAll(\n-                resourceOperations.get(PropagationOperation.UPDATE));\n+                propByRes.get(PropagationOperation.UPDATE));\n         toBeDeleted.addAll(\n-                resourceOperations.get(PropagationOperation.DELETE));\n+                propByRes.get(PropagationOperation.DELETE));\n     }\n \n     /**\n@@ -261,7 +242,7 @@ public final void merge(final PropagationByResource resourceOperations) {\n     public final boolean isEmpty() {\n         return toBeCreated.isEmpty()\n                 && toBeUpdated.isEmpty()\n-                && toBeUpdated.isEmpty();\n+                && toBeDeleted.isEmpty();\n     }\n \n     /**"},{"sha":"8cd4fc15853c27fb9623ffe17e95df830f43948e","filename":"core/src/main/java/org/syncope/core/propagation/PropagationManager.java","status":"modified","additions":36,"deletions":26,"changes":62,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/0bed4a4178b9f31aefeaba385559eb582679c0d7/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fcore%2Fpropagation%2FPropagationManager.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/0bed4a4178b9f31aefeaba385559eb582679c0d7/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fcore%2Fpropagation%2FPropagationManager.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fcore%2Fpropagation%2FPropagationManager.java?ref=0bed4a4178b9f31aefeaba385559eb582679c0d7","patch":"@@ -187,7 +187,8 @@ public List<PropagationTask> getCreateTaskIds(final Long userId,\n         }\n \n         final PropagationByResource propByRes = new PropagationByResource();\n-        propByRes.set(PropagationOperation.CREATE, user.getExternalResources());\n+        propByRes.set(PropagationOperation.CREATE,\n+                user.getExternalResourceNames());\n         if (syncResourceName != null) {\n             propByRes.get(PropagationOperation.CREATE).remove(syncResourceName);\n         }\n@@ -251,12 +252,15 @@ public List<PropagationTask> getUpdateTaskIds(final Long userId,\n             localPropByRes.merge(propByRes);\n         } else {\n             localPropByRes.addAll(PropagationOperation.UPDATE,\n-                    user.getExternalResources());\n+                    user.getExternalResourceNames());\n         }\n         if (syncResourceName != null) {\n-            propByRes.get(PropagationOperation.CREATE).remove(syncResourceName);\n-            propByRes.get(PropagationOperation.UPDATE).remove(syncResourceName);\n-            propByRes.get(PropagationOperation.DELETE).remove(syncResourceName);\n+            localPropByRes.get(PropagationOperation.CREATE).\n+                    remove(syncResourceName);\n+            localPropByRes.get(PropagationOperation.UPDATE).\n+                    remove(syncResourceName);\n+            localPropByRes.get(PropagationOperation.DELETE).\n+                    remove(syncResourceName);\n         }\n \n         return provision(user, password, enable, localPropByRes);\n@@ -300,7 +304,7 @@ public List<PropagationTask> getDeleteTaskIds(final Long userId,\n \n         final PropagationByResource propByRes = new PropagationByResource();\n         propByRes.set(PropagationOperation.DELETE,\n-                user.getExternalResources());\n+                user.getExternalResourceNames());\n         if (syncResourceName != null) {\n             propByRes.get(PropagationOperation.DELETE).remove(syncResourceName);\n         }\n@@ -762,24 +766,25 @@ public TaskExec execute(final PropagationTask task) {\n                 throw new NoSuchBeanDefinitionException(msg);\n             }\n \n+            // Try to read user BEFORE any actual operation\n+            ConnectorObject remoteObject = null;\n+            try {\n+                remoteObject = connector.getObject(\n+                        task.getPropagationMode(),\n+                        task.getResourceOperationType(),\n+                        ObjectClass.ACCOUNT,\n+                        new Uid(task.getOldAccountId() == null\n+                        ? task.getAccountId()\n+                        : task.getOldAccountId()),\n+                        null);\n+            } catch (RuntimeException ignore) {\n+                LOG.debug(\"To be ignored, when resolving \"\n+                        + \"username on connector\", ignore);\n+            }\n+\n             switch (task.getResourceOperationType()) {\n                 case CREATE:\n                 case UPDATE:\n-                    ConnectorObject remoteObject = null;\n-                    try {\n-                        remoteObject = connector.getObject(\n-                                task.getPropagationMode(),\n-                                task.getResourceOperationType(),\n-                                ObjectClass.ACCOUNT,\n-                                new Uid(task.getOldAccountId() == null\n-                                ? task.getAccountId()\n-                                : task.getOldAccountId()),\n-                                null);\n-                    } catch (RuntimeException ignore) {\n-                        LOG.debug(\"To be ignored, when resolving \"\n-                                + \"username on connector\", ignore);\n-                    }\n-\n                     if (remoteObject != null) {\n                         // 0. prepare new set of attributes\n                         final Set<Attribute> attributes =\n@@ -819,11 +824,16 @@ public TaskExec execute(final PropagationTask task) {\n                     break;\n \n                 case DELETE:\n-                    connector.delete(task.getPropagationMode(),\n-                            ObjectClass.ACCOUNT,\n-                            new Uid(task.getAccountId()),\n-                            null,\n-                            propagationAttempted);\n+                    if (remoteObject == null) {\n+                        LOG.debug(\"{} not found on external resource:\"\n+                                + \" ignoring delete\", task.getAccountId());\n+                    } else {\n+                        connector.delete(task.getPropagationMode(),\n+                                ObjectClass.ACCOUNT,\n+                                remoteObject.getUid(),\n+                                null,\n+                                propagationAttempted);\n+                    }\n                     break;\n \n                 default:"},{"sha":"da540b5656dd4c62ed95324c0e753bac8f9d020e","filename":"core/src/main/java/org/syncope/core/rest/data/AbstractAttributableDataBinder.java","status":"modified","additions":8,"deletions":8,"changes":16,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/0bed4a4178b9f31aefeaba385559eb582679c0d7/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fcore%2Frest%2Fdata%2FAbstractAttributableDataBinder.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/0bed4a4178b9f31aefeaba385559eb582679c0d7/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fcore%2Frest%2Fdata%2FAbstractAttributableDataBinder.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fcore%2Frest%2Fdata%2FAbstractAttributableDataBinder.java?ref=0bed4a4178b9f31aefeaba385559eb582679c0d7","patch":"@@ -327,7 +327,7 @@ public PropagationByResource fillVirtual(\n                             contains(mapping.getResource())) {\n \n                         propByRes.add(PropagationOperation.UPDATE,\n-                                mapping.getResource());\n+                                mapping.getResource().getName());\n \n                         if (mapping.isAccountid() && virtualAttribute != null\n                                 && !virtualAttribute.getValues().isEmpty()) {\n@@ -360,7 +360,7 @@ public PropagationByResource fillVirtual(\n                             contains(mapping.getResource())) {\n \n                         propByRes.add(PropagationOperation.UPDATE,\n-                                mapping.getResource());\n+                                mapping.getResource().getName());\n                     }\n                 }\n \n@@ -407,7 +407,7 @@ protected PropagationByResource fill(\n             resource = getResource(resourceToBeRemoved);\n \n             if (resource != null) {\n-                propByRes.add(PropagationOperation.DELETE, resource);\n+                propByRes.add(PropagationOperation.DELETE, resource.getName());\n \n                 attributable.removeExternalResource(resource);\n \n@@ -429,7 +429,7 @@ protected PropagationByResource fill(\n             resource = getResource(resourceToBeAdded);\n \n             if (resource != null) {\n-                propByRes.add(PropagationOperation.CREATE, resource);\n+                propByRes.add(PropagationOperation.CREATE, resource.getName());\n \n                 attributable.addExternalResource(resource);\n \n@@ -490,7 +490,7 @@ protected PropagationByResource fill(\n                             contains(mapping.getResource())) {\n \n                         propByRes.add(PropagationOperation.UPDATE,\n-                                mapping.getResource());\n+                                mapping.getResource().getName());\n \n                         if (mapping.isAccountid() && attribute != null\n                                 && !attribute.getValuesAsStrings().isEmpty()) {\n@@ -526,7 +526,7 @@ protected PropagationByResource fill(\n                             contains(mapping.getResource())) {\n \n                         propByRes.add(PropagationOperation.UPDATE,\n-                                mapping.getResource());\n+                                mapping.getResource().getName());\n                     }\n                 }\n \n@@ -621,7 +621,7 @@ protected PropagationByResource fill(\n                             contains(mapping.getResource())) {\n \n                         propByRes.add(PropagationOperation.UPDATE,\n-                                mapping.getResource());\n+                                mapping.getResource().getName());\n \n                         if (mapping.isAccountid() && derivedAttribute != null\n                                 && !derivedAttribute.getValue(\n@@ -658,7 +658,7 @@ protected PropagationByResource fill(\n                             contains(mapping.getResource())) {\n \n                         propByRes.add(PropagationOperation.UPDATE,\n-                                mapping.getResource());\n+                                mapping.getResource().getName());\n                     }\n                 }\n "},{"sha":"f2612cbcd2e39650ee46cddc0f31e9f9753d499e","filename":"core/src/main/java/org/syncope/core/rest/data/UserDataBinder.java","status":"modified","additions":13,"deletions":13,"changes":26,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/0bed4a4178b9f31aefeaba385559eb582679c0d7/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fcore%2Frest%2Fdata%2FUserDataBinder.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/0bed4a4178b9f31aefeaba385559eb582679c0d7/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fcore%2Frest%2Fdata%2FUserDataBinder.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fcore%2Frest%2Fdata%2FUserDataBinder.java?ref=0bed4a4178b9f31aefeaba385559eb582679c0d7","patch":"@@ -66,9 +66,10 @@ public class UserDataBinder extends AbstractAttributableDataBinder {\n     public SyncopeUser getUserFromId(final Long userId)\n             throws NotFoundException, UnauthorizedRoleException {\n \n-        if (userId == null)\n-            throw new NotFoundException(\"Null user id\");            \n-        \n+        if (userId == null) {\n+            throw new NotFoundException(\"Null user id\");\n+        }\n+\n         SyncopeUser user = userDAO.find(userId);\n         if (user == null) {\n             throw new NotFoundException(\"User \" + userId);\n@@ -190,26 +191,24 @@ public PropagationByResource update(final SyncopeUser user,\n \n             user.setChangePwdDate(new Date());\n \n-            propByRes.addAll(\n-                    PropagationOperation.UPDATE, user.getExternalResources());\n+            propByRes.addAll(PropagationOperation.UPDATE,\n+                    user.getExternalResourceNames());\n         }\n \n         // username\n         if (userMod.getUsername() != null) {\n             user.setUsername(userMod.getUsername());\n-            propByRes.addAll(\n-                    PropagationOperation.UPDATE, user.getExternalResources());\n+            propByRes.addAll(PropagationOperation.UPDATE,\n+                    user.getExternalResourceNames());\n         }\n \n         // attributes, derived attributes, virtual attributes and resources\n         propByRes.merge(fill(user, userMod, AttributableUtil.USER, scce));\n \n         // store the role ids of membership required to be added\n         Set<Long> membershipToBeAddedRoleIds = new HashSet<Long>();\n-        for (MembershipMod membershipToBeAdded :\n-                userMod.getMembershipsToBeAdded()) {\n-\n-            membershipToBeAddedRoleIds.add(membershipToBeAdded.getRole());\n+        for (MembershipMod membToBeAdded : userMod.getMembershipsToBeAdded()) {\n+            membershipToBeAddedRoleIds.add(membToBeAdded.getRole());\n         }\n \n         // memberships to be removed\n@@ -228,7 +227,8 @@ public PropagationByResource update(final SyncopeUser user,\n                     if (!membershipToBeAddedRoleIds.contains(\n                             membership.getSyncopeRole().getId())) {\n \n-                        propByRes.add(PropagationOperation.DELETE, resource);\n+                        propByRes.add(PropagationOperation.DELETE,\n+                                resource.getName());\n                     }\n                 }\n \n@@ -299,7 +299,7 @@ public PropagationByResource update(final SyncopeUser user,\n                     user.addMembership(membership);\n \n                     propByRes.addAll(PropagationOperation.UPDATE,\n-                            role.getExternalResources());\n+                            role.getExternalResourceNames());\n                 }\n \n                 propByRes.merge(fill(membership, membershipMod,"},{"sha":"396b2673eaa57cd1e7867d3638faed4e7eb20d20","filename":"core/src/test/java/org/syncope/core/rest/AbstractTest.java","status":"modified","additions":6,"deletions":1,"changes":7,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/0bed4a4178b9f31aefeaba385559eb582679c0d7/core%2Fsrc%2Ftest%2Fjava%2Forg%2Fsyncope%2Fcore%2Frest%2FAbstractTest.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/0bed4a4178b9f31aefeaba385559eb582679c0d7/core%2Fsrc%2Ftest%2Fjava%2Forg%2Fsyncope%2Fcore%2Frest%2FAbstractTest.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fsrc%2Ftest%2Fjava%2Forg%2Fsyncope%2Fcore%2Frest%2FAbstractTest.java?ref=0bed4a4178b9f31aefeaba385559eb582679c0d7","patch":"@@ -14,6 +14,7 @@\n  */\n package org.syncope.core.rest;\n \n+import javax.sql.DataSource;\n import org.apache.commons.httpclient.UsernamePasswordCredentials;\n import org.apache.commons.httpclient.auth.AuthScope;\n import org.junit.Before;\n@@ -28,7 +29,8 @@\n \n @RunWith(SpringJUnit4ClassRunner.class)\n @ContextConfiguration(locations = {\n-    \"classpath:restClientContext.xml\"\n+    \"classpath:restClientContext.xml\",\n+    \"classpath:testJDBCContext.xml\"\n })\n public abstract class AbstractTest {\n \n@@ -44,6 +46,9 @@ public abstract class AbstractTest {\n     @Autowired\n     protected RestTemplate restTemplate;\n \n+    @Autowired\n+    protected DataSource testDataSource;\n+\n     @Before\n     public void setupRestTemplate() {\n         ((CommonsClientHttpRequestFactory) restTemplate.getRequestFactory())."},{"sha":"a76e604777aba606ccb2a3dc5ccf9a9e31b42254","filename":"core/src/test/java/org/syncope/core/rest/UserTestITCase.java","status":"modified","additions":29,"deletions":0,"changes":29,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/0bed4a4178b9f31aefeaba385559eb582679c0d7/core%2Fsrc%2Ftest%2Fjava%2Forg%2Fsyncope%2Fcore%2Frest%2FUserTestITCase.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/0bed4a4178b9f31aefeaba385559eb582679c0d7/core%2Fsrc%2Ftest%2Fjava%2Forg%2Fsyncope%2Fcore%2Frest%2FUserTestITCase.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fsrc%2Ftest%2Fjava%2Forg%2Fsyncope%2Fcore%2Frest%2FUserTestITCase.java?ref=0bed4a4178b9f31aefeaba385559eb582679c0d7","patch":"@@ -28,8 +28,10 @@\n import org.apache.commons.httpclient.UsernamePasswordCredentials;\n import org.apache.commons.httpclient.auth.AuthScope;\n import org.junit.Test;\n+import org.springframework.dao.EmptyResultDataAccessException;\n import org.springframework.http.HttpStatus;\n import org.springframework.http.client.CommonsClientHttpRequestFactory;\n+import org.springframework.jdbc.core.JdbcTemplate;\n import org.springframework.test.annotation.ExpectedException;\n import org.springframework.web.client.HttpStatusCodeException;\n import org.syncope.client.mod.AttributeMod;\n@@ -1323,4 +1325,31 @@ public final void suspendReactivate() {\n         assertNotNull(userTO);\n         assertEquals(\"active\", userTO.getStatus());\n     }\n+\n+    @ExpectedException(EmptyResultDataAccessException.class)\n+    @Test\n+    public void issue213() {\n+        UserTO userTO = getSampleTO(\"issue213@syncope-idm.org\");\n+        userTO.addResource(\"resource-testdb\");\n+\n+        userTO = restTemplate.postForObject(\n+                BASE_URL + \"user/create\", userTO, UserTO.class);\n+        assertNotNull(userTO);\n+\n+        JdbcTemplate jdbcTemplate = new JdbcTemplate(testDataSource);\n+        int id = jdbcTemplate.queryForInt(\n+                \"SELECT id FROM test WHERE id=?\", userTO.getId());\n+        assertEquals(userTO.getId(), id);\n+\n+        UserMod userMod = new UserMod();\n+        userMod.setId(userTO.getId());\n+        userMod.addResourceToBeRemoved(\"resource-testdb\");\n+\n+        userTO = restTemplate.postForObject(BASE_URL + \"user/update\",\n+                userMod, UserTO.class);\n+        assertTrue(userTO.getResources().isEmpty());\n+\n+        jdbcTemplate.queryForInt(\n+                \"SELECT id FROM test WHERE id=?\", userTO.getId());\n+    }\n }"},{"sha":"b7f2fc20c53fbb25b0cbe802f33b4ac7ebe8f0ba","filename":"core/src/test/resources/testJDBCContext.xml","status":"added","additions":28,"deletions":0,"changes":28,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/0bed4a4178b9f31aefeaba385559eb582679c0d7/core%2Fsrc%2Ftest%2Fresources%2FtestJDBCContext.xml","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/0bed4a4178b9f31aefeaba385559eb582679c0d7/core%2Fsrc%2Ftest%2Fresources%2FtestJDBCContext.xml","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fsrc%2Ftest%2Fresources%2FtestJDBCContext.xml?ref=0bed4a4178b9f31aefeaba385559eb582679c0d7","patch":"@@ -0,0 +1,28 @@\n+<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n+<!--\n+  Licensed under the Apache License, Version 2.0 (the \"License\");\n+  you may not use this file except in compliance with the License.\n+  You may obtain a copy of the License at\n+\n+       http://www.apache.org/licenses/LICENSE-2.0\n+\n+  Unless required by applicable law or agreed to in writing, software\n+  distributed under the License is distributed on an \"AS IS\" BASIS,\n+  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+  See the License for the specific language governing permissions and\n+  limitations under the License.\n+-->\n+<beans xmlns=\"http://www.springframework.org/schema/beans\"\n+       xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n+       xsi:schemaLocation=\"http://www.springframework.org/schema/beans\n+                           http://www.springframework.org/schema/beans/spring-beans.xsd\">\n+\n+    <bean id=\"testDataSource\"\n+          class=\"org.springframework.jdbc.datasource.DriverManagerDataSource\">\n+        <property name=\"driverClassName\" value=\"${testDbResourceDriver}\"/>\n+        <property name=\"url\" value=\"${testDbResourceURL}\"/>\n+        <property name=\"username\" value=\"${testDbResourceUsername}\"/>\n+        <property name=\"password\" value=\"${testDbResourcePassword}\"/>\n+    </bean>\n+\n+</beans>\n\\ No newline at end of file"},{"sha":"7fd9799d95935a00cc5d3e60ec12585d3b149e53","filename":"core/src/test/resources/testdb.sql","status":"modified","additions":1,"deletions":1,"changes":2,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/0bed4a4178b9f31aefeaba385559eb582679c0d7/core%2Fsrc%2Ftest%2Fresources%2Ftestdb.sql","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/0bed4a4178b9f31aefeaba385559eb582679c0d7/core%2Fsrc%2Ftest%2Fresources%2Ftestdb.sql","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fsrc%2Ftest%2Fresources%2Ftestdb.sql?ref=0bed4a4178b9f31aefeaba385559eb582679c0d7","patch":"@@ -1,4 +1,4 @@\n-ALTER USER sa SET PASSWORD 'sa';\n+ALTER USER sa SET PASSWORD '${testDbResourcePassword}';\n \n DROP TABLE test IF EXISTS;\n CREATE TABLE test ("},{"sha":"b59794fb8fa5f3bae99413357d5144ebe9903487","filename":"pom.xml","status":"modified","additions":9,"deletions":4,"changes":13,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/0bed4a4178b9f31aefeaba385559eb582679c0d7/pom.xml","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/0bed4a4178b9f31aefeaba385559eb582679c0d7/pom.xml","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/pom.xml?ref=0bed4a4178b9f31aefeaba385559eb582679c0d7","patch":"@@ -121,6 +121,11 @@\n         <bundles.directory>${project.build.directory}/bundles</bundles.directory>\n         <log.directory>${project.build.directory}/log</log.directory>\n         \n+        <testDbResourceDriver>org.h2.Driver</testDbResourceDriver>\n+        <testDbResourceURL>jdbc:h2:tcp://localhost:9092/testdb</testDbResourceURL>\n+        <testDbResourceUsername>sa</testDbResourceUsername>\n+        <testDbResourcePassword>sa</testDbResourcePassword>\n+        \n         <project.build.sourceEncoding>UTF-8</project.build.sourceEncoding>\n     </properties>\n \n@@ -615,7 +620,7 @@\n             <plugin>\n                 <groupId>org.apache.maven.plugins</groupId>\n                 <artifactId>maven-checkstyle-plugin</artifactId>\n-                <version>2.7</version>\n+                <version>2.8</version>\n                 <dependencies>    \n                     <dependency>\n                         <groupId>org.syncope</groupId>\n@@ -627,7 +632,7 @@\n             <plugin>\n                 <groupId>org.apache.maven.plugins</groupId>\n                 <artifactId>maven-pmd-plugin</artifactId>\n-                <version>2.5</version>\n+                <version>2.6</version>\n                 <dependencies>    \n                     <dependency>\n                         <groupId>org.syncope</groupId>\n@@ -651,7 +656,7 @@\n                         <plugin>\n                             <groupId>org.apache.maven.plugins</groupId>\n                             <artifactId>maven-checkstyle-plugin</artifactId>\n-                            <version>2.7</version>\n+                            <version>2.8</version>\n                             <configuration>\n                                 <configLocation>org/syncope/checkstyle.xml</configLocation>\n                                 <targetJdk>${targetJdk}</targetJdk>\n@@ -670,7 +675,7 @@\n                         <plugin>\n                             <groupId>org.apache.maven.plugins</groupId>\n                             <artifactId>maven-pmd-plugin</artifactId>\n-                            <version>2.5</version>\n+                            <version>2.6</version>\n                             <configuration>\n                                 <targetJdk>${targetJdk}</targetJdk>\n                                 <rulesets>"}]}