{"sha":"f1ef3467d4f8721251fd216e3508e6d3f265b4aa","node_id":"MDY6Q29tbWl0NjM2ODc5MDYyOmYxZWYzNDY3ZDRmODcyMTI1MWZkMjE2ZTM1MDhlNmQzZjI2NWI0YWE=","commit":{"author":{"name":"Unknown","email":"unknown@apache.org","date":"2010-07-30T14:39:11Z"},"committer":{"name":"Unknown","email":"unknown@apache.org","date":"2010-07-30T14:39:11Z"},"message":"Update with workflow\n\ngit-svn-id: https://svn.apache.org/repos/asf/incubator/syncope/trunk@1246419 13f79535-47bb-0310-9956-ffa450edef68","tree":{"sha":"aa57b7c51a413c30d8e21aff18e5162359254304","url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/git/trees/aa57b7c51a413c30d8e21aff18e5162359254304"},"url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/git/commits/f1ef3467d4f8721251fd216e3508e6d3f265b4aa","comment_count":0,"verification":{"verified":false,"reason":"unsigned","signature":null,"payload":null}},"url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/f1ef3467d4f8721251fd216e3508e6d3f265b4aa","html_url":"https://github.com/EnricoDAlessandro97UNI/syncope/commit/f1ef3467d4f8721251fd216e3508e6d3f265b4aa","comments_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/f1ef3467d4f8721251fd216e3508e6d3f265b4aa/comments","author":null,"committer":null,"parents":[{"sha":"667f138bd17d7731f3c189dde55eba8dd1fcb6cc","url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/667f138bd17d7731f3c189dde55eba8dd1fcb6cc","html_url":"https://github.com/EnricoDAlessandro97UNI/syncope/commit/667f138bd17d7731f3c189dde55eba8dd1fcb6cc"}],"stats":{"total":37,"additions":24,"deletions":13},"files":[{"sha":"f454d1a6172a200b13d0bfac3dfea5d68bb7b215","filename":"core/src/main/java/org/syncope/core/rest/controller/UserController.java","status":"modified","additions":15,"deletions":9,"changes":24,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/f1ef3467d4f8721251fd216e3508e6d3f265b4aa/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fcore%2Frest%2Fcontroller%2FUserController.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/f1ef3467d4f8721251fd216e3508e6d3f265b4aa/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fcore%2Frest%2Fcontroller%2FUserController.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fcore%2Frest%2Fcontroller%2FUserController.java?ref=f1ef3467d4f8721251fd216e3508e6d3f265b4aa","patch":"@@ -74,7 +74,7 @@ public class UserController extends AbstractController {\n     @Autowired\n     private PropagationManager propagationManager;\n \n-    private UserTO executeAction(String actionName, UserTO userTO)\n+    private SyncopeUser executeAction(String actionName, UserTO userTO)\n             throws WorkflowException, NotFoundException {\n \n         SyncopeUser syncopeUser = syncopeUserDAO.find(userTO.getId());\n@@ -110,8 +110,7 @@ private UserTO executeAction(String actionName, UserTO userTO)\n         userWorkflow.doAction(syncopeUser.getWorkflowEntryId(),\n                 actionId, inputs);\n \n-        syncopeUser = syncopeUserDAO.save(syncopeUser);\n-        return userDataBinder.getUserTO(syncopeUser);\n+        return syncopeUserDAO.save(syncopeUser);\n     }\n \n     @RequestMapping(method = RequestMethod.POST,\n@@ -120,7 +119,8 @@ public UserTO activate(HttpServletResponse response,\n             @RequestBody UserTO userTO)\n             throws WorkflowException, NotFoundException {\n \n-        return executeAction(Constants.ACTION_ACTIVATE, userTO);\n+        return userDataBinder.getUserTO(\n+                executeAction(Constants.ACTION_ACTIVATE, userTO));\n     }\n \n     private Set<String> getSyncResourceNames(SyncopeUser syncopeUser,\n@@ -296,7 +296,8 @@ public UserTO generateToken(HttpServletResponse response,\n \n         UserTO userTO = new UserTO();\n         userTO.setId(userId);\n-        return executeAction(Constants.ACTION_GENERATE_TOKEN, userTO);\n+        return userDataBinder.getUserTO(\n+                executeAction(Constants.ACTION_GENERATE_TOKEN, userTO));\n     }\n \n     @RequestMapping(method = RequestMethod.POST,\n@@ -305,7 +306,8 @@ public UserTO verifyToken(HttpServletResponse response,\n             @RequestBody UserTO userTO)\n             throws WorkflowException, NotFoundException {\n \n-        return executeAction(Constants.ACTION_VERIFY_TOKEN, userTO);\n+        return userDataBinder.getUserTO(\n+                executeAction(Constants.ACTION_VERIFY_TOKEN, userTO));\n     }\n \n     @RequestMapping(method = RequestMethod.POST,\n@@ -366,7 +368,7 @@ public UserTO update(HttpServletResponse response,\n             required = false) Set<Long> syncRoles,\n             @RequestParam(value = \"syncResources\",\n             required = false) Set<String> syncResources)\n-            throws NotFoundException, PropagationException {\n+            throws NotFoundException, PropagationException, WorkflowException {\n \n         if (log.isDebugEnabled()) {\n             log.debug(\"update called with parameter \" + userMod);\n@@ -380,7 +382,12 @@ public UserTO update(HttpServletResponse response,\n             throw new NotFoundException(String.valueOf(userMod.getId()));\n         }\n \n-       ResourceOperations resourceOperations =\n+        // First of all, let's check if update is allowed\n+        syncopeUser =\n+                executeAction(\"update\", userDataBinder.getUserTO(syncopeUser));\n+\n+        // Update user with provided userMod\n+        ResourceOperations resourceOperations =\n                 userDataBinder.updateSyncopeUser(syncopeUser, userMod);\n         syncopeUser = syncopeUserDAO.save(syncopeUser);\n \n@@ -398,7 +405,6 @@ public UserTO update(HttpServletResponse response,\n             log.debug(\"Propagated onto resources \" + propagatedResources);\n         }\n \n-        // TODO: workflow\n         return userDataBinder.getUserTO(syncopeUser);\n     }\n }"},{"sha":"b701de6b29acd59ff77add1360d519c4ba60b916","filename":"core/src/main/resources/userWorkflow.xml","status":"modified","additions":9,"deletions":4,"changes":13,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/f1ef3467d4f8721251fd216e3508e6d3f265b4aa/core%2Fsrc%2Fmain%2Fresources%2FuserWorkflow.xml","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/f1ef3467d4f8721251fd216e3508e6d3f265b4aa/core%2Fsrc%2Fmain%2Fresources%2FuserWorkflow.xml","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fsrc%2Fmain%2Fresources%2FuserWorkflow.xml?ref=f1ef3467d4f8721251fd216e3508e6d3f265b4aa","patch":"@@ -42,7 +42,12 @@\n         </step>\n         <step name=\"active\" id=\"3\">\n             <actions>\n-                <action name=\"generateToken\" id=\"3004\">\n+                <action name=\"update\" id=\"3001\">\n+                    <results>\n+                        <unconditional-result old-status=\"active\" status=\"active\" step=\"3\"/>\n+                    </results>\n+                </action>\n+                <action name=\"generateToken\" id=\"3002\">\n                     <pre-functions>\n                         <function type=\"class\">\n                             <arg name=\"class.name\">org.syncope.core.workflow.GenerateToken</arg>\n@@ -52,7 +57,7 @@\n                         <unconditional-result old-status=\"active\" status=\"active\" step=\"3\"/>\n                     </results>\n                 </action>\n-                <action name=\"verifyToken\" id=\"3005\">\n+                <action name=\"verifyToken\" id=\"3003\">\n                     <results>\n                         <result old-status=\"active\" status=\"active\" step=\"3\">\n                             <conditions>\n@@ -64,12 +69,12 @@\n                         <unconditional-result old-status=\"active\" status=\"active\" step=\"3\"/>\n                     </results>\n                 </action>\n-                <action name=\"suspend\" id=\"3006\">\n+                <action name=\"suspend\" id=\"3004\">\n                     <results>\n                         <unconditional-result old-status=\"active\" status=\"suspended\" step=\"4\"/>\n                     </results>\n                 </action>\n-                <action name=\"delete\" id=\"3007\">\n+                <action name=\"delete\" id=\"3005\">\n                     <results>\n                         <unconditional-result old-status=\"active\" status=\"deleted\" step=\"5\"/>\n                     </results>"}]}