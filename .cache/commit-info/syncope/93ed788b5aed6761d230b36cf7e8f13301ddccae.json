{"sha":"93ed788b5aed6761d230b36cf7e8f13301ddccae","node_id":"MDY6Q29tbWl0NjM2ODc5MDYyOjkzZWQ3ODhiNWFlZDY3NjFkMjMwYjM2Y2Y3ZThmMTMzMDFkZGNjYWU=","commit":{"author":{"name":"fmartelli","email":"fabio.martelli@gmail.com","date":"2015-11-11T16:05:08Z"},"committer":{"name":"fmartelli","email":"fabio.martelli@gmail.com","date":"2015-11-11T16:05:08Z"},"message":"[SYNCOPE-156] fix for user password managemnet","tree":{"sha":"5eea308ddf4364d71246542dc1e50ab5950fcb0a","url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/git/trees/5eea308ddf4364d71246542dc1e50ab5950fcb0a"},"url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/git/commits/93ed788b5aed6761d230b36cf7e8f13301ddccae","comment_count":0,"verification":{"verified":false,"reason":"unsigned","signature":null,"payload":null}},"url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/93ed788b5aed6761d230b36cf7e8f13301ddccae","html_url":"https://github.com/EnricoDAlessandro97UNI/syncope/commit/93ed788b5aed6761d230b36cf7e8f13301ddccae","comments_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/93ed788b5aed6761d230b36cf7e8f13301ddccae/comments","author":{"login":"fmartelli","id":1791932,"node_id":"MDQ6VXNlcjE3OTE5MzI=","avatar_url":"https://avatars.githubusercontent.com/u/1791932?v=4","gravatar_id":"","url":"https://api.github.com/users/fmartelli","html_url":"https://github.com/fmartelli","followers_url":"https://api.github.com/users/fmartelli/followers","following_url":"https://api.github.com/users/fmartelli/following{/other_user}","gists_url":"https://api.github.com/users/fmartelli/gists{/gist_id}","starred_url":"https://api.github.com/users/fmartelli/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/fmartelli/subscriptions","organizations_url":"https://api.github.com/users/fmartelli/orgs","repos_url":"https://api.github.com/users/fmartelli/repos","events_url":"https://api.github.com/users/fmartelli/events{/privacy}","received_events_url":"https://api.github.com/users/fmartelli/received_events","type":"User","site_admin":false},"committer":{"login":"fmartelli","id":1791932,"node_id":"MDQ6VXNlcjE3OTE5MzI=","avatar_url":"https://avatars.githubusercontent.com/u/1791932?v=4","gravatar_id":"","url":"https://api.github.com/users/fmartelli","html_url":"https://github.com/fmartelli","followers_url":"https://api.github.com/users/fmartelli/followers","following_url":"https://api.github.com/users/fmartelli/following{/other_user}","gists_url":"https://api.github.com/users/fmartelli/gists{/gist_id}","starred_url":"https://api.github.com/users/fmartelli/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/fmartelli/subscriptions","organizations_url":"https://api.github.com/users/fmartelli/orgs","repos_url":"https://api.github.com/users/fmartelli/repos","events_url":"https://api.github.com/users/fmartelli/events{/privacy}","received_events_url":"https://api.github.com/users/fmartelli/received_events","type":"User","site_admin":false},"parents":[{"sha":"3a21e437d7d34e28645e26acbca7e8e232a1fd48","url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/3a21e437d7d34e28645e26acbca7e8e232a1fd48","html_url":"https://github.com/EnricoDAlessandro97UNI/syncope/commit/3a21e437d7d34e28645e26acbca7e8e232a1fd48"}],"stats":{"total":242,"additions":180,"deletions":62},"files":[{"sha":"147d5cb99398bbd2fc0134e504520b2ebec60800","filename":"client/console/src/main/java/org/apache/syncope/client/console/wizards/any/PasswordPanel.java","status":"added","additions":85,"deletions":0,"changes":85,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/93ed788b5aed6761d230b36cf7e8f13301ddccae/client%2Fconsole%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fclient%2Fconsole%2Fwizards%2Fany%2FPasswordPanel.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/93ed788b5aed6761d230b36cf7e8f13301ddccae/client%2Fconsole%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fclient%2Fconsole%2Fwizards%2Fany%2FPasswordPanel.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/client%2Fconsole%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fclient%2Fconsole%2Fwizards%2Fany%2FPasswordPanel.java?ref=93ed788b5aed6761d230b36cf7e8f13301ddccae","patch":"@@ -0,0 +1,85 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *   http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+package org.apache.syncope.client.console.wizards.any;\n+\n+import org.apache.syncope.client.console.commons.JexlHelpUtils;\n+import org.apache.syncope.client.console.wicket.markup.html.form.AjaxPasswordFieldPanel;\n+import org.apache.syncope.client.console.wicket.markup.html.form.FieldPanel;\n+import org.apache.syncope.common.lib.to.UserTO;\n+import org.apache.wicket.ajax.markup.html.AjaxLink;\n+import org.apache.wicket.markup.html.WebMarkupContainer;\n+import org.apache.wicket.markup.html.form.Form;\n+import org.apache.wicket.markup.html.form.PasswordTextField;\n+import org.apache.wicket.markup.html.form.validation.EqualPasswordInputValidator;\n+import org.apache.wicket.markup.html.panel.Panel;\n+import org.apache.wicket.model.Model;\n+import org.apache.wicket.model.PropertyModel;\n+\n+public class PasswordPanel extends Panel {\n+\n+    private static final long serialVersionUID = 6592027822510220463L;\n+\n+    public PasswordPanel(\n+            final String id, final UserTO userTO, final boolean resetPassword, final boolean templateMode) {\n+        super(id);\n+        \n+        setOutputMarkupId(true);\n+        \n+        final Form<?> form = new Form<>(\"passwordInnerForm\");\n+        add(form);\n+\n+        final WebMarkupContainer pwdJexlHelp = JexlHelpUtils.getJexlHelpWebContainer(\"pwdJexlHelp\");\n+\n+        final AjaxLink<?> pwdQuestionMarkJexlHelp = JexlHelpUtils.getAjaxLink(pwdJexlHelp, \"pwdQuestionMarkJexlHelp\");\n+        form.add(pwdQuestionMarkJexlHelp);\n+        pwdQuestionMarkJexlHelp.add(pwdJexlHelp);\n+\n+        FieldPanel<String> passwordField = new AjaxPasswordFieldPanel(\n+                \"password\", \"password\", new PropertyModel<String>(userTO, \"password\"), false);\n+        passwordField.setRequired(true);\n+        passwordField.setMarkupId(\"password\");\n+        passwordField.setPlaceholder(\"password\");\n+        ((PasswordTextField) passwordField.getField()).setResetPassword(true);\n+        form.add(passwordField);\n+\n+        FieldPanel<String> confirmPasswordField = new AjaxPasswordFieldPanel(\n+                \"confirmPassword\", \"confirmPassword\", new Model<String>(), false);\n+        passwordField.setRequired(true);\n+        confirmPasswordField.setMarkupId(\"confirmPassword\");\n+        confirmPasswordField.setPlaceholder(\"confirmPassword\");\n+        ((PasswordTextField) confirmPasswordField.getField()).setResetPassword(true);\n+        form.add(confirmPasswordField);\n+\n+        form.add(new EqualPasswordInputValidator(passwordField.getField(), confirmPasswordField.getField()));\n+\n+        if (templateMode) {\n+            confirmPasswordField.setEnabled(false);\n+            confirmPasswordField.setVisible(false);\n+        } else {\n+            pwdQuestionMarkJexlHelp.setVisible(false);\n+\n+            ((PasswordTextField) passwordField.getField()).setResetPassword(resetPassword);\n+\n+            if (!resetPassword) {\n+                confirmPasswordField.getField().setModelObject(userTO.getPassword());\n+            }\n+            ((PasswordTextField) confirmPasswordField.getField()).setResetPassword(resetPassword);\n+        }\n+    }\n+}"},{"sha":"e669464d32f6e7d93541b8638c05a1354269eb65","filename":"client/console/src/main/java/org/apache/syncope/client/console/wizards/any/UserDetails.java","status":"modified","additions":49,"deletions":43,"changes":92,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/93ed788b5aed6761d230b36cf7e8f13301ddccae/client%2Fconsole%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fclient%2Fconsole%2Fwizards%2Fany%2FUserDetails.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/93ed788b5aed6761d230b36cf7e8f13301ddccae/client%2Fconsole%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fclient%2Fconsole%2Fwizards%2Fany%2FUserDetails.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/client%2Fconsole%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fclient%2Fconsole%2Fwizards%2Fany%2FUserDetails.java?ref=93ed788b5aed6761d230b36cf7e8f13301ddccae","patch":"@@ -18,24 +18,32 @@\n  */\n package org.apache.syncope.client.console.wizards.any;\n \n+import de.agilecoders.wicket.core.markup.html.bootstrap.tabs.Collapsible;\n+import java.util.Collections;\n+import org.apache.syncope.client.console.commons.Constants;\n import org.apache.syncope.client.console.commons.JexlHelpUtils;\n-import org.apache.syncope.client.console.wicket.markup.html.form.AjaxPasswordFieldPanel;\n import org.apache.syncope.client.console.wicket.markup.html.form.AjaxTextFieldPanel;\n import org.apache.syncope.client.console.wicket.markup.html.form.FieldPanel;\n import org.apache.syncope.common.lib.to.UserTO;\n+import org.apache.wicket.Component;\n+import org.apache.wicket.ajax.AjaxEventBehavior;\n+import org.apache.wicket.ajax.AjaxRequestTarget;\n import org.apache.wicket.ajax.markup.html.AjaxLink;\n+import org.apache.wicket.extensions.markup.html.tabs.AbstractTab;\n+import org.apache.wicket.extensions.markup.html.tabs.ITab;\n import org.apache.wicket.extensions.wizard.WizardStep;\n import org.apache.wicket.markup.html.WebMarkupContainer;\n-import org.apache.wicket.markup.html.form.Form;\n-import org.apache.wicket.markup.html.form.PasswordTextField;\n-import org.apache.wicket.markup.html.form.validation.EqualPasswordInputValidator;\n+import org.apache.wicket.markup.html.panel.Panel;\n import org.apache.wicket.model.Model;\n import org.apache.wicket.model.PropertyModel;\n+import org.apache.wicket.model.ResourceModel;\n \n public class UserDetails extends WizardStep {\n \n     private static final long serialVersionUID = 6592027822510220463L;\n \n+    private static final String PASSWORD_CONTENT_PATH = \"tabs:0:body:content\";\n+\n     public UserDetails(final UserTO userTO, final boolean resetPassword, final boolean templateMode) {\n         // ------------------------\n         // Username\n@@ -59,46 +67,44 @@ public UserDetails(final UserTO userTO, final boolean resetPassword, final boole\n         // ------------------------\n         // Password\n         // ------------------------\n-        final Form<?> form = new Form<>(\"passwordInnerForm\");\n-        add(form);\n-\n-        final WebMarkupContainer pwdJexlHelp = JexlHelpUtils.getJexlHelpWebContainer(\"pwdJexlHelp\");\n-\n-        final AjaxLink<?> pwdQuestionMarkJexlHelp = JexlHelpUtils.getAjaxLink(pwdJexlHelp, \"pwdQuestionMarkJexlHelp\");\n-        form.add(pwdQuestionMarkJexlHelp);\n-        pwdQuestionMarkJexlHelp.add(pwdJexlHelp);\n-\n-        FieldPanel<String> passwordField = new AjaxPasswordFieldPanel(\n-                \"password\", \"password\", new PropertyModel<String>(userTO, \"password\"), false);\n-        passwordField.setRequired(true);\n-        passwordField.setMarkupId(\"password\");\n-        passwordField.setPlaceholder(\"password\");\n-        ((PasswordTextField) passwordField.getField()).setResetPassword(true);\n-        form.add(passwordField);\n-\n-        FieldPanel<String> confirmPasswordField = new AjaxPasswordFieldPanel(\n-                \"confirmPassword\", \"confirmPassword\", new Model<String>(), false);\n-        confirmPasswordField.setRequired(true);\n-        confirmPasswordField.setMarkupId(\"confirmPassword\");\n-        confirmPasswordField.setPlaceholder(\"confirmPassword\");\n-        ((PasswordTextField) confirmPasswordField.getField()).setResetPassword(true);\n-        form.add(confirmPasswordField);\n-\n-        form.add(new EqualPasswordInputValidator(passwordField.getField(), confirmPasswordField.getField()));\n-\n-        if (templateMode) {\n-            confirmPasswordField.setEnabled(false);\n-            confirmPasswordField.setVisible(false);\n-        } else {\n-            pwdQuestionMarkJexlHelp.setVisible(false);\n-\n-            ((PasswordTextField) passwordField.getField()).setResetPassword(resetPassword);\n-\n-            if (!resetPassword) {\n-                confirmPasswordField.getField().setModelObject(userTO.getPassword());\n+        final Model<Integer> model = Model.of(-1);\n+\n+        final Collapsible collapsible = new Collapsible(\"collapsePanel\", Collections.<ITab>singletonList(\n+                new AbstractTab(new ResourceModel(\"password.change\", \"Change password\")) {\n+\n+                    private static final long serialVersionUID = 1037272333056449378L;\n+\n+                    @Override\n+                    public Panel getPanel(final String panelId) {\n+                        final PasswordPanel panel = new PasswordPanel(panelId, userTO, resetPassword, templateMode);\n+                        panel.setEnabled(model.getObject() >= 0);\n+                        return panel;\n+                    }\n+                }\n+        ), model) {\n+\n+            private static final long serialVersionUID = 1L;\n+\n+            @Override\n+            protected Component newTitle(final String markupId, final ITab tab, final Collapsible.State state) {\n+                return super.newTitle(markupId, tab, state).add(new AjaxEventBehavior(Constants.ON_CLICK) {\n+\n+                    private static final long serialVersionUID = 1L;\n+\n+                    @Override\n+                    protected void onEvent(final AjaxRequestTarget target) {\n+                        model.setObject(model.getObject() == 0 ? -1 : 0);\n+                        final Component passwordPanel = get(PASSWORD_CONTENT_PATH);\n+                        passwordPanel.setEnabled(model.getObject() >= 0);\n+                        target.add(passwordPanel);\n+                    }\n+                });\n             }\n-            ((PasswordTextField) confirmPasswordField.getField()).setResetPassword(resetPassword);\n-        }\n+\n+        };\n+\n+        collapsible.setOutputMarkupId(true);\n+        add(collapsible);\n         // ------------------------\n     }\n }"},{"sha":"f08c85be210f3f521c15e88dd34f8345eba9bb7c","filename":"client/console/src/main/resources/org/apache/syncope/client/console/wizards/any/PasswordPanel.html","status":"added","additions":44,"deletions":0,"changes":44,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/93ed788b5aed6761d230b36cf7e8f13301ddccae/client%2Fconsole%2Fsrc%2Fmain%2Fresources%2Forg%2Fapache%2Fsyncope%2Fclient%2Fconsole%2Fwizards%2Fany%2FPasswordPanel.html","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/93ed788b5aed6761d230b36cf7e8f13301ddccae/client%2Fconsole%2Fsrc%2Fmain%2Fresources%2Forg%2Fapache%2Fsyncope%2Fclient%2Fconsole%2Fwizards%2Fany%2FPasswordPanel.html","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/client%2Fconsole%2Fsrc%2Fmain%2Fresources%2Forg%2Fapache%2Fsyncope%2Fclient%2Fconsole%2Fwizards%2Fany%2FPasswordPanel.html?ref=93ed788b5aed6761d230b36cf7e8f13301ddccae","patch":"@@ -0,0 +1,44 @@\n+<!--\n+Licensed to the Apache Software Foundation (ASF) under one\n+or more contributor license agreements.  See the NOTICE file\n+distributed with this work for additional information\n+regarding copyright ownership.  The ASF licenses this file\n+to you under the Apache License, Version 2.0 (the\n+\"License\"); you may not use this file except in compliance\n+with the License.  You may obtain a copy of the License at\n+\n+  http://www.apache.org/licenses/LICENSE-2.0\n+\n+Unless required by applicable law or agreed to in writing,\n+software distributed under the License is distributed on an\n+\"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+KIND, either express or implied.  See the License for the\n+specific language governing permissions and limitations\n+under the License.\n+-->\n+<html xmlns=\"http://www.w3.org/1999/xhtml\" xmlns:wicket=\"http://wicket.apache.org\">\n+  <head><title></title></head>\n+  <body>\n+    <wicket:panel>\n+      <form wicket:id=\"passwordInnerForm\">\n+        <div class=\"form-group\">\n+          <span wicket:id=\"password\"/>\n+          <a class=\"tooltips\" wicket:id=\"pwdQuestionMarkJexlHelp\" href=\"#\" alt=\"Click to help\" title=\"Click to help\">\n+            <img src=\"img/help.png\"/>\n+            <span wicket:id=\"pwdJexlHelp\" class=\"tooltips\">\n+              <wicket:message key=\"jexl_info\"/>\n+              <ul>\n+                <li><wicket:message key=\"jexl_ex1\"/></li>\n+                <li><wicket:message key=\"jexl_ex2\"/></li>\n+              </ul>\n+              <a href=\"#\" wicket:id=\"jexlLink\" target=\"_blank\"><wicket:message key=\"jexl_syntax_url\"/></a>\n+            </span>\n+          </a>\n+        </div>\n+        <div class=\"form-group\">\n+          <span wicket:id=\"confirmPassword\"/>\n+        </div>\n+      </form>\n+    </wicket:panel>\n+  </body>\n+</html>"},{"sha":"a676f1e644ad626ef1bb99fccda472c98da63462","filename":"client/console/src/main/resources/org/apache/syncope/client/console/wizards/any/UserDetails.html","status":"modified","additions":2,"deletions":19,"changes":21,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/93ed788b5aed6761d230b36cf7e8f13301ddccae/client%2Fconsole%2Fsrc%2Fmain%2Fresources%2Forg%2Fapache%2Fsyncope%2Fclient%2Fconsole%2Fwizards%2Fany%2FUserDetails.html","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/93ed788b5aed6761d230b36cf7e8f13301ddccae/client%2Fconsole%2Fsrc%2Fmain%2Fresources%2Forg%2Fapache%2Fsyncope%2Fclient%2Fconsole%2Fwizards%2Fany%2FUserDetails.html","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/client%2Fconsole%2Fsrc%2Fmain%2Fresources%2Forg%2Fapache%2Fsyncope%2Fclient%2Fconsole%2Fwizards%2Fany%2FUserDetails.html?ref=93ed788b5aed6761d230b36cf7e8f13301ddccae","patch":"@@ -35,25 +35,8 @@\n         </a>\n       </div>\n \n-      <form wicket:id=\"passwordInnerForm\">\n-        <div class=\"form-group\">\n-          <span wicket:id=\"password\"/>\n-          <a class=\"tooltips\" wicket:id=\"pwdQuestionMarkJexlHelp\" href=\"#\" alt=\"Click to help\" title=\"Click to help\">\n-            <img src=\"img/help.png\"/>\n-            <span wicket:id=\"pwdJexlHelp\" class=\"tooltips\">\n-              <wicket:message key=\"jexl_info\"/>\n-              <ul>\n-                <li><wicket:message key=\"jexl_ex1\"/></li>\n-                <li><wicket:message key=\"jexl_ex2\"/></li>\n-              </ul>\n-              <a href=\"#\" wicket:id=\"jexlLink\" target=\"_blank\"><wicket:message key=\"jexl_syntax_url\"/></a>\n-            </span>\n-          </a>\n-        </div>\n-        <div class=\"form-group\">\n-          <span wicket:id=\"confirmPassword\"/>\n-        </div>\n-      </form>\n+      <div wicket:id=\"collapsePanel\"></div>\n+\n     </wicket:panel>\n   </body>\n </html>"}]}