{"sha":"52a8f98a52f06e860312eb715fdfeda1af953918","node_id":"MDY6Q29tbWl0NjM2ODc5MDYyOjUyYThmOThhNTJmMDZlODYwMzEyZWI3MTVmZGZlZGExYWY5NTM5MTg=","commit":{"author":{"name":"Fabio Martelli","email":"fmartelli@apache.org","date":"2013-02-26T16:29:23Z"},"committer":{"name":"Fabio Martelli","email":"fmartelli@apache.org","date":"2013-02-26T16:29:23Z"},"message":"Fixes SYNCOPE-265\n\ngit-svn-id: https://svn.apache.org/repos/asf/syncope/trunk@1450260 13f79535-47bb-0310-9956-ffa450edef68","tree":{"sha":"7ecabbd07c4fe1a995b12ca885f45f2fdf0f73db","url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/git/trees/7ecabbd07c4fe1a995b12ca885f45f2fdf0f73db"},"url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/git/commits/52a8f98a52f06e860312eb715fdfeda1af953918","comment_count":0,"verification":{"verified":false,"reason":"unsigned","signature":null,"payload":null}},"url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/52a8f98a52f06e860312eb715fdfeda1af953918","html_url":"https://github.com/EnricoDAlessandro97UNI/syncope/commit/52a8f98a52f06e860312eb715fdfeda1af953918","comments_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/52a8f98a52f06e860312eb715fdfeda1af953918/comments","author":{"login":"fmartelli","id":1791932,"node_id":"MDQ6VXNlcjE3OTE5MzI=","avatar_url":"https://avatars.githubusercontent.com/u/1791932?v=4","gravatar_id":"","url":"https://api.github.com/users/fmartelli","html_url":"https://github.com/fmartelli","followers_url":"https://api.github.com/users/fmartelli/followers","following_url":"https://api.github.com/users/fmartelli/following{/other_user}","gists_url":"https://api.github.com/users/fmartelli/gists{/gist_id}","starred_url":"https://api.github.com/users/fmartelli/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/fmartelli/subscriptions","organizations_url":"https://api.github.com/users/fmartelli/orgs","repos_url":"https://api.github.com/users/fmartelli/repos","events_url":"https://api.github.com/users/fmartelli/events{/privacy}","received_events_url":"https://api.github.com/users/fmartelli/received_events","type":"User","site_admin":false},"committer":{"login":"fmartelli","id":1791932,"node_id":"MDQ6VXNlcjE3OTE5MzI=","avatar_url":"https://avatars.githubusercontent.com/u/1791932?v=4","gravatar_id":"","url":"https://api.github.com/users/fmartelli","html_url":"https://github.com/fmartelli","followers_url":"https://api.github.com/users/fmartelli/followers","following_url":"https://api.github.com/users/fmartelli/following{/other_user}","gists_url":"https://api.github.com/users/fmartelli/gists{/gist_id}","starred_url":"https://api.github.com/users/fmartelli/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/fmartelli/subscriptions","organizations_url":"https://api.github.com/users/fmartelli/orgs","repos_url":"https://api.github.com/users/fmartelli/repos","events_url":"https://api.github.com/users/fmartelli/events{/privacy}","received_events_url":"https://api.github.com/users/fmartelli/received_events","type":"User","site_admin":false},"parents":[{"sha":"fcc9a88c63e6b298a845a5e32da5fa6b743d3809","url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/fcc9a88c63e6b298a845a5e32da5fa6b743d3809","html_url":"https://github.com/EnricoDAlessandro97UNI/syncope/commit/fcc9a88c63e6b298a845a5e32da5fa6b743d3809"}],"stats":{"total":146,"additions":101,"deletions":45},"files":[{"sha":"b53e4dfe0a56637947f4881907e8e524b56a9722","filename":"console/src/main/java/org/apache/syncope/console/pages/panels/ResourceMappingPanel.java","status":"modified","additions":8,"deletions":2,"changes":10,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/52a8f98a52f06e860312eb715fdfeda1af953918/console%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fconsole%2Fpages%2Fpanels%2FResourceMappingPanel.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/52a8f98a52f06e860312eb715fdfeda1af953918/console%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fconsole%2Fpages%2Fpanels%2FResourceMappingPanel.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/console%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fconsole%2Fpages%2Fpanels%2FResourceMappingPanel.java?ref=52a8f98a52f06e860312eb715fdfeda1af953918","patch":"@@ -407,12 +407,18 @@ protected void onUpdate(final AjaxRequestTarget target) {\n                 final AjaxDropDownChoicePanel purpose = new AjaxDropDownChoicePanel<String>(\n                         \"purpose\",\n                         new ResourceModel(\"purpose\", \"purpose\").getObject(),\n-                        new PropertyModel(mapItem, \"purpose\"), \n+                        new PropertyModel(mapItem, \"purpose\"),\n                         false);\n                 ((AjaxDropDownChoicePanel) purpose).setChoices(Arrays.asList(MappingPurpose.values()));\n                 purpose.setStyleSheet(FIELD_STYLE);\n                 purpose.setRequired(true);\n-                \n+                purpose.getField().add(new AjaxFormComponentUpdatingBehavior(ON_CHANGE) {\n+\n+                    @Override\n+                    protected void onUpdate(AjaxRequestTarget art) {\n+                    }\n+                });\n+\n                 item.add(purpose);\n \n                 typesPanel.getField().add(new AjaxFormComponentUpdatingBehavior(ON_CHANGE) {"},{"sha":"4af3e24ccda392cd857f46e68f4e7ffaca06fa02","filename":"core/src/main/java/org/apache/syncope/core/init/SpringContextInitializer.java","status":"modified","additions":4,"deletions":2,"changes":6,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/52a8f98a52f06e860312eb715fdfeda1af953918/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Finit%2FSpringContextInitializer.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/52a8f98a52f06e860312eb715fdfeda1af953918/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Finit%2FSpringContextInitializer.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Finit%2FSpringContextInitializer.java?ref=52a8f98a52f06e860312eb715fdfeda1af953918","patch":"@@ -50,11 +50,13 @@ public class SpringContextInitializer implements InitializingBean {\n \n     @Override\n     public void afterPropertiesSet() throws Exception {\n-        contentLoader.load(workflowAdapterLoader.getInitSQLStatements());\n+        workflowAdapterLoader.load();\n+        contentLoader.load();\n         connFactory.load();\n         jobInstanceLoader.load();\n         loggerLoader.load();\n         classNamesLoader.load();\n-        workflowAdapterLoader.load();\n+\n+        workflowAdapterLoader.init();\n     }\n }"},{"sha":"45dc855a07b0d1acd7c96ba0ad28ed22e05ef0ee","filename":"core/src/main/java/org/apache/syncope/core/init/WorkflowAdapterLoader.java","status":"modified","additions":4,"deletions":2,"changes":6,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/52a8f98a52f06e860312eb715fdfeda1af953918/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Finit%2FWorkflowAdapterLoader.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/52a8f98a52f06e860312eb715fdfeda1af953918/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Finit%2FWorkflowAdapterLoader.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Finit%2FWorkflowAdapterLoader.java?ref=52a8f98a52f06e860312eb715fdfeda1af953918","patch":"@@ -69,9 +69,11 @@ public String getTablePrefix() {\n         return wfLoader == null ? null : wfLoader.getTablePrefix();\n     }\n \n-    public String[] getInitSQLStatements() {\n+    public void init() {\n         lazyInit();\n-        return wfLoader == null ? null : wfLoader.getInitSQLStatements();\n+        if (wfLoader != null) {\n+            wfLoader.init();\n+        }\n     }\n \n     public void load() {"},{"sha":"2e2a89a494c12eb0481ebe438575da4a82cb7cd7","filename":"core/src/main/java/org/apache/syncope/core/persistence/dao/impl/ContentLoader.java","status":"modified","additions":9,"deletions":6,"changes":15,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/52a8f98a52f06e860312eb715fdfeda1af953918/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fpersistence%2Fdao%2Fimpl%2FContentLoader.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/52a8f98a52f06e860312eb715fdfeda1af953918/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fpersistence%2Fdao%2Fimpl%2FContentLoader.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fpersistence%2Fdao%2Fimpl%2FContentLoader.java?ref=52a8f98a52f06e860312eb715fdfeda1af953918","patch":"@@ -56,7 +56,12 @@ public class ContentLoader {\n     private ImportExport importExport;\n \n     @Transactional\n-    public void load(final String[] wfInitSQLStatements) {\n+    public void wfInit(final String[] wfInitSQLStatements) {\n+        importExport.setWfInitSQLStatements(wfInitSQLStatements);\n+    }\n+\n+    @Transactional\n+    public void load() {\n         Connection conn = null;\n         try {\n             conn = DataSourceUtils.getConnection(dataSource);\n@@ -67,9 +72,9 @@ public void load(final String[] wfInitSQLStatements) {\n             } else {\n                 LOG.info(\"Empty database found, loading default content\");\n \n-                createViews(conn);\n+                loadDefaultContent();\n                 createIndexes(conn);\n-                loadDefaultContent(wfInitSQLStatements);\n+                createViews(conn);\n             }\n         } finally {\n             DataSourceUtils.releaseConnection(conn, dataSource);\n@@ -172,14 +177,12 @@ private void createIndexes(final Connection conn) {\n         }\n     }\n \n-    private void loadDefaultContent(final String[] wfInitSQLStatements) {\n+    private void loadDefaultContent() {\n         SAXParserFactory factory = SAXParserFactory.newInstance();\n         InputStream in = null;\n         try {\n             in = getClass().getResourceAsStream(\"/\" + ImportExport.CONTENT_FILE);\n \n-            importExport.setWfInitSQLStatements(wfInitSQLStatements);\n-\n             SAXParser parser = factory.newSAXParser();\n             parser.parse(in, importExport);\n             LOG.debug(\"Default content successfully loaded\");"},{"sha":"ac361f432e1058534a95874986c4f2bf9a3ee01f","filename":"core/src/main/java/org/apache/syncope/core/workflow/WorkflowInstanceLoader.java","status":"modified","additions":1,"deletions":1,"changes":2,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/52a8f98a52f06e860312eb715fdfeda1af953918/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fworkflow%2FWorkflowInstanceLoader.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/52a8f98a52f06e860312eb715fdfeda1af953918/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fworkflow%2FWorkflowInstanceLoader.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fworkflow%2FWorkflowInstanceLoader.java?ref=52a8f98a52f06e860312eb715fdfeda1af953918","patch":"@@ -24,5 +24,5 @@ public interface WorkflowInstanceLoader {\n \n     String getTablePrefix();\n \n-    String[] getInitSQLStatements();\n+    void init();\n }"},{"sha":"01552113226eb3aa04c28162984e358d096b80cd","filename":"core/src/main/java/org/apache/syncope/core/workflow/user/activiti/ActivitiWorkflowLoader.java","status":"modified","additions":11,"deletions":16,"changes":27,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/52a8f98a52f06e860312eb715fdfeda1af953918/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fworkflow%2Fuser%2Factiviti%2FActivitiWorkflowLoader.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/52a8f98a52f06e860312eb715fdfeda1af953918/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fworkflow%2Fuser%2Factiviti%2FActivitiWorkflowLoader.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fworkflow%2Fuser%2Factiviti%2FActivitiWorkflowLoader.java?ref=52a8f98a52f06e860312eb715fdfeda1af953918","patch":"@@ -19,12 +19,11 @@\n package org.apache.syncope.core.workflow.user.activiti;\n \n import java.io.InputStream;\n-import java.util.ArrayList;\n import java.util.List;\n import org.activiti.engine.RepositoryService;\n import org.activiti.engine.repository.ProcessDefinition;\n+import org.activiti.spring.SpringProcessEngineConfiguration;\n import org.apache.commons.io.IOUtils;\n-import org.apache.syncope.core.workflow.ActivitiDetector;\n import org.apache.syncope.core.workflow.WorkflowInstanceLoader;\n import org.slf4j.Logger;\n import org.slf4j.LoggerFactory;\n@@ -37,24 +36,20 @@ public class ActivitiWorkflowLoader implements WorkflowInstanceLoader {\n     @Autowired\n     private RepositoryService repositoryService;\n \n+    @Autowired\n+    private SpringProcessEngineConfiguration springProcessEngineConfiguration;\n+\n     @Override\n     public String getTablePrefix() {\n         return \"ACT_\";\n     }\n \n     @Override\n-    public String[] getInitSQLStatements() {\n-        final List<String> initSQLStatements = new ArrayList<String>();\n-\n-        initSQLStatements.add(\"DELETE FROM ACT_GE_PROPERTY\");\n-        initSQLStatements.add(\"INSERT INTO ACT_GE_PROPERTY(NAME_, VALUE_, REV_) \"\n-                + \"VALUES('schema.version', '\" + ActivitiDetector.getActivitiVersion() + \"', 1)\");\n-        initSQLStatements.add(\"INSERT INTO ACT_GE_PROPERTY(NAME_, VALUE_, REV_) \"\n-                + \"VALUES('schema.history', 'create(\" + ActivitiDetector.getActivitiVersion() + \")', 1)\");\n-        initSQLStatements.add(\"INSERT INTO ACT_GE_PROPERTY(NAME_, VALUE_, REV_) VALUES('next.dbid', '1', 1)\");\n-        initSQLStatements.add(\"INSERT INTO ACT_GE_PROPERTY(NAME_, VALUE_, REV_) VALUES('historyLevel', '1', 1)\");\n-\n-        return initSQLStatements.toArray(new String[initSQLStatements.size()]);\n+    public void init() {\n+        // jump to the next ID block\n+        for (int i = 0; i < springProcessEngineConfiguration.getIdBlockSize(); i++) {\n+            springProcessEngineConfiguration.getIdGenerator().getNextId();\n+        }\n     }\n \n     @Override\n@@ -67,8 +62,8 @@ public void load() {\n         if (processes.isEmpty()) {\n             InputStream wfDefinitionStream = null;\n             try {\n-                wfDefinitionStream = getClass().getResourceAsStream(\n-                        \"/\" + ActivitiUserWorkflowAdapter.WF_PROCESS_RESOURCE);\n+                wfDefinitionStream =\n+                        getClass().getResourceAsStream(\"/\" + ActivitiUserWorkflowAdapter.WF_PROCESS_RESOURCE);\n \n                 repositoryService.createDeployment().addInputStream(\n                         ActivitiUserWorkflowAdapter.WF_PROCESS_RESOURCE, wfDefinitionStream).deploy();"},{"sha":"13dafcee7a77652cbcfb66f6e0a30c9fdfb9ad68","filename":"core/src/test/java/org/apache/syncope/core/persistence/dao/AttrTest.java","status":"modified","additions":1,"deletions":1,"changes":2,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/52a8f98a52f06e860312eb715fdfeda1af953918/core%2Fsrc%2Ftest%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fpersistence%2Fdao%2FAttrTest.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/52a8f98a52f06e860312eb715fdfeda1af953918/core%2Fsrc%2Ftest%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fpersistence%2Fdao%2FAttrTest.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fsrc%2Ftest%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fpersistence%2Fdao%2FAttrTest.java?ref=52a8f98a52f06e860312eb715fdfeda1af953918","patch":"@@ -54,7 +54,7 @@ public class AttrTest extends AbstractDAOTest {\n     @Test\n     public void findAll() {\n         List<UAttr> list = attrDAO.findAll(UAttr.class);\n-        assertEquals(\"did not get expected number of attributes \", 24, list.size());\n+        assertEquals(\"did not get expected number of attributes \", 28, list.size());\n     }\n \n     @Test"},{"sha":"61186aead34a63cd4d9154db6449e4aa3d1dd9f4","filename":"core/src/test/java/org/apache/syncope/core/persistence/dao/DerAttrTest.java","status":"modified","additions":1,"deletions":1,"changes":2,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/52a8f98a52f06e860312eb715fdfeda1af953918/core%2Fsrc%2Ftest%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fpersistence%2Fdao%2FDerAttrTest.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/52a8f98a52f06e860312eb715fdfeda1af953918/core%2Fsrc%2Ftest%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fpersistence%2Fdao%2FDerAttrTest.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fsrc%2Ftest%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fpersistence%2Fdao%2FDerAttrTest.java?ref=52a8f98a52f06e860312eb715fdfeda1af953918","patch":"@@ -63,7 +63,7 @@ public class DerAttrTest extends AbstractDAOTest {\n     @Test\n     public void findAll() {\n         List<UDerAttr> list = derAttrDAO.findAll(UDerAttr.class);\n-        assertEquals(\"did not get expected number of derived attributes \", 1, list.size());\n+        assertEquals(\"did not get expected number of derived attributes \", 2, list.size());\n     }\n \n     @Test"},{"sha":"20609938ea3441a6f3338ebc9202b5a64b01f18b","filename":"core/src/test/java/org/apache/syncope/core/persistence/dao/impl/TestDbInitializer.java","status":"modified","additions":1,"deletions":1,"changes":2,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/52a8f98a52f06e860312eb715fdfeda1af953918/core%2Fsrc%2Ftest%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fpersistence%2Fdao%2Fimpl%2FTestDbInitializer.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/52a8f98a52f06e860312eb715fdfeda1af953918/core%2Fsrc%2Ftest%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fpersistence%2Fdao%2Fimpl%2FTestDbInitializer.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fsrc%2Ftest%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fpersistence%2Fdao%2Fimpl%2FTestDbInitializer.java?ref=52a8f98a52f06e860312eb715fdfeda1af953918","patch":"@@ -33,6 +33,6 @@ public class TestDbInitializer implements InitializingBean {\n \n     @Override\n     public void afterPropertiesSet() throws Exception {\n-        contentLoader.load(null);\n+        contentLoader.load();\n     }\n }"},{"sha":"8cbc300a5c910954a0406a110c0d09867ed2961c","filename":"core/src/test/java/org/apache/syncope/core/rest/UserTestITCase.java","status":"modified","additions":24,"deletions":7,"changes":31,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/52a8f98a52f06e860312eb715fdfeda1af953918/core%2Fsrc%2Ftest%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Frest%2FUserTestITCase.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/52a8f98a52f06e860312eb715fdfeda1af953918/core%2Fsrc%2Ftest%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Frest%2FUserTestITCase.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fsrc%2Ftest%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Frest%2FUserTestITCase.java?ref=52a8f98a52f06e860312eb715fdfeda1af953918","patch":"@@ -565,7 +565,7 @@ public void createWithReject() {\n         assertNull(form.getOwner());\n \n         // 3. claim task from rossini, not in role 7 (designated for approval in workflow definition): fail\n-        UserWorkflowService userService2 = \n+        UserWorkflowService userService2 =\n                 setupCredentials(userWorkflowService, UserWorkflowService.class, \"rossini\", ADMIN_PWD);\n \n         try {\n@@ -576,7 +576,7 @@ public void createWithReject() {\n         }\n \n         // 4. claim task from bellini, in role 7\n-        UserWorkflowService userService3 = \n+        UserWorkflowService userService3 =\n                 setupCredentials(userWorkflowService, UserWorkflowService.class, \"bellini\", ADMIN_PWD);\n \n         form = userService3.claimForm(form.getTaskId());\n@@ -2025,11 +2025,11 @@ public void virAttrCache() {\n         assertNotNull(actual);\n         assertEquals(\"virtualupdated\", actual.getVirtualAttributeMap().get(\"virtualdata\").getValues().get(0));\n     }\n-    \n+\n     @Test\n     public void mappingPurpose() {\n         UserTO userTO = getUniqueSampleTO(\"mpurpose@apache.org\");\n-        \n+\n         AttributeTO csvuserid = new AttributeTO();\n         csvuserid.setSchema(\"csvuserid\");\n         userTO.addDerivedAttribute(csvuserid);\n@@ -2039,14 +2039,31 @@ public void mappingPurpose() {\n \n         UserTO actual = createUser(userTO);\n         assertNotNull(actual);\n-        \n+\n         final ConnObjectTO connObjectTO = resourceService.getConnector(\n-                \"resource-csv\", \n+                \"resource-csv\",\n                 AttributableType.USER, actual.getDerivedAttributeMap().get(\"csvuserid\").getValues().get(0));\n-        \n+\n         assertNull(connObjectTO.getAttributeMap().get(\"email\"));\n     }\n \n+    public void issueSYNCOPE265() {\n+        for (long i = 1; i <= 5; i++) {\n+            UserMod userMod = new UserMod();\n+            userMod.setId(i);\n+\n+            AttributeMod attributeMod = new AttributeMod();\n+            attributeMod.setSchema(\"type\");\n+            attributeMod.addValueToBeAdded(\"a type\");\n+\n+            userMod.addAttributeToBeRemoved(\"type\");\n+            userMod.addAttributeToBeUpdated(attributeMod);\n+\n+            UserTO userTO = userService.update(i, userMod);\n+            assertEquals(\"a type\", userTO.getAttributeMap().get(\"type\").getValues().get(0));\n+        }\n+    }\n+\n     private boolean getBooleanAttribute(ConnObjectTO connObjectTO, String attrName) {\n         return Boolean.parseBoolean(getStringAttribute(connObjectTO, attrName));\n     }"},{"sha":"bb651083e06a3aa2b4dbcc976ff4f15e940669e8","filename":"core/src/test/resources/content.xml","status":"modified","additions":37,"deletions":6,"changes":43,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/52a8f98a52f06e860312eb715fdfeda1af953918/core%2Fsrc%2Ftest%2Fresources%2Fcontent.xml","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/52a8f98a52f06e860312eb715fdfeda1af953918/core%2Fsrc%2Ftest%2Fresources%2Fcontent.xml","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fsrc%2Ftest%2Fresources%2Fcontent.xml?ref=52a8f98a52f06e860312eb715fdfeda1af953918","patch":"@@ -41,15 +41,15 @@ under the License.\n   <Policy DTYPE=\"PasswordPolicy\" id=\"8\" description=\"sample password policy\" type=\"PASSWORD\" specification=\"%3Corg.apache.syncope.common.types.PasswordPolicySpec%3E%0A++%3ChistoryLength%3E0%3C%2FhistoryLength%3E%0A++%3CmaxLength%3E0%3C%2FmaxLength%3E%0A++%3CminLength%3E10%3C%2FminLength%3E%0A++%3CnonAlphanumericRequired%3Etrue%3C%2FnonAlphanumericRequired%3E%0A++%3CalphanumericRequired%3Efalse%3C%2FalphanumericRequired%3E%0A++%3CdigitRequired%3Etrue%3C%2FdigitRequired%3E%0A++%3ClowercaseRequired%3Etrue%3C%2FlowercaseRequired%3E%0A++%3CuppercaseRequired%3Etrue%3C%2FuppercaseRequired%3E%0A++%3CmustStartWithDigit%3Etrue%3C%2FmustStartWithDigit%3E%0A++%3CmustntStartWithDigit%3Efalse%3C%2FmustntStartWithDigit%3E%0A++%3CmustEndWithDigit%3Etrue%3C%2FmustEndWithDigit%3E%0A++%3CmustntEndWithDigit%3Efalse%3C%2FmustntEndWithDigit%3E%0A++%3CmustStartWithNonAlpha%3Efalse%3C%2FmustStartWithNonAlpha%3E%0A++%3CmustStartWithAlpha%3Efalse%3C%2FmustStartWithAlpha%3E%0A++%3CmustntStartWithNonAlpha%3Efalse%3C%2FmustntStartWithNonAlpha%3E%0A++%3CmustntStartWithAlpha%3Efalse%3C%2FmustntStartWithAlpha%3E%0A++%3CmustEndWithNonAlpha%3Efalse%3C%2FmustEndWithNonAlpha%3E%0A++%3CmustEndWithAlpha%3Efalse%3C%2FmustEndWithAlpha%3E%0A++%3CmustntEndWithNonAlpha%3Efalse%3C%2FmustntEndWithNonAlpha%3E%0A++%3CmustntEndWithAlpha%3Efalse%3C%2FmustntEndWithAlpha%3E%0A++%3CprefixesNotPermitted%3E%0A++++%3Cstring%3Enotpermitted1%3C%2Fstring%3E%0A++++%3Cstring%3Enotpermitted2%3C%2Fstring%3E%0A++%3C%2FprefixesNotPermitted%3E%0A%3C%2Forg.apache.syncope.common.types.PasswordPolicySpec%3E\"/>\n   <Policy DTYPE=\"SyncPolicy\" id=\"9\" description=\"sync policy for java rule\" type=\"SYNC\" specification=\"%3Corg.apache.syncope.common.types.SyncPolicySpec%3E%0A++%3CconflictResolutionAction%3EIGNORE%3C/conflictResolutionAction%3E%0A%3C/org.apache.syncope.common.types.SyncPolicySpec%3E\"/>\n     \n-  <SyncopeUser id=\"1\" workflowId=\"0\" status=\"active\" password=\"5baa61e4c9b93f3f0682250b6cf8331b7ee68fd8\" cipherAlgorithm=\"SHA1\"\n+  <SyncopeUser id=\"1\" workflowId=\"4\" status=\"active\" password=\"5baa61e4c9b93f3f0682250b6cf8331b7ee68fd8\" cipherAlgorithm=\"SHA1\"\n                username=\"rossini\" creationDate=\"2010-10-20 11:00:00\" suspended=\"0\"/>\n-  <SyncopeUser id=\"2\" workflowId=\"0\" status=\"active\" password=\"5baa61e4c9b93f3f0682250b6cf8331b7ee68fd8\" cipherAlgorithm=\"SHA1\"\n+  <SyncopeUser id=\"2\" workflowId=\"6\" status=\"active\" password=\"5baa61e4c9b93f3f0682250b6cf8331b7ee68fd8\" cipherAlgorithm=\"SHA1\"\n                username=\"verdi\" creationDate=\"2010-10-20 11:00:00\" suspended=\"0\"/>\n-  <SyncopeUser id=\"3\" workflowId=\"0\" status=\"active\" password=\"5baa61e4c9b93f3f0682250b6cf8331b7ee68fd8\" cipherAlgorithm=\"SHA1\"\n+  <SyncopeUser id=\"3\" workflowId=\"8\" status=\"active\" password=\"5baa61e4c9b93f3f0682250b6cf8331b7ee68fd8\" cipherAlgorithm=\"SHA1\"\n                username=\"vivaldi\" creationDate=\"2010-10-20 11:00:00\" suspended=\"0\"/>\n-  <SyncopeUser id=\"4\" workflowId=\"0\" status=\"active\" password=\"5baa61e4c9b93f3f0682250b6cf8331b7ee68fd8\" cipherAlgorithm=\"SHA1\"\n+  <SyncopeUser id=\"4\" workflowId=\"10\" status=\"active\" password=\"5baa61e4c9b93f3f0682250b6cf8331b7ee68fd8\" cipherAlgorithm=\"SHA1\"\n                username=\"bellini\" creationDate=\"2010-10-20 11:00:00\" suspended=\"0\"/>\n-  <SyncopeUser id=\"5\" workflowId=\"0\" status=\"active\" password=\"5baa61e4c9b93f3f0682250b6cf8331b7ee68fd8\" cipherAlgorithm=\"SHA1\"\n+  <SyncopeUser id=\"5\" workflowId=\"12\" status=\"active\" password=\"5baa61e4c9b93f3f0682250b6cf8331b7ee68fd8\" cipherAlgorithm=\"SHA1\"\n                username=\"puccini\" creationDate=\"2010-10-20 11:00:00\" suspended=\"0\"/>\n \n   <SyncopeRole id=\"1\" name=\"root\"/>\n@@ -154,6 +154,8 @@ under the License.\n   <MSchema name=\"postalAddress\" type=\"String\"\n            mandatoryCondition=\"false\" multivalue=\"0\" uniqueConstraint=\"0\" readonly=\"0\"/>\n \n+  <UAttr id=\"99\" owner_id=\"1\" schema_name=\"type\"/>\n+  <UAttrValue id=\"9\" attribute_id=\"99\" stringValue=\"G\"/>\n   <UAttr id=\"100\" owner_id=\"1\" schema_name=\"fullname\"/>\n   <UAttrUniqueValue id=\"10\" attribute_id=\"100\" schema_name=\"fullname\" stringValue=\"Gioacchino Rossini\"/>\n   <UAttr id=\"101\" owner_id=\"1\" schema_name=\"firstname\"/>\n@@ -207,6 +209,13 @@ under the License.\n   <UAttrUniqueValue id=\"33\" attribute_id=\"122\" schema_name=\"fullname\" stringValue=\"Giacomo Puccini\"/>\n   <UAttr id=\"123\" owner_id=\"5\" schema_name=\"userId\"/>\n   <UAttrUniqueValue id=\"34\" attribute_id=\"123\" schema_name=\"userId\" stringValue=\"puccini@apache.org\"/>\n+  \n+  <UAttr id=\"124\" owner_id=\"2\" schema_name=\"email\"/>\n+  <UAttrValue id=\"35\" attribute_id=\"124\" stringValue=\"verdi@syncope.org\"/>\n+  <UAttr id=\"125\" owner_id=\"3\" schema_name=\"email\"/>\n+  <UAttrValue id=\"36\" attribute_id=\"125\" stringValue=\"vivaldi@syncope.org\"/>\n+  <UAttr id=\"126\" owner_id=\"3\" schema_name=\"type\"/>\n+  <UAttrValue id=\"37\" attribute_id=\"126\" stringValue=\"F\"/>\n     \n   <RAttr id=\"600\" owner_id=\"1\" schema_name=\"icon\"/>\n   <RAttr id=\"700\" owner_id=\"2\" schema_name=\"icon\"/>\n@@ -267,6 +276,7 @@ under the License.\n \n   <UDerSchema name=\"cn\" expression=\"surname + ', ' + firstname\"/>\n   <UDerAttr id=\"100\" derivedSchema_name=\"cn\" owner_id=\"3\"/>\n+  <UDerAttr id=\"101\" derivedSchema_name=\"cn\" owner_id=\"1\"/>\n \n   <UDerSchema name=\"noschema\" expression=\"surname + ', ' + notfound\"/>\n \n@@ -498,7 +508,7 @@ under the License.\n                 accountid=\"0\" password=\"0\" purpose=\"PROPAGATION\"/>\n   <UMappingItem id=\"113\" extAttrName=\"userId\" mapping_id=\"2\"\n                 intAttrName=\"userId\" intMappingType=\"UserSchema\" mandatoryCondition=\"false\"\n-                accountid=\"0\" password=\"0\" purpose=\"PROPAGATION\"/>\n+                accountid=\"1\" password=\"0\" purpose=\"PROPAGATION\"/>\n   <UMappingItem id=\"114\" extAttrName=\"test3\" mapping_id=\"2\" \n                 intAttrName=\"fullname\" intMappingType=\"UserSchema\" mandatoryCondition=\"false\"\n                 accountid=\"0\" password=\"0\" purpose=\"PROPAGATION\"/>\n@@ -653,6 +663,11 @@ under the License.\n                 extAttrName=\"__NAME__\" intAttrName=\"fullname\" intMappingType=\"UserSchema\"\n                 mandatoryCondition=\"true\" purpose=\"PROPAGATION\"/>\n   \n+  <UMapping id=\"19\" resource_name=\"ws-target-resource-delete\"/>\n+  <UMappingItem id=\"334\" mapping_id=\"19\" extAttrName=\"__NAME__\" \n+                intMappingType=\"Username\" mandatoryCondition=\"true\"\n+                accountid=\"1\" password=\"0\" purpose=\"PROPAGATION\"/>\n+  \n   <Task DTYPE=\"PropagationTask\" id=\"1\" propagationMode=\"TWO_PHASES\" propagationOperation=\"UPDATE\"\n         objectClassName=\"__ACCOUNT__\" resource_name=\"ws-target-resource-2\" subjectType=\"USER\" subjectId=\"1\"\n         xmlAttributes=\"%3Cset%3E%0A++%3Corg.identityconnectors.framework.common.objects.Attribute%3E%0A++++%3Cname%3E__PASSWORD__%3C%2Fname%3E%0A++++%3Cvalue+class%3D%22java.util.Collections%24UnmodifiableRandomAccessList%22+resolves-to%3D%22java.util.Collections%24UnmodifiableList%22%3E%0A++++++%3Cc+class%3D%22list%22%3E%0A++++++++%3Corg.identityconnectors.common.security.GuardedString%3E%0A++++++++++%3Creadonly%3Efalse%3C%2Freadonly%3E%0A++++++++++%3Cdisposed%3Efalse%3C%2Fdisposed%3E%0A++++++++++%3CencryptedBytes%3Em9nh2US0Sa6m%2BcXccCq0Xw%3D%3D%3C%2FencryptedBytes%3E%0A++++++++%3C%2Forg.identityconnectors.common.security.GuardedString%3E%0A++++++%3C%2Fc%3E%0A++++++%3Clist+reference%3D%22..%2Fc%22%2F%3E%0A++++%3C%2Fvalue%3E%0A++%3C%2Forg.identityconnectors.framework.common.objects.Attribute%3E%0A++%3Corg.identityconnectors.framework.common.objects.Name%3E%0A++++%3Cname%3E__NAME__%3C%2Fname%3E%0A++++%3Cvalue+class%3D%22java.util.Collections%24UnmodifiableRandomAccessList%22+resolves-to%3D%22java.util.Collections%24UnmodifiableList%22%3E%0A++++++%3Cc+class%3D%22list%22%3E%0A++++++++%3Cstring%3EuserId%3C%2Fstring%3E%0A++++++%3C%2Fc%3E%0A++++++%3Clist+reference%3D%22..%2Fc%22%2F%3E%0A++++%3C%2Fvalue%3E%0A++%3C%2Forg.identityconnectors.framework.common.objects.Name%3E%0A++%3Corg.identityconnectors.framework.common.objects.Attribute%3E%0A++++%3Cname%3Efullname%3C%2Fname%3E%0A++++%3Cvalue+class%3D%22java.util.Collections%24UnmodifiableRandomAccessList%22+resolves-to%3D%22java.util.Collections%24UnmodifiableList%22%3E%0A++++++%3Cc+class%3D%22list%22%3E%0A++++++++%3Cstring%3Efullname%3C%2Fstring%3E%0A++++++%3C%2Fc%3E%0A++++++%3Clist+reference%3D%22..%2Fc%22%2F%3E%0A++++%3C%2Fvalue%3E%0A++%3C%2Forg.identityconnectors.framework.common.objects.Attribute%3E%0A++%3Corg.identityconnectors.framework.common.objects.Attribute%3E%0A++++%3Cname%3Etype%3C%2Fname%3E%0A++++%3Cvalue+class%3D%22java.util.Collections%24UnmodifiableRandomAccessList%22+resolves-to%3D%22java.util.Collections%24UnmodifiableList%22%3E%0A++++++%3Cc+class%3D%22list%22%3E%0A++++++++%3Cstring%3Etype%3C%2Fstring%3E%0A++++++%3C%2Fc%3E%0A++++++%3Clist+reference%3D%22..%2Fc%22%2F%3E%0A++++%3C%2Fvalue%3E%0A++%3C%2Forg.identityconnectors.framework.common.objects.Attribute%3E%0A%3C%2Fset%3E\"/>\n@@ -806,4 +821,20 @@ under the License.\n   <ReportExec Report_id=\"1\" id=\"1\" status=\"SUCCESS\" startDate=\"2012-02-26 15:40:04\" endDate=\"2012-02-26 15:41:04\"/>\n   \n   <SyncopeLogger logName=\"syncope.audit.authentication.getEntitlements.success\" logLevel=\"DEBUG\" logType=\"AUDIT\"/>\n+\n+  <ACT_RU_EXECUTION ID_=\"4\" REV_=\"2\" PROC_INST_ID_=\"4\" PROC_DEF_ID_=\"userWorkflow:1:3\" ACT_ID_=\"active\" IS_ACTIVE_=\"1\" IS_CONCURRENT_=\"0\" IS_SCOPE_=\"1\" IS_EVENT_SCOPE_=\"0\" SUSPENSION_STATE_=\"1\"/>\n+  <ACT_RU_TASK ID_=\"5\" REV_=\"2\" EXECUTION_ID_=\"4\" PROC_INST_ID_=\"4\" PROC_DEF_ID_=\"userWorkflow:1:3\" NAME_=\"Active\" TASK_DEF_KEY_=\"active\" PRIORITY_=\"50\" CREATE_TIME_=\"2013-02-25T17:19:03+0100\"/>\n+ \n+  <ACT_RU_EXECUTION ID_=\"6\" REV_=\"2\" PROC_INST_ID_=\"6\" PROC_DEF_ID_=\"userWorkflow:1:3\" ACT_ID_=\"active\" IS_ACTIVE_=\"1\" IS_CONCURRENT_=\"0\" IS_SCOPE_=\"1\" IS_EVENT_SCOPE_=\"0\" SUSPENSION_STATE_=\"1\"/>\n+  <ACT_RU_TASK ID_=\"7\" REV_=\"2\" EXECUTION_ID_=\"6\" PROC_INST_ID_=\"6\" PROC_DEF_ID_=\"userWorkflow:1:3\" NAME_=\"Active\" TASK_DEF_KEY_=\"active\" PRIORITY_=\"50\" CREATE_TIME_=\"2013-02-25T17:19:03+0100\"/>\n+ \n+  <ACT_RU_EXECUTION ID_=\"8\" REV_=\"2\" PROC_INST_ID_=\"8\" PROC_DEF_ID_=\"userWorkflow:1:3\" ACT_ID_=\"active\" IS_ACTIVE_=\"1\" IS_CONCURRENT_=\"0\" IS_SCOPE_=\"1\" IS_EVENT_SCOPE_=\"0\" SUSPENSION_STATE_=\"1\"/>\n+  <ACT_RU_TASK ID_=\"9\" REV_=\"2\" EXECUTION_ID_=\"8\" PROC_INST_ID_=\"8\" PROC_DEF_ID_=\"userWorkflow:1:3\" NAME_=\"Active\" TASK_DEF_KEY_=\"active\" PRIORITY_=\"50\" CREATE_TIME_=\"2013-02-25T17:19:03+0100\"/>\n+ \n+  <ACT_RU_EXECUTION ID_=\"10\" REV_=\"2\" PROC_INST_ID_=\"10\" PROC_DEF_ID_=\"userWorkflow:1:3\" ACT_ID_=\"active\" IS_ACTIVE_=\"1\" IS_CONCURRENT_=\"0\" IS_SCOPE_=\"1\" IS_EVENT_SCOPE_=\"0\" SUSPENSION_STATE_=\"1\"/>\n+  <ACT_RU_TASK ID_=\"11\" REV_=\"2\" EXECUTION_ID_=\"10\" PROC_INST_ID_=\"10\" PROC_DEF_ID_=\"userWorkflow:1:3\" NAME_=\"Active\" TASK_DEF_KEY_=\"active\" PRIORITY_=\"50\" CREATE_TIME_=\"2013-02-25T17:19:03+0100\"/>\n+ \n+  <ACT_RU_EXECUTION ID_=\"12\" REV_=\"2\" PROC_INST_ID_=\"12\" PROC_DEF_ID_=\"userWorkflow:1:3\" ACT_ID_=\"active\" IS_ACTIVE_=\"1\" IS_CONCURRENT_=\"0\" IS_SCOPE_=\"1\" IS_EVENT_SCOPE_=\"0\" SUSPENSION_STATE_=\"1\"/>\n+  <ACT_RU_TASK ID_=\"13\" REV_=\"2\" EXECUTION_ID_=\"12\" PROC_INST_ID_=\"12\" PROC_DEF_ID_=\"userWorkflow:1:3\" NAME_=\"Active\" TASK_DEF_KEY_=\"active\" PRIORITY_=\"50\" CREATE_TIME_=\"2013-02-25T17:19:03+0100\"/>\n+  \n </dataset>"}]}