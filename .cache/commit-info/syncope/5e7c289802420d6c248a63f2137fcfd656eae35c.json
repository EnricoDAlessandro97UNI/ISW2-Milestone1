{"sha":"5e7c289802420d6c248a63f2137fcfd656eae35c","node_id":"MDY6Q29tbWl0NjM2ODc5MDYyOjVlN2MyODk4MDI0MjBkNmMyNDhhNjNmMjEzN2ZjZmQ2NTZlYWUzNWM=","commit":{"author":{"name":"Francesco Chicchiriccò","email":"ilgrosso@apache.org","date":"2019-10-23T12:45:07Z"},"committer":{"name":"Francesco Chicchiriccò","email":"ilgrosso@apache.org","date":"2019-10-23T12:51:49Z"},"message":"[SYNCOPE-1461] All works finally with MySQL 8.0.18","tree":{"sha":"1388435887fcad9d32ea82d1dc69444ff6fbb9d9","url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/git/trees/1388435887fcad9d32ea82d1dc69444ff6fbb9d9"},"url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/git/commits/5e7c289802420d6c248a63f2137fcfd656eae35c","comment_count":0,"verification":{"verified":false,"reason":"unsigned","signature":null,"payload":null}},"url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/5e7c289802420d6c248a63f2137fcfd656eae35c","html_url":"https://github.com/EnricoDAlessandro97UNI/syncope/commit/5e7c289802420d6c248a63f2137fcfd656eae35c","comments_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/5e7c289802420d6c248a63f2137fcfd656eae35c/comments","author":{"login":"ilgrosso","id":1064664,"node_id":"MDQ6VXNlcjEwNjQ2NjQ=","avatar_url":"https://avatars.githubusercontent.com/u/1064664?v=4","gravatar_id":"","url":"https://api.github.com/users/ilgrosso","html_url":"https://github.com/ilgrosso","followers_url":"https://api.github.com/users/ilgrosso/followers","following_url":"https://api.github.com/users/ilgrosso/following{/other_user}","gists_url":"https://api.github.com/users/ilgrosso/gists{/gist_id}","starred_url":"https://api.github.com/users/ilgrosso/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ilgrosso/subscriptions","organizations_url":"https://api.github.com/users/ilgrosso/orgs","repos_url":"https://api.github.com/users/ilgrosso/repos","events_url":"https://api.github.com/users/ilgrosso/events{/privacy}","received_events_url":"https://api.github.com/users/ilgrosso/received_events","type":"User","site_admin":false},"committer":{"login":"ilgrosso","id":1064664,"node_id":"MDQ6VXNlcjEwNjQ2NjQ=","avatar_url":"https://avatars.githubusercontent.com/u/1064664?v=4","gravatar_id":"","url":"https://api.github.com/users/ilgrosso","html_url":"https://github.com/ilgrosso","followers_url":"https://api.github.com/users/ilgrosso/followers","following_url":"https://api.github.com/users/ilgrosso/following{/other_user}","gists_url":"https://api.github.com/users/ilgrosso/gists{/gist_id}","starred_url":"https://api.github.com/users/ilgrosso/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ilgrosso/subscriptions","organizations_url":"https://api.github.com/users/ilgrosso/orgs","repos_url":"https://api.github.com/users/ilgrosso/repos","events_url":"https://api.github.com/users/ilgrosso/events{/privacy}","received_events_url":"https://api.github.com/users/ilgrosso/received_events","type":"User","site_admin":false},"parents":[{"sha":"e3311e67593cd2b4f6802dd30d27376a635e55a3","url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/e3311e67593cd2b4f6802dd30d27376a635e55a3","html_url":"https://github.com/EnricoDAlessandro97UNI/syncope/commit/e3311e67593cd2b4f6802dd30d27376a635e55a3"}],"stats":{"total":101,"additions":25,"deletions":76},"files":[{"sha":"90cd273ba2b19e7d2c18c112901549db97b13bdc","filename":"core/persistence-jpa-json/src/main/java/org/apache/syncope/core/persistence/jpa/dao/AbstractJPAJSONAnyDAO.java","status":"modified","additions":22,"deletions":1,"changes":23,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/5e7c289802420d6c248a63f2137fcfd656eae35c/core%2Fpersistence-jpa-json%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fpersistence%2Fjpa%2Fdao%2FAbstractJPAJSONAnyDAO.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/5e7c289802420d6c248a63f2137fcfd656eae35c/core%2Fpersistence-jpa-json%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fpersistence%2Fjpa%2Fdao%2FAbstractJPAJSONAnyDAO.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fpersistence-jpa-json%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fpersistence%2Fjpa%2Fdao%2FAbstractJPAJSONAnyDAO.java?ref=5e7c289802420d6c248a63f2137fcfd656eae35c","patch":"@@ -27,6 +27,7 @@\n import java.util.Map;\n import java.util.Optional;\n import java.util.Set;\n+import java.util.StringJoiner;\n import java.util.regex.Pattern;\n import javax.persistence.Query;\n import org.apache.commons.jexl3.parser.Parser;\n@@ -180,7 +181,27 @@ private static List<String> split(final String attrValue, final List<String> lit\n         return attrValues;\n     }\n \n-    protected abstract List<Object> findByDerAttrValue(String table, Map<String, List<Object>> clauses);\n+    @SuppressWarnings(\"unchecked\")\n+    protected List<Object> findByDerAttrValue(\n+            final String table,\n+            final Map<String, List<Object>> clauses) {\n+\n+        StringJoiner actualClauses = new StringJoiner(\" AND id IN \");\n+        List<Object> queryParams = new ArrayList<>();\n+\n+        clauses.forEach((clause, parameters) -> {\n+            actualClauses.add(clause);\n+            queryParams.addAll(parameters);\n+        });\n+\n+        Query query = entityManager().createNativeQuery(\n+                \"SELECT DISTINCT id FROM \" + table + \" u WHERE id IN \" + actualClauses.toString());\n+        for (int i = 0; i < queryParams.size(); i++) {\n+            query.setParameter(i + 1, queryParams.get(i));\n+        }\n+\n+        return query.getResultList();\n+    }\n \n     @SuppressWarnings(\"unchecked\")\n     @Transactional(readOnly = true)"},{"sha":"a5c2d9368c884201864a224c6eafee4e000d9750","filename":"core/persistence-jpa-json/src/main/java/org/apache/syncope/core/persistence/jpa/dao/MyJPAJSONAnyDAO.java","status":"modified","additions":0,"deletions":42,"changes":42,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/5e7c289802420d6c248a63f2137fcfd656eae35c/core%2Fpersistence-jpa-json%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fpersistence%2Fjpa%2Fdao%2FMyJPAJSONAnyDAO.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/5e7c289802420d6c248a63f2137fcfd656eae35c/core%2Fpersistence-jpa-json%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fpersistence%2Fjpa%2Fdao%2FMyJPAJSONAnyDAO.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fpersistence-jpa-json%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fpersistence%2Fjpa%2Fdao%2FMyJPAJSONAnyDAO.java?ref=5e7c289802420d6c248a63f2137fcfd656eae35c","patch":"@@ -18,13 +18,7 @@\n  */\n package org.apache.syncope.core.persistence.jpa.dao;\n \n-import java.util.ArrayList;\n-import java.util.HashSet;\n import java.util.List;\n-import java.util.Map;\n-import java.util.Set;\n-import java.util.concurrent.atomic.AtomicReference;\n-import javax.persistence.Query;\n import org.apache.commons.lang3.StringUtils;\n import org.apache.commons.lang3.tuple.Pair;\n import org.apache.syncope.common.lib.types.AnyTypeKind;\n@@ -79,40 +73,4 @@ protected String attrValueMatch(\n             return \"JSON_CONTAINS(plainAttrs, '\" + POJOHelper.serialize(List.of(container)) + \"')\";\n         }\n     }\n-\n-    /**\n-     * {@inheritDoc}\n-     *\n-     * This method is a workaround for a bug experienced up to MySQL 8.0.15, where the correct implementation (as shown\n-     * in {@link PGJPAJSONAnyDAO#findByDerAttrValue(java.lang.String, java.util.Map)} generates a core dump.\n-     */\n-    @Override\n-    @SuppressWarnings(\"unchecked\")\n-    protected List<Object> findByDerAttrValue(\n-            final String table,\n-            final Map<String, List<Object>> clauses) {\n-\n-        if (clauses.isEmpty()) {\n-            return List.of();\n-        }\n-\n-        Set<Object> result = new HashSet<>();\n-        AtomicReference<Boolean> first = new AtomicReference<>(Boolean.TRUE);\n-        clauses.forEach((clause, parameters) -> {\n-            Query query = entityManager().createNativeQuery(StringUtils.replaceIgnoreCase(clause, \"DISTINCT\", \"\"));\n-            for (int i = 0; i < parameters.size(); i++) {\n-                query.setParameter(i + 1, parameters.get(i));\n-            }\n-\n-            Set<Object> local = new HashSet<>(query.getResultList());\n-            if (first.get()) {\n-                result.addAll(local);\n-                first.set(Boolean.FALSE);\n-            } else {\n-                result.retainAll(local);\n-            }\n-        });\n-\n-        return new ArrayList<>(result);\n-    }\n }"},{"sha":"a9673c08af0b0c81c3b8c733422925b07d51ec1d","filename":"core/persistence-jpa-json/src/main/java/org/apache/syncope/core/persistence/jpa/dao/PGJPAJSONAnyDAO.java","status":"modified","additions":0,"deletions":27,"changes":27,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/5e7c289802420d6c248a63f2137fcfd656eae35c/core%2Fpersistence-jpa-json%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fpersistence%2Fjpa%2Fdao%2FPGJPAJSONAnyDAO.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/5e7c289802420d6c248a63f2137fcfd656eae35c/core%2Fpersistence-jpa-json%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fpersistence%2Fjpa%2Fdao%2FPGJPAJSONAnyDAO.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fpersistence-jpa-json%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fpersistence%2Fjpa%2Fdao%2FPGJPAJSONAnyDAO.java?ref=5e7c289802420d6c248a63f2137fcfd656eae35c","patch":"@@ -18,11 +18,7 @@\n  */\n package org.apache.syncope.core.persistence.jpa.dao;\n \n-import java.util.ArrayList;\n import java.util.List;\n-import java.util.Map;\n-import java.util.StringJoiner;\n-import javax.persistence.Query;\n import org.apache.commons.lang3.tuple.Pair;\n import org.apache.syncope.core.persistence.api.entity.AnyUtils;\n import org.apache.syncope.core.persistence.api.entity.PlainAttr;\n@@ -71,27 +67,4 @@ protected String attrValueMatch(\n             return \"plainAttrs @> '\" + POJOHelper.serialize(List.of(container)) + \"'::jsonb\";\n         }\n     }\n-\n-    @Override\n-    @SuppressWarnings(\"unchecked\")\n-    protected List<Object> findByDerAttrValue(\n-            final String table,\n-            final Map<String, List<Object>> clauses) {\n-\n-        StringJoiner actualClauses = new StringJoiner(\" AND id IN \");\n-        List<Object> queryParams = new ArrayList<>();\n-\n-        clauses.forEach((clause, parameters) -> {\n-            actualClauses.add(clause);\n-            queryParams.addAll(parameters);\n-        });\n-\n-        Query query = entityManager().createNativeQuery(\n-                \"SELECT DISTINCT id FROM \" + table + \" u WHERE id IN \" + actualClauses.toString());\n-        for (int i = 0; i < queryParams.size(); i++) {\n-            query.setParameter(i + 1, queryParams.get(i));\n-        }\n-\n-        return query.getResultList();\n-    }\n }"},{"sha":"5c321dcbbe8acde2c1bf431e0629084cefb46242","filename":"core/persistence-jpa-json/src/test/resources/domains/MasterContent.xml","status":"modified","additions":1,"deletions":1,"changes":2,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/5e7c289802420d6c248a63f2137fcfd656eae35c/core%2Fpersistence-jpa-json%2Fsrc%2Ftest%2Fresources%2Fdomains%2FMasterContent.xml","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/5e7c289802420d6c248a63f2137fcfd656eae35c/core%2Fpersistence-jpa-json%2Fsrc%2Ftest%2Fresources%2Fdomains%2FMasterContent.xml","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fpersistence-jpa-json%2Fsrc%2Ftest%2Fresources%2Fdomains%2FMasterContent.xml?ref=5e7c289802420d6c248a63f2137fcfd656eae35c","patch":"@@ -424,7 +424,7 @@ under the License.\n   <!-- push policies -->\n   <PushPolicy id=\"fb6530e5-892d-4f47-a46b-180c5b6c5c83\" description=\"a push policy\" conflictResolutionAction=\"IGNORE\"/>\n   <Implementation id=\"TestPushCorrelationRule\" type=\"PUSH_CORRELATION_RULE\" engine=\"JAVA\"\n-                  body='{\"@class\":\"org.apache.syncope.common.lib.policy.DefaultPushCorrelationRuleConf\",\"name\":\"org.apache.syncope.common.lib.policy.DefaultPushCorrelationRuleConf\",\"schemas\":[\"email\"]}'/>\n+                  body='{\"@class\":\"org.apache.syncope.common.lib.policy.DefaultPushCorrelationRuleConf\",\"name\":\"org.apache.syncope.common.lib.policy.DefaultPushCorrelationRuleConf\",\"schemas\":[\"surname\"]}'/>\n   <PushCorrelationRuleEntity id=\"24463935-32a0-4272-bc78-04d6d0adc69e\" pushPolicy_id=\"fb6530e5-892d-4f47-a46b-180c5b6c5c83\" \n                              anyType_id=\"USER\" implementation_id=\"TestPushCorrelationRule\"/>\n   "},{"sha":"0376c1fc1d3c8914c051ae082e6dfb89ba1c418f","filename":"core/persistence-jpa/src/main/resources/audit/audit_mysql_innodb.sql","status":"modified","additions":1,"deletions":1,"changes":2,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/5e7c289802420d6c248a63f2137fcfd656eae35c/core%2Fpersistence-jpa%2Fsrc%2Fmain%2Fresources%2Faudit%2Faudit_mysql_innodb.sql","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/5e7c289802420d6c248a63f2137fcfd656eae35c/core%2Fpersistence-jpa%2Fsrc%2Fmain%2Fresources%2Faudit%2Faudit_mysql_innodb.sql","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fpersistence-jpa%2Fsrc%2Fmain%2Fresources%2Faudit%2Faudit_mysql_innodb.sql?ref=5e7c289802420d6c248a63f2137fcfd656eae35c","patch":"@@ -19,6 +19,6 @@ CREATE TABLE IF NOT EXISTS SYNCOPEAUDIT (\n   EVENT_DATE TIMESTAMP,\n   LOGGER_LEVEL VARCHAR(255) NOT NULL,\n   LOGGER VARCHAR(255) NOT NULL,\n-  MESSAGE TEXT NOT NULL,\n+  MESSAGE LONGTEXT NOT NULL,\n   THROWABLE TEXT\n ) ENGINE=InnoDB;"},{"sha":"6f9332851d042ad4acf4ef7dd9f653e8a9920545","filename":"pom.xml","status":"modified","additions":1,"deletions":1,"changes":2,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/5e7c289802420d6c248a63f2137fcfd656eae35c/pom.xml","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/5e7c289802420d6c248a63f2137fcfd656eae35c/pom.xml","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/pom.xml?ref=5e7c289802420d6c248a63f2137fcfd656eae35c","patch":"@@ -519,7 +519,7 @@ under the License.\n     <docker.mariadb.version>10.4</docker.mariadb.version>\n \n     <jdbc.postgresql.version>42.2.8</jdbc.postgresql.version>\n-    <jdbc.mysql.version>8.0.16</jdbc.mysql.version>\n+    <jdbc.mysql.version>8.0.18</jdbc.mysql.version>\n     <jdbc.mariadb.version>2.4.1</jdbc.mariadb.version>\n     <jdbc.mssql.version>7.2.2.jre</jdbc.mssql.version>\n     <jdbc.oracle.version>19.3.0.0</jdbc.oracle.version>"},{"sha":"e940085f01e3de1b221e4f0141d9f9a3b5adbae0","filename":"src/main/asciidoc/reference-guide/workingwithapachesyncope/systemadministration/dbms.adoc","status":"modified","additions":0,"deletions":3,"changes":3,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/5e7c289802420d6c248a63f2137fcfd656eae35c/src%2Fmain%2Fasciidoc%2Freference-guide%2Fworkingwithapachesyncope%2Fsystemadministration%2Fdbms.adoc","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/5e7c289802420d6c248a63f2137fcfd656eae35c/src%2Fmain%2Fasciidoc%2Freference-guide%2Fworkingwithapachesyncope%2Fsystemadministration%2Fdbms.adoc","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/src%2Fmain%2Fasciidoc%2Freference-guide%2Fworkingwithapachesyncope%2Fsystemadministration%2Fdbms.adoc?ref=5e7c289802420d6c248a63f2137fcfd656eae35c","patch":"@@ -195,9 +195,6 @@ This assumes that you have a MySQL instance running on localhost, listening on i\n With the configurations reported below, Apache Syncope will leverage the\n https://dev.mysql.com/doc/refman/8.0/en/json-table-functions.html[JSON_TABLE^] function.\n \n-[CAUTION]\n-This MySQL feature does not appear yet to be production-ready, use it with caution.\n-\n [NOTE]\n Apache Syncope {docVersion} is verified with MySQL server >= 8.0 and JDBC driver >= {mysqlJDBC}.\n "}]}