{"sha":"39d1e61798e8eda628ed1f36b4af25a313911083","node_id":"MDY6Q29tbWl0NjM2ODc5MDYyOjM5ZDFlNjE3OThlOGVkYTYyOGVkMWYzNmI0YWYyNWEzMTM5MTEwODM=","commit":{"author":{"name":"Colm O hEigeartaigh","email":"coheigea@apache.org","date":"2017-07-19T10:41:37Z"},"committer":{"name":"Colm O hEigeartaigh","email":"coheigea@apache.org","date":"2017-07-19T10:41:37Z"},"message":"Fixing the installer to work with SSHA256","tree":{"sha":"967bcb751081e2e14a20080d682e8b83de840bb5","url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/git/trees/967bcb751081e2e14a20080d682e8b83de840bb5"},"url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/git/commits/39d1e61798e8eda628ed1f36b4af25a313911083","comment_count":0,"verification":{"verified":false,"reason":"unsigned","signature":null,"payload":null}},"url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/39d1e61798e8eda628ed1f36b4af25a313911083","html_url":"https://github.com/EnricoDAlessandro97UNI/syncope/commit/39d1e61798e8eda628ed1f36b4af25a313911083","comments_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/39d1e61798e8eda628ed1f36b4af25a313911083/comments","author":{"login":"coheigea","id":472162,"node_id":"MDQ6VXNlcjQ3MjE2Mg==","avatar_url":"https://avatars.githubusercontent.com/u/472162?v=4","gravatar_id":"","url":"https://api.github.com/users/coheigea","html_url":"https://github.com/coheigea","followers_url":"https://api.github.com/users/coheigea/followers","following_url":"https://api.github.com/users/coheigea/following{/other_user}","gists_url":"https://api.github.com/users/coheigea/gists{/gist_id}","starred_url":"https://api.github.com/users/coheigea/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/coheigea/subscriptions","organizations_url":"https://api.github.com/users/coheigea/orgs","repos_url":"https://api.github.com/users/coheigea/repos","events_url":"https://api.github.com/users/coheigea/events{/privacy}","received_events_url":"https://api.github.com/users/coheigea/received_events","type":"User","site_admin":false},"committer":{"login":"coheigea","id":472162,"node_id":"MDQ6VXNlcjQ3MjE2Mg==","avatar_url":"https://avatars.githubusercontent.com/u/472162?v=4","gravatar_id":"","url":"https://api.github.com/users/coheigea","html_url":"https://github.com/coheigea","followers_url":"https://api.github.com/users/coheigea/followers","following_url":"https://api.github.com/users/coheigea/following{/other_user}","gists_url":"https://api.github.com/users/coheigea/gists{/gist_id}","starred_url":"https://api.github.com/users/coheigea/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/coheigea/subscriptions","organizations_url":"https://api.github.com/users/coheigea/orgs","repos_url":"https://api.github.com/users/coheigea/repos","events_url":"https://api.github.com/users/coheigea/events{/privacy}","received_events_url":"https://api.github.com/users/coheigea/received_events","type":"User","site_admin":false},"parents":[{"sha":"0367ace84f05cd5e749bca39dae45bb55703e73f","url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/0367ace84f05cd5e749bca39dae45bb55703e73f","html_url":"https://github.com/EnricoDAlessandro97UNI/syncope/commit/0367ace84f05cd5e749bca39dae45bb55703e73f"}],"stats":{"total":48,"additions":33,"deletions":15},"files":[{"sha":"7db224089054a9911ec8a581ed0201ea0573c006","filename":"installer/pom.xml","status":"modified","additions":5,"deletions":0,"changes":5,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/39d1e61798e8eda628ed1f36b4af25a313911083/installer%2Fpom.xml","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/39d1e61798e8eda628ed1f36b4af25a313911083/installer%2Fpom.xml","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/installer%2Fpom.xml?ref=39d1e61798e8eda628ed1f36b4af25a313911083","patch":"@@ -87,6 +87,11 @@ under the License.\n       <groupId>commons-logging</groupId>\n       <artifactId>commons-logging</artifactId>\n     </dependency>\n+    <dependency>\n+      <groupId>org.jasypt</groupId>\n+      <artifactId>jasypt</artifactId>\n+    </dependency>\n+\n   </dependencies>\n \n   <build>"},{"sha":"27f0c2aa1bb9259f855961d860a570efcfd45a3c","filename":"installer/src/main/java/org/apache/syncope/installer/utilities/MavenUtils.java","status":"modified","additions":27,"deletions":15,"changes":42,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/39d1e61798e8eda628ed1f36b4af25a313911083/installer%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Finstaller%2Futilities%2FMavenUtils.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/39d1e61798e8eda628ed1f36b4af25a313911083/installer%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Finstaller%2Futilities%2FMavenUtils.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/installer%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Finstaller%2Futilities%2FMavenUtils.java?ref=39d1e61798e8eda628ed1f36b4af25a313911083","patch":"@@ -23,23 +23,17 @@\n import java.io.FileNotFoundException;\n import java.io.IOException;\n import java.io.PrintStream;\n-import java.nio.charset.StandardCharsets;\n import java.nio.file.Files;\n-import java.security.MessageDigest;\n-import java.security.NoSuchAlgorithmException;\n import java.util.ArrayList;\n import java.util.Collections;\n import java.util.List;\n import java.util.Properties;\n-import java.util.logging.Level;\n-import java.util.logging.Logger;\n \n import javax.xml.parsers.DocumentBuilder;\n import javax.xml.parsers.DocumentBuilderFactory;\n import javax.xml.parsers.ParserConfigurationException;\n import javax.xml.transform.TransformerException;\n \n-import org.apache.commons.codec.binary.Hex;\n import org.apache.commons.io.FileUtils;\n import org.apache.maven.shared.invoker.DefaultInvocationRequest;\n import org.apache.maven.shared.invoker.DefaultInvoker;\n@@ -49,6 +43,8 @@\n import org.apache.maven.shared.invoker.MavenInvocationException;\n import org.apache.maven.shared.invoker.PrintStreamHandler;\n import org.apache.maven.shared.invoker.PrintStreamLogger;\n+import org.jasypt.commons.CommonUtils;\n+import org.jasypt.digest.StandardStringDigester;\n import org.w3c.dom.Document;\n import org.w3c.dom.Element;\n import org.xml.sax.SAXException;\n@@ -119,15 +115,9 @@ private Properties archetypeProperties(\n         properties.setProperty(\"jwsKey\", jwsKey);\n \n         if (adminPassword != null) {\n-            try {\n-                final MessageDigest cript = MessageDigest.getInstance(\"SHA-1\");\n-                String encodedPassword =\n-                    new String(Hex.encodeHex(cript.digest(adminPassword.getBytes(StandardCharsets.UTF_8))));\n-                properties.setProperty(\"adminPassword\", encodedPassword);\n-            } catch (final NoSuchAlgorithmException ex) {\n-                Logger.getLogger(MavenUtils.class.getName()).log(Level.SEVERE, \"NoSuchAlgorithmException\", ex);\n-\n-            }\n+            StandardStringDigester digester = getDigester(\"S-SHA-256\");\n+            String encodedPassword = digester.digest(adminPassword);\n+            properties.setProperty(\"adminPassword\", encodedPassword);\n         }\n         properties.setProperty(\"version\", \"1.0-SNAPSHOT\");\n         return properties;\n@@ -245,4 +235,26 @@ public static File createSettingsWithProxy(final String path, final String proxy\n         }\n         return tempSettingsXML;\n     }\n+\n+    private static StandardStringDigester getDigester(final String cipherAlgorithm) {\n+        StandardStringDigester digester = new StandardStringDigester();\n+\n+        if (cipherAlgorithm.startsWith(\"S-\")) {\n+            // Salted ...\n+            digester.setAlgorithm(cipherAlgorithm.replaceFirst(\"S\\\\-\", \"\"));\n+            digester.setIterations(1);\n+            digester.setSaltSizeBytes(8);\n+            digester.setInvertPositionOfPlainSaltInEncryptionResults(true);\n+            digester.setInvertPositionOfSaltInMessageBeforeDigesting(true);\n+            digester.setUseLenientSaltSizeCheck(true);\n+        } else {\n+            // Not salted ...\n+            digester.setAlgorithm(cipherAlgorithm);\n+            digester.setIterations(1);\n+            digester.setSaltSizeBytes(0);\n+        }\n+\n+        digester.setStringOutputType(CommonUtils.STRING_OUTPUT_TYPE_HEXADECIMAL);\n+        return digester;\n+    }\n }"},{"sha":"3a65898969cd23fc2e0565ce2e6a5a32caac29bd","filename":"installer/src/main/resources/izpack/install.xml","status":"modified","additions":1,"deletions":0,"changes":1,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/39d1e61798e8eda628ed1f36b4af25a313911083/installer%2Fsrc%2Fmain%2Fresources%2Fizpack%2Finstall.xml","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/39d1e61798e8eda628ed1f36b4af25a313911083/installer%2Fsrc%2Fmain%2Fresources%2Fizpack%2Finstall.xml","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/installer%2Fsrc%2Fmain%2Fresources%2Fizpack%2Finstall.xml?ref=39d1e61798e8eda628ed1f36b4af25a313911083","patch":"@@ -140,6 +140,7 @@ under the License.\n   <jar src=\"lib/jackson-databind-@{jackson.version}.jar\"/>\n   <jar src=\"lib/jackson-core-@{jackson.version}.jar\"/>\n   <jar src=\"lib/jackson-annotations-@{jackson.version}.jar\"/>\n+  <jar src=\"lib/jasypt-@{jasypt.version}.jar\"/>\n   \n   <jar src=\"lib/maven-invoker-@{maven-invoker.version}.jar\"/>\n   <jar src=\"lib/plexus-utils-3.0.24.jar\"/>"}]}