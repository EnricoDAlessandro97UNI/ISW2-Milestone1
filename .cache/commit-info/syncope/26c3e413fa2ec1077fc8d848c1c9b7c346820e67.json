{"sha":"26c3e413fa2ec1077fc8d848c1c9b7c346820e67","node_id":"MDY6Q29tbWl0NjM2ODc5MDYyOjI2YzNlNDEzZmEyZWMxMDc3ZmM4ZDg0OGMxYzliN2MzNDY4MjBlNjc=","commit":{"author":{"name":"Massimiliano Perrone","email":"massimiliano.perrone@tirasa.net","date":"2015-12-14T17:48:27Z"},"committer":{"name":"Massimiliano Perrone","email":"massimiliano.perrone@tirasa.net","date":"2015-12-14T17:48:38Z"},"message":"The installer works for 2_0_X version","tree":{"sha":"ece740edebbd50188d739be6c8d719166ed944c0","url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/git/trees/ece740edebbd50188d739be6c8d719166ed944c0"},"url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/git/commits/26c3e413fa2ec1077fc8d848c1c9b7c346820e67","comment_count":0,"verification":{"verified":false,"reason":"unsigned","signature":null,"payload":null}},"url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/26c3e413fa2ec1077fc8d848c1c9b7c346820e67","html_url":"https://github.com/EnricoDAlessandro97UNI/syncope/commit/26c3e413fa2ec1077fc8d848c1c9b7c346820e67","comments_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/26c3e413fa2ec1077fc8d848c1c9b7c346820e67/comments","author":{"login":"massx1","id":1792923,"node_id":"MDQ6VXNlcjE3OTI5MjM=","avatar_url":"https://avatars.githubusercontent.com/u/1792923?v=4","gravatar_id":"","url":"https://api.github.com/users/massx1","html_url":"https://github.com/massx1","followers_url":"https://api.github.com/users/massx1/followers","following_url":"https://api.github.com/users/massx1/following{/other_user}","gists_url":"https://api.github.com/users/massx1/gists{/gist_id}","starred_url":"https://api.github.com/users/massx1/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/massx1/subscriptions","organizations_url":"https://api.github.com/users/massx1/orgs","repos_url":"https://api.github.com/users/massx1/repos","events_url":"https://api.github.com/users/massx1/events{/privacy}","received_events_url":"https://api.github.com/users/massx1/received_events","type":"User","site_admin":false},"committer":{"login":"massx1","id":1792923,"node_id":"MDQ6VXNlcjE3OTI5MjM=","avatar_url":"https://avatars.githubusercontent.com/u/1792923?v=4","gravatar_id":"","url":"https://api.github.com/users/massx1","html_url":"https://github.com/massx1","followers_url":"https://api.github.com/users/massx1/followers","following_url":"https://api.github.com/users/massx1/following{/other_user}","gists_url":"https://api.github.com/users/massx1/gists{/gist_id}","starred_url":"https://api.github.com/users/massx1/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/massx1/subscriptions","organizations_url":"https://api.github.com/users/massx1/orgs","repos_url":"https://api.github.com/users/massx1/repos","events_url":"https://api.github.com/users/massx1/events{/privacy}","received_events_url":"https://api.github.com/users/massx1/received_events","type":"User","site_admin":false},"parents":[{"sha":"417eb401bec9136d8edac69daa242557b4185a1c","url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/417eb401bec9136d8edac69daa242557b4185a1c","html_url":"https://github.com/EnricoDAlessandro97UNI/syncope/commit/417eb401bec9136d8edac69daa242557b4185a1c"}],"stats":{"total":69,"additions":38,"deletions":31},"files":[{"sha":"605fc6a595e3eca9b675467739a691fb9ada81de","filename":"installer/src/main/java/org/apache/syncope/installer/files/ProvisioningProperties.java","status":"modified","additions":0,"deletions":20,"changes":20,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/26c3e413fa2ec1077fc8d848c1c9b7c346820e67/installer%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Finstaller%2Ffiles%2FProvisioningProperties.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/26c3e413fa2ec1077fc8d848c1c9b7c346820e67/installer%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Finstaller%2Ffiles%2FProvisioningProperties.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/installer%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Finstaller%2Ffiles%2FProvisioningProperties.java?ref=26c3e413fa2ec1077fc8d848c1c9b7c346820e67","patch":"@@ -20,26 +20,6 @@\n \n public final class ProvisioningProperties {\n \n-    public static final String HEADER = \"# Licensed to the Apache Software Foundation (ASF) under one\\n\"\n-            + \"# or more contributor license agreements.  See the NOTICE file\\n\"\n-            + \"# distributed with this work for additional information\\n\"\n-            + \"# regarding copyright ownership.  The ASF licenses this file\\n\"\n-            + \"# to you under the Apache License, Version 2.0 (the\\n\"\n-            + \"# \\\"License\\\"); you may not use this file except in compliance\\n\"\n-            + \"# with the License.  You may obtain a copy of the License at\\n\" + \"#\\n\"\n-            + \"#   http://www.apache.org/licenses/LICENSE-2.0\\n\" + \"#\\n\"\n-            + \"# Unless required by applicable law or agreed to in writing,\\n\"\n-            + \"# software distributed under the License is distributed on an\\n\"\n-            + \"# \\\"AS IS\\\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\\n\"\n-            + \"# KIND, either express or implied.  See the License for the\\n\"\n-            + \"# specific language governing permissions and limitations\\n\"\n-            + \"# under the License.\\n\"\n-            + \"userProvisioningManager=org.apache.syncope.core.provisioning.java.DefaultUserProvisioningManager\\n\"\n-            + \"groupProvisioningManager=org.apache.syncope.core.provisioning.java.DefaultGroupProvisioningManager\\n\"\n-            + \"anyObjectProvisioningManager=\"\n-            + \"org.apache.syncope.core.provisioning.java.DefaultAnyObjectProvisioningManager\\n\"\n-            + \"virAttrCache=org.apache.syncope.core.provisioning.java.cache.MemoryVirAttrCache\\n\";\n-\n     public static final String POSTGRES = \"\"\n             + \"quartz.jobstore=org.quartz.impl.jdbcjobstore.PostgreSQLDelegate\\n\"\n             + \"quartz.sql=tables_postgres.sql\\n\";"},{"sha":"d3cc987661fd3ec8072c7f4594cb505c95264b0e","filename":"installer/src/main/java/org/apache/syncope/installer/processes/ArchetypeProcess.java","status":"modified","additions":9,"deletions":2,"changes":11,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/26c3e413fa2ec1077fc8d848c1c9b7c346820e67/installer%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Finstaller%2Fprocesses%2FArchetypeProcess.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/26c3e413fa2ec1077fc8d848c1c9b7c346820e67/installer%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Finstaller%2Fprocesses%2FArchetypeProcess.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/installer%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Finstaller%2Fprocesses%2FArchetypeProcess.java?ref=26c3e413fa2ec1077fc8d848c1c9b7c346820e67","patch":"@@ -93,8 +93,7 @@ public void run(final AbstractUIProcessHandler handler, final String[] args) {\n                 syncopeVersion, groupId, artifactId, secretKey, anonymousKey, installPath, customMavenProxySettings);\n \n         if (syncopeVersion.contains(\"SNAPSHOT\")) {\n-            final File pomFile =\n-                    new File(syncopeInstallDir + PROPERTIES.getProperty(\"pomFile\"));\n+            final File pomFile = new File(syncopeInstallDir + PROPERTIES.getProperty(\"pomFile\"));\n             String contentPomFile = fileSystemUtils.readFile(pomFile);\n             fileSystemUtils.\n                     writeToFile(pomFile, contentPomFile.replace(ParentPom.PLACEHOLDER, ParentPom.REPOSITORY));\n@@ -108,6 +107,12 @@ public void run(final AbstractUIProcessHandler handler, final String[] args) {\n         fileSystemUtils.copyFileFromResources(File.separator + PROPERTIES.getProperty(\"modelerPomFile\"),\n                 modelerDirectory + File.separator + PROPERTIES.getProperty(\"pomFile\"), handler);\n \n+        final File modelerPomFile = new File(modelerDirectory + File.separator + PROPERTIES.getProperty(\"pomFile\"));\n+\n+        final String contentModelerPomFile = fileSystemUtils.readFile(modelerPomFile);\n+        fileSystemUtils.\n+                writeToFile(modelerPomFile, String.format(contentModelerPomFile, modelerDirectory));\n+\n         fileSystemUtils.copyFile(\n                 syncopeInstallDir\n                 + PROPERTIES.getProperty(\"consoleResDirectory\")\n@@ -129,5 +134,7 @@ public void run(final AbstractUIProcessHandler handler, final String[] args) {\n         syncopeProperties.setProperty(\"bundles.directory\", bundlesDirectory);\n         mavenUtils.mvnCleanPackageWithProperties(\n                 installPath + File.separator + artifactId, syncopeProperties, customMavenProxySettings);\n+        FileSystemUtils.delete(new File(modelerDirectory + File.separator + PROPERTIES.getProperty(\"saveModel\")));\n+        FileSystemUtils.delete(new File(modelerDirectory + File.separator + PROPERTIES.getProperty(\"urlConfig\")));\n     }\n }"},{"sha":"94ce093ccfa2f3b27b9b9a63aa5b4701b53de615","filename":"installer/src/main/java/org/apache/syncope/installer/processes/PersistenceProcess.java","status":"modified","additions":16,"deletions":2,"changes":18,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/26c3e413fa2ec1077fc8d848c1c9b7c346820e67/installer%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Finstaller%2Fprocesses%2FPersistenceProcess.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/26c3e413fa2ec1077fc8d848c1c9b7c346820e67/installer%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Finstaller%2Fprocesses%2FPersistenceProcess.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/installer%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Finstaller%2Fprocesses%2FPersistenceProcess.java?ref=26c3e413fa2ec1077fc8d848c1c9b7c346820e67","patch":"@@ -21,6 +21,7 @@\n import org.apache.syncope.installer.utilities.FileSystemUtils;\n import com.izforge.izpack.panels.process.AbstractUIProcessHandler;\n import java.io.File;\n+import java.nio.channels.FileChannel;\n import org.apache.syncope.installer.enums.DBs;\n import org.apache.syncope.installer.files.MasterProperties;\n import org.apache.syncope.installer.files.ProvisioningProperties;\n@@ -55,11 +56,15 @@ public void run(final AbstractUIProcessHandler handler, final String[] args) {\n         mysqlInnoDB = Boolean.valueOf(args[6]);\n         schema = args[7];\n \n-        FileSystemUtils fileSystemUtils = new FileSystemUtils(handler);\n-        StringBuilder provisioningProperties = new StringBuilder(ProvisioningProperties.HEADER);\n         StringBuilder masterProperties = new StringBuilder(MasterProperties.HEADER);\n         setSyncopeInstallDir(installPath, artifactId);\n \n+        FileSystemUtils fileSystemUtils = new FileSystemUtils(handler);\n+        final File provisioningFile = new File(\n+                syncopeInstallDir + PROPERTIES.getProperty(\"provisioningPropertiesFile\"));\n+\n+        final StringBuilder provisioningProperties\n+                = new StringBuilder(removeLastTwoLine(fileSystemUtils.readFile(provisioningFile)));\n         handler.logOutput(\"Configure persistence for \" + dbSelected, false);\n         InstallLog.getInstance().info(\"Configure persistence for \" + dbSelected);\n \n@@ -107,4 +112,13 @@ public void run(final AbstractUIProcessHandler handler, final String[] args) {\n                 syncopeInstallDir + PROPERTIES.getProperty(\"masterPropertiesFile\")),\n                 masterProperties.toString());\n     }\n+\n+    private String removeLastTwoLine(final String string) {\n+        int truncateIndex = string.length();\n+\n+        for (int i = 0; i < 3; i++) {\n+            truncateIndex = string.lastIndexOf('\\n', truncateIndex - 1);\n+        }\n+        return string.substring(0, truncateIndex);\n+    }\n }"},{"sha":"9a2326ed166e75fca925b49db23d9b2e06d82438","filename":"installer/src/main/resources/izpack/install.xml","status":"modified","additions":1,"deletions":1,"changes":2,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/26c3e413fa2ec1077fc8d848c1c9b7c346820e67/installer%2Fsrc%2Fmain%2Fresources%2Fizpack%2Finstall.xml","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/26c3e413fa2ec1077fc8d848c1c9b7c346820e67/installer%2Fsrc%2Fmain%2Fresources%2Fizpack%2Finstall.xml","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/installer%2Fsrc%2Fmain%2Fresources%2Fizpack%2Finstall.xml?ref=26c3e413fa2ec1077fc8d848c1c9b7c346820e67","patch":"@@ -33,7 +33,7 @@ under the License.\n     <javaversion>${targetJdk}</javaversion>\n   </info>\n   \n-  <guiprefs resizable=\"no\" width=\"800\" height=\"600\">    \n+  <guiprefs resizable=\"no\" width=\"850\" height=\"600\">    \n     <modifier key=\"useButtonIcons\" value=\"yes\"/>\n     <modifier key=\"useLabelIcons\" value=\"no\"/>\n     <modifier key=\"labelGap\" value=\"2\"/>"},{"sha":"58cf647c35ff524ed62fbf51bf9906731e7429a3","filename":"installer/src/main/resources/modelerPom.xml","status":"modified","additions":12,"deletions":6,"changes":18,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/26c3e413fa2ec1077fc8d848c1c9b7c346820e67/installer%2Fsrc%2Fmain%2Fresources%2FmodelerPom.xml","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/26c3e413fa2ec1077fc8d848c1c9b7c346820e67/installer%2Fsrc%2Fmain%2Fresources%2FmodelerPom.xml","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/installer%2Fsrc%2Fmain%2Fresources%2FmodelerPom.xml?ref=26c3e413fa2ec1077fc8d848c1c9b7c346820e67","patch":"@@ -28,8 +28,9 @@ under the License.\n   <packaging>jar</packaging>\n    \n   <properties>\n-    <activiti.version>5.19.0.1</activiti.version>\n-    <activiti-modeler.directory>${modeler.directory}</activiti-modeler.directory>\n+    <activiti-modeler.version>${activiti.version}</activiti-modeler.version>\n+    <!--<h2-modeler.version>${h2.version}</h2-modeler.version>-->\n+    <activiti-modeler.directory>%s</activiti-modeler.directory>\n      \n     <project.build.sourceEncoding>UTF-8</project.build.sourceEncoding>\n   </properties>\n@@ -38,10 +39,15 @@ under the License.\n     <dependency>\n       <groupId>org.activiti</groupId>\n       <artifactId>activiti-webapp-explorer2</artifactId>\n-      <version>${activiti.version}</version>\n+      <version>${activiti-modeler.version}</version>\n       <type>war</type>\n       <scope>test</scope>\n-    </dependency>   \n+    </dependency>\n+<!--    <dependency>\n+      <groupId>com.h2database</groupId>\n+      <artifactId>h2</artifactId>\n+      <version>${h2-modeler.version}</version>\n+    </dependency>-->\n   </dependencies>\n    \n   <build>   \n@@ -92,10 +98,10 @@ ORYX.Editor.createByUrl = function(modelUrl){\"/>\n                          token=\"window.location.href = &quot;./&quot;;\"\n                          value=\"window.close();\"/>\n                                                \n-                <copy file=\"${basedir}/src/main/resources/url-config.js\" \n+                <copy file=\"url-config.js\" \n                       todir=\"${activiti-modeler.directory}/editor-app/configuration\"\n                       overwrite=\"true\" />\n-                <copy file=\"${basedir}/src/main/resources/save-model.html\" \n+                <copy file=\"save-model.html\" \n                       todir=\"${activiti-modeler.directory}/editor-app/popups\"\n                       overwrite=\"true\" />\n               </target>"}]}