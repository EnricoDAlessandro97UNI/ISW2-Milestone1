{"sha":"d067c2c31fb9e5a577c7d4d01fa75de51e0a5b3d","node_id":"MDY6Q29tbWl0NjM2ODc5MDYyOmQwNjdjMmMzMWZiOWU1YTU3N2M3ZDRkMDFmYTc1ZGU1MWUwYTViM2Q=","commit":{"author":{"name":"Francesco Chicchiriccò","email":"ilgrosso@apache.org","date":"2016-06-07T15:12:44Z"},"committer":{"name":"Francesco Chicchiriccò","email":"ilgrosso@apache.org","date":"2016-06-07T15:12:44Z"},"message":"[SYNCOPE-870] Using username and group's name everywhere instead of keys","tree":{"sha":"4c353c767ed9535f946b2d0971015b6d02dba87c","url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/git/trees/4c353c767ed9535f946b2d0971015b6d02dba87c"},"url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/git/commits/d067c2c31fb9e5a577c7d4d01fa75de51e0a5b3d","comment_count":0,"verification":{"verified":false,"reason":"unsigned","signature":null,"payload":null}},"url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/d067c2c31fb9e5a577c7d4d01fa75de51e0a5b3d","html_url":"https://github.com/EnricoDAlessandro97UNI/syncope/commit/d067c2c31fb9e5a577c7d4d01fa75de51e0a5b3d","comments_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/d067c2c31fb9e5a577c7d4d01fa75de51e0a5b3d/comments","author":{"login":"ilgrosso","id":1064664,"node_id":"MDQ6VXNlcjEwNjQ2NjQ=","avatar_url":"https://avatars.githubusercontent.com/u/1064664?v=4","gravatar_id":"","url":"https://api.github.com/users/ilgrosso","html_url":"https://github.com/ilgrosso","followers_url":"https://api.github.com/users/ilgrosso/followers","following_url":"https://api.github.com/users/ilgrosso/following{/other_user}","gists_url":"https://api.github.com/users/ilgrosso/gists{/gist_id}","starred_url":"https://api.github.com/users/ilgrosso/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ilgrosso/subscriptions","organizations_url":"https://api.github.com/users/ilgrosso/orgs","repos_url":"https://api.github.com/users/ilgrosso/repos","events_url":"https://api.github.com/users/ilgrosso/events{/privacy}","received_events_url":"https://api.github.com/users/ilgrosso/received_events","type":"User","site_admin":false},"committer":{"login":"ilgrosso","id":1064664,"node_id":"MDQ6VXNlcjEwNjQ2NjQ=","avatar_url":"https://avatars.githubusercontent.com/u/1064664?v=4","gravatar_id":"","url":"https://api.github.com/users/ilgrosso","html_url":"https://github.com/ilgrosso","followers_url":"https://api.github.com/users/ilgrosso/followers","following_url":"https://api.github.com/users/ilgrosso/following{/other_user}","gists_url":"https://api.github.com/users/ilgrosso/gists{/gist_id}","starred_url":"https://api.github.com/users/ilgrosso/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ilgrosso/subscriptions","organizations_url":"https://api.github.com/users/ilgrosso/orgs","repos_url":"https://api.github.com/users/ilgrosso/repos","events_url":"https://api.github.com/users/ilgrosso/events{/privacy}","received_events_url":"https://api.github.com/users/ilgrosso/received_events","type":"User","site_admin":false},"parents":[{"sha":"e53e6d99bbd1cf39dacc4c817444cf4477426bec","url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/e53e6d99bbd1cf39dacc4c817444cf4477426bec","html_url":"https://github.com/EnricoDAlessandro97UNI/syncope/commit/e53e6d99bbd1cf39dacc4c817444cf4477426bec"}],"stats":{"total":53,"additions":34,"deletions":19},"files":[{"sha":"00921ee4237b2b71f17e26d3872ac98208ae7e31","filename":"core/persistence-api/src/main/java/org/apache/syncope/core/persistence/api/dao/UserDAO.java","status":"modified","additions":2,"deletions":0,"changes":2,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/d067c2c31fb9e5a577c7d4d01fa75de51e0a5b3d/core%2Fpersistence-api%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fpersistence%2Fapi%2Fdao%2FUserDAO.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/d067c2c31fb9e5a577c7d4d01fa75de51e0a5b3d/core%2Fpersistence-api%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fpersistence%2Fapi%2Fdao%2FUserDAO.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fpersistence-api%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fpersistence%2Fapi%2Fdao%2FUserDAO.java?ref=d067c2c31fb9e5a577c7d4d01fa75de51e0a5b3d","patch":"@@ -54,6 +54,8 @@ public interface UserDAO extends AnyDAO<User> {\n \n     Collection<String> findAllGroupKeys(User user);\n \n+    Collection<String> findAllGroupNames(User user);\n+\n     Collection<ExternalResource> findAllResources(User user);\n \n     Collection<String> findAllResourceNames(User user);"},{"sha":"0624190635d5e232c8d434ba52076f9ee6ad3a8e","filename":"core/persistence-jpa/src/main/java/org/apache/syncope/core/persistence/jpa/dao/JPAUserDAO.java","status":"modified","additions":12,"deletions":0,"changes":12,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/d067c2c31fb9e5a577c7d4d01fa75de51e0a5b3d/core%2Fpersistence-jpa%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fpersistence%2Fjpa%2Fdao%2FJPAUserDAO.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/d067c2c31fb9e5a577c7d4d01fa75de51e0a5b3d/core%2Fpersistence-jpa%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fpersistence%2Fjpa%2Fdao%2FJPAUserDAO.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fpersistence-jpa%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fpersistence%2Fjpa%2Fdao%2FJPAUserDAO.java?ref=d067c2c31fb9e5a577c7d4d01fa75de51e0a5b3d","patch":"@@ -463,6 +463,18 @@ public Collection<String> findAllGroupKeys(final User user) {\n         return CollectionUtils.collect(findAllGroups(user), EntityUtils.<Group>keyTransformer());\n     }\n \n+    @Transactional(propagation = Propagation.REQUIRES_NEW, readOnly = true)\n+    @Override\n+    public Collection<String> findAllGroupNames(final User user) {\n+        return CollectionUtils.collect(findAllGroups(user), new Transformer<Group, String>() {\n+\n+            @Override\n+            public String transform(final Group input) {\n+                return input.getName();\n+            }\n+        });\n+    }\n+\n     @Transactional(propagation = Propagation.REQUIRES_NEW, readOnly = true)\n     @Override\n     public Collection<ExternalResource> findAllResources(final User user) {"},{"sha":"1c1e75cebf31e7bfa7e736d54528f6788a9efd2a","filename":"core/workflow-activiti/src/main/java/org/apache/syncope/core/workflow/activiti/ActivitiUserWorkflowAdapter.java","status":"modified","additions":2,"deletions":2,"changes":4,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/d067c2c31fb9e5a577c7d4d01fa75de51e0a5b3d/core%2Fworkflow-activiti%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fworkflow%2Factiviti%2FActivitiUserWorkflowAdapter.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/d067c2c31fb9e5a577c7d4d01fa75de51e0a5b3d/core%2Fworkflow-activiti%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fworkflow%2Factiviti%2FActivitiUserWorkflowAdapter.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fworkflow-activiti%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fworkflow%2Factiviti%2FActivitiUserWorkflowAdapter.java?ref=d067c2c31fb9e5a577c7d4d01fa75de51e0a5b3d","patch":"@@ -688,8 +688,8 @@ public List<WorkflowFormTO> getForms() {\n                     taskCandidateOrAssigned(user.getKey())));\n \n             List<String> candidateGroups = new ArrayList<>();\n-            for (String groupKey : userDAO.findAllGroupKeys(user)) {\n-                candidateGroups.add(groupKey);\n+            for (String groupName : userDAO.findAllGroupNames(user)) {\n+                candidateGroups.add(groupName);\n             }\n             if (!candidateGroups.isEmpty()) {\n                 forms.addAll(getForms(engine.getTaskService().createTaskQuery()."},{"sha":"a259bc869b89ac3e8095101a34ce6ec283720a7b","filename":"core/workflow-activiti/src/main/java/org/apache/syncope/core/workflow/activiti/ActivitiUtils.java","status":"modified","additions":2,"deletions":2,"changes":4,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/d067c2c31fb9e5a577c7d4d01fa75de51e0a5b3d/core%2Fworkflow-activiti%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fworkflow%2Factiviti%2FActivitiUtils.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/d067c2c31fb9e5a577c7d4d01fa75de51e0a5b3d/core%2Fworkflow-activiti%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fworkflow%2Factiviti%2FActivitiUtils.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fworkflow-activiti%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fworkflow%2Factiviti%2FActivitiUtils.java?ref=d067c2c31fb9e5a577c7d4d01fa75de51e0a5b3d","patch":"@@ -27,12 +27,12 @@\n public class ActivitiUtils {\n \n     @Transactional(readOnly = true)\n-    public boolean isUserIngroup(final User user, final String groupKey) {\n+    public boolean isUserIngroup(final User user, final String groupName) {\n         return IterableUtils.matchesAny(user.getMemberships(), new Predicate<UMembership>() {\n \n             @Override\n             public boolean evaluate(final UMembership membership) {\n-                return groupKey != null && groupKey.equals(membership.getRightEnd().getKey());\n+                return groupName != null && groupName.equals(membership.getRightEnd().getName());\n             }\n         });\n     }"},{"sha":"5725b6e8746fb5f090dd8e5af002ad0c6d9ce844","filename":"core/workflow-activiti/src/main/java/org/apache/syncope/core/workflow/activiti/SyncopeGroupManager.java","status":"modified","additions":2,"deletions":2,"changes":4,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/d067c2c31fb9e5a577c7d4d01fa75de51e0a5b3d/core%2Fworkflow-activiti%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fworkflow%2Factiviti%2FSyncopeGroupManager.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/d067c2c31fb9e5a577c7d4d01fa75de51e0a5b3d/core%2Fworkflow-activiti%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fworkflow%2Factiviti%2FSyncopeGroupManager.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fworkflow-activiti%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fworkflow%2Factiviti%2FSyncopeGroupManager.java?ref=d067c2c31fb9e5a577c7d4d01fa75de51e0a5b3d","patch":"@@ -67,8 +67,8 @@ public List<Group> findGroupsByUser(final String userId) {\n         User user = userDAO.findByUsername(userId);\n         if (user != null) {\n             result = new ArrayList<>();\n-            for (String groupKey : userDAO.findAllGroupKeys(user)) {\n-                result.add(new GroupEntity(groupKey));\n+            for (String groupName : userDAO.findAllGroupNames(user)) {\n+                result.add(new GroupEntity(groupName));\n             }\n         }\n "},{"sha":"dbab82a36d413c8eee1cea205c82636d52eae3bf","filename":"core/workflow-activiti/src/main/java/org/apache/syncope/core/workflow/activiti/SyncopeUserManager.java","status":"modified","additions":7,"deletions":7,"changes":14,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/d067c2c31fb9e5a577c7d4d01fa75de51e0a5b3d/core%2Fworkflow-activiti%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fworkflow%2Factiviti%2FSyncopeUserManager.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/d067c2c31fb9e5a577c7d4d01fa75de51e0a5b3d/core%2Fworkflow-activiti%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fworkflow%2Factiviti%2FSyncopeUserManager.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fworkflow-activiti%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fworkflow%2Factiviti%2FSyncopeUserManager.java?ref=d067c2c31fb9e5a577c7d4d01fa75de51e0a5b3d","patch":"@@ -70,25 +70,25 @@ public void deleteUser(final String userKey) {\n     }\n \n     @Override\n-    public List<Group> findGroupsByUser(final String userKey) {\n+    public List<Group> findGroupsByUser(final String username) {\n         List<Group> result = Collections.emptyList();\n-        org.apache.syncope.core.persistence.api.entity.user.User user = userDAO.find(userKey);\n+        org.apache.syncope.core.persistence.api.entity.user.User user = userDAO.findByUsername(username);\n         if (user != null) {\n             result = new ArrayList<>();\n-            for (String groupKey : userDAO.findAllGroupKeys(user)) {\n-                result.add(new GroupEntity(groupKey.toString()));\n+            for (String groupName : userDAO.findAllGroupNames(user)) {\n+                result.add(new GroupEntity(groupName));\n             }\n         }\n \n         return result;\n     }\n \n     @Override\n-    public UserEntity findUserById(final String userKey) {\n+    public UserEntity findUserById(final String username) {\n         UserEntity result = null;\n-        org.apache.syncope.core.persistence.api.entity.user.User user = userDAO.find(userKey);\n+        org.apache.syncope.core.persistence.api.entity.user.User user = userDAO.findByUsername(username);\n         if (user != null) {\n-            result = new UserEntity(userKey);\n+            result = new UserEntity(username);\n         }\n \n         return result;"},{"sha":"dd10566d30ea8dabc672f0854d2b71dcb01a4956","filename":"core/workflow-activiti/src/main/java/org/apache/syncope/core/workflow/activiti/SyncopeUserQueryImpl.java","status":"modified","additions":1,"deletions":1,"changes":2,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/d067c2c31fb9e5a577c7d4d01fa75de51e0a5b3d/core%2Fworkflow-activiti%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fworkflow%2Factiviti%2FSyncopeUserQueryImpl.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/d067c2c31fb9e5a577c7d4d01fa75de51e0a5b3d/core%2Fworkflow-activiti%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fworkflow%2Factiviti%2FSyncopeUserQueryImpl.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fworkflow-activiti%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fworkflow%2Factiviti%2FSyncopeUserQueryImpl.java?ref=d067c2c31fb9e5a577c7d4d01fa75de51e0a5b3d","patch":"@@ -135,7 +135,7 @@ private void execute() {\n             org.apache.syncope.core.persistence.api.entity.user.User user = userDAO.findByUsername(username);\n             if (user == null) {\n                 result = Collections.<User>emptyList();\n-            } else if (memberOf == null || userDAO.findAllGroupKeys(user).contains(memberOf)) {\n+            } else if (memberOf == null || userDAO.findAllGroupNames(user).contains(memberOf)) {\n                 result = Collections.singletonList(fromSyncopeUser(user));\n             }\n         }"},{"sha":"398e4bc7d8e403b3aefd838233fd2760e994a236","filename":"fit/core-reference/src/main/resources/userWorkflow.bpmn20.xml","status":"modified","additions":4,"deletions":4,"changes":8,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/d067c2c31fb9e5a577c7d4d01fa75de51e0a5b3d/fit%2Fcore-reference%2Fsrc%2Fmain%2Fresources%2FuserWorkflow.bpmn20.xml","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/d067c2c31fb9e5a577c7d4d01fa75de51e0a5b3d/fit%2Fcore-reference%2Fsrc%2Fmain%2Fresources%2FuserWorkflow.bpmn20.xml","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/fit%2Fcore-reference%2Fsrc%2Fmain%2Fresources%2FuserWorkflow.bpmn20.xml?ref=d067c2c31fb9e5a577c7d4d01fa75de51e0a5b3d","patch":"@@ -35,16 +35,16 @@ under the License.\n     <exclusiveGateway id=\"createGW\"/>\n     <sequenceFlow id=\"createAsAnonymous2Approval\" sourceRef=\"createGW\" targetRef=\"createApproval\">\n       <conditionExpression xsi:type=\"tFormalExpression\">\n-        <![CDATA[${wfExecutor == 'anonymous' || activitiUtils.isUserIngroup(user, '0cbcabd2-4410-4b6b-8f05-a052b451d18f')}]]>\n+        <![CDATA[${wfExecutor == 'anonymous' || activitiUtils.isUserIngroup(user, 'groupForWorkflowApproval')}]]>\n       </conditionExpression>\n     </sequenceFlow>\n     <sequenceFlow id=\"create2Activate\" sourceRef=\"createGW\" targetRef=\"enableGW\">\n       <conditionExpression xsi:type=\"tFormalExpression\">\n-        <![CDATA[${!activitiUtils.isUserIngroup(user, '0cbcabd2-4410-4b6b-8f05-a052b451d18f')}]]>\n+        <![CDATA[${!activitiUtils.isUserIngroup(user, 'groupForWorkflowApproval')}]]>\n       </conditionExpression>\n     </sequenceFlow>\n     <userTask id=\"createApproval\" name=\"Create approval\"\n-              activiti:candidateGroups=\"bf825fe1-7320-4a54-bd64-143b5c18ab97\" activiti:formKey=\"createApproval\">\n+              activiti:candidateGroups=\"managingDirector\" activiti:formKey=\"createApproval\">\n       <extensionElements>\n         <activiti:formProperty id=\"username\" name=\"Username\" type=\"string\" expression=\"${user.username}\" writable=\"false\"/>\n         <activiti:formProperty id=\"approve\" name=\"Approve?\" type=\"boolean\" variable=\"approve\" required=\"true\"/>\n@@ -62,7 +62,7 @@ under the License.\n     <exclusiveGateway id=\"enableGW\"/>\n     <sequenceFlow id=\"createApprovalGW2OptIn\" sourceRef=\"enableGW\" targetRef=\"generateToken\">\n       <conditionExpression xsi:type=\"tFormalExpression\">\n-        <![CDATA[${activitiUtils.isUserIngroup(user, '268fed79-f440-4390-9435-b273768eb5d6')}]]>\n+        <![CDATA[${activitiUtils.isUserIngroup(user, 'groupForWorkflowOptIn')}]]>\n       </conditionExpression>\n     </sequenceFlow>\n     <sequenceFlow id=\"createApprovalGW2Activate\" sourceRef=\"enableGW\" targetRef=\"activate\">"},{"sha":"79f3bd9242e419e673e781d417deb58b139fd010","filename":"fit/core-reference/src/test/java/org/apache/syncope/fit/core/AuthenticationITCase.java","status":"modified","additions":2,"deletions":1,"changes":3,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/d067c2c31fb9e5a577c7d4d01fa75de51e0a5b3d/fit%2Fcore-reference%2Fsrc%2Ftest%2Fjava%2Forg%2Fapache%2Fsyncope%2Ffit%2Fcore%2FAuthenticationITCase.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/d067c2c31fb9e5a577c7d4d01fa75de51e0a5b3d/fit%2Fcore-reference%2Fsrc%2Ftest%2Fjava%2Forg%2Fapache%2Fsyncope%2Ffit%2Fcore%2FAuthenticationITCase.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/fit%2Fcore-reference%2Fsrc%2Ftest%2Fjava%2Forg%2Fapache%2Fsyncope%2Ffit%2Fcore%2FAuthenticationITCase.java?ref=d067c2c31fb9e5a577c7d4d01fa75de51e0a5b3d","patch":"@@ -468,7 +468,8 @@ public boolean evaluate(final String entitlement) {\n     public void issueSYNCOPE434() {\n         Assume.assumeTrue(ActivitiDetector.isActivitiEnabledForUsers(syncopeService));\n \n-        // 1. create user with group 9 (users with group 9 are defined in workflow as subject to approval)\n+        // 1. create user with group 'groupForWorkflowApproval' \n+        // (users with group groupForWorkflowApproval are defined in workflow as subject to approval)\n         UserTO userTO = UserITCase.getUniqueSampleTO(\"createWithReject@syncope.apache.org\");\n         userTO.getMemberships().add(\n                 new MembershipTO.Builder().group(\"0cbcabd2-4410-4b6b-8f05-a052b451d18f\").build());"}]}