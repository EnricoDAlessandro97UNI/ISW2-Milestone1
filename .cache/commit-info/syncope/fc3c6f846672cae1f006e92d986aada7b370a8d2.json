{"sha":"fc3c6f846672cae1f006e92d986aada7b370a8d2","node_id":"MDY6Q29tbWl0NjM2ODc5MDYyOmZjM2M2Zjg0NjY3MmNhZTFmMDA2ZTkyZDk4NmFhZGE3YjM3MGE4ZDI=","commit":{"author":{"name":"Unknown","email":"unknown@apache.org","date":"2010-10-07T14:04:37Z"},"committer":{"name":"Unknown","email":"unknown@apache.org","date":"2010-10-07T14:04:37Z"},"message":"Merge from 0_1_X\n\ngit-svn-id: https://svn.apache.org/repos/asf/incubator/syncope/trunk@1246574 13f79535-47bb-0310-9956-ffa450edef68","tree":{"sha":"2ab99b4bd7479337e96b90b1910fde3c13ae2268","url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/git/trees/2ab99b4bd7479337e96b90b1910fde3c13ae2268"},"url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/git/commits/fc3c6f846672cae1f006e92d986aada7b370a8d2","comment_count":0,"verification":{"verified":false,"reason":"unsigned","signature":null,"payload":null}},"url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/fc3c6f846672cae1f006e92d986aada7b370a8d2","html_url":"https://github.com/EnricoDAlessandro97UNI/syncope/commit/fc3c6f846672cae1f006e92d986aada7b370a8d2","comments_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/fc3c6f846672cae1f006e92d986aada7b370a8d2/comments","author":null,"committer":null,"parents":[{"sha":"d0af546a0db15028900d9684a76051a410204544","url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/d0af546a0db15028900d9684a76051a410204544","html_url":"https://github.com/EnricoDAlessandro97UNI/syncope/commit/d0af546a0db15028900d9684a76051a410204544"}],"stats":{"total":2146,"additions":1411,"deletions":735},"files":[{"sha":"c67e20ed98427e233a9c4ffce74a10a1f3aac308","filename":"console/src/main/java/org/syncope/console/commons/SearchConditionWrapper.java","status":"modified","additions":61,"deletions":25,"changes":86,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/fc3c6f846672cae1f006e92d986aada7b370a8d2/console%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fconsole%2Fcommons%2FSearchConditionWrapper.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/fc3c6f846672cae1f006e92d986aada7b370a8d2/console%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fconsole%2Fcommons%2FSearchConditionWrapper.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/console%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fconsole%2Fcommons%2FSearchConditionWrapper.java?ref=fc3c6f846672cae1f006e92d986aada7b370a8d2","patch":"@@ -14,51 +14,87 @@\n  */\n package org.syncope.console.commons;\n \n-import org.syncope.client.search.NodeCond;\n+import java.io.Serializable;\n+import org.syncope.client.search.AttributeCond;\n+import org.syncope.client.search.AttributeCond.Type;\n \n /**\n  * Generic search condition wrapper class.\n  */\n-public class SearchConditionWrapper {\n+public class SearchConditionWrapper implements Serializable {\n \n-    public enum ConditionType {\n+    public enum OperationType {AND,OR};\n \n-        AND, OR, NOT\n-    };\n-    private ConditionType conditionType;\n-    private NodeCond.Type type;\n-    private String schemaName;\n-    private String schemaValue;\n+    public enum FilterType {ATTRIBUTE,MEMBERSHIP};\n \n-    public ConditionType getConditionType() {\n-        return conditionType;\n-    }\n+    //public enum NotOperator {NOT};\n \n-    public void setConditionType(ConditionType expressionType) {\n-        this.conditionType = expressionType;\n-    }\n+    /** Not value: true if provided, false otherwise */\n+    private boolean notOperator;\n+\n+    private OperationType operationType = null;\n+\n+    private Type type;\n+\n+    private FilterType filterType;\n+    \n+    private String filterName;\n \n-    public String getSchemaName() {\n-        return schemaName;\n+    private String filterValue;\n+\n+    public boolean isNotOperator() {\n+        return notOperator;\n     }\n \n-    public void setSchemaName(String schemaName) {\n-        this.schemaName = schemaName;\n+    public void setNotOperator(boolean notOperator) {\n+        this.notOperator = notOperator;\n     }\n \n-    public String getSchemaValue() {\n-        return schemaValue;\n+//    public NotOperator getNotOperator() {\n+//        return notOperator;\n+//    }\n+//\n+//    public void setNotOperator(NotOperator notOperator) {\n+//        this.notOperator = notOperator;\n+//    }\n+\n+    public OperationType getOperationType() {\n+        return operationType;\n     }\n \n-    public void setSchemaValue(String schemaValue) {\n-        this.schemaValue = schemaValue;\n+    public void setOperationType(OperationType operationType) {\n+        this.operationType = operationType;\n     }\n \n-    public NodeCond.Type getType() {\n+    public AttributeCond.Type getType() {\n         return type;\n     }\n \n-    public void setType(NodeCond.Type type) {\n+    public void setType(AttributeCond.Type type) {\n         this.type = type;\n     }\n+\n+    public FilterType getFilterType() {\n+        return filterType;\n+    }\n+\n+    public void setFilterType(FilterType filterType) {\n+        this.filterType = filterType;\n+    }\n+\n+    public String getFilterName() {\n+        return filterName;\n+    }\n+\n+    public void setFilterName(String filterName) {\n+        this.filterName = filterName;\n+    }\n+\n+    public String getFilterValue() {\n+        return filterValue;\n+    }\n+\n+    public void setFilterValue(String filterValue) {\n+        this.filterValue = filterValue;\n+    }\n }"},{"sha":"f0b9e9ec12c0935693f6d1838bfec2b14c4997c9","filename":"console/src/main/java/org/syncope/console/pages/Login.java","status":"modified","additions":10,"deletions":5,"changes":15,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/fc3c6f846672cae1f006e92d986aada7b370a8d2/console%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fconsole%2Fpages%2FLogin.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/fc3c6f846672cae1f006e92d986aada7b370a8d2/console%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fconsole%2Fpages%2FLogin.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/console%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fconsole%2Fpages%2FLogin.java?ref=fc3c6f846672cae1f006e92d986aada7b370a8d2","patch":"@@ -60,17 +60,21 @@ public Login(PageParameters parameters) {\n         passwordField.setMarkupId(\"password\");\n         form.add(passwordField);\n \n-        languageSelect = new LocaleDropDown(\"language\",Arrays.asList(new Locale[]{Locale.ENGLISH, Locale.ITALIAN}));\n+        languageSelect = new LocaleDropDown(\"language\",Arrays.asList\n+                (new Locale[]{Locale.ENGLISH, Locale.ITALIAN}));\n         \n         form.add(languageSelect);\n \n-        Button submitButton = new Button(\"submit\", new Model(getString(\"submit\"))) {\n+        Button submitButton = new Button(\"submit\", new Model(\n+                getString(\"submit\"))) {\n \n             @Override\n             public void onSubmit() {\n-                inputStream = ((SyncopeApplication)getApplication()).getAuthenticationFile();\n+                inputStream = ((SyncopeApplication)getApplication())\n+                        .getAuthenticationFile();\n                 Authentication auth = new Authentication();\n-                Boolean authenticated = auth.authentication(usernameField.getRawInput(),\n+                Boolean authenticated = auth.authentication(usernameField\n+                        .getRawInput(),\n                         passwordField.getRawInput(), inputStream);\n                 if (authenticated == true) {\n                     SyncopeUser user = new SyncopeUser();\n@@ -80,7 +84,8 @@ public void onSubmit() {\n                     try {\n                         inputStream.close();\n                     } catch (IOException ex) {\n-                        Logger.getLogger(Login.class.getName()).log(Level.SEVERE, null, ex);\n+                        Logger.getLogger(Login.class.getName())\n+                                .log(Level.SEVERE, null, ex);\n                     }\n                 } else {\n                     error(getString(\"login-error\"));"},{"sha":"9d6bb8d595e2379463cb92f9dde12075701b48da","filename":"console/src/main/java/org/syncope/console/pages/ResourceModalPage.java","status":"modified","additions":2,"deletions":1,"changes":3,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/fc3c6f846672cae1f006e92d986aada7b370a8d2/console%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fconsole%2Fpages%2FResourceModalPage.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/fc3c6f846672cae1f006e92d986aada7b370a8d2/console%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fconsole%2Fpages%2FResourceModalPage.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/console%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fconsole%2Fpages%2FResourceModalPage.java?ref=fc3c6f846672cae1f006e92d986aada7b370a8d2","patch":"@@ -175,7 +175,8 @@ public void detach() {\n \n         resourceForm.add(connector);\n \n-        mappingUserSchemaView = new ListView(\"mappingsUserSchema\", schemaMappingTOs.getMappings()) {\n+        mappingUserSchemaView = new ListView(\"mappingsUserSchema\",\n+                schemaMappingTOs.getMappings()) {\n \n             SchemaMappingTO mappingTO = null;\n             UpdatingDropDownChoice schemaAttributeChoice = null;"},{"sha":"fcdad750d2c604d6576282ba424f5e479a51b8af","filename":"console/src/main/java/org/syncope/console/pages/UserModalPage.java","status":"modified","additions":659,"deletions":621,"changes":1280,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/fc3c6f846672cae1f006e92d986aada7b370a8d2/console%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fconsole%2Fpages%2FUserModalPage.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/fc3c6f846672cae1f006e92d986aada7b370a8d2/console%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fconsole%2Fpages%2FUserModalPage.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/console%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fconsole%2Fpages%2FUserModalPage.java?ref=fc3c6f846672cae1f006e92d986aada7b370a8d2","patch":"@@ -80,856 +80,894 @@\n import org.syncope.console.wicket.markup.html.form.DateFieldPanel;\n import org.syncope.console.wicket.markup.html.tree.SyncopeRoleTree;\n import org.syncope.console.wicket.markup.html.tree.TreeModelBean;\n-import org.syncope.types.SchemaValueType;\n \n /**\n  * Modal window with User form.\n  */\n public class UserModalPage extends SyncopeModalPage {\n \n-    @SpringBean(name = \"usersRestClient\")\n-    UsersRestClient usersRestClient;\n+@SpringBean(name = \"usersRestClient\")\n+UsersRestClient usersRestClient;\n \n-    @SpringBean(name = \"rolesRestClient\")\n-    RolesRestClient rolesRestClient;\n+@SpringBean(name = \"rolesRestClient\")\n+RolesRestClient rolesRestClient;\n \n-    WebMarkupContainer container;\n-    WebMarkupContainer membershipsContainer;\n+WebMarkupContainer container;\n+WebMarkupContainer membershipsContainer;\n \n-    AjaxButton submit;\n+AjaxButton submit;\n \n-    List<SchemaWrapper> schemaWrappers;\n-    List<MembershipTO> membershipTOs;\n+List<SchemaWrapper> schemaWrappers;\n+List<MembershipTO> membershipTOs;\n \n-    final ModalWindow createUserWin;\n+final ModalWindow createUserWin;\n \n-    UserTO oldUser;\n-    UserMod userMod;\n+UserTO oldUser;\n+UserMod userMod;\n \n-    Map rolesMap;\n+Map rolesMap;\n \n-    /**\n-     *\n-     * @param basePage base\n-     * @param modalWindow modal window\n-     * @param connectorTO\n-     * @param create : set to true only if a CREATE operation is required\n-     */\n-    public UserModalPage(final BasePage basePage, final ModalWindow window,\n-            final UserTO userTO, final boolean createFlag) {\n+/**\n+ *\n+ * @param basePage base\n+ * @param modalWindow modal window\n+ * @param connectorTO\n+ * @param create : set to true only if a CREATE operation is required\n+ */\n+public UserModalPage(final BasePage basePage, final ModalWindow window,\n+    final UserTO userTO, final boolean createFlag) {\n \n-        if (!createFlag) {\n-            cloneOldUserTO(userTO);\n-        }\n+if (!createFlag) {\n+    cloneOldUserTO(userTO);\n+}\n \n-        setupRolesMap();\n+setupRolesMap();\n \n-        add(createUserWin = new ModalWindow(\"membershipWin\"));\n+add(createUserWin = new ModalWindow(\"membershipWin\"));\n \n-        createUserWin.setCssClassName(ModalWindow.CSS_CLASS_GRAY);\n-//        createUserWin.setInitialHeight(WIN_USER_HEIGHT);\n-//        createUserWin.setInitialWidth(WIN_USER_WIDTH);\n-        createUserWin.setPageMapName(\"create-membership-modal\");\n-        createUserWin.setCookieName(\"create-membership-modal\");\n+createUserWin.setCssClassName(ModalWindow.CSS_CLASS_GRAY);\n+createUserWin.setPageMapName(\"create-membership-modal\");\n+createUserWin.setCookieName(\"create-membership-modal\");\n \n-        Form userForm = new Form(\"UserForm\");\n+Form userForm = new Form(\"UserForm\");\n \n-        userForm.setModel(new CompoundPropertyModel(userTO));\n+userForm.setModel(new CompoundPropertyModel(userTO));\n \n-        setupSchemaWrappers(createFlag, userTO);\n-        setupMemberships(createFlag, userTO);\n+setupSchemaWrappers(createFlag, userTO);\n+setupMemberships(createFlag, userTO);\n \n-        final ListView userAttributesView = new ListView(\"userSchemas\", schemaWrappers) {\n+final ListView userAttributesView = new ListView(\"userSchemas\",\n+        schemaWrappers) {\n \n-            @Override\n-            protected void populateItem(ListItem item) {\n-                final SchemaWrapper schemaWrapper = (SchemaWrapper) item.getDefaultModelObject();\n+@Override\n+protected void populateItem(ListItem item) {\n+final SchemaWrapper schemaWrapper =\n+        (SchemaWrapper) item.getDefaultModelObject();\n \n-                final SchemaTO schemaTO = schemaWrapper.getSchemaTO();\n+final SchemaTO schemaTO = schemaWrapper.getSchemaTO();\n \n-                item.add(new Label(\"name\", schemaWrapper.getSchemaTO().getName()));\n+item.add(new Label(\"name\", schemaWrapper.getSchemaTO()\n+        .getName()));\n \n-                item.add(new ListView(\"fields\", schemaWrapper.getValues()) {\n+item.add(new ListView(\"fields\", schemaWrapper.getValues()) {\n \n-                    Panel panel;\n+Panel panel;\n \n-                    @Override\n-                    protected void populateItem(final ListItem item) {\n+    @Override\n+    protected void populateItem(final ListItem item) {\n \n-                        if (schemaTO.getType().getClassName().equals(\"java.lang.String\")) {\n-                            panel = new AjaxTextFieldPanel(\"panel\", schemaTO.getName(), new Model() {\n+        if (schemaTO.getType().getClassName()\n+                .equals(\"java.lang.String\")) {\n+            panel = new AjaxTextFieldPanel(\"panel\",\n+                    schemaTO.getName(), new Model() {\n \n-                                @Override\n-                                public Serializable getObject() {\n-                                    return (String) item.getModelObject();\n-                                }\n+                @Override\n+                public Serializable getObject() {\n+                    return (String) item.getModelObject();\n+                }\n \n-                                @Override\n-                                public void setObject(Serializable object) {\n-                                    item.setModelObject((String) object);\n-                                }\n-                            }, schemaTO.isMandatory(),schemaTO.isReadonly());\n-                        } else if (schemaTO.getType().getClassName().equals(\"java.lang.Boolean\")) {\n-                            panel = new AjaxCheckBoxPanel(\"panel\", schemaTO.getName(), new Model() {\n-\n-                                @Override\n-                                public Serializable getObject() {\n-                                    return (String) item.getModelObject();\n-                                    //return \"false\";\n-                                }\n+                @Override\n+                public void setObject(Serializable object) {\n+                    item.setModelObject((String) object);\n+                }\n+            }, schemaTO.isMandatory(),schemaTO.isReadonly());\n+        }\n+        else if (schemaTO.getType().getClassName()\n+                .equals(\"java.lang.Boolean\")) {\n+            panel = new AjaxCheckBoxPanel(\"panel\",\n+                    schemaTO.getName(), new Model() {\n \n-                                @Override\n-                                public void setObject(Serializable object) {\n-                                    Boolean val = (Boolean) object;\n-                                    item.setModelObject(val.toString());\n-                                }\n-                            }, schemaTO.isMandatory(), schemaTO.isReadonly());\n-\n-                        } else if (schemaTO.getType().getClassName().equals(\"java.util.Date\")) {\n-                            panel = new DateFieldPanel(\"panel\", schemaTO.getName(),\n-                                    new Model() {\n-\n-                                        @Override\n-                                        public Serializable getObject() {\n-                                            DateFormat formatter = new SimpleDateFormat(schemaTO.getConversionPattern());\n-                                            Date date = new Date();\n-\n-                                            try {\n-                                                String dateValue = (String) item.getModelObject();\n-                                                formatter = new SimpleDateFormat(schemaTO.getConversionPattern());//Default value:yyyy-MM-dd\n-\n-                                                if (!dateValue.equals(\"\")) {\n-                                                    date = formatter.parse((String) item.getModelObject());\n-                                                }\n-\n-                                            } catch (ParseException ex) {\n-                                                Logger.getLogger(UserModalPage.class.getName()).log(Level.SEVERE, null, ex);\n-                                            }\n-                                            return date;\n-                                        }\n-\n-                                        @Override\n-                                        public void setObject(Serializable object) {\n-                                            Date date = (Date) object;\n-                                            Format formatter = new SimpleDateFormat(schemaTO.getConversionPattern());\n-                                            String val = formatter.format(date);\n-                                            item.setModelObject(val);\n-                                        }\n-                                    }, schemaTO.isMandatory(),schemaTO.isReadonly());\n-                        } else {\n-                            panel = new AjaxTextFieldPanel(\"panel\", schemaTO.getName(), new Model() {\n-\n-                                @Override\n-                                public Serializable getObject() {\n-                                    return (String) item.getModelObject();\n-                                }\n+                @Override\n+                public Serializable getObject() {\n+                    return (String) item.getModelObject();\n+                }\n \n-                                @Override\n-                                public void setObject(Serializable object) {\n-                                    item.setModelObject((String) object);\n-                                }\n-                            }, schemaTO.isMandatory(),schemaTO.isReadonly());\n-                        }\n+                @Override\n+                public void setObject(Serializable object) {\n+                    Boolean val = (Boolean) object;\n+                    item.setModelObject(val.toString());\n+                }\n+            }, schemaTO.isMandatory(), schemaTO.isReadonly());\n \n-                        item.add(panel);\n-                    }\n-                });\n+        } else if (schemaTO.getType().getClassName().equals(\"java.util.Date\")) {\n+            panel = new DateFieldPanel(\"panel\", schemaTO.getName(),\n+                    new Model() {\n \n-                AjaxButton addButton = new AjaxButton(\"add\", new Model(getString(\"add\"))) {\n+                        @Override\n+                        public Serializable getObject() {\n+                            DateFormat formatter = new SimpleDateFormat(\n+                                    schemaTO.getConversionPattern());\n+                            Date date = new Date();\n+\n+                            try {\n+                                String dateValue = (String) item.getModelObject();\n+                                formatter = new SimpleDateFormat(\n+                                        schemaTO.getConversionPattern());\n+\n+                                if (!dateValue.equals(\"\")) {\n+                                    date = formatter.parse((String)\n+                                            item.getModelObject());\n+                                }\n \n-                    @Override\n-                    protected void onSubmit(AjaxRequestTarget target, Form form) {\n-                        schemaWrapper.getValues().add(\"\");\n+                            } catch (ParseException ex) {\n+                                Logger.getLogger(UserModalPage.class.getName())\n+                                        .log(Level.SEVERE, null, ex);\n+                            }\n+                            return date;\n+                        }\n \n-                        target.addComponent(container);\n-                    }\n-                };\n+                        @Override\n+                        public void setObject(Serializable object) {\n+                            Date date = (Date) object;\n+                            Format formatter = new SimpleDateFormat(schemaTO\n+                                    .getConversionPattern());\n+                            String val = formatter.format(date);\n+                            item.setModelObject(val);\n+                        }\n+                    }, schemaTO.isMandatory(),\n+                            schemaTO.isReadonly());\n+        } else {\n+            panel = new AjaxTextFieldPanel(\"panel\",\n+                    schemaTO.getName(), new Model() {\n \n-                AjaxButton dropButton = new AjaxButton(\"drop\", new Model(getString(\"drop\"))) {\n+                @Override\n+                public Serializable getObject() {\n+                    return (String) item.getModelObject();\n+                }\n \n-                    @Override\n-                    protected void onSubmit(AjaxRequestTarget target, Form form) {\n-                        //Drop the last component added\n-                        schemaWrapper.getValues().remove(schemaWrapper.getValues().size() - 1);\n+                @Override\n+                public void setObject(Serializable object) {\n+                    item.setModelObject((String) object);\n+                }\n+            }, schemaTO.isMandatory(),schemaTO.isReadonly());\n+        }\n \n-                        target.addComponent(container);\n-                    }\n-                };\n+        item.add(panel);\n+    }\n+    });\n \n-                if (schemaTO.getType().getClassName().equals(\"java.lang.Boolean\")) {\n-                    addButton.setVisible(false);\n-                    dropButton.setVisible(false);\n-                }\n+        AjaxButton addButton = new AjaxButton(\"add\",\n+                new Model(getString(\"add\"))) {\n \n-                addButton.setDefaultFormProcessing(false);\n-                addButton.setVisible(schemaTO.isMultivalue());\n+            @Override\n+            protected void onSubmit(AjaxRequestTarget target,\n+                    Form form) {\n+                schemaWrapper.getValues().add(\"\");\n \n-                dropButton.setDefaultFormProcessing(false);\n-                dropButton.setVisible(schemaTO.isMultivalue());\n+                target.addComponent(container);\n+            }\n+        };\n \n-                if (schemaWrapper.getValues().size() == 1) {\n-                    dropButton.setVisible(false);\n-                }\n+        AjaxButton dropButton = new AjaxButton(\"drop\",\n+                new Model(getString(\"drop\"))) {\n \n-                if(schemaTO.isReadonly()) {\n-                    addButton.setEnabled(false);\n-                    dropButton.setEnabled(false);\n-                }\n+            @Override\n+            protected void onSubmit(AjaxRequestTarget target,\n+                    Form form) {\n+                //Drop the last component added\n+                schemaWrapper.getValues().remove(schemaWrapper\n+                        .getValues().size() - 1);\n \n-                item.add(addButton);\n-                item.add(dropButton);\n+                target.addComponent(container);\n             }\n         };\n \n-        userForm.add(userAttributesView);\n+        if (schemaTO.getType().getClassName()\n+                .equals(\"java.lang.Boolean\")) {\n+            addButton.setVisible(false);\n+            dropButton.setVisible(false);\n+        }\n+\n+        addButton.setDefaultFormProcessing(false);\n+        addButton.setVisible(schemaTO.isMultivalue());\n \n-        ListModel<ResourceTO> selectedResources = new ListModel<ResourceTO>();\n-        selectedResources.setObject(getSelectedResources(userTO));\n+        dropButton.setDefaultFormProcessing(false);\n+        dropButton.setVisible(schemaTO.isMultivalue());\n+\n+        if (schemaWrapper.getValues().size() == 1) {\n+            dropButton.setVisible(false);\n+        }\n \n-        ListModel<ResourceTO> availableResources = new ListModel<ResourceTO>();\n-        availableResources.setObject(getAvailableResources(userTO));\n+        if(schemaTO.isReadonly()) {\n+            addButton.setEnabled(false);\n+            dropButton.setEnabled(false);\n+        }\n \n-        ChoiceRenderer paletteRenderer = new ChoiceRenderer(\"name\", \"name\");\n-        final Palette resourcesPalette = new Palette(\"resourcesPalette\", selectedResources,\n-                availableResources, paletteRenderer, 8, false);\n-        userForm.add(resourcesPalette);\n+        item.add(addButton);\n+        item.add(dropButton);\n+    }\n+};\n \n-        container = new WebMarkupContainer(\"container\");\n-        container.add(userAttributesView);\n+userForm.add(userAttributesView);\n \n-        PasswordTextField password = new PasswordTextField(\"password\");\n-        password.setRequired(createFlag);\n-        password.setResetPassword(false);\n-        container.add(password);\n+ListModel<ResourceTO> selectedResources = new ListModel<ResourceTO>();\n+selectedResources.setObject(getSelectedResources(userTO));\n \n-        container.setOutputMarkupId(true);\n+ListModel<ResourceTO> availableResources = new ListModel<ResourceTO>();\n+availableResources.setObject(getAvailableResources(userTO));\n \n-        userForm.add(container);\n+ChoiceRenderer paletteRenderer = new ChoiceRenderer(\"name\", \"name\");\n+final Palette resourcesPalette = new Palette(\"resourcesPalette\", \n+        selectedResources, availableResources, paletteRenderer,\n+        8, false);\n+userForm.add(resourcesPalette);\n \n-        submit = new AjaxButton(\"submit\", new Model(getString(\"submit\"))) {\n+container = new WebMarkupContainer(\"container\");\n+container.add(userAttributesView);\n \n-            @Override\n-            protected void onSubmit(AjaxRequestTarget target, Form form) {\n-                UserTO userTO = (UserTO) form.getDefaultModelObject();\n+PasswordTextField password = new PasswordTextField(\"password\");\n+password.setRequired(createFlag);\n+password.setResetPassword(false);\n+container.add(password);\n \n-                boolean res = false;\n+container.setOutputMarkupId(true);\n \n-                try {\n-                    userTO.setResources(getResourcesSet(resourcesPalette.getModelCollection()));\n-                    userTO.setAttributes(getUserAttributesSet());\n-                    userTO.setMemberships(getMembershipsSet());\n+userForm.add(container);\n \n-                    if (createFlag) {\n-                        usersRestClient.createUser(userTO);\n-                    } else {\n-                        setupUserMod(userTO);\n-                        res = usersRestClient.updateUser(userMod);\n+submit = new AjaxButton(\"submit\", new Model(getString(\"submit\"))) {\n \n-                        if (!res) \n-                            error(getString(\"error_updating\"));\n-                        \n-                    }\n+    @Override\n+    protected void onSubmit(AjaxRequestTarget target, Form form) {\n+        UserTO userTO = (UserTO) form.getDefaultModelObject();\n \n-                    Users callerPage = (Users) basePage;\n-                    callerPage.setOperationResult(true);\n+        boolean res = false;\n \n-                    window.close(target);\n+        try {\n+            userTO.setResources(getResourcesSet(resourcesPalette\n+                    .getModelCollection()));\n+            userTO.setAttributes(getUserAttributesSet());\n+            userTO.setMemberships(getMembershipsSet());\n \n-                } catch (Exception e) {\n-                    error(getString(\"error\") + \":\" + e.getMessage());\n+            if (createFlag) {\n+                usersRestClient.createUser(userTO);\n+            } else {\n+                setupUserMod(userTO);\n+\n+                //Update user just if it is changed\n+                if(userMod != null){\n+\n+                res = usersRestClient.updateUser(userMod);\n+\n+                if (!res)\n+                    error(getString(\"error_updating\"));\n+\n+                Users callerPage = (Users) basePage;\n+                callerPage.setOperationResult(true);\n                 }\n-            }\n \n-            @Override\n-            protected void onError(AjaxRequestTarget target, Form form) {\n-                target.addComponent(form.get(\"feedback\"));\n             }\n-        };\n \n-        userForm.add(submit);\n+            window.close(target);\n \n-        userForm.add(new FeedbackPanel(\"feedback\").setOutputMarkupId(true));\n+        } catch (Exception e) {\n+            error(getString(\"error\") + \":\" + e.getMessage());\n+        }\n+    }\n \n-        //Roles Tab\n-        SyncopeRoleTree roleTree = new SyncopeRoleTree(rolesRestClient);\n+    @Override\n+    protected void onError(AjaxRequestTarget target, Form form) {\n+        target.addComponent(form.get(\"feedback\"));\n+    }\n+};\n \n-        BaseTree tree;\n+userForm.add(submit);\n \n-        tree = new LinkTree(\"treeTable\", roleTree.createTreeModel()) {\n+userForm.add(new FeedbackPanel(\"feedback\").setOutputMarkupId(true));\n \n-            @Override\n-            protected IModel<Object> getNodeTextModel(IModel<Object> model) {\n-                return new PropertyModel(model, \"userObject.treeNode.name\");\n-            }\n+//Roles Tab\n+SyncopeRoleTree roleTree = new SyncopeRoleTree(rolesRestClient);\n \n-            @Override\n-            protected void onNodeLinkClicked(final Object node, final BaseTree tree,\n-                    final AjaxRequestTarget target) {\n+BaseTree tree;\n \n-                DefaultMutableTreeNode syncopeTreeNode = (DefaultMutableTreeNode) node;\n-                final TreeModelBean treeModel = (TreeModelBean) syncopeTreeNode.getUserObject();\n+tree = new LinkTree(\"treeTable\", roleTree.createTreeModel()) {\n \n-                if (treeModel.getTreeNode() != null) {\n+    @Override\n+    protected IModel<Object> getNodeTextModel(IModel<Object> model) {\n+        return new PropertyModel(model, \"userObject.treeNode.name\");\n+    }\n \n-                    createUserWin.setPageCreator(new ModalWindow.PageCreator() {\n+    @Override\n+    protected void onNodeLinkClicked(final Object node,\n+            final BaseTree tree, final AjaxRequestTarget target) {\n \n-                        MembershipTO membershipTO;\n+        DefaultMutableTreeNode syncopeTreeNode =\n+                (DefaultMutableTreeNode) node;\n+        final TreeModelBean treeModel = (TreeModelBean) syncopeTreeNode\n+                .getUserObject();\n \n-                        @Override\n-                        public Page createPage() {\n+        if (treeModel.getTreeNode() != null) {\n \n-                            membershipTO = new MembershipTO();\n-                            membershipTO.setRoleId(treeModel.getTreeNode().getId());\n-                            String title = treeModel.getTreeNode().getName();\n+            createUserWin.setPageCreator(new ModalWindow.PageCreator() {\n \n-                            MembershipModalPage form =\n-                                    new MembershipModalPage(getPage(), createUserWin,\n-                                    membershipTO, true);\n+                MembershipTO membershipTO;\n \n-                            return form;\n-                        }\n-                    });\n-                    createUserWin.show(target);\n-                }\n-            }\n-        };\n+                @Override\n+                public Page createPage() {\n \n-        tree.getTreeState().expandAll();\n-        tree.updateTree();\n+                    membershipTO = new MembershipTO();\n+                    membershipTO.setRoleId(treeModel.getTreeNode()\n+                            .getId());\n+                    String title = treeModel.getTreeNode().getName();\n \n-        userForm.add(tree);\n+                    MembershipModalPage form =\n+                            new MembershipModalPage(getPage(),\n+                            createUserWin, membershipTO, true);\n \n+                    return form;\n+                }\n+            });\n+            createUserWin.show(target);\n+        }\n+    }\n+};\n \n-        ListView membershipsView = new ListView(\"memberships\", membershipTOs) {\n+tree.getTreeState().expandAll();\n+tree.updateTree();\n \n-            @Override\n-            protected void populateItem(final ListItem item) {\n-                final MembershipTO membershipTO =\n-                        (MembershipTO) item.getDefaultModelObject();\n+userForm.add(tree);\n \n-                item.add(new Label(\"roleId\", new Model(membershipTO.getRoleId())));\n-                item.add(new Label(\"roleName\", new Model((String) rolesMap\n-                        .get(membershipTO.getRoleId()))));\n \n-                AjaxLink editLink = new AjaxLink(\"editLink\") {\n+ListView membershipsView = new ListView(\"memberships\", membershipTOs) {\n \n-                    @Override\n-                    public void onClick(AjaxRequestTarget target) {\n-                        createUserWin.setPageCreator(new ModalWindow.PageCreator() {\n+    @Override\n+    protected void populateItem(final ListItem item) {\n+        final MembershipTO membershipTO =\n+                (MembershipTO) item.getDefaultModelObject();\n \n-                            public Page createPage() {\n+        item.add(new Label(\"roleId\", new Model(membershipTO.getRoleId())));\n+        item.add(new Label(\"roleName\", new Model((String) rolesMap\n+                .get(membershipTO.getRoleId()))));\n \n-                                MembershipModalPage form = new MembershipModalPage(\n-                                        getPage(), createUserWin, membershipTO, false);\n+        AjaxLink editLink = new AjaxLink(\"editLink\") {\n \n-                                return form;\n+            @Override\n+            public void onClick(AjaxRequestTarget target) {\n+                createUserWin.setPageCreator(new ModalWindow.PageCreator() {\n \n-                            }\n-                        });\n-                        createUserWin.show(target);\n-                    }\n-                };\n-                item.add(editLink);\n+                    public Page createPage() {\n \n-                AjaxLink deleteLink = new AjaxLink(\"deleteLink\") {\n+                        MembershipModalPage form = new MembershipModalPage(\n+                                getPage(), createUserWin, membershipTO, false);\n \n-                    @Override\n-                    public void onClick(AjaxRequestTarget target) {\n-                        int componentId = new Integer(getParent().getId());\n-                        membershipTOs.remove(componentId);\n+                        return form;\n \n-                        target.addComponent(membershipsContainer);\n                     }\n-                };\n-                item.add(deleteLink);\n+                });\n+                createUserWin.show(target);\n             }\n         };\n+        item.add(editLink);\n \n-        membershipsContainer = new WebMarkupContainer(\"membershipsContainer\");\n-        membershipsContainer.add(membershipsView);\n-        membershipsContainer.setOutputMarkupId(true);\n+        AjaxLink deleteLink = new AjaxLink(\"deleteLink\") {\n \n-        setWindowClosedCallback(createUserWin, membershipsContainer);\n+            @Override\n+            public void onClick(AjaxRequestTarget target) {\n+                int componentId = new Integer(getParent().getId());\n+                membershipTOs.remove(componentId);\n \n-        userForm.add(membershipsContainer);\n-        add(userForm);\n+                target.addComponent(membershipsContainer);\n+            }\n+        };\n+        item.add(deleteLink);\n     }\n+};\n \n-    /**\n-     * Originals : user's resources\n-     * @param userTO\n-     * @return\n-     */\n-    public List<ResourceTO> getSelectedResources(UserTO userTO) {\n-        List<ResourceTO> resources = new ArrayList<ResourceTO>();\n-        ResourceTO clusterableResourceTO;\n-\n-        for (String resourceName : userTO.getResources()) {\n-            clusterableResourceTO = new ResourceTO();\n-            clusterableResourceTO.setName(resourceName);\n-            resources.add(clusterableResourceTO);\n-        }\n-        return resources;\n+membershipsContainer = new WebMarkupContainer(\"membershipsContainer\");\n+membershipsContainer.add(membershipsView);\n+membershipsContainer.setOutputMarkupId(true);\n+\n+setWindowClosedCallback(createUserWin, membershipsContainer);\n+\n+userForm.add(membershipsContainer);\n+add(userForm);\n+}\n+\n+/**\n+ * Originals : user's resources\n+ * @param userTO\n+ * @return\n+ */\n+public List<ResourceTO> getSelectedResources(UserTO userTO) {\n+    List<ResourceTO> resources = new ArrayList<ResourceTO>();\n+    ResourceTO clusterableResourceTO;\n+\n+    for (String resourceName : userTO.getResources()) {\n+        clusterableResourceTO = new ResourceTO();\n+        clusterableResourceTO.setName(resourceName);\n+        resources.add(clusterableResourceTO);\n     }\n+    return resources;\n+}\n \n-    /**\n-     * Destinations : available resources\n-     * @param userTO\n-     * @return\n-     */\n-    public List<ResourceTO> getAvailableResources(UserTO userTO) {\n+/**\n+ * Destinations : available resources\n+ * @param userTO\n+ * @return\n+ */\n+public List<ResourceTO> getAvailableResources(UserTO userTO) {\n \n-        List<ResourceTO> resources = new ArrayList<ResourceTO>();\n+    List<ResourceTO> resources = new ArrayList<ResourceTO>();\n \n-        ResourcesRestClient resourcesRestClient = (ResourcesRestClient) \n-                ((SyncopeApplication) Application.get()).getApplicationContext()\n-                .getBean(\"resourcesRestClient\");\n+    ResourcesRestClient resourcesRestClient = (ResourcesRestClient)\n+            ((SyncopeApplication) Application.get()).getApplicationContext()\n+            .getBean(\"resourcesRestClient\");\n \n-        ResourceTOs resourcesTos = resourcesRestClient.getAllResources();\n+    ResourceTOs resourcesTos = resourcesRestClient.getAllResources();\n \n-        for (ResourceTO resourceTO : resourcesTos)\n-                resources.add(resourceTO);\n+    for (ResourceTO resourceTO : resourcesTos)\n+            resources.add(resourceTO);\n \n-        return resources;\n-    }\n+    return resources;\n+}\n \n-    /**\n-     * Create a copy of old userTO object.\n-     * @param userTO\n-     */\n-    public void cloneOldUserTO(UserTO userTO) {\n-\n-        oldUser = new UserTO();\n-\n-        oldUser.setId(userTO.getId());\n-        oldUser.setPassword(userTO.getPassword());\n-        oldUser.setAttributes(userTO.getAttributes());\n-        oldUser.setResources(userTO.getResources());\n-        oldUser.setMemberships(new HashSet<MembershipTO>());\n-        \n-        MembershipTO membership;\n-\n-        for (MembershipTO membershipTO : userTO.getMemberships()) {\n-            membership = new MembershipTO();\n-            membership.setId(membershipTO.getId());\n-            membership.setRoleId(membershipTO.getRoleId());\n-            membership.setAttributes(membershipTO.getAttributes());\n-            oldUser.getMemberships().add(membership);\n-        }\n-    }\n+/**\n+ * Create a copy of old userTO object.\n+ * @param userTO\n+ */\n+public void cloneOldUserTO(UserTO userTO) {\n \n-    /**\n-     * Populate a roles hashmap of type (roleId,roleName)\n-     */\n-    public void setupRolesMap() {\n+    oldUser = new UserTO();\n \n-        rolesMap = new HashMap();\n+    oldUser.setId(userTO.getId());\n+    oldUser.setPassword(userTO.getPassword());\n+    oldUser.setAttributes(userTO.getAttributes());\n+    oldUser.setResources(userTO.getResources());\n+    oldUser.setMemberships(new HashSet<MembershipTO>());\n \n-        RoleTOs roleTOs = rolesRestClient.getAllRoles();\n+    MembershipTO membership;\n \n-        for (RoleTO roleTO : roleTOs) {\n-            rolesMap.put(roleTO.getId(), roleTO.getName());\n-        }\n+    for (MembershipTO membershipTO : userTO.getMemberships()) {\n+        membership = new MembershipTO();\n+        membership.setId(membershipTO.getId());\n+        membership.setRoleId(membershipTO.getRoleId());\n+        membership.setAttributes(membershipTO.getAttributes());\n+        oldUser.getMemberships().add(membership);\n     }\n+}\n \n-    /**\n-     * Set a WindowClosedCallback for a ModalWindow instance.\n-     * @param window\n-     * @param container\n-     */\n-    public void setWindowClosedCallback(ModalWindow window,\n-            final WebMarkupContainer container) {\n+/**\n+ * Populate a roles hashmap of type (roleId,roleName)\n+ */\n+public void setupRolesMap() {\n \n-        window.setWindowClosedCallback(\n-                new ModalWindow.WindowClosedCallback() {\n+    rolesMap = new HashMap();\n \n-                    public void onClose(AjaxRequestTarget target) {\n-                        target.addComponent(container);\n-                    }\n-                });\n+    RoleTOs roleTOs = rolesRestClient.getAllRoles();\n+\n+    for (RoleTO roleTO : roleTOs) {\n+        rolesMap.put(roleTO.getId(), roleTO.getName());\n     }\n+}\n \n-    /**\n-     * Initialize the SchemaWrapper collection\n-     * @param create\n-     * @param userTO\n-     */\n-    public void setupSchemaWrappers(boolean create, UserTO userTO) {\n+/**\n+ * Set a WindowClosedCallback for a ModalWindow instance.\n+ * @param window\n+ * @param container\n+ */\n+public void setWindowClosedCallback(ModalWindow window,\n+        final WebMarkupContainer container) {\n+\n+    window.setWindowClosedCallback(\n+            new ModalWindow.WindowClosedCallback() {\n \n-        schemaWrappers = new ArrayList<SchemaWrapper>();\n-        SchemaWrapper schemaWrapper;\n+                public void onClose(AjaxRequestTarget target) {\n+                    target.addComponent(container);\n+                }\n+            });\n+}\n \n-        SchemaRestClient schemaRestClient = (SchemaRestClient) \n-                ((SyncopeApplication) Application.get()).getApplicationContext()\n-                .getBean(\"schemaRestClient\");\n+/**\n+ * Initialize the SchemaWrapper collection\n+ * @param create\n+ * @param userTO\n+ */\n+public void setupSchemaWrappers(boolean create, UserTO userTO) {\n \n-        SchemaTOs schemas = schemaRestClient.getAllUserSchemas();\n+    schemaWrappers = new ArrayList<SchemaWrapper>();\n+    SchemaWrapper schemaWrapper;\n \n-        boolean found = false;\n+    SchemaRestClient schemaRestClient = (SchemaRestClient)\n+            ((SyncopeApplication) Application.get()).getApplicationContext()\n+            .getBean(\"schemaRestClient\");\n \n-        if (create) {\n-            for (SchemaTO schema : schemas) {\n-                schemaWrapper = new SchemaWrapper(schema);\n-                schemaWrappers.add(schemaWrapper);\n-            }\n-        } else {\n-            for (SchemaTO schema : schemas) {\n-                for (AttributeTO attribute : userTO.getAttributes()) {\n-                    if (schema.getName().equals(attribute.getSchema())) {\n-                        schemaWrapper = new SchemaWrapper(schema);\n-\n-                        if(schema.getType().equals(SchemaValueType.Boolean))\n-                            schemaWrapper.setBooleanValues(attribute.getValues());\n-                        else\n-                            schemaWrapper.setValues(attribute.getValues());\n-\n-                        schemaWrappers.add(schemaWrapper);\n-                        found = true;\n-                    }\n-                }\n-                if (!found) {\n+    SchemaTOs schemas = schemaRestClient.getAllUserSchemas();\n+\n+    boolean found = false;\n+\n+    if (create) {\n+        for (SchemaTO schema : schemas) {\n+            schemaWrapper = new SchemaWrapper(schema);\n+            schemaWrappers.add(schemaWrapper);\n+        }\n+    } else {\n+        for (SchemaTO schema : schemas) {\n+            for (AttributeTO attribute : userTO.getAttributes()) {\n+                if (schema.getName().equals(attribute.getSchema())) {\n                     schemaWrapper = new SchemaWrapper(schema);\n+\n+                    schemaWrapper.setValues(attribute.getValues());\n+\n                     schemaWrappers.add(schemaWrapper);\n-                } else {\n-                    found = false;\n+                    found = true;\n                 }\n             }\n+            if (!found) {\n+                schemaWrapper = new SchemaWrapper(schema);\n+                schemaWrappers.add(schemaWrapper);\n+            } else {\n+                found = false;\n+            }\n         }\n     }\n+}\n \n-    /**\n-     * Initialize the membershipTOs\n-     * @param creation flag: true if a new User is being created, false otherwise\n-     * @param userTO object\n-     */\n-    public void setupMemberships(boolean create, UserTO userTO) {\n+/**\n+ * Initialize the membershipTOs\n+ * @param creation flag: true if a new User is being created, false otherwise\n+ * @param userTO object\n+ */\n+public void setupMemberships(boolean create, UserTO userTO) {\n \n-        membershipTOs = new ArrayList<MembershipTO>();\n+    membershipTOs = new ArrayList<MembershipTO>();\n \n-        if (!create) {\n-            Set<MembershipTO> memberships = userTO.getMemberships();\n+    if (!create) {\n+        Set<MembershipTO> memberships = userTO.getMemberships();\n \n-            for (MembershipTO membership : memberships) {\n-                membershipTOs.add(membership);\n-            }\n+        for (MembershipTO membership : memberships) {\n+            membershipTOs.add(membership);\n         }\n     }\n+}\n \n-    /**\n-     * Initialize the user's attributes\n-     * @param creation flag: true if a new User is being created, false otherwise\n-     * @param userTO object\n-     */\n-    public Set<AttributeTO> getUserAttributesSet() {\n-\n-        Set<AttributeTO> attributes = new HashSet<AttributeTO>();\n+/**\n+ * Initialize the user's attributes\n+ * @param creation flag: true if a new User is being created, false otherwise\n+ * @param userTO object\n+ */\n+public Set<AttributeTO> getUserAttributesSet() {\n \n-        AttributeTO attribute;\n+    Set<AttributeTO> attributes = new HashSet<AttributeTO>();\n \n-        for (SchemaWrapper schemaWrapper : schemaWrappers) {\n+    AttributeTO attribute;\n \n-            attribute = new AttributeTO();\n-            attribute.setSchema(schemaWrapper.getSchemaTO().getName());\n-            attribute.setValues(new HashSet<String>());\n-            attribute.setReadonly(schemaWrapper.getSchemaTO().isReadonly());\n+    for (SchemaWrapper schemaWrapper : schemaWrappers) {\n \n-            for (String value : schemaWrapper.getValues()) {\n-                attribute.getValues().add(value);\n-            }\n+        attribute = new AttributeTO();\n+        attribute.setSchema(schemaWrapper.getSchemaTO().getName());\n+        attribute.setValues(new HashSet<String>());\n+        attribute.setReadonly(schemaWrapper.getSchemaTO().isReadonly());\n \n-            attributes.add(attribute);\n+        for (String value : schemaWrapper.getValues()) {\n+            attribute.getValues().add(value);\n         }\n \n-        return attributes;\n+        attributes.add(attribute);\n     }\n \n-    /**\n-     * Convert a memberships ArrayList in a memberships HashSet list.\n-     * @return Set<MembershipTO> selected for a new user.\n-     */\n-    public Set<MembershipTO> getMembershipsSet() {\n+    return attributes;\n+}\n \n-        HashSet<MembershipTO> memberships = new HashSet<MembershipTO>();\n+/**\n+ * Convert a memberships ArrayList in a memberships HashSet list.\n+ * @return Set<MembershipTO> selected for a new user.\n+ */\n+public Set<MembershipTO> getMembershipsSet() {\n \n-        for (MembershipTO membership : membershipTOs) {\n-            memberships.add(membership);\n-        }\n+    HashSet<MembershipTO> memberships = new HashSet<MembershipTO>();\n \n-        return memberships;\n+    for (MembershipTO membership : membershipTOs) {\n+        memberships.add(membership);\n     }\n \n-    /**\n-     * Covert a resources List<String> to Set<String>.\n-     * @return Set<String>\n-     */\n-    public Set<String> getResourcesSet(Collection<ResourceTO> resourcesList) {\n-        Set<String> resourcesSet = new HashSet<String>();\n-\n-       for (ResourceTO resourceTO : resourcesList) {\n-            resourcesSet.add(resourceTO.getName());\n-        }\n-\n-        return resourcesSet;\n-    }\n+    return memberships;\n+}\n \n-    public List<MembershipTO> getMembershipTOs() {\n-        return membershipTOs;\n-    }\n+/**\n+ * Covert a resources List<String> to Set<String>.\n+ * @return Set<String>\n+ */\n+public Set<String> getResourcesSet(Collection<ResourceTO> resourcesList) {\n+    Set<String> resourcesSet = new HashSet<String>();\n \n-    public void setMembershipTOs(List<MembershipTO> membershipTOs) {\n-        this.membershipTOs = membershipTOs;\n+   for (ResourceTO resourceTO : resourcesList) {\n+        resourcesSet.add(resourceTO.getName());\n     }\n \n-    /**\n-     * Updates the modified user object.\n-     * @param updated userTO\n-     * @return UserMod object\n-     */\n-    public void setupUserMod(UserTO userTO) {\n+    return resourcesSet;\n+}\n \n-        userMod = new UserMod();\n-        userMod.setId(oldUser.getId());\n+public List<MembershipTO> getMembershipTOs() {\n+    return membershipTOs;\n+}\n \n-        //1.Check if the password has been changed and update it\n-        if (!oldUser.getPassword().equals(userTO.getPassword())) {\n-            userMod.setPassword(userTO.getPassword());\n-        }\n+public void setMembershipTOs(List<MembershipTO> membershipTOs) {\n+    this.membershipTOs = membershipTOs;\n+}\n \n-        //2.Update user's schema attributes\n-        for (AttributeTO attributeTO : userTO.getAttributes()) {\n-            searchAndUpdateAttribute(attributeTO);\n-        }\n+/**\n+ * Updates the modified user object.\n+ * @param updated userTO\n+ * @return\n+ */\n+public void setupUserMod(UserTO userTO) {\n \n-        //3.Update user's resources\n-        for (String resource : userTO.getResources()) {\n-            searchAndAddResource(resource);\n-        }\n+    //1.Check if the password has been changed and update it\n+    if (!oldUser.getPassword().equals(userTO.getPassword())) {\n+        userMod = new UserMod();\n+        userMod.setPassword(userTO.getPassword());\n+    }\n \n+    //2.Update user's schema attributes\n+    for (AttributeTO attributeTO : userTO.getAttributes()) {\n+        searchAndUpdateAttribute(attributeTO);\n+    }\n \n-        for (String resource : oldUser.getResources()) {\n-            searchAndDropResource(resource, userTO);\n-        }\n+    //3.Update user's resources\n+    for (String resource : userTO.getResources()) {\n+        searchAndAddResource(resource);\n+    }\n \n-        //4.Update user's memberships\n-        for (MembershipTO membership : userTO.getMemberships()) {\n-            searchAndUpdateMembership(membership);\n-        }\n \n-        for (MembershipTO membership : oldUser.getMemberships()) {\n-            searchAndDropMembership(membership, userTO);\n-        }\n+    for (String resource : oldUser.getResources()) {\n+        searchAndDropResource(resource, userTO);\n+    }\n \n+    //4.Update user's memberships\n+    for (MembershipTO membership : userTO.getMemberships()) {\n+        searchAndUpdateMembership(membership);\n     }\n \n-    public void searchAndUpdateAttribute(AttributeTO attributeTO) {\n-        boolean found = false;\n-        boolean changed = false;\n+    for (MembershipTO membership : oldUser.getMemberships()) {\n+        searchAndDropMembership(membership, userTO);\n+    }\n \n-        AttributeMod attributeMod = new AttributeMod();\n-        attributeMod.setSchema(attributeTO.getSchema());\n+    if(userMod != null)\n+        userMod.setId(oldUser.getId());\n+}\n \n-        for (AttributeTO oldAttribute : oldUser.getAttributes()) {\n-            if (attributeTO.getSchema().equals(oldAttribute.getSchema())) {\n+public void searchAndUpdateAttribute(AttributeTO attributeTO) {\n+    boolean found = false;\n+    boolean changed = false;\n \n-                if (!attributeTO.equals(oldAttribute) && !oldAttribute.isReadonly()) {\n+    AttributeMod attributeMod = new AttributeMod();\n+    attributeMod.setSchema(attributeTO.getSchema());\n \n-                    if (attributeTO.getValues().size() > 1)\n-                        attributeMod.setValuesToBeAdded(attributeTO.getValues());\n-                    else\n-                        attributeMod.addValueToBeAdded(attributeTO.getValues().iterator().next());\n+    for (AttributeTO oldAttribute : oldUser.getAttributes()) {\n+        if (attributeTO.getSchema().equals(oldAttribute.getSchema())) {\n \n-                    userMod.addAttributeToBeRemoved(oldAttribute.getSchema());\n-                    userMod.addAttributeToBeUpdated(attributeMod);\n+            if (!attributeTO.equals(oldAttribute) && !oldAttribute\n+                    .isReadonly()) {\n \n-                    changed = true;\n-                    break;\n-                }\n-                    found = true;\n-            }\n-        }\n+                if (attributeTO.getValues().size() > 1)\n+                    attributeMod.setValuesToBeAdded(attributeTO.getValues());\n+                else\n+                    attributeMod.addValueToBeAdded(attributeTO.getValues()\n+                            .iterator().next());\n \n-        if (!found & !changed && !attributeTO.isReadonly() && attributeTO.getValues() != null) {\n+                if(userMod == null)\n+                    userMod = new UserMod();\n \n-            if(attributeTO.getValues().iterator().next() != null ){\n-                attributeMod.setValuesToBeAdded(attributeTO.getValues());\n+                userMod.addAttributeToBeRemoved(oldAttribute.getSchema());\n                 userMod.addAttributeToBeUpdated(attributeMod);\n+\n+                changed = true;\n+                break;\n             }\n-            else attributeMod = null;\n+                found = true;\n         }\n     }\n \n-    /**\n-     * Search for a resource and add that one to the UserMod object if\n-     * it doesn't exist.\n-     * @param resource, new resource added\n-     */\n-    public void searchAndAddResource(String resource) {\n-        boolean found = false;\n+    if (!found & !changed && !attributeTO.isReadonly() && attributeTO.getValues() != null) {\n \n-        //Check if the current resource was existent before the update\n-        for (String oldResource : oldUser.getResources()) {\n-            if (resource.equals(oldResource)) {\n-                found = true;\n-            }\n-        }\n+        if(attributeTO.getValues().iterator().next() != null ){\n+            attributeMod.setValuesToBeAdded(attributeTO.getValues());\n \n-        if (!found) {\n-            userMod.addResourceToBeAdded(resource);\n+        if(userMod == null)\n+            userMod = new UserMod();\n+\n+            userMod.addAttributeToBeUpdated(attributeMod);\n         }\n+        else attributeMod = null;\n     }\n+}\n \n-    /**\n-     * Search for a resource and drop that one from the UserMod object if\n-     * it doesn't exist anymore.\n-     * @param resource\n-     * @param userTO\n-     */\n-    public void searchAndDropResource(String resource, UserTO userTO) {\n-        boolean found = false;\n+/**\n+ * Search for a resource and add that one to the UserMod object if\n+ * it doesn't exist.\n+ * @param resource, new resource added\n+ */\n+public void searchAndAddResource(String resource) {\n+    boolean found = false;\n \n-        //Check if the current resource was existent before the update\n-        for (String newResource : userTO.getResources()) {\n-            if (resource.equals(newResource)) {\n-                found = true;\n-            }\n+    /*Check if the current resource was existent before the update and in this case\n+      just ignore it\n+     */\n+    for (String oldResource : oldUser.getResources()) {\n+        if (resource.equals(oldResource)) {\n+            found = true;\n         }\n+    }\n \n-        if (!found) {\n-            userMod.addResourceToBeRemoved(resource);\n-        }\n+    if (!found) {\n+        if(userMod == null)\n+          userMod = new UserMod();\n+\n+          userMod.addResourceToBeAdded(resource);\n     }\n+}\n+\n+/**\n+ * Search for a resource and drop that one from the UserMod object if\n+ * it doesn't exist anymore.\n+ * @param resource\n+ * @param userTO\n+ */\n+public void searchAndDropResource(String resource, UserTO userTO) {\n+    boolean found = false;\n \n-    /**\n-     * Update the Membership.\n-     * @param new membershipTO\n+    /*Check if the current resource was existent before the update and in this case\n+      just ignore it\n      */\n-    public void searchAndUpdateMembership(MembershipTO newMembership) {\n-        boolean found = false;\n+    for (String newResource : userTO.getResources()) {\n+        if (resource.equals(newResource)) {\n+            found = true;\n+        }\n+    }\n+\n+    if (!found) {\n+       if(userMod == null)\n+           userMod = new UserMod();\n+        userMod.addResourceToBeRemoved(resource);\n+    }\n+}\n \n-        MembershipMod membershipMod = new MembershipMod();\n-        membershipMod.setRole(newMembership.getRoleId());\n+/**\n+ * Update the Membership.\n+ * @param new membershipTO\n+ */\n+public void searchAndUpdateMembership(MembershipTO newMembership) {\n+    boolean found = false;\n \n-        AttributeMod attributeMod;\n+    MembershipMod membershipMod = new MembershipMod();\n+    membershipMod.setRole(newMembership.getRoleId());\n \n-        //1. If the membership exists (and it's changed) update it\n-        for (MembershipTO oldMembership : oldUser.getMemberships()) {\n-            if (newMembership.getRoleId() == oldMembership.getRoleId()) {\n+    AttributeMod attributeMod;\n \n-                for (AttributeTO oldAttribute : oldMembership.getAttributes()) {\n-                    for (AttributeTO newAttribute : newMembership.getAttributes()) {\n+    //1. If the membership exists update it\n+    for (MembershipTO oldMembership : oldUser.getMemberships()) {\n+        if (newMembership.getRoleId() == oldMembership.getRoleId()) {\n \n-                        if(oldAttribute.getSchema().equals(newAttribute.getSchema())) {\n+            for (AttributeTO oldAttribute : oldMembership.getAttributes()) {\n+                for (AttributeTO newAttribute : newMembership.getAttributes()) {\n \n-                            attributeMod = new AttributeMod();\n-                            attributeMod.setSchema(newAttribute.getSchema());\n+                    if(oldAttribute.getSchema().equals(newAttribute.getSchema())) {\n \n-                            attributeMod.setValuesToBeAdded(newAttribute.getValues());\n+                        attributeMod = new AttributeMod();\n+                        attributeMod.setSchema(newAttribute.getSchema());\n \n-                            membershipMod.addAttributeToBeUpdated(attributeMod);\n-                            //membershipMod.addAttributeToBeRemoved(oldAttribute.getSchema());\n-                            break;\n-                        }\n+                        attributeMod.setValuesToBeAdded(newAttribute.getValues());\n \n+                        membershipMod.addAttributeToBeUpdated(attributeMod);\n+                        //membershipMod.addAttributeToBeRemoved(oldAttribute.getSchema());\n+                        break;\n                     }\n+\n                 }\n-                //TO BE FIXED CORE-SIDE\n-                userMod.addMembershipToBeRemoved(oldMembership.getId());\n-                userMod.addMembershipToBeAdded(membershipMod);\n-                \n-                found = true;\n-                break;\n             }\n-        }\n-\n-        //2.Otherwise, if it doesn't exist, create it from scratch\n-        if (!found) {\n-            Set<AttributeMod> attributes = new HashSet<AttributeMod>();\n-            \n-            for (AttributeTO newAttribute : newMembership.getAttributes()) {\n-                attributeMod = new AttributeMod();\n-                attributeMod.setSchema(newAttribute.getSchema());\n-                attributeMod.setValuesToBeAdded(newAttribute.getValues());\n \n-                attributes.add(attributeMod);\n-            }\n+            if(userMod == null)\n+                userMod = new UserMod();\n \n-            membershipMod.setAttributesToBeUpdated(attributes);\n+            userMod.addMembershipToBeRemoved(oldMembership.getId());\n             userMod.addMembershipToBeAdded(membershipMod);\n+\n+            found = true;\n+            break;\n         }\n     }\n \n-    /**\n-     * Drop membership not present anymore.\n-     * @param membershipTO\n-     * @param userTO\n-     */\n-    public void searchAndDropMembership(MembershipTO oldMembership, UserTO userTO) {\n-        boolean found = false;\n+    //2.Otherwise, if it doesn't exist, create it from scratch\n+    if (!found) {\n+        Set<AttributeMod> attributes = new HashSet<AttributeMod>();\n \n-        //Check if the current resource was existent before the update\n-        for (MembershipTO newMembership : userTO.getMemberships()) {\n-            if (newMembership.getId() == oldMembership.getId()) {\n-                found = true;\n-            }\n-        }\n+        for (AttributeTO newAttribute : newMembership.getAttributes()) {\n+            attributeMod = new AttributeMod();\n+            attributeMod.setSchema(newAttribute.getSchema());\n+            attributeMod.setValuesToBeAdded(newAttribute.getValues());\n \n-        if (!found) {\n-            userMod.addMembershipToBeRemoved(oldMembership.getId());\n+            attributes.add(attributeMod);\n         }\n-    }\n \n-    /**\n-     * Wrapper for User's Schema - Attribute.\n-     */\n-    public class SchemaWrapper {\n+        membershipMod.setAttributesToBeUpdated(attributes);\n \n-        SchemaTO schemaTO;\n-        List<String> values;\n+        if(userMod == null)\n+           userMod = new UserMod();\n \n-        public SchemaWrapper(SchemaTO schemaTO) {\n-            this.schemaTO = schemaTO;\n-            values = new ArrayList<String>();\n+        userMod.addMembershipToBeAdded(membershipMod);\n+    }\n+}\n \n-            if (schemaTO.getType().getClassName().equals(\"java.lang.Boolean\")) {\n-                values.add(\"\");//false\n-            } else {\n-                values.add(\"\");\n-            }\n-        }\n+/**\n+ * Drop membership not present anymore.\n+ * @param membershipTO\n+ * @param userTO\n+ */\n+public void searchAndDropMembership(MembershipTO oldMembership,\n+        UserTO userTO) {\n+    boolean found = false;\n \n-        public SchemaTO getSchemaTO() {\n-            return schemaTO;\n+    /*Check if the current resource was existent before the update and\n+     in this case just ignore it*/\n+    for (MembershipTO newMembership : userTO.getMemberships()) {\n+        if (newMembership.getId() == oldMembership.getId()) {\n+            found = true;\n         }\n+    }\n \n-        public void setSchemaTO(SchemaTO schemaTO) {\n-            this.schemaTO = schemaTO;\n-        }\n+    if (!found) {\n+        if(userMod == null)\n+           userMod = new UserMod();\n \n-        public List<String> getValues() {\n-            return values;\n-        }\n+        userMod.addMembershipToBeRemoved(oldMembership.getId());\n+    }\n+}\n \n-        public void setValues(List<String> values) {\n-            this.values = values;\n-        }\n+/**\n+ * Wrapper for User's Schema - Attribute.\n+ */\n+public class SchemaWrapper {\n \n-        public void setBooleanValues(Set<String> values) {\n-            this.values = new ArrayList<String>();\n+    SchemaTO schemaTO;\n+    List<String> values;\n \n-            for (String value : values) {\n-                if(\"T\".equals(value))\n-                    this.values.add(\"true\");\n-                else\n-                    this.values.add(\"\");\n-            }\n+    public SchemaWrapper(SchemaTO schemaTO) {\n+        this.schemaTO = schemaTO;\n+        values = new ArrayList<String>();\n \n-        }\n+        values.add(\"\");\n+    }\n \n-        public void setValues(Set<String> values) {\n-            this.values = new ArrayList<String>();\n-            for (String value : values) {\n-                this.values.add(value);\n-            }\n+    public SchemaTO getSchemaTO() {\n+        return schemaTO;\n+    }\n+\n+    public void setSchemaTO(SchemaTO schemaTO) {\n+        this.schemaTO = schemaTO;\n+    }\n+\n+    public List<String> getValues() {\n+        return values;\n+    }\n+\n+    public void setValues(List<String> values) {\n+        this.values = values;\n+    }\n+\n+    public void setValues(Set<String> values) {\n+        this.values = new ArrayList<String>();\n+        for (String value : values) {\n+            this.values.add(value);\n         }\n     }\n }\n+}\n\\ No newline at end of file"},{"sha":"5ddd7417a61dde81579e4cb356350e9b4dbcdc89","filename":"console/src/main/java/org/syncope/console/pages/Users.java","status":"modified","additions":496,"deletions":46,"changes":542,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/fc3c6f846672cae1f006e92d986aada7b370a8d2/console%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fconsole%2Fpages%2FUsers.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/fc3c6f846672cae1f006e92d986aada7b370a8d2/console%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fconsole%2Fpages%2FUsers.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/console%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fconsole%2Fpages%2FUsers.java?ref=fc3c6f846672cae1f006e92d986aada7b370a8d2","patch":"@@ -16,31 +16,48 @@\n \n import java.util.ArrayList;\n \n+import java.util.Arrays;\n import java.util.Collections;\n import java.util.List;\n import java.util.Set;\n import java.util.StringTokenizer;\n import org.apache.wicket.Page;\n import org.apache.wicket.PageParameters;\n import org.apache.wicket.ajax.AjaxRequestTarget;\n+import org.apache.wicket.ajax.form.AjaxFormComponentUpdatingBehavior;\n import org.apache.wicket.ajax.markup.html.AjaxLink;\n+import org.apache.wicket.ajax.markup.html.form.AjaxButton;\n import org.apache.wicket.extensions.ajax.markup.html.modal.ModalWindow;\n import org.apache.wicket.markup.html.WebMarkupContainer;\n import org.apache.wicket.markup.html.basic.Label;\n+import org.apache.wicket.markup.html.form.Form;\n import org.apache.wicket.markup.html.list.ListItem;\n import org.apache.wicket.markup.html.list.ListView;\n import org.apache.wicket.markup.html.panel.FeedbackPanel;\n import org.apache.wicket.model.IModel;\n import org.apache.wicket.model.LoadableDetachableModel;\n+import org.apache.wicket.model.Model;\n+import org.apache.wicket.model.PropertyModel;\n import org.apache.wicket.spring.injection.annot.SpringBean;\n+import org.syncope.client.search.AttributeCond;\n+import org.syncope.client.search.MembershipCond;\n+import org.syncope.client.search.NodeCond;\n import org.syncope.client.to.AttributeTO;\n import org.syncope.client.to.ConfigurationTO;\n+import org.syncope.client.to.RoleTO;\n+import org.syncope.client.to.RoleTOs;\n import org.syncope.client.to.UserTO;\n import org.syncope.console.commons.Constants;\n+import org.syncope.client.to.UserTOs;\n import org.syncope.console.commons.SearchConditionWrapper;\n+import org.syncope.console.commons.SearchConditionWrapper.OperationType;\n import org.syncope.console.rest.SchemaRestClient;\n import org.syncope.console.rest.ConfigurationsRestClient;\n+import org.syncope.console.rest.RolesRestClient;\n import org.syncope.console.rest.UsersRestClient;\n+import org.syncope.console.wicket.markup.html.form.UpdatingCheckBox;\n+import org.syncope.console.wicket.markup.html.form.UpdatingDropDownChoice;\n+import org.syncope.console.wicket.markup.html.form.UpdatingTextField;\n \n /**\n  * Users WebPage.\n@@ -49,36 +66,41 @@ public class Users extends BasePage {\n \n     @SpringBean(name = \"usersRestClient\")\n     private UsersRestClient usersRestClient;\n+\n     @SpringBean(name = \"schemaRestClient\")\n     private SchemaRestClient schemaRestClient;\n+\n+    @SpringBean(name = \"rolesRestClient\")\n+    private RolesRestClient rolesRestClient;\n+\n     @SpringBean(name = \"configurationsRestClient\")\n     private ConfigurationsRestClient configurationsRestClient;\n-    private final ModalWindow createUserWin;\n-    private final ModalWindow editUserWin;\n-    private final ModalWindow changeAttribsViewWin;\n-    private static final int WIN_ATTRIBUTES_HEIGHT = 515;\n-    private static final int WIN_ATTRIBUTES_WIDTH = 775;\n-    private static final int WIN_USER_HEIGHT = 680;\n-    private static final int WIN_USER_WIDTH = 1133;\n-    private WebMarkupContainer usersContainer;\n-    private List<String> columnsList;\n-    /** \n-     * Response flag set by the Modal Window after the operation is completed\n-     */\n-    private boolean operationResult = false;\n-    private FeedbackPanel feedbackPanel;\n-    private final ModalWindow searchUsersWin;\n-    private List<SearchConditionWrapper> searchConditionsList;\n+\n+    final ModalWindow createUserWin;\n+    final ModalWindow editUserWin;\n+    final ModalWindow changeAttribsViewWin;\n+    final int WIN_ATTRIBUTES_HEIGHT = 515;\n+    final int WIN_ATTRIBUTES_WIDTH = 775;\n+    final int WIN_USER_HEIGHT = 680;\n+    final int WIN_USER_WIDTH = 1133;\n+    WebMarkupContainer usersContainer;\n+    List<String> columnsList;\n+    /** Response flag set by the Modal Window after the operation is completed*/\n+    boolean operationResult = false;\n+    FeedbackPanel feedbackPanel;\n+    List<SearchConditionWrapper> searchConditionsList;\n+    UserTOs searchMatchedUsers;\n \n     public Users(PageParameters parameters) {\n         super(parameters);\n \n-        setupSearchConditions();\n+        setupSearchConditionsList();\n+\n+        searchMatchedUsers = new UserTOs();\n \n         add(createUserWin = new ModalWindow(\"createUserWin\"));\n         add(editUserWin = new ModalWindow(\"editUserWin\"));\n         add(changeAttribsViewWin = new ModalWindow(\"changeAttributesViewWin\"));\n-        add(searchUsersWin = new ModalWindow(\"searchUsersWin\"));\n \n         feedbackPanel = new FeedbackPanel(\"feedback\");\n         feedbackPanel.setOutputMarkupId(true);\n@@ -142,8 +164,7 @@ protected void populateItem(final ListItem item) {\n                 item.add(new Label(\"status\", userTO.getStatus()));\n \n                 if (userTO.getToken() != null\n-                        && !\"\".equals(userTO.getToken())) {\n-\n+                        && !userTO.getToken().equals(\"\")) {\n                     item.add(new Label(\"token\", getString(\"tokenValued\")));\n                 } else {\n                     item.add(new Label(\"token\", getString(\"tokenNotValued\")));\n@@ -157,6 +178,15 @@ protected void populateItem(ListItem item) {\n                         AttributeWrapper attribute =\n                                 (AttributeWrapper) item.getDefaultModelObject();\n \n+/*\n+                        for (String name : columnsList) {\n+\n+                            if (name.equalsIgnoreCase(attribute.getKey())) {\n+                                item.add(new Label(\"name\", attribute.getValue()));\n+                            } else if (!name.equalsIgnoreCase(attribute.getKey())) {\n+                            }\n+\n+*/\n                         for (String name : columnsList) {\n                             if (name.equalsIgnoreCase(attribute.getKey())) {\n                                 item.add(new Label(\"name\",\n@@ -177,12 +207,12 @@ public void onClick(AjaxRequestTarget target) {\n                         editUserWin.setPageCreator(\n                                 new ModalWindow.PageCreator() {\n \n-                                    public Page createPage() {\n-                                        UserModalPage form = new UserModalPage(\n-                                                Users.this, editUserWin, userTO, false);\n-                                        return form;\n-                                    }\n-                                });\n+                            public Page createPage() {\n+                                UserModalPage window = new UserModalPage(\n+                                        Users.this, editUserWin, userTO, false);\n+                                return window;\n+                            }\n+                        });\n \n                         editUserWin.show(target);\n                     }\n@@ -232,12 +262,6 @@ public void onClick(AjaxRequestTarget target) {\n         changeAttribsViewWin.setPageMapName(\"change-attribs-modal\");\n         changeAttribsViewWin.setCookieName(\"change-attribs-modal\");\n \n-        searchUsersWin.setCssClassName(ModalWindow.CSS_CLASS_GRAY);\n-        searchUsersWin.setInitialHeight(WIN_USER_HEIGHT);\n-        searchUsersWin.setInitialWidth(WIN_USER_HEIGHT);\n-        searchUsersWin.setPageMapName(\"search-users-modal\");\n-        searchUsersWin.setCookieName(\"search-users-modal\");\n-\n         setWindowClosedCallback(createUserWin, usersContainer);\n         setWindowClosedCallback(editUserWin, usersContainer);\n \n@@ -254,9 +278,9 @@ public void onClick(AjaxRequestTarget target) {\n                 createUserWin.setPageCreator(new ModalWindow.PageCreator() {\n \n                     public Page createPage() {\n-                        UserModalPage form = new UserModalPage(Users.this,\n+                        UserModalPage window = new UserModalPage(Users.this,\n                                 createUserWin, new UserTO(), true);\n-                        return form;\n+                        return window;\n                     }\n                 });\n \n@@ -272,21 +296,330 @@ public void onClick(AjaxRequestTarget target) {\n                 changeAttribsViewWin.setPageCreator(\n                         new ModalWindow.PageCreator() {\n \n-                            public Page createPage() {\n-                                DisplayAttributesModalPage form =\n-                                        new DisplayAttributesModalPage(Users.this,\n-                                        changeAttribsViewWin, true);\n-                                return form;\n-                            }\n-                        });\n+                    public Page createPage() {\n+                        DisplayAttributesModalPage window =\n+                                new DisplayAttributesModalPage(Users.this,\n+                                changeAttribsViewWin, true);\n+                        return window;\n+                    }\n+                });\n \n                 changeAttribsViewWin.show(target);\n             }\n         });\n \n         //TAB 2 - Search section start\n-       /* PLACE SEARCH CODE HERE */\n+        \n+        final IModel userAttributes = new LoadableDetachableModel() {\n+\n+            protected Object load() {\n+                return schemaRestClient.getAllUserSchemasNames();\n+            }\n+        };\n+\n+        final IModel roleNames = new LoadableDetachableModel() {\n+\n+            protected Object load() {\n+                RoleTOs roleTOs = rolesRestClient.getAllRoles();\n+\n+                List<String> roleNames = new ArrayList<String>();\n+\n+                for (RoleTO role : roleTOs)\n+                    roleNames.add(role.getName());\n+\n+                return roleNames;\n+            }\n+        };\n+\n+        final IModel attributeTypes = new LoadableDetachableModel() {\n+\n+            protected Object load() {\n+                return Arrays.asList(AttributeCond.Type.values());\n+            }\n+        };\n+\n+        final IModel filterTypes = new LoadableDetachableModel() {\n+\n+            protected Object load() {\n+                return Arrays.asList(SearchConditionWrapper.FilterType\n+                        .values());\n+            }\n+        };\n+\n+        Form form = new Form(\"UserSearchForm\");\n+\n+        form.add(new FeedbackPanel(\"feedback\").setOutputMarkupId(true));\n+\n+        final WebMarkupContainer container;\n+\n+        container = new WebMarkupContainer(\"container\");\n+        container.setOutputMarkupId(true);\n+\n+        ListView searchView = new ListView(\"searchView\", searchConditionsList) {\n+\n+            @Override\n+            protected void populateItem(final ListItem item) {\n+                final SearchConditionWrapper searchCondition =\n+                        (SearchConditionWrapper) item.getDefaultModelObject();\n+\n+                if (item.getIndex() == 0) \n+                    item.add(new Label(\"operationType\", \"\"));\n+                else \n+                    item.add(new Label(\"operationType\", searchCondition\n+                            .getOperationType().toString()));\n+\n+                item.add(new UpdatingCheckBox(\"notOperator\",\n+                        new PropertyModel(searchCondition,\n+                        \"notOperator\")));\n+\n+                final UpdatingDropDownChoice filterNameChooser =\n+                       new UpdatingDropDownChoice(\"filterName\",\n+                       new PropertyModel(searchCondition, \"filterName\"),\n+                       null);\n+                \n+                if(searchCondition.getFilterType() == null)\n+                    filterNameChooser.setChoices(Collections.emptyList());\n+                else if(searchCondition.getFilterType() ==\n+                        SearchConditionWrapper.FilterType.ATTRIBUTE)\n+                            filterNameChooser.setChoices(userAttributes);\n+                else\n+                    filterNameChooser.setChoices(roleNames);\n+\n+                filterNameChooser.setRequired(true);\n+\n+                item.add(filterNameChooser);\n+\n+                final UpdatingDropDownChoice type = new UpdatingDropDownChoice(\n+                        \"type\", new PropertyModel(searchCondition, \"type\"),\n+                        attributeTypes);\n+\n+                item.add(type);\n+                \n+                final UpdatingTextField filterValue = new UpdatingTextField(\n+                        \"filterValue\", new PropertyModel(searchCondition,\n+                        \"filterValue\"));\n+\n+                item.add(filterValue);\n+\n+                if(searchCondition.getFilterType() ==\n+                        SearchConditionWrapper.FilterType.MEMBERSHIP) {\n+\n+                    type.setEnabled(false);\n+                    type.setRequired(false);\n+                    type.setModelObject(null);\n+\n+                    filterValue.setEnabled(false);\n+                    //filterValue.setRequired(false);\n+                    filterValue.setModelObject(\"\");\n+\n+                } else {\n+\n+                    if (!type.isEnabled()) {\n+                        type.setEnabled(true);\n+                        type.setRequired(true);\n+                    }\n+\n+                    if (!filterValue.isEnabled()) {\n+                        filterValue.setEnabled(true);\n+                    }\n+\n+                }\n+\n+                UpdatingDropDownChoice filterTypeChooser =\n+                        new UpdatingDropDownChoice(\"filterType\",\n+                        new PropertyModel(searchCondition, \"filterType\"),\n+                        filterTypes);\n+\n+                filterTypeChooser.add(new AjaxFormComponentUpdatingBehavior(\n+                        \"onchange\") {\n+\n+                protected void onUpdate(AjaxRequestTarget target) {\n+                    filterNameChooser.setChoices(new LoadableDetachableModel() {\n+\n+                        @Override\n+                        protected Object load() {\n+                            SearchConditionWrapper.FilterType schemaType =\n+                                    searchCondition.getFilterType();\n+\n+                            if (schemaType ==  SearchConditionWrapper.\n+                                    FilterType.ATTRIBUTE) {\n+\n+                                return userAttributes;\n+                            } else {\n+\n+                                return roleNames;\n+                            }\n+\n+                        }\n+                    });\n+                    target.addComponent(filterNameChooser);\n+                    target.addComponent(container);\n+                }});\n+\n+                filterTypeChooser.setRequired(true);\n+\n+                item.add(filterTypeChooser);\n+\n+                AjaxButton dropButton = new AjaxButton(\"dropButton\",\n+                        new Model(getString(\"dropButton\"))) {\n+\n+                    @Override\n+                    protected void onSubmit(AjaxRequestTarget target,\n+                            Form form) {\n+                        final int parentId = new Integer(getParent().getId());\n+                        searchConditionsList.remove(parentId);\n+                        target.addComponent(container);\n+                    }\n+                };\n+\n+                dropButton.setDefaultFormProcessing(false);\n+\n+                if (item.getIndex() == 0) {\n+                    dropButton.setVisible(false);\n+                }\n+\n+                item.add(dropButton);\n+            }\n+        };\n+\n+        container.add(searchView);\n+\n+        AjaxButton addAndButton = new AjaxButton(\"addAndButton\", new Model(\n+                getString(\"addAndButton\"))) {\n+\n+            @Override\n+            protected void onSubmit(AjaxRequestTarget target, Form form) {\n+                SearchConditionWrapper conditionWrapper =\n+                        new SearchConditionWrapper();\n+                conditionWrapper.setOperationType(OperationType.AND);\n+                searchConditionsList.add(conditionWrapper);\n+                target.addComponent(container);\n+            }\n+        };\n+\n+        addAndButton.setDefaultFormProcessing(false);\n+        container.add(addAndButton);\n+\n+        AjaxButton addOrButton = new AjaxButton(\"addOrButton\", new Model(\n+                getString(\"addOrButton\"))) {\n+\n+            @Override\n+            protected void onSubmit(AjaxRequestTarget target, Form form) {\n+                SearchConditionWrapper conditionWrapper =\n+                        new SearchConditionWrapper();\n+                conditionWrapper.setOperationType(OperationType.OR);\n+                searchConditionsList.add(conditionWrapper);\n+                target.addComponent(container);\n+            }\n+        };\n \n+        addOrButton.setDefaultFormProcessing(false);\n+        container.add(addOrButton);\n+\n+        form.add(container);\n+\n+        IModel resultsModel = new LoadableDetachableModel() {\n+\n+            @Override\n+            protected Object load() {\n+                return searchMatchedUsers.getUsers();\n+            }\n+        };\n+\n+        final ListView resultsView = new ListView(\"results\", resultsModel) {\n+\n+            @Override\n+            protected void populateItem(final ListItem item) {\n+\n+                UserTO userTO = (UserTO) item.getModelObject();\n+\n+                item.add(new Label(\"id\", String.valueOf(userTO.getId())));\n+\n+                item.add(new Label(\"status\", String.valueOf(\n+                        userTO.getStatus())));\n+\n+                if (userTO.getToken() != null && !userTO.getToken().equals(\"\")) {\n+                    item.add(new Label(\"token\", getString(\"tokenValued\")));\n+                } else {\n+                    item.add(new Label(\"token\", getString(\"tokenNotValued\")));\n+                }\n+\n+                AjaxButton editButton = new AjaxButton(\"editLink\",\n+                        new Model(getString(\"edit\"))) {\n+\n+                    @Override\n+                    protected void onSubmit(AjaxRequestTarget target, Form form) {\n+                        final UserTO userTO =\n+                                (UserTO) item.getDefaultModelObject();\n+\n+                        editUserWin.setPageCreator(new ModalWindow.PageCreator() {\n+\n+                            public Page createPage() {\n+                                UserModalPage window = new UserModalPage(\n+                                        Users.this, editUserWin, userTO, false);\n+                                return window;\n+                            }\n+                        });\n+\n+                        editUserWin.show(target);\n+                    }\n+                };\n+\n+                item.add(editButton);\n+\n+                item.add(new AjaxButton(\"deleteLink\", new Model(\n+                        getString(\"delete\"))) {\n+\n+                    @Override\n+                    protected void onSubmit(AjaxRequestTarget target, Form form) {\n+                    }\n+                });\n+            }\n+        };\n+\n+        final WebMarkupContainer searchResultsContainer =\n+                new WebMarkupContainer(\"searchResultsContainer\");\n+        searchResultsContainer.setOutputMarkupId(true);\n+        searchResultsContainer.add(resultsView);\n+\n+        setWindowClosedCallback(editUserWin, searchResultsContainer);\n+\n+        form.add(new AjaxButton(\"search\", new Model(getString(\"search\"))) {\n+\n+            @Override\n+            protected void onSubmit(AjaxRequestTarget target, Form form) {\n+\n+                NodeCond nodeCond =\n+                        buildSearchExpression(searchConditionsList);\n+\n+                if (nodeCond != null) {\n+\n+                    try {\n+                        searchMatchedUsers =\n+                                usersRestClient.searchUsers(nodeCond);\n+\n+                        //Clean the feedback panel if the operation succedes\n+                        target.addComponent(form.get(\"feedback\"));\n+                    } catch (Exception e) {\n+                        error(e.getMessage());\n+                        return;\n+                    }\n+                } else {\n+                    error(getString(\"search_error\"));\n+                }\n+\n+                target.addComponent(searchResultsContainer);\n+            }\n+\n+            @Override\n+            protected void onError(AjaxRequestTarget target, Form form) {\n+                target.addComponent(form.get(\"feedback\"));\n+            }\n+        });\n+        \n+        form.add(searchResultsContainer);\n+\n+        add(form);\n     }\n \n     /**\n@@ -305,7 +638,8 @@ public List<AttributeWrapper> attributesToDisplay(UserTO user) {\n \n         columnsList = new ArrayList<String>();\n \n-        if (configuration != null && !configuration.getConfValue().equals(\"\")) {\n+        if (configuration != null && configuration.getConfValue() != null &&\n+                !configuration.getConfValue().equals(\"\")) {\n             String conf = configuration.getConfValue();\n             StringTokenizer st = new StringTokenizer(conf, \";\");\n \n@@ -343,8 +677,6 @@ public List<AttributeWrapper> attributesToDisplay(UserTO user) {\n             }\n         }\n \n-\n-\n         return attributesList;\n     }\n \n@@ -365,6 +697,9 @@ public void onClose(AjaxRequestTarget target) {\n                             info(getString(\"operation_succeded\"));\n                             target.addComponent(feedbackPanel);\n                             operationResult = false;\n+                        } //When the window is closed without calling backend\n+                        else {\n+                            target.addComponent(feedbackPanel);\n                         }\n                     }\n                 });\n@@ -381,12 +716,127 @@ public void setOperationResult(boolean operationResult) {\n     /**\n      * Init search conditions list.\n      */\n-    private void setupSearchConditions() {\n+    private void setupSearchConditionsList() {\n         searchConditionsList = new ArrayList<SearchConditionWrapper>();\n \n         searchConditionsList.add(new SearchConditionWrapper());\n     }\n \n+    /**\n+     * Build recursively search users expression from searchConditionsList.\n+     * @return NodeCond\n+     */\n+    public NodeCond buildSearchExpression(\n+            List<SearchConditionWrapper> conditions) {\n+\n+        AttributeCond attributeCond = null;\n+        MembershipCond membershipCond = null;\n+        \n+        List<SearchConditionWrapper> subList = null;\n+\n+        SearchConditionWrapper searchConditionWrapper = conditions.iterator()\n+                .next();\n+\n+        if(searchConditionWrapper.getFilterType() ==\n+                SearchConditionWrapper.FilterType.ATTRIBUTE) {\n+\n+            attributeCond = new AttributeCond();\n+            attributeCond.setSchema(searchConditionWrapper.getFilterName());\n+            attributeCond.setType(searchConditionWrapper.getType());\n+            attributeCond.setExpression(searchConditionWrapper.getFilterValue());\n+\n+        }\n+\n+        else {\n+\n+        membershipCond = new MembershipCond();\n+        membershipCond.setRoleName(searchConditionWrapper.getFilterName());\n+\n+        }\n+\n+        if (conditions.size() == 1) {\n+\n+             if(searchConditionWrapper.getFilterType() ==\n+                SearchConditionWrapper.FilterType.ATTRIBUTE) {\n+                      if (searchConditionWrapper.isNotOperator()) {\n+                    return NodeCond.getNotLeafCond(attributeCond);\n+                } else {\n+                    return NodeCond.getLeafCond(attributeCond);\n+                }\n+             }\n+             else {\n+                   if (searchConditionWrapper.isNotOperator()) {\n+                    return NodeCond.getNotLeafCond(membershipCond);\n+                } else {\n+                    return NodeCond.getLeafCond(membershipCond);\n+                }\n+             }\n+\n+        } else {\n+\n+            subList = conditions.subList(1, conditions.size());\n+\n+            searchConditionWrapper = subList.iterator().next();\n+\n+            if (searchConditionWrapper.getOperationType() ==\n+                    SearchConditionWrapper.OperationType.AND) {\n+\n+                if(searchConditionWrapper.getFilterType() ==\n+                SearchConditionWrapper.FilterType.ATTRIBUTE) {\n+\n+                    if(attributeCond != null)\n+                    return NodeCond.getAndCond(\n+                            NodeCond.getLeafCond(attributeCond),\n+                            buildSearchExpression(\n+                            new ArrayList<SearchConditionWrapper>(subList)));\n+                    else\n+                        return NodeCond.getAndCond(\n+                            NodeCond.getLeafCond(membershipCond),\n+                            buildSearchExpression(\n+                            new ArrayList<SearchConditionWrapper>(subList)));\n+                } else {\n+                   if(attributeCond != null)\n+                    return NodeCond.getAndCond(\n+                        NodeCond.getLeafCond(attributeCond),\n+                        buildSearchExpression(\n+                        new ArrayList<SearchConditionWrapper>(subList)));\n+                   else\n+                       return NodeCond.getAndCond(\n+                        NodeCond.getLeafCond(membershipCond),\n+                        buildSearchExpression(\n+                        new ArrayList<SearchConditionWrapper>(subList)));\n+                }\n+\n+            } else {\n+                if(searchConditionWrapper.getFilterType() ==\n+                SearchConditionWrapper.FilterType.ATTRIBUTE) {\n+                if(attributeCond != null)\n+                return NodeCond.getOrCond(\n+                        NodeCond.getLeafCond(attributeCond),\n+                        buildSearchExpression(\n+                        new ArrayList<SearchConditionWrapper>(subList)));\n+                else\n+                return NodeCond.getOrCond(\n+                        NodeCond.getLeafCond(membershipCond),\n+                        buildSearchExpression(\n+                        new ArrayList<SearchConditionWrapper>(subList)));\n+                }\n+                else {\n+                   if(attributeCond != null)\n+                   return NodeCond.getOrCond(\n+                        NodeCond.getLeafCond(attributeCond),\n+                        buildSearchExpression(\n+                        new ArrayList<SearchConditionWrapper>(subList)));\n+                   else\n+                   return NodeCond.getOrCond(\n+                        NodeCond.getLeafCond(membershipCond),\n+                        buildSearchExpression(\n+                        new ArrayList<SearchConditionWrapper>(subList)));\n+                }\n+            }\n+        }\n+    }\n+\n     /**\n      * Wrapper class for displaying attribute\n      */"},{"sha":"d7bda9b022e972d5596f7d58691b6d946ddd2a7d","filename":"console/src/main/java/org/syncope/console/rest/UsersRestClient.java","status":"modified","additions":24,"deletions":12,"changes":36,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/fc3c6f846672cae1f006e92d986aada7b370a8d2/console%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fconsole%2Frest%2FUsersRestClient.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/fc3c6f846672cae1f006e92d986aada7b370a8d2/console%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fconsole%2Frest%2FUsersRestClient.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/console%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fconsole%2Frest%2FUsersRestClient.java?ref=fc3c6f846672cae1f006e92d986aada7b370a8d2","patch":"@@ -15,10 +15,13 @@\n  */\n package org.syncope.console.rest;\n \n+import org.springframework.web.client.HttpServerErrorException;\n import org.syncope.client.mod.UserMod;\n import org.syncope.client.to.ConfigurationTO;\n+import org.syncope.client.search.NodeCond;\n import org.syncope.client.to.UserTO;\n import org.syncope.client.to.UserTOs;\n+import org.syncope.client.to.WorkflowActionsTO;\n import org.syncope.client.validation.SyncopeClientCompositeErrorException;\n import org.syncope.console.commons.Constants;\n \n@@ -49,14 +52,17 @@ public void createUser(UserTO userTO) {\n \n         try {\n             // 1. create user\n-            userTO = restClient.getRestTemplate().postForObject(\n-                    restClient.getBaseURL()\n-                    + \"user/create\", userTO, UserTO.class);\n+            newUserTO = restClient.getRestTemplate().postForObject(\n+            restClient.getBaseURL() + \"user/create\", userTO, UserTO.class);\n+\n+            userTO.setId(newUserTO.getId());\n+            //userTO.setToken(newUserTO.getToken());\n+            //userTO.setTokenExpireTime(newUserTO.getTokenExpireTime());\n \n             // 2. activate user\n-            userTO = restClient.getRestTemplate().postForObject(\n+            newUserTO = restClient.getRestTemplate().postForObject(\n                     restClient.getBaseURL()\n-                    + \"user/activate\", userTO, UserTO.class);\n+                    + \"user/activate\", newUserTO, UserTO.class);\n \n         } catch (SyncopeClientCompositeErrorException e) {\n             e.printStackTrace();\n@@ -73,9 +79,9 @@ public boolean updateUser(final UserMod userModTO) {\n         UserTO newUserTO = null;\n \n         try {\n+\n             newUserTO = restClient.getRestTemplate().postForObject(\n-                    restClient.getBaseURL()\n-                    + \"user/update\", userModTO, UserTO.class);\n+            restClient.getBaseURL() + \"user/update\", userModTO, UserTO.class);\n         } catch (SyncopeClientCompositeErrorException e) {\n             e.printStackTrace();\n             throw e;\n@@ -87,7 +93,7 @@ public boolean updateUser(final UserMod userModTO) {\n     public void deleteUser(String id) {\n         try {\n             restClient.getRestTemplate().delete(restClient.getBaseURL()\n-                    + \"user/delete/{userId}\", new Integer(id));\n+            + \"user/delete/{userId}\", new Integer(id));\n         } catch (SyncopeClientCompositeErrorException e) {\n             e.printStackTrace();\n         }\n@@ -164,11 +170,17 @@ public ConfigurationTO readConfigurationDisplayAttributes() {\n      * @param userTO\n      * @return UserTOs\n      */\n-    public UserTOs searchUsers(UserTO userTO) {\n+    public UserTOs searchUsers(NodeCond nodeSearchCondition) {\n+        UserTOs matchedUsers = null;\n \n-        UserTOs matchedUsers = restClient.getRestTemplate().postForObject(\n-                restClient.getBaseURL() + \"user/search\",\n-                null, UserTOs.class);\n+        try {\n+            matchedUsers = restClient.getRestTemplate().postForObject(\n+                    restClient.getBaseURL() + \"user/search\",\n+                    nodeSearchCondition, UserTOs.class);\n+        } catch (HttpServerErrorException e) {\n+            e.printStackTrace();\n+            throw e;\n+        }\n \n         return matchedUsers;\n     }"},{"sha":"d59f206b5dd7d7646e4bcdebfbf24d4156e30ad0","filename":"console/src/main/resources/org/syncope/console/SyncopeApplication.properties","status":"modified","additions":1,"deletions":0,"changes":1,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/fc3c6f846672cae1f006e92d986aada7b370a8d2/console%2Fsrc%2Fmain%2Fresources%2Forg%2Fsyncope%2Fconsole%2FSyncopeApplication.properties","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/fc3c6f846672cae1f006e92d986aada7b370a8d2/console%2Fsrc%2Fmain%2Fresources%2Forg%2Fsyncope%2Fconsole%2FSyncopeApplication.properties","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/console%2Fsrc%2Fmain%2Fresources%2Forg%2Fsyncope%2Fconsole%2FSyncopeApplication.properties?ref=fc3c6f846672cae1f006e92d986aada7b370a8d2","patch":"@@ -7,3 +7,4 @@ connectors=Connectors\n report=Report\n logout=Logout\n schema=Schema\n+operation_error=Error occurred during the requested operation"},{"sha":"e11541e25fda3500e1a23e47c69179e368b0a014","filename":"console/src/main/resources/org/syncope/console/SyncopeApplication_it.properties","status":"modified","additions":1,"deletions":0,"changes":1,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/fc3c6f846672cae1f006e92d986aada7b370a8d2/console%2Fsrc%2Fmain%2Fresources%2Forg%2Fsyncope%2Fconsole%2FSyncopeApplication_it.properties","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/fc3c6f846672cae1f006e92d986aada7b370a8d2/console%2Fsrc%2Fmain%2Fresources%2Forg%2Fsyncope%2Fconsole%2FSyncopeApplication_it.properties","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/console%2Fsrc%2Fmain%2Fresources%2Forg%2Fsyncope%2Fconsole%2FSyncopeApplication_it.properties?ref=fc3c6f846672cae1f006e92d986aada7b370a8d2","patch":"@@ -7,3 +7,4 @@ connectors=Connettori\n report=Report\n logout=Logout\n schema=Schema\n+operation_error=Attenzione si \\u00E8 verificato un errore durante l'esecizione dell'operazione richiesta"},{"sha":"2671e863ced2d6b925cf80f3d42ed543fbb00138","filename":"console/src/main/resources/org/syncope/console/pages/SyncopeModalPage.html","status":"modified","additions":0,"deletions":4,"changes":4,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/fc3c6f846672cae1f006e92d986aada7b370a8d2/console%2Fsrc%2Fmain%2Fresources%2Forg%2Fsyncope%2Fconsole%2Fpages%2FSyncopeModalPage.html","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/fc3c6f846672cae1f006e92d986aada7b370a8d2/console%2Fsrc%2Fmain%2Fresources%2Forg%2Fsyncope%2Fconsole%2Fpages%2FSyncopeModalPage.html","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/console%2Fsrc%2Fmain%2Fresources%2Forg%2Fsyncope%2Fconsole%2Fpages%2FSyncopeModalPage.html?ref=fc3c6f846672cae1f006e92d986aada7b370a8d2","patch":"@@ -44,10 +44,6 @@\n         </script>\n \n         <style type=\"text/css\">\n-            input[disabled] {\n-                background-color: #ddd;\n-            }\n-\n             table.palette td.header {\n             background:url(\"images/ui-bg_glass_75_e6e6e6_1x400.png\")\n                 repeat-x scroll 50% 50% #E6E6E6 !important;"},{"sha":"2a92218a9292a90a6d7a7072b0343e9238d6dffe","filename":"console/src/main/resources/org/syncope/console/pages/Users.html","status":"modified","additions":133,"deletions":14,"changes":147,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/fc3c6f846672cae1f006e92d986aada7b370a8d2/console%2Fsrc%2Fmain%2Fresources%2Forg%2Fsyncope%2Fconsole%2Fpages%2FUsers.html","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/fc3c6f846672cae1f006e92d986aada7b370a8d2/console%2Fsrc%2Fmain%2Fresources%2Forg%2Fsyncope%2Fconsole%2Fpages%2FUsers.html","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/console%2Fsrc%2Fmain%2Fresources%2Forg%2Fsyncope%2Fconsole%2Fpages%2FUsers.html?ref=fc3c6f846672cae1f006e92d986aada7b370a8d2","patch":"@@ -12,6 +12,26 @@\n  limitations under the License.\n  under the License.\n -->\n+<wicket:head>\n+    <style type=\"text/css\">\n+      /* SET THE DEFAULT ERROR PANEL'S' STYLE, INVALIDATING THE CSS RENDERING\n+      FOR THE CURRENT PAGE  */\n+     .feedbackPanelERROR {\n+        background: none !important;\n+        font-weight: normal;\n+        color: red;\n+        border:0 none !important;\n+        list-style-type: disc;\n+        padding: 0px;\n+        margin: 0px;\n+     }\n+\n+    .feedbackPanelERROR span {\n+        padding: 0px;\n+        margin: 0px;\n+     }\n+    </style>\n+</wicket:head>\n <wicket:extend>\n     <div id=\"testa\">\n         <img src=\"img/logo.png\" alt=\"syncope\" title=\"syncope\" id=\"logo\" />\n@@ -77,13 +97,13 @@ <h1><wicket:message key=\"users_title\"/></h1>\n                     <thead>\n                         <tr class=\"ui-widget-header\">\n                             <th><wicket:message key=\"id\"/></th>\n-                    <th><wicket:message key=\"status\"/></th>\n-                    <th><wicket:message key=\"token\"/></th>\n-                    <th wicket:id=\"usersSchema\">\n-                        <span wicket:id=\"attribute\"/>\n-                    </th>\n-                    <th><wicket:message key=\"edit\"/></th>\n-                    <th><wicket:message key=\"delete\"/></th>\n+                            <th><wicket:message key=\"status\"/></th>\n+                            <th><wicket:message key=\"token\"/></th>\n+                            <th wicket:id=\"usersSchema\">\n+                                <span wicket:id=\"attribute\"/>\n+                            </th>\n+                            <th><wicket:message key=\"edit\"/></th>\n+                            <th><wicket:message key=\"delete\"/></th>\n                     </tr>\n                     </thead>\n                     <tbody>\n@@ -117,7 +137,6 @@ <h1><wicket:message key=\"users_title\"/></h1>\n \n             <div wicket:id=\"createUserWin\">[Show modal window for creating user]</div>\n             <div wicket:id=\"editUserWin\">[Show modal window for editing user]</div>\n-            <div wicket:id=\"searchUsersWin\">[Show modal window for searching users]</div>\n             <div wicket:id=\"changeAttributesViewWin\">[Show modal window for editing user]</div>\n \n             <a class=\"ui-button ui-widget ui-state-default ui-corner-all ui-button-text-only\" wicket:id=\"createUserLink\">\n@@ -129,13 +148,113 @@ <h1><wicket:message key=\"users_title\"/></h1>\n             </a>\n \n         </div>\n-        \n+\n         <div id=\"tabs-2\">\n-            <!-- PLACE SEARCH FORM HERE -->\n-            <div style=\"margin:auto;vertical-align: middle\">\n-                <img src=\"img/under-construction.jpg\" alt=\"under_construction\"\n-                     style=\"display:block; margin:auto;\"/>\n-            </div>\n+            <form wicket:id=\"UserSearchForm\">\n+                <div wicket:id=\"feedback\"/>\n+                <div id=\"searchBox\">\n+                    <h1><wicket:message key=\"search_title\"/></h1>\n+                    <table border=\"0\">\n+                        <thead>\n+                            <tr>\n+                                <th></th>\n+                                <th>Not value</th>\n+                                <th>Filter type</th>\n+                                <th>Filter name</th>\n+                                <th>Type</th>\n+                                <th>Filter value</th>\n+                                <th></th>\n+                            </tr>\n+                        </thead>\n+                        <tbody wicket:id=\"container\">\n+                            <tr wicket:id=\"searchView\">\n+                                <td>\n+                                    <b><span wicket:id=\"operationType\"/></b>\n+                                </td>\n+                                <td>\n+                                    <input type=\"checkbox\" wicket:id=\"notOperator\"/>\n+                                </td>\n+                                <td>\n+                                    <select class=\"text ui-widget-content ui-corner-all\"\n+                                            wicket:id=\"filterType\"/>\n+                                </td>\n+                                                                <td>\n+                                    <select class=\"text ui-widget-content ui-corner-all\"\n+                                            wicket:id=\"filterName\"/>\n+                                </td>\n+                                <td>\n+                                    <select class=\"text ui-widget-content ui-corner-all\"\n+                                            wicket:id=\"type\"/>\n+                                </td>\n+                                <td>\n+                                    <input type=\"text\" class=\"text ui-widget-content ui-corner-all\"\n+                                           wicket:id=\"filterValue\"/>\n+                                </td>\n+                                <td>\n+                                    <input type=\"button\" class=\"text ui-widget-content ui-corner-all\"\n+                                           wicket:id=\"dropButton\"/>\n+                                </td>\n+                            </tr>\n+                            <tr>\n+                                <td>\n+                                    <input type=\"button\" class=\"text ui-widget-content ui-corner-all\"\n+                                           wicket:id=\"addAndButton\"/>\n+                                </td>\n+                                <td>\n+                                    <input type=\"button\" class=\"text ui-widget-content ui-corner-all\"\n+                                           wicket:id=\"addOrButton\"/>\n+                                </td>\n+                            </tr>\n+                        </tbody>\n+                    </table>\n+\n+                    <input type=\"button\" class=\"text ui-widget-content ui-corner-all\"\n+                           wicket:id=\"search\"/>\n+                    \n+                    <!-- SEARCH RESULTS -->\n+                    <div class=\"ui-widget\" id=\"users-contain\">\n+                        <p>\n+                            &nbsp;\n+                        </p>\n+                        <img src=\"img/search.png\" alt=\"search\"/>\n+                        <h1 style=\"display:inline\"><wicket:message key=\"search_results_title\"/></h1>\n+                            <table id=\"users\" class=\"ui-widget ui-widget-content\" wicket:id=\"searchResultsContainer\">\n+                                <thead>\n+                                    <tr class=\"ui-widget-header\">\n+                                        <th><wicket:message key=\"id\"/></th>\n+                                        <th><wicket:message key=\"status\"/></th>\n+                                        <th><wicket:message key=\"token\"/></th>\n+                                        <th><wicket:message key=\"edit\"/></th>\n+                                        <th><wicket:message key=\"delete\"/></th>\n+                                    </tr>\n+                                </thead>\n+                                <tbody>\n+                                    <tr wicket:id=\"results\">\n+                                        <td>\n+                                            <span wicket:id=\"id\">[id]</span>\n+                                        </td>\n+                                        <td>\n+                                            <span wicket:id=\"status\">[status]</span>\n+                                        </td>\n+                                        <td>\n+                                            <span wicket:id=\"token\">[token]</span>\n+                                        </td>\n+                                        <td>\n+                                            <a href=\"#\" wicket:id=\"editLink\">\n+                                                <wicket:message key=\"edit\"/>\n+                                            </a>\n+                                        </td>\n+                                        <td>\n+                                            <a href=\"#\" wicket:id=\"deleteLink\">\n+                                                <wicket:message key=\"delete\"/>\n+                                            </a>\n+                                        </td>\n+                                    </tr>\n+                                </tbody>\n+                            </table>\n+                    </div>\n+                </div>\n+            </form>\n         </div>\n     </div>\n "},{"sha":"f1e67e37fdc43b4c921f0f3c43b26b886baae177","filename":"console/src/main/resources/org/syncope/console/pages/Users.properties","status":"modified","additions":9,"deletions":4,"changes":13,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/fc3c6f846672cae1f006e92d986aada7b370a8d2/console%2Fsrc%2Fmain%2Fresources%2Forg%2Fsyncope%2Fconsole%2Fpages%2FUsers.properties","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/fc3c6f846672cae1f006e92d986aada7b370a8d2/console%2Fsrc%2Fmain%2Fresources%2Forg%2Fsyncope%2Fconsole%2Fpages%2FUsers.properties","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/console%2Fsrc%2Fmain%2Fresources%2Forg%2Fsyncope%2Fconsole%2Fpages%2FUsers.properties?ref=fc3c6f846672cae1f006e92d986aada7b370a8d2","patch":"@@ -1,7 +1,7 @@\n #Tabs\n tab1=Users list\n tab2=Search user\n-#tab1\n+#tab1 - USERS LIST\n search=Search\n firstname=Name\n surname=Surname\n@@ -15,8 +15,13 @@ token=Token\n change_attributes=Change attributes view\n tokenValued=valued\n tokenNotValued=Not valued\n-#tab2\n+#tab2 - USERS SEARCH\n search_title=Set criteria for user search\n users_title=Existing Users\n-addButton=+\n-dropButton=-\n\\ No newline at end of file\n+addAndButton=+ And\n+addOrButton=+ Or\n+dropButton=-\n+search_error=Error:search's format is invalid\n+search_results_title=Search results:\n+search_noResults=No matches found.\n+reset=Reset"},{"sha":"f3c78306299794b93f6b884a9fe6b45db682b6b0","filename":"console/src/main/resources/org/syncope/console/pages/Users_it.properties","status":"modified","additions":7,"deletions":3,"changes":10,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/fc3c6f846672cae1f006e92d986aada7b370a8d2/console%2Fsrc%2Fmain%2Fresources%2Forg%2Fsyncope%2Fconsole%2Fpages%2FUsers_it.properties","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/fc3c6f846672cae1f006e92d986aada7b370a8d2/console%2Fsrc%2Fmain%2Fresources%2Forg%2Fsyncope%2Fconsole%2Fpages%2FUsers_it.properties","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/console%2Fsrc%2Fmain%2Fresources%2Forg%2Fsyncope%2Fconsole%2Fpages%2FUsers_it.properties?ref=fc3c6f846672cae1f006e92d986aada7b370a8d2","patch":"@@ -2,7 +2,7 @@\n tab1=Elenco utenti\n tab2=Ricerca utente\n #tab2\n-search=Ricerca\n+search=Cerca\n firstname=Nome\n surname=Cognome\n create_user=Crea nuovo utente\n@@ -17,5 +17,9 @@ tokenValued=Impostato\n tokenNotValued=Non impostato\n search_title=Impostare i criteri di ricerca\n users_title=Utenti esistenti\n-addButton=+\n-dropButton=-\n\\ No newline at end of file\n+addAndButton=+ And\n+dropButton=-\n+search_error=Errore:il formato di ricerca non \\u00E8 valido\n+search_results_title=Risultati ricerca:\n+search_noResults=Nessuna corrispondenza trovata.\n+reset=Reset"},{"sha":"66c4467e5d9588b085f1c768ceb843b7c1e256a6","filename":"console/src/main/webapp/css/stile_sy.css","status":"modified","additions":8,"deletions":0,"changes":8,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/fc3c6f846672cae1f006e92d986aada7b370a8d2/console%2Fsrc%2Fmain%2Fwebapp%2Fcss%2Fstile_sy.css","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/fc3c6f846672cae1f006e92d986aada7b370a8d2/console%2Fsrc%2Fmain%2Fwebapp%2Fcss%2Fstile_sy.css","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/console%2Fsrc%2Fmain%2Fwebapp%2Fcss%2Fstile_sy.css?ref=fc3c6f846672cae1f006e92d986aada7b370a8d2","patch":"@@ -91,6 +91,14 @@ body {\n     margin: 0px;\n }\n \n+input[disabled] {\n+    background-color: #ddd;\n+}\n+\n+select[disabled] {\n+    background-color: #ddd;\n+}\n+\n #feedbackDiv {\n     height: 20px;\n     margin: 0px;"},{"sha":"c19eb1e9b186601f43dc51960ec6151250f4919a","filename":"console/src/main/webapp/img/search.png","status":"added","additions":0,"deletions":0,"changes":0,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/fc3c6f846672cae1f006e92d986aada7b370a8d2/console%2Fsrc%2Fmain%2Fwebapp%2Fimg%2Fsearch.png","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/fc3c6f846672cae1f006e92d986aada7b370a8d2/console%2Fsrc%2Fmain%2Fwebapp%2Fimg%2Fsearch.png","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/console%2Fsrc%2Fmain%2Fwebapp%2Fimg%2Fsearch.png?ref=fc3c6f846672cae1f006e92d986aada7b370a8d2"}]}