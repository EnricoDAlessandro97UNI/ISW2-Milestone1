{"sha":"c622009090b49336b2c4da4bbf6720163bbf5198","node_id":"MDY6Q29tbWl0NjM2ODc5MDYyOmM2MjIwMDkwOTBiNDkzMzZiMmM0ZGE0YmJmNjcyMDE2M2JiZjUxOTg=","commit":{"author":{"name":"Francesco Chicchiriccò","email":"ilgrosso@apache.org","date":"2017-01-10T10:01:48Z"},"committer":{"name":"Francesco Chicchiriccò","email":"ilgrosso@apache.org","date":"2017-01-10T10:02:25Z"},"message":"[SYNCOPE-989] Customized FopSerializer as Cocoon 3 is still bound to FOP 1.0","tree":{"sha":"2c39a74091a39cec754b469b2b8e4b4e2f9020af","url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/git/trees/2c39a74091a39cec754b469b2b8e4b4e2f9020af"},"url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/git/commits/c622009090b49336b2c4da4bbf6720163bbf5198","comment_count":0,"verification":{"verified":false,"reason":"unsigned","signature":null,"payload":null}},"url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/c622009090b49336b2c4da4bbf6720163bbf5198","html_url":"https://github.com/EnricoDAlessandro97UNI/syncope/commit/c622009090b49336b2c4da4bbf6720163bbf5198","comments_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/c622009090b49336b2c4da4bbf6720163bbf5198/comments","author":{"login":"ilgrosso","id":1064664,"node_id":"MDQ6VXNlcjEwNjQ2NjQ=","avatar_url":"https://avatars.githubusercontent.com/u/1064664?v=4","gravatar_id":"","url":"https://api.github.com/users/ilgrosso","html_url":"https://github.com/ilgrosso","followers_url":"https://api.github.com/users/ilgrosso/followers","following_url":"https://api.github.com/users/ilgrosso/following{/other_user}","gists_url":"https://api.github.com/users/ilgrosso/gists{/gist_id}","starred_url":"https://api.github.com/users/ilgrosso/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ilgrosso/subscriptions","organizations_url":"https://api.github.com/users/ilgrosso/orgs","repos_url":"https://api.github.com/users/ilgrosso/repos","events_url":"https://api.github.com/users/ilgrosso/events{/privacy}","received_events_url":"https://api.github.com/users/ilgrosso/received_events","type":"User","site_admin":false},"committer":{"login":"ilgrosso","id":1064664,"node_id":"MDQ6VXNlcjEwNjQ2NjQ=","avatar_url":"https://avatars.githubusercontent.com/u/1064664?v=4","gravatar_id":"","url":"https://api.github.com/users/ilgrosso","html_url":"https://github.com/ilgrosso","followers_url":"https://api.github.com/users/ilgrosso/followers","following_url":"https://api.github.com/users/ilgrosso/following{/other_user}","gists_url":"https://api.github.com/users/ilgrosso/gists{/gist_id}","starred_url":"https://api.github.com/users/ilgrosso/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ilgrosso/subscriptions","organizations_url":"https://api.github.com/users/ilgrosso/orgs","repos_url":"https://api.github.com/users/ilgrosso/repos","events_url":"https://api.github.com/users/ilgrosso/events{/privacy}","received_events_url":"https://api.github.com/users/ilgrosso/received_events","type":"User","site_admin":false},"parents":[{"sha":"bbbd945f8a8bd9c9474c8d423ab7f6120697431d","url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/bbbd945f8a8bd9c9474c8d423ab7f6120697431d","html_url":"https://github.com/EnricoDAlessandro97UNI/syncope/commit/bbbd945f8a8bd9c9474c8d423ab7f6120697431d"}],"stats":{"total":113,"additions":85,"deletions":28},"files":[{"sha":"58d1f818b7bac783d24f61c97c859ccd7490a0e0","filename":"core/logic/pom.xml","status":"modified","additions":0,"deletions":8,"changes":8,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/c622009090b49336b2c4da4bbf6720163bbf5198/core%2Flogic%2Fpom.xml","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/c622009090b49336b2c4da4bbf6720163bbf5198/core%2Flogic%2Fpom.xml","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Flogic%2Fpom.xml?ref=c622009090b49336b2c4da4bbf6720163bbf5198","patch":"@@ -74,14 +74,6 @@ under the License.\n       <groupId>org.apache.xmlgraphics</groupId>\n       <artifactId>fop</artifactId>\n     </dependency>\n-    <dependency>\n-      <groupId>org.apache.avalon.framework</groupId>\n-      <artifactId>avalon-framework-api</artifactId>\n-    </dependency>\n-    <dependency>\n-      <groupId>org.apache.avalon.framework</groupId>\n-      <artifactId>avalon-framework-impl</artifactId>\n-    </dependency>\n \n     <dependency>\n       <groupId>org.apache.logging.log4j</groupId>"},{"sha":"033dfa338c3e9f7d8d3ede155040abd9c723afe7","filename":"core/logic/src/main/java/org/apache/syncope/core/logic/ReportLogic.java","status":"modified","additions":1,"deletions":1,"changes":2,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/c622009090b49336b2c4da4bbf6720163bbf5198/core%2Flogic%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Flogic%2FReportLogic.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/c622009090b49336b2c4da4bbf6720163bbf5198/core%2Flogic%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Flogic%2FReportLogic.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Flogic%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Flogic%2FReportLogic.java?ref=c622009090b49336b2c4da4bbf6720163bbf5198","patch":"@@ -28,7 +28,6 @@\n import java.util.Map;\n import java.util.zip.ZipInputStream;\n import javax.xml.transform.stream.StreamSource;\n-import org.apache.cocoon.optional.pipeline.components.sax.fop.FopSerializer;\n import org.apache.cocoon.pipeline.NonCachingPipeline;\n import org.apache.cocoon.pipeline.Pipeline;\n import org.apache.cocoon.sax.SAXPipelineComponent;\n@@ -60,6 +59,7 @@\n import org.apache.syncope.common.lib.types.JobAction;\n import org.apache.syncope.common.lib.types.JobType;\n import org.apache.syncope.common.lib.types.StandardEntitlement;\n+import org.apache.syncope.core.logic.report.FopSerializer;\n import org.apache.syncope.core.logic.report.XSLTTransformer;\n import org.apache.syncope.core.persistence.api.dao.ConfDAO;\n import org.apache.syncope.core.persistence.api.dao.search.OrderByClause;"},{"sha":"9b8b590655b648eeb9e9b1f1297419ebbcc7b602","filename":"core/logic/src/main/java/org/apache/syncope/core/logic/report/FopSerializer.java","status":"added","additions":83,"deletions":0,"changes":83,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/c622009090b49336b2c4da4bbf6720163bbf5198/core%2Flogic%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Flogic%2Freport%2FFopSerializer.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/c622009090b49336b2c4da4bbf6720163bbf5198/core%2Flogic%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Flogic%2Freport%2FFopSerializer.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Flogic%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Flogic%2Freport%2FFopSerializer.java?ref=c622009090b49336b2c4da4bbf6720163bbf5198","patch":"@@ -0,0 +1,83 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements.  See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.apache.syncope.core.logic.report;\n+\n+import java.io.File;\n+import java.io.OutputStream;\n+\n+import org.apache.cocoon.pipeline.ProcessingException;\n+import org.apache.cocoon.pipeline.caching.CacheKey;\n+import org.apache.cocoon.pipeline.caching.SimpleCacheKey;\n+import org.apache.cocoon.pipeline.component.CachingPipelineComponent;\n+import org.apache.cocoon.pipeline.util.StringRepresentation;\n+import org.apache.cocoon.sax.AbstractSAXSerializer;\n+import org.apache.fop.apps.FOPException;\n+import org.apache.fop.apps.Fop;\n+import org.apache.fop.apps.FopFactory;\n+import org.apache.fop.apps.FopFactoryBuilder;\n+import org.apache.xmlgraphics.util.MimeConstants;\n+import org.xml.sax.ContentHandler;\n+\n+public class FopSerializer extends AbstractSAXSerializer implements CachingPipelineComponent {\n+\n+    private static final FopFactory FOP_FACTORY = new FopFactoryBuilder(new File(\".\").toURI()).build();\n+\n+    private String outputFormat;\n+\n+    /**\n+     * Create a new FOP serializer that produces a PDF in output\n+     */\n+    public FopSerializer() {\n+        this(MimeConstants.MIME_PDF);\n+    }\n+\n+    /**\n+     * Create a new FOP serializer that produces the specified mime\n+     *\n+     * @param outputFormat the output's mime type\n+     * @see {@link MimeConstants}\n+     */\n+    public FopSerializer(final String outputFormat) {\n+        if (outputFormat == null) {\n+            throw new IllegalArgumentException(\"The parameter 'outputFormat' mustn't be null.\");\n+        }\n+\n+        this.outputFormat = outputFormat;\n+    }\n+\n+    @Override\n+    public CacheKey constructCacheKey() {\n+        return new SimpleCacheKey();\n+    }\n+\n+    @Override\n+    public void setOutputStream(final OutputStream outputStream) {\n+        try {\n+            Fop fop = FOP_FACTORY.newFop(this.outputFormat, outputStream);\n+            ContentHandler fopContentHandler = fop.getDefaultHandler();\n+\n+            this.setContentHandler(fopContentHandler);\n+        } catch (FOPException e) {\n+            throw new ProcessingException(\"Impossible to initialize FOPSerializer\", e);\n+        }\n+    }\n+\n+    @Override\n+    public String toString() {\n+        return StringRepresentation.buildString(this, \"outputFormat=\" + this.outputFormat);\n+    }\n+}"},{"sha":"022aac92a7e725bef55b02dc199cc240fe61b093","filename":"pom.xml","status":"modified","additions":1,"deletions":19,"changes":20,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/c622009090b49336b2c4da4bbf6720163bbf5198/pom.xml","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/c622009090b49336b2c4da4bbf6720163bbf5198/pom.xml","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/pom.xml?ref=c622009090b49336b2c4da4bbf6720163bbf5198","patch":"@@ -895,32 +895,14 @@ under the License.\n       <dependency>\n         <groupId>org.apache.xmlgraphics</groupId>\n         <artifactId>fop</artifactId>\n-        <version>1.1</version>\n+        <version>2.1</version>\n         <exclusions>\n-          <exclusion>\n-            <groupId>org.apache.avalon.framework</groupId>\n-            <artifactId>avalon-framework-api</artifactId>\n-          </exclusion>\n-          <exclusion>\n-            <groupId>org.apache.avalon.framework</groupId>\n-            <artifactId>avalon-framework-impl</artifactId>\n-          </exclusion>\n           <exclusion>\n             <groupId>xalan</groupId>\n             <artifactId>xalan</artifactId>\n           </exclusion>\n         </exclusions>\n       </dependency>\n-      <dependency>\n-        <groupId>org.apache.avalon.framework</groupId>\n-        <artifactId>avalon-framework-api</artifactId>\n-        <version>4.3.1</version>\n-      </dependency>\n-      <dependency>\n-        <groupId>org.apache.avalon.framework</groupId>\n-        <artifactId>avalon-framework-impl</artifactId>\n-        <version>4.3.1</version>\n-      </dependency>\n             \n       <!-- Activiti -->\n       <dependency>"}]}