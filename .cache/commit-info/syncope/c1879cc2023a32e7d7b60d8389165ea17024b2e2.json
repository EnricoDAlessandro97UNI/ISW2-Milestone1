{"sha":"c1879cc2023a32e7d7b60d8389165ea17024b2e2","node_id":"MDY6Q29tbWl0NjM2ODc5MDYyOmMxODc5Y2MyMDIzYTMyZTdkN2I2MGQ4Mzg5MTY1ZWExNzAyNGIyZTI=","commit":{"author":{"name":"fmartelli","email":"fabio.martelli@gmail.com","date":"2018-12-10T13:24:30Z"},"committer":{"name":"fmartelli","email":"fabio.martelli@gmail.com","date":"2018-12-10T14:39:56Z"},"message":"[SYNCOPE-1411] force cascade","tree":{"sha":"7c1ad8ceac686aab05e505739d5545c1d16996cd","url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/git/trees/7c1ad8ceac686aab05e505739d5545c1d16996cd"},"url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/git/commits/c1879cc2023a32e7d7b60d8389165ea17024b2e2","comment_count":0,"verification":{"verified":false,"reason":"unsigned","signature":null,"payload":null}},"url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/c1879cc2023a32e7d7b60d8389165ea17024b2e2","html_url":"https://github.com/EnricoDAlessandro97UNI/syncope/commit/c1879cc2023a32e7d7b60d8389165ea17024b2e2","comments_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/c1879cc2023a32e7d7b60d8389165ea17024b2e2/comments","author":{"login":"fmartelli","id":1791932,"node_id":"MDQ6VXNlcjE3OTE5MzI=","avatar_url":"https://avatars.githubusercontent.com/u/1791932?v=4","gravatar_id":"","url":"https://api.github.com/users/fmartelli","html_url":"https://github.com/fmartelli","followers_url":"https://api.github.com/users/fmartelli/followers","following_url":"https://api.github.com/users/fmartelli/following{/other_user}","gists_url":"https://api.github.com/users/fmartelli/gists{/gist_id}","starred_url":"https://api.github.com/users/fmartelli/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/fmartelli/subscriptions","organizations_url":"https://api.github.com/users/fmartelli/orgs","repos_url":"https://api.github.com/users/fmartelli/repos","events_url":"https://api.github.com/users/fmartelli/events{/privacy}","received_events_url":"https://api.github.com/users/fmartelli/received_events","type":"User","site_admin":false},"committer":{"login":"fmartelli","id":1791932,"node_id":"MDQ6VXNlcjE3OTE5MzI=","avatar_url":"https://avatars.githubusercontent.com/u/1791932?v=4","gravatar_id":"","url":"https://api.github.com/users/fmartelli","html_url":"https://github.com/fmartelli","followers_url":"https://api.github.com/users/fmartelli/followers","following_url":"https://api.github.com/users/fmartelli/following{/other_user}","gists_url":"https://api.github.com/users/fmartelli/gists{/gist_id}","starred_url":"https://api.github.com/users/fmartelli/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/fmartelli/subscriptions","organizations_url":"https://api.github.com/users/fmartelli/orgs","repos_url":"https://api.github.com/users/fmartelli/repos","events_url":"https://api.github.com/users/fmartelli/events{/privacy}","received_events_url":"https://api.github.com/users/fmartelli/received_events","type":"User","site_admin":false},"parents":[{"sha":"8340ea41714d393acf77be86d6d21f0f972f5cd0","url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/8340ea41714d393acf77be86d6d21f0f972f5cd0","html_url":"https://github.com/EnricoDAlessandro97UNI/syncope/commit/8340ea41714d393acf77be86d6d21f0f972f5cd0"}],"stats":{"total":16,"additions":15,"deletions":1},"files":[{"sha":"c13052cba0aa25681965bfe1c3be7fb9b5f76e42","filename":"core/provisioning-java/src/main/java/org/apache/syncope/core/provisioning/java/data/AnyObjectDataBinderImpl.java","status":"modified","additions":8,"deletions":0,"changes":8,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/c1879cc2023a32e7d7b60d8389165ea17024b2e2/core%2Fprovisioning-java%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fprovisioning%2Fjava%2Fdata%2FAnyObjectDataBinderImpl.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/c1879cc2023a32e7d7b60d8389165ea17024b2e2/core%2Fprovisioning-java%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fprovisioning%2Fjava%2Fdata%2FAnyObjectDataBinderImpl.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fprovisioning-java%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fprovisioning%2Fjava%2Fdata%2FAnyObjectDataBinderImpl.java?ref=c1879cc2023a32e7d7b60d8389165ea17024b2e2","patch":"@@ -54,6 +54,7 @@\n import org.apache.syncope.core.persistence.api.entity.group.Group;\n import org.apache.syncope.core.persistence.api.entity.resource.ExternalResource;\n import org.apache.syncope.core.provisioning.api.data.AnyObjectDataBinder;\n+import org.apache.syncope.core.provisioning.api.utils.EntityUtils;\n import org.springframework.beans.factory.annotation.Autowired;\n import org.springframework.stereotype.Component;\n import org.springframework.transaction.annotation.Transactional;\n@@ -341,9 +342,16 @@ public PropagationByResource update(final AnyObject toBeUpdated, final AnyObject\n             anyObject.getMembership(membPatch.getGroup()).ifPresent(membership -> {\n                 anyObject.remove(membership);\n                 membership.setLeftEnd(null);\n+                Set<String> membAttrKeys = new HashSet<>();\n                 anyObject.getPlainAttrs(membership).forEach(attr -> {\n                     anyObject.remove(attr);\n                     attr.setOwner(null);\n+                    attr.setMembership(null);\n+                    membAttrKeys.add(attr.getKey());\n+                    plainAttrValueDAO.deleteAll(attr, anyUtils);\n+                });\n+                membAttrKeys.forEach(attrKey -> {\n+                    plainAttrDAO.delete(attrKey, anyUtils.plainAttrClass());\n                 });\n \n                 if (membPatch.getOperation() == PatchOperation.DELETE) {"},{"sha":"f629f8ba71fb60a454e7dc4cf6fd244c54d558b9","filename":"core/provisioning-java/src/main/java/org/apache/syncope/core/provisioning/java/data/UserDataBinderImpl.java","status":"modified","additions":7,"deletions":1,"changes":8,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/c1879cc2023a32e7d7b60d8389165ea17024b2e2/core%2Fprovisioning-java%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fprovisioning%2Fjava%2Fdata%2FUserDataBinderImpl.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/c1879cc2023a32e7d7b60d8389165ea17024b2e2/core%2Fprovisioning-java%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fprovisioning%2Fjava%2Fdata%2FUserDataBinderImpl.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fprovisioning-java%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fprovisioning%2Fjava%2Fdata%2FUserDataBinderImpl.java?ref=c1879cc2023a32e7d7b60d8389165ea17024b2e2","patch":"@@ -414,12 +414,18 @@ public PropagationByResource update(final User toBeUpdated, final UserUR userUR)\n             user.getMembership(membPatch.getGroup()).ifPresent(membership -> {\n                 user.remove(membership);\n                 membership.setLeftEnd(null);\n+                Set<String> membAttrKeys = new HashSet<>();\n                 user.getPlainAttrs(membership).forEach(attr -> {\n                     user.remove(attr);\n                     attr.setOwner(null);\n                     attr.setMembership(null);\n+                    membAttrKeys.add(attr.getKey());\n+                    plainAttrValueDAO.deleteAll(attr, anyUtils);\n                 });\n-\n+                membAttrKeys.forEach(attrKey -> {\n+                    plainAttrDAO.delete(attrKey, anyUtils.plainAttrClass());\n+                });\n+                \n                 if (membPatch.getOperation() == PatchOperation.DELETE) {\n                     groupDAO.findAllResourceKeys(membership.getRightEnd().getKey()).stream().\n                             filter(resource -> reasons.containsKey(resource))."}]}