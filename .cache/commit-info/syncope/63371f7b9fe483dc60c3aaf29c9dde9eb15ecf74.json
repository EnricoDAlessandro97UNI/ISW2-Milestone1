{"sha":"63371f7b9fe483dc60c3aaf29c9dde9eb15ecf74","node_id":"MDY6Q29tbWl0NjM2ODc5MDYyOjYzMzcxZjdiOWZlNDgzZGM2MGMzYWFmMjljOWRkZTllYjE1ZWNmNzQ=","commit":{"author":{"name":"Francesco Chicchiriccò","email":"ilgrosso@apache.org","date":"2018-09-05T07:33:08Z"},"committer":{"name":"Francesco Chicchiriccò","email":"ilgrosso@apache.org","date":"2018-09-05T07:33:17Z"},"message":"[SYNCOPE-1363] Avoid re-reading deleted users, groups or any objects","tree":{"sha":"cd27255555c6261b5c05176e9a4e1aae51020be0","url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/git/trees/cd27255555c6261b5c05176e9a4e1aae51020be0"},"url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/git/commits/63371f7b9fe483dc60c3aaf29c9dde9eb15ecf74","comment_count":0,"verification":{"verified":false,"reason":"unsigned","signature":null,"payload":null}},"url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/63371f7b9fe483dc60c3aaf29c9dde9eb15ecf74","html_url":"https://github.com/EnricoDAlessandro97UNI/syncope/commit/63371f7b9fe483dc60c3aaf29c9dde9eb15ecf74","comments_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/63371f7b9fe483dc60c3aaf29c9dde9eb15ecf74/comments","author":{"login":"ilgrosso","id":1064664,"node_id":"MDQ6VXNlcjEwNjQ2NjQ=","avatar_url":"https://avatars.githubusercontent.com/u/1064664?v=4","gravatar_id":"","url":"https://api.github.com/users/ilgrosso","html_url":"https://github.com/ilgrosso","followers_url":"https://api.github.com/users/ilgrosso/followers","following_url":"https://api.github.com/users/ilgrosso/following{/other_user}","gists_url":"https://api.github.com/users/ilgrosso/gists{/gist_id}","starred_url":"https://api.github.com/users/ilgrosso/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ilgrosso/subscriptions","organizations_url":"https://api.github.com/users/ilgrosso/orgs","repos_url":"https://api.github.com/users/ilgrosso/repos","events_url":"https://api.github.com/users/ilgrosso/events{/privacy}","received_events_url":"https://api.github.com/users/ilgrosso/received_events","type":"User","site_admin":false},"committer":{"login":"ilgrosso","id":1064664,"node_id":"MDQ6VXNlcjEwNjQ2NjQ=","avatar_url":"https://avatars.githubusercontent.com/u/1064664?v=4","gravatar_id":"","url":"https://api.github.com/users/ilgrosso","html_url":"https://github.com/ilgrosso","followers_url":"https://api.github.com/users/ilgrosso/followers","following_url":"https://api.github.com/users/ilgrosso/following{/other_user}","gists_url":"https://api.github.com/users/ilgrosso/gists{/gist_id}","starred_url":"https://api.github.com/users/ilgrosso/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ilgrosso/subscriptions","organizations_url":"https://api.github.com/users/ilgrosso/orgs","repos_url":"https://api.github.com/users/ilgrosso/repos","events_url":"https://api.github.com/users/ilgrosso/events{/privacy}","received_events_url":"https://api.github.com/users/ilgrosso/received_events","type":"User","site_admin":false},"parents":[{"sha":"4546c3a54d9678002eac30dced8f916f3317a211","url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/4546c3a54d9678002eac30dced8f916f3317a211","html_url":"https://github.com/EnricoDAlessandro97UNI/syncope/commit/4546c3a54d9678002eac30dced8f916f3317a211"}],"stats":{"total":22,"additions":18,"deletions":4},"files":[{"sha":"b0138e9f81f85515dfd660fbfcd47ed018aecba1","filename":"client/console/src/main/java/org/apache/syncope/client/console/batch/BatchContent.java","status":"modified","additions":18,"deletions":4,"changes":22,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/63371f7b9fe483dc60c3aaf29c9dde9eb15ecf74/client%2Fconsole%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fclient%2Fconsole%2Fbatch%2FBatchContent.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/63371f7b9fe483dc60c3aaf29c9dde9eb15ecf74/client%2Fconsole%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fclient%2Fconsole%2Fbatch%2FBatchContent.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/client%2Fconsole%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fclient%2Fconsole%2Fbatch%2FBatchContent.java?ref=63371f7b9fe483dc60c3aaf29c9dde9eb15ecf74","patch":"@@ -22,16 +22,20 @@\n import java.util.ArrayList;\n import java.util.Collection;\n import java.util.HashMap;\n+import java.util.HashSet;\n import java.util.Iterator;\n import java.util.List;\n import java.util.Map;\n+import java.util.Set;\n import org.apache.cxf.helpers.CastUtils;\n import org.apache.syncope.client.console.SyncopeConsoleSession;\n import org.apache.syncope.client.console.commons.Constants;\n import org.apache.syncope.client.console.commons.status.StatusBean;\n import org.apache.syncope.client.console.pages.BasePage;\n import org.apache.syncope.client.console.panels.MultilevelPanel;\n import org.apache.syncope.client.console.rest.AbstractAnyRestClient;\n+import org.apache.syncope.client.console.rest.AnyObjectRestClient;\n+import org.apache.syncope.client.console.rest.GroupRestClient;\n import org.apache.syncope.client.console.rest.RestClient;\n import org.apache.syncope.client.console.rest.UserRestClient;\n import org.apache.syncope.client.console.wicket.extensions.markup.html.repeater.data.table.BatchResponseColumn;\n@@ -245,6 +249,8 @@ public void onClick(final AjaxRequestTarget target, final Serializable ignore) {\n                             TaskService batchTaskService = batch.getService(TaskService.class);\n                             ReportService batchReportService = batch.getService(ReportService.class);\n \n+                            Set<String> deletedAnys = new HashSet<>();\n+\n                             switch (action) {\n                                 case MUSTCHANGEPASSWORD:\n                                     items.forEach(item -> {\n@@ -295,6 +301,7 @@ public void onClick(final AjaxRequestTarget target, final Serializable ignore) {\n                                             AnyTO any = (AnyTO) item;\n \n                                             batchAnyService.delete(any.getKey());\n+                                            deletedAnys.add(any.getKey());\n                                         } else if (singleItem instanceof TaskTO) {\n                                             TaskTO task = (TaskTO) item;\n \n@@ -344,10 +351,17 @@ public void onClick(final AjaxRequestTarget target, final Serializable ignore) {\n                                     batchExecutor.getClass().getMethod(\"batch\",\n                                             BatchRequest.class).invoke(batchExecutor, batch)));\n \n-                            if (singleItem instanceof UserTO) {\n-                                UserRestClient userRestClient = UserRestClient.class.cast(batchExecutor);\n+                            if (singleItem instanceof AnyTO) {\n+                                AbstractAnyRestClient<? extends AnyTO> anyRestClient = singleItem instanceof UserTO\n+                                        ? UserRestClient.class.cast(batchExecutor)\n+                                        : singleItem instanceof GroupTO\n+                                                ? GroupRestClient.class.cast(batchExecutor)\n+                                                : AnyObjectRestClient.class.cast(batchExecutor);\n                                 for (int i = 0; i < items.size(); i++) {\n-                                    items.set(i, (T) userRestClient.read(((UserTO) items.get(i)).getKey()));\n+                                    String key = ((AnyTO) items.get(i)).getKey();\n+                                    if (!deletedAnys.contains(key)) {\n+                                        items.set(i, (T) anyRestClient.read(key));\n+                                    }\n                                 }\n                             }\n                         }\n@@ -369,7 +383,7 @@ public void onClick(final AjaxRequestTarget target, final Serializable ignore) {\n                         SyncopeConsoleSession.get().info(getString(Constants.OPERATION_SUCCEEDED));\n                     } catch (Exception e) {\n                         LOG.error(\"Batch failure\", e);\n-                        SyncopeConsoleSession.get().error(\"Operation \" + action.getActionId() + \" not supported\");\n+                        SyncopeConsoleSession.get().error(\"Operation \" + action.getActionId() + \" failed\");\n                     }\n                     ((BasePage) getPage()).getNotificationPanel().refresh(target);\n                 }"}]}