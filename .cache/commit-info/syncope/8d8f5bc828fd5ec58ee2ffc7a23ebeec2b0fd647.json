{"sha":"8d8f5bc828fd5ec58ee2ffc7a23ebeec2b0fd647","node_id":"MDY6Q29tbWl0NjM2ODc5MDYyOjhkOGY1YmM4MjhmZDVlYzU4ZWUyZmZjN2EyM2ViZWVjMmIwZmQ2NDc=","commit":{"author":{"name":"Unknown","email":"unknown@apache.org","date":"2011-11-10T14:22:36Z"},"committer":{"name":"Unknown","email":"unknown@apache.org","date":"2011-11-10T14:22:36Z"},"message":"Update issue 75\nImproving test case when password policy is not matched\n\n\ngit-svn-id: https://svn.apache.org/repos/asf/incubator/syncope/trunk@1247190 13f79535-47bb-0310-9956-ffa450edef68","tree":{"sha":"7de814025bcf73997f153354ac9f86ecc8aa66a6","url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/git/trees/7de814025bcf73997f153354ac9f86ecc8aa66a6"},"url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/git/commits/8d8f5bc828fd5ec58ee2ffc7a23ebeec2b0fd647","comment_count":0,"verification":{"verified":false,"reason":"unsigned","signature":null,"payload":null}},"url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/8d8f5bc828fd5ec58ee2ffc7a23ebeec2b0fd647","html_url":"https://github.com/EnricoDAlessandro97UNI/syncope/commit/8d8f5bc828fd5ec58ee2ffc7a23ebeec2b0fd647","comments_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/8d8f5bc828fd5ec58ee2ffc7a23ebeec2b0fd647/comments","author":null,"committer":null,"parents":[{"sha":"de0f938478bd26fe14881b14bf3127ae431e0952","url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/de0f938478bd26fe14881b14bf3127ae431e0952","html_url":"https://github.com/EnricoDAlessandro97UNI/syncope/commit/de0f938478bd26fe14881b14bf3127ae431e0952"}],"stats":{"total":31,"additions":23,"deletions":8},"files":[{"sha":"ee15caf1470165eca7c3aa5289d2fc094ee09ea4","filename":"core/src/test/java/org/syncope/core/rest/UserRequestTestITCase.java","status":"modified","additions":23,"deletions":8,"changes":31,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/8d8f5bc828fd5ec58ee2ffc7a23ebeec2b0fd647/core%2Fsrc%2Ftest%2Fjava%2Forg%2Fsyncope%2Fcore%2Frest%2FUserRequestTestITCase.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/8d8f5bc828fd5ec58ee2ffc7a23ebeec2b0fd647/core%2Fsrc%2Ftest%2Fjava%2Forg%2Fsyncope%2Fcore%2Frest%2FUserRequestTestITCase.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fsrc%2Ftest%2Fjava%2Forg%2Fsyncope%2Fcore%2Frest%2FUserRequestTestITCase.java?ref=8d8f5bc828fd5ec58ee2ffc7a23ebeec2b0fd647","patch":"@@ -13,11 +13,11 @@\n  */\n package org.syncope.core.rest;\n \n+import static org.junit.Assert.*;\n+\n import java.util.Arrays;\n import java.util.List;\n import org.apache.commons.httpclient.UsernamePasswordCredentials;\n-import static org.junit.Assert.*;\n-\n import org.apache.commons.httpclient.auth.AuthScope;\n import org.junit.Test;\n import org.springframework.http.HttpStatus;\n@@ -29,6 +29,9 @@\n import org.syncope.client.to.ConfigurationTO;\n import org.syncope.client.to.UserRequestTO;\n import org.syncope.client.to.UserTO;\n+import org.syncope.client.validation.SyncopeClientCompositeErrorException;\n+import org.syncope.client.validation.SyncopeClientException;\n+import org.syncope.types.SyncopeClientExceptionType;\n \n public class UserRequestTestITCase extends AbstractTest {\n \n@@ -104,7 +107,7 @@ public void update() {\n \n         UserMod userMod = new UserMod();\n         userMod.setId(userTO.getId());\n-        userMod.setPassword(\"new\" + initialPassword);\n+        userMod.setPassword(initialPassword);\n \n         // 2. try to request user update as admin: failure\n         try {\n@@ -120,28 +123,40 @@ public void update() {\n                 new UsernamePasswordCredentials(userTO.getUsername(),\n                 initialPassword));\n \n-        // 4. now request user update works\n+        // 4. update with same password: not matching password policy\n+        SyncopeClientException exception = null;\n+        try {\n+            restTemplate.postForObject(BASE_URL + \"user/request/update\",\n+                    userMod, UserRequestTO.class);\n+        } catch (SyncopeClientCompositeErrorException scce) {\n+            exception = scce.getException(\n+                    SyncopeClientExceptionType.InvalidSyncopeUser);\n+        }\n+        assertNotNull(exception);\n+\n+        // 5. now request user update works\n+        userMod.setPassword(\"new\" + initialPassword);\n         UserRequestTO request = restTemplate.postForObject(\n                 BASE_URL + \"user/request/update\",\n                 userMod, UserRequestTO.class);\n         assertNotNull(request);\n \n-        // 5. switch back to admin\n+        // 6. switch back to admin\n         super.setupRestTemplate();\n \n-        // 6. user password has not changed yet\n+        // 7. user password has not changed yet\n         Boolean verify = restTemplate.getForObject(\n                 BASE_URL + \"user/verifyPassword/{userId}?password=\"\n                 + userMod.getPassword(),\n                 Boolean.class, userTO.getId());\n         assertFalse(verify);\n \n-        // 7. actually update user\n+        // 8. actually update user\n         userTO = restTemplate.postForObject(BASE_URL + \"user/update\",\n                 userMod, UserTO.class);\n         assertNotNull(userTO);\n \n-        // 8. user password has now changed\n+        // 9. user password has now changed\n         verify = restTemplate.getForObject(\n                 BASE_URL + \"user/verifyPassword/{userId}?password=\"\n                 + userMod.getPassword(),"}]}