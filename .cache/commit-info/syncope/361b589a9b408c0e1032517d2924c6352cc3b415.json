{"sha":"361b589a9b408c0e1032517d2924c6352cc3b415","node_id":"MDY6Q29tbWl0NjM2ODc5MDYyOjM2MWI1ODlhOWI0MDhjMGUxMDMyNTE3ZDI5MjRjNjM1MmNjM2I0MTU=","commit":{"author":{"name":"Francesco Chicchiriccò","email":"ilgrosso@apache.org","date":"2013-11-21T09:51:46Z"},"committer":{"name":"Francesco Chicchiriccò","email":"ilgrosso@apache.org","date":"2013-11-21T09:51:46Z"},"message":"[SYNCOPE-440] Calling getLastSyncToken() before actual sync()\n\ngit-svn-id: https://svn.apache.org/repos/asf/syncope/branches/1_1_X@1544077 13f79535-47bb-0310-9956-ffa450edef68","tree":{"sha":"2ffc487c2be2e218182ba6c5e1d5fb08d555745b","url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/git/trees/2ffc487c2be2e218182ba6c5e1d5fb08d555745b"},"url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/git/commits/361b589a9b408c0e1032517d2924c6352cc3b415","comment_count":0,"verification":{"verified":false,"reason":"unsigned","signature":null,"payload":null}},"url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/361b589a9b408c0e1032517d2924c6352cc3b415","html_url":"https://github.com/EnricoDAlessandro97UNI/syncope/commit/361b589a9b408c0e1032517d2924c6352cc3b415","comments_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/361b589a9b408c0e1032517d2924c6352cc3b415/comments","author":{"login":"ilgrosso","id":1064664,"node_id":"MDQ6VXNlcjEwNjQ2NjQ=","avatar_url":"https://avatars.githubusercontent.com/u/1064664?v=4","gravatar_id":"","url":"https://api.github.com/users/ilgrosso","html_url":"https://github.com/ilgrosso","followers_url":"https://api.github.com/users/ilgrosso/followers","following_url":"https://api.github.com/users/ilgrosso/following{/other_user}","gists_url":"https://api.github.com/users/ilgrosso/gists{/gist_id}","starred_url":"https://api.github.com/users/ilgrosso/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ilgrosso/subscriptions","organizations_url":"https://api.github.com/users/ilgrosso/orgs","repos_url":"https://api.github.com/users/ilgrosso/repos","events_url":"https://api.github.com/users/ilgrosso/events{/privacy}","received_events_url":"https://api.github.com/users/ilgrosso/received_events","type":"User","site_admin":false},"committer":{"login":"ilgrosso","id":1064664,"node_id":"MDQ6VXNlcjEwNjQ2NjQ=","avatar_url":"https://avatars.githubusercontent.com/u/1064664?v=4","gravatar_id":"","url":"https://api.github.com/users/ilgrosso","html_url":"https://github.com/ilgrosso","followers_url":"https://api.github.com/users/ilgrosso/followers","following_url":"https://api.github.com/users/ilgrosso/following{/other_user}","gists_url":"https://api.github.com/users/ilgrosso/gists{/gist_id}","starred_url":"https://api.github.com/users/ilgrosso/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ilgrosso/subscriptions","organizations_url":"https://api.github.com/users/ilgrosso/orgs","repos_url":"https://api.github.com/users/ilgrosso/repos","events_url":"https://api.github.com/users/ilgrosso/events{/privacy}","received_events_url":"https://api.github.com/users/ilgrosso/received_events","type":"User","site_admin":false},"parents":[{"sha":"a65dd584746a9065c06fc1c6053312222b5f529f","url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/a65dd584746a9065c06fc1c6053312222b5f529f","html_url":"https://github.com/EnricoDAlessandro97UNI/syncope/commit/a65dd584746a9065c06fc1c6053312222b5f529f"}],"stats":{"total":16,"additions":13,"deletions":3},"files":[{"sha":"ffd1272f6efdbca2464b2e67dd0ded078faebba1","filename":"core/src/main/java/org/apache/syncope/core/sync/impl/SyncJob.java","status":"modified","additions":13,"deletions":3,"changes":16,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/361b589a9b408c0e1032517d2924c6352cc3b415/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fsync%2Fimpl%2FSyncJob.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/361b589a9b408c0e1032517d2924c6352cc3b415/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fsync%2Fimpl%2FSyncJob.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fsync%2Fimpl%2FSyncJob.java?ref=361b589a9b408c0e1032517d2924c6352cc3b415","patch":"@@ -46,6 +46,7 @@\n import org.apache.syncope.core.util.ApplicationContextProvider;\n import org.apache.syncope.core.workflow.role.RoleWorkflowAdapter;\n import org.identityconnectors.framework.common.objects.ObjectClass;\n+import org.identityconnectors.framework.common.objects.SyncToken;\n import org.quartz.JobExecutionException;\n import org.springframework.beans.factory.annotation.Autowired;\n import org.springframework.beans.factory.support.AbstractBeanDefinition;\n@@ -386,7 +387,7 @@ protected String executeWithSecurityContext(final boolean dryRun) throws JobExec\n         final SyncopeSyncResultHandler handler =\n                 (SyncopeSyncResultHandler) ((DefaultListableBeanFactory) ApplicationContextProvider.\n                 getApplicationContext().getBeanFactory()).createBean(\n-                SyncopeSyncResultHandler.class, AbstractBeanDefinition.AUTOWIRE_BY_NAME, false);\n+                        SyncopeSyncResultHandler.class, AbstractBeanDefinition.AUTOWIRE_BY_NAME, false);\n         handler.setConnector(connector);\n         handler.setActions(actions);\n         handler.setDryRun(dryRun);\n@@ -396,6 +397,15 @@ protected String executeWithSecurityContext(final boolean dryRun) throws JobExec\n \n         actions.beforeAll(handler);\n         try {\n+            SyncToken latestUSyncToken = null;\n+            if (uMapping != null && !syncTask.isFullReconciliation()) {\n+                latestUSyncToken = connector.getLatestSyncToken(ObjectClass.ACCOUNT);\n+            }\n+            SyncToken latestRSyncToken = null;\n+            if (rMapping != null && !syncTask.isFullReconciliation()) {\n+                latestRSyncToken = connector.getLatestSyncToken(ObjectClass.GROUP);\n+            }\n+\n             if (syncTask.isFullReconciliation()) {\n                 if (uMapping != null) {\n                     connector.getAllObjects(ObjectClass.ACCOUNT, handler,\n@@ -420,10 +430,10 @@ protected String executeWithSecurityContext(final boolean dryRun) throws JobExec\n                 try {\n                     ExternalResource resource = resourceDAO.find(syncTask.getResource().getName());\n                     if (uMapping != null) {\n-                        resource.setUsyncToken(connector.getLatestSyncToken(ObjectClass.ACCOUNT));\n+                        resource.setUsyncToken(latestUSyncToken);\n                     }\n                     if (rMapping != null) {\n-                        resource.setRsyncToken(connector.getLatestSyncToken(ObjectClass.GROUP));\n+                        resource.setRsyncToken(latestRSyncToken);\n                     }\n                     resourceDAO.save(resource);\n                 } catch (Exception e) {"}]}