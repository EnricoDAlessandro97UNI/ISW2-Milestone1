{"sha":"98e27bfe1e46643d58fe649aab52d3597d914267","node_id":"MDY6Q29tbWl0NjM2ODc5MDYyOjk4ZTI3YmZlMWU0NjY0M2Q1OGZlNjQ5YWFiNTJkMzU5N2Q5MTQyNjc=","commit":{"author":{"name":"Francesco Chicchiriccò","email":"ilgrosso@apache.org","date":"2017-03-10T12:50:47Z"},"committer":{"name":"Francesco Chicchiriccò","email":"ilgrosso@apache.org","date":"2017-03-10T12:51:12Z"},"message":"[SYNCOPE-1043] Enduser behavior fixed","tree":{"sha":"a5aaab3d8361739b8c5dd911e1a9c41b371a5149","url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/git/trees/a5aaab3d8361739b8c5dd911e1a9c41b371a5149"},"url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/git/commits/98e27bfe1e46643d58fe649aab52d3597d914267","comment_count":0,"verification":{"verified":false,"reason":"unsigned","signature":null,"payload":null}},"url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/98e27bfe1e46643d58fe649aab52d3597d914267","html_url":"https://github.com/EnricoDAlessandro97UNI/syncope/commit/98e27bfe1e46643d58fe649aab52d3597d914267","comments_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/98e27bfe1e46643d58fe649aab52d3597d914267/comments","author":{"login":"ilgrosso","id":1064664,"node_id":"MDQ6VXNlcjEwNjQ2NjQ=","avatar_url":"https://avatars.githubusercontent.com/u/1064664?v=4","gravatar_id":"","url":"https://api.github.com/users/ilgrosso","html_url":"https://github.com/ilgrosso","followers_url":"https://api.github.com/users/ilgrosso/followers","following_url":"https://api.github.com/users/ilgrosso/following{/other_user}","gists_url":"https://api.github.com/users/ilgrosso/gists{/gist_id}","starred_url":"https://api.github.com/users/ilgrosso/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ilgrosso/subscriptions","organizations_url":"https://api.github.com/users/ilgrosso/orgs","repos_url":"https://api.github.com/users/ilgrosso/repos","events_url":"https://api.github.com/users/ilgrosso/events{/privacy}","received_events_url":"https://api.github.com/users/ilgrosso/received_events","type":"User","site_admin":false},"committer":{"login":"ilgrosso","id":1064664,"node_id":"MDQ6VXNlcjEwNjQ2NjQ=","avatar_url":"https://avatars.githubusercontent.com/u/1064664?v=4","gravatar_id":"","url":"https://api.github.com/users/ilgrosso","html_url":"https://github.com/ilgrosso","followers_url":"https://api.github.com/users/ilgrosso/followers","following_url":"https://api.github.com/users/ilgrosso/following{/other_user}","gists_url":"https://api.github.com/users/ilgrosso/gists{/gist_id}","starred_url":"https://api.github.com/users/ilgrosso/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ilgrosso/subscriptions","organizations_url":"https://api.github.com/users/ilgrosso/orgs","repos_url":"https://api.github.com/users/ilgrosso/repos","events_url":"https://api.github.com/users/ilgrosso/events{/privacy}","received_events_url":"https://api.github.com/users/ilgrosso/received_events","type":"User","site_admin":false},"parents":[{"sha":"1a1f7081b571c371167e6854d4cdc2a6fd644a07","url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/1a1f7081b571c371167e6854d4cdc2a6fd644a07","html_url":"https://github.com/EnricoDAlessandro97UNI/syncope/commit/1a1f7081b571c371167e6854d4cdc2a6fd644a07"}],"stats":{"total":36,"additions":17,"deletions":19},"files":[{"sha":"df2f73f34e934eb6533a7ca4c8fb823c0b56fd9d","filename":"client/enduser/src/main/java/org/apache/syncope/client/enduser/SyncopeEnduserSession.java","status":"modified","additions":16,"deletions":17,"changes":33,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/98e27bfe1e46643d58fe649aab52d3597d914267/client%2Fenduser%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fclient%2Fenduser%2FSyncopeEnduserSession.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/98e27bfe1e46643d58fe649aab52d3597d914267/client%2Fenduser%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fclient%2Fenduser%2FSyncopeEnduserSession.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/client%2Fenduser%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fclient%2Fenduser%2FSyncopeEnduserSession.java?ref=98e27bfe1e46643d58fe649aab52d3597d914267","patch":"@@ -18,6 +18,7 @@\n  */\n package org.apache.syncope.client.enduser;\n \n+import java.security.AccessControlException;\n import java.util.List;\n import java.util.Map;\n import java.util.Set;\n@@ -115,6 +116,21 @@ public boolean authenticate(final String username, final String password) {\n         return authenticated;\n     }\n \n+    @Override\n+    public void invalidate() {\n+        if (isAuthenticated()) {\n+            try {\n+                client.logout();\n+            } catch (AccessControlException e) {\n+                LOG.debug(\"Unexpected exception while logging out\", e);\n+            } finally {\n+                client = null;\n+                selfTO = null;\n+            }\n+        }\n+        super.invalidate();\n+    }\n+\n     public <T> T getService(final Class<T> serviceClass) {\n         return (client == null || !isAuthenticated())\n                 ? anonymousClient.getService(serviceClass)\n@@ -159,21 +175,4 @@ public boolean isXsrfTokenGenerated() {\n     public void setXsrfTokenGenerated(final boolean xsrfTokenGenerated) {\n         this.xsrfTokenGenerated = xsrfTokenGenerated;\n     }\n-\n-    @Override\n-    public void invalidate() {\n-        if (isAuthenticated()) {\n-            client.logout();\n-        }\n-        super.invalidate();\n-    }\n-\n-    @Override\n-    public void invalidateNow() {\n-        if (isAuthenticated()) {\n-            client.logout();\n-        }\n-        super.invalidateNow();\n-    }\n-\n }"},{"sha":"952091fabef1448b692f2aed2dc6240443913369","filename":"client/enduser/src/main/java/org/apache/syncope/client/enduser/resources/LogoutResource.java","status":"modified","additions":1,"deletions":2,"changes":3,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/98e27bfe1e46643d58fe649aab52d3597d914267/client%2Fenduser%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fclient%2Fenduser%2Fresources%2FLogoutResource.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/98e27bfe1e46643d58fe649aab52d3597d914267/client%2Fenduser%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fclient%2Fenduser%2Fresources%2FLogoutResource.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/client%2Fenduser%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fclient%2Fenduser%2Fresources%2FLogoutResource.java?ref=98e27bfe1e46643d58fe649aab52d3597d914267","patch":"@@ -26,10 +26,9 @@ public class LogoutResource extends AbstractBaseResource {\n \n     @Override\n     protected ResourceResponse newResourceResponse(final Attributes attributes) {\n-\n         LOG.debug(\"Logout from enduser application\");\n \n-        SyncopeEnduserSession.get().invalidate();\n+        SyncopeEnduserSession.get().invalidateNow();\n \n         ResourceResponse response = new ResourceResponse();\n         response.setStatusCode(204);"}]}