{"sha":"89e4a84be33b5d79d6b4484d334664b42da30243","node_id":"MDY6Q29tbWl0NjM2ODc5MDYyOjg5ZTRhODRiZTMzYjVkNzlkNmI0NDg0ZDMzNDY2NGI0MmRhMzAyNDM=","commit":{"author":{"name":"Unknown","email":"unknown@apache.org","date":"2010-11-10T13:34:48Z"},"committer":{"name":"Unknown","email":"unknown@apache.org","date":"2010-11-10T13:34:48Z"},"message":"Solved a potential conflict when emptying users (workflow)\n\ngit-svn-id: https://svn.apache.org/repos/asf/incubator/syncope/trunk@1246626 13f79535-47bb-0310-9956-ffa450edef68","tree":{"sha":"190a0b77a31607fe6cea1eee40f2846385ae234a","url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/git/trees/190a0b77a31607fe6cea1eee40f2846385ae234a"},"url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/git/commits/89e4a84be33b5d79d6b4484d334664b42da30243","comment_count":0,"verification":{"verified":false,"reason":"unsigned","signature":null,"payload":null}},"url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/89e4a84be33b5d79d6b4484d334664b42da30243","html_url":"https://github.com/EnricoDAlessandro97UNI/syncope/commit/89e4a84be33b5d79d6b4484d334664b42da30243","comments_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/89e4a84be33b5d79d6b4484d334664b42da30243/comments","author":null,"committer":null,"parents":[{"sha":"7732824c3d1ecb83143736cf66af9b036165c4c1","url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/7732824c3d1ecb83143736cf66af9b036165c4c1","html_url":"https://github.com/EnricoDAlessandro97UNI/syncope/commit/7732824c3d1ecb83143736cf66af9b036165c4c1"}],"stats":{"total":11,"additions":9,"deletions":2},"files":[{"sha":"961be71544c0f33e32a52ddc00f1c5f7c1d99b60","filename":"core/src/main/java/org/syncope/core/workflow/EmptyUser.java","status":"modified","additions":9,"deletions":2,"changes":11,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/89e4a84be33b5d79d6b4484d334664b42da30243/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fcore%2Fworkflow%2FEmptyUser.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/89e4a84be33b5d79d6b4484d334664b42da30243/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fcore%2Fworkflow%2FEmptyUser.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fcore%2Fworkflow%2FEmptyUser.java?ref=89e4a84be33b5d79d6b4484d334664b42da30243","patch":"@@ -17,6 +17,7 @@\n import com.opensymphony.module.propertyset.PropertySet;\n import com.opensymphony.workflow.FunctionProvider;\n import com.opensymphony.workflow.WorkflowException;\n+import java.util.HashMap;\n import java.util.HashSet;\n import java.util.Map;\n import java.util.Set;\n@@ -44,10 +45,16 @@ public void execute(Map transientVars, Map args, PropertySet ps)\n \n         final AttributeDAO attributeDAO =\n                 (AttributeDAO) context.getBean(\"attributeDAOImpl\");\n+        final Map<Long, String> attrsToRemove = new HashMap<Long, String>();\n         for (AbstractAttribute attribute : user.getAttributes()) {\n-            attributeDAO.delete(attribute.getId(), UserAttribute.class);\n+            attrsToRemove.put(attribute.getId(),\n+                    attribute.getSchema().getName());\n+        }\n+        for (Long attrId : attrsToRemove.keySet()) {\n+            attributeDAO.delete(attrId, UserAttribute.class);\n+            user.removeAttribute(\n+                    user.getAttribute(attrsToRemove.get(attrId)));\n         }\n-        user.getAttributes().clear();\n \n         final DerivedAttributeDAO derivedAttributeDAO =\n                 (DerivedAttributeDAO) context.getBean("}]}