{"sha":"6896c460fb3f6149221307fa2c27021141b03ad2","node_id":"MDY6Q29tbWl0NjM2ODc5MDYyOjY4OTZjNDYwZmIzZjYxNDkyMjEzMDdmYTJjMjcwMjExNDFiMDNhZDI=","commit":{"author":{"name":"Marco Di Sabatino Di Diodoro","email":"mdisabatino@apache.org","date":"2015-04-13T08:01:57Z"},"committer":{"name":"Marco Di Sabatino Di Diodoro","email":"mdisabatino@apache.org","date":"2015-04-13T08:01:57Z"},"message":"[SYNCOPE-658] Duplicate derived attribute after sync task when it is configured as accountid","tree":{"sha":"25c87eaeaf0cc7d40dafb504ec490e004ab31743","url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/git/trees/25c87eaeaf0cc7d40dafb504ec490e004ab31743"},"url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/git/commits/6896c460fb3f6149221307fa2c27021141b03ad2","comment_count":0,"verification":{"verified":false,"reason":"unsigned","signature":null,"payload":null}},"url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/6896c460fb3f6149221307fa2c27021141b03ad2","html_url":"https://github.com/EnricoDAlessandro97UNI/syncope/commit/6896c460fb3f6149221307fa2c27021141b03ad2","comments_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/6896c460fb3f6149221307fa2c27021141b03ad2/comments","author":{"login":"mdisabatino","id":1792527,"node_id":"MDQ6VXNlcjE3OTI1Mjc=","avatar_url":"https://avatars.githubusercontent.com/u/1792527?v=4","gravatar_id":"","url":"https://api.github.com/users/mdisabatino","html_url":"https://github.com/mdisabatino","followers_url":"https://api.github.com/users/mdisabatino/followers","following_url":"https://api.github.com/users/mdisabatino/following{/other_user}","gists_url":"https://api.github.com/users/mdisabatino/gists{/gist_id}","starred_url":"https://api.github.com/users/mdisabatino/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mdisabatino/subscriptions","organizations_url":"https://api.github.com/users/mdisabatino/orgs","repos_url":"https://api.github.com/users/mdisabatino/repos","events_url":"https://api.github.com/users/mdisabatino/events{/privacy}","received_events_url":"https://api.github.com/users/mdisabatino/received_events","type":"User","site_admin":false},"committer":{"login":"mdisabatino","id":1792527,"node_id":"MDQ6VXNlcjE3OTI1Mjc=","avatar_url":"https://avatars.githubusercontent.com/u/1792527?v=4","gravatar_id":"","url":"https://api.github.com/users/mdisabatino","html_url":"https://github.com/mdisabatino","followers_url":"https://api.github.com/users/mdisabatino/followers","following_url":"https://api.github.com/users/mdisabatino/following{/other_user}","gists_url":"https://api.github.com/users/mdisabatino/gists{/gist_id}","starred_url":"https://api.github.com/users/mdisabatino/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mdisabatino/subscriptions","organizations_url":"https://api.github.com/users/mdisabatino/orgs","repos_url":"https://api.github.com/users/mdisabatino/repos","events_url":"https://api.github.com/users/mdisabatino/events{/privacy}","received_events_url":"https://api.github.com/users/mdisabatino/received_events","type":"User","site_admin":false},"parents":[{"sha":"aea1c879b78630956d5a54fdb7b0449a2df3fcfc","url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/aea1c879b78630956d5a54fdb7b0449a2df3fcfc","html_url":"https://github.com/EnricoDAlessandro97UNI/syncope/commit/aea1c879b78630956d5a54fdb7b0449a2df3fcfc"}],"stats":{"total":28,"additions":11,"deletions":17},"files":[{"sha":"ad3a340d8046c34df9db03f7395fce282da173ee","filename":"core/src/main/java/org/apache/syncope/core/connid/ConnObjectUtil.java","status":"modified","additions":2,"deletions":2,"changes":4,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/6896c460fb3f6149221307fa2c27021141b03ad2/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fconnid%2FConnObjectUtil.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/6896c460fb3f6149221307fa2c27021141b03ad2/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fconnid%2FConnObjectUtil.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Fconnid%2FConnObjectUtil.java?ref=6896c460fb3f6149221307fa2c27021141b03ad2","patch":"@@ -256,8 +256,8 @@ private <T extends AbstractSubjectTO> T getSubjectTOFromConnObject(final Connect\n         final T subjectTO = attrUtil.newSubjectTO();\n \n         // 1. fill with data from connector object\n-        for (AbstractMappingItem item : attrUtil.getUidToMappingItems(syncTask.getResource(),\n-                MappingPurpose.SYNCHRONIZATION, attrUtil.getType())) {\n+        for (AbstractMappingItem item : \n+                attrUtil.getMappingItems(syncTask.getResource(), MappingPurpose.SYNCHRONIZATION)) {\n             Attribute attribute = obj.getAttributeByName(item.getExtAttrName());\n \n             AttributeTO attributeTO;"},{"sha":"9d921e1604fd31fb8b18dab6f308b0b4750929c7","filename":"core/src/main/java/org/apache/syncope/core/util/AttributableUtil.java","status":"modified","additions":0,"deletions":14,"changes":14,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/6896c460fb3f6149221307fa2c27021141b03ad2/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Futil%2FAttributableUtil.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/6896c460fb3f6149221307fa2c27021141b03ad2/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Futil%2FAttributableUtil.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Futil%2FAttributableUtil.java?ref=6896c460fb3f6149221307fa2c27021141b03ad2","patch":"@@ -32,7 +32,6 @@\n import org.apache.syncope.common.types.IntMappingType;\n import org.apache.syncope.common.types.MappingPurpose;\n import org.apache.syncope.common.types.SyncPolicySpec;\n-import org.apache.syncope.common.util.BeanUtils;\n import org.apache.syncope.core.persistence.beans.AbstractAttr;\n import org.apache.syncope.core.persistence.beans.AbstractAttrTemplate;\n import org.apache.syncope.core.persistence.beans.AbstractAttrValue;\n@@ -86,7 +85,6 @@\n import org.apache.syncope.core.persistence.beans.user.UVirSchema;\n import org.apache.syncope.core.sync.SyncCorrelationRule;\n import org.identityconnectors.framework.common.objects.ObjectClass;\n-import org.identityconnectors.framework.common.objects.Uid;\n import org.slf4j.Logger;\n import org.slf4j.LoggerFactory;\n \n@@ -291,18 +289,6 @@ public <T extends AbstractMappingItem> List<T> getMappingItems(\n         return result;\n     }\n \n-    @SuppressWarnings(\"unchecked\")\n-    public <T extends AbstractMappingItem> List<T> getUidToMappingItems(\n-            final ExternalResource resource, final MappingPurpose purpose, final AttributableType type) {\n-        final List<T> items = getMappingItems(resource, MappingPurpose.SYNCHRONIZATION);\n-        final AbstractMappingItem uidItem = type == AttributableType.USER ? new UMappingItem() : new RMappingItem();\n-        BeanUtils.copyProperties(getAccountIdItem(resource), uidItem);\n-        uidItem.setExtAttrName(Uid.NAME);\n-        uidItem.setAccountid(false);\n-        items.add((T) uidItem);\n-        return items;\n-    }\n-\n     public <T extends AbstractMappingItem> Class<T> mappingItemClass() {\n         Class result = null;\n "},{"sha":"ecbebd95c4740e8196be0b19613f81f05c5fff94","filename":"core/src/test/java/org/apache/syncope/core/rest/TaskTestITCase.java","status":"modified","additions":9,"deletions":1,"changes":10,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/6896c460fb3f6149221307fa2c27021141b03ad2/core%2Fsrc%2Ftest%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Frest%2FTaskTestITCase.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/6896c460fb3f6149221307fa2c27021141b03ad2/core%2Fsrc%2Ftest%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Frest%2FTaskTestITCase.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fsrc%2Ftest%2Fjava%2Forg%2Fapache%2Fsyncope%2Fcore%2Frest%2FTaskTestITCase.java?ref=6896c460fb3f6149221307fa2c27021141b03ad2","patch":"@@ -383,7 +383,15 @@ public void sync() throws Exception {\n             assertTrue(userTO.getMemberships().get(0).getAttrMap().containsKey(\"subscriptionDate\"));\n \n             // Unmatching --> Assign (link)\n+            // SYNCOPE-658\n             assertTrue(userTO.getResources().contains(RESOURCE_NAME_CSV));\n+            int counter = 0;\n+            for (AttributeTO attributeTO : userTO.getDerAttrs()) {\n+                if (\"csvuserid\".equals(attributeTO.getSchema())) {\n+                    counter++;\n+                }\n+            }\n+            assertEquals(1, counter);\n \n             userTO = readUser(\"test8\");\n             assertNotNull(userTO);\n@@ -1425,7 +1433,7 @@ public void issueSYNCOPE648() {\n         assertNotNull(notification);\n \n         execSyncTask(actual.getId(), 50, false);\n-        \n+\n         NotificationTaskTO taskTO = findNotificationTaskBySender(\"syncope648@syncope.apache.org\");\n         assertNotNull(taskTO);\n     }"}]}