{"sha":"451f89bf761c39a174e1899963d433c27d5fb6ae","node_id":"MDY6Q29tbWl0NjM2ODc5MDYyOjQ1MWY4OWJmNzYxYzM5YTE3NGUxODk5OTYzZDQzM2MyN2Q1ZmI2YWU=","commit":{"author":{"name":"Matteo Di Carlo","email":"matteo.dicarlo@tirasa.net","date":"2016-08-29T15:32:00Z"},"committer":{"name":"Matteo Di Carlo","email":"matteo.dicarlo@tirasa.net","date":"2016-08-29T15:32:00Z"},"message":"[SYNCOPE-854] show file preview for binary attributes","tree":{"sha":"abb37c3a40d5751e760c1e1b103f2758f8022fa0","url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/git/trees/abb37c3a40d5751e760c1e1b103f2758f8022fa0"},"url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/git/commits/451f89bf761c39a174e1899963d433c27d5fb6ae","comment_count":0,"verification":{"verified":false,"reason":"unsigned","signature":null,"payload":null}},"url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/451f89bf761c39a174e1899963d433c27d5fb6ae","html_url":"https://github.com/EnricoDAlessandro97UNI/syncope/commit/451f89bf761c39a174e1899963d433c27d5fb6ae","comments_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/451f89bf761c39a174e1899963d433c27d5fb6ae/comments","author":null,"committer":null,"parents":[{"sha":"715820744403fcab711e1de531885f762b2a68f2","url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/715820744403fcab711e1de531885f762b2a68f2","html_url":"https://github.com/EnricoDAlessandro97UNI/syncope/commit/715820744403fcab711e1de531885f762b2a68f2"}],"stats":{"total":112,"additions":89,"deletions":23},"files":[{"sha":"9b655f0de86aa0fdabf71c6df497ed8e07c56323","filename":"client/enduser/pom.xml","status":"modified","additions":4,"deletions":0,"changes":4,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/451f89bf761c39a174e1899963d433c27d5fb6ae/client%2Fenduser%2Fpom.xml","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/451f89bf761c39a174e1899963d433c27d5fb6ae/client%2Fenduser%2Fpom.xml","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/client%2Fenduser%2Fpom.xml?ref=451f89bf761c39a174e1899963d433c27d5fb6ae","patch":"@@ -97,6 +97,10 @@ under the License.\n       <groupId>org.webjars.bower</groupId>\n       <artifactId>angular-translate-storage-cookie</artifactId>\n     </dependency>\n+    <dependency>\n+      <groupId>org.webjars.bower</groupId>\n+      <artifactId>bootstrap-fileinput</artifactId>\n+    </dependency>\n     <dependency>\n       <groupId>org.webjars.bower</groupId>\n       <artifactId>ng-password-strength</artifactId>    "},{"sha":"457cb761da00af67d4fbc81da09bc3b5c5ee36e5","filename":"client/enduser/src/main/resources/META-INF/resources/app/index.html","status":"modified","additions":3,"deletions":0,"changes":3,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/451f89bf761c39a174e1899963d433c27d5fb6ae/client%2Fenduser%2Fsrc%2Fmain%2Fresources%2FMETA-INF%2Fresources%2Fapp%2Findex.html","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/451f89bf761c39a174e1899963d433c27d5fb6ae/client%2Fenduser%2Fsrc%2Fmain%2Fresources%2FMETA-INF%2Fresources%2Fapp%2Findex.html","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/client%2Fenduser%2Fsrc%2Fmain%2Fresources%2FMETA-INF%2Fresources%2Fapp%2Findex.html?ref=451f89bf761c39a174e1899963d433c27d5fb6ae","patch":"@@ -80,6 +80,8 @@\n   <script src=\"../webjars/angular-translate/${angular-translate.version}/angular-translate.js\"></script>\n   <script src=\"../webjars/angular-translate-loader-partial/${angular-translate.version}/angular-translate-loader-partial.js\"></script>\n   <script src=\"../webjars/angular-translate-storage-cookie/${angular-translate.version}/angular-translate-storage-cookie.js\"></script>\n+  <script src=\"../webjars/bootstrap-fileinput/${bootstrap-fileinput.version}/js/fileinput.js\"></script>\n+\n   <!--main angular application-->\n   <script src=\"js/app.js\"></script>\n   <!--services-->\n@@ -113,6 +115,7 @@\n   <script src=\"js/directives/auxClasses.js\"></script>\n   <script src=\"js/directives/validate.js\"></script>\n   <script src=\"js/directives/validationMessage.js\"></script>\n+  <script src=\"js/directives/fileInput.js\"></script>\n   <!--validator-->\n   <script src=\"js/validator/validationRules.js\"></script>\n   <script src=\"js/validator/validationExecutor.js\"></script>"},{"sha":"40d9fadf42960091ec6e65c57c3656e8a6e12c32","filename":"client/enduser/src/main/resources/META-INF/resources/app/js/directives/dynamicPlainAttribute.js","status":"modified","additions":9,"deletions":10,"changes":19,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/451f89bf761c39a174e1899963d433c27d5fb6ae/client%2Fenduser%2Fsrc%2Fmain%2Fresources%2FMETA-INF%2Fresources%2Fapp%2Fjs%2Fdirectives%2FdynamicPlainAttribute.js","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/451f89bf761c39a174e1899963d433c27d5fb6ae/client%2Fenduser%2Fsrc%2Fmain%2Fresources%2FMETA-INF%2Fresources%2Fapp%2Fjs%2Fdirectives%2FdynamicPlainAttribute.js","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/client%2Fenduser%2Fsrc%2Fmain%2Fresources%2FMETA-INF%2Fresources%2Fapp%2Fjs%2Fdirectives%2FdynamicPlainAttribute.js?ref=451f89bf761c39a174e1899963d433c27d5fb6ae","patch":"@@ -18,7 +18,6 @@\n  */\n \n 'use strict';\n-\n angular.module('self')\n         .directive('dynamicPlainAttribute', function ($filter) {\n           return {\n@@ -39,8 +38,9 @@ angular.module('self')\n                     break;\n                   case \"Enum\":\n                     $scope.enumerationValues = [];\n+\n                     //SYNCOPE-911 empty value option on non required attributes \n-                    if(schema.mandatoryCondition != \"true\"){\n+                    if (schema.mandatoryCondition !== \"true\") {\n                       $scope.enumerationValues.push(\"\");\n                     }\n                     var enumerationValuesSplitted = schema.enumerationValues.toString().split(\";\");\n@@ -50,6 +50,7 @@ angular.module('self')\n                     $scope.user.plainAttrs[schema.key].values[index] = $scope.user.plainAttrs[schema.key].values[index]\n                             || $scope.enumerationValues[0];\n                     break;\n+\n                   case \"Binary\":\n                     $scope.userFile = $scope.userFile || '';\n                     $element.bind(\"change\", function (changeEvent) {\n@@ -67,22 +68,20 @@ angular.module('self')\n \n                     $scope.download = function () {\n                       var byteString = atob($scope.user.plainAttrs[schema.key].values[index]);\n-\n                       var ab = new ArrayBuffer(byteString.length);\n                       var ia = new Uint8Array(ab);\n                       for (var i = 0; i < byteString.length; i++) {\n                         ia[i] = byteString.charCodeAt(i);\n                       }\n-\n                       var blob = new Blob([ia], {type: schema.mimeType});\n-\n                       saveAs(blob, schema.key);\n                     };\n-                    $scope.remove = function () {\n+\n+                    //file upload and preview                    \n+                    $('#fileInput').on('fileclear', function () {\n                       $scope.user.plainAttrs[schema.key].values.splice(index, 1);\n-                      $scope.userFile = '';\n-                      $(\"#fileInput\").replaceWith($(\"#fileInput\").clone(true));\n-                    };\n+                    });\n+                    $scope.previewImg = $scope.user.plainAttrs[schema.key].values[index];\n                     break;\n \n                   case \"Date\":\n@@ -189,7 +188,7 @@ angular.module('self')\n \n                   case \"Boolean\":\n                     $scope.user.plainAttrs[schema.key].values[index] =\n-                            $scope.user.plainAttrs[schema.key].values[index] == \"true\" ? true : false;\n+                            $scope.user.plainAttrs[schema.key].values[index] === \"true\" ? true : false;\n                     break;\n \n                 }"},{"sha":"130a2e4439462487f3db5daf64551face516a74e","filename":"client/enduser/src/main/resources/META-INF/resources/app/js/directives/fileInput.js","status":"added","additions":55,"deletions":0,"changes":55,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/451f89bf761c39a174e1899963d433c27d5fb6ae/client%2Fenduser%2Fsrc%2Fmain%2Fresources%2FMETA-INF%2Fresources%2Fapp%2Fjs%2Fdirectives%2FfileInput.js","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/451f89bf761c39a174e1899963d433c27d5fb6ae/client%2Fenduser%2Fsrc%2Fmain%2Fresources%2FMETA-INF%2Fresources%2Fapp%2Fjs%2Fdirectives%2FfileInput.js","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/client%2Fenduser%2Fsrc%2Fmain%2Fresources%2FMETA-INF%2Fresources%2Fapp%2Fjs%2Fdirectives%2FfileInput.js?ref=451f89bf761c39a174e1899963d433c27d5fb6ae","patch":"@@ -0,0 +1,55 @@\n+/* \n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *   http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+'use strict';\n+angular.module('self')\n+        .directive('fileInput', function () {\n+          return {\n+            restrict: 'A',\n+            link: function ($scope, element, attrs) {\n+              var previewImgComposite;\n+              if ($scope.previewImg) {\n+                previewImgComposite = \"data:image/png;base64,\" + $scope.previewImg;\n+              } else\n+                previewImgComposite = null;\n+              $(element).fileinput({\n+                showUpload: false,\n+                showCaption: false,\n+                showCancel: false,\n+                showClose: true,\n+                showRemove: false,\n+                fileActionSettings: {'showZoom': false, indicatorNew: '', 'removeTitle': 'boh'},\n+                removeClass: \"btn btn-default\",\n+                browseClass: \"btn btn-default\",\n+                browseLabel: '',\n+                dragIcon: '',\n+                browseIcon: '',\n+                initialPreviewAsData: true,\n+                overwriteInitial: true,\n+//                maxFileCount: 1,\n+//                'previewFileType': 'any',\n+                initialPreview: [\n+                  previewImgComposite\n+                ],\n+                'maxFileSize': 5120\n+              });\n+            }\n+          };\n+        });\n+        \n\\ No newline at end of file"},{"sha":"654c0de48b1a4350115865976dfd78e9a307fcef","filename":"client/enduser/src/main/resources/META-INF/resources/app/views/dynamicPlainAttribute.html","status":"modified","additions":10,"deletions":13,"changes":23,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/451f89bf761c39a174e1899963d433c27d5fb6ae/client%2Fenduser%2Fsrc%2Fmain%2Fresources%2FMETA-INF%2Fresources%2Fapp%2Fviews%2FdynamicPlainAttribute.html","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/451f89bf761c39a174e1899963d433c27d5fb6ae/client%2Fenduser%2Fsrc%2Fmain%2Fresources%2FMETA-INF%2Fresources%2Fapp%2Fviews%2FdynamicPlainAttribute.html","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/client%2Fenduser%2Fsrc%2Fmain%2Fresources%2FMETA-INF%2Fresources%2Fapp%2Fviews%2FdynamicPlainAttribute.html?ref=451f89bf761c39a174e1899963d433c27d5fb6ae","patch":"@@ -72,22 +72,19 @@\n   </div>\n \n   <div ng-switch-when=\"Binary\" ng-init=\"initAttribute(schema, index)\">\n-    <!--<div enctype=\"multipart/form-data\" accept-charset=\"UTF-8\">-->\n-    <div >\n-      <input id=\"fileInput\" type=\"file\" ng-required=\"{{schema.mandatoryCondition}}\"/>\n-      <button type=\"button\" title=\"Download file\" class=\"fileButton btn btn-default btn-sm\" ng-click=\"download()\">\n-        <i class=\"glyphicon glyphicon-download\" ></i>\n-      </button>\n-      <button type=\"button\" class=\"fileButton btn btn-default btn-sm\" title=\"Remove file\" ng-click=\"remove()\">\n-        <i class=\"glyphicon glyphicon-remove-sign\" ></i>\n-      </button>\n-      <h4><span class=\"label label-primary\" ng-model=\"userFile\">{{userFile}}</span></h4>\n-    </div>\n-\n+    <input file-input type=\"file\" id=\"fileInput\" name=\"fileInput\">\n+    <button type=\"button\" title=\"Download file\" class=\"fileButton btn btn-default btn-sm\" ng-click=\"download()\">\n+      <i class=\"glyphicon glyphicon-download\" ></i>\n+    </button>\n   </div>\n+\n   <input ng-switch-default class=\"form-control\" type=\"text\"\n          ng-model=\"user.plainAttrs[schema.key].values[index]\"\n          ng-required=\"{{schema.mandatoryCondition}}\" \n          ng-disabled=\"schema.readonly\" ng-init=\"initAttribute(schema, index)\"/>\n-\n </div>\n+\n+\n+\n+\n+"},{"sha":"73ebfe8c0f513010f520c70c00f1fc73f6153721","filename":"pom.xml","status":"modified","additions":8,"deletions":0,"changes":8,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/451f89bf761c39a174e1899963d433c27d5fb6ae/pom.xml","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/451f89bf761c39a174e1899963d433c27d5fb6ae/pom.xml","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/pom.xml?ref=451f89bf761c39a174e1899963d433c27d5fb6ae","patch":"@@ -420,6 +420,7 @@ under the License.\n     <angular-ui-select.version>0.17.1</angular-ui-select.version>\n     <angular-treasure-overlay-spinner.version>1.1.0</angular-treasure-overlay-spinner.version>\n     <angular-translate.version>2.11.1</angular-translate.version>\n+    <bootstrap-fileinput.version>4.3.4</bootstrap-fileinput.version>\n     \n     <ng-password-strength.version>0.2.1</ng-password-strength.version>\n     <lodash.version>4.15.0</lodash.version>\n@@ -1218,6 +1219,13 @@ under the License.\n         <artifactId>angular-translate-storage-cookie</artifactId>\n         <version>${angular-translate.version}</version>\n       </dependency>      \n+\n+      <dependency>\n+        <groupId>org.webjars.bower</groupId>\n+        <artifactId>bootstrap-fileinput</artifactId>\n+        <version>${bootstrap-fileinput.version}</version>\n+      </dependency>      \n+\n       <dependency>\n         <groupId>org.webjars.bower</groupId>\n         <artifactId>ng-password-strength</artifactId>"}]}