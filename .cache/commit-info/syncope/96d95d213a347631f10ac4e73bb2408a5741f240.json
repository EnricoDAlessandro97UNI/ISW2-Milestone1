{"sha":"96d95d213a347631f10ac4e73bb2408a5741f240","node_id":"MDY6Q29tbWl0NjM2ODc5MDYyOjk2ZDk1ZDIxM2EzNDc2MzFmMTBhYzRlNzNiYjI0MDhhNTc0MWYyNDA=","commit":{"author":{"name":"Andrea Patricelli","email":"andreapatricelli@apache.org","date":"2017-04-13T11:11:53Z"},"committer":{"name":"Andrea Patricelli","email":"andreapatricelli@apache.org","date":"2017-04-13T12:16:47Z"},"message":"[SYNCOPE-1058] datetime picker shown only if format contains time","tree":{"sha":"4656bf8ee978d16c1cfdb50b3d88f599724db846","url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/git/trees/4656bf8ee978d16c1cfdb50b3d88f599724db846"},"url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/git/commits/96d95d213a347631f10ac4e73bb2408a5741f240","comment_count":0,"verification":{"verified":false,"reason":"unsigned","signature":null,"payload":null}},"url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/96d95d213a347631f10ac4e73bb2408a5741f240","html_url":"https://github.com/EnricoDAlessandro97UNI/syncope/commit/96d95d213a347631f10ac4e73bb2408a5741f240","comments_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/96d95d213a347631f10ac4e73bb2408a5741f240/comments","author":{"login":"andrea-patricelli","id":3763111,"node_id":"MDQ6VXNlcjM3NjMxMTE=","avatar_url":"https://avatars.githubusercontent.com/u/3763111?v=4","gravatar_id":"","url":"https://api.github.com/users/andrea-patricelli","html_url":"https://github.com/andrea-patricelli","followers_url":"https://api.github.com/users/andrea-patricelli/followers","following_url":"https://api.github.com/users/andrea-patricelli/following{/other_user}","gists_url":"https://api.github.com/users/andrea-patricelli/gists{/gist_id}","starred_url":"https://api.github.com/users/andrea-patricelli/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/andrea-patricelli/subscriptions","organizations_url":"https://api.github.com/users/andrea-patricelli/orgs","repos_url":"https://api.github.com/users/andrea-patricelli/repos","events_url":"https://api.github.com/users/andrea-patricelli/events{/privacy}","received_events_url":"https://api.github.com/users/andrea-patricelli/received_events","type":"User","site_admin":false},"committer":{"login":"andrea-patricelli","id":3763111,"node_id":"MDQ6VXNlcjM3NjMxMTE=","avatar_url":"https://avatars.githubusercontent.com/u/3763111?v=4","gravatar_id":"","url":"https://api.github.com/users/andrea-patricelli","html_url":"https://github.com/andrea-patricelli","followers_url":"https://api.github.com/users/andrea-patricelli/followers","following_url":"https://api.github.com/users/andrea-patricelli/following{/other_user}","gists_url":"https://api.github.com/users/andrea-patricelli/gists{/gist_id}","starred_url":"https://api.github.com/users/andrea-patricelli/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/andrea-patricelli/subscriptions","organizations_url":"https://api.github.com/users/andrea-patricelli/orgs","repos_url":"https://api.github.com/users/andrea-patricelli/repos","events_url":"https://api.github.com/users/andrea-patricelli/events{/privacy}","received_events_url":"https://api.github.com/users/andrea-patricelli/received_events","type":"User","site_admin":false},"parents":[{"sha":"ed3d3c572b7fa2e7ab8793d393a54ded1c085fe5","url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/ed3d3c572b7fa2e7ab8793d393a54ded1c085fe5","html_url":"https://github.com/EnricoDAlessandro97UNI/syncope/commit/ed3d3c572b7fa2e7ab8793d393a54ded1c085fe5"}],"stats":{"total":85,"additions":55,"deletions":30},"files":[{"sha":"18e1be3d9a73d658c22a3d93b1dd99aef533f27f","filename":"client/console/src/main/java/org/apache/syncope/client/console/panels/ParametersDetailsPanel.java","status":"modified","additions":6,"deletions":4,"changes":10,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/96d95d213a347631f10ac4e73bb2408a5741f240/client%2Fconsole%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fclient%2Fconsole%2Fpanels%2FParametersDetailsPanel.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/96d95d213a347631f10ac4e73bb2408a5741f240/client%2Fconsole%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fclient%2Fconsole%2Fpanels%2FParametersDetailsPanel.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/client%2Fconsole%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fclient%2Fconsole%2Fpanels%2FParametersDetailsPanel.java?ref=96d95d213a347631f10ac4e73bb2408a5741f240","patch":"@@ -18,9 +18,11 @@\n  */\n package org.apache.syncope.client.console.panels;\n \n+import java.text.SimpleDateFormat;\n import java.util.Arrays;\n import java.util.Date;\n import java.util.List;\n+import org.apache.commons.lang3.StringUtils;\n import org.apache.syncope.client.console.commons.SchemaUtils;\n import org.apache.syncope.client.console.rest.SchemaRestClient;\n import org.apache.syncope.client.console.wicket.markup.html.form.AjaxDropDownChoicePanel;\n@@ -81,14 +83,14 @@ private Panel getFieldPanel(final String id, final AttrTO attrTO) {\n         final FieldPanel panel;\n         switch (schemaTO.getType()) {\n             case Date:\n-                final String dataPattern = schemaTO.getConversionPattern() == null\n+                final String datePattern = schemaTO.getConversionPattern() == null\n                         ? SyncopeConstants.DEFAULT_DATE_PATTERN\n                         : schemaTO.getConversionPattern();\n \n-                if (dataPattern.contains(\"H\")) {\n-                    panel = new AjaxDateTimeFieldPanel(\"panel\", schemaTO.getKey(), new Model<Date>(), dataPattern);\n+                if (StringUtils.containsIgnoreCase(datePattern, \"H\")) {\n+                    panel = new AjaxDateTimeFieldPanel(\"panel\", schemaTO.getKey(), new Model<Date>(), datePattern);\n                 } else {\n-                    panel = new AjaxDateFieldPanel(\"panel\", schemaTO.getKey(), new Model<Date>(), dataPattern);\n+                    panel = new AjaxDateFieldPanel(\"panel\", schemaTO.getKey(), new Model<Date>(), datePattern);\n                 }\n                 break;\n             case Boolean:"},{"sha":"8ccaa0205a90cd9f3d2eeb2e09d4bccef01115b0","filename":"client/enduser/src/main/resources/META-INF/resources/app/js/directives/dynamicPlainAttribute.js","status":"modified","additions":9,"deletions":8,"changes":17,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/96d95d213a347631f10ac4e73bb2408a5741f240/client%2Fenduser%2Fsrc%2Fmain%2Fresources%2FMETA-INF%2Fresources%2Fapp%2Fjs%2Fdirectives%2FdynamicPlainAttribute.js","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/96d95d213a347631f10ac4e73bb2408a5741f240/client%2Fenduser%2Fsrc%2Fmain%2Fresources%2FMETA-INF%2Fresources%2Fapp%2Fjs%2Fdirectives%2FdynamicPlainAttribute.js","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/client%2Fenduser%2Fsrc%2Fmain%2Fresources%2FMETA-INF%2Fresources%2Fapp%2Fjs%2Fdirectives%2FdynamicPlainAttribute.js?ref=96d95d213a347631f10ac4e73bb2408a5741f240","patch":"@@ -100,19 +100,20 @@ angular.module('self')\n                     $scope.isDate = function (x) {\n                       return x instanceof Date;\n                     };\n-\n-                    var dateInMs = $scope.user.plainAttrs[schema.key].values[index];\n-                    var temporaryDate = new Date(dateInMs * 1);\n-                    $scope.selectedDate = temporaryDate;\n                     $scope.languageid = $rootScope.languages.selectedLanguage.id;\n-                    $scope.languageFormat = $rootScope.languages.selectedLanguage.format;\n+                    $scope.isDateOnly = schema.conversionPattern.indexOf(\"H\") === -1\n+                            && schema.conversionPattern.indexOf(\"h\") === -1;\n+                    $scope.languageFormat = $scope.isDateOnly\n+                            ? $rootScope.languages.selectedLanguage.format.replace(\" HH:mm\", \"\")\n+                            : $rootScope.languages.selectedLanguage.format;\n                     $scope.languageCulture = $rootScope.languages.selectedLanguage.culture;\n+                    // read date in milliseconds\n+                    $scope.selectedDate = new Date($scope.user.plainAttrs[schema.key].values[index] * 1);\n \n                     $scope.bindDateToModel = function (selectedDate, extendedDate) {\n                       if (selectedDate) {\n-                        var tmpdate = new Date(extendedDate);\n-                        var milliseconds = tmpdate.getTime();\n-                        $scope.user.plainAttrs[schema.key].values[index] = milliseconds;\n+                        // save date in milliseconds\n+                        $scope.user.plainAttrs[schema.key].values[index] = new Date(extendedDate).getTime();\n                       }\n                     };\n                     break;"},{"sha":"e7b5bcc90ac0c0f0f27c4f3ad39baab77e1a4c9b","filename":"client/enduser/src/main/resources/META-INF/resources/app/views/dynamicPlainAttribute.html","status":"modified","additions":40,"deletions":18,"changes":58,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/96d95d213a347631f10ac4e73bb2408a5741f240/client%2Fenduser%2Fsrc%2Fmain%2Fresources%2FMETA-INF%2Fresources%2Fapp%2Fviews%2FdynamicPlainAttribute.html","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/96d95d213a347631f10ac4e73bb2408a5741f240/client%2Fenduser%2Fsrc%2Fmain%2Fresources%2FMETA-INF%2Fresources%2Fapp%2Fviews%2FdynamicPlainAttribute.html","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/client%2Fenduser%2Fsrc%2Fmain%2Fresources%2FMETA-INF%2Fresources%2Fapp%2Fviews%2FdynamicPlainAttribute.html?ref=96d95d213a347631f10ac4e73bb2408a5741f240","patch":"@@ -20,7 +20,9 @@\n   <input ng-switch-when=\"String\" class=\"form-control\" type=\"text\"\n          ng-model=\"user.plainAttrs[schema.key].values[index]\"\n          ng-required=\"{{schema.mandatoryCondition}}\" validate=\"true\"\n-         ng-disabled=\"schema.readonly || customReadonly(schema.key)\" ng-init=\"initAttribute(schema, index)\" name=\"{{schema.key}}\"/>\n+         ng-disabled=\"schema.readonly || customReadonly(schema.key)\"\n+         ng-init=\"initAttribute(schema, index)\"\n+         name=\"{{schema.key}}\"/>\n \n   <div ng-switch-when=\"Encrypted\" class=\"input-group input-group-sm\">\n     <span class=\"input-group-btn\" ng-disabled=\"schema.readonly || customReadonly(schema.key)\">  \n@@ -73,27 +75,46 @@\n            ng-required=\"{{schema.mandatoryCondition}}\"\n            ng-disabled=\"schema.readonly || customReadonly(schema.key)\"\n            ng-init=\"initAttribute(schema, index)\" />\n-    </div>\n+</div>\n \n-    <input ng-switch-when=\"Long\" class=\"form-control\" type=\"number\" ng-model=\"user.plainAttrs[schema.key].values[index]\" \n-           ng-required=\"{{schema.mandatoryCondition}}\" validate=\"true\"\n-           ng-init=\"initAttribute(schema, index)\" name=\"{{schema.key}}\"/>\n+<input ng-switch-when=\"Long\" class=\"form-control\"\n+           type=\"number\"\n+           ng-model=\"user.plainAttrs[schema.key].values[index]\" \n+           ng-required=\"{{schema.mandatoryCondition}}\"\n+           ng-disabled=\"schema.readonly || customReadonly(schema.key)\"\n+           validate=\"true\"\n+           ng-init=\"initAttribute(schema, index)\"\n+           name=\"{{schema.key}}\"/>\n \n-    <input ng-switch-when=\"Double\" class=\"form-control\" type=\"number\" ng-model=\"user.plainAttrs[schema.key].values[index]\"\n+<input ng-switch-when=\"Double\" class=\"form-control\" type=\"number\" ng-model=\"user.plainAttrs[schema.key].values[index]\"\n            ng-required=\"{{schema.mandatoryCondition}}\" validate=\"true\"\n+           ng-disabled=\"schema.readonly || customReadonly(schema.key)\"\n            ng-init=\"initAttribute(schema, index)\" name=\"{{schema.key}}\"/>\n \n-    <div ng-switch-when=\"Date\" id=\"date\">\n-      <input type=\"text\" class=\"dateTimePicker\"\n-             id=\"dateTimePicker\"\n-             kendo-date-time-picker\n-             ng-model=\"extendedDate\"\n-             ng-required=\"{{schema.mandatoryCondition}}\" close-text=\"Close\"\n-             ng-init=\"initAttribute(schema, index)\"\n-             ng-change=\"bindDateToModel(selectedDate, extendedDate)\"\n-             ng-disabled=\"schema.readonly || customReadonly(schema.key)\"\n-             k-ng-model=\"selectedDate\"\n-             data-k-format=languageFormat \n+<div ng-switch-when=\"Date\" id=\"date\">\n+<input type=\"text\" class=\"dateTimePicker\"\n+       id=\"dateTimePicker\"\n+       kendo-date-time-picker\n+       ng-show=\"!isDateOnly\"\n+       ng-model=\"extendedDate\"\n+       ng-required=\"{{schema.mandatoryCondition}}\" close-text=\"Close\"\n+       ng-init=\"initAttribute(schema, index)\"\n+       ng-change=\"bindDateToModel(selectedDate, extendedDate)\"\n+ng-disabled=\"schema.readonly || customReadonly(schema.key)\"\n+k-ng-model=\"selectedDate\"\n+data-k-format=\"languageFormat\"\n+/>\n+<input type=\"text\" class=\"datePicker\"\n+       id=\"datePicker\"\n+       kendo-date-picker\n+       ng-show=\"isDateOnly\"\n+       ng-model=\"extendedDate\"\n+       ng-required=\"{{schema.mandatoryCondition}}\" close-text=\"Close\"\n+       ng-init=\"initAttribute(schema, index)\"\n+       ng-change=\"bindDateToModel(selectedDate, extendedDate)\"\n+       ng-disabled=\"schema.readonly || customReadonly(schema.key)\"\n+       k-ng-model=\"selectedDate\"\n+       data-k-format=\"languageFormat\"\n              />\n     </div>\n \n@@ -120,7 +141,8 @@\n     <input ng-switch-default class=\"form-control\" type=\"text\"\n            ng-model=\"user.plainAttrs[schema.key].values[index]\"\n            ng-required=\"{{schema.mandatoryCondition}}\" \n-           ng-disabled=\"schema.readonly || customReadonly(schema.key)\" ng-init=\"initAttribute(schema, index)\"/>\n+           ng-disabled=\"schema.readonly || customReadonly(schema.key)\"\n+           ng-init=\"initAttribute(schema, index)\"/>\n   </div>\n \n "}]}