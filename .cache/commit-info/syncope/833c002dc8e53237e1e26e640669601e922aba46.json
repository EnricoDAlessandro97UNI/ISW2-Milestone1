{"sha":"833c002dc8e53237e1e26e640669601e922aba46","node_id":"MDY6Q29tbWl0NjM2ODc5MDYyOjgzM2MwMDJkYzhlNTMyMzdlMWUyNmU2NDA2Njk2MDFlOTIyYWJhNDY=","commit":{"author":{"name":"Misagh Moayyed","email":"misagh.moayyed@gmail.com","date":"2021-04-23T10:04:50Z"},"committer":{"name":"GitHub","email":"noreply@github.com","date":"2021-04-23T10:04:50Z"},"message":"Switch to CAS 6.4 (#258)\n\n* switch to rc3\r\n\r\n* fix issues with startup and saml metadata\r\n\r\n* switch to snapshot with test fixes\r\n\r\n* update properties for webauthn namespace\r\n\r\n* Trigger build with an update\r\n\r\n* fix tests\r\n\r\n* add test case for saml2 sp metadata\r\n\r\n* re-adjust test assertion for saml2 sp metadata\r\n\r\n* update pac4j\r\n\r\n* replace base64 class with that of JDK's\r\n\r\n* wip: remove exclusion rules to fix tests","tree":{"sha":"a34350cd69d56011942b8fe5062638c7bf775750","url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/git/trees/a34350cd69d56011942b8fe5062638c7bf775750"},"url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/git/commits/833c002dc8e53237e1e26e640669601e922aba46","comment_count":0,"verification":{"verified":true,"reason":"valid","signature":"-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJggpvCCRBK7hj4Ov3rIwAA6CoIAKDAOWpqiFlubVg5G8okbOYF\nbaA60knQBkwv9UVk37wkrpO06Zw1vl1l0UykcH4uH+0MJha7MtrBbOEJsBuUfb6P\n6Z7Qk2a5bEreH6YXV6L9IgesB8F4bM7/2bAHLhYZFWuVSqjEimrZApzLPA4VYuss\nuv9JHD4+J0tgSK4keR7wanENDbX415N2buswxKJ9oPEIExUa6+o3fSzAI5El446m\nzwcCoJjpH6Gg4bWxtJJiuIexwRpnRdcyWyUE9PxUDFi/BLu1kRBgMQ/1xOLabIYs\nemy92kzffPeoBwfmwKpf08GIeEFnQ9OQIV0ZNs4DSavltJoXr7hzpQiwqRJ2vlo=\n=jBhu\n-----END PGP SIGNATURE-----\n","payload":"tree a34350cd69d56011942b8fe5062638c7bf775750\nparent bceb405408520d367c59f61c74997ebb0eb61485\nauthor Misagh Moayyed <misagh.moayyed@gmail.com> 1619172290 +0430\ncommitter GitHub <noreply@github.com> 1619172290 +0430\n\nSwitch to CAS 6.4 (#258)\n\n* switch to rc3\r\n\r\n* fix issues with startup and saml metadata\r\n\r\n* switch to snapshot with test fixes\r\n\r\n* update properties for webauthn namespace\r\n\r\n* Trigger build with an update\r\n\r\n* fix tests\r\n\r\n* add test case for saml2 sp metadata\r\n\r\n* re-adjust test assertion for saml2 sp metadata\r\n\r\n* update pac4j\r\n\r\n* replace base64 class with that of JDK's\r\n\r\n* wip: remove exclusion rules to fix tests"}},"url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/833c002dc8e53237e1e26e640669601e922aba46","html_url":"https://github.com/EnricoDAlessandro97UNI/syncope/commit/833c002dc8e53237e1e26e640669601e922aba46","comments_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/833c002dc8e53237e1e26e640669601e922aba46/comments","author":{"login":"mmoayyed","id":1205228,"node_id":"MDQ6VXNlcjEyMDUyMjg=","avatar_url":"https://avatars.githubusercontent.com/u/1205228?v=4","gravatar_id":"","url":"https://api.github.com/users/mmoayyed","html_url":"https://github.com/mmoayyed","followers_url":"https://api.github.com/users/mmoayyed/followers","following_url":"https://api.github.com/users/mmoayyed/following{/other_user}","gists_url":"https://api.github.com/users/mmoayyed/gists{/gist_id}","starred_url":"https://api.github.com/users/mmoayyed/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mmoayyed/subscriptions","organizations_url":"https://api.github.com/users/mmoayyed/orgs","repos_url":"https://api.github.com/users/mmoayyed/repos","events_url":"https://api.github.com/users/mmoayyed/events{/privacy}","received_events_url":"https://api.github.com/users/mmoayyed/received_events","type":"User","site_admin":false},"committer":{"login":"web-flow","id":19864447,"node_id":"MDQ6VXNlcjE5ODY0NDQ3","avatar_url":"https://avatars.githubusercontent.com/u/19864447?v=4","gravatar_id":"","url":"https://api.github.com/users/web-flow","html_url":"https://github.com/web-flow","followers_url":"https://api.github.com/users/web-flow/followers","following_url":"https://api.github.com/users/web-flow/following{/other_user}","gists_url":"https://api.github.com/users/web-flow/gists{/gist_id}","starred_url":"https://api.github.com/users/web-flow/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/web-flow/subscriptions","organizations_url":"https://api.github.com/users/web-flow/orgs","repos_url":"https://api.github.com/users/web-flow/repos","events_url":"https://api.github.com/users/web-flow/events{/privacy}","received_events_url":"https://api.github.com/users/web-flow/received_events","type":"User","site_admin":false},"parents":[{"sha":"bceb405408520d367c59f61c74997ebb0eb61485","url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/bceb405408520d367c59f61c74997ebb0eb61485","html_url":"https://github.com/EnricoDAlessandro97UNI/syncope/commit/bceb405408520d367c59f61c74997ebb0eb61485"}],"stats":{"total":59,"additions":34,"deletions":25},"files":[{"sha":"5d0cd5c22e749e611a9e8bb5df3607a7e624332b","filename":"fit/wa-reference/src/main/resources/wa.properties","status":"modified","additions":4,"deletions":4,"changes":8,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/833c002dc8e53237e1e26e640669601e922aba46/fit%2Fwa-reference%2Fsrc%2Fmain%2Fresources%2Fwa.properties","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/833c002dc8e53237e1e26e640669601e922aba46/fit%2Fwa-reference%2Fsrc%2Fmain%2Fresources%2Fwa.properties","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/fit%2Fwa-reference%2Fsrc%2Fmain%2Fresources%2Fwa.properties?ref=833c002dc8e53237e1e26e640669601e922aba46","patch":"@@ -54,9 +54,9 @@ springdoc.model-and-view-allowed=true\n springdoc.writer-with-default-pretty-printer=true\n springdoc.swagger-ui.displayRequestDuration=true\n \n-cas.authn.mfa.web-authn.allowed-origins=${cas.server.name}\n-cas.authn.mfa.web-authn.application-id=https://localhost:8443\n-cas.authn.mfa.web-authn.relying-party-name=Syncope \n-cas.authn.mfa.web-authn.relying-party-id=syncope.apache.org\n+cas.authn.mfa.web-authn.core.allowed-origins=${cas.server.name}\n+cas.authn.mfa.web-authn.core.application-id=https://localhost:8443\n+cas.authn.mfa.web-authn.core.relying-party-name=Syncope \n+cas.authn.mfa.web-authn.core.relying-party-id=syncope.apache.org\n \n cas.authn.syncope.url=${cas.server.name}/syncope/rest/"},{"sha":"24115ea5246101132a6ba30a0ad0cb525c7a1f35","filename":"fit/wa-reference/src/test/java/org/apache/syncope/fit/ui/SAML2SP4UIITCase.java","status":"modified","additions":16,"deletions":0,"changes":16,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/833c002dc8e53237e1e26e640669601e922aba46/fit%2Fwa-reference%2Fsrc%2Ftest%2Fjava%2Forg%2Fapache%2Fsyncope%2Ffit%2Fui%2FSAML2SP4UIITCase.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/833c002dc8e53237e1e26e640669601e922aba46/fit%2Fwa-reference%2Fsrc%2Ftest%2Fjava%2Forg%2Fapache%2Fsyncope%2Ffit%2Fui%2FSAML2SP4UIITCase.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/fit%2Fwa-reference%2Fsrc%2Ftest%2Fjava%2Forg%2Fapache%2Fsyncope%2Ffit%2Fui%2FSAML2SP4UIITCase.java?ref=833c002dc8e53237e1e26e640669601e922aba46","patch":"@@ -20,6 +20,7 @@\n \n import static org.junit.jupiter.api.Assertions.assertEquals;\n import static org.junit.jupiter.api.Assertions.assertTrue;\n+import static org.junit.jupiter.api.Assertions.assertFalse;\n import static org.junit.jupiter.api.Assertions.fail;\n \n import java.io.IOException;\n@@ -54,6 +55,7 @@\n import org.apache.syncope.common.lib.types.SAML2SPNameId;\n import org.apache.syncope.common.rest.api.RESTHeaders;\n import org.junit.jupiter.api.BeforeAll;\n+import org.junit.jupiter.api.Test;\n \n public class SAML2SP4UIITCase extends AbstractUIITCase {\n \n@@ -156,6 +158,20 @@ public static void idpSetup() {\n         saml2sp4UIIdPService.update(cas);\n     }\n \n+    @Test\n+    public void fetchSpMetadata() throws Exception {\n+        try (CloseableHttpClient httpclient = HttpClients.createDefault()) {\n+            HttpClientContext context = HttpClientContext.create();\n+            context.setCookieStore(new BasicCookieStore());\n+\n+            HttpGet get = new HttpGet(WA_ADDRESS + \"/sp/metadata\");\n+            CloseableHttpResponse response = httpclient.execute(get, context);\n+            assertEquals(HttpStatus.SC_OK, response.getStatusLine().getStatusCode());\n+            String responseBody = EntityUtils.toString(response.getEntity());\n+            assertFalse(responseBody.isEmpty());\n+        }\n+    }\n+\n     @Override\n     protected void sso(final String baseURL, final String username, final String password) throws IOException {\n         CloseableHttpClient httpclient = HttpClients.createDefault();"},{"sha":"22082dc02558da84d6dbebb56b86505ed5ba3958","filename":"pom.xml","status":"modified","additions":2,"deletions":2,"changes":4,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/833c002dc8e53237e1e26e640669601e922aba46/pom.xml","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/833c002dc8e53237e1e26e640669601e922aba46/pom.xml","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/pom.xml?ref=833c002dc8e53237e1e26e640669601e922aba46","patch":"@@ -449,9 +449,9 @@ under the License.\n \n     <modernizer-maven.version>2.2.0</modernizer-maven.version>\n \n-    <pac4j.version>5.0.0-RC2</pac4j.version>\n+    <pac4j.version>5.0.1</pac4j.version>\n \n-    <cas.version>6.4.0-RC2</cas.version>\n+    <cas.version>6.4.0-SNAPSHOT</cas.version>\n     <cas-client.version>3.6.2</cas-client.version>\n \n     <h2.version>1.4.200</h2.version>"},{"sha":"3d156e61b54c3aa38e519ed5414b84c6707aaf8f","filename":"wa/starter/src/main/java/org/apache/syncope/wa/starter/config/SyncopeWAConfiguration.java","status":"modified","additions":2,"deletions":9,"changes":11,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/833c002dc8e53237e1e26e640669601e922aba46/wa%2Fstarter%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fwa%2Fstarter%2Fconfig%2FSyncopeWAConfiguration.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/833c002dc8e53237e1e26e640669601e922aba46/wa%2Fstarter%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fwa%2Fstarter%2Fconfig%2FSyncopeWAConfiguration.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/wa%2Fstarter%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fwa%2Fstarter%2Fconfig%2FSyncopeWAConfiguration.java?ref=833c002dc8e53237e1e26e640669601e922aba46","patch":"@@ -223,15 +223,8 @@ public ServiceRegistryExecutionPlanConfigurer syncopeServiceRegistryConfigurer(\n \n     @Autowired\n     @Bean\n-    public SamlIdPMetadataGenerator samlIdPMetadataGenerator(final WARestClient restClient) {\n-        SamlIdPMetadataGeneratorConfigurationContext context =\n-                SamlIdPMetadataGeneratorConfigurationContext.builder().\n-                        samlIdPMetadataLocator(samlIdPMetadataLocator(restClient)).\n-                        samlIdPCertificateAndKeyWriter(samlSelfSignedCertificateWriter.getObject()).\n-                        applicationContext(ctx).\n-                        casProperties(casProperties).\n-                        metadataCipherExecutor(CipherExecutor.noOpOfStringToString()).\n-                        build();\n+    public SamlIdPMetadataGenerator samlIdPMetadataGenerator(final WARestClient restClient,\n+                                                         final SamlIdPMetadataGeneratorConfigurationContext context) {\n         return new RestfulSamlIdPMetadataGenerator(context, restClient);\n     }\n "},{"sha":"eca4e7dea8db379c497fe4d1d3000a722a18f1ab","filename":"wa/starter/src/main/java/org/apache/syncope/wa/starter/mapping/OIDCRPClientAppTOMapper.java","status":"modified","additions":0,"deletions":1,"changes":1,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/833c002dc8e53237e1e26e640669601e922aba46/wa%2Fstarter%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fwa%2Fstarter%2Fmapping%2FOIDCRPClientAppTOMapper.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/833c002dc8e53237e1e26e640669601e922aba46/wa%2Fstarter%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fwa%2Fstarter%2Fmapping%2FOIDCRPClientAppTOMapper.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/wa%2Fstarter%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fwa%2Fstarter%2Fmapping%2FOIDCRPClientAppTOMapper.java?ref=833c002dc8e53237e1e26e640669601e922aba46","patch":"@@ -67,7 +67,6 @@ public RegisteredService map(\n         service.setServiceId(Stream.concat(rp.getRedirectUris().stream(), Stream.of(rp.getLogoutUri())).\n                 filter(Objects::nonNull).\n                 collect(Collectors.joining(\"|\")));\n-        service.setRedirectUrl(service.getServiceId());\n         service.setClientId(rp.getClientId());\n         service.setClientSecret(rp.getClientSecret());\n         service.setSignIdToken(rp.isSignIdToken());"},{"sha":"88568e8e0ae7400a7d2aed27b5a0255543160bad","filename":"wa/starter/src/main/java/org/apache/syncope/wa/starter/saml/idp/metadata/RestfulSamlIdPMetadataLocator.java","status":"modified","additions":6,"deletions":5,"changes":11,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/833c002dc8e53237e1e26e640669601e922aba46/wa%2Fstarter%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fwa%2Fstarter%2Fsaml%2Fidp%2Fmetadata%2FRestfulSamlIdPMetadataLocator.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/833c002dc8e53237e1e26e640669601e922aba46/wa%2Fstarter%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fwa%2Fstarter%2Fsaml%2Fidp%2Fmetadata%2FRestfulSamlIdPMetadataLocator.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/wa%2Fstarter%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fwa%2Fstarter%2Fsaml%2Fidp%2Fmetadata%2FRestfulSamlIdPMetadataLocator.java?ref=833c002dc8e53237e1e26e640669601e922aba46","patch":"@@ -19,7 +19,6 @@\n package org.apache.syncope.wa.starter.saml.idp.metadata;\n \n import com.github.benmanes.caffeine.cache.Cache;\n-import com.github.scribejava.core.java8.Base64;\n import java.nio.charset.StandardCharsets;\n import org.apache.syncope.client.lib.SyncopeClient;\n import org.apache.syncope.common.lib.SyncopeClientException;\n@@ -32,6 +31,8 @@\n import org.apereo.cas.util.crypto.CipherExecutor;\n import org.slf4j.Logger;\n import org.slf4j.LoggerFactory;\n+\n+import java.util.Base64;\n import java.util.Optional;\n import org.apache.syncope.common.rest.api.service.SAML2IdPEntityService;\n \n@@ -66,16 +67,16 @@ public SamlIdPMetadataDocument fetchInternal(final Optional<SamlRegisteredServic\n                             entityTO.getSigningCertificate()), StandardCharsets.UTF_8));\n                 }\n                 if (entityTO.getSigningKey() != null) {\n-                    document.setSigningKey((new String(Base64.getDecoder().decode(\n-                            entityTO.getSigningKey()), StandardCharsets.UTF_8)));\n+                    document.setSigningKey(new String(Base64.getDecoder().decode(\n+                            entityTO.getSigningKey().getBytes(StandardCharsets.UTF_8)), StandardCharsets.UTF_8));\n                 }\n                 if (entityTO.getEncryptionCertificate() != null) {\n                     document.setEncryptionCertificate(new String(Base64.getDecoder().decode(\n                             entityTO.getEncryptionCertificate()), StandardCharsets.UTF_8));\n                 }\n                 if (entityTO.getEncryptionKey() != null) {\n-                    document.setEncryptionKey((new String(Base64.getDecoder().decode(\n-                            entityTO.getEncryptionKey()), StandardCharsets.UTF_8)));\n+                    document.setEncryptionKey(new String(Base64.getDecoder().decode(\n+                            entityTO.getEncryptionKey().getBytes(StandardCharsets.UTF_8)), StandardCharsets.UTF_8));\n                 }\n \n                 if (document.isValid()) {"},{"sha":"81d0d2ec929edcfbc012bf8fb7816c56cdeb9cd2","filename":"wa/starter/src/main/resources/wa.properties","status":"modified","additions":4,"deletions":4,"changes":8,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/833c002dc8e53237e1e26e640669601e922aba46/wa%2Fstarter%2Fsrc%2Fmain%2Fresources%2Fwa.properties","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/833c002dc8e53237e1e26e640669601e922aba46/wa%2Fstarter%2Fsrc%2Fmain%2Fresources%2Fwa.properties","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/wa%2Fstarter%2Fsrc%2Fmain%2Fresources%2Fwa.properties?ref=833c002dc8e53237e1e26e640669601e922aba46","patch":"@@ -54,9 +54,9 @@ springdoc.model-and-view-allowed=true\n springdoc.writer-with-default-pretty-printer=true\n springdoc.swagger-ui.displayRequestDuration=true\n \n-cas.authn.mfa.web-authn.allowed-origins=${cas.server.name}\n-cas.authn.mfa.web-authn.application-id=https://localhost:8443\n-cas.authn.mfa.web-authn.relying-party-name=Syncope \n-cas.authn.mfa.web-authn.relying-party-id=syncope.apache.org\n+cas.authn.mfa.web-authn.core.allowed-origins=${cas.server.name}\n+cas.authn.mfa.web-authn.core.application-id=https://localhost:8443\n+cas.authn.mfa.web-authn.core.relying-party-name=Syncope \n+cas.authn.mfa.web-authn.core.relying-party-id=syncope.apache.org\n \n cas.authn.syncope.url=${cas.server.name}/syncope/rest/"}]}