{"sha":"4f7cb969c55acf9b154923490279701984e17459","node_id":"MDY6Q29tbWl0NjM2ODc5MDYyOjRmN2NiOTY5YzU1YWNmOWIxNTQ5MjM0OTAyNzk3MDE5ODRlMTc0NTk=","commit":{"author":{"name":"fmartelli","email":"fabio.martelli@gmail.com","date":"2017-08-17T14:51:43Z"},"committer":{"name":"fmartelli","email":"fabio.martelli@gmail.com","date":"2017-08-17T14:51:43Z"},"message":"[SYNCOPE-1190] provides action toggle panel header reload","tree":{"sha":"50efe109d5ba9d79ab5b1355d693e281d875b781","url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/git/trees/50efe109d5ba9d79ab5b1355d693e281d875b781"},"url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/git/commits/4f7cb969c55acf9b154923490279701984e17459","comment_count":0,"verification":{"verified":false,"reason":"unsigned","signature":null,"payload":null}},"url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/4f7cb969c55acf9b154923490279701984e17459","html_url":"https://github.com/EnricoDAlessandro97UNI/syncope/commit/4f7cb969c55acf9b154923490279701984e17459","comments_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/4f7cb969c55acf9b154923490279701984e17459/comments","author":{"login":"fmartelli","id":1791932,"node_id":"MDQ6VXNlcjE3OTE5MzI=","avatar_url":"https://avatars.githubusercontent.com/u/1791932?v=4","gravatar_id":"","url":"https://api.github.com/users/fmartelli","html_url":"https://github.com/fmartelli","followers_url":"https://api.github.com/users/fmartelli/followers","following_url":"https://api.github.com/users/fmartelli/following{/other_user}","gists_url":"https://api.github.com/users/fmartelli/gists{/gist_id}","starred_url":"https://api.github.com/users/fmartelli/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/fmartelli/subscriptions","organizations_url":"https://api.github.com/users/fmartelli/orgs","repos_url":"https://api.github.com/users/fmartelli/repos","events_url":"https://api.github.com/users/fmartelli/events{/privacy}","received_events_url":"https://api.github.com/users/fmartelli/received_events","type":"User","site_admin":false},"committer":{"login":"fmartelli","id":1791932,"node_id":"MDQ6VXNlcjE3OTE5MzI=","avatar_url":"https://avatars.githubusercontent.com/u/1791932?v=4","gravatar_id":"","url":"https://api.github.com/users/fmartelli","html_url":"https://github.com/fmartelli","followers_url":"https://api.github.com/users/fmartelli/followers","following_url":"https://api.github.com/users/fmartelli/following{/other_user}","gists_url":"https://api.github.com/users/fmartelli/gists{/gist_id}","starred_url":"https://api.github.com/users/fmartelli/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/fmartelli/subscriptions","organizations_url":"https://api.github.com/users/fmartelli/orgs","repos_url":"https://api.github.com/users/fmartelli/repos","events_url":"https://api.github.com/users/fmartelli/events{/privacy}","received_events_url":"https://api.github.com/users/fmartelli/received_events","type":"User","site_admin":false},"parents":[{"sha":"9deba71344c6c7520bd7a0319dbeb9928739e1b7","url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/9deba71344c6c7520bd7a0319dbeb9928739e1b7","html_url":"https://github.com/EnricoDAlessandro97UNI/syncope/commit/9deba71344c6c7520bd7a0319dbeb9928739e1b7"}],"stats":{"total":39,"additions":35,"deletions":4},"files":[{"sha":"ad02b5323318856c7354070f19fb0cbd9173f87a","filename":"client/console/src/main/java/org/apache/syncope/client/console/panels/AnyDirectoryPanel.java","status":"modified","additions":17,"deletions":0,"changes":17,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/4f7cb969c55acf9b154923490279701984e17459/client%2Fconsole%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fclient%2Fconsole%2Fpanels%2FAnyDirectoryPanel.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/4f7cb969c55acf9b154923490279701984e17459/client%2Fconsole%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fclient%2Fconsole%2Fpanels%2FAnyDirectoryPanel.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/client%2Fconsole%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fclient%2Fconsole%2Fpanels%2FAnyDirectoryPanel.java?ref=4f7cb969c55acf9b154923490279701984e17459","patch":"@@ -44,6 +44,7 @@\n import org.apache.syncope.client.console.wicket.markup.html.bootstrap.dialog.BaseModal;\n import org.apache.syncope.client.console.wicket.markup.html.form.ActionLink;\n import org.apache.syncope.client.console.wizards.any.AnyWrapper;\n+import org.apache.syncope.client.console.wizards.any.ResultPage;\n import org.apache.syncope.client.console.wizards.any.StatusPanel;\n import org.apache.syncope.common.lib.SyncopeConstants;\n import org.apache.syncope.common.lib.to.AnyTO;\n@@ -55,6 +56,7 @@\n import org.apache.wicket.PageReference;\n import org.apache.wicket.ajax.AjaxRequestTarget;\n import org.apache.wicket.authroles.authorization.strategies.role.metadata.MetaDataRoleAuthorizationStrategy;\n+import org.apache.wicket.extensions.ajax.markup.html.modal.ModalWindow;\n import org.apache.wicket.extensions.markup.html.repeater.data.table.IColumn;\n import org.apache.wicket.extensions.markup.html.repeater.data.table.PropertyColumn;\n import org.apache.wicket.markup.html.panel.Panel;\n@@ -125,6 +127,21 @@ protected AnyDirectoryPanel(final String id, final Builder<A, E> builder, final\n         }\n \n         initResultTable();\n+        \n+        // cahnge close callback in order to update header after model update\n+        modal.setWindowClosedCallback(new ModalWindow.WindowClosedCallback() {\n+\n+            private static final long serialVersionUID = 8804221891699487139L;\n+\n+            @Override\n+            public void onClose(final AjaxRequestTarget target) {\n+                if (actionTogglePanel.isVisibleInHierarchy() && modal.getContent() instanceof ResultPage) {\n+                    actionTogglePanel.updateHeader(\n+                            target, ResultPage.class.cast(modal.getContent()).getItem());\n+                }\n+                modal.show(false);\n+            }\n+        });\n     }\n \n     @Override"},{"sha":"87f184d8f20c9c0f59f78deb1432b514d24337e5","filename":"client/console/src/main/java/org/apache/syncope/client/console/wicket/markup/html/form/ActionLinksTogglePanel.java","status":"modified","additions":18,"deletions":4,"changes":22,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/4f7cb969c55acf9b154923490279701984e17459/client%2Fconsole%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fclient%2Fconsole%2Fwicket%2Fmarkup%2Fhtml%2Fform%2FActionLinksTogglePanel.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/4f7cb969c55acf9b154923490279701984e17459/client%2Fconsole%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fclient%2Fconsole%2Fwicket%2Fmarkup%2Fhtml%2Fform%2FActionLinksTogglePanel.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/client%2Fconsole%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fclient%2Fconsole%2Fwicket%2Fmarkup%2Fhtml%2Fform%2FActionLinksTogglePanel.java?ref=4f7cb969c55acf9b154923490279701984e17459","patch":"@@ -26,6 +26,9 @@\n import org.apache.syncope.client.console.panels.TogglePanel;\n import org.apache.syncope.client.console.policies.PolicyRuleDirectoryPanel.PolicyRuleWrapper;\n import org.apache.syncope.client.console.reports.ReportletDirectoryPanel.ReportletWrapper;\n+import org.apache.syncope.client.console.wizards.any.AnyWrapper;\n+import org.apache.syncope.client.console.wizards.any.GroupWrapper;\n+import org.apache.syncope.client.console.wizards.any.UserWrapper;\n import org.apache.syncope.client.console.wizards.resources.ResourceProvision;\n import org.apache.syncope.common.lib.to.AnyObjectTO;\n import org.apache.syncope.common.lib.to.EntityTO;\n@@ -68,19 +71,26 @@ public ActionLinksTogglePanel(final String id, final PageReference pageRef) {\n         container.add(getEmptyFragment());\n     }\n \n-    public void toggleWithContent(\n-            final AjaxRequestTarget target, final ActionsPanel<T> actionsPanel, final T modelObject) {\n+    public void updateHeader(\n+            final AjaxRequestTarget target, final Serializable modelObject) {\n         final String header;\n         if (modelObject == null) {\n             header = new ResourceModel(\"actions\", StringUtils.EMPTY).getObject();\n         } else if (modelObject instanceof UserTO) {\n             header = ((UserTO) modelObject).getUsername();\n+        } else if (modelObject instanceof UserWrapper) {\n+            header = ((UserWrapper) modelObject).getInnerObject().getUsername();\n         } else if (modelObject instanceof GroupTO) {\n             header = ((GroupTO) modelObject).getName();\n-        } else if (modelObject instanceof ReportTO) {\n-            header = ((ReportTO) modelObject).getName();\n+        } else if (modelObject instanceof GroupWrapper) {\n+            header = ((GroupWrapper) modelObject).getInnerObject().getName();\n         } else if (modelObject instanceof AnyObjectTO) {\n             header = ((AnyObjectTO) modelObject).getName();\n+        } else if (modelObject instanceof AnyWrapper\n+                && AnyWrapper.class.cast(modelObject).getInnerObject() instanceof AnyObjectTO) {\n+            header = ((AnyObjectTO) ((AnyWrapper) modelObject).getInnerObject()).getName();\n+        } else if (modelObject instanceof ReportTO) {\n+            header = ((ReportTO) modelObject).getName();\n         } else if (modelObject instanceof AttrTO) {\n             header = ((AttrTO) modelObject).getSchema();\n         } else if (modelObject instanceof AbstractPolicyTO) {\n@@ -116,7 +126,11 @@ public void toggleWithContent(\n             header = new ResourceModel(\"actions\", StringUtils.EMPTY).getObject();\n         }\n         setHeader(target, StringUtils.abbreviate(header, 25));\n+    }\n \n+    public void toggleWithContent(\n+            final AjaxRequestTarget target, final ActionsPanel<T> actionsPanel, final T modelObject) {\n+        updateHeader(target, modelObject);\n         modal.setWindowClosedCallback(new ModalWindow.WindowClosedCallback() {\n \n             private static final long serialVersionUID = 8804221891699487139L;"}]}