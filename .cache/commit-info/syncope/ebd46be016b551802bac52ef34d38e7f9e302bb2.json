{"sha":"ebd46be016b551802bac52ef34d38e7f9e302bb2","node_id":"MDY6Q29tbWl0NjM2ODc5MDYyOmViZDQ2YmUwMTZiNTUxODAyYmFjNTJlZjM0ZDM4ZTdmOWUzMDJiYjI=","commit":{"author":{"name":"Unknown","email":"unknown@apache.org","date":"2010-09-27T09:08:44Z"},"committer":{"name":"Unknown","email":"unknown@apache.org","date":"2010-09-27T09:08:44Z"},"message":"Some renaming and refactoring on JTA\n\ngit-svn-id: https://svn.apache.org/repos/asf/incubator/syncope/trunk@1246541 13f79535-47bb-0310-9956-ffa450edef68","tree":{"sha":"14bb96f5027534073f0eb0596f4e608e7666b9c8","url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/git/trees/14bb96f5027534073f0eb0596f4e608e7666b9c8"},"url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/git/commits/ebd46be016b551802bac52ef34d38e7f9e302bb2","comment_count":0,"verification":{"verified":false,"reason":"unsigned","signature":null,"payload":null}},"url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/ebd46be016b551802bac52ef34d38e7f9e302bb2","html_url":"https://github.com/EnricoDAlessandro97UNI/syncope/commit/ebd46be016b551802bac52ef34d38e7f9e302bb2","comments_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/ebd46be016b551802bac52ef34d38e7f9e302bb2/comments","author":null,"committer":null,"parents":[{"sha":"2d85c31a2aa31c0659484a6038fc393540b37be2","url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/2d85c31a2aa31c0659484a6038fc393540b37be2","html_url":"https://github.com/EnricoDAlessandro97UNI/syncope/commit/2d85c31a2aa31c0659484a6038fc393540b37be2"}],"stats":{"total":66,"additions":44,"deletions":22},"files":[{"sha":"81448104bfdfc2e361302acdf68dcdd0563aa17c","filename":"core/src/main/java/org/syncope/core/persistence/transaction/JTAPersistenceUnitPostProcessor.java","status":"renamed","additions":1,"deletions":1,"changes":2,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/ebd46be016b551802bac52ef34d38e7f9e302bb2/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fcore%2Fpersistence%2Ftransaction%2FJTAPersistenceUnitPostProcessor.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/ebd46be016b551802bac52ef34d38e7f9e302bb2/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fcore%2Fpersistence%2Ftransaction%2FJTAPersistenceUnitPostProcessor.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fcore%2Fpersistence%2Ftransaction%2FJTAPersistenceUnitPostProcessor.java?ref=ebd46be016b551802bac52ef34d38e7f9e302bb2","patch":"@@ -12,7 +12,7 @@\n  *  limitations under the License.\n  *  under the License.\n  */\n-package org.syncope.core.persistence;\n+package org.syncope.core.persistence.transaction;\n \n import java.util.Properties;\n import javax.persistence.spi.PersistenceUnitTransactionType;","previous_filename":"core/src/main/java/org/syncope/core/persistence/JTAPersistenceUnitPostProcessor.java"},{"sha":"6018a32f3b74f7a922e0905ca5eab963e22724c8","filename":"core/src/main/java/org/syncope/core/persistence/transaction/SpringJTAWithJPAFallbackTransactionManager.java","status":"renamed","additions":31,"deletions":10,"changes":41,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/ebd46be016b551802bac52ef34d38e7f9e302bb2/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fcore%2Fpersistence%2Ftransaction%2FSpringJTAWithJPAFallbackTransactionManager.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/ebd46be016b551802bac52ef34d38e7f9e302bb2/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fcore%2Fpersistence%2Ftransaction%2FSpringJTAWithJPAFallbackTransactionManager.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fcore%2Fpersistence%2Ftransaction%2FSpringJTAWithJPAFallbackTransactionManager.java?ref=ebd46be016b551802bac52ef34d38e7f9e302bb2","patch":"@@ -12,7 +12,7 @@\n  *  limitations under the License.\n  *  under the License.\n  */\n-package org.syncope.core.persistence;\n+package org.syncope.core.persistence.transaction;\n \n import java.io.Serializable;\n import javax.transaction.NotSupportedException;\n@@ -29,32 +29,52 @@\n import org.springframework.transaction.jta.JtaTransactionManager;\n import org.springframework.transaction.jta.TransactionFactory;\n \n-public class OmniTransactionManager implements PlatformTransactionManager,\n+/**\n+ * TransactionManager for usage with Spring.\n+ * It normally goes as per <tx:jta-transaction-manager/> but,\n+ * when not available, uses a configured JpaTransactionManager as fallback.\n+ *\n+ * @see JtaTransactionManager\n+ * @see JpaTransactionManager\n+ */\n+public class SpringJTAWithJPAFallbackTransactionManager\n+        implements PlatformTransactionManager,\n         TransactionFactory, InitializingBean, Serializable {\n \n     /**\n      * Logger.\n      */\n     private static final Logger LOG = LoggerFactory.getLogger(\n-            OmniTransactionManager.class);\n+            SpringJTAWithJPAFallbackTransactionManager.class);\n+    /**\n+     * Spring's JPA Transaction Manager.\n+     */\n     private JpaTransactionManager jpaTransactionManager;\n+    /**\n+     * Spring's JTA Transaction Manager.\n+     */\n     private JtaTransactionManager jtaTransactionManager;\n \n-    public OmniTransactionManager() {\n+    public SpringJTAWithJPAFallbackTransactionManager() {\n         jtaTransactionManager = new JtaTransactionManager();\n     }\n \n-    public OmniTransactionManager(JpaTransactionManager jpaTransactionManager) {\n-        super();\n+    public SpringJTAWithJPAFallbackTransactionManager(\n+            final JpaTransactionManager jpaTransactionManager) {\n+\n+        this();\n         setJpaTransactionManager(jpaTransactionManager);\n     }\n \n-    public JpaTransactionManager getJpaTransactionManager() {\n+    /**\n+     * @return fallback JPA Transaction Manager\n+     */\n+    public final JpaTransactionManager getJpaTransactionManager() {\n         return jpaTransactionManager;\n     }\n \n-    public void setJpaTransactionManager(\n-            JpaTransactionManager jpaTransactionManager) {\n+    public final void setJpaTransactionManager(\n+            final JpaTransactionManager jpaTransactionManager) {\n \n         this.jpaTransactionManager = jpaTransactionManager;\n     }\n@@ -70,7 +90,8 @@ private PlatformTransactionManager getPlatformTransactionManager() {\n     }\n \n     @Override\n-    public TransactionStatus getTransaction(TransactionDefinition definition)\n+    public final TransactionStatus getTransaction(\n+            final TransactionDefinition definition)\n             throws TransactionException {\n \n         return getPlatformTransactionManager().getTransaction(definition);","previous_filename":"core/src/main/java/org/syncope/core/persistence/OmniTransactionManager.java"},{"sha":"b858a5b4ab76b59859fe75bff6e435aee5f2af38","filename":"core/src/main/java/org/syncope/core/rest/controller/UserController.java","status":"modified","additions":5,"deletions":5,"changes":10,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/ebd46be016b551802bac52ef34d38e7f9e302bb2/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fcore%2Frest%2Fcontroller%2FUserController.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/ebd46be016b551802bac52ef34d38e7f9e302bb2/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fcore%2Frest%2Fcontroller%2FUserController.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fsyncope%2Fcore%2Frest%2Fcontroller%2FUserController.java?ref=ebd46be016b551802bac52ef34d38e7f9e302bb2","patch":"@@ -476,12 +476,12 @@ public void delete(@PathVariable(\"userId\") Long userId)\n             LOG.error(\"Could not find user '\" + userId + \"'\");\n \n             throw new NotFoundException(String.valueOf(userId));\n-        } else {\n-            if (workflowStore != null && user.getWorkflowId() != null) {\n-                workflowStore.delete(user.getWorkflowId());\n-            }\n+        }\n \n-            syncopeUserDAO.delete(userId);\n+        if (workflowStore != null && user.getWorkflowId() != null) {\n+            workflowStore.delete(user.getWorkflowId());\n         }\n+\n+        syncopeUserDAO.delete(userId);\n     }\n }"},{"sha":"0cd07b63c0e64aab3bdc055a849f7d7e6fc3ff3c","filename":"core/src/main/resources/org/syncope/core/persistence/db.properties","status":"modified","additions":2,"deletions":1,"changes":3,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/ebd46be016b551802bac52ef34d38e7f9e302bb2/core%2Fsrc%2Fmain%2Fresources%2Forg%2Fsyncope%2Fcore%2Fpersistence%2Fdb.properties","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/ebd46be016b551802bac52ef34d38e7f9e302bb2/core%2Fsrc%2Fmain%2Fresources%2Forg%2Fsyncope%2Fcore%2Fpersistence%2Fdb.properties","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fsrc%2Fmain%2Fresources%2Forg%2Fsyncope%2Fcore%2Fpersistence%2Fdb.properties?ref=ebd46be016b551802bac52ef34d38e7f9e302bb2","patch":"@@ -17,7 +17,8 @@ hibernate.connection.username=syncope\n hibernate.connection.password=syncope\n hibernate.dialect=org.hibernate.dialect.PostgreSQLDialect\n #hibernate.dialect=org.hibernate.dialect.Oracle10gDialect\n-jtaMode=true\n dbUnitDataTypeFactory=org.dbunit.ext.postgresql.PostgresqlDataTypeFactory\n #dbUnitDataTypeFactory=org.dbunit.ext.oracle.Oracle10DataTypeFactory\n #database.schema=SYNCOPE\n+jtaMode=true\n+transactionManagerLookupValue=org.hibernate.transaction.SunONETransactionManagerLookup"},{"sha":"368e60b9225f22bf3c054e5a2b6494876aa765f9","filename":"core/src/main/resources/persistenceContext.xml","status":"modified","additions":3,"deletions":4,"changes":7,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/ebd46be016b551802bac52ef34d38e7f9e302bb2/core%2Fsrc%2Fmain%2Fresources%2FpersistenceContext.xml","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/ebd46be016b551802bac52ef34d38e7f9e302bb2/core%2Fsrc%2Fmain%2Fresources%2FpersistenceContext.xml","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fsrc%2Fmain%2Fresources%2FpersistenceContext.xml?ref=ebd46be016b551802bac52ef34d38e7f9e302bb2","patch":"@@ -72,14 +72,13 @@\n         </property>\n         <property name=\"persistenceUnitPostProcessors\">\n             <list>\n-                <bean class=\"org.syncope.core.persistence.JTAPersistenceUnitPostProcessor\">\n+                <bean class=\"org.syncope.core.persistence.transaction.JTAPersistenceUnitPostProcessor\">\n                     <property name=\"jtaMode\" value=\"${jtaMode}\"/>\n                     <property name=\"jtaDataSource\" ref=\"dataSource\"/>\n                     <property name=\"transactionManagerLookupKey\"\n                               value=\"hibernate.transaction.manager_lookup_class\"/>\n-                    <!-- Configure here as per your production J2EE container -->\n                     <property name=\"transactionManagerLookupValue\"\n-                              value=\"org.hibernate.transaction.SunONETransactionManagerLookup\"/>\n+                              value=\"${transactionManagerLookupValue}\"/>\n                 </bean>\n             </list>\n         </property>\n@@ -96,7 +95,7 @@\n         <property name=\"entityManagerFactory\" ref=\"entityManagerFactory\"/>\n     </bean>\n     <bean id=\"transactionManager\"\n-          class=\"org.syncope.core.persistence.OmniTransactionManager\">\n+          class=\"org.syncope.core.persistence.transaction.SpringJTAWithJPAFallbackTransactionManager\">\n         <property name=\"jpaTransactionManager\" ref=\"jpaTransactionManager\"/>\n     </bean>\n     "},{"sha":"62efa0bf08e2d0b1b1a9042ba754b95c80f018d5","filename":"core/src/test/resources/org/syncope/core/persistence/db.properties","status":"modified","additions":2,"deletions":1,"changes":3,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/ebd46be016b551802bac52ef34d38e7f9e302bb2/core%2Fsrc%2Ftest%2Fresources%2Forg%2Fsyncope%2Fcore%2Fpersistence%2Fdb.properties","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/ebd46be016b551802bac52ef34d38e7f9e302bb2/core%2Fsrc%2Ftest%2Fresources%2Forg%2Fsyncope%2Fcore%2Fpersistence%2Fdb.properties","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/core%2Fsrc%2Ftest%2Fresources%2Forg%2Fsyncope%2Fcore%2Fpersistence%2Fdb.properties?ref=ebd46be016b551802bac52ef34d38e7f9e302bb2","patch":"@@ -14,5 +14,6 @@ hibernate.connection.url=jdbc:hsqldb:mem:syncopedb\n hibernate.connection.username=sa\n hibernate.connection.password=\n hibernate.dialect=org.hibernate.dialect.HSQLDialect\n-jtaMode=false\n dbUnitDataTypeFactory=org.dbunit.ext.hsqldb.HsqldbDataTypeFactory\n+jtaMode=false\n+transactionManagerLookupValue="}]}