{"sha":"edb0cb33d4ca6ac6b993dfc2f8ee536752f17e02","node_id":"MDY6Q29tbWl0NjM2ODc5MDYyOmVkYjBjYjMzZDRjYTZhYzZiOTkzZGZjMmY4ZWU1MzY3NTJmMTdlMDI=","commit":{"author":{"name":"Matteo Di Carlo","email":"matteo.dicarlo@bhuman.it","date":"2016-04-26T10:17:55Z"},"committer":{"name":"Francesco ChicchiriccÃ²","email":"ilgrosso@apache.org","date":"2016-05-02T15:33:21Z"},"message":"SYNCOPE-798 now cancel does logout plus refactoring authorization","tree":{"sha":"804268ba37735fb5b8c43c9bfff0d797d67acef6","url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/git/trees/804268ba37735fb5b8c43c9bfff0d797d67acef6"},"url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/git/commits/edb0cb33d4ca6ac6b993dfc2f8ee536752f17e02","comment_count":0,"verification":{"verified":false,"reason":"unsigned","signature":null,"payload":null}},"url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/edb0cb33d4ca6ac6b993dfc2f8ee536752f17e02","html_url":"https://github.com/EnricoDAlessandro97UNI/syncope/commit/edb0cb33d4ca6ac6b993dfc2f8ee536752f17e02","comments_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/edb0cb33d4ca6ac6b993dfc2f8ee536752f17e02/comments","author":null,"committer":{"login":"ilgrosso","id":1064664,"node_id":"MDQ6VXNlcjEwNjQ2NjQ=","avatar_url":"https://avatars.githubusercontent.com/u/1064664?v=4","gravatar_id":"","url":"https://api.github.com/users/ilgrosso","html_url":"https://github.com/ilgrosso","followers_url":"https://api.github.com/users/ilgrosso/followers","following_url":"https://api.github.com/users/ilgrosso/following{/other_user}","gists_url":"https://api.github.com/users/ilgrosso/gists{/gist_id}","starred_url":"https://api.github.com/users/ilgrosso/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ilgrosso/subscriptions","organizations_url":"https://api.github.com/users/ilgrosso/orgs","repos_url":"https://api.github.com/users/ilgrosso/repos","events_url":"https://api.github.com/users/ilgrosso/events{/privacy}","received_events_url":"https://api.github.com/users/ilgrosso/received_events","type":"User","site_admin":false},"parents":[{"sha":"a637694af0509cbd97c35476bd8016508b34052e","url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/a637694af0509cbd97c35476bd8016508b34052e","html_url":"https://github.com/EnricoDAlessandro97UNI/syncope/commit/a637694af0509cbd97c35476bd8016508b34052e"}],"stats":{"total":289,"additions":180,"deletions":109},"files":[{"sha":"75f758d76feca4ebecfce8d6d73bee906bcec965","filename":"client/enduser/src/main/java/org/apache/syncope/client/enduser/SyncopeEnduserApplication.java","status":"modified","additions":11,"deletions":0,"changes":11,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/edb0cb33d4ca6ac6b993dfc2f8ee536752f17e02/client%2Fenduser%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fclient%2Fenduser%2FSyncopeEnduserApplication.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/edb0cb33d4ca6ac6b993dfc2f8ee536752f17e02/client%2Fenduser%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fclient%2Fenduser%2FSyncopeEnduserApplication.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/client%2Fenduser%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fclient%2Fenduser%2FSyncopeEnduserApplication.java?ref=edb0cb33d4ca6ac6b993dfc2f8ee536752f17e02","patch":"@@ -18,6 +18,7 @@\n  */\n package org.apache.syncope.client.enduser;\n \n+import org.apache.syncope.client.enduser.resources.UserSelfIsLogged;\n import java.io.File;\n import java.io.Serializable;\n import org.apache.syncope.client.enduser.pages.HomePage;\n@@ -155,6 +156,16 @@ public IResource getResource() {\n             }\n         });\n \n+        mountResource(\"/api/self/islogged\", new ResourceReference(\"userSelfIsLogged\") {\n+\n+            private static final long serialVersionUID = -128426276529456602L;\n+\n+            @Override\n+            public IResource getResource() {\n+                return new UserSelfIsLogged();\n+            }\n+        });\n+\n         // resource to retrieve info about logged user\n         mountResource(\"/api/self/read\", new ResourceReference(\"userSelfRead\") {\n "},{"sha":"6f38d0dfefc2fc4b15d854083c0c1672f93993b1","filename":"client/enduser/src/main/java/org/apache/syncope/client/enduser/resources/AbstractBaseResource.java","status":"modified","additions":1,"deletions":1,"changes":2,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/edb0cb33d4ca6ac6b993dfc2f8ee536752f17e02/client%2Fenduser%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fclient%2Fenduser%2Fresources%2FAbstractBaseResource.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/edb0cb33d4ca6ac6b993dfc2f8ee536752f17e02/client%2Fenduser%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fclient%2Fenduser%2Fresources%2FAbstractBaseResource.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/client%2Fenduser%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fclient%2Fenduser%2Fresources%2FAbstractBaseResource.java?ref=edb0cb33d4ca6ac6b993dfc2f8ee536752f17e02","patch":"@@ -33,7 +33,7 @@ public abstract class AbstractBaseResource extends AbstractResource {\n \n     private static final long serialVersionUID = -7875801358718612782L;\n \n-    private static final Logger LOG = LoggerFactory.getLogger(AbstractBaseResource.class);\n+    protected static final Logger LOG = LoggerFactory.getLogger(AbstractBaseResource.class);\n \n     protected static final ObjectMapper MAPPER = new ObjectMapper();\n "},{"sha":"d1f0c7a1e80144a1f83fabeb57177b196326fe31","filename":"client/enduser/src/main/java/org/apache/syncope/client/enduser/resources/UserSelfIsLogged.java","status":"added","additions":66,"deletions":0,"changes":66,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/edb0cb33d4ca6ac6b993dfc2f8ee536752f17e02/client%2Fenduser%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fclient%2Fenduser%2Fresources%2FUserSelfIsLogged.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/edb0cb33d4ca6ac6b993dfc2f8ee536752f17e02/client%2Fenduser%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fclient%2Fenduser%2Fresources%2FUserSelfIsLogged.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/client%2Fenduser%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fclient%2Fenduser%2Fresources%2FUserSelfIsLogged.java?ref=edb0cb33d4ca6ac6b993dfc2f8ee536752f17e02","patch":"@@ -0,0 +1,66 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *   http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+package org.apache.syncope.client.enduser.resources;\n+\n+import java.io.IOException;\n+import javax.servlet.http.HttpServletRequest;\n+import javax.ws.rs.core.Response;\n+import org.apache.syncope.client.enduser.SyncopeEnduserSession;\n+import org.apache.wicket.request.resource.IResource;\n+\n+public class UserSelfIsLogged extends AbstractBaseResource {\n+\n+    private static final long serialVersionUID = 1L;\n+\n+    @Override\n+    protected ResourceResponse newResourceResponse(final Attributes attributes) {\n+\n+        ResourceResponse response = new ResourceResponse();\n+\n+        LOG.debug(\"Checking if user is authenticated\");\n+\n+        try {\n+            HttpServletRequest request = (HttpServletRequest) attributes.getRequest().getContainerRequest();\n+            if (!xsrfCheck(request)) {\n+                LOG.error(\"XSRF TOKEN does not match\");\n+                response.setError(Response.Status.BAD_REQUEST.getStatusCode(), \"XSRF TOKEN does not match\");\n+                return response;\n+            }\n+\n+            response.setWriteCallback(new WriteCallback() {\n+\n+                @Override\n+                public void writeData(final IResource.Attributes attributes) throws IOException {\n+                    attributes.getResponse().write(\n+                            Boolean.toString(SyncopeEnduserSession.get().isAuthenticated()));\n+                }\n+            });\n+            response.setStatusCode(Response.Status.OK.getStatusCode());\n+\n+        } catch (Exception e) {\n+            LOG.error(\"Could not read credentials from request\", e);\n+            response.setError(Response.Status.BAD_REQUEST.getStatusCode(), new StringBuilder()\n+                    .append(\"ErrorMessage{{ \")\n+                    .append(e.getMessage())\n+                    .append(\" }}\")\n+                    .toString());\n+        }\n+        return response;\n+    }\n+}"},{"sha":"17e0816d5e21e2cc9c401a8e625fcb7dfcb48b6d","filename":"client/enduser/src/main/resources/META-INF/resources/app/js/app.js","status":"modified","additions":70,"deletions":55,"changes":125,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/edb0cb33d4ca6ac6b993dfc2f8ee536752f17e02/client%2Fenduser%2Fsrc%2Fmain%2Fresources%2FMETA-INF%2Fresources%2Fapp%2Fjs%2Fapp.js","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/edb0cb33d4ca6ac6b993dfc2f8ee536752f17e02/client%2Fenduser%2Fsrc%2Fmain%2Fresources%2FMETA-INF%2Fresources%2Fapp%2Fjs%2Fapp.js","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/client%2Fenduser%2Fsrc%2Fmain%2Fresources%2FMETA-INF%2Fresources%2Fapp%2Fjs%2Fapp.js?ref=edb0cb33d4ca6ac6b993dfc2f8ee536752f17e02","patch":"@@ -61,9 +61,10 @@ app.config(['$stateProvider', '$urlRouterProvider', '$httpProvider',\n               templateUrl: 'views/home.html',\n               controller: 'HomeController',\n               resolve: {\n-                'authenticated': function (AuthenticationHelper) {\n-                  return AuthenticationHelper.authenticated();\n-                }\n+                'authenticated': ['AuthService',\n+                  function (AuthService) {\n+                    return AuthService.islogged()\n+                  }]\n               }\n             })\n             .state('create', {\n@@ -105,9 +106,10 @@ app.config(['$stateProvider', '$urlRouterProvider', '$httpProvider',\n               url: '/self/update',\n               templateUrl: 'views/editUser.html',\n               resolve: {\n-                'authenticated': function (AuthenticationHelper) {\n-                  return AuthenticationHelper.authenticated();\n-                }\n+                'authenticated': ['AuthService',\n+                  function (AuthService) {\n+                    return AuthService.islogged();\n+                  }]\n               }\n             })\n             // nested states \n@@ -117,63 +119,70 @@ app.config(['$stateProvider', '$urlRouterProvider', '$httpProvider',\n               url: '/credentials',\n               templateUrl: 'views/user-credentials.html',\n               resolve: {\n-                'authenticated': function (AuthenticationHelper) {\n-                  return AuthenticationHelper.authenticated();\n-                }\n+                'authenticated': ['AuthService',\n+                  function (AuthService) {\n+                    return AuthService.islogged();\n+                  }]\n               }\n             })\n             .state('update.plainSchemas', {\n               url: '/plainSchemas',\n               templateUrl: 'views/user-plain-schemas.html',\n               resolve: {\n-                'authenticated': function (AuthenticationHelper) {\n-                  return AuthenticationHelper.authenticated();\n-                }\n+                'authenticated': ['AuthService',\n+                  function (AuthService) {\n+                    return AuthService.islogged();\n+                  }]\n               }\n             })\n             .state('update.derivedSchemas', {\n               url: '/derivedSchemas',\n               templateUrl: 'views/user-derived-schemas.html',\n               resolve: {\n-                'authenticated': function (AuthenticationHelper) {\n-                  return AuthenticationHelper.authenticated();\n-                }\n+                'authenticated': ['AuthService',\n+                  function (AuthService) {\n+                    return AuthService.islogged();\n+                  }]\n               }\n             })\n             .state('update.virtualSchemas', {\n               url: '/virtualSchemas',\n               templateUrl: 'views/user-virtual-schemas.html',\n               resolve: {\n-                'authenticated': function (AuthenticationHelper) {\n-                  return AuthenticationHelper.authenticated();\n-                }\n+                'authenticated': ['AuthService',\n+                  function (AuthService) {\n+                    return AuthService.islogged();\n+                  }]\n               }\n             })\n             .state('update.groups', {\n               url: '/groups',\n               templateUrl: 'views/user-groups.html',\n               resolve: {\n-                'authenticated': function (AuthenticationHelper) {\n-                  return AuthenticationHelper.authenticated();\n-                }\n+                'authenticated': ['AuthService',\n+                  function (AuthService) {\n+                    return AuthService.islogged();\n+                  }]\n               }\n             })\n             .state('update.resources', {\n               url: '/resources',\n               templateUrl: 'views/user-resources.html',\n               resolve: {\n-                'authenticated': function (AuthenticationHelper) {\n-                  return AuthenticationHelper.authenticated();\n-                }\n+                'authenticated': ['AuthService',\n+                  function (AuthService) {\n+                    return AuthService.islogged();\n+                  }]\n               }\n             })\n             .state('update.finish', {\n               url: '/finish',\n               templateUrl: 'views/user-form-finish.html',\n               resolve: {\n-                'authenticated': function (AuthenticationHelper) {\n-                  return AuthenticationHelper.authenticated();\n-                }\n+                'authenticated': ['AuthService',\n+                  function (AuthService) {\n+                    return AuthService.islogged();\n+                  }]\n               }\n             })\n             .state('passwordreset', {\n@@ -197,7 +206,7 @@ app.config(['$stateProvider', '$urlRouterProvider', '$httpProvider',\n     $httpProvider.defaults.withCredentials = true;\n     $httpProvider.defaults.xsrfCookieName = 'XSRF-TOKEN';\n     $httpProvider.defaults.xsrfHeaderName = 'X-XSRF-TOKEN';\n-    \n+\n     //SYNCOPE-780\n     $httpProvider.defaults.headers.common[\"If-Modified-Since\"] = \"0\";\n \n@@ -238,12 +247,10 @@ app.config(['$stateProvider', '$urlRouterProvider', '$httpProvider',\n \n   }]);\n \n-app.run(['$rootScope', '$location', '$cookies', '$state',\n-  function ($rootScope, $location, $cookies, $state) {\n+app.run(['$rootScope', '$location', '$cookies', '$state', 'AuthService',\n+  function ($rootScope, $location, $cookies, $state, AuthService) {\n     // main program\n     // keep user logged in after page refresh\n-    // check if user is logged or not\n-    $rootScope.currentUser = $cookies.get('currentUser') || null;\n     //If the route change failed due to authentication error, redirect them out\n     $rootScope.$on('$routeChangeError', function (event, current, previous, rejection) {\n       if (rejection === 'Not Authenticated') {\n@@ -254,10 +261,38 @@ app.run(['$rootScope', '$location', '$cookies', '$state',\n     $rootScope.$on('$stateChangeSuccess', function (event, toState) {\n       if (toState.name === 'create') {\n         $state.go('create.credentials');\n+\n       } else if (toState.name === 'update') {\n         $state.go('update.credentials');\n-      }\n-      else {\n+\n+      } else if (toState.name.indexOf(\"update\") > -1) {\n+        AuthService.islogged().then(function (response) {\n+          if (response === \"true\") {\n+            $state.go(toState);\n+          } else {\n+            $state.go('self');\n+          }\n+        }, function (response) {\n+          console.log(\"not logged\");\n+          $state.go('self');\n+        }\n+        );\n+\n+      } else if (toState.name === 'home' || toState.name === 'self') {\n+        AuthService.islogged().then(function (response) {\n+          console.log(\"User logged (change): \", response)\n+          console.log(\"User logged (change): \", AuthService.islogged())\n+          if (response === \"true\") {\n+            $state.go('update.credentials');\n+          } else {\n+            $state.go('self');\n+          }\n+        }, function (response) {\n+          console.log(\"not logged\");\n+          $state.go('self');\n+        }\n+        );\n+      } else {\n         $state.go(toState);\n       }\n     });\n@@ -361,8 +396,7 @@ app.controller('ApplicationController', ['$scope', '$rootScope', 'InfoService',\n                 }\n               });\n             }, timer);\n-          }\n-          else {\n+          } else {\n             pendingNotifications.each(function (idx, element) {\n               var popup = $(element).data(\"kendoPopup\");\n               if (popup) {\n@@ -387,7 +421,6 @@ app.controller('ApplicationController', ['$scope', '$rootScope', 'InfoService',\n       $scope.$on('hideErrorMessage', function (event, popupMessage) {\n         $scope.hideError(popupMessage, $scope.notification);\n       });\n-\n       //wizard active element\n       $scope.wizard = {\n         \"credentials\": {url: \"/credentials\", templateUrl: \"views/user-credentials.html\"},\n@@ -398,23 +431,5 @@ app.controller('ApplicationController', ['$scope', '$rootScope', 'InfoService',\n         \"resources\": {url: \"/resources\", templateUrl: \"views/user-resources.html\"},\n         \"finish\": {url: \"/finish\", templateUrl: \"views/user-form-finish.html\"}\n       };\n-\n-\n     }\n   }]);\n-app.factory('AuthenticationHelper', ['$q', '$rootScope',\n-  function ($q, $rootScope) {\n-    return {\n-      authenticated: function () {\n-\n-        var currentUser = $rootScope.currentUser;\n-        console.log(\"AuthenticationHelper, currentUser: \", currentUser);\n-        if (angular.isDefined(currentUser) && currentUser) {\n-          return true;\n-        } else {\n-          console.log(\"NOT AUTHENTICATED, REDIRECT TO LOGIN PAGE\");\n-          return $q.reject('Not Authenticated');\n-        }\n-      }\n-    };\n-  }]);"},{"sha":"0470587dad85e8654ba123c9b5d2b07e7dec9403","filename":"client/enduser/src/main/resources/META-INF/resources/app/js/controllers/HomeController.js","status":"modified","additions":0,"deletions":16,"changes":16,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/edb0cb33d4ca6ac6b993dfc2f8ee536752f17e02/client%2Fenduser%2Fsrc%2Fmain%2Fresources%2FMETA-INF%2Fresources%2Fapp%2Fjs%2Fcontrollers%2FHomeController.js","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/edb0cb33d4ca6ac6b993dfc2f8ee536752f17e02/client%2Fenduser%2Fsrc%2Fmain%2Fresources%2FMETA-INF%2Fresources%2Fapp%2Fjs%2Fcontrollers%2FHomeController.js","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/client%2Fenduser%2Fsrc%2Fmain%2Fresources%2FMETA-INF%2Fresources%2Fapp%2Fjs%2Fcontrollers%2FHomeController.js?ref=edb0cb33d4ca6ac6b993dfc2f8ee536752f17e02","patch":"@@ -20,20 +20,4 @@\n 'use strict';\n \n angular.module(\"home\").controller(\"HomeController\", ['$scope', '$http', '$location', function ($scope, $http, $location) {\n-    $scope.title = 'Hello world!';\n-    $scope.subtitle = 'Hello world SUBTITLE!';\n-    $scope.name = \"\";\n-\n-// check if user is logged or not, check session variables: if user isn't logged redirect to login page\n-\n-      console.log(\"SONO IN HomeController\");\n-      \n-//      var isLogged = false;\n-//      if (!isLogged) {\n-//        console.log(\"REDIRECT TO LOGIN PAGE\");\n-////        window.location = \"./self.html\";\n-//        $location.path(\"/self\");\n-//      }\n-\n-    \n   }]);\n\\ No newline at end of file"},{"sha":"a166784f2fbb87c67f6063cdbb340194f2c8b506","filename":"client/enduser/src/main/resources/META-INF/resources/app/js/controllers/LoginController.js","status":"modified","additions":9,"deletions":4,"changes":13,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/edb0cb33d4ca6ac6b993dfc2f8ee536752f17e02/client%2Fenduser%2Fsrc%2Fmain%2Fresources%2FMETA-INF%2Fresources%2Fapp%2Fjs%2Fcontrollers%2FLoginController.js","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/edb0cb33d4ca6ac6b993dfc2f8ee536752f17e02/client%2Fenduser%2Fsrc%2Fmain%2Fresources%2FMETA-INF%2Fresources%2Fapp%2Fjs%2Fcontrollers%2FLoginController.js","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/client%2Fenduser%2Fsrc%2Fmain%2Fresources%2FMETA-INF%2Fresources%2Fapp%2Fjs%2Fcontrollers%2FLoginController.js?ref=edb0cb33d4ca6ac6b993dfc2f8ee536752f17e02","patch":"@@ -45,7 +45,7 @@ angular.module(\"login\").controller(\"LoginController\", ['$scope', '$rootScope', '\n           errorMessage = errorMessage.split(\"}}\")[0];\n         }\n         $scope.credentials.errorMessage = \"Login failed: \" + errorMessage;\n-        $scope.showError($scope.credentials.errorMessage, $scope.notification);        \n+        $scope.showError($scope.credentials.errorMessage, $scope.notification);\n       });\n     };\n \n@@ -57,16 +57,21 @@ angular.module(\"login\").controller(\"LoginController\", ['$scope', '$rootScope', '\n       });\n     };\n \n-    $scope.isLogged = function () {\n-      return angular.isDefined($rootScope.currentUser) && $rootScope.currentUser;\n+    $scope.islogged = function () {\n+      AuthService.islogged().then(function (response) {\n+        console.log(\"user login status detected\", response);\n+        return response.data === true;\n+      }, function (response) {\n+        console.log(\"error retrieving user login status\", response);\n+      });\n     };\n \n     $scope.selfCreate = function () {\n       $location.path(\"/self/create\");\n     };\n \n     $scope.passwordReset = function () {\n-       $location.path(\"/passwordreset\");\n+      $location.path(\"/passwordreset\");\n     };\n \n     $scope.errorAPI = function () {"},{"sha":"56a5e3649a3ee7d5dfabaa06790a311247d223d5","filename":"client/enduser/src/main/resources/META-INF/resources/app/js/services/authService.js","status":"modified","additions":13,"deletions":23,"changes":36,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/edb0cb33d4ca6ac6b993dfc2f8ee536752f17e02/client%2Fenduser%2Fsrc%2Fmain%2Fresources%2FMETA-INF%2Fresources%2Fapp%2Fjs%2Fservices%2FauthService.js","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/edb0cb33d4ca6ac6b993dfc2f8ee536752f17e02/client%2Fenduser%2Fsrc%2Fmain%2Fresources%2FMETA-INF%2Fresources%2Fapp%2Fjs%2Fservices%2FauthService.js","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/client%2Fenduser%2Fsrc%2Fmain%2Fresources%2FMETA-INF%2Fresources%2Fapp%2Fjs%2Fservices%2FauthService.js?ref=edb0cb33d4ca6ac6b993dfc2f8ee536752f17e02","patch":"@@ -25,21 +25,12 @@ angular.module('login')\n \n             var authService = {};\n \n-            var clearUserCookie = function () {\n-              $rootScope.currentUser = null;\n-              $cookies.remove('currentUser');\n-            };\n-\n             authService.login = function (credentials) {\n               return $http\n                       .post('/syncope-enduser/api/login', credentials)\n                       .then(function (response) {\n-                        var username = response.data;\n-                        $cookies.put('currentUser', username);\n-                        $rootScope.currentUser = username;\n-                        return username;\n+                        return response.data;\n                       }, function (response) {\n-                        clearUserCookie();\n                         console.log(\"Something went wrong during login, exit with status: \", response);\n                         return $q.reject(response.data || response.statusText);\n                       });\n@@ -49,26 +40,25 @@ angular.module('login')\n               return $http\n                       .get('/syncope-enduser/api/logout')\n                       .then(function (response) {\n-                        clearUserCookie();\n                         return response;\n                       }, function (response) {\n-                        clearUserCookie();\n                         console.log(\"Something went wrong during logout, exit with status: \", response);\n                       });\n             };\n \n-            return authService;\n-//            return {\n-//              login: $resource('/syncope-enduser/api/login', {}, {\n-//                do: {method: 'POST', params: {}, isArray: false}\n-//              })\n-//            };\n-//            return {\n-//              logout: $resource('/cradleDashboard/api/logout', {}, {\n-//                query: {method: 'GET', params: {}, isArray: false}\n-//              })\n-//            };\n \n+            authService.islogged = function () {\n+              return $http\n+                      .get('/syncope-enduser/api/self/islogged')\n+                      .then(function (response) {\n+                        console.log(\"user logged: (authServ)\" + response.data);\n+                        return response.data;\n+                      }, function (response) {\n+                        console.log(\"error retrieving user login status\");\n+                      });\n+            };\n+\n+            return authService;\n           }]);\n \n "},{"sha":"482feddf779e5e606b94074cc732b87566d73cd7","filename":"client/enduser/src/main/resources/META-INF/resources/app/views/self.html","status":"modified","additions":3,"deletions":3,"changes":6,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/edb0cb33d4ca6ac6b993dfc2f8ee536752f17e02/client%2Fenduser%2Fsrc%2Fmain%2Fresources%2FMETA-INF%2Fresources%2Fapp%2Fviews%2Fself.html","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/edb0cb33d4ca6ac6b993dfc2f8ee536752f17e02/client%2Fenduser%2Fsrc%2Fmain%2Fresources%2FMETA-INF%2Fresources%2Fapp%2Fviews%2Fself.html","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/client%2Fenduser%2Fsrc%2Fmain%2Fresources%2FMETA-INF%2Fresources%2Fapp%2Fviews%2Fself.html?ref=edb0cb33d4ca6ac6b993dfc2f8ee536752f17e02","patch":"@@ -52,7 +52,7 @@\n             <div id=\"login-form\" class=\"form\">              \n             </div>\n \n-            <form id=\"login-form\" class=\"form form-signin\" novalidate ng-show=\"!isLogged()\" >\n+            <form id=\"login-form\" class=\"form form-signin\" novalidate>\n \n               <fieldset class=\"form-group input-group\">\n \n@@ -77,14 +77,14 @@\n           </div>\n \n         </div>\n-        <div class=\"text-center\" ng-show=\"!isLogged() && $root.isSelfRegAllowed()\">\n+        <div class=\"text-center\" ng-show=\"$root.isSelfRegAllowed()\">\n           <a href=\"javascript:void(0);\" class=\"btn btn-link\" ng-click=\"selfCreate()\">Self Registration</a>\n \n           <!--      <div id=\"initialLoaderDiv\">\n                   <img src=\"img/busy.gif\" class=\"ajax-loader\"/>\n                 </div>-->\n         </div>\n-        <div class=\"text-center\" ng-show=\"!isLogged() && $root.isPwdResetAllowed()\">\n+        <div class=\"text-center\" ng-show=\"$root.isPwdResetAllowed()\">\n           <a href=\"javascript:void(0);\" class=\"btn btn-link\" ng-click=\"passwordReset()\">Password Reset</a>\n         </div>\n         <!-- /#login-container -->"},{"sha":"a09ab984d8dfdb34e6dc1e5fe6c461c32f44ed0e","filename":"client/enduser/src/main/resources/META-INF/resources/app/views/user-credentials.html","status":"modified","additions":1,"deletions":1,"changes":2,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/edb0cb33d4ca6ac6b993dfc2f8ee536752f17e02/client%2Fenduser%2Fsrc%2Fmain%2Fresources%2FMETA-INF%2Fresources%2Fapp%2Fviews%2Fuser-credentials.html","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/edb0cb33d4ca6ac6b993dfc2f8ee536752f17e02/client%2Fenduser%2Fsrc%2Fmain%2Fresources%2FMETA-INF%2Fresources%2Fapp%2Fviews%2Fuser-credentials.html","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/client%2Fenduser%2Fsrc%2Fmain%2Fresources%2FMETA-INF%2Fresources%2Fapp%2Fviews%2Fuser-credentials.html?ref=edb0cb33d4ca6ac6b993dfc2f8ee536752f17e02","patch":"@@ -65,6 +65,6 @@\n   <navigation-buttons ng-show=\"createMode\" base=\"create\" current=\"credentials\" wizard=\"{{wizard}}\"></navigation-buttons>\n   <navigation-buttons ng-show=\"!createMode\" base= \"update\" current=\"credentials\" wizard=\"{{wizard}}\"></navigation-buttons>\n   <div class=\"pull-left\">\n-    <a id=\"cancel\" href=\"#/self\" class=\"btn btn-danger pull-left\">Cancel</a>\n+    <a id=\"cancel\" href=\"#/self\" class=\"btn btn-danger pull-left\" ng-click=\"logout()\">Cancel</a>\n   </div>\n </div>"},{"sha":"b764352738cc2af5f4d6dd4704663faccfb04cd4","filename":"client/enduser/src/main/resources/META-INF/resources/app/views/user-derived-schemas.html","status":"modified","additions":1,"deletions":1,"changes":2,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/edb0cb33d4ca6ac6b993dfc2f8ee536752f17e02/client%2Fenduser%2Fsrc%2Fmain%2Fresources%2FMETA-INF%2Fresources%2Fapp%2Fviews%2Fuser-derived-schemas.html","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/edb0cb33d4ca6ac6b993dfc2f8ee536752f17e02/client%2Fenduser%2Fsrc%2Fmain%2Fresources%2FMETA-INF%2Fresources%2Fapp%2Fviews%2Fuser-derived-schemas.html","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/client%2Fenduser%2Fsrc%2Fmain%2Fresources%2FMETA-INF%2Fresources%2Fapp%2Fviews%2Fuser-derived-schemas.html?ref=edb0cb33d4ca6ac6b993dfc2f8ee536752f17e02","patch":"@@ -24,6 +24,6 @@\n   <navigation-buttons ng-show=\"createMode\" base=\"create\" current=\"derivedSchemas\" wizard=\"{{wizard}}\"></navigation-buttons>\n   <navigation-buttons ng-show=\"!createMode\" base=\"update\" current=\"derivedSchemas\" wizard=\"{{wizard}}\"></navigation-buttons>\n   <div class=\"pull-left\">\n-    <a id=\"cancel\" href=\"#/self\" class=\"btn btn-danger\">Cancel</a>\n+    <a id=\"cancel\" href=\"#/self\" class=\"btn btn-danger\" ng-click=\"logout()\">Cancel</a>\n   </div>\n </div>"},{"sha":"5c6465cf2c655f12fa890f36ceac7c3ddce4ec47","filename":"client/enduser/src/main/resources/META-INF/resources/app/views/user-form-finish.html","status":"modified","additions":1,"deletions":1,"changes":2,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/edb0cb33d4ca6ac6b993dfc2f8ee536752f17e02/client%2Fenduser%2Fsrc%2Fmain%2Fresources%2FMETA-INF%2Fresources%2Fapp%2Fviews%2Fuser-form-finish.html","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/edb0cb33d4ca6ac6b993dfc2f8ee536752f17e02/client%2Fenduser%2Fsrc%2Fmain%2Fresources%2FMETA-INF%2Fresources%2Fapp%2Fviews%2Fuser-form-finish.html","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/client%2Fenduser%2Fsrc%2Fmain%2Fresources%2FMETA-INF%2Fresources%2Fapp%2Fviews%2Fuser-form-finish.html?ref=edb0cb33d4ca6ac6b993dfc2f8ee536752f17e02","patch":"@@ -25,6 +25,6 @@\n   <navigation-buttons ng-show=\"createMode\" base=\"create\" current=\"finish\" wizard=\"{{wizard}}\"></navigation-buttons>\n   <navigation-buttons ng-show=\"!createMode\" base=\"update\" current=\"finish\" wizard=\"{{wizard}}\"></navigation-buttons>\n   <div class=\"pull-left\">\n-    <a id=\"cancel\" href=\"#/self\" class=\"btn btn-danger\">Cancel</a>\n+    <a id=\"cancel\" href=\"#/self\" class=\"btn btn-danger\" ng-click=\"logout()\">Cancel</a>\n   </div>\n </div>"},{"sha":"63d68551de622ecabc77b299876de1b73827a93d","filename":"client/enduser/src/main/resources/META-INF/resources/app/views/user-groups.html","status":"modified","additions":1,"deletions":1,"changes":2,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/edb0cb33d4ca6ac6b993dfc2f8ee536752f17e02/client%2Fenduser%2Fsrc%2Fmain%2Fresources%2FMETA-INF%2Fresources%2Fapp%2Fviews%2Fuser-groups.html","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/edb0cb33d4ca6ac6b993dfc2f8ee536752f17e02/client%2Fenduser%2Fsrc%2Fmain%2Fresources%2FMETA-INF%2Fresources%2Fapp%2Fviews%2Fuser-groups.html","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/client%2Fenduser%2Fsrc%2Fmain%2Fresources%2FMETA-INF%2Fresources%2Fapp%2Fviews%2Fuser-groups.html?ref=edb0cb33d4ca6ac6b993dfc2f8ee536752f17e02","patch":"@@ -37,6 +37,6 @@\n   <navigation-buttons ng-show=\"createMode\" base=\"create\" current=\"groups\" wizard=\"{{wizard}}\"></navigation-buttons>\n   <navigation-buttons ng-show=\"!createMode\" base=\"update\" current=\"groups\" wizard=\"{{wizard}}\"></navigation-buttons>\n   <div class=\"pull-left\">\n-    <a id=\"cancel\" href=\"#/self\" class=\"btn btn-danger pull-left\">Cancel</a>\n+    <a id=\"cancel\" href=\"#/self\" class=\"btn btn-danger pull-left\" ng-click=\"logout()\">Cancel</a>\n   </div>\n </div>"},{"sha":"ef2fb57c11756760ab0b6e26e3cc8ab355bbab09","filename":"client/enduser/src/main/resources/META-INF/resources/app/views/user-plain-schemas.html","status":"modified","additions":1,"deletions":1,"changes":2,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/edb0cb33d4ca6ac6b993dfc2f8ee536752f17e02/client%2Fenduser%2Fsrc%2Fmain%2Fresources%2FMETA-INF%2Fresources%2Fapp%2Fviews%2Fuser-plain-schemas.html","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/edb0cb33d4ca6ac6b993dfc2f8ee536752f17e02/client%2Fenduser%2Fsrc%2Fmain%2Fresources%2FMETA-INF%2Fresources%2Fapp%2Fviews%2Fuser-plain-schemas.html","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/client%2Fenduser%2Fsrc%2Fmain%2Fresources%2FMETA-INF%2Fresources%2Fapp%2Fviews%2Fuser-plain-schemas.html?ref=edb0cb33d4ca6ac6b993dfc2f8ee536752f17e02","patch":"@@ -24,6 +24,6 @@\n   <navigation-buttons ng-show=\"createMode\" base=\"create\" current=\"plainSchemas\" wizard=\"{{wizard}}\"></navigation-buttons>\n   <navigation-buttons ng-show=\"!createMode\" base=\"update\" current=\"plainSchemas\" wizard=\"{{wizard}}\"></navigation-buttons>\n   <div class=\"pull-left\">\n-    <a id=\"cancel\" href=\"#/self\" class=\"btn btn-danger pull-left\">Cancel</a>\n+    <a id=\"cancel\" href=\"#/self\" class=\"btn btn-danger pull-left\" ng-click=\"logout()\">Cancel</a>\n   </div>\n </div>"},{"sha":"f0eb228763c95cafbc4faf28fd71da65fb9752d6","filename":"client/enduser/src/main/resources/META-INF/resources/app/views/user-resources.html","status":"modified","additions":1,"deletions":1,"changes":2,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/edb0cb33d4ca6ac6b993dfc2f8ee536752f17e02/client%2Fenduser%2Fsrc%2Fmain%2Fresources%2FMETA-INF%2Fresources%2Fapp%2Fviews%2Fuser-resources.html","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/edb0cb33d4ca6ac6b993dfc2f8ee536752f17e02/client%2Fenduser%2Fsrc%2Fmain%2Fresources%2FMETA-INF%2Fresources%2Fapp%2Fviews%2Fuser-resources.html","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/client%2Fenduser%2Fsrc%2Fmain%2Fresources%2FMETA-INF%2Fresources%2Fapp%2Fviews%2Fuser-resources.html?ref=edb0cb33d4ca6ac6b993dfc2f8ee536752f17e02","patch":"@@ -23,6 +23,6 @@\n   <navigation-buttons ng-show=\"createMode\" base=\"create\" current=\"resources\" wizard=\"{{wizard}}\"></navigation-buttons>\n   <navigation-buttons ng-show=\"!createMode\" base=\"update\" current=\"resources\" wizard=\"{{wizard}}\"></navigation-buttons>\n   <div class=\"pull-left\">\n-    <a id=\"cancel\" href=\"#/self\" class=\"btn btn-danger\">Cancel</a>\n+    <a id=\"cancel\" href=\"#/self\" class=\"btn btn-danger\" ng-click=\"logout()\">Cancel</a>\n   </div>\n </div>"},{"sha":"6e72ba6bda127536bdf84b79908ecf7c8de5ebbb","filename":"client/enduser/src/main/resources/META-INF/resources/app/views/user-virtual-schemas.html","status":"modified","additions":1,"deletions":1,"changes":2,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/edb0cb33d4ca6ac6b993dfc2f8ee536752f17e02/client%2Fenduser%2Fsrc%2Fmain%2Fresources%2FMETA-INF%2Fresources%2Fapp%2Fviews%2Fuser-virtual-schemas.html","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/edb0cb33d4ca6ac6b993dfc2f8ee536752f17e02/client%2Fenduser%2Fsrc%2Fmain%2Fresources%2FMETA-INF%2Fresources%2Fapp%2Fviews%2Fuser-virtual-schemas.html","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/client%2Fenduser%2Fsrc%2Fmain%2Fresources%2FMETA-INF%2Fresources%2Fapp%2Fviews%2Fuser-virtual-schemas.html?ref=edb0cb33d4ca6ac6b993dfc2f8ee536752f17e02","patch":"@@ -25,6 +25,6 @@\n   <navigation-buttons ng-show=\"createMode\" base=\"create\" current=\"virtualSchemas\" wizard=\"{{wizard}}\"></navigation-buttons>\n   <navigation-buttons ng-show=\"!createMode\" base=\"update\" current=\"virtualSchemas\" wizard=\"{{wizard}}\"></navigation-buttons>\n   <div class=\"pull-left\">\n-    <a id=\"cancel\" href=\"#/self\" class=\"btn btn-danger\">Cancel</a>\n+    <a id=\"cancel\" href=\"#/self\" class=\"btn btn-danger\" ng-click=\"logout()\">Cancel</a>\n   </div>\n </div>"}]}