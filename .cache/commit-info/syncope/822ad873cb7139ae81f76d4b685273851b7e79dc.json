{"sha":"822ad873cb7139ae81f76d4b685273851b7e79dc","node_id":"MDY6Q29tbWl0NjM2ODc5MDYyOjgyMmFkODczY2I3MTM5YWU4MWY3NmQ0YjY4NTI3Mzg1MWI3ZTc5ZGM=","commit":{"author":{"name":"Francesco Chicchiriccò","email":"ilgrosso@apache.org","date":"2017-04-20T13:26:29Z"},"committer":{"name":"Francesco Chicchiriccò","email":"ilgrosso@apache.org","date":"2017-04-20T13:26:47Z"},"message":"[SYNCOPE-1068] Using Wicket's CsrfPreventionRequestCycleListener, controlled via console.properties and enabled by default","tree":{"sha":"dd4388e103d3675de2e7f97d392a71cd3d48b8b1","url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/git/trees/dd4388e103d3675de2e7f97d392a71cd3d48b8b1"},"url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/git/commits/822ad873cb7139ae81f76d4b685273851b7e79dc","comment_count":0,"verification":{"verified":true,"reason":"valid","signature":"-----BEGIN PGP SIGNATURE-----\nVersion: GnuPG v1\n\niQEcBAABAgAGBQJY+LcXAAoJEGtDE+0nPfKHbCQH/2seU7ixByCpF/3kaW7S6rlm\nIYwVrTzVlNSZ/Cnf5ZIJWMqrFs44ArWb7xIB5jkpvhrppQt0Xbwr0nm2v0Hyoaeh\nVUDxbKulQ50r2l1fE0o8yLRAFG2L7yK5yfJfD4y2FXeX1kRV+mkSiswYyK8lIfjO\nMosSUl1Ju6FI49vWkhCXt1kvzK0lrdb24W3XSfwEJ1zM2LETr2jRwPU3sAaRdJyo\naDKBCkj2dwmYD3V1sKA9OC3sV+di0OiUy301J6sFZKt5a8v/dq4P0570H5qRJEz0\nIw29utVXunDfPmgKkUd2RTZM6ASwFosE5/7DBRNDCQ76TPMvHR6+Wx3aM0DCAuM=\n=mlcc\n-----END PGP SIGNATURE-----","payload":"tree dd4388e103d3675de2e7f97d392a71cd3d48b8b1\nparent b81f9e4283be396fd2e322d12d140a71c6ef0d33\nauthor Francesco Chicchiriccò <ilgrosso@apache.org> 1492694789 +0200\ncommitter Francesco Chicchiriccò <ilgrosso@apache.org> 1492694807 +0200\n\n[SYNCOPE-1068] Using Wicket's CsrfPreventionRequestCycleListener, controlled via console.properties and enabled by default\n"}},"url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/822ad873cb7139ae81f76d4b685273851b7e79dc","html_url":"https://github.com/EnricoDAlessandro97UNI/syncope/commit/822ad873cb7139ae81f76d4b685273851b7e79dc","comments_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/822ad873cb7139ae81f76d4b685273851b7e79dc/comments","author":{"login":"ilgrosso","id":1064664,"node_id":"MDQ6VXNlcjEwNjQ2NjQ=","avatar_url":"https://avatars.githubusercontent.com/u/1064664?v=4","gravatar_id":"","url":"https://api.github.com/users/ilgrosso","html_url":"https://github.com/ilgrosso","followers_url":"https://api.github.com/users/ilgrosso/followers","following_url":"https://api.github.com/users/ilgrosso/following{/other_user}","gists_url":"https://api.github.com/users/ilgrosso/gists{/gist_id}","starred_url":"https://api.github.com/users/ilgrosso/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ilgrosso/subscriptions","organizations_url":"https://api.github.com/users/ilgrosso/orgs","repos_url":"https://api.github.com/users/ilgrosso/repos","events_url":"https://api.github.com/users/ilgrosso/events{/privacy}","received_events_url":"https://api.github.com/users/ilgrosso/received_events","type":"User","site_admin":false},"committer":{"login":"ilgrosso","id":1064664,"node_id":"MDQ6VXNlcjEwNjQ2NjQ=","avatar_url":"https://avatars.githubusercontent.com/u/1064664?v=4","gravatar_id":"","url":"https://api.github.com/users/ilgrosso","html_url":"https://github.com/ilgrosso","followers_url":"https://api.github.com/users/ilgrosso/followers","following_url":"https://api.github.com/users/ilgrosso/following{/other_user}","gists_url":"https://api.github.com/users/ilgrosso/gists{/gist_id}","starred_url":"https://api.github.com/users/ilgrosso/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ilgrosso/subscriptions","organizations_url":"https://api.github.com/users/ilgrosso/orgs","repos_url":"https://api.github.com/users/ilgrosso/repos","events_url":"https://api.github.com/users/ilgrosso/events{/privacy}","received_events_url":"https://api.github.com/users/ilgrosso/received_events","type":"User","site_admin":false},"parents":[{"sha":"b81f9e4283be396fd2e322d12d140a71c6ef0d33","url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/commits/b81f9e4283be396fd2e322d12d140a71c6ef0d33","html_url":"https://github.com/EnricoDAlessandro97UNI/syncope/commit/b81f9e4283be396fd2e322d12d140a71c6ef0d33"}],"stats":{"total":29,"additions":27,"deletions":2},"files":[{"sha":"4c44802bc3f4654114ce6947bc6ce4c4322eeb37","filename":"client/console/src/main/java/org/apache/syncope/client/console/SyncopeConsoleApplication.java","status":"modified","additions":6,"deletions":0,"changes":6,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/822ad873cb7139ae81f76d4b685273851b7e79dc/client%2Fconsole%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fclient%2Fconsole%2FSyncopeConsoleApplication.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/822ad873cb7139ae81f76d4b685273851b7e79dc/client%2Fconsole%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fclient%2Fconsole%2FSyncopeConsoleApplication.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/client%2Fconsole%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fsyncope%2Fclient%2Fconsole%2FSyncopeConsoleApplication.java?ref=822ad873cb7139ae81f76d4b685273851b7e79dc","patch":"@@ -63,6 +63,7 @@\n import org.apache.wicket.authroles.authentication.AuthenticatedWebSession;\n import org.apache.wicket.authroles.authorization.strategies.role.metadata.MetaDataRoleAuthorizationStrategy;\n import org.apache.wicket.markup.html.WebPage;\n+import org.apache.wicket.protocol.http.CsrfPreventionRequestCycleListener;\n import org.apache.wicket.protocol.http.WebApplication;\n import org.apache.wicket.request.resource.IResource;\n import org.apache.wicket.request.resource.ResourceReference;\n@@ -174,6 +175,8 @@ protected void init() {\n         useGZIPCompression = props.getProperty(\"useGZIPCompression\");\n         Args.notNull(useGZIPCompression, \"<useGZIPCompression>\");\n \n+        String csrf = props.getProperty(\"csrf\");\n+\n         // process page properties\n         pageClasses = new HashMap<>();\n         populatePageClasses(props);\n@@ -205,6 +208,9 @@ protected void init() {\n         getMarkupSettings().setStripWicketTags(true);\n         getMarkupSettings().setCompressWhitespace(true);\n \n+        if (BooleanUtils.toBoolean(csrf)) {\n+            getRequestCycleListeners().add(new CsrfPreventionRequestCycleListener());\n+        }\n         getRequestCycleListeners().add(new SyncopeConsoleRequestCycleListener());\n \n         mountPage(\"/login\", getSignInPageClass());"},{"sha":"a3c44f8396533c80cc94124606674e075fb4b79a","filename":"client/console/src/main/resources/console.properties","status":"modified","additions":2,"deletions":0,"changes":2,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/822ad873cb7139ae81f76d4b685273851b7e79dc/client%2Fconsole%2Fsrc%2Fmain%2Fresources%2Fconsole.properties","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/822ad873cb7139ae81f76d4b685273851b7e79dc/client%2Fconsole%2Fsrc%2Fmain%2Fresources%2Fconsole.properties","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/client%2Fconsole%2Fsrc%2Fmain%2Fresources%2Fconsole.properties?ref=822ad873cb7139ae81f76d4b685273851b7e79dc","patch":"@@ -28,6 +28,8 @@ port=8080\n rootPath=/syncope/rest/\n useGZIPCompression=true\n \n+csrf=true\n+\n activitiModelerDirectory=${activiti-modeler.directory}\n \n reconciliationReportKey=c3520ad9-179f-49e7-b315-d684d216dd97"},{"sha":"4ce2e9bdd1d1f046bc03e0db204e2e970d4319a8","filename":"fit/console-reference/src/main/resources/console.properties","status":"modified","additions":2,"deletions":0,"changes":2,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/822ad873cb7139ae81f76d4b685273851b7e79dc/fit%2Fconsole-reference%2Fsrc%2Fmain%2Fresources%2Fconsole.properties","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/822ad873cb7139ae81f76d4b685273851b7e79dc/fit%2Fconsole-reference%2Fsrc%2Fmain%2Fresources%2Fconsole.properties","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/fit%2Fconsole-reference%2Fsrc%2Fmain%2Fresources%2Fconsole.properties?ref=822ad873cb7139ae81f76d4b685273851b7e79dc","patch":"@@ -28,6 +28,8 @@ port=9080\n rootPath=/syncope/rest/\n useGZIPCompression=true\n \n+csrf=true\n+\n activitiModelerDirectory=${activiti-modeler.directory}\n \n reconciliationReportKey=c3520ad9-179f-49e7-b315-d684d216dd97"},{"sha":"fcb6173c9d0854f0a90aeedcffd247b9f9f8ead7","filename":"fit/core-reference/src/test/java/org/apache/syncope/fit/console/AbstractConsoleITCase.java","status":"modified","additions":10,"deletions":0,"changes":10,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/822ad873cb7139ae81f76d4b685273851b7e79dc/fit%2Fcore-reference%2Fsrc%2Ftest%2Fjava%2Forg%2Fapache%2Fsyncope%2Ffit%2Fconsole%2FAbstractConsoleITCase.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/822ad873cb7139ae81f76d4b685273851b7e79dc/fit%2Fcore-reference%2Fsrc%2Ftest%2Fjava%2Forg%2Fapache%2Fsyncope%2Ffit%2Fconsole%2FAbstractConsoleITCase.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/fit%2Fcore-reference%2Fsrc%2Ftest%2Fjava%2Forg%2Fapache%2Fsyncope%2Ffit%2Fconsole%2FAbstractConsoleITCase.java?ref=822ad873cb7139ae81f76d4b685273851b7e79dc","patch":"@@ -21,6 +21,8 @@\n import java.io.Serializable;\n import java.lang.reflect.Method;\n import org.apache.syncope.client.console.pages.Login;\n+import org.apache.syncope.client.lib.SyncopeClientFactoryBean;\n+import org.apache.syncope.common.rest.api.service.SyncopeService;\n import org.apache.wicket.Component;\n import org.apache.wicket.MarkupContainer;\n import org.apache.wicket.behavior.AbstractAjaxBehavior;\n@@ -46,15 +48,23 @@ public abstract class AbstractConsoleITCase {\n \n     protected static final String ADMIN_PWD = \"password\";\n \n+    protected static final String ADDRESS = \"http://localhost:9080/syncope/rest\";\n+\n     protected static final String KEY = \"key\";\n \n     protected static final String SCHEMA = \"schema\";\n \n     protected static WicketTester TESTER;\n \n+    protected static SyncopeService SYNCOPE_SERVICE;\n+\n     @BeforeClass\n     public static void setUp() {\n         TESTER = ConsoleSetup.TESTER;\n+\n+        SYNCOPE_SERVICE = new SyncopeClientFactoryBean().\n+                setAddress(ADDRESS).create(ADMIN_UNAME, ADMIN_PWD).\n+                getService(SyncopeService.class);\n     }\n \n     protected void doLogin(final String user, final String passwd) {"},{"sha":"c6b1aaff8f81e0b4e0b14e5965277c2c88013012","filename":"fit/core-reference/src/test/java/org/apache/syncope/fit/console/AjaxBrowseITCase.java","status":"modified","additions":5,"deletions":2,"changes":7,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/822ad873cb7139ae81f76d4b685273851b7e79dc/fit%2Fcore-reference%2Fsrc%2Ftest%2Fjava%2Forg%2Fapache%2Fsyncope%2Ffit%2Fconsole%2FAjaxBrowseITCase.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/822ad873cb7139ae81f76d4b685273851b7e79dc/fit%2Fcore-reference%2Fsrc%2Ftest%2Fjava%2Forg%2Fapache%2Fsyncope%2Ffit%2Fconsole%2FAjaxBrowseITCase.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/fit%2Fcore-reference%2Fsrc%2Ftest%2Fjava%2Forg%2Fapache%2Fsyncope%2Ffit%2Fconsole%2FAjaxBrowseITCase.java?ref=822ad873cb7139ae81f76d4b685273851b7e79dc","patch":"@@ -30,6 +30,7 @@\n import org.apache.syncope.client.console.pages.Types;\n import org.apache.syncope.client.console.pages.Workflow;\n import org.apache.syncope.client.console.topology.Topology;\n+import org.apache.syncope.fit.ActivitiDetector;\n import org.junit.Test;\n \n // Please, keep the class name as is in order to respect the execution order. It seems that from wicket 7.5.0 the \n@@ -69,8 +70,10 @@ public void browsingBookmarkablePageLink() {\n         TESTER.clickLink(\"body:reportsLI:reports\");\n         TESTER.assertRenderedPage(Reports.class);\n \n-        TESTER.clickLink(\"body:configurationLI:configurationUL:workflowLI:workflow\");\n-        TESTER.assertRenderedPage(Workflow.class);\n+        if (ActivitiDetector.isActivitiEnabledForUsers(SYNCOPE_SERVICE)) {\n+            TESTER.clickLink(\"body:configurationLI:configurationUL:workflowLI:workflow\");\n+            TESTER.assertRenderedPage(Workflow.class);\n+        }\n \n         TESTER.clickLink(\"body:configurationLI:configurationUL:logsLI:logs\");\n         TESTER.assertRenderedPage(Logs.class);"},{"sha":"63ed279c4a2b2193b3f3d4d73c2fcd19804ce8af","filename":"fit/core-reference/src/test/resources/console.properties","status":"modified","additions":2,"deletions":0,"changes":2,"blob_url":"https://github.com/EnricoDAlessandro97UNI/syncope/blob/822ad873cb7139ae81f76d4b685273851b7e79dc/fit%2Fcore-reference%2Fsrc%2Ftest%2Fresources%2Fconsole.properties","raw_url":"https://github.com/EnricoDAlessandro97UNI/syncope/raw/822ad873cb7139ae81f76d4b685273851b7e79dc/fit%2Fcore-reference%2Fsrc%2Ftest%2Fresources%2Fconsole.properties","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/syncope/contents/fit%2Fcore-reference%2Fsrc%2Ftest%2Fresources%2Fconsole.properties?ref=822ad873cb7139ae81f76d4b685273851b7e79dc","patch":"@@ -28,6 +28,8 @@ port=9080\n rootPath=/syncope/rest/\n useGZIPCompression=true\n \n+csrf=false\n+\n activitiModelerDirectory=${activiti-modeler.directory}\n \n reconciliationReportKey=c3520ad9-179f-49e7-b315-d684d216dd97"}]}