{"sha":"9a506c261d3702ddd3f39556f4331b91da952a6e","node_id":"MDY6Q29tbWl0NDc4NTkyNTI2OjlhNTA2YzI2MWQzNzAyZGRkM2YzOTU1NmY0MzMxYjkxZGE5NTJhNmU=","commit":{"author":{"name":"Charan Reddy Guttapalem","email":"cguttapalem@salesforce.com","date":"2016-12-21T00:42:33Z"},"committer":{"name":"JV","email":"vjujjuri@salesforce.com","date":"2016-12-21T00:42:33Z"},"message":"BOOKKEEPER-983: BookieShell LedgerDelete Command\n\nBookieShell Command for LedgerDelete\n\nAuthor: Charan Reddy Guttapalem <cguttapalem@salesforce.com>\n\nReviewers: Sijie Guo <sijie@apache.org>\n\nCloses #90 from reddycharan/ledgerdeletecommand","tree":{"sha":"01147014a8d231def240e631c9b54b7c1156feff","url":"https://api.github.com/repos/EnricoDAlessandro97UNI/bookkeeper/git/trees/01147014a8d231def240e631c9b54b7c1156feff"},"url":"https://api.github.com/repos/EnricoDAlessandro97UNI/bookkeeper/git/commits/9a506c261d3702ddd3f39556f4331b91da952a6e","comment_count":0,"verification":{"verified":false,"reason":"unsigned","signature":null,"payload":null}},"url":"https://api.github.com/repos/EnricoDAlessandro97UNI/bookkeeper/commits/9a506c261d3702ddd3f39556f4331b91da952a6e","html_url":"https://github.com/EnricoDAlessandro97UNI/bookkeeper/commit/9a506c261d3702ddd3f39556f4331b91da952a6e","comments_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/bookkeeper/commits/9a506c261d3702ddd3f39556f4331b91da952a6e/comments","author":{"login":"reddycharan","id":13989266,"node_id":"MDQ6VXNlcjEzOTg5MjY2","avatar_url":"https://avatars.githubusercontent.com/u/13989266?v=4","gravatar_id":"","url":"https://api.github.com/users/reddycharan","html_url":"https://github.com/reddycharan","followers_url":"https://api.github.com/users/reddycharan/followers","following_url":"https://api.github.com/users/reddycharan/following{/other_user}","gists_url":"https://api.github.com/users/reddycharan/gists{/gist_id}","starred_url":"https://api.github.com/users/reddycharan/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/reddycharan/subscriptions","organizations_url":"https://api.github.com/users/reddycharan/orgs","repos_url":"https://api.github.com/users/reddycharan/repos","events_url":"https://api.github.com/users/reddycharan/events{/privacy}","received_events_url":"https://api.github.com/users/reddycharan/received_events","type":"User","site_admin":false},"committer":{"login":"jvrao","id":41390,"node_id":"MDQ6VXNlcjQxMzkw","avatar_url":"https://avatars.githubusercontent.com/u/41390?v=4","gravatar_id":"","url":"https://api.github.com/users/jvrao","html_url":"https://github.com/jvrao","followers_url":"https://api.github.com/users/jvrao/followers","following_url":"https://api.github.com/users/jvrao/following{/other_user}","gists_url":"https://api.github.com/users/jvrao/gists{/gist_id}","starred_url":"https://api.github.com/users/jvrao/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jvrao/subscriptions","organizations_url":"https://api.github.com/users/jvrao/orgs","repos_url":"https://api.github.com/users/jvrao/repos","events_url":"https://api.github.com/users/jvrao/events{/privacy}","received_events_url":"https://api.github.com/users/jvrao/received_events","type":"User","site_admin":false},"parents":[{"sha":"54863473365572f955a8e7a3e022614f5f5e4604","url":"https://api.github.com/repos/EnricoDAlessandro97UNI/bookkeeper/commits/54863473365572f955a8e7a3e022614f5f5e4604","html_url":"https://github.com/EnricoDAlessandro97UNI/bookkeeper/commit/54863473365572f955a8e7a3e022614f5f5e4604"}],"stats":{"total":75,"additions":74,"deletions":1},"files":[{"sha":"678788e2f2dbc8d70a8b7bac5cdb967d5430eb9a","filename":"bookkeeper-server/src/main/java/org/apache/bookkeeper/bookie/BookieShell.java","status":"modified","additions":74,"deletions":1,"changes":75,"blob_url":"https://github.com/EnricoDAlessandro97UNI/bookkeeper/blob/9a506c261d3702ddd3f39556f4331b91da952a6e/bookkeeper-server%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fbookkeeper%2Fbookie%2FBookieShell.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/bookkeeper/raw/9a506c261d3702ddd3f39556f4331b91da952a6e/bookkeeper-server%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fbookkeeper%2Fbookie%2FBookieShell.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/bookkeeper/contents/bookkeeper-server%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fbookkeeper%2Fbookie%2FBookieShell.java?ref=9a506c261d3702ddd3f39556f4331b91da952a6e","patch":"@@ -58,6 +58,7 @@\n import org.apache.bookkeeper.proto.BookkeeperInternalCallbacks.GenericCallback;\n import org.apache.bookkeeper.replication.AuditorElector;\n import org.apache.bookkeeper.util.EntryFormatter;\n+import org.apache.bookkeeper.util.IOUtils;\n import org.apache.bookkeeper.util.MathUtils;\n import org.apache.bookkeeper.util.Tool;\n import org.apache.bookkeeper.versioning.Version;\n@@ -111,6 +112,7 @@ public class BookieShell implements Tool {\n     static final String CMD_UPDATECOOKIE = \"updatecookie\";\n     static final String CMD_EXPANDSTORAGE = \"expandstorage\";\n     static final String CMD_UPDATELEDGER = \"updateledgers\";\n+    static final String CMD_DELETELEDGER = \"deleteledger\";\n     static final String CMD_HELP = \"help\";\n \n     final ServerConfiguration bkConf = new ServerConfiguration();\n@@ -1553,6 +1555,75 @@ public void progress(long updated, long issued) {\n \n     }\n \n+    /**\n+     * Command to delete a given ledger.\n+     */\n+    class DeleteLedgerCmd extends MyCommand {\n+        Options lOpts = new Options();\n+\n+        DeleteLedgerCmd() {\n+            super(CMD_DELETELEDGER);\n+            lOpts.addOption(\"l\", \"ledgerid\", true, \"Ledger ID\");\n+            lOpts.addOption(\"f\", \"force\", false, \"Whether to force delete the Ledger without prompt..?\");\n+        }\n+\n+        @Override\n+        public int runCmd(CommandLine cmdLine) throws Exception {\n+            final String lidStr = cmdLine.getOptionValue(\"ledgerid\");\n+            if (StringUtils.isBlank(lidStr)) {\n+                LOG.error(\"Invalid argument list!\");\n+                this.printUsage();\n+                return -1;\n+            }\n+\n+            final long lid;\n+            try {\n+                lid = Long.parseLong(lidStr);\n+            } catch (NumberFormatException nfe) {\n+                System.err.println(\"ERROR: invalid ledger id \" + lidStr);\n+                printUsage();\n+                return -1;\n+            }\n+\n+            boolean force = cmdLine.hasOption(\"f\");\n+            boolean confirm = false;\n+            if (!force) {\n+                confirm = IOUtils.confirmPrompt(\"Are you sure to delete Ledger : \" + lid + \"?\");\n+            }\n+\n+            BookKeeper bk = null;\n+            try {\n+                if (force || confirm) {\n+                    ClientConfiguration conf = new ClientConfiguration();\n+                    conf.addConfiguration(bkConf);\n+                    bk = new BookKeeper(conf);\n+                    bk.deleteLedger(lid);\n+                }\n+            } finally {\n+                if (bk != null) {\n+                    bk.close();\n+                }\n+            }\n+\n+            return 0;\n+        }\n+\n+        @Override\n+        String getDescription() {\n+            return \"Delete a ledger\";\n+        }\n+\n+        @Override\n+        String getUsage() {\n+            return \"deleteledger -ledgerid <ledgerid> [-force]\";\n+        }\n+\n+        @Override\n+        Options getOptions() {\n+            return lOpts;\n+        }\n+    }\n+\n     /**\n      * A facility for reporting update ledger progress.\n      */\n@@ -1581,6 +1652,7 @@ public interface UpdateLedgerNotifier {\n         commands.put(CMD_UPDATECOOKIE, new UpdateCookieCmd());\n         commands.put(CMD_EXPANDSTORAGE, new ExpandStorageCmd());\n         commands.put(CMD_UPDATELEDGER, new UpdateLedgerCmd());\n+        commands.put(CMD_DELETELEDGER, new DeleteLedgerCmd());\n         commands.put(CMD_HELP, new HelpCmd());\n     }\n \n@@ -1601,7 +1673,8 @@ public void setConf(Configuration conf) throws Exception {\n     }\n \n     private void printShellUsage() {\n-        System.err.println(\"Usage: BookieShell [-conf configuration] <command>\");\n+        System.err.println(\n+                \"Usage: BookieShell [-conf configuration] <command>\");\n         System.err.println();\n         List<String> commandNames = new ArrayList<String>();\n         for (MyCommand c : commands.values()) {"}]}