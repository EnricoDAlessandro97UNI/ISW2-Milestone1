{"sha":"1a2e017b65812e6e50975213a365aa37eba9fa96","node_id":"MDY6Q29tbWl0NDc4NTkyNTI2OjFhMmUwMTdiNjU4MTJlNmU1MDk3NTIxM2EzNjVhYTM3ZWJhOWZhOTY=","commit":{"author":{"name":"Matteo Merli","email":"mmerli@apache.org","date":"2017-05-09T21:06:02Z"},"committer":{"name":"Matteo Merli","email":"mmerli@apache.org","date":"2017-05-09T21:06:02Z"},"message":"BOOKKEEPER-1051: Fast shutdown for GarbageCollectorThread\n\nSeveral unit tests are taking very long time to complete (eg: `BookieLedgerIndexTest` taking ~10 minutes).\nThe reason is that these tests are playing with the ZK quorum shutting it down and after the test succeeds, the shutdown phase is taking long time, since we try to do graceful shutdown with 1min wait time.\nI think is better to interrupt immediately the garbage collector thread when shutting down the bookie.\n\nAuthor: Matteo Merli <mmerli@apache.org>\n\nReviewers: Enrico Olivelli <None>\n\nCloses #141 from merlimat/fast-gc-thread-shutdown","tree":{"sha":"b338b2e146b7197cb182e80de98ae43f74bd6910","url":"https://api.github.com/repos/EnricoDAlessandro97UNI/bookkeeper/git/trees/b338b2e146b7197cb182e80de98ae43f74bd6910"},"url":"https://api.github.com/repos/EnricoDAlessandro97UNI/bookkeeper/git/commits/1a2e017b65812e6e50975213a365aa37eba9fa96","comment_count":0,"verification":{"verified":false,"reason":"unsigned","signature":null,"payload":null}},"url":"https://api.github.com/repos/EnricoDAlessandro97UNI/bookkeeper/commits/1a2e017b65812e6e50975213a365aa37eba9fa96","html_url":"https://github.com/EnricoDAlessandro97UNI/bookkeeper/commit/1a2e017b65812e6e50975213a365aa37eba9fa96","comments_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/bookkeeper/commits/1a2e017b65812e6e50975213a365aa37eba9fa96/comments","author":{"login":"merlimat","id":62500,"node_id":"MDQ6VXNlcjYyNTAw","avatar_url":"https://avatars.githubusercontent.com/u/62500?v=4","gravatar_id":"","url":"https://api.github.com/users/merlimat","html_url":"https://github.com/merlimat","followers_url":"https://api.github.com/users/merlimat/followers","following_url":"https://api.github.com/users/merlimat/following{/other_user}","gists_url":"https://api.github.com/users/merlimat/gists{/gist_id}","starred_url":"https://api.github.com/users/merlimat/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/merlimat/subscriptions","organizations_url":"https://api.github.com/users/merlimat/orgs","repos_url":"https://api.github.com/users/merlimat/repos","events_url":"https://api.github.com/users/merlimat/events{/privacy}","received_events_url":"https://api.github.com/users/merlimat/received_events","type":"User","site_admin":false},"committer":{"login":"merlimat","id":62500,"node_id":"MDQ6VXNlcjYyNTAw","avatar_url":"https://avatars.githubusercontent.com/u/62500?v=4","gravatar_id":"","url":"https://api.github.com/users/merlimat","html_url":"https://github.com/merlimat","followers_url":"https://api.github.com/users/merlimat/followers","following_url":"https://api.github.com/users/merlimat/following{/other_user}","gists_url":"https://api.github.com/users/merlimat/gists{/gist_id}","starred_url":"https://api.github.com/users/merlimat/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/merlimat/subscriptions","organizations_url":"https://api.github.com/users/merlimat/orgs","repos_url":"https://api.github.com/users/merlimat/repos","events_url":"https://api.github.com/users/merlimat/events{/privacy}","received_events_url":"https://api.github.com/users/merlimat/received_events","type":"User","site_admin":false},"parents":[{"sha":"61a5446b8923e5ce0b2a46891a385fd480275bac","url":"https://api.github.com/repos/EnricoDAlessandro97UNI/bookkeeper/commits/61a5446b8923e5ce0b2a46891a385fd480275bac","html_url":"https://github.com/EnricoDAlessandro97UNI/bookkeeper/commit/61a5446b8923e5ce0b2a46891a385fd480275bac"}],"stats":{"total":8,"additions":3,"deletions":5},"files":[{"sha":"b524b219fbc7e0f447afee5552e109c2401317f5","filename":"bookkeeper-server/src/main/java/org/apache/bookkeeper/bookie/GarbageCollectorThread.java","status":"modified","additions":3,"deletions":5,"changes":8,"blob_url":"https://github.com/EnricoDAlessandro97UNI/bookkeeper/blob/1a2e017b65812e6e50975213a365aa37eba9fa96/bookkeeper-server%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fbookkeeper%2Fbookie%2FGarbageCollectorThread.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/bookkeeper/raw/1a2e017b65812e6e50975213a365aa37eba9fa96/bookkeeper-server%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fbookkeeper%2Fbookie%2FGarbageCollectorThread.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/bookkeeper/contents/bookkeeper-server%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fbookkeeper%2Fbookie%2FGarbageCollectorThread.java?ref=1a2e017b65812e6e50975213a365aa37eba9fa96","patch":"@@ -487,11 +487,9 @@ public void shutdown() throws InterruptedException {\n             // Wait till the thread stops compacting\n             Thread.sleep(100);\n         }\n-        gcExecutor.shutdown();\n-        if (gcExecutor.awaitTermination(60, TimeUnit.SECONDS)) {\n-            LOG.warn(\"GC executor did not shut down in 60 seconds. Killing\");\n-            gcExecutor.shutdownNow();\n-        }\n+\n+        // Interrupt GC executor thread\n+        gcExecutor.shutdownNow();\n     }\n \n     /**"}]}