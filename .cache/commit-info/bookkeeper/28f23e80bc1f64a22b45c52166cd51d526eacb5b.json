{"sha":"28f23e80bc1f64a22b45c52166cd51d526eacb5b","node_id":"MDY6Q29tbWl0NDc4NTkyNTI2OjI4ZjIzZTgwYmMxZjY0YTIyYjQ1YzUyMTY2Y2Q1MWQ1MjZlYWNiNWI=","commit":{"author":{"name":"Andrey Yegorov","email":"ayegorov@salesforce.com","date":"2016-08-16T17:42:13Z"},"committer":{"name":"Sijie Guo","email":"sijie@apache.org","date":"2016-08-16T17:42:13Z"},"message":"BOOKKEEPER-937: Upgrade protobuf to 2.6\n\nprotobuf/protoc 2.4 cannot be installed with brew on mac and building it on mac always result is build errors hence leaves an option of switching to linux to run protoc.\nI upgraded to 2.6 instead. It is compatible with 2.4 on the wire and shaded so should not create any problems. All tests passed.\nPlease ignore changes in java files in attached patch during review; these are auto-generated.\n\nprotobuf 2.4 in compat* dependencies is shaded now to not conflict with 2.6.\n\nAuthor: Andrey Yegorov <ayegorov@salesforce.com>\n\nReviewers: eolivelli@gmail.com <eolivelli@gmail.com>, zhaijia03@gmail.com <zhaijia03@gmail.com>, sijie@apache.org <sijie@apache.org>\n\nCloses #51 from dlg99/task/BOOKKEEPER-937","tree":{"sha":"96cee4b6ccfb46aab6f1f1ef7ae1f4a6f1185445","url":"https://api.github.com/repos/EnricoDAlessandro97UNI/bookkeeper/git/trees/96cee4b6ccfb46aab6f1f1ef7ae1f4a6f1185445"},"url":"https://api.github.com/repos/EnricoDAlessandro97UNI/bookkeeper/git/commits/28f23e80bc1f64a22b45c52166cd51d526eacb5b","comment_count":0,"verification":{"verified":false,"reason":"unsigned","signature":null,"payload":null}},"url":"https://api.github.com/repos/EnricoDAlessandro97UNI/bookkeeper/commits/28f23e80bc1f64a22b45c52166cd51d526eacb5b","html_url":"https://github.com/EnricoDAlessandro97UNI/bookkeeper/commit/28f23e80bc1f64a22b45c52166cd51d526eacb5b","comments_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/bookkeeper/commits/28f23e80bc1f64a22b45c52166cd51d526eacb5b/comments","author":null,"committer":{"login":"sijie","id":1217863,"node_id":"MDQ6VXNlcjEyMTc4NjM=","avatar_url":"https://avatars.githubusercontent.com/u/1217863?v=4","gravatar_id":"","url":"https://api.github.com/users/sijie","html_url":"https://github.com/sijie","followers_url":"https://api.github.com/users/sijie/followers","following_url":"https://api.github.com/users/sijie/following{/other_user}","gists_url":"https://api.github.com/users/sijie/gists{/gist_id}","starred_url":"https://api.github.com/users/sijie/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sijie/subscriptions","organizations_url":"https://api.github.com/users/sijie/orgs","repos_url":"https://api.github.com/users/sijie/repos","events_url":"https://api.github.com/users/sijie/events{/privacy}","received_events_url":"https://api.github.com/users/sijie/received_events","type":"User","site_admin":false},"parents":[{"sha":"64f596f4563436b3e4cfe0f57714fc3012778b4c","url":"https://api.github.com/repos/EnricoDAlessandro97UNI/bookkeeper/commits/64f596f4563436b3e4cfe0f57714fc3012778b4c","html_url":"https://github.com/EnricoDAlessandro97UNI/bookkeeper/commit/64f596f4563436b3e4cfe0f57714fc3012778b4c"}],"stats":{"total":8494,"additions":5765,"deletions":2729},"files":[{"sha":"e47d0d3e498d1df338e297fea8237c14aa8b967a","filename":"bookkeeper-server/pom.xml","status":"modified","additions":4,"deletions":0,"changes":4,"blob_url":"https://github.com/EnricoDAlessandro97UNI/bookkeeper/blob/28f23e80bc1f64a22b45c52166cd51d526eacb5b/bookkeeper-server%2Fpom.xml","raw_url":"https://github.com/EnricoDAlessandro97UNI/bookkeeper/raw/28f23e80bc1f64a22b45c52166cd51d526eacb5b/bookkeeper-server%2Fpom.xml","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/bookkeeper/contents/bookkeeper-server%2Fpom.xml?ref=28f23e80bc1f64a22b45c52166cd51d526eacb5b","patch":"@@ -199,6 +199,10 @@\n               </artifactSet>\n               <minimizeJar>true</minimizeJar>\n               <relocations>\n+                <relocation>\n+                  <pattern>com.google.protobuf</pattern>\n+                  <shadedPattern>bk-shade.com.google.proto_${protobuf.version}</shadedPattern>\n+                </relocation>\n                 <relocation>\n                   <pattern>com.google</pattern>\n                   <shadedPattern>bk-shade.com.google</shadedPattern>"},{"sha":"915675142c07b4166fd990df716b888551a90408","filename":"bookkeeper-server/src/main/java/org/apache/bookkeeper/proto/BookkeeperProtocol.java","status":"modified","additions":2901,"deletions":1356,"changes":4257,"blob_url":"https://github.com/EnricoDAlessandro97UNI/bookkeeper/blob/28f23e80bc1f64a22b45c52166cd51d526eacb5b/bookkeeper-server%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fbookkeeper%2Fproto%2FBookkeeperProtocol.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/bookkeeper/raw/28f23e80bc1f64a22b45c52166cd51d526eacb5b/bookkeeper-server%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fbookkeeper%2Fproto%2FBookkeeperProtocol.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/bookkeeper/contents/bookkeeper-server%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fbookkeeper%2Fproto%2FBookkeeperProtocol.java?ref=28f23e80bc1f64a22b45c52166cd51d526eacb5b"},{"sha":"47c7671df007b7bf5f4693ed7e611c85c0f17254","filename":"bookkeeper-server/src/main/java/org/apache/bookkeeper/proto/DataFormats.java","status":"modified","additions":2779,"deletions":1345,"changes":4124,"blob_url":"https://github.com/EnricoDAlessandro97UNI/bookkeeper/blob/28f23e80bc1f64a22b45c52166cd51d526eacb5b/bookkeeper-server%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fbookkeeper%2Fproto%2FDataFormats.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/bookkeeper/raw/28f23e80bc1f64a22b45c52166cd51d526eacb5b/bookkeeper-server%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fbookkeeper%2Fproto%2FDataFormats.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/bookkeeper/contents/bookkeeper-server%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fbookkeeper%2Fproto%2FDataFormats.java?ref=28f23e80bc1f64a22b45c52166cd51d526eacb5b"},{"sha":"84e1a77533d8ac099630cb68cfdf02b1677a6216","filename":"bookkeeper-server/src/test/java/org/apache/bookkeeper/proto/TestDataFormats.java","status":"modified","additions":49,"deletions":26,"changes":75,"blob_url":"https://github.com/EnricoDAlessandro97UNI/bookkeeper/blob/28f23e80bc1f64a22b45c52166cd51d526eacb5b/bookkeeper-server%2Fsrc%2Ftest%2Fjava%2Forg%2Fapache%2Fbookkeeper%2Fproto%2FTestDataFormats.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/bookkeeper/raw/28f23e80bc1f64a22b45c52166cd51d526eacb5b/bookkeeper-server%2Fsrc%2Ftest%2Fjava%2Forg%2Fapache%2Fbookkeeper%2Fproto%2FTestDataFormats.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/bookkeeper/contents/bookkeeper-server%2Fsrc%2Ftest%2Fjava%2Forg%2Fapache%2Fbookkeeper%2Fproto%2FTestDataFormats.java?ref=28f23e80bc1f64a22b45c52166cd51d526eacb5b","patch":"@@ -9,20 +9,41 @@ public static void registerAllExtensions(\n       com.google.protobuf.ExtensionRegistry registry) {\n     registry.add(org.apache.bookkeeper.proto.TestDataFormats.messageType);\n   }\n+  /**\n+   * Protobuf enum {@code AuthMessageType}\n+   */\n   public enum AuthMessageType\n       implements com.google.protobuf.ProtocolMessageEnum {\n+    /**\n+     * <code>SUCCESS_RESPONSE = 1;</code>\n+     */\n     SUCCESS_RESPONSE(0, 1),\n+    /**\n+     * <code>FAILURE_RESPONSE = 2;</code>\n+     */\n     FAILURE_RESPONSE(1, 2),\n+    /**\n+     * <code>PAYLOAD_MESSAGE = 3;</code>\n+     */\n     PAYLOAD_MESSAGE(2, 3),\n     ;\n-    \n+\n+    /**\n+     * <code>SUCCESS_RESPONSE = 1;</code>\n+     */\n     public static final int SUCCESS_RESPONSE_VALUE = 1;\n+    /**\n+     * <code>FAILURE_RESPONSE = 2;</code>\n+     */\n     public static final int FAILURE_RESPONSE_VALUE = 2;\n+    /**\n+     * <code>PAYLOAD_MESSAGE = 3;</code>\n+     */\n     public static final int PAYLOAD_MESSAGE_VALUE = 3;\n-    \n-    \n+\n+\n     public final int getNumber() { return value; }\n-    \n+\n     public static AuthMessageType valueOf(int value) {\n       switch (value) {\n         case 1: return SUCCESS_RESPONSE;\n@@ -31,7 +52,7 @@ public static AuthMessageType valueOf(int value) {\n         default: return null;\n       }\n     }\n-    \n+\n     public static com.google.protobuf.Internal.EnumLiteMap<AuthMessageType>\n         internalGetValueMap() {\n       return internalValueMap;\n@@ -43,7 +64,7 @@ public AuthMessageType findValueByNumber(int number) {\n               return AuthMessageType.valueOf(number);\n             }\n           };\n-    \n+\n     public final com.google.protobuf.Descriptors.EnumValueDescriptor\n         getValueDescriptor() {\n       return getDescriptor().getValues().get(index);\n@@ -56,11 +77,9 @@ public AuthMessageType findValueByNumber(int number) {\n         getDescriptor() {\n       return org.apache.bookkeeper.proto.TestDataFormats.getDescriptor().getEnumTypes().get(0);\n     }\n-    \n-    private static final AuthMessageType[] VALUES = {\n-      SUCCESS_RESPONSE, FAILURE_RESPONSE, PAYLOAD_MESSAGE, \n-    };\n-    \n+\n+    private static final AuthMessageType[] VALUES = values();\n+\n     public static AuthMessageType valueOf(\n         com.google.protobuf.Descriptors.EnumValueDescriptor desc) {\n       if (desc.getType() != getDescriptor()) {\n@@ -69,27 +88,30 @@ public static AuthMessageType valueOf(\n       }\n       return VALUES[desc.getIndex()];\n     }\n-    \n+\n     private final int index;\n     private final int value;\n-    \n+\n     private AuthMessageType(int index, int value) {\n       this.index = index;\n       this.value = value;\n     }\n-    \n+\n     // @@protoc_insertion_point(enum_scope:AuthMessageType)\n   }\n-  \n+\n   public static final int MESSAGETYPE_FIELD_NUMBER = 1000;\n+  /**\n+   * <code>extend .AuthMessage { ... }</code>\n+   */\n   public static final\n     com.google.protobuf.GeneratedMessage.GeneratedExtension<\n       org.apache.bookkeeper.proto.BookkeeperProtocol.AuthMessage,\n       org.apache.bookkeeper.proto.TestDataFormats.AuthMessageType> messageType = com.google.protobuf.GeneratedMessage\n           .newFileScopedGeneratedExtension(\n         org.apache.bookkeeper.proto.TestDataFormats.AuthMessageType.class,\n         null);\n-  \n+\n   public static com.google.protobuf.Descriptors.FileDescriptor\n       getDescriptor() {\n     return descriptor;\n@@ -102,25 +124,26 @@ private AuthMessageType(int index, int value) {\n       \"src/main/proto/BookkeeperProtocol.proto*\" +\n       \"R\\n\\017AuthMessageType\\022\\024\\n\\020SUCCESS_RESPONSE\\020\\001\" +\n       \"\\022\\024\\n\\020FAILURE_RESPONSE\\020\\002\\022\\023\\n\\017PAYLOAD_MESSAG\" +\n-      \"E\\020\\003:4\\n\\013messageType\\022\\014.AuthMessage\\030\\350\\007 \\002(\\0162\" +\n+      \"E\\020\\003:4\\n\\013messageType\\022\\014.AuthMessage\\030\\350\\007 \\001(\\0162\" +\n       \"\\020.AuthMessageTypeB\\037\\n\\033org.apache.bookkeep\" +\n       \"er.protoH\\001\"\n     };\n     com.google.protobuf.Descriptors.FileDescriptor.InternalDescriptorAssigner assigner =\n-      new com.google.protobuf.Descriptors.FileDescriptor.InternalDescriptorAssigner() {\n-        public com.google.protobuf.ExtensionRegistry assignDescriptors(\n-            com.google.protobuf.Descriptors.FileDescriptor root) {\n-          descriptor = root;\n-          messageType.internalInit(descriptor.getExtensions().get(0));\n-          return null;\n-        }\n-      };\n+        new com.google.protobuf.Descriptors.FileDescriptor.    InternalDescriptorAssigner() {\n+          public com.google.protobuf.ExtensionRegistry assignDescriptors(\n+              com.google.protobuf.Descriptors.FileDescriptor root) {\n+            descriptor = root;\n+            return null;\n+          }\n+        };\n     com.google.protobuf.Descriptors.FileDescriptor\n       .internalBuildGeneratedFileFrom(descriptorData,\n         new com.google.protobuf.Descriptors.FileDescriptor[] {\n           org.apache.bookkeeper.proto.BookkeeperProtocol.getDescriptor(),\n         }, assigner);\n+    messageType.internalInit(descriptor.getExtensions().get(0));\n+    org.apache.bookkeeper.proto.BookkeeperProtocol.getDescriptor();\n   }\n-  \n+\n   // @@protoc_insertion_point(outer_class_scope)\n }"},{"sha":"be149ed7d553bb8c66ed19af614cb19e4571cf73","filename":"bookkeeper-server/src/test/proto/TestDataFormats.proto","status":"modified","additions":1,"deletions":1,"changes":2,"blob_url":"https://github.com/EnricoDAlessandro97UNI/bookkeeper/blob/28f23e80bc1f64a22b45c52166cd51d526eacb5b/bookkeeper-server%2Fsrc%2Ftest%2Fproto%2FTestDataFormats.proto","raw_url":"https://github.com/EnricoDAlessandro97UNI/bookkeeper/raw/28f23e80bc1f64a22b45c52166cd51d526eacb5b/bookkeeper-server%2Fsrc%2Ftest%2Fproto%2FTestDataFormats.proto","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/bookkeeper/contents/bookkeeper-server%2Fsrc%2Ftest%2Fproto%2FTestDataFormats.proto?ref=28f23e80bc1f64a22b45c52166cd51d526eacb5b","patch":"@@ -30,5 +30,5 @@ enum AuthMessageType {\n  *\n  */\n extend AuthMessage {\n-    required AuthMessageType messageType = 1000;\n+    optional AuthMessageType messageType = 1000;\n }"},{"sha":"3530174c51e0da05c562a78da4951fe6bfdc330c","filename":"compat-deps/bookkeeper-server-compat-4.0.0/pom.xml","status":"modified","additions":10,"deletions":0,"changes":10,"blob_url":"https://github.com/EnricoDAlessandro97UNI/bookkeeper/blob/28f23e80bc1f64a22b45c52166cd51d526eacb5b/compat-deps%2Fbookkeeper-server-compat-4.0.0%2Fpom.xml","raw_url":"https://github.com/EnricoDAlessandro97UNI/bookkeeper/raw/28f23e80bc1f64a22b45c52166cd51d526eacb5b/compat-deps%2Fbookkeeper-server-compat-4.0.0%2Fpom.xml","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/bookkeeper/contents/compat-deps%2Fbookkeeper-server-compat-4.0.0%2Fpom.xml?ref=28f23e80bc1f64a22b45c52166cd51d526eacb5b","patch":"@@ -32,6 +32,11 @@\n     <project.build.sourceEncoding>UTF-8</project.build.sourceEncoding>\n   </properties>\n   <dependencies>\n+    <dependency>\n+      <groupId>com.google.protobuf</groupId>\n+      <artifactId>protobuf-java</artifactId>\n+      <version>2.4.1</version>\n+    </dependency>\n     <dependency>\n       <groupId>org.apache.bookkeeper</groupId>\n       <artifactId>bookkeeper-server</artifactId>\n@@ -54,6 +59,7 @@\n               <createDependencyReducedPom>false</createDependencyReducedPom>\n               <artifactSet>\n                 <includes>\n+                  <include>com.google.protobuf:protobuf-java</include>\n                   <include>org.apache.*:*</include>\n                   <include>org.jboss.*:*</include>\n                   <include>commons-*:*</include>\n@@ -63,6 +69,10 @@\n                 </excludes>\n               </artifactSet>\n               <relocations>\n+                <relocation>\n+                  <pattern>com.google.protobuf</pattern>\n+                  <shadedPattern>bk-shade.com.google.proto_bk_v4_0_0</shadedPattern>\n+                </relocation>\n                 <relocation>\n                   <pattern>org.apache</pattern>\n                   <shadedPattern>org.apache.bk_v4_0_0</shadedPattern>"},{"sha":"9b716e46a826fdf69cba3ff862571c9d0d42704e","filename":"compat-deps/bookkeeper-server-compat-4.1.0/pom.xml","status":"modified","additions":10,"deletions":0,"changes":10,"blob_url":"https://github.com/EnricoDAlessandro97UNI/bookkeeper/blob/28f23e80bc1f64a22b45c52166cd51d526eacb5b/compat-deps%2Fbookkeeper-server-compat-4.1.0%2Fpom.xml","raw_url":"https://github.com/EnricoDAlessandro97UNI/bookkeeper/raw/28f23e80bc1f64a22b45c52166cd51d526eacb5b/compat-deps%2Fbookkeeper-server-compat-4.1.0%2Fpom.xml","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/bookkeeper/contents/compat-deps%2Fbookkeeper-server-compat-4.1.0%2Fpom.xml?ref=28f23e80bc1f64a22b45c52166cd51d526eacb5b","patch":"@@ -32,6 +32,11 @@\n     <project.build.sourceEncoding>UTF-8</project.build.sourceEncoding>\n   </properties>\n   <dependencies>\n+    <dependency>\n+      <groupId>com.google.protobuf</groupId>\n+      <artifactId>protobuf-java</artifactId>\n+      <version>2.4.1</version>\n+    </dependency>\n     <dependency>\n       <groupId>org.apache.bookkeeper</groupId>\n       <artifactId>bookkeeper-server</artifactId>\n@@ -54,6 +59,7 @@\n               <createDependencyReducedPom>false</createDependencyReducedPom>\n               <artifactSet>\n                 <includes>\n+                  <include>com.google.protobuf:protobuf-java</include>\n                   <include>org.apache.*:*</include>\n                   <include>org.jboss.*:*</include>\n                   <include>commons-*:*</include>\n@@ -63,6 +69,10 @@\n                 </excludes>\n               </artifactSet>\n               <relocations>\n+                <relocation>\n+                  <pattern>com.google.protobuf</pattern>\n+                  <shadedPattern>bk-shade.com.google.proto_bk_v4_1_0</shadedPattern>\n+                </relocation>\n                 <relocation>\n                   <pattern>org.apache.commons</pattern>\n                   <shadedPattern>org.apache.bk_v4_1_0.commons</shadedPattern>"},{"sha":"729d68b76dd6f627e2201b04c53bf3bcb175fe34","filename":"compat-deps/bookkeeper-server-compat-4.2.0/pom.xml","status":"modified","additions":10,"deletions":0,"changes":10,"blob_url":"https://github.com/EnricoDAlessandro97UNI/bookkeeper/blob/28f23e80bc1f64a22b45c52166cd51d526eacb5b/compat-deps%2Fbookkeeper-server-compat-4.2.0%2Fpom.xml","raw_url":"https://github.com/EnricoDAlessandro97UNI/bookkeeper/raw/28f23e80bc1f64a22b45c52166cd51d526eacb5b/compat-deps%2Fbookkeeper-server-compat-4.2.0%2Fpom.xml","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/bookkeeper/contents/compat-deps%2Fbookkeeper-server-compat-4.2.0%2Fpom.xml?ref=28f23e80bc1f64a22b45c52166cd51d526eacb5b","patch":"@@ -32,6 +32,11 @@\n     <project.build.sourceEncoding>UTF-8</project.build.sourceEncoding>\n   </properties>\n   <dependencies>\n+    <dependency>\n+      <groupId>com.google.protobuf</groupId>\n+      <artifactId>protobuf-java</artifactId>\n+      <version>2.4.1</version>\n+    </dependency>\n     <dependency>\n       <groupId>org.apache.bookkeeper</groupId>\n       <artifactId>bookkeeper-server</artifactId>\n@@ -54,6 +59,7 @@\n               <createDependencyReducedPom>false</createDependencyReducedPom>\n               <artifactSet>\n                 <includes>\n+                  <include>com.google.protobuf:protobuf-java</include>\n                   <include>org.apache.*:*</include>\n                   <include>org.jboss.*:*</include>\n                   <include>commons-*:*</include>\n@@ -63,6 +69,10 @@\n                 </excludes>\n               </artifactSet>\n               <relocations>\n+                <relocation>\n+                  <pattern>com.google.protobuf</pattern>\n+                  <shadedPattern>bk-shade.com.google.proto_bk_v4_2_0</shadedPattern>\n+                </relocation>\n                 <relocation>\n                   <pattern>org.apache.commons</pattern>\n                   <shadedPattern>org.apache.bk_v4_2_0.commons</shadedPattern>"},{"sha":"298520bf682178f20a3f1431336cd3ba83edfe75","filename":"pom.xml","status":"modified","additions":1,"deletions":1,"changes":2,"blob_url":"https://github.com/EnricoDAlessandro97UNI/bookkeeper/blob/28f23e80bc1f64a22b45c52166cd51d526eacb5b/pom.xml","raw_url":"https://github.com/EnricoDAlessandro97UNI/bookkeeper/raw/28f23e80bc1f64a22b45c52166cd51d526eacb5b/pom.xml","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/bookkeeper/contents/pom.xml?ref=28f23e80bc1f64a22b45c52166cd51d526eacb5b","patch":"@@ -41,7 +41,7 @@\n   <properties>\n     <project.build.sourceEncoding>UTF-8</project.build.sourceEncoding>\n     <project.reporting.outputEncoding>UTF-8</project.reporting.outputEncoding>\n-    <protobuf.version>2.4.1</protobuf.version>\n+    <protobuf.version>2.6.1</protobuf.version>\n     <guava.version>13.0.1</guava.version>\n     <netty.version>3.9.4.Final</netty.version>\n     <zookeeper.version>3.4.6</zookeeper.version>"}]}