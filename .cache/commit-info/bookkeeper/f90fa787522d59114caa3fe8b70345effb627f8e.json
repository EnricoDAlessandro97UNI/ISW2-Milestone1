{"sha":"f90fa787522d59114caa3fe8b70345effb627f8e","node_id":"MDY6Q29tbWl0NDc4NTkyNTI2OmY5MGZhNzg3NTIyZDU5MTE0Y2FhM2ZlOGI3MDM0NWVmZmI2MjdmOGU=","commit":{"author":{"name":"Sijie Guo","email":"sijie@apache.org","date":"2017-08-07T18:41:46Z"},"committer":{"name":"Sijie Guo","email":"sijie@apache.org","date":"2017-08-07T18:41:46Z"},"message":"ISSUE #355: upgrade guide\n\nDescriptions of the changes in this PR:\n\n- provide a general upgrade guide\n- document notes for upgrading from 4.4 to 4.5.\n\nAuthor: Sijie Guo <sijie@apache.org>\n\nReviewers: Luc Perkins <lucperkins@gmail.com>, Jia Zhai <None>\n\nThis closes #403 from sijie/upgrade_guide, closes #355","tree":{"sha":"b4e0c88b9b28309d11b3f4d0bc94a5e2f9762367","url":"https://api.github.com/repos/EnricoDAlessandro97UNI/bookkeeper/git/trees/b4e0c88b9b28309d11b3f4d0bc94a5e2f9762367"},"url":"https://api.github.com/repos/EnricoDAlessandro97UNI/bookkeeper/git/commits/f90fa787522d59114caa3fe8b70345effb627f8e","comment_count":0,"verification":{"verified":false,"reason":"unsigned","signature":null,"payload":null}},"url":"https://api.github.com/repos/EnricoDAlessandro97UNI/bookkeeper/commits/f90fa787522d59114caa3fe8b70345effb627f8e","html_url":"https://github.com/EnricoDAlessandro97UNI/bookkeeper/commit/f90fa787522d59114caa3fe8b70345effb627f8e","comments_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/bookkeeper/commits/f90fa787522d59114caa3fe8b70345effb627f8e/comments","author":{"login":"sijie","id":1217863,"node_id":"MDQ6VXNlcjEyMTc4NjM=","avatar_url":"https://avatars.githubusercontent.com/u/1217863?v=4","gravatar_id":"","url":"https://api.github.com/users/sijie","html_url":"https://github.com/sijie","followers_url":"https://api.github.com/users/sijie/followers","following_url":"https://api.github.com/users/sijie/following{/other_user}","gists_url":"https://api.github.com/users/sijie/gists{/gist_id}","starred_url":"https://api.github.com/users/sijie/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sijie/subscriptions","organizations_url":"https://api.github.com/users/sijie/orgs","repos_url":"https://api.github.com/users/sijie/repos","events_url":"https://api.github.com/users/sijie/events{/privacy}","received_events_url":"https://api.github.com/users/sijie/received_events","type":"User","site_admin":false},"committer":{"login":"sijie","id":1217863,"node_id":"MDQ6VXNlcjEyMTc4NjM=","avatar_url":"https://avatars.githubusercontent.com/u/1217863?v=4","gravatar_id":"","url":"https://api.github.com/users/sijie","html_url":"https://github.com/sijie","followers_url":"https://api.github.com/users/sijie/followers","following_url":"https://api.github.com/users/sijie/following{/other_user}","gists_url":"https://api.github.com/users/sijie/gists{/gist_id}","starred_url":"https://api.github.com/users/sijie/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sijie/subscriptions","organizations_url":"https://api.github.com/users/sijie/orgs","repos_url":"https://api.github.com/users/sijie/repos","events_url":"https://api.github.com/users/sijie/events{/privacy}","received_events_url":"https://api.github.com/users/sijie/received_events","type":"User","site_admin":false},"parents":[{"sha":"188d7e5fb8d8beb137f13a49b7df8a9cd861cefc","url":"https://api.github.com/repos/EnricoDAlessandro97UNI/bookkeeper/commits/188d7e5fb8d8beb137f13a49b7df8a9cd861cefc","html_url":"https://github.com/EnricoDAlessandro97UNI/bookkeeper/commit/188d7e5fb8d8beb137f13a49b7df8a9cd861cefc"}],"stats":{"total":75,"additions":75,"deletions":0},"files":[{"sha":"5136df61085f605c49f6517a0a6aaf1420e8a6ff","filename":"site/_data/sidebar.yaml","status":"modified","additions":2,"deletions":0,"changes":2,"blob_url":"https://github.com/EnricoDAlessandro97UNI/bookkeeper/blob/f90fa787522d59114caa3fe8b70345effb627f8e/site%2F_data%2Fsidebar.yaml","raw_url":"https://github.com/EnricoDAlessandro97UNI/bookkeeper/raw/f90fa787522d59114caa3fe8b70345effb627f8e/site%2F_data%2Fsidebar.yaml","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/bookkeeper/contents/site%2F_data%2Fsidebar.yaml?ref=f90fa787522d59114caa3fe8b70345effb627f8e","patch":"@@ -26,6 +26,8 @@ groups:\n     endpoint: autorecovery\n   - name: Metric collection\n     endpoint: metrics\n+  - name: Upgrade\n+    endpoint: upgrade\n   #- name: Geo-replication\n   #  endpoint: geo-replication\n   #- name: Customized placement policies"},{"sha":"9addee4873d44ee1a6b67bfa712ee2b27c8d6e1d","filename":"site/docs/latest/admin/upgrade.md","status":"added","additions":73,"deletions":0,"changes":73,"blob_url":"https://github.com/EnricoDAlessandro97UNI/bookkeeper/blob/f90fa787522d59114caa3fe8b70345effb627f8e/site%2Fdocs%2Flatest%2Fadmin%2Fupgrade.md","raw_url":"https://github.com/EnricoDAlessandro97UNI/bookkeeper/raw/f90fa787522d59114caa3fe8b70345effb627f8e/site%2Fdocs%2Flatest%2Fadmin%2Fupgrade.md","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/bookkeeper/contents/site%2Fdocs%2Flatest%2Fadmin%2Fupgrade.md?ref=f90fa787522d59114caa3fe8b70345effb627f8e","patch":"@@ -0,0 +1,73 @@\n+---\n+title: Upgrade\n+---\n+\n+> If you have questions about upgrades (or need help), please feel free to reach out to us by [mailing list](/community/mailing-lists) or [Slack Channel](/community/slack).\n+\n+## Overview\n+\n+Consider the below guidelines in preparation for upgrading.\n+\n+- Always back up all your configuration files before upgrading.\n+- Read through the documentation and draft an upgrade plan that matches your specific requirements and environment before starting the upgrade process.\n+    Put differently, don't start working through the guide on a live cluster. Read guide entirely, make a plan, then execute the plan.\n+- Pay careful consideration to the order in which components are upgraded. In general, you need to upgrade bookies first and then upgrade your clients.\n+- If autorecovery is running along with bookies, you need to pay attention to the upgrade sequence.\n+- Read the release notes carefully for each release. They contain not only information about noteworthy features, but also changes to configurations\n+    that may impact your upgrade.\n+- Always upgrade one or a small set of bookies to canary new version before upgraing all bookies in your cluster.\n+\n+## Canary\n+\n+It is wise to canary an upgraded version in one or small set of bookies before upgrading all bookies in your live cluster.\n+\n+You can follow below steps on how to canary a upgraded version:\n+\n+1. Stop a Bookie.\n+2. Upgrade the binary and configuration.\n+3. Start the Bookie in `ReadOnly` mode. This can be used to verify if the Bookie of this new version can run well for read workload.\n+4. Once the Bookie is running at `ReadOnly` mode successfully for a while, restart the Bookie in `Write/Read` mode.\n+5. After step 4, the Bookie will serve both write and read traffic.\n+\n+### Rollback Canaries\n+\n+If problems occur during canarying an upgraded version, you can simply take down the problematic Bookie node. The remain bookies in the old cluster\n+will repair this problematic bookie node by autorecovery. Nothing needs to be worried about.\n+\n+## Upgrade Steps\n+\n+Once you determined a version is safe to upgrade in a few nodes in your cluster, you can perform following steps to upgrade all bookies in your cluster.\n+\n+1. Determine if autorecovery is running along with bookies. If yes, check if the clients (either new clients with new binary or old clients with new configurations)\n+are allowed to talk to old bookies; if clients are not allowed to talk to old bookies, please [disable autorecovery](../../reference/cli/#autorecovery-1) during upgrade.\n+2. Decide on performing a rolling upgrade or a downtime upgrade.\n+3. Upgrade all Bookies (more below)\n+4. If autorecovery was disabled during upgrade, [enable autorecovery](../../reference/cli/#autorecovery-1).\n+5. After all bookies are upgraded, build applications that use `BookKeeper client` against the new bookkeeper libraries and deploy the new versions.\n+\n+### Upgrade Bookies\n+\n+In a rolling upgrade scenario, upgrade one Bookie at a time. In a downtime upgrade scenario, take the entire cluster down, upgrade each Bookie, then start the cluster.\n+\n+For each Bookie:\n+\n+1. Stop the bookie. \n+2. Upgrade the software (either new binary or new configuration)\n+2. Start the bookie.\n+\n+## Upgrade Guides\n+\n+We describes the general upgrade method in Apache BookKeeper as above. We will cover the details for individual versions.\n+\n+### 4.4.x to 4.5.x upgrade\n+\n+There isn't any protocol related backward compabilities changes in 4.5.0. So you can follow the general upgrade sequence to upgrade from 4.4.x to 4.5.x.\n+However, we list a list of things that you might want to know.\n+\n+1. 4.5.x upgrades netty from 3.x to 4.x. The memory usage pattern might be changed a bit. Netty 4 uses more direct memory. Please pay attention to your memory usage\n+    and adjust the JVM settings accordingly.\n+2. `multi journals` is a non-rollbackable feature. If you configure a bookie to use multiple journals on 4.5.x you can not roll the bookie back to use 4.4.x. You have\n+    to take a bookie out and recover it if you want to rollback to 4.4.x.\n+\n+If you are planning to upgrade a non-secured cluster to a secured cluster enabling security features in 4.5.0, please read [BookKeeper Security](../../security) for more details.\n+"}]}