{"sha":"7a500dc8082580ad4c85c307ef073edae3ae7f7a","node_id":"MDY6Q29tbWl0NDc4NTkyNTI2OjdhNTAwZGM4MDgyNTgwYWQ0Yzg1YzMwN2VmMDczZWRhZTNhZTdmN2E=","commit":{"author":{"name":"eolivelli","email":"eolivelli@apache.org","date":"2017-08-04T04:19:46Z"},"committer":{"name":"jiazhai","email":"zhaijia@live.com","date":"2017-08-04T04:19:46Z"},"message":"ISSUE #376: Skip getSysFileDescriptor if JournalRemovePagesFromCache=false\n\nSkip illegal reflective calls if not needed, this way the Bookie will run on Java9 cleanly\n\nWe need to access internals of FileDescriptor class only if JournalRemovePagesFromCache=true.\nThis change will allow to run the bookie on Java9 just by using JournalRemovePagesFromCache=false.\n\nsee #376\n\nAuthor: eolivelli <eolivelli@apache.org>\n\nReviewers: Jia Zhai <None>, Matteo Merli <None>\n\nThis closes #380 from eolivelli/issue-376-minimal-java9, closes #376","tree":{"sha":"d481e48e9f291db588c0e8efc3d173b83941b13b","url":"https://api.github.com/repos/EnricoDAlessandro97UNI/bookkeeper/git/trees/d481e48e9f291db588c0e8efc3d173b83941b13b"},"url":"https://api.github.com/repos/EnricoDAlessandro97UNI/bookkeeper/git/commits/7a500dc8082580ad4c85c307ef073edae3ae7f7a","comment_count":0,"verification":{"verified":false,"reason":"unsigned","signature":null,"payload":null}},"url":"https://api.github.com/repos/EnricoDAlessandro97UNI/bookkeeper/commits/7a500dc8082580ad4c85c307ef073edae3ae7f7a","html_url":"https://github.com/EnricoDAlessandro97UNI/bookkeeper/commit/7a500dc8082580ad4c85c307ef073edae3ae7f7a","comments_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/bookkeeper/commits/7a500dc8082580ad4c85c307ef073edae3ae7f7a/comments","author":{"login":"eolivelli","id":9469110,"node_id":"MDQ6VXNlcjk0NjkxMTA=","avatar_url":"https://avatars.githubusercontent.com/u/9469110?v=4","gravatar_id":"","url":"https://api.github.com/users/eolivelli","html_url":"https://github.com/eolivelli","followers_url":"https://api.github.com/users/eolivelli/followers","following_url":"https://api.github.com/users/eolivelli/following{/other_user}","gists_url":"https://api.github.com/users/eolivelli/gists{/gist_id}","starred_url":"https://api.github.com/users/eolivelli/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/eolivelli/subscriptions","organizations_url":"https://api.github.com/users/eolivelli/orgs","repos_url":"https://api.github.com/users/eolivelli/repos","events_url":"https://api.github.com/users/eolivelli/events{/privacy}","received_events_url":"https://api.github.com/users/eolivelli/received_events","type":"User","site_admin":false},"committer":null,"parents":[{"sha":"70533f54a7e53a808f56e7a1112d0e0f7d260397","url":"https://api.github.com/repos/EnricoDAlessandro97UNI/bookkeeper/commits/70533f54a7e53a808f56e7a1112d0e0f7d260397","html_url":"https://github.com/EnricoDAlessandro97UNI/bookkeeper/commit/70533f54a7e53a808f56e7a1112d0e0f7d260397"}],"stats":{"total":6,"additions":5,"deletions":1},"files":[{"sha":"6d5cae05081d4c0ab90b3ba7332b28e869839345","filename":"bookkeeper-server/src/main/java/org/apache/bookkeeper/bookie/JournalChannel.java","status":"modified","additions":5,"deletions":1,"changes":6,"blob_url":"https://github.com/EnricoDAlessandro97UNI/bookkeeper/blob/7a500dc8082580ad4c85c307ef073edae3ae7f7a/bookkeeper-server%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fbookkeeper%2Fbookie%2FJournalChannel.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/bookkeeper/raw/7a500dc8082580ad4c85c307ef073edae3ae7f7a/bookkeeper-server%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fbookkeeper%2Fbookie%2FJournalChannel.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/bookkeeper/contents/bookkeeper-server%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fbookkeeper%2Fbookie%2FJournalChannel.java?ref=7a500dc8082580ad4c85c307ef073edae3ae7f7a","patch":"@@ -214,7 +214,11 @@ private JournalChannel(File journalDirectory, long logId,\n                 LOG.error(\"Bookie journal file can seek to position :\", e);\n             }\n         }\n-        this.fd = NativeIO.getSysFileDescriptor(randomAccessFile.getFD());\n+        if (fRemoveFromPageCache) {\n+            this.fd = NativeIO.getSysFileDescriptor(randomAccessFile.getFD());\n+        } else {\n+            this.fd = -1;\n+        }\n     }\n \n     int getFormatVersion() {"}]}