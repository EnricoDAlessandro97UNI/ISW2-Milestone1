{"sha":"7f2b59a7e6fa115793ed71d8cc1ad1cb9da677be","node_id":"MDY6Q29tbWl0NDc4NTkyNTI2OjdmMmI1OWE3ZTZmYTExNTc5M2VkNzFkOGNjMWFkMWNiOWRhNjc3YmU=","commit":{"author":{"name":"Sijie Guo","email":"sijieg@twitter.com","date":"2016-07-29T04:10:33Z"},"committer":{"name":"Sijie Guo","email":"sijieg@twitter.com","date":"2016-12-28T00:49:26Z"},"message":"DL-101: Improve session expire handling on fetching log segments for readers\n\nThis change focuses on improving the session expire handling on fetching log segments for readers.\n\nThe log segment management in DL is now done by 3 parts.\n\n- a LogSegmentMetadataStore (one per namespace instance): it is used for fetching the log segments from log segment metadata store (ZooKeeper). it doesn't do any caching.\n- a LogSegmentMetadataCache (one per namespace instance): it is a guava cache based metadata cache. it maintains a mapping between log segment metadata path and the log segment metadata. it manages the cache for the log segments that will be accessed in this namespace instance. it doesn't manage the sequence of the log segments for streams.\n- a PerStreamLogSegmentCache for each BKLogHandler. the log segment cache is per stream. it maintains the sequence of the log segments.\n\nBKLogWriteHandler doesn't watch the log segment changes. It fetches minimal number of log segments when it is created and fetches the full list of log segments for truncations. New log segments will be added to the per stream log segment cache with log segment rolling.\n\nBKLogReadHandler watch the log segments changes and only notify when the list of log segments is changed. the session handling which is specific to the metadata store is hidden to the implementations of LogSegmentMetadataStore.\n\nThe change tries to cleanup bunch of unused methods in BKLog{Read,Write}Handler too.","tree":{"sha":"d3ac8d2663d6889fd8510a0a67abe1105835a7ed","url":"https://api.github.com/repos/EnricoDAlessandro97UNI/bookkeeper/git/trees/d3ac8d2663d6889fd8510a0a67abe1105835a7ed"},"url":"https://api.github.com/repos/EnricoDAlessandro97UNI/bookkeeper/git/commits/7f2b59a7e6fa115793ed71d8cc1ad1cb9da677be","comment_count":0,"verification":{"verified":false,"reason":"unsigned","signature":null,"payload":null}},"url":"https://api.github.com/repos/EnricoDAlessandro97UNI/bookkeeper/commits/7f2b59a7e6fa115793ed71d8cc1ad1cb9da677be","html_url":"https://github.com/EnricoDAlessandro97UNI/bookkeeper/commit/7f2b59a7e6fa115793ed71d8cc1ad1cb9da677be","comments_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/bookkeeper/commits/7f2b59a7e6fa115793ed71d8cc1ad1cb9da677be/comments","author":null,"committer":null,"parents":[{"sha":"a6a463591a823bd930aa8b921b17cef70ea445c1","url":"https://api.github.com/repos/EnricoDAlessandro97UNI/bookkeeper/commits/a6a463591a823bd930aa8b921b17cef70ea445c1","html_url":"https://github.com/EnricoDAlessandro97UNI/bookkeeper/commit/a6a463591a823bd930aa8b921b17cef70ea445c1"}],"stats":{"total":34,"additions":34,"deletions":0},"files":[{"sha":"292d135ca2ddbcf53cfa64153f25cbed48ade704","filename":"src/main/java/com/twitter/distributedlog/exceptions/LogSegmentNotFoundException.java","status":"added","additions":32,"deletions":0,"changes":32,"blob_url":"https://github.com/EnricoDAlessandro97UNI/bookkeeper/blob/7f2b59a7e6fa115793ed71d8cc1ad1cb9da677be/src%2Fmain%2Fjava%2Fcom%2Ftwitter%2Fdistributedlog%2Fexceptions%2FLogSegmentNotFoundException.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/bookkeeper/raw/7f2b59a7e6fa115793ed71d8cc1ad1cb9da677be/src%2Fmain%2Fjava%2Fcom%2Ftwitter%2Fdistributedlog%2Fexceptions%2FLogSegmentNotFoundException.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/bookkeeper/contents/src%2Fmain%2Fjava%2Fcom%2Ftwitter%2Fdistributedlog%2Fexceptions%2FLogSegmentNotFoundException.java?ref=7f2b59a7e6fa115793ed71d8cc1ad1cb9da677be","patch":"@@ -0,0 +1,32 @@\n+/**\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package com.twitter.distributedlog.exceptions;\n+\n+import com.twitter.distributedlog.thrift.service.StatusCode;\n+\n+/**\n+ * Exception on log segment not found.\n+ */\n+public class LogSegmentNotFoundException extends DLException {\n+\n+    private static final long serialVersionUID = -2482324226595903864L;\n+\n+    public LogSegmentNotFoundException(String logSegmentPath) {\n+        super(StatusCode.LOG_SEGMENT_NOT_FOUND, \"Log Segment \" + logSegmentPath + \" not found\");\n+    }\n+}"},{"sha":"4c0eaf14fbdbf696e086a36441b430fc8dc3568d","filename":"src/main/thrift/service.thrift","status":"modified","additions":2,"deletions":0,"changes":2,"blob_url":"https://github.com/EnricoDAlessandro97UNI/bookkeeper/blob/7f2b59a7e6fa115793ed71d8cc1ad1cb9da677be/src%2Fmain%2Fthrift%2Fservice.thrift","raw_url":"https://github.com/EnricoDAlessandro97UNI/bookkeeper/raw/7f2b59a7e6fa115793ed71d8cc1ad1cb9da677be/src%2Fmain%2Fthrift%2Fservice.thrift","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/bookkeeper/contents/src%2Fmain%2Fthrift%2Fservice.thrift?ref=7f2b59a7e6fa115793ed71d8cc1ad1cb9da677be","patch":"@@ -94,6 +94,8 @@ enum StatusCode {\n     CHECKSUM_FAILED = 523,\n     /* Overcapacity: too many streams */\n     TOO_MANY_STREAMS = 524,\n+    // Log Segment Not Found\n+    LOG_SEGMENT_NOT_FOUND = 525,\n \n     /* 6xx: unexpected */\n "}]}