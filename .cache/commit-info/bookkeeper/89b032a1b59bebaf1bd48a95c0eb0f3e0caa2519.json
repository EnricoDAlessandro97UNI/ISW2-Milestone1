{"sha":"89b032a1b59bebaf1bd48a95c0eb0f3e0caa2519","node_id":"MDY6Q29tbWl0NDc4NTkyNTI2Ojg5YjAzMmExYjU5YmViYWYxYmQ0OGE5NWMwZWIwZjNlMGNhYTI1MTk=","commit":{"author":{"name":"eolivelli","email":"eolivelli@gmail.com","date":"2016-04-08T17:43:09Z"},"committer":{"name":"Matteo Merli","email":"mmerli@apache.org","date":"2016-04-08T17:43:09Z"},"message":"BOOKKEEPER-880: Make LedgerHandle implement AutoCloseable\n\nAuthor: eolivelli <eolivelli@gmail.com>\n\nReviewers: Matteo Merli <mmerli@apache.org>, Rakesh R <rakeshr.radhakrishnan.potty@intel.com>\n\nCloses #33 from eolivelli/BOOKKEEPER-880","tree":{"sha":"60f274c4a625264871b6534f6a8b8ab90da4df6a","url":"https://api.github.com/repos/EnricoDAlessandro97UNI/bookkeeper/git/trees/60f274c4a625264871b6534f6a8b8ab90da4df6a"},"url":"https://api.github.com/repos/EnricoDAlessandro97UNI/bookkeeper/git/commits/89b032a1b59bebaf1bd48a95c0eb0f3e0caa2519","comment_count":0,"verification":{"verified":false,"reason":"unsigned","signature":null,"payload":null}},"url":"https://api.github.com/repos/EnricoDAlessandro97UNI/bookkeeper/commits/89b032a1b59bebaf1bd48a95c0eb0f3e0caa2519","html_url":"https://github.com/EnricoDAlessandro97UNI/bookkeeper/commit/89b032a1b59bebaf1bd48a95c0eb0f3e0caa2519","comments_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/bookkeeper/commits/89b032a1b59bebaf1bd48a95c0eb0f3e0caa2519/comments","author":{"login":"eolivelli","id":9469110,"node_id":"MDQ6VXNlcjk0NjkxMTA=","avatar_url":"https://avatars.githubusercontent.com/u/9469110?v=4","gravatar_id":"","url":"https://api.github.com/users/eolivelli","html_url":"https://github.com/eolivelli","followers_url":"https://api.github.com/users/eolivelli/followers","following_url":"https://api.github.com/users/eolivelli/following{/other_user}","gists_url":"https://api.github.com/users/eolivelli/gists{/gist_id}","starred_url":"https://api.github.com/users/eolivelli/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/eolivelli/subscriptions","organizations_url":"https://api.github.com/users/eolivelli/orgs","repos_url":"https://api.github.com/users/eolivelli/repos","events_url":"https://api.github.com/users/eolivelli/events{/privacy}","received_events_url":"https://api.github.com/users/eolivelli/received_events","type":"User","site_admin":false},"committer":{"login":"merlimat","id":62500,"node_id":"MDQ6VXNlcjYyNTAw","avatar_url":"https://avatars.githubusercontent.com/u/62500?v=4","gravatar_id":"","url":"https://api.github.com/users/merlimat","html_url":"https://github.com/merlimat","followers_url":"https://api.github.com/users/merlimat/followers","following_url":"https://api.github.com/users/merlimat/following{/other_user}","gists_url":"https://api.github.com/users/merlimat/gists{/gist_id}","starred_url":"https://api.github.com/users/merlimat/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/merlimat/subscriptions","organizations_url":"https://api.github.com/users/merlimat/orgs","repos_url":"https://api.github.com/users/merlimat/repos","events_url":"https://api.github.com/users/merlimat/events{/privacy}","received_events_url":"https://api.github.com/users/merlimat/received_events","type":"User","site_admin":false},"parents":[{"sha":"3efde26e0510be38237c73a7bfeeb105f25d8dbe","url":"https://api.github.com/repos/EnricoDAlessandro97UNI/bookkeeper/commits/3efde26e0510be38237c73a7bfeeb105f25d8dbe","html_url":"https://github.com/EnricoDAlessandro97UNI/bookkeeper/commit/3efde26e0510be38237c73a7bfeeb105f25d8dbe"}],"stats":{"total":23,"additions":21,"deletions":2},"files":[{"sha":"101f5e851c4029f312808ef311be885498349771","filename":"bookkeeper-server/src/main/java/org/apache/bookkeeper/client/BookKeeper.java","status":"modified","additions":1,"deletions":1,"changes":2,"blob_url":"https://github.com/EnricoDAlessandro97UNI/bookkeeper/blob/89b032a1b59bebaf1bd48a95c0eb0f3e0caa2519/bookkeeper-server%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fbookkeeper%2Fclient%2FBookKeeper.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/bookkeeper/raw/89b032a1b59bebaf1bd48a95c0eb0f3e0caa2519/bookkeeper-server%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fbookkeeper%2Fclient%2FBookKeeper.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/bookkeeper/contents/bookkeeper-server%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fbookkeeper%2Fclient%2FBookKeeper.java?ref=89b032a1b59bebaf1bd48a95c0eb0f3e0caa2519","patch":"@@ -73,7 +73,7 @@\n  *\n  */\n \n-public class BookKeeper {\n+public class BookKeeper implements AutoCloseable {\n \n     static final Logger LOG = LoggerFactory.getLogger(BookKeeper.class);\n "},{"sha":"dff1f771b46057ff02df88e2bfa2ed63efbb063d","filename":"bookkeeper-server/src/main/java/org/apache/bookkeeper/client/LedgerHandle.java","status":"modified","additions":1,"deletions":1,"changes":2,"blob_url":"https://github.com/EnricoDAlessandro97UNI/bookkeeper/blob/89b032a1b59bebaf1bd48a95c0eb0f3e0caa2519/bookkeeper-server%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fbookkeeper%2Fclient%2FLedgerHandle.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/bookkeeper/raw/89b032a1b59bebaf1bd48a95c0eb0f3e0caa2519/bookkeeper-server%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fbookkeeper%2Fclient%2FLedgerHandle.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/bookkeeper/contents/bookkeeper-server%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fbookkeeper%2Fclient%2FLedgerHandle.java?ref=89b032a1b59bebaf1bd48a95c0eb0f3e0caa2519","patch":"@@ -56,7 +56,7 @@\n  * Ledger handle contains ledger metadata and is used to access the read and\n  * write operations to a ledger.\n  */\n-public class LedgerHandle {\n+public class LedgerHandle implements AutoCloseable {\n     final static Logger LOG = LoggerFactory.getLogger(LedgerHandle.class);\n \n     final byte[] ledgerKey;"},{"sha":"e87fdc01328f36993a3b96a4ccb1303ee4f9cf4e","filename":"bookkeeper-server/src/test/java/org/apache/bookkeeper/client/BookKeeperTest.java","status":"modified","additions":19,"deletions":0,"changes":19,"blob_url":"https://github.com/EnricoDAlessandro97UNI/bookkeeper/blob/89b032a1b59bebaf1bd48a95c0eb0f3e0caa2519/bookkeeper-server%2Fsrc%2Ftest%2Fjava%2Forg%2Fapache%2Fbookkeeper%2Fclient%2FBookKeeperTest.java","raw_url":"https://github.com/EnricoDAlessandro97UNI/bookkeeper/raw/89b032a1b59bebaf1bd48a95c0eb0f3e0caa2519/bookkeeper-server%2Fsrc%2Ftest%2Fjava%2Forg%2Fapache%2Fbookkeeper%2Fclient%2FBookKeeperTest.java","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/bookkeeper/contents/bookkeeper-server%2Fsrc%2Ftest%2Fjava%2Forg%2Fapache%2Fbookkeeper%2Fclient%2FBookKeeperTest.java?ref=89b032a1b59bebaf1bd48a95c0eb0f3e0caa2519","patch":"@@ -290,4 +290,23 @@ public void readComplete(int rc, LedgerHandle lh, Enumeration<LedgerEntry> seq,\n \n         startBKCluster();\n     }\n+\n+    @Test(timeout = 60000)\n+    public void testAutoCloseableBookKeeper() throws Exception {\n+        ClientConfiguration conf = new ClientConfiguration()\n+                .setZkServers(zkUtil.getZooKeeperConnectString());\n+        BookKeeper _bkc;\n+        try (BookKeeper bkc = new BookKeeper(conf);) {\n+            _bkc = bkc;\n+            long ledgerId;\n+            try (LedgerHandle lh = bkc.createLedger(digestType, \"testPasswd\".getBytes());) {\n+                ledgerId = lh.getId();\n+                for (int i = 0; i < 100; i++) {\n+                    lh.addEntry(\"foobar\".getBytes());\n+                }\n+            }\n+            Assert.assertTrue(\"Ledger should be closed!\", bkc.isClosed(ledgerId));\n+        }\n+        Assert.assertTrue(\"BookKeeper should be closed!\", _bkc.closed);\n+    }\n }"}]}