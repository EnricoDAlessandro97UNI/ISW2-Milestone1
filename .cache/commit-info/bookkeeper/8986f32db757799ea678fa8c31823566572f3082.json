{"sha":"8986f32db757799ea678fa8c31823566572f3082","node_id":"MDY6Q29tbWl0NDc4NTkyNTI2Ojg5ODZmMzJkYjc1Nzc5OWVhNjc4ZmE4YzMxODIzNTY2NTcyZjMwODI=","commit":{"author":{"name":"Sijie Guo","email":"sijie@apache.org","date":"2017-08-05T06:37:43Z"},"committer":{"name":"Sijie Guo","email":"sijie@apache.org","date":"2017-08-05T06:37:43Z"},"message":"ISSUE #393: [CI] publish-website job will be marked as failure if it is an empty commit\n\nDescriptions of the changes in this PR:\n\n- use `git diff-index` to checkout if there is any changes to commit or not\n- port some changes from CI back to script.\n\nAuthor: Sijie Guo <sijie@apache.org>\n\nReviewers: Matteo Merli <mmerli@apache.org>\n\nThis closes #394 from sijie/issue_393, closes #393","tree":{"sha":"561bf07af9e2274aa17c21152222a637fa311712","url":"https://api.github.com/repos/EnricoDAlessandro97UNI/bookkeeper/git/trees/561bf07af9e2274aa17c21152222a637fa311712"},"url":"https://api.github.com/repos/EnricoDAlessandro97UNI/bookkeeper/git/commits/8986f32db757799ea678fa8c31823566572f3082","comment_count":0,"verification":{"verified":false,"reason":"unsigned","signature":null,"payload":null}},"url":"https://api.github.com/repos/EnricoDAlessandro97UNI/bookkeeper/commits/8986f32db757799ea678fa8c31823566572f3082","html_url":"https://github.com/EnricoDAlessandro97UNI/bookkeeper/commit/8986f32db757799ea678fa8c31823566572f3082","comments_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/bookkeeper/commits/8986f32db757799ea678fa8c31823566572f3082/comments","author":{"login":"sijie","id":1217863,"node_id":"MDQ6VXNlcjEyMTc4NjM=","avatar_url":"https://avatars.githubusercontent.com/u/1217863?v=4","gravatar_id":"","url":"https://api.github.com/users/sijie","html_url":"https://github.com/sijie","followers_url":"https://api.github.com/users/sijie/followers","following_url":"https://api.github.com/users/sijie/following{/other_user}","gists_url":"https://api.github.com/users/sijie/gists{/gist_id}","starred_url":"https://api.github.com/users/sijie/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sijie/subscriptions","organizations_url":"https://api.github.com/users/sijie/orgs","repos_url":"https://api.github.com/users/sijie/repos","events_url":"https://api.github.com/users/sijie/events{/privacy}","received_events_url":"https://api.github.com/users/sijie/received_events","type":"User","site_admin":false},"committer":{"login":"sijie","id":1217863,"node_id":"MDQ6VXNlcjEyMTc4NjM=","avatar_url":"https://avatars.githubusercontent.com/u/1217863?v=4","gravatar_id":"","url":"https://api.github.com/users/sijie","html_url":"https://github.com/sijie","followers_url":"https://api.github.com/users/sijie/followers","following_url":"https://api.github.com/users/sijie/following{/other_user}","gists_url":"https://api.github.com/users/sijie/gists{/gist_id}","starred_url":"https://api.github.com/users/sijie/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sijie/subscriptions","organizations_url":"https://api.github.com/users/sijie/orgs","repos_url":"https://api.github.com/users/sijie/repos","events_url":"https://api.github.com/users/sijie/events{/privacy}","received_events_url":"https://api.github.com/users/sijie/received_events","type":"User","site_admin":false},"parents":[{"sha":"31960b027f391ee8ca7400cb3e647c20864966a3","url":"https://api.github.com/repos/EnricoDAlessandro97UNI/bookkeeper/commits/31960b027f391ee8ca7400cb3e647c20864966a3","html_url":"https://github.com/EnricoDAlessandro97UNI/bookkeeper/commit/31960b027f391ee8ca7400cb3e647c20864966a3"}],"stats":{"total":7,"additions":3,"deletions":4},"files":[{"sha":"9f6331e4ec2b136fb16c0749e9b74e8bee5a1edb","filename":"site/scripts/publish-website.sh","status":"modified","additions":3,"deletions":4,"changes":7,"blob_url":"https://github.com/EnricoDAlessandro97UNI/bookkeeper/blob/8986f32db757799ea678fa8c31823566572f3082/site%2Fscripts%2Fpublish-website.sh","raw_url":"https://github.com/EnricoDAlessandro97UNI/bookkeeper/raw/8986f32db757799ea678fa8c31823566572f3082/site%2Fscripts%2Fpublish-website.sh","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/bookkeeper/contents/site%2Fscripts%2Fpublish-website.sh?ref=8986f32db757799ea678fa8c31823566572f3082","patch":"@@ -20,7 +20,6 @@\n \n # NOTE: this is the script used by CI to push to apache. If you are looking for\n #       staging the changes, try the `staging-website.sh` script.\n-\n source scripts/common.sh\n \n ORIGIN_REPO=$(git remote show origin | grep 'Push  URL' | awk -F// '{print $NF}')\n@@ -37,12 +36,12 @@ echo \"ORIGIN_REPO: $ORIGIN_REPO\"\n   git clone \"https://$ORIGIN_REPO\" .\n   git config user.name \"Apache BookKeeper Site Updater\"\n   git config user.email \"dev@bookkeeper.apache.org\"\n+  git checkout asf-site\n   # copy the apache generated dir\n-  cp -r $APACHE_GENERATED_DIR/* $TMP_DIR/content\n+  cp -r $APACHE_GENERATED_DIR/content/* $TMP_DIR/content\n \n   git add -A .\n-  git commit -m \"Updated site at revision $REVISION\"\n-  git push -q origin HEAD:asf-site\n+  git diff-index --quiet HEAD || (git commit -m \"Updated site at revision $REVISION\" && git push -q origin HEAD:asf-site)\n \n   rm -rf $TMP_DIR\n )"}]}