{"sha":"809f2cbf16d9ecb1b04fda23d610deea4c9bfabe","node_id":"MDY6Q29tbWl0NDc4NTkyNTI2OjgwOWYyY2JmMTZkOWVjYjFiMDRmZGEyM2Q2MTBkZWVhNGM5YmZhYmU=","commit":{"author":{"name":"Sijie Guo","email":"sijie@apache.org","date":"2017-07-29T00:59:48Z"},"committer":{"name":"Sijie Guo","email":"sijie@apache.org","date":"2017-07-29T00:59:48Z"},"message":"ISSUE #320: add scripts for publishing new website to staging and apache\n\nDescriptions of the changes in this PR:\n\n- script for staging changes to a staging-site repo\n- steps for how to staging changes for reviews\n- script for pushing changes to apache\n\nAuthor: Sijie Guo <sijie@apache.org>\n\nReviewers: Luc Perkins <lucperkins@gmail.com>, Matteo Merli <mmerli@apache.org>\n\nThis closes #322 from sijie/publish_scripts, closes #320","tree":{"sha":"1d6c19b4a9cc2698fc3a9a0a451e24915da3d0e3","url":"https://api.github.com/repos/EnricoDAlessandro97UNI/bookkeeper/git/trees/1d6c19b4a9cc2698fc3a9a0a451e24915da3d0e3"},"url":"https://api.github.com/repos/EnricoDAlessandro97UNI/bookkeeper/git/commits/809f2cbf16d9ecb1b04fda23d610deea4c9bfabe","comment_count":0,"verification":{"verified":false,"reason":"unsigned","signature":null,"payload":null}},"url":"https://api.github.com/repos/EnricoDAlessandro97UNI/bookkeeper/commits/809f2cbf16d9ecb1b04fda23d610deea4c9bfabe","html_url":"https://github.com/EnricoDAlessandro97UNI/bookkeeper/commit/809f2cbf16d9ecb1b04fda23d610deea4c9bfabe","comments_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/bookkeeper/commits/809f2cbf16d9ecb1b04fda23d610deea4c9bfabe/comments","author":{"login":"sijie","id":1217863,"node_id":"MDQ6VXNlcjEyMTc4NjM=","avatar_url":"https://avatars.githubusercontent.com/u/1217863?v=4","gravatar_id":"","url":"https://api.github.com/users/sijie","html_url":"https://github.com/sijie","followers_url":"https://api.github.com/users/sijie/followers","following_url":"https://api.github.com/users/sijie/following{/other_user}","gists_url":"https://api.github.com/users/sijie/gists{/gist_id}","starred_url":"https://api.github.com/users/sijie/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sijie/subscriptions","organizations_url":"https://api.github.com/users/sijie/orgs","repos_url":"https://api.github.com/users/sijie/repos","events_url":"https://api.github.com/users/sijie/events{/privacy}","received_events_url":"https://api.github.com/users/sijie/received_events","type":"User","site_admin":false},"committer":{"login":"sijie","id":1217863,"node_id":"MDQ6VXNlcjEyMTc4NjM=","avatar_url":"https://avatars.githubusercontent.com/u/1217863?v=4","gravatar_id":"","url":"https://api.github.com/users/sijie","html_url":"https://github.com/sijie","followers_url":"https://api.github.com/users/sijie/followers","following_url":"https://api.github.com/users/sijie/following{/other_user}","gists_url":"https://api.github.com/users/sijie/gists{/gist_id}","starred_url":"https://api.github.com/users/sijie/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sijie/subscriptions","organizations_url":"https://api.github.com/users/sijie/orgs","repos_url":"https://api.github.com/users/sijie/repos","events_url":"https://api.github.com/users/sijie/events{/privacy}","received_events_url":"https://api.github.com/users/sijie/received_events","type":"User","site_admin":false},"parents":[{"sha":"3908d9ce6a5530ae2ae8526b9988b983423c026c","url":"https://api.github.com/repos/EnricoDAlessandro97UNI/bookkeeper/commits/3908d9ce6a5530ae2ae8526b9988b983423c026c","html_url":"https://github.com/EnricoDAlessandro97UNI/bookkeeper/commit/3908d9ce6a5530ae2ae8526b9988b983423c026c"}],"stats":{"total":178,"additions":133,"deletions":45},"files":[{"sha":"15ad27f7d5ba8ae802ae1c9005160d1ed99828da","filename":".gitignore","status":"modified","additions":0,"deletions":3,"changes":3,"blob_url":"https://github.com/EnricoDAlessandro97UNI/bookkeeper/blob/809f2cbf16d9ecb1b04fda23d610deea4c9bfabe/.gitignore","raw_url":"https://github.com/EnricoDAlessandro97UNI/bookkeeper/raw/809f2cbf16d9ecb1b04fda23d610deea4c9bfabe/.gitignore","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/bookkeeper/contents/.gitignore?ref=809f2cbf16d9ecb1b04fda23d610deea4c9bfabe","patch":"@@ -20,6 +20,3 @@ lib/\n log/\n target/\n dependency-reduced-pom.xml\n-\n-# Generated website\n-docs/"},{"sha":"8e78dd99107a717429238f0a81c024ab2d1a1ba5","filename":"pom.xml","status":"modified","additions":1,"deletions":1,"changes":2,"blob_url":"https://github.com/EnricoDAlessandro97UNI/bookkeeper/blob/809f2cbf16d9ecb1b04fda23d610deea4c9bfabe/pom.xml","raw_url":"https://github.com/EnricoDAlessandro97UNI/bookkeeper/raw/809f2cbf16d9ecb1b04fda23d610deea4c9bfabe/pom.xml","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/bookkeeper/contents/pom.xml?ref=809f2cbf16d9ecb1b04fda23d610deea4c9bfabe","patch":"@@ -163,7 +163,7 @@\n         <version>${maven-javadoc-plugin.version}</version>\n         <configuration>\n           <!-- Prevent missing javadoc comments from being marked as errors -->\n-          <additionalparam>-Xdoclint:none</additionalparam>\n+          <additionalparam>-Xdoclint:none -notimestamp</additionalparam>\n           <subpackages>org.apache.bookkeeper.client:org.apache.bookkeeper.common.annotation:org.apache.bookkeeper.conf:org.apache.bookkeeper.feature:org.apache.bookkeeper.stats</subpackages>\n           <groups>\n             <group>"},{"sha":"15a21ca0b9122eda14415afc1c7f8efbaa79bb23","filename":"site/.gitignore","status":"modified","additions":1,"deletions":0,"changes":1,"blob_url":"https://github.com/EnricoDAlessandro97UNI/bookkeeper/blob/809f2cbf16d9ecb1b04fda23d610deea4c9bfabe/site%2F.gitignore","raw_url":"https://github.com/EnricoDAlessandro97UNI/bookkeeper/raw/809f2cbf16d9ecb1b04fda23d610deea4c9bfabe/site%2F.gitignore","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/bookkeeper/contents/site%2F.gitignore?ref=809f2cbf16d9ecb1b04fda23d610deea4c9bfabe","patch":"@@ -5,3 +5,4 @@ vendor/bundle/\n .bundle/\n .sass-cache/\n local-generated/\n+generated_site/"},{"sha":"3719f81196b8f297a1f4f039645ff00775722f80","filename":"site/Makefile","status":"modified","additions":10,"deletions":3,"changes":13,"blob_url":"https://github.com/EnricoDAlessandro97UNI/bookkeeper/blob/809f2cbf16d9ecb1b04fda23d610deea4c9bfabe/site%2FMakefile","raw_url":"https://github.com/EnricoDAlessandro97UNI/bookkeeper/raw/809f2cbf16d9ecb1b04fda23d610deea4c9bfabe/site%2FMakefile","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/bookkeeper/contents/site%2FMakefile?ref=809f2cbf16d9ecb1b04fda23d610deea4c9bfabe","patch":"@@ -8,7 +8,7 @@ dev:\n \tmake serve\n \n clean:\n-\trm -rf _site\n+\trm -rf _site local-generated generated_site\n \n setup:\n \tgem install bundler \\\n@@ -22,12 +22,19 @@ build: clean\n \t${JEKYLL} build \\\n \t\t--config _config.yml\n \n-javadoc-gen:\n+apache: clean\n+\t${JEKYLL} build \\\n+\t\t--config _config.yml,_config.apache.yml\n+\n+javadoc:\n \tscripts/javadoc-gen.sh\n \n+staging: clean\n+\t${JEKYLL} build --config _config.yml,_config.staging.yml\n+\n serve: build\n \t${JEKYLL} serve \\\n \t\t--incremental \\\n-\t\t--config _config.local.yml\n+\t\t--config _config.yml,_config.local.yml\n \n publish: javadoc-gen build"},{"sha":"cd6d4a9a95f09e8a6c0d63178d0de11c046ee1cb","filename":"site/README.md","status":"modified","additions":15,"deletions":0,"changes":15,"blob_url":"https://github.com/EnricoDAlessandro97UNI/bookkeeper/blob/809f2cbf16d9ecb1b04fda23d610deea4c9bfabe/site%2FREADME.md","raw_url":"https://github.com/EnricoDAlessandro97UNI/bookkeeper/raw/809f2cbf16d9ecb1b04fda23d610deea4c9bfabe/site%2FREADME.md","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/bookkeeper/contents/site%2FREADME.md?ref=809f2cbf16d9ecb1b04fda23d610deea4c9bfabe","patch":"@@ -42,3 +42,18 @@ $ make serve\n ```\n \n Then navigate to `localhost:4000`. As you make changes, the browser will auto-update.\n+\n+## Staging website for reviews\n+\n+When you submit a pull request for modifying website or documentation, you are recommended to make your changes live for reviews.\n+\n+Here are a few steps to follow to stage your changes:\n+\n+1. You need to create a github repo called `bookkeeper-staging-site` under your github account. You can fork this [staging repo](https://github.com/sijie/bookkeeper-staging-site) as well.\n+2. In your `bookeeper-staging-site` repo, go to `Settings > GitHub Pages`. Enable `GitHub Pages` on `master branch /docs folder`.\n+3. Make changes to the website, follow the steps above to verify the changes locally.\n+4. Once the changes are verified locally, you can run `make staging`. It will generate the files under `site/local-generated`.\n+5. Run `scripts/staging-website.sh`. It would push the generated website to your `bookkeeper-staging-site`.\n+6. Your changes will be live on `https://<your-github-id>.github.io/bookkeeper-staging-site`.\n+\n+If you have any ideas to improve the review process for website, please feel free to contact us at dev@bookkeeper.apache.org."},{"sha":"7708fd0536b5e948ceab7d530e29e2dd61d14e63","filename":"site/_config.apache.yml","status":"added","additions":2,"deletions":0,"changes":2,"blob_url":"https://github.com/EnricoDAlessandro97UNI/bookkeeper/blob/809f2cbf16d9ecb1b04fda23d610deea4c9bfabe/site%2F_config.apache.yml","raw_url":"https://github.com/EnricoDAlessandro97UNI/bookkeeper/raw/809f2cbf16d9ecb1b04fda23d610deea4c9bfabe/site%2F_config.apache.yml","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/bookkeeper/contents/site%2F_config.apache.yml?ref=809f2cbf16d9ecb1b04fda23d610deea4c9bfabe","patch":"@@ -0,0 +1,2 @@\n+baseurl: /test/content/\n+destination: generated_site/content"},{"sha":"f93cfaa6880300852ba0fbef6d827640a7b2997a","filename":"site/_config.local.yml","status":"modified","additions":0,"deletions":34,"changes":34,"blob_url":"https://github.com/EnricoDAlessandro97UNI/bookkeeper/blob/809f2cbf16d9ecb1b04fda23d610deea4c9bfabe/site%2F_config.local.yml","raw_url":"https://github.com/EnricoDAlessandro97UNI/bookkeeper/raw/809f2cbf16d9ecb1b04fda23d610deea4c9bfabe/site%2F_config.local.yml","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/bookkeeper/contents/site%2F_config.local.yml?ref=809f2cbf16d9ecb1b04fda23d610deea4c9bfabe","patch":"@@ -1,35 +1 @@\n-title: Apache BookKeeper\n-subtitle: A replicated log service\n-github_repo: https://github.com/apache/bookkeeper\n-permalink: pretty\n-bk_version: \"4.5.0\"\n destination: local-generated\n-baseurl: /\n-\n-livereload: true\n-\n-defaults:\n-- scope:\n-    path: docs\n-  values:\n-    layout: docs\n-    toc: true\n-- scope:\n-    path: community\n-  values:\n-    layout: community\n-- scope:\n-    path: project\n-  values:\n-    layout: community\n-\n-gems:\n-- jekyll-toc\n-\n-exclude:\n-- Gemfile\n-- Gemfile.lock\n-- Makefile\n-- vendor/bundle\n-- scripts\n-- overview"},{"sha":"384600141b1e1104a899bf9b8db51fc55c297d70","filename":"site/_config.staging.yml","status":"added","additions":2,"deletions":0,"changes":2,"blob_url":"https://github.com/EnricoDAlessandro97UNI/bookkeeper/blob/809f2cbf16d9ecb1b04fda23d610deea4c9bfabe/site%2F_config.staging.yml","raw_url":"https://github.com/EnricoDAlessandro97UNI/bookkeeper/raw/809f2cbf16d9ecb1b04fda23d610deea4c9bfabe/site%2F_config.staging.yml","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/bookkeeper/contents/site%2F_config.staging.yml?ref=809f2cbf16d9ecb1b04fda23d610deea4c9bfabe","patch":"@@ -0,0 +1,2 @@\n+baseurl: /bookkeeper-staging-site/\n+destination: local-generated"},{"sha":"048a0bd8b6a3644ed09807c820235da9a3348390","filename":"site/_config.yml","status":"modified","additions":3,"deletions":2,"changes":5,"blob_url":"https://github.com/EnricoDAlessandro97UNI/bookkeeper/blob/809f2cbf16d9ecb1b04fda23d610deea4c9bfabe/site%2F_config.yml","raw_url":"https://github.com/EnricoDAlessandro97UNI/bookkeeper/raw/809f2cbf16d9ecb1b04fda23d610deea4c9bfabe/site%2F_config.yml","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/bookkeeper/contents/site%2F_config.yml?ref=809f2cbf16d9ecb1b04fda23d610deea4c9bfabe","patch":"@@ -4,8 +4,8 @@ github_repo: https://github.com/apache/bookkeeper\n github_master: https://github.com/apache/bookkeeper/tree/master\n permalink: pretty\n bk_version: \"4.5.0\"\n-baseurl: /bookkeeper/\n-destination: ../docs\n+baseurl: /\n+destination: local-generated\n twitter_url: https://twitter.com/asfbookkeeper\n \n livereload: true\n@@ -39,6 +39,7 @@ exclude:\n - Makefile\n - vendor/bundle\n - local-generated\n+- generated_site\n - scripts\n - overview\n - README.md"},{"sha":"ae8e9b4792a88c9d933f9af59db1033748824a87","filename":"site/scripts/common.sh","status":"modified","additions":6,"deletions":2,"changes":8,"blob_url":"https://github.com/EnricoDAlessandro97UNI/bookkeeper/blob/809f2cbf16d9ecb1b04fda23d610deea4c9bfabe/site%2Fscripts%2Fcommon.sh","raw_url":"https://github.com/EnricoDAlessandro97UNI/bookkeeper/raw/809f2cbf16d9ecb1b04fda23d610deea4c9bfabe/site%2Fscripts%2Fcommon.sh","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/bookkeeper/contents/site%2Fscripts%2Fcommon.sh?ref=809f2cbf16d9ecb1b04fda23d610deea4c9bfabe","patch":"@@ -1,5 +1,9 @@\n #!/bin/bash\n \n ROOT_DIR=$(git rev-parse --show-toplevel)\n-JAVADOC_GEN_DIR=target/site/apidocs\n-JAVADOC_DEST_DIR=site/javadoc\n\\ No newline at end of file\n+REVISION=$(git rev-parse --short HEAD)\n+JAVADOC_GEN_DIR=${JAVADOC_GEN_DIR:-\"target/site/apidocs\"}\n+JAVADOC_DEST_DIR=${JAVADOC_DEST_DIR:-\"site/javadoc\"}\n+LOCAL_GENERATED_DIR=$ROOT_DIR/site/local-generated\n+APACHE_GENERATED_DIR=$ROOT_DIR/site/generated_site\n+TMP_DIR=/tmp/bookkeeper-site"},{"sha":"18ab9a2821b90728afeae9dac80d2862e621db93","filename":"site/scripts/publish-website.sh","status":"added","additions":45,"deletions":0,"changes":45,"blob_url":"https://github.com/EnricoDAlessandro97UNI/bookkeeper/blob/809f2cbf16d9ecb1b04fda23d610deea4c9bfabe/site%2Fscripts%2Fpublish-website.sh","raw_url":"https://github.com/EnricoDAlessandro97UNI/bookkeeper/raw/809f2cbf16d9ecb1b04fda23d610deea4c9bfabe/site%2Fscripts%2Fpublish-website.sh","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/bookkeeper/contents/site%2Fscripts%2Fpublish-website.sh?ref=809f2cbf16d9ecb1b04fda23d610deea4c9bfabe","patch":"@@ -0,0 +1,45 @@\n+#!/bin/bash\n+#\n+# Licensed to the Apache Software Foundation (ASF) under one\n+# or more contributor license agreements.  See the NOTICE file\n+# distributed with this work for additional information\n+# regarding copyright ownership.  The ASF licenses this file\n+# to you under the Apache License, Version 2.0 (the\n+# \"License\"); you may not use this file except in compliance\n+# with the License.  You may obtain a copy of the License at\n+#\n+#   http://www.apache.org/licenses/LICENSE-2.0\n+#\n+# Unless required by applicable law or agreed to in writing,\n+# software distributed under the License is distributed on an\n+# \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+# KIND, either express or implied.  See the License for the\n+# specific language governing permissions and limitations\n+# under the License.\n+#\n+\n+# NOTE: this is the script used by CI to push to apache. If you are looking for\n+#       staging the changes, try the `staging-website.sh` script.\n+\n+source scripts/common.sh\n+\n+ORIGIN_REPO=$(git remote show origin | grep 'Push  URL' | awk -F// '{print $NF}')\n+echo \"ORIGIN_REPO: $ORIGIN_REPO\"\n+\n+(\n+  cd $APACHE_GENERATED_DIR\n+\n+  git init\n+  git config user.name \"Apache BookKeeper Site Updater\"\n+  git config user.email \"dev@bookkeeper.apache.org\"\n+\n+  git remote add upstream \"https://$ORIGIN_REPO\"\n+  git fetch upstream\n+  git reset upstream/asf-site\n+\n+  touch .\n+\n+  git add -A .\n+  git commit -m \"Updated site at revision $REVISION\"\n+  git push -q upstream HEAD:asf-site\n+)"},{"sha":"9de1dd2b691428ba89e4d10986adeb6eb639ec89","filename":"site/scripts/staging-website.sh","status":"added","additions":48,"deletions":0,"changes":48,"blob_url":"https://github.com/EnricoDAlessandro97UNI/bookkeeper/blob/809f2cbf16d9ecb1b04fda23d610deea4c9bfabe/site%2Fscripts%2Fstaging-website.sh","raw_url":"https://github.com/EnricoDAlessandro97UNI/bookkeeper/raw/809f2cbf16d9ecb1b04fda23d610deea4c9bfabe/site%2Fscripts%2Fstaging-website.sh","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/bookkeeper/contents/site%2Fscripts%2Fstaging-website.sh?ref=809f2cbf16d9ecb1b04fda23d610deea4c9bfabe","patch":"@@ -0,0 +1,48 @@\n+#!/bin/bash\n+#\n+# Licensed to the Apache Software Foundation (ASF) under one\n+# or more contributor license agreements.  See the NOTICE file\n+# distributed with this work for additional information\n+# regarding copyright ownership.  The ASF licenses this file\n+# to you under the Apache License, Version 2.0 (the\n+# \"License\"); you may not use this file except in compliance\n+# with the License.  You may obtain a copy of the License at\n+#\n+#   http://www.apache.org/licenses/LICENSE-2.0\n+#\n+# Unless required by applicable law or agreed to in writing,\n+# software distributed under the License is distributed on an\n+# \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+# KIND, either express or implied.  See the License for the\n+# specific language governing permissions and limitations\n+# under the License.\n+#\n+\n+source scripts/common.sh\n+\n+ORIGIN_REPO=$(git remote show origin | grep 'Push  URL' | awk -F// '{print $NF}')\n+echo \"ORIGIN_REPO: $ORIGIN_REPO\"\n+STAGING_REPO=`echo $ORIGIN_REPO | sed -e 's/bookkeeper\\.git/bookkeeper-staging-site.git/g'`\n+echo \"STAGING_REPO: $STAGING_REPO\"\n+echo \"GENERATE SITE DIR: $LOCAL_GENERATED_DIR\"\n+\n+(\n+  rm -rf $TMP_DIR\n+  mkdir -p $TMP_DIR\n+  cp -r $LOCAL_GENERATED_DIR $TMP_DIR/docs\n+  cd $TMP_DIR\n+\n+  git init\n+\n+  git remote add upstream \"https://$STAGING_REPO\"\n+  git fetch upstream\n+  git reset upstream/master\n+\n+  touch .\n+\n+  git add -A .\n+  git commit -m \"Updated site at revision $REVISION\"\n+  git push -q upstream HEAD:master\n+\n+  rm -rf $TMP_DIR\n+)"}]}