{"sha":"423fa658419fe8b4b0731ede52b8f34610a3f663","node_id":"MDY6Q29tbWl0NDc4NTkyNTI2OjQyM2ZhNjU4NDE5ZmU4YjRiMDczMWVkZTUyYjhmMzQ2MTBhM2Y2NjM=","commit":{"author":{"name":"Sijie Guo","email":"sijie@apache.org","date":"2017-08-04T05:22:47Z"},"committer":{"name":"Sijie Guo","email":"sijie@apache.org","date":"2017-08-04T05:22:47Z"},"message":"ISSUE #381: update old releases url to achives\n\nDescriptions of the changes in this PR:\n\n- the cms content has been copied from cms to asf-site branch under /content/archives. it is available under http://bookkeeper.apache.org/test/content/archives/\n- update the release url from 'bookkeeper.apache.org/docs/rx.y.z' to '{{ site.baseurl }}achives/rx.y.z'\n\nscripts:\n\n- update the scripts to use clone and copy to avoid trash everything in remote. this would prevent overwrite `archives` directory.\n\ncontent:\n\n- fix syntax error in `shell.yaml` to be able to build website\n\nAuthor: Sijie Guo <sijie@apache.org>\n\nReviewers: Jia Zhai <None>, Matteo Merli <mmerli@apache.org>\n\nThis closes #382 from sijie/fix_links, closes #381","tree":{"sha":"290599e1e3d2d80010ed58f5aa99c77d0854b197","url":"https://api.github.com/repos/EnricoDAlessandro97UNI/bookkeeper/git/trees/290599e1e3d2d80010ed58f5aa99c77d0854b197"},"url":"https://api.github.com/repos/EnricoDAlessandro97UNI/bookkeeper/git/commits/423fa658419fe8b4b0731ede52b8f34610a3f663","comment_count":0,"verification":{"verified":false,"reason":"unsigned","signature":null,"payload":null}},"url":"https://api.github.com/repos/EnricoDAlessandro97UNI/bookkeeper/commits/423fa658419fe8b4b0731ede52b8f34610a3f663","html_url":"https://github.com/EnricoDAlessandro97UNI/bookkeeper/commit/423fa658419fe8b4b0731ede52b8f34610a3f663","comments_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/bookkeeper/commits/423fa658419fe8b4b0731ede52b8f34610a3f663/comments","author":{"login":"sijie","id":1217863,"node_id":"MDQ6VXNlcjEyMTc4NjM=","avatar_url":"https://avatars.githubusercontent.com/u/1217863?v=4","gravatar_id":"","url":"https://api.github.com/users/sijie","html_url":"https://github.com/sijie","followers_url":"https://api.github.com/users/sijie/followers","following_url":"https://api.github.com/users/sijie/following{/other_user}","gists_url":"https://api.github.com/users/sijie/gists{/gist_id}","starred_url":"https://api.github.com/users/sijie/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sijie/subscriptions","organizations_url":"https://api.github.com/users/sijie/orgs","repos_url":"https://api.github.com/users/sijie/repos","events_url":"https://api.github.com/users/sijie/events{/privacy}","received_events_url":"https://api.github.com/users/sijie/received_events","type":"User","site_admin":false},"committer":{"login":"sijie","id":1217863,"node_id":"MDQ6VXNlcjEyMTc4NjM=","avatar_url":"https://avatars.githubusercontent.com/u/1217863?v=4","gravatar_id":"","url":"https://api.github.com/users/sijie","html_url":"https://github.com/sijie","followers_url":"https://api.github.com/users/sijie/followers","following_url":"https://api.github.com/users/sijie/following{/other_user}","gists_url":"https://api.github.com/users/sijie/gists{/gist_id}","starred_url":"https://api.github.com/users/sijie/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sijie/subscriptions","organizations_url":"https://api.github.com/users/sijie/orgs","repos_url":"https://api.github.com/users/sijie/repos","events_url":"https://api.github.com/users/sijie/events{/privacy}","received_events_url":"https://api.github.com/users/sijie/received_events","type":"User","site_admin":false},"parents":[{"sha":"7a500dc8082580ad4c85c307ef073edae3ae7f7a","url":"https://api.github.com/repos/EnricoDAlessandro97UNI/bookkeeper/commits/7a500dc8082580ad4c85c307ef073edae3ae7f7a","html_url":"https://github.com/EnricoDAlessandro97UNI/bookkeeper/commit/7a500dc8082580ad4c85c307ef073edae3ae7f7a"}],"stats":{"total":54,"additions":26,"deletions":28},"files":[{"sha":"4f9e76c928d414aa68dfde107eb9cff277360e24","filename":"site/_config.yml","status":"modified","additions":0,"deletions":1,"changes":1,"blob_url":"https://github.com/EnricoDAlessandro97UNI/bookkeeper/blob/423fa658419fe8b4b0731ede52b8f34610a3f663/site%2F_config.yml","raw_url":"https://github.com/EnricoDAlessandro97UNI/bookkeeper/raw/423fa658419fe8b4b0731ede52b8f34610a3f663/site%2F_config.yml","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/bookkeeper/contents/site%2F_config.yml?ref=423fa658419fe8b4b0731ede52b8f34610a3f663","patch":"@@ -7,7 +7,6 @@ bk_version: \"4.5.0\"\n baseurl: /\n destination: local-generated\n twitter_url: https://twitter.com/asfbookkeeper\n-archived_releases_url: //bookkeeper.apache.org/docs/r\n \n livereload: true\n "},{"sha":"6edc2e665339bf51c36242b72ae5c152435c2713","filename":"site/_data/cli/shell.yaml","status":"modified","additions":8,"deletions":9,"changes":17,"blob_url":"https://github.com/EnricoDAlessandro97UNI/bookkeeper/blob/423fa658419fe8b4b0731ede52b8f34610a3f663/site%2F_data%2Fcli%2Fshell.yaml","raw_url":"https://github.com/EnricoDAlessandro97UNI/bookkeeper/raw/423fa658419fe8b4b0731ede52b8f34610a3f663/site%2F_data%2Fcli%2Fshell.yaml","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/bookkeeper/contents/site%2F_data%2Fcli%2Fshell.yaml?ref=423fa658419fe8b4b0731ede52b8f34610a3f663","patch":"@@ -53,11 +53,11 @@ commands:\n   description: List the bookies, which are running as either readwrite or readonly mode.\n   options:\n   - flag: -readwrite\n-  description: Print readwrite bookies\n+    description: Print readwrite bookies\n   - flag: -readonly\n-  description: Print readonly bookies\n+    description: Print readonly bookies\n   - flag: -hostnames\n-  description: Also print hostname of the bookie\n+    description: Also print hostname of the bookie\n - name: listfilesondisc\n   description: List the files in JournalDirectory/LedgerDirectories/IndexDirectories.\n   options:\n@@ -119,13 +119,12 @@ commands:\n     description: End Position\n - name: recover\n   description: Recover the ledger data for failed bookie.\n-  argument: [-deleteCookie] <bookieSrc> [bookieDest]\n+  argument: <bookieSrc> [<bookieDest>]\n   options:\n   - flag: -deleteCookie\n     description: Delete cookie node for the bookie.\n - name: simpletest\n   description: Simple test to create a ledger and write entries to it.\n-  argument: [-ensemble N] [-writeQuorum N] [-ackQuorum N] [-numEntries N]\n   options:\n   - flag: -ensemble N\n     description: Ensemble size (default 3)\n@@ -148,10 +147,10 @@ commands:\n   - flag: -bookieId <hostname|ip>\n     description: Bookie Id\n   - flag: -updatespersec N\n-    description: Number of ledgers updating per second (default: 5 per sec)\n+    description: Number of ledgers updating per second (default 5 per sec)\n   - flag: -limit N\n-    description: Maximum number of ledgers to update (default: no limit)\n+    description: Maximum number of ledgers to update (default no limit)\n   - flag: -verbose\n-    description: Print status of the ledger updation (default: false)\n+    description: Print status of the ledger updation (default false)\n   - flag: -printprogress N\n-    description: Print messages on every configured seconds if verbose turned on (default: 10 secs)\n+    description: Print messages on every configured seconds if verbose turned on (default 10 secs)"},{"sha":"72b5e3327d5e76f3f8cbbf84e849a3df752e15e5","filename":"site/_includes/navbar.html","status":"modified","additions":1,"deletions":1,"changes":2,"blob_url":"https://github.com/EnricoDAlessandro97UNI/bookkeeper/blob/423fa658419fe8b4b0731ede52b8f34610a3f663/site%2F_includes%2Fnavbar.html","raw_url":"https://github.com/EnricoDAlessandro97UNI/bookkeeper/raw/423fa658419fe8b4b0731ede52b8f34610a3f663/site%2F_includes%2Fnavbar.html","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/bookkeeper/contents/site%2F_includes%2Fnavbar.html?ref=423fa658419fe8b4b0731ede52b8f34610a3f663","patch":"@@ -46,7 +46,7 @@\n           </a>\n           <hr class=\"dropdown-divider\">\n           {% for version in site.archived_versions %}\n-          <a class=\"navbar-item\" href=\"{{ site.archived_releases_url }}{{version}}\">\n+          <a class=\"navbar-item\" href=\"{{ site.baseurl }}archives/docs/r{{version}}\">\n             Release {{version}}\n             {% if version == site.stable_release %}<span class=\"tag is-success\">Stable</span>{% endif %}\n           </a>"},{"sha":"fdaf9f4ecb59a6cda66b6c9e31b8ea830c84419b","filename":"site/scripts/publish-website.sh","status":"modified","additions":11,"deletions":8,"changes":19,"blob_url":"https://github.com/EnricoDAlessandro97UNI/bookkeeper/blob/423fa658419fe8b4b0731ede52b8f34610a3f663/site%2Fscripts%2Fpublish-website.sh","raw_url":"https://github.com/EnricoDAlessandro97UNI/bookkeeper/raw/423fa658419fe8b4b0731ede52b8f34610a3f663/site%2Fscripts%2Fpublish-website.sh","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/bookkeeper/contents/site%2Fscripts%2Fpublish-website.sh?ref=423fa658419fe8b4b0731ede52b8f34610a3f663","patch":"@@ -29,17 +29,20 @@ echo \"ORIGIN_REPO: $ORIGIN_REPO\"\n (\n   cd $APACHE_GENERATED_DIR\n \n-  git init\n+  rm -rf $TMP_DIR\n+  mkdir -p $TMP_DIR\n+  cd $TMP_DIR\n+\n+  # clone the remote repo\n+  git clone \"https://$ORIGIN_REPO\" .\n   git config user.name \"Apache BookKeeper Site Updater\"\n   git config user.email \"dev@bookkeeper.apache.org\"\n-\n-  git remote add upstream \"https://$ORIGIN_REPO\"\n-  git fetch upstream\n-  git reset upstream/asf-site\n-\n-  touch .\n+  # copy the apache generated dir\n+  cp -r $APACHE_GENERATED_DIR/* $TMP_DIR/content\n \n   git add -A .\n   git commit -m \"Updated site at revision $REVISION\"\n-  git push -q upstream HEAD:asf-site\n+  git push -q origin HEAD:asf-site\n+\n+  rm -rf $TMP_DIR\n )"},{"sha":"52ee7d34c22d4ddb0109b7dc764e506c9eea8993","filename":"site/scripts/staging-website.sh","status":"modified","additions":6,"deletions":9,"changes":15,"blob_url":"https://github.com/EnricoDAlessandro97UNI/bookkeeper/blob/423fa658419fe8b4b0731ede52b8f34610a3f663/site%2Fscripts%2Fstaging-website.sh","raw_url":"https://github.com/EnricoDAlessandro97UNI/bookkeeper/raw/423fa658419fe8b4b0731ede52b8f34610a3f663/site%2Fscripts%2Fstaging-website.sh","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/bookkeeper/contents/site%2Fscripts%2Fstaging-website.sh?ref=423fa658419fe8b4b0731ede52b8f34610a3f663","patch":"@@ -29,20 +29,17 @@ echo \"GENERATE SITE DIR: $LOCAL_GENERATED_DIR\"\n (\n   rm -rf $TMP_DIR\n   mkdir -p $TMP_DIR\n-  cp -r $LOCAL_GENERATED_DIR $TMP_DIR/docs\n-  cd $TMP_DIR\n-\n-  git init\n \n-  git remote add upstream \"https://$STAGING_REPO\"\n-  git fetch upstream\n-  git reset upstream/master\n+  cd $TMP_DIR\n \n-  touch .\n+  # clone the remote repo\n+  git clone \"https://$STAGING_REPO\" .\n+  # copy the local generated dir\n+  cp -r $LOCAL_GENERATED_DIR/* $TMP_DIR/docs/\n \n   git add -A .\n   git commit -m \"Updated site at revision $REVISION\"\n-  git push -q upstream HEAD:master\n+  git push -q origin HEAD:master\n \n   rm -rf $TMP_DIR\n )"}]}