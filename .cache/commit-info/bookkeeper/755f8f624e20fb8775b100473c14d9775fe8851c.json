{"sha":"755f8f624e20fb8775b100473c14d9775fe8851c","node_id":"MDY6Q29tbWl0NDc4NTkyNTI2Ojc1NWY4ZjYyNGUyMGZiODc3NWIxMDA0NzNjMTRkOTc3NWZlODg1MWM=","commit":{"author":{"name":"Francesco Caliumi - Diennea","email":"francesco.caliumi@diennea.com","date":"2017-08-07T23:56:06Z"},"committer":{"name":"jiazhai","email":"zhaijia@live.com","date":"2017-08-07T23:56:06Z"},"message":"406\n\nDescriptions of the changes in this PR:\n- Fix non-privileged user execution\n- Change the Makefile in order to always use current user when run the bk image\n- Fix Makefile in order to run \"make run-demo\"\n- Adjust unneeded packages remove in Dockerfile\n\nAuthor: Francesco Caliumi - Diennea <francesco.caliumi@diennea.com>\n\nReviewers: Jia Zhai <None>, Matteo Merli <None>, Sijie Guo <None>\n\nThis closes #406 from caiok/master","tree":{"sha":"90d2ec670dc859335941d687f062c598bf64a46a","url":"https://api.github.com/repos/EnricoDAlessandro97UNI/bookkeeper/git/trees/90d2ec670dc859335941d687f062c598bf64a46a"},"url":"https://api.github.com/repos/EnricoDAlessandro97UNI/bookkeeper/git/commits/755f8f624e20fb8775b100473c14d9775fe8851c","comment_count":0,"verification":{"verified":false,"reason":"unsigned","signature":null,"payload":null}},"url":"https://api.github.com/repos/EnricoDAlessandro97UNI/bookkeeper/commits/755f8f624e20fb8775b100473c14d9775fe8851c","html_url":"https://github.com/EnricoDAlessandro97UNI/bookkeeper/commit/755f8f624e20fb8775b100473c14d9775fe8851c","comments_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/bookkeeper/commits/755f8f624e20fb8775b100473c14d9775fe8851c/comments","author":{"login":"caliuf","id":10155161,"node_id":"MDQ6VXNlcjEwMTU1MTYx","avatar_url":"https://avatars.githubusercontent.com/u/10155161?v=4","gravatar_id":"","url":"https://api.github.com/users/caliuf","html_url":"https://github.com/caliuf","followers_url":"https://api.github.com/users/caliuf/followers","following_url":"https://api.github.com/users/caliuf/following{/other_user}","gists_url":"https://api.github.com/users/caliuf/gists{/gist_id}","starred_url":"https://api.github.com/users/caliuf/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/caliuf/subscriptions","organizations_url":"https://api.github.com/users/caliuf/orgs","repos_url":"https://api.github.com/users/caliuf/repos","events_url":"https://api.github.com/users/caliuf/events{/privacy}","received_events_url":"https://api.github.com/users/caliuf/received_events","type":"User","site_admin":false},"committer":null,"parents":[{"sha":"b7b0a6845e5dc47c30d93d86797deb4aa463df04","url":"https://api.github.com/repos/EnricoDAlessandro97UNI/bookkeeper/commits/b7b0a6845e5dc47c30d93d86797deb4aa463df04","html_url":"https://github.com/EnricoDAlessandro97UNI/bookkeeper/commit/b7b0a6845e5dc47c30d93d86797deb4aa463df04"}],"stats":{"total":8,"additions":5,"deletions":3},"files":[{"sha":"5a22bb688749bde2bcad53d398fcf590ec4b3578","filename":"docker/Dockerfile","status":"modified","additions":2,"deletions":2,"changes":4,"blob_url":"https://github.com/EnricoDAlessandro97UNI/bookkeeper/blob/755f8f624e20fb8775b100473c14d9775fe8851c/docker%2FDockerfile","raw_url":"https://github.com/EnricoDAlessandro97UNI/bookkeeper/raw/755f8f624e20fb8775b100473c14d9775fe8851c/docker%2FDockerfile","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/bookkeeper/contents/docker%2FDockerfile?ref=755f8f624e20fb8775b100473c14d9775fe8851c","patch":"@@ -31,7 +31,7 @@ ENV BK_USER=bookkeeper\n # Download Apache Bookkeeper, untar and clean up\n RUN set -x \\\n     && adduser \"${BK_USER}\" \\\n-    && yum install -y java-1.8.0-openjdk-headless wget bash python md5sum sha1sum \\\n+    && yum install -y java-1.8.0-openjdk-headless wget bash python md5sum sha1sum sudo \\\n     && mkdir -pv /opt \\\n     && cd /opt \\\n     && wget -q \"https://archive.apache.org/dist/bookkeeper/bookkeeper-${BK_VERSION}/${DISTRO_NAME}.tar.gz\" \\\n@@ -45,7 +45,7 @@ RUN set -x \\\n     && tar -xzf \"$DISTRO_NAME.tar.gz\" \\\n     && mv bookkeeper-server-${BK_VERSION}/ /opt/bookkeeper/ \\\n     && rm -rf \"$DISTRO_NAME.tar.gz\" \"$DISTRO_NAME.tar.gz.asc\" \"$DISTRO_NAME.tar.gz.md5\" \"$DISTRO_NAME.tar.gz.sha1\" \\\n-    && yum remove -y wget \\\n+    && yum remove -y wget md5sum sha1sum \\\n     && yum clean all\n \n WORKDIR /opt/bookkeeper"},{"sha":"64078db4f966052d6cb2b01af2e7fe4775fce61c","filename":"docker/Makefile","status":"modified","additions":2,"deletions":0,"changes":2,"blob_url":"https://github.com/EnricoDAlessandro97UNI/bookkeeper/blob/755f8f624e20fb8775b100473c14d9775fe8851c/docker%2FMakefile","raw_url":"https://github.com/EnricoDAlessandro97UNI/bookkeeper/raw/755f8f624e20fb8775b100473c14d9775fe8851c/docker%2FMakefile","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/bookkeeper/contents/docker%2FMakefile?ref=755f8f624e20fb8775b100473c14d9775fe8851c","patch":"@@ -38,6 +38,7 @@ BK_zkLedgersRootPath = /ledgers\n ZK_CONTAINER_NAME=test_zookeeper\n ZK_LOCAL_DATA_DIR=$(BK_LOCAL_DATA_DIR)/zookkeeper\n \n+TERMINAL_EMULATOR=gnome-terminal\n \n CONTAINER_IP=$(shell docker inspect --format '{{ .NetworkSettings.IPAddress }}' $(CONTAINER_NAME))\n \n@@ -78,6 +79,7 @@ run-bk:\n \t    --volume $(BK_LOCAL_CONTAINER_DATA_DIR)/journal:$(BK_DIR)/journal \\\n \t    --volume $(BK_LOCAL_CONTAINER_DATA_DIR)/ledger:$(BK_DIR)/ledger \\\n \t    --volume $(BK_LOCAL_CONTAINER_DATA_DIR)/index:$(BK_DIR)/index \\\n+            --user \"$(id -u)\" \\\n \t    --name \"$(CONTAINER_NAME)\" \\\n \t    --hostname \"$(CONTAINER_NAME)\" \\\n \t    --env BK_zkServers=$(ZK_CONTAINER_NAME):2181 \\"},{"sha":"dffbc9360aca32370e22ea19cde3af05c4d6e837","filename":"docker/scripts/entrypoint.sh","status":"modified","additions":1,"deletions":1,"changes":2,"blob_url":"https://github.com/EnricoDAlessandro97UNI/bookkeeper/blob/755f8f624e20fb8775b100473c14d9775fe8851c/docker%2Fscripts%2Fentrypoint.sh","raw_url":"https://github.com/EnricoDAlessandro97UNI/bookkeeper/raw/755f8f624e20fb8775b100473c14d9775fe8851c/docker%2Fscripts%2Fentrypoint.sh","contents_url":"https://api.github.com/repos/EnricoDAlessandro97UNI/bookkeeper/contents/docker%2Fscripts%2Fentrypoint.sh?ref=755f8f624e20fb8775b100473c14d9775fe8851c","patch":"@@ -46,7 +46,7 @@ echo \"BK_CLUSTER_ROOT_PATH is $BK_CLUSTER_ROOT_PATH\"\n mkdir -p \"${BK_journalDirectory}\" \"${BK_ledgerDirectories}\" \"${BK_indexDirectories}\"\n # -------------- #\n # Allow the container to be started with `--user`\n-if [ \"$1\" = 'bookkeeper' -a \"$(id -u)\" = '0' ]; then\n+if [ \"$1\" = '/opt/bookkeeper/bin/bookkeeper' -a \"$(id -u)\" = '0' ]; then\n     chown -R \"$BK_USER:$BK_USER\" \"/opt/bookkeeper/\" \"${BK_journalDirectory}\" \"${BK_ledgerDirectories}\" \"${BK_indexDirectories}\"\n     sudo -s -E -u \"$BK_USER\" /bin/bash \"$0\" \"$@\"\n     exit"}]}